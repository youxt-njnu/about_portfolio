function pfe(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in n)){const s=Object.getOwnPropertyDescriptor(r,i);s&&Object.defineProperty(n,i,s.get?s:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();var mfe=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function rL(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function gfe(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var t=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}),t}var BK={exports:{}},iL={},kK={exports:{}},$i={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _T=Symbol.for("react.element"),vfe=Symbol.for("react.portal"),_fe=Symbol.for("react.fragment"),yfe=Symbol.for("react.strict_mode"),xfe=Symbol.for("react.profiler"),bfe=Symbol.for("react.provider"),wfe=Symbol.for("react.context"),Sfe=Symbol.for("react.forward_ref"),Afe=Symbol.for("react.suspense"),Tfe=Symbol.for("react.memo"),Mfe=Symbol.for("react.lazy"),xG=Symbol.iterator;function Cfe(n){return n===null||typeof n!="object"?null:(n=xG&&n[xG]||n["@@iterator"],typeof n=="function"?n:null)}var OK={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},FK=Object.assign,NK={};function ow(n,e,t){this.props=n,this.context=e,this.refs=NK,this.updater=t||OK}ow.prototype.isReactComponent={};ow.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};ow.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function zK(){}zK.prototype=ow.prototype;function iz(n,e,t){this.props=n,this.context=e,this.refs=NK,this.updater=t||OK}var sz=iz.prototype=new zK;sz.constructor=iz;FK(sz,ow.prototype);sz.isPureReactComponent=!0;var bG=Array.isArray,UK=Object.prototype.hasOwnProperty,oz={current:null},VK={key:!0,ref:!0,__self:!0,__source:!0};function GK(n,e,t){var r,i={},s=null,a=null;if(e!=null)for(r in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(s=""+e.key),e)UK.call(e,r)&&!VK.hasOwnProperty(r)&&(i[r]=e[r]);var l=arguments.length-2;if(l===1)i.children=t;else if(1<l){for(var o=Array(l),h=0;h<l;h++)o[h]=arguments[h+2];i.children=o}if(n&&n.defaultProps)for(r in l=n.defaultProps,l)i[r]===void 0&&(i[r]=l[r]);return{$$typeof:_T,type:n,key:s,ref:a,props:i,_owner:oz.current}}function Efe(n,e){return{$$typeof:_T,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function az(n){return typeof n=="object"&&n!==null&&n.$$typeof===_T}function Ife(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var wG=/\/+/g;function m4(n,e){return typeof n=="object"&&n!==null&&n.key!=null?Ife(""+n.key):e.toString(36)}function yI(n,e,t,r,i){var s=typeof n;(s==="undefined"||s==="boolean")&&(n=null);var a=!1;if(n===null)a=!0;else switch(s){case"string":case"number":a=!0;break;case"object":switch(n.$$typeof){case _T:case vfe:a=!0}}if(a)return a=n,i=i(a),n=r===""?"."+m4(a,0):r,bG(i)?(t="",n!=null&&(t=n.replace(wG,"$&/")+"/"),yI(i,e,t,"",function(h){return h})):i!=null&&(az(i)&&(i=Efe(i,t+(!i.key||a&&a.key===i.key?"":(""+i.key).replace(wG,"$&/")+"/")+n)),e.push(i)),1;if(a=0,r=r===""?".":r+":",bG(n))for(var l=0;l<n.length;l++){s=n[l];var o=r+m4(s,l);a+=yI(s,e,t,o,i)}else if(o=Cfe(n),typeof o=="function")for(n=o.call(n),l=0;!(s=n.next()).done;)s=s.value,o=r+m4(s,l++),a+=yI(s,e,t,o,i);else if(s==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function JM(n,e,t){if(n==null)return n;var r=[],i=0;return yI(n,r,"","",function(s){return e.call(t,s,i++)}),r}function Rfe(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var Pc={current:null},xI={transition:null},Pfe={ReactCurrentDispatcher:Pc,ReactCurrentBatchConfig:xI,ReactCurrentOwner:oz};$i.Children={map:JM,forEach:function(n,e,t){JM(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return JM(n,function(){e++}),e},toArray:function(n){return JM(n,function(e){return e})||[]},only:function(n){if(!az(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};$i.Component=ow;$i.Fragment=_fe;$i.Profiler=xfe;$i.PureComponent=iz;$i.StrictMode=yfe;$i.Suspense=Afe;$i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Pfe;$i.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var r=FK({},n.props),i=n.key,s=n.ref,a=n._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,a=oz.current),e.key!==void 0&&(i=""+e.key),n.type&&n.type.defaultProps)var l=n.type.defaultProps;for(o in e)UK.call(e,o)&&!VK.hasOwnProperty(o)&&(r[o]=e[o]===void 0&&l!==void 0?l[o]:e[o])}var o=arguments.length-2;if(o===1)r.children=t;else if(1<o){l=Array(o);for(var h=0;h<o;h++)l[h]=arguments[h+2];r.children=l}return{$$typeof:_T,type:n.type,key:i,ref:s,props:r,_owner:a}};$i.createContext=function(n){return n={$$typeof:wfe,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:bfe,_context:n},n.Consumer=n};$i.createElement=GK;$i.createFactory=function(n){var e=GK.bind(null,n);return e.type=n,e};$i.createRef=function(){return{current:null}};$i.forwardRef=function(n){return{$$typeof:Sfe,render:n}};$i.isValidElement=az;$i.lazy=function(n){return{$$typeof:Mfe,_payload:{_status:-1,_result:n},_init:Rfe}};$i.memo=function(n,e){return{$$typeof:Tfe,type:n,compare:e===void 0?null:e}};$i.startTransition=function(n){var e=xI.transition;xI.transition={};try{n()}finally{xI.transition=e}};$i.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};$i.useCallback=function(n,e){return Pc.current.useCallback(n,e)};$i.useContext=function(n){return Pc.current.useContext(n)};$i.useDebugValue=function(){};$i.useDeferredValue=function(n){return Pc.current.useDeferredValue(n)};$i.useEffect=function(n,e){return Pc.current.useEffect(n,e)};$i.useId=function(){return Pc.current.useId()};$i.useImperativeHandle=function(n,e,t){return Pc.current.useImperativeHandle(n,e,t)};$i.useInsertionEffect=function(n,e){return Pc.current.useInsertionEffect(n,e)};$i.useLayoutEffect=function(n,e){return Pc.current.useLayoutEffect(n,e)};$i.useMemo=function(n,e){return Pc.current.useMemo(n,e)};$i.useReducer=function(n,e,t){return Pc.current.useReducer(n,e,t)};$i.useRef=function(n){return Pc.current.useRef(n)};$i.useState=function(n){return Pc.current.useState(n)};$i.useSyncExternalStore=function(n,e,t){return Pc.current.useSyncExternalStore(n,e,t)};$i.useTransition=function(){return Pc.current.useTransition()};$i.version="18.2.0";kK.exports=$i;var Ae=kK.exports;const Xl=rL(Ae),KI=pfe({__proto__:null,default:Xl},[Ae]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Lfe=Ae,Dfe=Symbol.for("react.element"),Bfe=Symbol.for("react.fragment"),kfe=Object.prototype.hasOwnProperty,Ofe=Lfe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Ffe={key:!0,ref:!0,__self:!0,__source:!0};function HK(n,e,t){var r,i={},s=null,a=null;t!==void 0&&(s=""+t),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(a=e.ref);for(r in e)kfe.call(e,r)&&!Ffe.hasOwnProperty(r)&&(i[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:Dfe,type:n,key:s,ref:a,props:i,_owner:Ofe.current}}iL.Fragment=Bfe;iL.jsx=HK;iL.jsxs=HK;BK.exports=iL;var me=BK.exports,Xk={},jK={exports:{}},Fu={},WK={exports:{}},XK={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(ye,Xe){var He=ye.length;ye.push(Xe);e:for(;0<He;){var _t=He-1>>>1,wt=ye[_t];if(0<i(wt,Xe))ye[_t]=Xe,ye[He]=wt,He=_t;else break e}}function t(ye){return ye.length===0?null:ye[0]}function r(ye){if(ye.length===0)return null;var Xe=ye[0],He=ye.pop();if(He!==Xe){ye[0]=He;e:for(var _t=0,wt=ye.length,Gt=wt>>>1;_t<Gt;){var at=2*(_t+1)-1,Ht=ye[at],Qt=at+1,rn=ye[Qt];if(0>i(Ht,He))Qt<wt&&0>i(rn,Ht)?(ye[_t]=rn,ye[Qt]=He,_t=Qt):(ye[_t]=Ht,ye[at]=He,_t=at);else if(Qt<wt&&0>i(rn,He))ye[_t]=rn,ye[Qt]=He,_t=Qt;else break e}}return Xe}function i(ye,Xe){var He=ye.sortIndex-Xe.sortIndex;return He!==0?He:ye.id-Xe.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;n.unstable_now=function(){return s.now()}}else{var a=Date,l=a.now();n.unstable_now=function(){return a.now()-l}}var o=[],h=[],d=1,m=null,_=3,y=!1,T=!1,I=!1,C=typeof setTimeout=="function"?setTimeout:null,M=typeof clearTimeout=="function"?clearTimeout:null,B=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function k(ye){for(var Xe=t(h);Xe!==null;){if(Xe.callback===null)r(h);else if(Xe.startTime<=ye)r(h),Xe.sortIndex=Xe.expirationTime,e(o,Xe);else break;Xe=t(h)}}function j(ye){if(I=!1,k(ye),!T)if(t(o)!==null)T=!0,Le(q);else{var Xe=t(h);Xe!==null&&dt(j,Xe.startTime-ye)}}function q(ye,Xe){T=!1,I&&(I=!1,M(ie),ie=-1),y=!0;var He=_;try{for(k(Xe),m=t(o);m!==null&&(!(m.expirationTime>Xe)||ye&&!fe());){var _t=m.callback;if(typeof _t=="function"){m.callback=null,_=m.priorityLevel;var wt=_t(m.expirationTime<=Xe);Xe=n.unstable_now(),typeof wt=="function"?m.callback=wt:m===t(o)&&r(o),k(Xe)}else r(o);m=t(o)}if(m!==null)var Gt=!0;else{var at=t(h);at!==null&&dt(j,at.startTime-Xe),Gt=!1}return Gt}finally{m=null,_=He,y=!1}}var Z=!1,te=null,ie=-1,se=5,ae=-1;function fe(){return!(n.unstable_now()-ae<se)}function Se(){if(te!==null){var ye=n.unstable_now();ae=ye;var Xe=!0;try{Xe=te(!0,ye)}finally{Xe?Ee():(Z=!1,te=null)}}else Z=!1}var Ee;if(typeof B=="function")Ee=function(){B(Se)};else if(typeof MessageChannel<"u"){var Re=new MessageChannel,qe=Re.port2;Re.port1.onmessage=Se,Ee=function(){qe.postMessage(null)}}else Ee=function(){C(Se,0)};function Le(ye){te=ye,Z||(Z=!0,Ee())}function dt(ye,Xe){ie=C(function(){ye(n.unstable_now())},Xe)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(ye){ye.callback=null},n.unstable_continueExecution=function(){T||y||(T=!0,Le(q))},n.unstable_forceFrameRate=function(ye){0>ye||125<ye?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):se=0<ye?Math.floor(1e3/ye):5},n.unstable_getCurrentPriorityLevel=function(){return _},n.unstable_getFirstCallbackNode=function(){return t(o)},n.unstable_next=function(ye){switch(_){case 1:case 2:case 3:var Xe=3;break;default:Xe=_}var He=_;_=Xe;try{return ye()}finally{_=He}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(ye,Xe){switch(ye){case 1:case 2:case 3:case 4:case 5:break;default:ye=3}var He=_;_=ye;try{return Xe()}finally{_=He}},n.unstable_scheduleCallback=function(ye,Xe,He){var _t=n.unstable_now();switch(typeof He=="object"&&He!==null?(He=He.delay,He=typeof He=="number"&&0<He?_t+He:_t):He=_t,ye){case 1:var wt=-1;break;case 2:wt=250;break;case 5:wt=1073741823;break;case 4:wt=1e4;break;default:wt=5e3}return wt=He+wt,ye={id:d++,callback:Xe,priorityLevel:ye,startTime:He,expirationTime:wt,sortIndex:-1},He>_t?(ye.sortIndex=He,e(h,ye),t(o)===null&&ye===t(h)&&(I?(M(ie),ie=-1):I=!0,dt(j,He-_t))):(ye.sortIndex=wt,e(o,ye),T||y||(T=!0,Le(q))),ye},n.unstable_shouldYield=fe,n.unstable_wrapCallback=function(ye){var Xe=_;return function(){var He=_;_=Xe;try{return ye.apply(this,arguments)}finally{_=He}}}})(XK);WK.exports=XK;var Nfe=WK.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $K=Ae,ku=Nfe;function Zn(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var qK=new Set,uA={};function lx(n,e){Nb(n,e),Nb(n+"Capture",e)}function Nb(n,e){for(uA[n]=e,n=0;n<e.length;n++)qK.add(e[n])}var Om=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),$k=Object.prototype.hasOwnProperty,zfe=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,SG={},AG={};function Ufe(n){return $k.call(AG,n)?!0:$k.call(SG,n)?!1:zfe.test(n)?AG[n]=!0:(SG[n]=!0,!1)}function Vfe(n,e,t,r){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function Gfe(n,e,t,r){if(e===null||typeof e>"u"||Vfe(n,e,t,r))return!0;if(r)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Lc(n,e,t,r,i,s,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=s,this.removeEmptyString=a}var Sl={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){Sl[n]=new Lc(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];Sl[e]=new Lc(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){Sl[n]=new Lc(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){Sl[n]=new Lc(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){Sl[n]=new Lc(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){Sl[n]=new Lc(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){Sl[n]=new Lc(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){Sl[n]=new Lc(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){Sl[n]=new Lc(n,5,!1,n.toLowerCase(),null,!1,!1)});var lz=/[\-:]([a-z])/g;function cz(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(lz,cz);Sl[e]=new Lc(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(lz,cz);Sl[e]=new Lc(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(lz,cz);Sl[e]=new Lc(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){Sl[n]=new Lc(n,1,!1,n.toLowerCase(),null,!1,!1)});Sl.xlinkHref=new Lc("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){Sl[n]=new Lc(n,1,!1,n.toLowerCase(),null,!0,!0)});function uz(n,e,t,r){var i=Sl.hasOwnProperty(e)?Sl[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(Gfe(e,t,i,r)&&(t=null),r||i===null?Ufe(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):i.mustUseProperty?n[i.propertyName]=t===null?i.type===3?!1:"":t:(e=i.attributeName,r=i.attributeNamespace,t===null?n.removeAttribute(e):(i=i.type,t=i===3||i===4&&t===!0?"":""+t,r?n.setAttributeNS(r,e,t):n.setAttribute(e,t))))}var Km=$K.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,QM=Symbol.for("react.element"),Z1=Symbol.for("react.portal"),Y1=Symbol.for("react.fragment"),hz=Symbol.for("react.strict_mode"),qk=Symbol.for("react.profiler"),ZK=Symbol.for("react.provider"),YK=Symbol.for("react.context"),fz=Symbol.for("react.forward_ref"),Zk=Symbol.for("react.suspense"),Yk=Symbol.for("react.suspense_list"),dz=Symbol.for("react.memo"),C0=Symbol.for("react.lazy"),KK=Symbol.for("react.offscreen"),TG=Symbol.iterator;function c2(n){return n===null||typeof n!="object"?null:(n=TG&&n[TG]||n["@@iterator"],typeof n=="function"?n:null)}var Ho=Object.assign,g4;function oS(n){if(g4===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);g4=e&&e[1]||""}return`
`+g4+n}var v4=!1;function _4(n,e){if(!n||v4)return"";v4=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(h){var r=h}Reflect.construct(n,[],e)}else{try{e.call()}catch(h){r=h}n.call(e.prototype)}else{try{throw Error()}catch(h){r=h}n()}}catch(h){if(h&&r&&typeof h.stack=="string"){for(var i=h.stack.split(`
`),s=r.stack.split(`
`),a=i.length-1,l=s.length-1;1<=a&&0<=l&&i[a]!==s[l];)l--;for(;1<=a&&0<=l;a--,l--)if(i[a]!==s[l]){if(a!==1||l!==1)do if(a--,l--,0>l||i[a]!==s[l]){var o=`
`+i[a].replace(" at new "," at ");return n.displayName&&o.includes("<anonymous>")&&(o=o.replace("<anonymous>",n.displayName)),o}while(1<=a&&0<=l);break}}}finally{v4=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?oS(n):""}function Hfe(n){switch(n.tag){case 5:return oS(n.type);case 16:return oS("Lazy");case 13:return oS("Suspense");case 19:return oS("SuspenseList");case 0:case 2:case 15:return n=_4(n.type,!1),n;case 11:return n=_4(n.type.render,!1),n;case 1:return n=_4(n.type,!0),n;default:return""}}function Kk(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case Y1:return"Fragment";case Z1:return"Portal";case qk:return"Profiler";case hz:return"StrictMode";case Zk:return"Suspense";case Yk:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case YK:return(n.displayName||"Context")+".Consumer";case ZK:return(n._context.displayName||"Context")+".Provider";case fz:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case dz:return e=n.displayName||null,e!==null?e:Kk(n.type)||"Memo";case C0:e=n._payload,n=n._init;try{return Kk(n(e))}catch{}}return null}function jfe(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Kk(e);case 8:return e===hz?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function sv(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function JK(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function Wfe(n){var e=JK(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),r=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var i=t.get,s=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return i.call(this)},set:function(a){r=""+a,s.call(this,a)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return r},setValue:function(a){r=""+a},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function eC(n){n._valueTracker||(n._valueTracker=Wfe(n))}function QK(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),r="";return n&&(r=JK(n)?n.checked?"true":"false":n.value),n=r,n!==t?(e.setValue(n),!0):!1}function JI(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function Jk(n,e){var t=e.checked;return Ho({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function MG(n,e){var t=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;t=sv(e.value!=null?e.value:t),n._wrapperState={initialChecked:r,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function eJ(n,e){e=e.checked,e!=null&&uz(n,"checked",e,!1)}function Qk(n,e){eJ(n,e);var t=sv(e.value),r=e.type;if(t!=null)r==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(r==="submit"||r==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?eO(n,e.type,t):e.hasOwnProperty("defaultValue")&&eO(n,e.type,sv(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function CG(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function eO(n,e,t){(e!=="number"||JI(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var aS=Array.isArray;function yb(n,e,t,r){if(n=n.options,e){e={};for(var i=0;i<t.length;i++)e["$"+t[i]]=!0;for(t=0;t<n.length;t++)i=e.hasOwnProperty("$"+n[t].value),n[t].selected!==i&&(n[t].selected=i),i&&r&&(n[t].defaultSelected=!0)}else{for(t=""+sv(t),e=null,i=0;i<n.length;i++){if(n[i].value===t){n[i].selected=!0,r&&(n[i].defaultSelected=!0);return}e!==null||n[i].disabled||(e=n[i])}e!==null&&(e.selected=!0)}}function tO(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Zn(91));return Ho({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function EG(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(Zn(92));if(aS(t)){if(1<t.length)throw Error(Zn(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:sv(t)}}function tJ(n,e){var t=sv(e.value),r=sv(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),r!=null&&(n.defaultValue=""+r)}function IG(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function nJ(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function nO(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?nJ(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var tC,rJ=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,r,i){MSApp.execUnsafeLocalFunction(function(){return n(e,t,r,i)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(tC=tC||document.createElement("div"),tC.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=tC.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function hA(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var TS={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Xfe=["Webkit","ms","Moz","O"];Object.keys(TS).forEach(function(n){Xfe.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),TS[e]=TS[n]})});function iJ(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||TS.hasOwnProperty(n)&&TS[n]?(""+e).trim():e+"px"}function sJ(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var r=t.indexOf("--")===0,i=iJ(t,e[t],r);t==="float"&&(t="cssFloat"),r?n.setProperty(t,i):n[t]=i}}var $fe=Ho({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function rO(n,e){if(e){if($fe[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Zn(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Zn(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Zn(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Zn(62))}}function iO(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var sO=null;function pz(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var oO=null,xb=null,bb=null;function RG(n){if(n=bT(n)){if(typeof oO!="function")throw Error(Zn(280));var e=n.stateNode;e&&(e=cL(e),oO(n.stateNode,n.type,e))}}function oJ(n){xb?bb?bb.push(n):bb=[n]:xb=n}function aJ(){if(xb){var n=xb,e=bb;if(bb=xb=null,RG(n),e)for(n=0;n<e.length;n++)RG(e[n])}}function lJ(n,e){return n(e)}function cJ(){}var y4=!1;function uJ(n,e,t){if(y4)return n(e,t);y4=!0;try{return lJ(n,e,t)}finally{y4=!1,(xb!==null||bb!==null)&&(cJ(),aJ())}}function fA(n,e){var t=n.stateNode;if(t===null)return null;var r=cL(t);if(r===null)return null;t=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(n=n.type,r=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!r;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(Zn(231,e,typeof t));return t}var aO=!1;if(Om)try{var u2={};Object.defineProperty(u2,"passive",{get:function(){aO=!0}}),window.addEventListener("test",u2,u2),window.removeEventListener("test",u2,u2)}catch{aO=!1}function qfe(n,e,t,r,i,s,a,l,o){var h=Array.prototype.slice.call(arguments,3);try{e.apply(t,h)}catch(d){this.onError(d)}}var MS=!1,QI=null,eR=!1,lO=null,Zfe={onError:function(n){MS=!0,QI=n}};function Yfe(n,e,t,r,i,s,a,l,o){MS=!1,QI=null,qfe.apply(Zfe,arguments)}function Kfe(n,e,t,r,i,s,a,l,o){if(Yfe.apply(this,arguments),MS){if(MS){var h=QI;MS=!1,QI=null}else throw Error(Zn(198));eR||(eR=!0,lO=h)}}function cx(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function hJ(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function PG(n){if(cx(n)!==n)throw Error(Zn(188))}function Jfe(n){var e=n.alternate;if(!e){if(e=cx(n),e===null)throw Error(Zn(188));return e!==n?null:n}for(var t=n,r=e;;){var i=t.return;if(i===null)break;var s=i.alternate;if(s===null){if(r=i.return,r!==null){t=r;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===t)return PG(i),n;if(s===r)return PG(i),e;s=s.sibling}throw Error(Zn(188))}if(t.return!==r.return)t=i,r=s;else{for(var a=!1,l=i.child;l;){if(l===t){a=!0,t=i,r=s;break}if(l===r){a=!0,r=i,t=s;break}l=l.sibling}if(!a){for(l=s.child;l;){if(l===t){a=!0,t=s,r=i;break}if(l===r){a=!0,r=s,t=i;break}l=l.sibling}if(!a)throw Error(Zn(189))}}if(t.alternate!==r)throw Error(Zn(190))}if(t.tag!==3)throw Error(Zn(188));return t.stateNode.current===t?n:e}function fJ(n){return n=Jfe(n),n!==null?dJ(n):null}function dJ(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=dJ(n);if(e!==null)return e;n=n.sibling}return null}var pJ=ku.unstable_scheduleCallback,LG=ku.unstable_cancelCallback,Qfe=ku.unstable_shouldYield,ede=ku.unstable_requestPaint,fa=ku.unstable_now,tde=ku.unstable_getCurrentPriorityLevel,mz=ku.unstable_ImmediatePriority,mJ=ku.unstable_UserBlockingPriority,tR=ku.unstable_NormalPriority,nde=ku.unstable_LowPriority,gJ=ku.unstable_IdlePriority,sL=null,tp=null;function rde(n){if(tp&&typeof tp.onCommitFiberRoot=="function")try{tp.onCommitFiberRoot(sL,n,void 0,(n.current.flags&128)===128)}catch{}}var Vf=Math.clz32?Math.clz32:ode,ide=Math.log,sde=Math.LN2;function ode(n){return n>>>=0,n===0?32:31-(ide(n)/sde|0)|0}var nC=64,rC=4194304;function lS(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function nR(n,e){var t=n.pendingLanes;if(t===0)return 0;var r=0,i=n.suspendedLanes,s=n.pingedLanes,a=t&268435455;if(a!==0){var l=a&~i;l!==0?r=lS(l):(s&=a,s!==0&&(r=lS(s)))}else a=t&~i,a!==0?r=lS(a):s!==0&&(r=lS(s));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,s=e&-e,i>=s||i===16&&(s&4194240)!==0))return e;if(r&4&&(r|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=r;0<e;)t=31-Vf(e),i=1<<t,r|=n[t],e&=~i;return r}function ade(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function lde(n,e){for(var t=n.suspendedLanes,r=n.pingedLanes,i=n.expirationTimes,s=n.pendingLanes;0<s;){var a=31-Vf(s),l=1<<a,o=i[a];o===-1?(!(l&t)||l&r)&&(i[a]=ade(l,e)):o<=e&&(n.expiredLanes|=l),s&=~l}}function cO(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function vJ(){var n=nC;return nC<<=1,!(nC&4194240)&&(nC=64),n}function x4(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function yT(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-Vf(e),n[e]=t}function cde(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var r=n.eventTimes;for(n=n.expirationTimes;0<t;){var i=31-Vf(t),s=1<<i;e[i]=0,r[i]=-1,n[i]=-1,t&=~s}}function gz(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var r=31-Vf(t),i=1<<r;i&e|n[r]&e&&(n[r]|=e),t&=~i}}var Os=0;function _J(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var yJ,vz,xJ,bJ,wJ,uO=!1,iC=[],W0=null,X0=null,$0=null,dA=new Map,pA=new Map,P0=[],ude="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function DG(n,e){switch(n){case"focusin":case"focusout":W0=null;break;case"dragenter":case"dragleave":X0=null;break;case"mouseover":case"mouseout":$0=null;break;case"pointerover":case"pointerout":dA.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":pA.delete(e.pointerId)}}function h2(n,e,t,r,i,s){return n===null||n.nativeEvent!==s?(n={blockedOn:e,domEventName:t,eventSystemFlags:r,nativeEvent:s,targetContainers:[i]},e!==null&&(e=bT(e),e!==null&&vz(e)),n):(n.eventSystemFlags|=r,e=n.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),n)}function hde(n,e,t,r,i){switch(e){case"focusin":return W0=h2(W0,n,e,t,r,i),!0;case"dragenter":return X0=h2(X0,n,e,t,r,i),!0;case"mouseover":return $0=h2($0,n,e,t,r,i),!0;case"pointerover":var s=i.pointerId;return dA.set(s,h2(dA.get(s)||null,n,e,t,r,i)),!0;case"gotpointercapture":return s=i.pointerId,pA.set(s,h2(pA.get(s)||null,n,e,t,r,i)),!0}return!1}function SJ(n){var e=uy(n.target);if(e!==null){var t=cx(e);if(t!==null){if(e=t.tag,e===13){if(e=hJ(t),e!==null){n.blockedOn=e,wJ(n.priority,function(){xJ(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function bI(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=hO(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var r=new t.constructor(t.type,t);sO=r,t.target.dispatchEvent(r),sO=null}else return e=bT(t),e!==null&&vz(e),n.blockedOn=t,!1;e.shift()}return!0}function BG(n,e,t){bI(n)&&t.delete(e)}function fde(){uO=!1,W0!==null&&bI(W0)&&(W0=null),X0!==null&&bI(X0)&&(X0=null),$0!==null&&bI($0)&&($0=null),dA.forEach(BG),pA.forEach(BG)}function f2(n,e){n.blockedOn===e&&(n.blockedOn=null,uO||(uO=!0,ku.unstable_scheduleCallback(ku.unstable_NormalPriority,fde)))}function mA(n){function e(i){return f2(i,n)}if(0<iC.length){f2(iC[0],n);for(var t=1;t<iC.length;t++){var r=iC[t];r.blockedOn===n&&(r.blockedOn=null)}}for(W0!==null&&f2(W0,n),X0!==null&&f2(X0,n),$0!==null&&f2($0,n),dA.forEach(e),pA.forEach(e),t=0;t<P0.length;t++)r=P0[t],r.blockedOn===n&&(r.blockedOn=null);for(;0<P0.length&&(t=P0[0],t.blockedOn===null);)SJ(t),t.blockedOn===null&&P0.shift()}var wb=Km.ReactCurrentBatchConfig,rR=!0;function dde(n,e,t,r){var i=Os,s=wb.transition;wb.transition=null;try{Os=1,_z(n,e,t,r)}finally{Os=i,wb.transition=s}}function pde(n,e,t,r){var i=Os,s=wb.transition;wb.transition=null;try{Os=4,_z(n,e,t,r)}finally{Os=i,wb.transition=s}}function _z(n,e,t,r){if(rR){var i=hO(n,e,t,r);if(i===null)R4(n,e,r,iR,t),DG(n,r);else if(hde(i,n,e,t,r))r.stopPropagation();else if(DG(n,r),e&4&&-1<ude.indexOf(n)){for(;i!==null;){var s=bT(i);if(s!==null&&yJ(s),s=hO(n,e,t,r),s===null&&R4(n,e,r,iR,t),s===i)break;i=s}i!==null&&r.stopPropagation()}else R4(n,e,r,null,t)}}var iR=null;function hO(n,e,t,r){if(iR=null,n=pz(r),n=uy(n),n!==null)if(e=cx(n),e===null)n=null;else if(t=e.tag,t===13){if(n=hJ(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return iR=n,null}function AJ(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(tde()){case mz:return 1;case mJ:return 4;case tR:case nde:return 16;case gJ:return 536870912;default:return 16}default:return 16}}var k0=null,yz=null,wI=null;function TJ(){if(wI)return wI;var n,e=yz,t=e.length,r,i="value"in k0?k0.value:k0.textContent,s=i.length;for(n=0;n<t&&e[n]===i[n];n++);var a=t-n;for(r=1;r<=a&&e[t-r]===i[s-r];r++);return wI=i.slice(n,1<r?1-r:void 0)}function SI(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function sC(){return!0}function kG(){return!1}function Nu(n){function e(t,r,i,s,a){this._reactName=t,this._targetInst=i,this.type=r,this.nativeEvent=s,this.target=a,this.currentTarget=null;for(var l in n)n.hasOwnProperty(l)&&(t=n[l],this[l]=t?t(s):s[l]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?sC:kG,this.isPropagationStopped=kG,this}return Ho(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=sC)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=sC)},persist:function(){},isPersistent:sC}),e}var aw={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},xz=Nu(aw),xT=Ho({},aw,{view:0,detail:0}),mde=Nu(xT),b4,w4,d2,oL=Ho({},xT,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:bz,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==d2&&(d2&&n.type==="mousemove"?(b4=n.screenX-d2.screenX,w4=n.screenY-d2.screenY):w4=b4=0,d2=n),b4)},movementY:function(n){return"movementY"in n?n.movementY:w4}}),OG=Nu(oL),gde=Ho({},oL,{dataTransfer:0}),vde=Nu(gde),_de=Ho({},xT,{relatedTarget:0}),S4=Nu(_de),yde=Ho({},aw,{animationName:0,elapsedTime:0,pseudoElement:0}),xde=Nu(yde),bde=Ho({},aw,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),wde=Nu(bde),Sde=Ho({},aw,{data:0}),FG=Nu(Sde),Ade={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Tde={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Mde={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Cde(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=Mde[n])?!!e[n]:!1}function bz(){return Cde}var Ede=Ho({},xT,{key:function(n){if(n.key){var e=Ade[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=SI(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?Tde[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:bz,charCode:function(n){return n.type==="keypress"?SI(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?SI(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),Ide=Nu(Ede),Rde=Ho({},oL,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),NG=Nu(Rde),Pde=Ho({},xT,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:bz}),Lde=Nu(Pde),Dde=Ho({},aw,{propertyName:0,elapsedTime:0,pseudoElement:0}),Bde=Nu(Dde),kde=Ho({},oL,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),Ode=Nu(kde),Fde=[9,13,27,32],wz=Om&&"CompositionEvent"in window,CS=null;Om&&"documentMode"in document&&(CS=document.documentMode);var Nde=Om&&"TextEvent"in window&&!CS,MJ=Om&&(!wz||CS&&8<CS&&11>=CS),zG=" ",UG=!1;function CJ(n,e){switch(n){case"keyup":return Fde.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function EJ(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var K1=!1;function zde(n,e){switch(n){case"compositionend":return EJ(e);case"keypress":return e.which!==32?null:(UG=!0,zG);case"textInput":return n=e.data,n===zG&&UG?null:n;default:return null}}function Ude(n,e){if(K1)return n==="compositionend"||!wz&&CJ(n,e)?(n=TJ(),wI=yz=k0=null,K1=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return MJ&&e.locale!=="ko"?null:e.data;default:return null}}var Vde={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function VG(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!Vde[n.type]:e==="textarea"}function IJ(n,e,t,r){oJ(r),e=sR(e,"onChange"),0<e.length&&(t=new xz("onChange","change",null,t,r),n.push({event:t,listeners:e}))}var ES=null,gA=null;function Gde(n){UJ(n,0)}function aL(n){var e=eb(n);if(QK(e))return n}function Hde(n,e){if(n==="change")return e}var RJ=!1;if(Om){var A4;if(Om){var T4="oninput"in document;if(!T4){var GG=document.createElement("div");GG.setAttribute("oninput","return;"),T4=typeof GG.oninput=="function"}A4=T4}else A4=!1;RJ=A4&&(!document.documentMode||9<document.documentMode)}function HG(){ES&&(ES.detachEvent("onpropertychange",PJ),gA=ES=null)}function PJ(n){if(n.propertyName==="value"&&aL(gA)){var e=[];IJ(e,gA,n,pz(n)),uJ(Gde,e)}}function jde(n,e,t){n==="focusin"?(HG(),ES=e,gA=t,ES.attachEvent("onpropertychange",PJ)):n==="focusout"&&HG()}function Wde(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return aL(gA)}function Xde(n,e){if(n==="click")return aL(e)}function $de(n,e){if(n==="input"||n==="change")return aL(e)}function qde(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var Wf=typeof Object.is=="function"?Object.is:qde;function vA(n,e){if(Wf(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(r=0;r<t.length;r++){var i=t[r];if(!$k.call(e,i)||!Wf(n[i],e[i]))return!1}return!0}function jG(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function WG(n,e){var t=jG(n);n=0;for(var r;t;){if(t.nodeType===3){if(r=n+t.textContent.length,n<=e&&r>=e)return{node:t,offset:e-n};n=r}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=jG(t)}}function LJ(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?LJ(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function DJ(){for(var n=window,e=JI();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=JI(n.document)}return e}function Sz(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function Zde(n){var e=DJ(),t=n.focusedElem,r=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&LJ(t.ownerDocument.documentElement,t)){if(r!==null&&Sz(t)){if(e=r.start,n=r.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var i=t.textContent.length,s=Math.min(r.start,i);r=r.end===void 0?s:Math.min(r.end,i),!n.extend&&s>r&&(i=r,r=s,s=i),i=WG(t,s);var a=WG(t,r);i&&a&&(n.rangeCount!==1||n.anchorNode!==i.node||n.anchorOffset!==i.offset||n.focusNode!==a.node||n.focusOffset!==a.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),n.removeAllRanges(),s>r?(n.addRange(e),n.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var Yde=Om&&"documentMode"in document&&11>=document.documentMode,J1=null,fO=null,IS=null,dO=!1;function XG(n,e,t){var r=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;dO||J1==null||J1!==JI(r)||(r=J1,"selectionStart"in r&&Sz(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),IS&&vA(IS,r)||(IS=r,r=sR(fO,"onSelect"),0<r.length&&(e=new xz("onSelect","select",null,e,t),n.push({event:e,listeners:r}),e.target=J1)))}function oC(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var Q1={animationend:oC("Animation","AnimationEnd"),animationiteration:oC("Animation","AnimationIteration"),animationstart:oC("Animation","AnimationStart"),transitionend:oC("Transition","TransitionEnd")},M4={},BJ={};Om&&(BJ=document.createElement("div").style,"AnimationEvent"in window||(delete Q1.animationend.animation,delete Q1.animationiteration.animation,delete Q1.animationstart.animation),"TransitionEvent"in window||delete Q1.transitionend.transition);function lL(n){if(M4[n])return M4[n];if(!Q1[n])return n;var e=Q1[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in BJ)return M4[n]=e[t];return n}var kJ=lL("animationend"),OJ=lL("animationiteration"),FJ=lL("animationstart"),NJ=lL("transitionend"),zJ=new Map,$G="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function xv(n,e){zJ.set(n,e),lx(e,[n])}for(var C4=0;C4<$G.length;C4++){var E4=$G[C4],Kde=E4.toLowerCase(),Jde=E4[0].toUpperCase()+E4.slice(1);xv(Kde,"on"+Jde)}xv(kJ,"onAnimationEnd");xv(OJ,"onAnimationIteration");xv(FJ,"onAnimationStart");xv("dblclick","onDoubleClick");xv("focusin","onFocus");xv("focusout","onBlur");xv(NJ,"onTransitionEnd");Nb("onMouseEnter",["mouseout","mouseover"]);Nb("onMouseLeave",["mouseout","mouseover"]);Nb("onPointerEnter",["pointerout","pointerover"]);Nb("onPointerLeave",["pointerout","pointerover"]);lx("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));lx("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));lx("onBeforeInput",["compositionend","keypress","textInput","paste"]);lx("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));lx("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));lx("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var cS="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Qde=new Set("cancel close invalid load scroll toggle".split(" ").concat(cS));function qG(n,e,t){var r=n.type||"unknown-event";n.currentTarget=t,Kfe(r,e,void 0,n),n.currentTarget=null}function UJ(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var r=n[t],i=r.event;r=r.listeners;e:{var s=void 0;if(e)for(var a=r.length-1;0<=a;a--){var l=r[a],o=l.instance,h=l.currentTarget;if(l=l.listener,o!==s&&i.isPropagationStopped())break e;qG(i,l,h),s=o}else for(a=0;a<r.length;a++){if(l=r[a],o=l.instance,h=l.currentTarget,l=l.listener,o!==s&&i.isPropagationStopped())break e;qG(i,l,h),s=o}}}if(eR)throw n=lO,eR=!1,lO=null,n}function po(n,e){var t=e[_O];t===void 0&&(t=e[_O]=new Set);var r=n+"__bubble";t.has(r)||(VJ(e,n,2,!1),t.add(r))}function I4(n,e,t){var r=0;e&&(r|=4),VJ(t,n,r,e)}var aC="_reactListening"+Math.random().toString(36).slice(2);function _A(n){if(!n[aC]){n[aC]=!0,qK.forEach(function(t){t!=="selectionchange"&&(Qde.has(t)||I4(t,!1,n),I4(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[aC]||(e[aC]=!0,I4("selectionchange",!1,e))}}function VJ(n,e,t,r){switch(AJ(e)){case 1:var i=dde;break;case 4:i=pde;break;default:i=_z}t=i.bind(null,e,t,n),i=void 0,!aO||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?n.addEventListener(e,t,{capture:!0,passive:i}):n.addEventListener(e,t,!0):i!==void 0?n.addEventListener(e,t,{passive:i}):n.addEventListener(e,t,!1)}function R4(n,e,t,r,i){var s=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var a=r.tag;if(a===3||a===4){var l=r.stateNode.containerInfo;if(l===i||l.nodeType===8&&l.parentNode===i)break;if(a===4)for(a=r.return;a!==null;){var o=a.tag;if((o===3||o===4)&&(o=a.stateNode.containerInfo,o===i||o.nodeType===8&&o.parentNode===i))return;a=a.return}for(;l!==null;){if(a=uy(l),a===null)return;if(o=a.tag,o===5||o===6){r=s=a;continue e}l=l.parentNode}}r=r.return}uJ(function(){var h=s,d=pz(t),m=[];e:{var _=zJ.get(n);if(_!==void 0){var y=xz,T=n;switch(n){case"keypress":if(SI(t)===0)break e;case"keydown":case"keyup":y=Ide;break;case"focusin":T="focus",y=S4;break;case"focusout":T="blur",y=S4;break;case"beforeblur":case"afterblur":y=S4;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":y=OG;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":y=vde;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":y=Lde;break;case kJ:case OJ:case FJ:y=xde;break;case NJ:y=Bde;break;case"scroll":y=mde;break;case"wheel":y=Ode;break;case"copy":case"cut":case"paste":y=wde;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":y=NG}var I=(e&4)!==0,C=!I&&n==="scroll",M=I?_!==null?_+"Capture":null:_;I=[];for(var B=h,k;B!==null;){k=B;var j=k.stateNode;if(k.tag===5&&j!==null&&(k=j,M!==null&&(j=fA(B,M),j!=null&&I.push(yA(B,j,k)))),C)break;B=B.return}0<I.length&&(_=new y(_,T,null,t,d),m.push({event:_,listeners:I}))}}if(!(e&7)){e:{if(_=n==="mouseover"||n==="pointerover",y=n==="mouseout"||n==="pointerout",_&&t!==sO&&(T=t.relatedTarget||t.fromElement)&&(uy(T)||T[Fm]))break e;if((y||_)&&(_=d.window===d?d:(_=d.ownerDocument)?_.defaultView||_.parentWindow:window,y?(T=t.relatedTarget||t.toElement,y=h,T=T?uy(T):null,T!==null&&(C=cx(T),T!==C||T.tag!==5&&T.tag!==6)&&(T=null)):(y=null,T=h),y!==T)){if(I=OG,j="onMouseLeave",M="onMouseEnter",B="mouse",(n==="pointerout"||n==="pointerover")&&(I=NG,j="onPointerLeave",M="onPointerEnter",B="pointer"),C=y==null?_:eb(y),k=T==null?_:eb(T),_=new I(j,B+"leave",y,t,d),_.target=C,_.relatedTarget=k,j=null,uy(d)===h&&(I=new I(M,B+"enter",T,t,d),I.target=k,I.relatedTarget=C,j=I),C=j,y&&T)t:{for(I=y,M=T,B=0,k=I;k;k=Jx(k))B++;for(k=0,j=M;j;j=Jx(j))k++;for(;0<B-k;)I=Jx(I),B--;for(;0<k-B;)M=Jx(M),k--;for(;B--;){if(I===M||M!==null&&I===M.alternate)break t;I=Jx(I),M=Jx(M)}I=null}else I=null;y!==null&&ZG(m,_,y,I,!1),T!==null&&C!==null&&ZG(m,C,T,I,!0)}}e:{if(_=h?eb(h):window,y=_.nodeName&&_.nodeName.toLowerCase(),y==="select"||y==="input"&&_.type==="file")var q=Hde;else if(VG(_))if(RJ)q=$de;else{q=Wde;var Z=jde}else(y=_.nodeName)&&y.toLowerCase()==="input"&&(_.type==="checkbox"||_.type==="radio")&&(q=Xde);if(q&&(q=q(n,h))){IJ(m,q,t,d);break e}Z&&Z(n,_,h),n==="focusout"&&(Z=_._wrapperState)&&Z.controlled&&_.type==="number"&&eO(_,"number",_.value)}switch(Z=h?eb(h):window,n){case"focusin":(VG(Z)||Z.contentEditable==="true")&&(J1=Z,fO=h,IS=null);break;case"focusout":IS=fO=J1=null;break;case"mousedown":dO=!0;break;case"contextmenu":case"mouseup":case"dragend":dO=!1,XG(m,t,d);break;case"selectionchange":if(Yde)break;case"keydown":case"keyup":XG(m,t,d)}var te;if(wz)e:{switch(n){case"compositionstart":var ie="onCompositionStart";break e;case"compositionend":ie="onCompositionEnd";break e;case"compositionupdate":ie="onCompositionUpdate";break e}ie=void 0}else K1?CJ(n,t)&&(ie="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(ie="onCompositionStart");ie&&(MJ&&t.locale!=="ko"&&(K1||ie!=="onCompositionStart"?ie==="onCompositionEnd"&&K1&&(te=TJ()):(k0=d,yz="value"in k0?k0.value:k0.textContent,K1=!0)),Z=sR(h,ie),0<Z.length&&(ie=new FG(ie,n,null,t,d),m.push({event:ie,listeners:Z}),te?ie.data=te:(te=EJ(t),te!==null&&(ie.data=te)))),(te=Nde?zde(n,t):Ude(n,t))&&(h=sR(h,"onBeforeInput"),0<h.length&&(d=new FG("onBeforeInput","beforeinput",null,t,d),m.push({event:d,listeners:h}),d.data=te))}UJ(m,e)})}function yA(n,e,t){return{instance:n,listener:e,currentTarget:t}}function sR(n,e){for(var t=e+"Capture",r=[];n!==null;){var i=n,s=i.stateNode;i.tag===5&&s!==null&&(i=s,s=fA(n,t),s!=null&&r.unshift(yA(n,s,i)),s=fA(n,e),s!=null&&r.push(yA(n,s,i))),n=n.return}return r}function Jx(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function ZG(n,e,t,r,i){for(var s=e._reactName,a=[];t!==null&&t!==r;){var l=t,o=l.alternate,h=l.stateNode;if(o!==null&&o===r)break;l.tag===5&&h!==null&&(l=h,i?(o=fA(t,s),o!=null&&a.unshift(yA(t,o,l))):i||(o=fA(t,s),o!=null&&a.push(yA(t,o,l)))),t=t.return}a.length!==0&&n.push({event:e,listeners:a})}var epe=/\r\n?/g,tpe=/\u0000|\uFFFD/g;function YG(n){return(typeof n=="string"?n:""+n).replace(epe,`
`).replace(tpe,"")}function lC(n,e,t){if(e=YG(e),YG(n)!==e&&t)throw Error(Zn(425))}function oR(){}var pO=null,mO=null;function gO(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var vO=typeof setTimeout=="function"?setTimeout:void 0,npe=typeof clearTimeout=="function"?clearTimeout:void 0,KG=typeof Promise=="function"?Promise:void 0,rpe=typeof queueMicrotask=="function"?queueMicrotask:typeof KG<"u"?function(n){return KG.resolve(null).then(n).catch(ipe)}:vO;function ipe(n){setTimeout(function(){throw n})}function P4(n,e){var t=e,r=0;do{var i=t.nextSibling;if(n.removeChild(t),i&&i.nodeType===8)if(t=i.data,t==="/$"){if(r===0){n.removeChild(i),mA(e);return}r--}else t!=="$"&&t!=="$?"&&t!=="$!"||r++;t=i}while(t);mA(e)}function q0(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function JG(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var lw=Math.random().toString(36).slice(2),$d="__reactFiber$"+lw,xA="__reactProps$"+lw,Fm="__reactContainer$"+lw,_O="__reactEvents$"+lw,spe="__reactListeners$"+lw,ope="__reactHandles$"+lw;function uy(n){var e=n[$d];if(e)return e;for(var t=n.parentNode;t;){if(e=t[Fm]||t[$d]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=JG(n);n!==null;){if(t=n[$d])return t;n=JG(n)}return e}n=t,t=n.parentNode}return null}function bT(n){return n=n[$d]||n[Fm],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function eb(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(Zn(33))}function cL(n){return n[xA]||null}var yO=[],tb=-1;function bv(n){return{current:n}}function go(n){0>tb||(n.current=yO[tb],yO[tb]=null,tb--)}function no(n,e){tb++,yO[tb]=n.current,n.current=e}var ov={},ql=bv(ov),ou=bv(!1),zy=ov;function zb(n,e){var t=n.type.contextTypes;if(!t)return ov;var r=n.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},s;for(s in t)i[s]=e[s];return r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=i),i}function au(n){return n=n.childContextTypes,n!=null}function aR(){go(ou),go(ql)}function QG(n,e,t){if(ql.current!==ov)throw Error(Zn(168));no(ql,e),no(ou,t)}function GJ(n,e,t){var r=n.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return t;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(Zn(108,jfe(n)||"Unknown",i));return Ho({},t,r)}function lR(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||ov,zy=ql.current,no(ql,n),no(ou,ou.current),!0}function eH(n,e,t){var r=n.stateNode;if(!r)throw Error(Zn(169));t?(n=GJ(n,e,zy),r.__reactInternalMemoizedMergedChildContext=n,go(ou),go(ql),no(ql,n)):go(ou),no(ou,t)}var ym=null,uL=!1,L4=!1;function HJ(n){ym===null?ym=[n]:ym.push(n)}function ape(n){uL=!0,HJ(n)}function wv(){if(!L4&&ym!==null){L4=!0;var n=0,e=Os;try{var t=ym;for(Os=1;n<t.length;n++){var r=t[n];do r=r(!0);while(r!==null)}ym=null,uL=!1}catch(i){throw ym!==null&&(ym=ym.slice(n+1)),pJ(mz,wv),i}finally{Os=e,L4=!1}}return null}var nb=[],rb=0,cR=null,uR=0,mh=[],gh=0,Uy=null,Am=1,Tm="";function ey(n,e){nb[rb++]=uR,nb[rb++]=cR,cR=n,uR=e}function jJ(n,e,t){mh[gh++]=Am,mh[gh++]=Tm,mh[gh++]=Uy,Uy=n;var r=Am;n=Tm;var i=32-Vf(r)-1;r&=~(1<<i),t+=1;var s=32-Vf(e)+i;if(30<s){var a=i-i%5;s=(r&(1<<a)-1).toString(32),r>>=a,i-=a,Am=1<<32-Vf(e)+i|t<<i|r,Tm=s+n}else Am=1<<s|t<<i|r,Tm=n}function Az(n){n.return!==null&&(ey(n,1),jJ(n,1,0))}function Tz(n){for(;n===cR;)cR=nb[--rb],nb[rb]=null,uR=nb[--rb],nb[rb]=null;for(;n===Uy;)Uy=mh[--gh],mh[gh]=null,Tm=mh[--gh],mh[gh]=null,Am=mh[--gh],mh[gh]=null}var Pu=null,Ru=null,To=!1,Bf=null;function WJ(n,e){var t=bh(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function tH(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,Pu=n,Ru=q0(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,Pu=n,Ru=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=Uy!==null?{id:Am,overflow:Tm}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=bh(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,Pu=n,Ru=null,!0):!1;default:return!1}}function xO(n){return(n.mode&1)!==0&&(n.flags&128)===0}function bO(n){if(To){var e=Ru;if(e){var t=e;if(!tH(n,e)){if(xO(n))throw Error(Zn(418));e=q0(t.nextSibling);var r=Pu;e&&tH(n,e)?WJ(r,t):(n.flags=n.flags&-4097|2,To=!1,Pu=n)}}else{if(xO(n))throw Error(Zn(418));n.flags=n.flags&-4097|2,To=!1,Pu=n}}}function nH(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;Pu=n}function cC(n){if(n!==Pu)return!1;if(!To)return nH(n),To=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!gO(n.type,n.memoizedProps)),e&&(e=Ru)){if(xO(n))throw XJ(),Error(Zn(418));for(;e;)WJ(n,e),e=q0(e.nextSibling)}if(nH(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(Zn(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){Ru=q0(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}Ru=null}}else Ru=Pu?q0(n.stateNode.nextSibling):null;return!0}function XJ(){for(var n=Ru;n;)n=q0(n.nextSibling)}function Ub(){Ru=Pu=null,To=!1}function Mz(n){Bf===null?Bf=[n]:Bf.push(n)}var lpe=Km.ReactCurrentBatchConfig;function Rf(n,e){if(n&&n.defaultProps){e=Ho({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}var hR=bv(null),fR=null,ib=null,Cz=null;function Ez(){Cz=ib=fR=null}function Iz(n){var e=hR.current;go(hR),n._currentValue=e}function wO(n,e,t){for(;n!==null;){var r=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),n===t)break;n=n.return}}function Sb(n,e){fR=n,Cz=ib=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(nu=!0),n.firstContext=null)}function Eh(n){var e=n._currentValue;if(Cz!==n)if(n={context:n,memoizedValue:e,next:null},ib===null){if(fR===null)throw Error(Zn(308));ib=n,fR.dependencies={lanes:0,firstContext:n}}else ib=ib.next=n;return e}var hy=null;function Rz(n){hy===null?hy=[n]:hy.push(n)}function $J(n,e,t,r){var i=e.interleaved;return i===null?(t.next=t,Rz(e)):(t.next=i.next,i.next=t),e.interleaved=t,Nm(n,r)}function Nm(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var E0=!1;function Pz(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function qJ(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function Pm(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function Z0(n,e,t){var r=n.updateQueue;if(r===null)return null;if(r=r.shared,ps&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,Nm(n,t)}return i=r.interleaved,i===null?(e.next=e,Rz(r)):(e.next=i.next,i.next=e),r.interleaved=e,Nm(n,t)}function AI(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,gz(n,t)}}function rH(n,e){var t=n.updateQueue,r=n.alternate;if(r!==null&&(r=r.updateQueue,t===r)){var i=null,s=null;if(t=t.firstBaseUpdate,t!==null){do{var a={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};s===null?i=s=a:s=s.next=a,t=t.next}while(t!==null);s===null?i=s=e:s=s.next=e}else i=s=e;t={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:r.shared,effects:r.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function dR(n,e,t,r){var i=n.updateQueue;E0=!1;var s=i.firstBaseUpdate,a=i.lastBaseUpdate,l=i.shared.pending;if(l!==null){i.shared.pending=null;var o=l,h=o.next;o.next=null,a===null?s=h:a.next=h,a=o;var d=n.alternate;d!==null&&(d=d.updateQueue,l=d.lastBaseUpdate,l!==a&&(l===null?d.firstBaseUpdate=h:l.next=h,d.lastBaseUpdate=o))}if(s!==null){var m=i.baseState;a=0,d=h=o=null,l=s;do{var _=l.lane,y=l.eventTime;if((r&_)===_){d!==null&&(d=d.next={eventTime:y,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var T=n,I=l;switch(_=e,y=t,I.tag){case 1:if(T=I.payload,typeof T=="function"){m=T.call(y,m,_);break e}m=T;break e;case 3:T.flags=T.flags&-65537|128;case 0:if(T=I.payload,_=typeof T=="function"?T.call(y,m,_):T,_==null)break e;m=Ho({},m,_);break e;case 2:E0=!0}}l.callback!==null&&l.lane!==0&&(n.flags|=64,_=i.effects,_===null?i.effects=[l]:_.push(l))}else y={eventTime:y,lane:_,tag:l.tag,payload:l.payload,callback:l.callback,next:null},d===null?(h=d=y,o=m):d=d.next=y,a|=_;if(l=l.next,l===null){if(l=i.shared.pending,l===null)break;_=l,l=_.next,_.next=null,i.lastBaseUpdate=_,i.shared.pending=null}}while(!0);if(d===null&&(o=m),i.baseState=o,i.firstBaseUpdate=h,i.lastBaseUpdate=d,e=i.shared.interleaved,e!==null){i=e;do a|=i.lane,i=i.next;while(i!==e)}else s===null&&(i.shared.lanes=0);Gy|=a,n.lanes=a,n.memoizedState=m}}function iH(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var r=n[e],i=r.callback;if(i!==null){if(r.callback=null,r=t,typeof i!="function")throw Error(Zn(191,i));i.call(r)}}}var ZJ=new $K.Component().refs;function SO(n,e,t,r){e=n.memoizedState,t=t(r,e),t=t==null?e:Ho({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var hL={isMounted:function(n){return(n=n._reactInternals)?cx(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var r=Tc(),i=K0(n),s=Pm(r,i);s.payload=e,t!=null&&(s.callback=t),e=Z0(n,s,i),e!==null&&(Gf(e,n,i,r),AI(e,n,i))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var r=Tc(),i=K0(n),s=Pm(r,i);s.tag=1,s.payload=e,t!=null&&(s.callback=t),e=Z0(n,s,i),e!==null&&(Gf(e,n,i,r),AI(e,n,i))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=Tc(),r=K0(n),i=Pm(t,r);i.tag=2,e!=null&&(i.callback=e),e=Z0(n,i,r),e!==null&&(Gf(e,n,r,t),AI(e,n,r))}};function sH(n,e,t,r,i,s,a){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(r,s,a):e.prototype&&e.prototype.isPureReactComponent?!vA(t,r)||!vA(i,s):!0}function YJ(n,e,t){var r=!1,i=ov,s=e.contextType;return typeof s=="object"&&s!==null?s=Eh(s):(i=au(e)?zy:ql.current,r=e.contextTypes,s=(r=r!=null)?zb(n,i):ov),e=new e(t,s),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=hL,n.stateNode=e,e._reactInternals=n,r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=i,n.__reactInternalMemoizedMaskedChildContext=s),e}function oH(n,e,t,r){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,r),e.state!==n&&hL.enqueueReplaceState(e,e.state,null)}function AO(n,e,t,r){var i=n.stateNode;i.props=t,i.state=n.memoizedState,i.refs=ZJ,Pz(n);var s=e.contextType;typeof s=="object"&&s!==null?i.context=Eh(s):(s=au(e)?zy:ql.current,i.context=zb(n,s)),i.state=n.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(SO(n,e,s,t),i.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&hL.enqueueReplaceState(i,i.state,null),dR(n,t,i,r),i.state=n.memoizedState),typeof i.componentDidMount=="function"&&(n.flags|=4194308)}function p2(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(Zn(309));var r=t.stateNode}if(!r)throw Error(Zn(147,n));var i=r,s=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(a){var l=i.refs;l===ZJ&&(l=i.refs={}),a===null?delete l[s]:l[s]=a},e._stringRef=s,e)}if(typeof n!="string")throw Error(Zn(284));if(!t._owner)throw Error(Zn(290,n))}return n}function uC(n,e){throw n=Object.prototype.toString.call(e),Error(Zn(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function aH(n){var e=n._init;return e(n._payload)}function KJ(n){function e(M,B){if(n){var k=M.deletions;k===null?(M.deletions=[B],M.flags|=16):k.push(B)}}function t(M,B){if(!n)return null;for(;B!==null;)e(M,B),B=B.sibling;return null}function r(M,B){for(M=new Map;B!==null;)B.key!==null?M.set(B.key,B):M.set(B.index,B),B=B.sibling;return M}function i(M,B){return M=J0(M,B),M.index=0,M.sibling=null,M}function s(M,B,k){return M.index=k,n?(k=M.alternate,k!==null?(k=k.index,k<B?(M.flags|=2,B):k):(M.flags|=2,B)):(M.flags|=1048576,B)}function a(M){return n&&M.alternate===null&&(M.flags|=2),M}function l(M,B,k,j){return B===null||B.tag!==6?(B=z4(k,M.mode,j),B.return=M,B):(B=i(B,k),B.return=M,B)}function o(M,B,k,j){var q=k.type;return q===Y1?d(M,B,k.props.children,j,k.key):B!==null&&(B.elementType===q||typeof q=="object"&&q!==null&&q.$$typeof===C0&&aH(q)===B.type)?(j=i(B,k.props),j.ref=p2(M,B,k),j.return=M,j):(j=RI(k.type,k.key,k.props,null,M.mode,j),j.ref=p2(M,B,k),j.return=M,j)}function h(M,B,k,j){return B===null||B.tag!==4||B.stateNode.containerInfo!==k.containerInfo||B.stateNode.implementation!==k.implementation?(B=U4(k,M.mode,j),B.return=M,B):(B=i(B,k.children||[]),B.return=M,B)}function d(M,B,k,j,q){return B===null||B.tag!==7?(B=My(k,M.mode,j,q),B.return=M,B):(B=i(B,k),B.return=M,B)}function m(M,B,k){if(typeof B=="string"&&B!==""||typeof B=="number")return B=z4(""+B,M.mode,k),B.return=M,B;if(typeof B=="object"&&B!==null){switch(B.$$typeof){case QM:return k=RI(B.type,B.key,B.props,null,M.mode,k),k.ref=p2(M,null,B),k.return=M,k;case Z1:return B=U4(B,M.mode,k),B.return=M,B;case C0:var j=B._init;return m(M,j(B._payload),k)}if(aS(B)||c2(B))return B=My(B,M.mode,k,null),B.return=M,B;uC(M,B)}return null}function _(M,B,k,j){var q=B!==null?B.key:null;if(typeof k=="string"&&k!==""||typeof k=="number")return q!==null?null:l(M,B,""+k,j);if(typeof k=="object"&&k!==null){switch(k.$$typeof){case QM:return k.key===q?o(M,B,k,j):null;case Z1:return k.key===q?h(M,B,k,j):null;case C0:return q=k._init,_(M,B,q(k._payload),j)}if(aS(k)||c2(k))return q!==null?null:d(M,B,k,j,null);uC(M,k)}return null}function y(M,B,k,j,q){if(typeof j=="string"&&j!==""||typeof j=="number")return M=M.get(k)||null,l(B,M,""+j,q);if(typeof j=="object"&&j!==null){switch(j.$$typeof){case QM:return M=M.get(j.key===null?k:j.key)||null,o(B,M,j,q);case Z1:return M=M.get(j.key===null?k:j.key)||null,h(B,M,j,q);case C0:var Z=j._init;return y(M,B,k,Z(j._payload),q)}if(aS(j)||c2(j))return M=M.get(k)||null,d(B,M,j,q,null);uC(B,j)}return null}function T(M,B,k,j){for(var q=null,Z=null,te=B,ie=B=0,se=null;te!==null&&ie<k.length;ie++){te.index>ie?(se=te,te=null):se=te.sibling;var ae=_(M,te,k[ie],j);if(ae===null){te===null&&(te=se);break}n&&te&&ae.alternate===null&&e(M,te),B=s(ae,B,ie),Z===null?q=ae:Z.sibling=ae,Z=ae,te=se}if(ie===k.length)return t(M,te),To&&ey(M,ie),q;if(te===null){for(;ie<k.length;ie++)te=m(M,k[ie],j),te!==null&&(B=s(te,B,ie),Z===null?q=te:Z.sibling=te,Z=te);return To&&ey(M,ie),q}for(te=r(M,te);ie<k.length;ie++)se=y(te,M,ie,k[ie],j),se!==null&&(n&&se.alternate!==null&&te.delete(se.key===null?ie:se.key),B=s(se,B,ie),Z===null?q=se:Z.sibling=se,Z=se);return n&&te.forEach(function(fe){return e(M,fe)}),To&&ey(M,ie),q}function I(M,B,k,j){var q=c2(k);if(typeof q!="function")throw Error(Zn(150));if(k=q.call(k),k==null)throw Error(Zn(151));for(var Z=q=null,te=B,ie=B=0,se=null,ae=k.next();te!==null&&!ae.done;ie++,ae=k.next()){te.index>ie?(se=te,te=null):se=te.sibling;var fe=_(M,te,ae.value,j);if(fe===null){te===null&&(te=se);break}n&&te&&fe.alternate===null&&e(M,te),B=s(fe,B,ie),Z===null?q=fe:Z.sibling=fe,Z=fe,te=se}if(ae.done)return t(M,te),To&&ey(M,ie),q;if(te===null){for(;!ae.done;ie++,ae=k.next())ae=m(M,ae.value,j),ae!==null&&(B=s(ae,B,ie),Z===null?q=ae:Z.sibling=ae,Z=ae);return To&&ey(M,ie),q}for(te=r(M,te);!ae.done;ie++,ae=k.next())ae=y(te,M,ie,ae.value,j),ae!==null&&(n&&ae.alternate!==null&&te.delete(ae.key===null?ie:ae.key),B=s(ae,B,ie),Z===null?q=ae:Z.sibling=ae,Z=ae);return n&&te.forEach(function(Se){return e(M,Se)}),To&&ey(M,ie),q}function C(M,B,k,j){if(typeof k=="object"&&k!==null&&k.type===Y1&&k.key===null&&(k=k.props.children),typeof k=="object"&&k!==null){switch(k.$$typeof){case QM:e:{for(var q=k.key,Z=B;Z!==null;){if(Z.key===q){if(q=k.type,q===Y1){if(Z.tag===7){t(M,Z.sibling),B=i(Z,k.props.children),B.return=M,M=B;break e}}else if(Z.elementType===q||typeof q=="object"&&q!==null&&q.$$typeof===C0&&aH(q)===Z.type){t(M,Z.sibling),B=i(Z,k.props),B.ref=p2(M,Z,k),B.return=M,M=B;break e}t(M,Z);break}else e(M,Z);Z=Z.sibling}k.type===Y1?(B=My(k.props.children,M.mode,j,k.key),B.return=M,M=B):(j=RI(k.type,k.key,k.props,null,M.mode,j),j.ref=p2(M,B,k),j.return=M,M=j)}return a(M);case Z1:e:{for(Z=k.key;B!==null;){if(B.key===Z)if(B.tag===4&&B.stateNode.containerInfo===k.containerInfo&&B.stateNode.implementation===k.implementation){t(M,B.sibling),B=i(B,k.children||[]),B.return=M,M=B;break e}else{t(M,B);break}else e(M,B);B=B.sibling}B=U4(k,M.mode,j),B.return=M,M=B}return a(M);case C0:return Z=k._init,C(M,B,Z(k._payload),j)}if(aS(k))return T(M,B,k,j);if(c2(k))return I(M,B,k,j);uC(M,k)}return typeof k=="string"&&k!==""||typeof k=="number"?(k=""+k,B!==null&&B.tag===6?(t(M,B.sibling),B=i(B,k),B.return=M,M=B):(t(M,B),B=z4(k,M.mode,j),B.return=M,M=B),a(M)):t(M,B)}return C}var Vb=KJ(!0),JJ=KJ(!1),wT={},np=bv(wT),bA=bv(wT),wA=bv(wT);function fy(n){if(n===wT)throw Error(Zn(174));return n}function Lz(n,e){switch(no(wA,e),no(bA,n),no(np,wT),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:nO(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=nO(e,n)}go(np),no(np,e)}function Gb(){go(np),go(bA),go(wA)}function QJ(n){fy(wA.current);var e=fy(np.current),t=nO(e,n.type);e!==t&&(no(bA,n),no(np,t))}function Dz(n){bA.current===n&&(go(np),go(bA))}var zo=bv(0);function pR(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var D4=[];function Bz(){for(var n=0;n<D4.length;n++)D4[n]._workInProgressVersionPrimary=null;D4.length=0}var TI=Km.ReactCurrentDispatcher,B4=Km.ReactCurrentBatchConfig,Vy=0,Vo=null,za=null,tl=null,mR=!1,RS=!1,SA=0,cpe=0;function Pl(){throw Error(Zn(321))}function kz(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!Wf(n[t],e[t]))return!1;return!0}function Oz(n,e,t,r,i,s){if(Vy=s,Vo=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,TI.current=n===null||n.memoizedState===null?dpe:ppe,n=t(r,i),RS){s=0;do{if(RS=!1,SA=0,25<=s)throw Error(Zn(301));s+=1,tl=za=null,e.updateQueue=null,TI.current=mpe,n=t(r,i)}while(RS)}if(TI.current=gR,e=za!==null&&za.next!==null,Vy=0,tl=za=Vo=null,mR=!1,e)throw Error(Zn(300));return n}function Fz(){var n=SA!==0;return SA=0,n}function Xd(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return tl===null?Vo.memoizedState=tl=n:tl=tl.next=n,tl}function Ih(){if(za===null){var n=Vo.alternate;n=n!==null?n.memoizedState:null}else n=za.next;var e=tl===null?Vo.memoizedState:tl.next;if(e!==null)tl=e,za=n;else{if(n===null)throw Error(Zn(310));za=n,n={memoizedState:za.memoizedState,baseState:za.baseState,baseQueue:za.baseQueue,queue:za.queue,next:null},tl===null?Vo.memoizedState=tl=n:tl=tl.next=n}return tl}function AA(n,e){return typeof e=="function"?e(n):e}function k4(n){var e=Ih(),t=e.queue;if(t===null)throw Error(Zn(311));t.lastRenderedReducer=n;var r=za,i=r.baseQueue,s=t.pending;if(s!==null){if(i!==null){var a=i.next;i.next=s.next,s.next=a}r.baseQueue=i=s,t.pending=null}if(i!==null){s=i.next,r=r.baseState;var l=a=null,o=null,h=s;do{var d=h.lane;if((Vy&d)===d)o!==null&&(o=o.next={lane:0,action:h.action,hasEagerState:h.hasEagerState,eagerState:h.eagerState,next:null}),r=h.hasEagerState?h.eagerState:n(r,h.action);else{var m={lane:d,action:h.action,hasEagerState:h.hasEagerState,eagerState:h.eagerState,next:null};o===null?(l=o=m,a=r):o=o.next=m,Vo.lanes|=d,Gy|=d}h=h.next}while(h!==null&&h!==s);o===null?a=r:o.next=l,Wf(r,e.memoizedState)||(nu=!0),e.memoizedState=r,e.baseState=a,e.baseQueue=o,t.lastRenderedState=r}if(n=t.interleaved,n!==null){i=n;do s=i.lane,Vo.lanes|=s,Gy|=s,i=i.next;while(i!==n)}else i===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function O4(n){var e=Ih(),t=e.queue;if(t===null)throw Error(Zn(311));t.lastRenderedReducer=n;var r=t.dispatch,i=t.pending,s=e.memoizedState;if(i!==null){t.pending=null;var a=i=i.next;do s=n(s,a.action),a=a.next;while(a!==i);Wf(s,e.memoizedState)||(nu=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),t.lastRenderedState=s}return[s,r]}function eQ(){}function tQ(n,e){var t=Vo,r=Ih(),i=e(),s=!Wf(r.memoizedState,i);if(s&&(r.memoizedState=i,nu=!0),r=r.queue,Nz(iQ.bind(null,t,r,n),[n]),r.getSnapshot!==e||s||tl!==null&&tl.memoizedState.tag&1){if(t.flags|=2048,TA(9,rQ.bind(null,t,r,i,e),void 0,null),nl===null)throw Error(Zn(349));Vy&30||nQ(t,e,i)}return i}function nQ(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=Vo.updateQueue,e===null?(e={lastEffect:null,stores:null},Vo.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function rQ(n,e,t,r){e.value=t,e.getSnapshot=r,sQ(e)&&oQ(n)}function iQ(n,e,t){return t(function(){sQ(e)&&oQ(n)})}function sQ(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!Wf(n,t)}catch{return!0}}function oQ(n){var e=Nm(n,1);e!==null&&Gf(e,n,1,-1)}function lH(n){var e=Xd();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:AA,lastRenderedState:n},e.queue=n,n=n.dispatch=fpe.bind(null,Vo,n),[e.memoizedState,n]}function TA(n,e,t,r){return n={tag:n,create:e,destroy:t,deps:r,next:null},e=Vo.updateQueue,e===null?(e={lastEffect:null,stores:null},Vo.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(r=t.next,t.next=n,n.next=r,e.lastEffect=n)),n}function aQ(){return Ih().memoizedState}function MI(n,e,t,r){var i=Xd();Vo.flags|=n,i.memoizedState=TA(1|e,t,void 0,r===void 0?null:r)}function fL(n,e,t,r){var i=Ih();r=r===void 0?null:r;var s=void 0;if(za!==null){var a=za.memoizedState;if(s=a.destroy,r!==null&&kz(r,a.deps)){i.memoizedState=TA(e,t,s,r);return}}Vo.flags|=n,i.memoizedState=TA(1|e,t,s,r)}function cH(n,e){return MI(8390656,8,n,e)}function Nz(n,e){return fL(2048,8,n,e)}function lQ(n,e){return fL(4,2,n,e)}function cQ(n,e){return fL(4,4,n,e)}function uQ(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function hQ(n,e,t){return t=t!=null?t.concat([n]):null,fL(4,4,uQ.bind(null,e,n),t)}function zz(){}function fQ(n,e){var t=Ih();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&kz(e,r[1])?r[0]:(t.memoizedState=[n,e],n)}function dQ(n,e){var t=Ih();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&kz(e,r[1])?r[0]:(n=n(),t.memoizedState=[n,e],n)}function pQ(n,e,t){return Vy&21?(Wf(t,e)||(t=vJ(),Vo.lanes|=t,Gy|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,nu=!0),n.memoizedState=t)}function upe(n,e){var t=Os;Os=t!==0&&4>t?t:4,n(!0);var r=B4.transition;B4.transition={};try{n(!1),e()}finally{Os=t,B4.transition=r}}function mQ(){return Ih().memoizedState}function hpe(n,e,t){var r=K0(n);if(t={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null},gQ(n))vQ(e,t);else if(t=$J(n,e,t,r),t!==null){var i=Tc();Gf(t,n,r,i),_Q(t,e,r)}}function fpe(n,e,t){var r=K0(n),i={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null};if(gQ(n))vQ(e,i);else{var s=n.alternate;if(n.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var a=e.lastRenderedState,l=s(a,t);if(i.hasEagerState=!0,i.eagerState=l,Wf(l,a)){var o=e.interleaved;o===null?(i.next=i,Rz(e)):(i.next=o.next,o.next=i),e.interleaved=i;return}}catch{}finally{}t=$J(n,e,i,r),t!==null&&(i=Tc(),Gf(t,n,r,i),_Q(t,e,r))}}function gQ(n){var e=n.alternate;return n===Vo||e!==null&&e===Vo}function vQ(n,e){RS=mR=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function _Q(n,e,t){if(t&4194240){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,gz(n,t)}}var gR={readContext:Eh,useCallback:Pl,useContext:Pl,useEffect:Pl,useImperativeHandle:Pl,useInsertionEffect:Pl,useLayoutEffect:Pl,useMemo:Pl,useReducer:Pl,useRef:Pl,useState:Pl,useDebugValue:Pl,useDeferredValue:Pl,useTransition:Pl,useMutableSource:Pl,useSyncExternalStore:Pl,useId:Pl,unstable_isNewReconciler:!1},dpe={readContext:Eh,useCallback:function(n,e){return Xd().memoizedState=[n,e===void 0?null:e],n},useContext:Eh,useEffect:cH,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,MI(4194308,4,uQ.bind(null,e,n),t)},useLayoutEffect:function(n,e){return MI(4194308,4,n,e)},useInsertionEffect:function(n,e){return MI(4,2,n,e)},useMemo:function(n,e){var t=Xd();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var r=Xd();return e=t!==void 0?t(e):e,r.memoizedState=r.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},r.queue=n,n=n.dispatch=hpe.bind(null,Vo,n),[r.memoizedState,n]},useRef:function(n){var e=Xd();return n={current:n},e.memoizedState=n},useState:lH,useDebugValue:zz,useDeferredValue:function(n){return Xd().memoizedState=n},useTransition:function(){var n=lH(!1),e=n[0];return n=upe.bind(null,n[1]),Xd().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var r=Vo,i=Xd();if(To){if(t===void 0)throw Error(Zn(407));t=t()}else{if(t=e(),nl===null)throw Error(Zn(349));Vy&30||nQ(r,e,t)}i.memoizedState=t;var s={value:t,getSnapshot:e};return i.queue=s,cH(iQ.bind(null,r,s,n),[n]),r.flags|=2048,TA(9,rQ.bind(null,r,s,t,e),void 0,null),t},useId:function(){var n=Xd(),e=nl.identifierPrefix;if(To){var t=Tm,r=Am;t=(r&~(1<<32-Vf(r)-1)).toString(32)+t,e=":"+e+"R"+t,t=SA++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=cpe++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},ppe={readContext:Eh,useCallback:fQ,useContext:Eh,useEffect:Nz,useImperativeHandle:hQ,useInsertionEffect:lQ,useLayoutEffect:cQ,useMemo:dQ,useReducer:k4,useRef:aQ,useState:function(){return k4(AA)},useDebugValue:zz,useDeferredValue:function(n){var e=Ih();return pQ(e,za.memoizedState,n)},useTransition:function(){var n=k4(AA)[0],e=Ih().memoizedState;return[n,e]},useMutableSource:eQ,useSyncExternalStore:tQ,useId:mQ,unstable_isNewReconciler:!1},mpe={readContext:Eh,useCallback:fQ,useContext:Eh,useEffect:Nz,useImperativeHandle:hQ,useInsertionEffect:lQ,useLayoutEffect:cQ,useMemo:dQ,useReducer:O4,useRef:aQ,useState:function(){return O4(AA)},useDebugValue:zz,useDeferredValue:function(n){var e=Ih();return za===null?e.memoizedState=n:pQ(e,za.memoizedState,n)},useTransition:function(){var n=O4(AA)[0],e=Ih().memoizedState;return[n,e]},useMutableSource:eQ,useSyncExternalStore:tQ,useId:mQ,unstable_isNewReconciler:!1};function Hb(n,e){try{var t="",r=e;do t+=Hfe(r),r=r.return;while(r);var i=t}catch(s){i=`
Error generating stack: `+s.message+`
`+s.stack}return{value:n,source:e,stack:i,digest:null}}function F4(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function TO(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var gpe=typeof WeakMap=="function"?WeakMap:Map;function yQ(n,e,t){t=Pm(-1,t),t.tag=3,t.payload={element:null};var r=e.value;return t.callback=function(){_R||(_R=!0,kO=r),TO(n,e)},t}function xQ(n,e,t){t=Pm(-1,t),t.tag=3;var r=n.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;t.payload=function(){return r(i)},t.callback=function(){TO(n,e)}}var s=n.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(t.callback=function(){TO(n,e),typeof r!="function"&&(Y0===null?Y0=new Set([this]):Y0.add(this));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),t}function uH(n,e,t){var r=n.pingCache;if(r===null){r=n.pingCache=new gpe;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(t)||(i.add(t),n=Rpe.bind(null,n,e,t),e.then(n,n))}function hH(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function fH(n,e,t,r,i){return n.mode&1?(n.flags|=65536,n.lanes=i,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=Pm(-1,1),e.tag=2,Z0(t,e,1))),t.lanes|=1),n)}var vpe=Km.ReactCurrentOwner,nu=!1;function _c(n,e,t,r){e.child=n===null?JJ(e,null,t,r):Vb(e,n.child,t,r)}function dH(n,e,t,r,i){t=t.render;var s=e.ref;return Sb(e,i),r=Oz(n,e,t,r,s,i),t=Fz(),n!==null&&!nu?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,zm(n,e,i)):(To&&t&&Az(e),e.flags|=1,_c(n,e,r,i),e.child)}function pH(n,e,t,r,i){if(n===null){var s=t.type;return typeof s=="function"&&!$z(s)&&s.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=s,bQ(n,e,s,r,i)):(n=RI(t.type,null,r,e,e.mode,i),n.ref=e.ref,n.return=e,e.child=n)}if(s=n.child,!(n.lanes&i)){var a=s.memoizedProps;if(t=t.compare,t=t!==null?t:vA,t(a,r)&&n.ref===e.ref)return zm(n,e,i)}return e.flags|=1,n=J0(s,r),n.ref=e.ref,n.return=e,e.child=n}function bQ(n,e,t,r,i){if(n!==null){var s=n.memoizedProps;if(vA(s,r)&&n.ref===e.ref)if(nu=!1,e.pendingProps=r=s,(n.lanes&i)!==0)n.flags&131072&&(nu=!0);else return e.lanes=n.lanes,zm(n,e,i)}return MO(n,e,t,r,i)}function wQ(n,e,t){var r=e.pendingProps,i=r.children,s=n!==null?n.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},no(ob,Cu),Cu|=t;else{if(!(t&1073741824))return n=s!==null?s.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,no(ob,Cu),Cu|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=s!==null?s.baseLanes:t,no(ob,Cu),Cu|=r}else s!==null?(r=s.baseLanes|t,e.memoizedState=null):r=t,no(ob,Cu),Cu|=r;return _c(n,e,i,t),e.child}function SQ(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function MO(n,e,t,r,i){var s=au(t)?zy:ql.current;return s=zb(e,s),Sb(e,i),t=Oz(n,e,t,r,s,i),r=Fz(),n!==null&&!nu?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,zm(n,e,i)):(To&&r&&Az(e),e.flags|=1,_c(n,e,t,i),e.child)}function mH(n,e,t,r,i){if(au(t)){var s=!0;lR(e)}else s=!1;if(Sb(e,i),e.stateNode===null)CI(n,e),YJ(e,t,r),AO(e,t,r,i),r=!0;else if(n===null){var a=e.stateNode,l=e.memoizedProps;a.props=l;var o=a.context,h=t.contextType;typeof h=="object"&&h!==null?h=Eh(h):(h=au(t)?zy:ql.current,h=zb(e,h));var d=t.getDerivedStateFromProps,m=typeof d=="function"||typeof a.getSnapshotBeforeUpdate=="function";m||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(l!==r||o!==h)&&oH(e,a,r,h),E0=!1;var _=e.memoizedState;a.state=_,dR(e,r,a,i),o=e.memoizedState,l!==r||_!==o||ou.current||E0?(typeof d=="function"&&(SO(e,t,d,r),o=e.memoizedState),(l=E0||sH(e,t,l,r,_,o,h))?(m||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=o),a.props=r,a.state=o,a.context=h,r=l):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{a=e.stateNode,qJ(n,e),l=e.memoizedProps,h=e.type===e.elementType?l:Rf(e.type,l),a.props=h,m=e.pendingProps,_=a.context,o=t.contextType,typeof o=="object"&&o!==null?o=Eh(o):(o=au(t)?zy:ql.current,o=zb(e,o));var y=t.getDerivedStateFromProps;(d=typeof y=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(l!==m||_!==o)&&oH(e,a,r,o),E0=!1,_=e.memoizedState,a.state=_,dR(e,r,a,i);var T=e.memoizedState;l!==m||_!==T||ou.current||E0?(typeof y=="function"&&(SO(e,t,y,r),T=e.memoizedState),(h=E0||sH(e,t,h,r,_,T,o)||!1)?(d||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(r,T,o),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(r,T,o)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||l===n.memoizedProps&&_===n.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||l===n.memoizedProps&&_===n.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=T),a.props=r,a.state=T,a.context=o,r=h):(typeof a.componentDidUpdate!="function"||l===n.memoizedProps&&_===n.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||l===n.memoizedProps&&_===n.memoizedState||(e.flags|=1024),r=!1)}return CO(n,e,t,r,s,i)}function CO(n,e,t,r,i,s){SQ(n,e);var a=(e.flags&128)!==0;if(!r&&!a)return i&&eH(e,t,!1),zm(n,e,s);r=e.stateNode,vpe.current=e;var l=a&&typeof t.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,n!==null&&a?(e.child=Vb(e,n.child,null,s),e.child=Vb(e,null,l,s)):_c(n,e,l,s),e.memoizedState=r.state,i&&eH(e,t,!0),e.child}function AQ(n){var e=n.stateNode;e.pendingContext?QG(n,e.pendingContext,e.pendingContext!==e.context):e.context&&QG(n,e.context,!1),Lz(n,e.containerInfo)}function gH(n,e,t,r,i){return Ub(),Mz(i),e.flags|=256,_c(n,e,t,r),e.child}var EO={dehydrated:null,treeContext:null,retryLane:0};function IO(n){return{baseLanes:n,cachePool:null,transitions:null}}function TQ(n,e,t){var r=e.pendingProps,i=zo.current,s=!1,a=(e.flags&128)!==0,l;if((l=a)||(l=n!==null&&n.memoizedState===null?!1:(i&2)!==0),l?(s=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(i|=1),no(zo,i&1),n===null)return bO(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(a=r.children,n=r.fallback,s?(r=e.mode,s=e.child,a={mode:"hidden",children:a},!(r&1)&&s!==null?(s.childLanes=0,s.pendingProps=a):s=mL(a,r,0,null),n=My(n,r,t,null),s.return=e,n.return=e,s.sibling=n,e.child=s,e.child.memoizedState=IO(t),e.memoizedState=EO,n):Uz(e,a));if(i=n.memoizedState,i!==null&&(l=i.dehydrated,l!==null))return _pe(n,e,a,r,l,i,t);if(s){s=r.fallback,a=e.mode,i=n.child,l=i.sibling;var o={mode:"hidden",children:r.children};return!(a&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=o,e.deletions=null):(r=J0(i,o),r.subtreeFlags=i.subtreeFlags&14680064),l!==null?s=J0(l,s):(s=My(s,a,t,null),s.flags|=2),s.return=e,r.return=e,r.sibling=s,e.child=r,r=s,s=e.child,a=n.child.memoizedState,a=a===null?IO(t):{baseLanes:a.baseLanes|t,cachePool:null,transitions:a.transitions},s.memoizedState=a,s.childLanes=n.childLanes&~t,e.memoizedState=EO,r}return s=n.child,n=s.sibling,r=J0(s,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=t),r.return=e,r.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=r,e.memoizedState=null,r}function Uz(n,e){return e=mL({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function hC(n,e,t,r){return r!==null&&Mz(r),Vb(e,n.child,null,t),n=Uz(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function _pe(n,e,t,r,i,s,a){if(t)return e.flags&256?(e.flags&=-257,r=F4(Error(Zn(422))),hC(n,e,a,r)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(s=r.fallback,i=e.mode,r=mL({mode:"visible",children:r.children},i,0,null),s=My(s,i,a,null),s.flags|=2,r.return=e,s.return=e,r.sibling=s,e.child=r,e.mode&1&&Vb(e,n.child,null,a),e.child.memoizedState=IO(a),e.memoizedState=EO,s);if(!(e.mode&1))return hC(n,e,a,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var l=r.dgst;return r=l,s=Error(Zn(419)),r=F4(s,r,void 0),hC(n,e,a,r)}if(l=(a&n.childLanes)!==0,nu||l){if(r=nl,r!==null){switch(a&-a){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|a)?0:i,i!==0&&i!==s.retryLane&&(s.retryLane=i,Nm(n,i),Gf(r,n,i,-1))}return Xz(),r=F4(Error(Zn(421))),hC(n,e,a,r)}return i.data==="$?"?(e.flags|=128,e.child=n.child,e=Ppe.bind(null,n),i._reactRetry=e,null):(n=s.treeContext,Ru=q0(i.nextSibling),Pu=e,To=!0,Bf=null,n!==null&&(mh[gh++]=Am,mh[gh++]=Tm,mh[gh++]=Uy,Am=n.id,Tm=n.overflow,Uy=e),e=Uz(e,r.children),e.flags|=4096,e)}function vH(n,e,t){n.lanes|=e;var r=n.alternate;r!==null&&(r.lanes|=e),wO(n.return,e,t)}function N4(n,e,t,r,i){var s=n.memoizedState;s===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:t,tailMode:i}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=t,s.tailMode=i)}function MQ(n,e,t){var r=e.pendingProps,i=r.revealOrder,s=r.tail;if(_c(n,e,r.children,t),r=zo.current,r&2)r=r&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&vH(n,t,e);else if(n.tag===19)vH(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}r&=1}if(no(zo,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(t=e.child,i=null;t!==null;)n=t.alternate,n!==null&&pR(n)===null&&(i=t),t=t.sibling;t=i,t===null?(i=e.child,e.child=null):(i=t.sibling,t.sibling=null),N4(e,!1,i,t,s);break;case"backwards":for(t=null,i=e.child,e.child=null;i!==null;){if(n=i.alternate,n!==null&&pR(n)===null){e.child=i;break}n=i.sibling,i.sibling=t,t=i,i=n}N4(e,!0,t,null,s);break;case"together":N4(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function CI(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function zm(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),Gy|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(Zn(153));if(e.child!==null){for(n=e.child,t=J0(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=J0(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function ype(n,e,t){switch(e.tag){case 3:AQ(e),Ub();break;case 5:QJ(e);break;case 1:au(e.type)&&lR(e);break;case 4:Lz(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;no(hR,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(no(zo,zo.current&1),e.flags|=128,null):t&e.child.childLanes?TQ(n,e,t):(no(zo,zo.current&1),n=zm(n,e,t),n!==null?n.sibling:null);no(zo,zo.current&1);break;case 19:if(r=(t&e.childLanes)!==0,n.flags&128){if(r)return MQ(n,e,t);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),no(zo,zo.current),r)break;return null;case 22:case 23:return e.lanes=0,wQ(n,e,t)}return zm(n,e,t)}var CQ,RO,EQ,IQ;CQ=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};RO=function(){};EQ=function(n,e,t,r){var i=n.memoizedProps;if(i!==r){n=e.stateNode,fy(np.current);var s=null;switch(t){case"input":i=Jk(n,i),r=Jk(n,r),s=[];break;case"select":i=Ho({},i,{value:void 0}),r=Ho({},r,{value:void 0}),s=[];break;case"textarea":i=tO(n,i),r=tO(n,r),s=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(n.onclick=oR)}rO(t,r);var a;t=null;for(h in i)if(!r.hasOwnProperty(h)&&i.hasOwnProperty(h)&&i[h]!=null)if(h==="style"){var l=i[h];for(a in l)l.hasOwnProperty(a)&&(t||(t={}),t[a]="")}else h!=="dangerouslySetInnerHTML"&&h!=="children"&&h!=="suppressContentEditableWarning"&&h!=="suppressHydrationWarning"&&h!=="autoFocus"&&(uA.hasOwnProperty(h)?s||(s=[]):(s=s||[]).push(h,null));for(h in r){var o=r[h];if(l=i!=null?i[h]:void 0,r.hasOwnProperty(h)&&o!==l&&(o!=null||l!=null))if(h==="style")if(l){for(a in l)!l.hasOwnProperty(a)||o&&o.hasOwnProperty(a)||(t||(t={}),t[a]="");for(a in o)o.hasOwnProperty(a)&&l[a]!==o[a]&&(t||(t={}),t[a]=o[a])}else t||(s||(s=[]),s.push(h,t)),t=o;else h==="dangerouslySetInnerHTML"?(o=o?o.__html:void 0,l=l?l.__html:void 0,o!=null&&l!==o&&(s=s||[]).push(h,o)):h==="children"?typeof o!="string"&&typeof o!="number"||(s=s||[]).push(h,""+o):h!=="suppressContentEditableWarning"&&h!=="suppressHydrationWarning"&&(uA.hasOwnProperty(h)?(o!=null&&h==="onScroll"&&po("scroll",n),s||l===o||(s=[])):(s=s||[]).push(h,o))}t&&(s=s||[]).push("style",t);var h=s;(e.updateQueue=h)&&(e.flags|=4)}};IQ=function(n,e,t,r){t!==r&&(e.flags|=4)};function m2(n,e){if(!To)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:r.sibling=null}}function Ll(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,r=0;if(e)for(var i=n.child;i!==null;)t|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=n,i=i.sibling;else for(i=n.child;i!==null;)t|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=n,i=i.sibling;return n.subtreeFlags|=r,n.childLanes=t,e}function xpe(n,e,t){var r=e.pendingProps;switch(Tz(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ll(e),null;case 1:return au(e.type)&&aR(),Ll(e),null;case 3:return r=e.stateNode,Gb(),go(ou),go(ql),Bz(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(n===null||n.child===null)&&(cC(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Bf!==null&&(NO(Bf),Bf=null))),RO(n,e),Ll(e),null;case 5:Dz(e);var i=fy(wA.current);if(t=e.type,n!==null&&e.stateNode!=null)EQ(n,e,t,r,i),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(Zn(166));return Ll(e),null}if(n=fy(np.current),cC(e)){r=e.stateNode,t=e.type;var s=e.memoizedProps;switch(r[$d]=e,r[xA]=s,n=(e.mode&1)!==0,t){case"dialog":po("cancel",r),po("close",r);break;case"iframe":case"object":case"embed":po("load",r);break;case"video":case"audio":for(i=0;i<cS.length;i++)po(cS[i],r);break;case"source":po("error",r);break;case"img":case"image":case"link":po("error",r),po("load",r);break;case"details":po("toggle",r);break;case"input":MG(r,s),po("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},po("invalid",r);break;case"textarea":EG(r,s),po("invalid",r)}rO(t,s),i=null;for(var a in s)if(s.hasOwnProperty(a)){var l=s[a];a==="children"?typeof l=="string"?r.textContent!==l&&(s.suppressHydrationWarning!==!0&&lC(r.textContent,l,n),i=["children",l]):typeof l=="number"&&r.textContent!==""+l&&(s.suppressHydrationWarning!==!0&&lC(r.textContent,l,n),i=["children",""+l]):uA.hasOwnProperty(a)&&l!=null&&a==="onScroll"&&po("scroll",r)}switch(t){case"input":eC(r),CG(r,s,!0);break;case"textarea":eC(r),IG(r);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(r.onclick=oR)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{a=i.nodeType===9?i:i.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=nJ(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=a.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof r.is=="string"?n=a.createElement(t,{is:r.is}):(n=a.createElement(t),t==="select"&&(a=n,r.multiple?a.multiple=!0:r.size&&(a.size=r.size))):n=a.createElementNS(n,t),n[$d]=e,n[xA]=r,CQ(n,e,!1,!1),e.stateNode=n;e:{switch(a=iO(t,r),t){case"dialog":po("cancel",n),po("close",n),i=r;break;case"iframe":case"object":case"embed":po("load",n),i=r;break;case"video":case"audio":for(i=0;i<cS.length;i++)po(cS[i],n);i=r;break;case"source":po("error",n),i=r;break;case"img":case"image":case"link":po("error",n),po("load",n),i=r;break;case"details":po("toggle",n),i=r;break;case"input":MG(n,r),i=Jk(n,r),po("invalid",n);break;case"option":i=r;break;case"select":n._wrapperState={wasMultiple:!!r.multiple},i=Ho({},r,{value:void 0}),po("invalid",n);break;case"textarea":EG(n,r),i=tO(n,r),po("invalid",n);break;default:i=r}rO(t,i),l=i;for(s in l)if(l.hasOwnProperty(s)){var o=l[s];s==="style"?sJ(n,o):s==="dangerouslySetInnerHTML"?(o=o?o.__html:void 0,o!=null&&rJ(n,o)):s==="children"?typeof o=="string"?(t!=="textarea"||o!=="")&&hA(n,o):typeof o=="number"&&hA(n,""+o):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(uA.hasOwnProperty(s)?o!=null&&s==="onScroll"&&po("scroll",n):o!=null&&uz(n,s,o,a))}switch(t){case"input":eC(n),CG(n,r,!1);break;case"textarea":eC(n),IG(n);break;case"option":r.value!=null&&n.setAttribute("value",""+sv(r.value));break;case"select":n.multiple=!!r.multiple,s=r.value,s!=null?yb(n,!!r.multiple,s,!1):r.defaultValue!=null&&yb(n,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(n.onclick=oR)}switch(t){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Ll(e),null;case 6:if(n&&e.stateNode!=null)IQ(n,e,n.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(Zn(166));if(t=fy(wA.current),fy(np.current),cC(e)){if(r=e.stateNode,t=e.memoizedProps,r[$d]=e,(s=r.nodeValue!==t)&&(n=Pu,n!==null))switch(n.tag){case 3:lC(r.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&lC(r.nodeValue,t,(n.mode&1)!==0)}s&&(e.flags|=4)}else r=(t.nodeType===9?t:t.ownerDocument).createTextNode(r),r[$d]=e,e.stateNode=r}return Ll(e),null;case 13:if(go(zo),r=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(To&&Ru!==null&&e.mode&1&&!(e.flags&128))XJ(),Ub(),e.flags|=98560,s=!1;else if(s=cC(e),r!==null&&r.dehydrated!==null){if(n===null){if(!s)throw Error(Zn(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(Zn(317));s[$d]=e}else Ub(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Ll(e),s=!1}else Bf!==null&&(NO(Bf),Bf=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(r=r!==null,r!==(n!==null&&n.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(n===null||zo.current&1?Va===0&&(Va=3):Xz())),e.updateQueue!==null&&(e.flags|=4),Ll(e),null);case 4:return Gb(),RO(n,e),n===null&&_A(e.stateNode.containerInfo),Ll(e),null;case 10:return Iz(e.type._context),Ll(e),null;case 17:return au(e.type)&&aR(),Ll(e),null;case 19:if(go(zo),s=e.memoizedState,s===null)return Ll(e),null;if(r=(e.flags&128)!==0,a=s.rendering,a===null)if(r)m2(s,!1);else{if(Va!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(a=pR(n),a!==null){for(e.flags|=128,m2(s,!1),r=a.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=t,t=e.child;t!==null;)s=t,n=r,s.flags&=14680066,a=s.alternate,a===null?(s.childLanes=0,s.lanes=n,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=a.childLanes,s.lanes=a.lanes,s.child=a.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=a.memoizedProps,s.memoizedState=a.memoizedState,s.updateQueue=a.updateQueue,s.type=a.type,n=a.dependencies,s.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return no(zo,zo.current&1|2),e.child}n=n.sibling}s.tail!==null&&fa()>jb&&(e.flags|=128,r=!0,m2(s,!1),e.lanes=4194304)}else{if(!r)if(n=pR(a),n!==null){if(e.flags|=128,r=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),m2(s,!0),s.tail===null&&s.tailMode==="hidden"&&!a.alternate&&!To)return Ll(e),null}else 2*fa()-s.renderingStartTime>jb&&t!==1073741824&&(e.flags|=128,r=!0,m2(s,!1),e.lanes=4194304);s.isBackwards?(a.sibling=e.child,e.child=a):(t=s.last,t!==null?t.sibling=a:e.child=a,s.last=a)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=fa(),e.sibling=null,t=zo.current,no(zo,r?t&1|2:t&1),e):(Ll(e),null);case 22:case 23:return Wz(),r=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Cu&1073741824&&(Ll(e),e.subtreeFlags&6&&(e.flags|=8192)):Ll(e),null;case 24:return null;case 25:return null}throw Error(Zn(156,e.tag))}function bpe(n,e){switch(Tz(e),e.tag){case 1:return au(e.type)&&aR(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return Gb(),go(ou),go(ql),Bz(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return Dz(e),null;case 13:if(go(zo),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(Zn(340));Ub()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return go(zo),null;case 4:return Gb(),null;case 10:return Iz(e.type._context),null;case 22:case 23:return Wz(),null;case 24:return null;default:return null}}var fC=!1,Vl=!1,wpe=typeof WeakSet=="function"?WeakSet:Set,Cr=null;function sb(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(r){Jo(n,e,r)}else t.current=null}function PO(n,e,t){try{t()}catch(r){Jo(n,e,r)}}var _H=!1;function Spe(n,e){if(pO=rR,n=DJ(),Sz(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var r=t.getSelection&&t.getSelection();if(r&&r.rangeCount!==0){t=r.anchorNode;var i=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{t.nodeType,s.nodeType}catch{t=null;break e}var a=0,l=-1,o=-1,h=0,d=0,m=n,_=null;t:for(;;){for(var y;m!==t||i!==0&&m.nodeType!==3||(l=a+i),m!==s||r!==0&&m.nodeType!==3||(o=a+r),m.nodeType===3&&(a+=m.nodeValue.length),(y=m.firstChild)!==null;)_=m,m=y;for(;;){if(m===n)break t;if(_===t&&++h===i&&(l=a),_===s&&++d===r&&(o=a),(y=m.nextSibling)!==null)break;m=_,_=m.parentNode}m=y}t=l===-1||o===-1?null:{start:l,end:o}}else t=null}t=t||{start:0,end:0}}else t=null;for(mO={focusedElem:n,selectionRange:t},rR=!1,Cr=e;Cr!==null;)if(e=Cr,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,Cr=n;else for(;Cr!==null;){e=Cr;try{var T=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(T!==null){var I=T.memoizedProps,C=T.memoizedState,M=e.stateNode,B=M.getSnapshotBeforeUpdate(e.elementType===e.type?I:Rf(e.type,I),C);M.__reactInternalSnapshotBeforeUpdate=B}break;case 3:var k=e.stateNode.containerInfo;k.nodeType===1?k.textContent="":k.nodeType===9&&k.documentElement&&k.removeChild(k.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Zn(163))}}catch(j){Jo(e,e.return,j)}if(n=e.sibling,n!==null){n.return=e.return,Cr=n;break}Cr=e.return}return T=_H,_H=!1,T}function PS(n,e,t){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&n)===n){var s=i.destroy;i.destroy=void 0,s!==void 0&&PO(e,t,s)}i=i.next}while(i!==r)}}function dL(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var r=t.create;t.destroy=r()}t=t.next}while(t!==e)}}function LO(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function RQ(n){var e=n.alternate;e!==null&&(n.alternate=null,RQ(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[$d],delete e[xA],delete e[_O],delete e[spe],delete e[ope])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function PQ(n){return n.tag===5||n.tag===3||n.tag===4}function yH(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||PQ(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function DO(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=oR));else if(r!==4&&(n=n.child,n!==null))for(DO(n,e,t),n=n.sibling;n!==null;)DO(n,e,t),n=n.sibling}function BO(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(r!==4&&(n=n.child,n!==null))for(BO(n,e,t),n=n.sibling;n!==null;)BO(n,e,t),n=n.sibling}var gl=null,Df=!1;function r0(n,e,t){for(t=t.child;t!==null;)LQ(n,e,t),t=t.sibling}function LQ(n,e,t){if(tp&&typeof tp.onCommitFiberUnmount=="function")try{tp.onCommitFiberUnmount(sL,t)}catch{}switch(t.tag){case 5:Vl||sb(t,e);case 6:var r=gl,i=Df;gl=null,r0(n,e,t),gl=r,Df=i,gl!==null&&(Df?(n=gl,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):gl.removeChild(t.stateNode));break;case 18:gl!==null&&(Df?(n=gl,t=t.stateNode,n.nodeType===8?P4(n.parentNode,t):n.nodeType===1&&P4(n,t),mA(n)):P4(gl,t.stateNode));break;case 4:r=gl,i=Df,gl=t.stateNode.containerInfo,Df=!0,r0(n,e,t),gl=r,Df=i;break;case 0:case 11:case 14:case 15:if(!Vl&&(r=t.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var s=i,a=s.destroy;s=s.tag,a!==void 0&&(s&2||s&4)&&PO(t,e,a),i=i.next}while(i!==r)}r0(n,e,t);break;case 1:if(!Vl&&(sb(t,e),r=t.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=t.memoizedProps,r.state=t.memoizedState,r.componentWillUnmount()}catch(l){Jo(t,e,l)}r0(n,e,t);break;case 21:r0(n,e,t);break;case 22:t.mode&1?(Vl=(r=Vl)||t.memoizedState!==null,r0(n,e,t),Vl=r):r0(n,e,t);break;default:r0(n,e,t)}}function xH(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new wpe),e.forEach(function(r){var i=Lpe.bind(null,n,r);t.has(r)||(t.add(r),r.then(i,i))})}}function bf(n,e){var t=e.deletions;if(t!==null)for(var r=0;r<t.length;r++){var i=t[r];try{var s=n,a=e,l=a;e:for(;l!==null;){switch(l.tag){case 5:gl=l.stateNode,Df=!1;break e;case 3:gl=l.stateNode.containerInfo,Df=!0;break e;case 4:gl=l.stateNode.containerInfo,Df=!0;break e}l=l.return}if(gl===null)throw Error(Zn(160));LQ(s,a,i),gl=null,Df=!1;var o=i.alternate;o!==null&&(o.return=null),i.return=null}catch(h){Jo(i,e,h)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)DQ(e,n),e=e.sibling}function DQ(n,e){var t=n.alternate,r=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(bf(e,n),Nd(n),r&4){try{PS(3,n,n.return),dL(3,n)}catch(I){Jo(n,n.return,I)}try{PS(5,n,n.return)}catch(I){Jo(n,n.return,I)}}break;case 1:bf(e,n),Nd(n),r&512&&t!==null&&sb(t,t.return);break;case 5:if(bf(e,n),Nd(n),r&512&&t!==null&&sb(t,t.return),n.flags&32){var i=n.stateNode;try{hA(i,"")}catch(I){Jo(n,n.return,I)}}if(r&4&&(i=n.stateNode,i!=null)){var s=n.memoizedProps,a=t!==null?t.memoizedProps:s,l=n.type,o=n.updateQueue;if(n.updateQueue=null,o!==null)try{l==="input"&&s.type==="radio"&&s.name!=null&&eJ(i,s),iO(l,a);var h=iO(l,s);for(a=0;a<o.length;a+=2){var d=o[a],m=o[a+1];d==="style"?sJ(i,m):d==="dangerouslySetInnerHTML"?rJ(i,m):d==="children"?hA(i,m):uz(i,d,m,h)}switch(l){case"input":Qk(i,s);break;case"textarea":tJ(i,s);break;case"select":var _=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var y=s.value;y!=null?yb(i,!!s.multiple,y,!1):_!==!!s.multiple&&(s.defaultValue!=null?yb(i,!!s.multiple,s.defaultValue,!0):yb(i,!!s.multiple,s.multiple?[]:"",!1))}i[xA]=s}catch(I){Jo(n,n.return,I)}}break;case 6:if(bf(e,n),Nd(n),r&4){if(n.stateNode===null)throw Error(Zn(162));i=n.stateNode,s=n.memoizedProps;try{i.nodeValue=s}catch(I){Jo(n,n.return,I)}}break;case 3:if(bf(e,n),Nd(n),r&4&&t!==null&&t.memoizedState.isDehydrated)try{mA(e.containerInfo)}catch(I){Jo(n,n.return,I)}break;case 4:bf(e,n),Nd(n);break;case 13:bf(e,n),Nd(n),i=n.child,i.flags&8192&&(s=i.memoizedState!==null,i.stateNode.isHidden=s,!s||i.alternate!==null&&i.alternate.memoizedState!==null||(Hz=fa())),r&4&&xH(n);break;case 22:if(d=t!==null&&t.memoizedState!==null,n.mode&1?(Vl=(h=Vl)||d,bf(e,n),Vl=h):bf(e,n),Nd(n),r&8192){if(h=n.memoizedState!==null,(n.stateNode.isHidden=h)&&!d&&n.mode&1)for(Cr=n,d=n.child;d!==null;){for(m=Cr=d;Cr!==null;){switch(_=Cr,y=_.child,_.tag){case 0:case 11:case 14:case 15:PS(4,_,_.return);break;case 1:sb(_,_.return);var T=_.stateNode;if(typeof T.componentWillUnmount=="function"){r=_,t=_.return;try{e=r,T.props=e.memoizedProps,T.state=e.memoizedState,T.componentWillUnmount()}catch(I){Jo(r,t,I)}}break;case 5:sb(_,_.return);break;case 22:if(_.memoizedState!==null){wH(m);continue}}y!==null?(y.return=_,Cr=y):wH(m)}d=d.sibling}e:for(d=null,m=n;;){if(m.tag===5){if(d===null){d=m;try{i=m.stateNode,h?(s=i.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(l=m.stateNode,o=m.memoizedProps.style,a=o!=null&&o.hasOwnProperty("display")?o.display:null,l.style.display=iJ("display",a))}catch(I){Jo(n,n.return,I)}}}else if(m.tag===6){if(d===null)try{m.stateNode.nodeValue=h?"":m.memoizedProps}catch(I){Jo(n,n.return,I)}}else if((m.tag!==22&&m.tag!==23||m.memoizedState===null||m===n)&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===n)break e;for(;m.sibling===null;){if(m.return===null||m.return===n)break e;d===m&&(d=null),m=m.return}d===m&&(d=null),m.sibling.return=m.return,m=m.sibling}}break;case 19:bf(e,n),Nd(n),r&4&&xH(n);break;case 21:break;default:bf(e,n),Nd(n)}}function Nd(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(PQ(t)){var r=t;break e}t=t.return}throw Error(Zn(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(hA(i,""),r.flags&=-33);var s=yH(n);BO(n,s,i);break;case 3:case 4:var a=r.stateNode.containerInfo,l=yH(n);DO(n,l,a);break;default:throw Error(Zn(161))}}catch(o){Jo(n,n.return,o)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function Ape(n,e,t){Cr=n,BQ(n)}function BQ(n,e,t){for(var r=(n.mode&1)!==0;Cr!==null;){var i=Cr,s=i.child;if(i.tag===22&&r){var a=i.memoizedState!==null||fC;if(!a){var l=i.alternate,o=l!==null&&l.memoizedState!==null||Vl;l=fC;var h=Vl;if(fC=a,(Vl=o)&&!h)for(Cr=i;Cr!==null;)a=Cr,o=a.child,a.tag===22&&a.memoizedState!==null?SH(i):o!==null?(o.return=a,Cr=o):SH(i);for(;s!==null;)Cr=s,BQ(s),s=s.sibling;Cr=i,fC=l,Vl=h}bH(n)}else i.subtreeFlags&8772&&s!==null?(s.return=i,Cr=s):bH(n)}}function bH(n){for(;Cr!==null;){var e=Cr;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Vl||dL(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!Vl)if(t===null)r.componentDidMount();else{var i=e.elementType===e.type?t.memoizedProps:Rf(e.type,t.memoizedProps);r.componentDidUpdate(i,t.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&iH(e,s,r);break;case 3:var a=e.updateQueue;if(a!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}iH(e,a,t)}break;case 5:var l=e.stateNode;if(t===null&&e.flags&4){t=l;var o=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":o.autoFocus&&t.focus();break;case"img":o.src&&(t.src=o.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var h=e.alternate;if(h!==null){var d=h.memoizedState;if(d!==null){var m=d.dehydrated;m!==null&&mA(m)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Zn(163))}Vl||e.flags&512&&LO(e)}catch(_){Jo(e,e.return,_)}}if(e===n){Cr=null;break}if(t=e.sibling,t!==null){t.return=e.return,Cr=t;break}Cr=e.return}}function wH(n){for(;Cr!==null;){var e=Cr;if(e===n){Cr=null;break}var t=e.sibling;if(t!==null){t.return=e.return,Cr=t;break}Cr=e.return}}function SH(n){for(;Cr!==null;){var e=Cr;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{dL(4,e)}catch(o){Jo(e,t,o)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(o){Jo(e,i,o)}}var s=e.return;try{LO(e)}catch(o){Jo(e,s,o)}break;case 5:var a=e.return;try{LO(e)}catch(o){Jo(e,a,o)}}}catch(o){Jo(e,e.return,o)}if(e===n){Cr=null;break}var l=e.sibling;if(l!==null){l.return=e.return,Cr=l;break}Cr=e.return}}var Tpe=Math.ceil,vR=Km.ReactCurrentDispatcher,Vz=Km.ReactCurrentOwner,Sh=Km.ReactCurrentBatchConfig,ps=0,nl=null,ba=null,xl=0,Cu=0,ob=bv(0),Va=0,MA=null,Gy=0,pL=0,Gz=0,LS=null,Jc=null,Hz=0,jb=1/0,pm=null,_R=!1,kO=null,Y0=null,dC=!1,O0=null,yR=0,DS=0,OO=null,EI=-1,II=0;function Tc(){return ps&6?fa():EI!==-1?EI:EI=fa()}function K0(n){return n.mode&1?ps&2&&xl!==0?xl&-xl:lpe.transition!==null?(II===0&&(II=vJ()),II):(n=Os,n!==0||(n=window.event,n=n===void 0?16:AJ(n.type)),n):1}function Gf(n,e,t,r){if(50<DS)throw DS=0,OO=null,Error(Zn(185));yT(n,t,r),(!(ps&2)||n!==nl)&&(n===nl&&(!(ps&2)&&(pL|=t),Va===4&&L0(n,xl)),lu(n,r),t===1&&ps===0&&!(e.mode&1)&&(jb=fa()+500,uL&&wv()))}function lu(n,e){var t=n.callbackNode;lde(n,e);var r=nR(n,n===nl?xl:0);if(r===0)t!==null&&LG(t),n.callbackNode=null,n.callbackPriority=0;else if(e=r&-r,n.callbackPriority!==e){if(t!=null&&LG(t),e===1)n.tag===0?ape(AH.bind(null,n)):HJ(AH.bind(null,n)),rpe(function(){!(ps&6)&&wv()}),t=null;else{switch(_J(r)){case 1:t=mz;break;case 4:t=mJ;break;case 16:t=tR;break;case 536870912:t=gJ;break;default:t=tR}t=GQ(t,kQ.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function kQ(n,e){if(EI=-1,II=0,ps&6)throw Error(Zn(327));var t=n.callbackNode;if(Ab()&&n.callbackNode!==t)return null;var r=nR(n,n===nl?xl:0);if(r===0)return null;if(r&30||r&n.expiredLanes||e)e=xR(n,r);else{e=r;var i=ps;ps|=2;var s=FQ();(nl!==n||xl!==e)&&(pm=null,jb=fa()+500,Ty(n,e));do try{Epe();break}catch(l){OQ(n,l)}while(!0);Ez(),vR.current=s,ps=i,ba!==null?e=0:(nl=null,xl=0,e=Va)}if(e!==0){if(e===2&&(i=cO(n),i!==0&&(r=i,e=FO(n,i))),e===1)throw t=MA,Ty(n,0),L0(n,r),lu(n,fa()),t;if(e===6)L0(n,r);else{if(i=n.current.alternate,!(r&30)&&!Mpe(i)&&(e=xR(n,r),e===2&&(s=cO(n),s!==0&&(r=s,e=FO(n,s))),e===1))throw t=MA,Ty(n,0),L0(n,r),lu(n,fa()),t;switch(n.finishedWork=i,n.finishedLanes=r,e){case 0:case 1:throw Error(Zn(345));case 2:ty(n,Jc,pm);break;case 3:if(L0(n,r),(r&130023424)===r&&(e=Hz+500-fa(),10<e)){if(nR(n,0)!==0)break;if(i=n.suspendedLanes,(i&r)!==r){Tc(),n.pingedLanes|=n.suspendedLanes&i;break}n.timeoutHandle=vO(ty.bind(null,n,Jc,pm),e);break}ty(n,Jc,pm);break;case 4:if(L0(n,r),(r&4194240)===r)break;for(e=n.eventTimes,i=-1;0<r;){var a=31-Vf(r);s=1<<a,a=e[a],a>i&&(i=a),r&=~s}if(r=i,r=fa()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Tpe(r/1960))-r,10<r){n.timeoutHandle=vO(ty.bind(null,n,Jc,pm),r);break}ty(n,Jc,pm);break;case 5:ty(n,Jc,pm);break;default:throw Error(Zn(329))}}}return lu(n,fa()),n.callbackNode===t?kQ.bind(null,n):null}function FO(n,e){var t=LS;return n.current.memoizedState.isDehydrated&&(Ty(n,e).flags|=256),n=xR(n,e),n!==2&&(e=Jc,Jc=t,e!==null&&NO(e)),n}function NO(n){Jc===null?Jc=n:Jc.push.apply(Jc,n)}function Mpe(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var r=0;r<t.length;r++){var i=t[r],s=i.getSnapshot;i=i.value;try{if(!Wf(s(),i))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function L0(n,e){for(e&=~Gz,e&=~pL,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-Vf(e),r=1<<t;n[t]=-1,e&=~r}}function AH(n){if(ps&6)throw Error(Zn(327));Ab();var e=nR(n,0);if(!(e&1))return lu(n,fa()),null;var t=xR(n,e);if(n.tag!==0&&t===2){var r=cO(n);r!==0&&(e=r,t=FO(n,r))}if(t===1)throw t=MA,Ty(n,0),L0(n,e),lu(n,fa()),t;if(t===6)throw Error(Zn(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,ty(n,Jc,pm),lu(n,fa()),null}function jz(n,e){var t=ps;ps|=1;try{return n(e)}finally{ps=t,ps===0&&(jb=fa()+500,uL&&wv())}}function Hy(n){O0!==null&&O0.tag===0&&!(ps&6)&&Ab();var e=ps;ps|=1;var t=Sh.transition,r=Os;try{if(Sh.transition=null,Os=1,n)return n()}finally{Os=r,Sh.transition=t,ps=e,!(ps&6)&&wv()}}function Wz(){Cu=ob.current,go(ob)}function Ty(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,npe(t)),ba!==null)for(t=ba.return;t!==null;){var r=t;switch(Tz(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&aR();break;case 3:Gb(),go(ou),go(ql),Bz();break;case 5:Dz(r);break;case 4:Gb();break;case 13:go(zo);break;case 19:go(zo);break;case 10:Iz(r.type._context);break;case 22:case 23:Wz()}t=t.return}if(nl=n,ba=n=J0(n.current,null),xl=Cu=e,Va=0,MA=null,Gz=pL=Gy=0,Jc=LS=null,hy!==null){for(e=0;e<hy.length;e++)if(t=hy[e],r=t.interleaved,r!==null){t.interleaved=null;var i=r.next,s=t.pending;if(s!==null){var a=s.next;s.next=i,r.next=a}t.pending=r}hy=null}return n}function OQ(n,e){do{var t=ba;try{if(Ez(),TI.current=gR,mR){for(var r=Vo.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}mR=!1}if(Vy=0,tl=za=Vo=null,RS=!1,SA=0,Vz.current=null,t===null||t.return===null){Va=1,MA=e,ba=null;break}e:{var s=n,a=t.return,l=t,o=e;if(e=xl,l.flags|=32768,o!==null&&typeof o=="object"&&typeof o.then=="function"){var h=o,d=l,m=d.tag;if(!(d.mode&1)&&(m===0||m===11||m===15)){var _=d.alternate;_?(d.updateQueue=_.updateQueue,d.memoizedState=_.memoizedState,d.lanes=_.lanes):(d.updateQueue=null,d.memoizedState=null)}var y=hH(a);if(y!==null){y.flags&=-257,fH(y,a,l,s,e),y.mode&1&&uH(s,h,e),e=y,o=h;var T=e.updateQueue;if(T===null){var I=new Set;I.add(o),e.updateQueue=I}else T.add(o);break e}else{if(!(e&1)){uH(s,h,e),Xz();break e}o=Error(Zn(426))}}else if(To&&l.mode&1){var C=hH(a);if(C!==null){!(C.flags&65536)&&(C.flags|=256),fH(C,a,l,s,e),Mz(Hb(o,l));break e}}s=o=Hb(o,l),Va!==4&&(Va=2),LS===null?LS=[s]:LS.push(s),s=a;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var M=yQ(s,o,e);rH(s,M);break e;case 1:l=o;var B=s.type,k=s.stateNode;if(!(s.flags&128)&&(typeof B.getDerivedStateFromError=="function"||k!==null&&typeof k.componentDidCatch=="function"&&(Y0===null||!Y0.has(k)))){s.flags|=65536,e&=-e,s.lanes|=e;var j=xQ(s,l,e);rH(s,j);break e}}s=s.return}while(s!==null)}zQ(t)}catch(q){e=q,ba===t&&t!==null&&(ba=t=t.return);continue}break}while(!0)}function FQ(){var n=vR.current;return vR.current=gR,n===null?gR:n}function Xz(){(Va===0||Va===3||Va===2)&&(Va=4),nl===null||!(Gy&268435455)&&!(pL&268435455)||L0(nl,xl)}function xR(n,e){var t=ps;ps|=2;var r=FQ();(nl!==n||xl!==e)&&(pm=null,Ty(n,e));do try{Cpe();break}catch(i){OQ(n,i)}while(!0);if(Ez(),ps=t,vR.current=r,ba!==null)throw Error(Zn(261));return nl=null,xl=0,Va}function Cpe(){for(;ba!==null;)NQ(ba)}function Epe(){for(;ba!==null&&!Qfe();)NQ(ba)}function NQ(n){var e=VQ(n.alternate,n,Cu);n.memoizedProps=n.pendingProps,e===null?zQ(n):ba=e,Vz.current=null}function zQ(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=bpe(t,e),t!==null){t.flags&=32767,ba=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{Va=6,ba=null;return}}else if(t=xpe(t,e,Cu),t!==null){ba=t;return}if(e=e.sibling,e!==null){ba=e;return}ba=e=n}while(e!==null);Va===0&&(Va=5)}function ty(n,e,t){var r=Os,i=Sh.transition;try{Sh.transition=null,Os=1,Ipe(n,e,t,r)}finally{Sh.transition=i,Os=r}return null}function Ipe(n,e,t,r){do Ab();while(O0!==null);if(ps&6)throw Error(Zn(327));t=n.finishedWork;var i=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(Zn(177));n.callbackNode=null,n.callbackPriority=0;var s=t.lanes|t.childLanes;if(cde(n,s),n===nl&&(ba=nl=null,xl=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||dC||(dC=!0,GQ(tR,function(){return Ab(),null})),s=(t.flags&15990)!==0,t.subtreeFlags&15990||s){s=Sh.transition,Sh.transition=null;var a=Os;Os=1;var l=ps;ps|=4,Vz.current=null,Spe(n,t),DQ(t,n),Zde(mO),rR=!!pO,mO=pO=null,n.current=t,Ape(t),ede(),ps=l,Os=a,Sh.transition=s}else n.current=t;if(dC&&(dC=!1,O0=n,yR=i),s=n.pendingLanes,s===0&&(Y0=null),rde(t.stateNode),lu(n,fa()),e!==null)for(r=n.onRecoverableError,t=0;t<e.length;t++)i=e[t],r(i.value,{componentStack:i.stack,digest:i.digest});if(_R)throw _R=!1,n=kO,kO=null,n;return yR&1&&n.tag!==0&&Ab(),s=n.pendingLanes,s&1?n===OO?DS++:(DS=0,OO=n):DS=0,wv(),null}function Ab(){if(O0!==null){var n=_J(yR),e=Sh.transition,t=Os;try{if(Sh.transition=null,Os=16>n?16:n,O0===null)var r=!1;else{if(n=O0,O0=null,yR=0,ps&6)throw Error(Zn(331));var i=ps;for(ps|=4,Cr=n.current;Cr!==null;){var s=Cr,a=s.child;if(Cr.flags&16){var l=s.deletions;if(l!==null){for(var o=0;o<l.length;o++){var h=l[o];for(Cr=h;Cr!==null;){var d=Cr;switch(d.tag){case 0:case 11:case 15:PS(8,d,s)}var m=d.child;if(m!==null)m.return=d,Cr=m;else for(;Cr!==null;){d=Cr;var _=d.sibling,y=d.return;if(RQ(d),d===h){Cr=null;break}if(_!==null){_.return=y,Cr=_;break}Cr=y}}}var T=s.alternate;if(T!==null){var I=T.child;if(I!==null){T.child=null;do{var C=I.sibling;I.sibling=null,I=C}while(I!==null)}}Cr=s}}if(s.subtreeFlags&2064&&a!==null)a.return=s,Cr=a;else e:for(;Cr!==null;){if(s=Cr,s.flags&2048)switch(s.tag){case 0:case 11:case 15:PS(9,s,s.return)}var M=s.sibling;if(M!==null){M.return=s.return,Cr=M;break e}Cr=s.return}}var B=n.current;for(Cr=B;Cr!==null;){a=Cr;var k=a.child;if(a.subtreeFlags&2064&&k!==null)k.return=a,Cr=k;else e:for(a=B;Cr!==null;){if(l=Cr,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:dL(9,l)}}catch(q){Jo(l,l.return,q)}if(l===a){Cr=null;break e}var j=l.sibling;if(j!==null){j.return=l.return,Cr=j;break e}Cr=l.return}}if(ps=i,wv(),tp&&typeof tp.onPostCommitFiberRoot=="function")try{tp.onPostCommitFiberRoot(sL,n)}catch{}r=!0}return r}finally{Os=t,Sh.transition=e}}return!1}function TH(n,e,t){e=Hb(t,e),e=yQ(n,e,1),n=Z0(n,e,1),e=Tc(),n!==null&&(yT(n,1,e),lu(n,e))}function Jo(n,e,t){if(n.tag===3)TH(n,n,t);else for(;e!==null;){if(e.tag===3){TH(e,n,t);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Y0===null||!Y0.has(r))){n=Hb(t,n),n=xQ(e,n,1),e=Z0(e,n,1),n=Tc(),e!==null&&(yT(e,1,n),lu(e,n));break}}e=e.return}}function Rpe(n,e,t){var r=n.pingCache;r!==null&&r.delete(e),e=Tc(),n.pingedLanes|=n.suspendedLanes&t,nl===n&&(xl&t)===t&&(Va===4||Va===3&&(xl&130023424)===xl&&500>fa()-Hz?Ty(n,0):Gz|=t),lu(n,e)}function UQ(n,e){e===0&&(n.mode&1?(e=rC,rC<<=1,!(rC&130023424)&&(rC=4194304)):e=1);var t=Tc();n=Nm(n,e),n!==null&&(yT(n,e,t),lu(n,t))}function Ppe(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),UQ(n,t)}function Lpe(n,e){var t=0;switch(n.tag){case 13:var r=n.stateNode,i=n.memoizedState;i!==null&&(t=i.retryLane);break;case 19:r=n.stateNode;break;default:throw Error(Zn(314))}r!==null&&r.delete(e),UQ(n,t)}var VQ;VQ=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||ou.current)nu=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return nu=!1,ype(n,e,t);nu=!!(n.flags&131072)}else nu=!1,To&&e.flags&1048576&&jJ(e,uR,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;CI(n,e),n=e.pendingProps;var i=zb(e,ql.current);Sb(e,t),i=Oz(null,e,r,n,i,t);var s=Fz();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,au(r)?(s=!0,lR(e)):s=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,Pz(e),i.updater=hL,e.stateNode=i,i._reactInternals=e,AO(e,r,n,t),e=CO(null,e,r,!0,s,t)):(e.tag=0,To&&s&&Az(e),_c(null,e,i,t),e=e.child),e;case 16:r=e.elementType;e:{switch(CI(n,e),n=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=Bpe(r),n=Rf(r,n),i){case 0:e=MO(null,e,r,n,t);break e;case 1:e=mH(null,e,r,n,t);break e;case 11:e=dH(null,e,r,n,t);break e;case 14:e=pH(null,e,r,Rf(r.type,n),t);break e}throw Error(Zn(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Rf(r,i),MO(n,e,r,i,t);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Rf(r,i),mH(n,e,r,i,t);case 3:e:{if(AQ(e),n===null)throw Error(Zn(387));r=e.pendingProps,s=e.memoizedState,i=s.element,qJ(n,e),dR(e,r,null,t);var a=e.memoizedState;if(r=a.element,s.isDehydrated)if(s={element:r,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){i=Hb(Error(Zn(423)),e),e=gH(n,e,r,t,i);break e}else if(r!==i){i=Hb(Error(Zn(424)),e),e=gH(n,e,r,t,i);break e}else for(Ru=q0(e.stateNode.containerInfo.firstChild),Pu=e,To=!0,Bf=null,t=JJ(e,null,r,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(Ub(),r===i){e=zm(n,e,t);break e}_c(n,e,r,t)}e=e.child}return e;case 5:return QJ(e),n===null&&bO(e),r=e.type,i=e.pendingProps,s=n!==null?n.memoizedProps:null,a=i.children,gO(r,i)?a=null:s!==null&&gO(r,s)&&(e.flags|=32),SQ(n,e),_c(n,e,a,t),e.child;case 6:return n===null&&bO(e),null;case 13:return TQ(n,e,t);case 4:return Lz(e,e.stateNode.containerInfo),r=e.pendingProps,n===null?e.child=Vb(e,null,r,t):_c(n,e,r,t),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Rf(r,i),dH(n,e,r,i,t);case 7:return _c(n,e,e.pendingProps,t),e.child;case 8:return _c(n,e,e.pendingProps.children,t),e.child;case 12:return _c(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,s=e.memoizedProps,a=i.value,no(hR,r._currentValue),r._currentValue=a,s!==null)if(Wf(s.value,a)){if(s.children===i.children&&!ou.current){e=zm(n,e,t);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var l=s.dependencies;if(l!==null){a=s.child;for(var o=l.firstContext;o!==null;){if(o.context===r){if(s.tag===1){o=Pm(-1,t&-t),o.tag=2;var h=s.updateQueue;if(h!==null){h=h.shared;var d=h.pending;d===null?o.next=o:(o.next=d.next,d.next=o),h.pending=o}}s.lanes|=t,o=s.alternate,o!==null&&(o.lanes|=t),wO(s.return,t,e),l.lanes|=t;break}o=o.next}}else if(s.tag===10)a=s.type===e.type?null:s.child;else if(s.tag===18){if(a=s.return,a===null)throw Error(Zn(341));a.lanes|=t,l=a.alternate,l!==null&&(l.lanes|=t),wO(a,t,e),a=s.sibling}else a=s.child;if(a!==null)a.return=s;else for(a=s;a!==null;){if(a===e){a=null;break}if(s=a.sibling,s!==null){s.return=a.return,a=s;break}a=a.return}s=a}_c(n,e,i.children,t),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,Sb(e,t),i=Eh(i),r=r(i),e.flags|=1,_c(n,e,r,t),e.child;case 14:return r=e.type,i=Rf(r,e.pendingProps),i=Rf(r.type,i),pH(n,e,r,i,t);case 15:return bQ(n,e,e.type,e.pendingProps,t);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Rf(r,i),CI(n,e),e.tag=1,au(r)?(n=!0,lR(e)):n=!1,Sb(e,t),YJ(e,r,i),AO(e,r,i,t),CO(null,e,r,!0,n,t);case 19:return MQ(n,e,t);case 22:return wQ(n,e,t)}throw Error(Zn(156,e.tag))};function GQ(n,e){return pJ(n,e)}function Dpe(n,e,t,r){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function bh(n,e,t,r){return new Dpe(n,e,t,r)}function $z(n){return n=n.prototype,!(!n||!n.isReactComponent)}function Bpe(n){if(typeof n=="function")return $z(n)?1:0;if(n!=null){if(n=n.$$typeof,n===fz)return 11;if(n===dz)return 14}return 2}function J0(n,e){var t=n.alternate;return t===null?(t=bh(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function RI(n,e,t,r,i,s){var a=2;if(r=n,typeof n=="function")$z(n)&&(a=1);else if(typeof n=="string")a=5;else e:switch(n){case Y1:return My(t.children,i,s,e);case hz:a=8,i|=8;break;case qk:return n=bh(12,t,e,i|2),n.elementType=qk,n.lanes=s,n;case Zk:return n=bh(13,t,e,i),n.elementType=Zk,n.lanes=s,n;case Yk:return n=bh(19,t,e,i),n.elementType=Yk,n.lanes=s,n;case KK:return mL(t,i,s,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case ZK:a=10;break e;case YK:a=9;break e;case fz:a=11;break e;case dz:a=14;break e;case C0:a=16,r=null;break e}throw Error(Zn(130,n==null?n:typeof n,""))}return e=bh(a,t,e,i),e.elementType=n,e.type=r,e.lanes=s,e}function My(n,e,t,r){return n=bh(7,n,r,e),n.lanes=t,n}function mL(n,e,t,r){return n=bh(22,n,r,e),n.elementType=KK,n.lanes=t,n.stateNode={isHidden:!1},n}function z4(n,e,t){return n=bh(6,n,null,e),n.lanes=t,n}function U4(n,e,t){return e=bh(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function kpe(n,e,t,r,i){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=x4(0),this.expirationTimes=x4(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=x4(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function qz(n,e,t,r,i,s,a,l,o){return n=new kpe(n,e,t,l,o),e===1?(e=1,s===!0&&(e|=8)):e=0,s=bh(3,null,null,e),n.current=s,s.stateNode=n,s.memoizedState={element:r,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},Pz(s),n}function Ope(n,e,t){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Z1,key:r==null?null:""+r,children:n,containerInfo:e,implementation:t}}function HQ(n){if(!n)return ov;n=n._reactInternals;e:{if(cx(n)!==n||n.tag!==1)throw Error(Zn(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(au(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Zn(171))}if(n.tag===1){var t=n.type;if(au(t))return GJ(n,t,e)}return e}function jQ(n,e,t,r,i,s,a,l,o){return n=qz(t,r,!0,n,i,s,a,l,o),n.context=HQ(null),t=n.current,r=Tc(),i=K0(t),s=Pm(r,i),s.callback=e??null,Z0(t,s,i),n.current.lanes=i,yT(n,i,r),lu(n,r),n}function gL(n,e,t,r){var i=e.current,s=Tc(),a=K0(i);return t=HQ(t),e.context===null?e.context=t:e.pendingContext=t,e=Pm(s,a),e.payload={element:n},r=r===void 0?null:r,r!==null&&(e.callback=r),n=Z0(i,e,a),n!==null&&(Gf(n,i,a,s),AI(n,i,a)),a}function bR(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function MH(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function Zz(n,e){MH(n,e),(n=n.alternate)&&MH(n,e)}function Fpe(){return null}var WQ=typeof reportError=="function"?reportError:function(n){console.error(n)};function Yz(n){this._internalRoot=n}vL.prototype.render=Yz.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(Zn(409));gL(n,e,null,null)};vL.prototype.unmount=Yz.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;Hy(function(){gL(null,n,null,null)}),e[Fm]=null}};function vL(n){this._internalRoot=n}vL.prototype.unstable_scheduleHydration=function(n){if(n){var e=bJ();n={blockedOn:null,target:n,priority:e};for(var t=0;t<P0.length&&e!==0&&e<P0[t].priority;t++);P0.splice(t,0,n),t===0&&SJ(n)}};function Kz(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function _L(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function CH(){}function Npe(n,e,t,r,i){if(i){if(typeof r=="function"){var s=r;r=function(){var h=bR(a);s.call(h)}}var a=jQ(e,r,n,0,null,!1,!1,"",CH);return n._reactRootContainer=a,n[Fm]=a.current,_A(n.nodeType===8?n.parentNode:n),Hy(),a}for(;i=n.lastChild;)n.removeChild(i);if(typeof r=="function"){var l=r;r=function(){var h=bR(o);l.call(h)}}var o=qz(n,0,!1,null,null,!1,!1,"",CH);return n._reactRootContainer=o,n[Fm]=o.current,_A(n.nodeType===8?n.parentNode:n),Hy(function(){gL(e,o,t,r)}),o}function yL(n,e,t,r,i){var s=t._reactRootContainer;if(s){var a=s;if(typeof i=="function"){var l=i;i=function(){var o=bR(a);l.call(o)}}gL(e,a,n,i)}else a=Npe(t,e,n,i,r);return bR(a)}yJ=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=lS(e.pendingLanes);t!==0&&(gz(e,t|1),lu(e,fa()),!(ps&6)&&(jb=fa()+500,wv()))}break;case 13:Hy(function(){var r=Nm(n,1);if(r!==null){var i=Tc();Gf(r,n,1,i)}}),Zz(n,1)}};vz=function(n){if(n.tag===13){var e=Nm(n,134217728);if(e!==null){var t=Tc();Gf(e,n,134217728,t)}Zz(n,134217728)}};xJ=function(n){if(n.tag===13){var e=K0(n),t=Nm(n,e);if(t!==null){var r=Tc();Gf(t,n,e,r)}Zz(n,e)}};bJ=function(){return Os};wJ=function(n,e){var t=Os;try{return Os=n,e()}finally{Os=t}};oO=function(n,e,t){switch(e){case"input":if(Qk(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var r=t[e];if(r!==n&&r.form===n.form){var i=cL(r);if(!i)throw Error(Zn(90));QK(r),Qk(r,i)}}}break;case"textarea":tJ(n,t);break;case"select":e=t.value,e!=null&&yb(n,!!t.multiple,e,!1)}};lJ=jz;cJ=Hy;var zpe={usingClientEntryPoint:!1,Events:[bT,eb,cL,oJ,aJ,jz]},g2={findFiberByHostInstance:uy,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},Upe={bundleType:g2.bundleType,version:g2.version,rendererPackageName:g2.rendererPackageName,rendererConfig:g2.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Km.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=fJ(n),n===null?null:n.stateNode},findFiberByHostInstance:g2.findFiberByHostInstance||Fpe,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var pC=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!pC.isDisabled&&pC.supportsFiber)try{sL=pC.inject(Upe),tp=pC}catch{}}Fu.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=zpe;Fu.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Kz(e))throw Error(Zn(200));return Ope(n,e,null,t)};Fu.createRoot=function(n,e){if(!Kz(n))throw Error(Zn(299));var t=!1,r="",i=WQ;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=qz(n,1,!1,null,null,t,!1,r,i),n[Fm]=e.current,_A(n.nodeType===8?n.parentNode:n),new Yz(e)};Fu.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(Zn(188)):(n=Object.keys(n).join(","),Error(Zn(268,n)));return n=fJ(e),n=n===null?null:n.stateNode,n};Fu.flushSync=function(n){return Hy(n)};Fu.hydrate=function(n,e,t){if(!_L(e))throw Error(Zn(200));return yL(null,n,e,!0,t)};Fu.hydrateRoot=function(n,e,t){if(!Kz(n))throw Error(Zn(405));var r=t!=null&&t.hydratedSources||null,i=!1,s="",a=WQ;if(t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),e=jQ(e,null,n,1,t??null,i,!1,s,a),n[Fm]=e.current,_A(n),r)for(n=0;n<r.length;n++)t=r[n],i=t._getVersion,i=i(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,i]:e.mutableSourceEagerHydrationData.push(t,i);return new vL(e)};Fu.render=function(n,e,t){if(!_L(e))throw Error(Zn(200));return yL(null,n,e,!1,t)};Fu.unmountComponentAtNode=function(n){if(!_L(n))throw Error(Zn(40));return n._reactRootContainer?(Hy(function(){yL(null,null,n,!1,function(){n._reactRootContainer=null,n[Fm]=null})}),!0):!1};Fu.unstable_batchedUpdates=jz;Fu.unstable_renderSubtreeIntoContainer=function(n,e,t,r){if(!_L(t))throw Error(Zn(200));if(n==null||n._reactInternals===void 0)throw Error(Zn(38));return yL(n,e,t,!1,r)};Fu.version="18.2.0-next-9e3b772b8-20220608";function XQ(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(XQ)}catch(n){console.error(n)}}XQ(),jK.exports=Fu;var Hf=jK.exports,$Q,EH=Hf;$Q=Xk.createRoot=EH.createRoot,Xk.hydrateRoot=EH.hydrateRoot;/**
 * @remix-run/router v1.14.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function CA(){return CA=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},CA.apply(this,arguments)}var F0;(function(n){n.Pop="POP",n.Push="PUSH",n.Replace="REPLACE"})(F0||(F0={}));const IH="popstate";function Vpe(n){n===void 0&&(n={});function e(r,i){let{pathname:s,search:a,hash:l}=r.location;return zO("",{pathname:s,search:a,hash:l},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function t(r,i){return typeof i=="string"?i:wR(i)}return Hpe(e,t,null,n)}function na(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function Jz(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function Gpe(){return Math.random().toString(36).substr(2,8)}function RH(n,e){return{usr:n.state,key:n.key,idx:e}}function zO(n,e,t,r){return t===void 0&&(t=null),CA({pathname:typeof n=="string"?n:n.pathname,search:"",hash:""},typeof e=="string"?cw(e):e,{state:t,key:e&&e.key||r||Gpe()})}function wR(n){let{pathname:e="/",search:t="",hash:r=""}=n;return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function cw(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substr(t),n=n.substr(0,t));let r=n.indexOf("?");r>=0&&(e.search=n.substr(r),n=n.substr(0,r)),n&&(e.pathname=n)}return e}function Hpe(n,e,t,r){r===void 0&&(r={});let{window:i=document.defaultView,v5Compat:s=!1}=r,a=i.history,l=F0.Pop,o=null,h=d();h==null&&(h=0,a.replaceState(CA({},a.state,{idx:h}),""));function d(){return(a.state||{idx:null}).idx}function m(){l=F0.Pop;let C=d(),M=C==null?null:C-h;h=C,o&&o({action:l,location:I.location,delta:M})}function _(C,M){l=F0.Push;let B=zO(I.location,C,M);h=d()+1;let k=RH(B,h),j=I.createHref(B);try{a.pushState(k,"",j)}catch(q){if(q instanceof DOMException&&q.name==="DataCloneError")throw q;i.location.assign(j)}s&&o&&o({action:l,location:I.location,delta:1})}function y(C,M){l=F0.Replace;let B=zO(I.location,C,M);h=d();let k=RH(B,h),j=I.createHref(B);a.replaceState(k,"",j),s&&o&&o({action:l,location:I.location,delta:0})}function T(C){let M=i.location.origin!=="null"?i.location.origin:i.location.href,B=typeof C=="string"?C:wR(C);return na(M,"No window.location.(origin|href) available to create URL for href: "+B),new URL(B,M)}let I={get action(){return l},get location(){return n(i,a)},listen(C){if(o)throw new Error("A history only accepts one active listener");return i.addEventListener(IH,m),o=C,()=>{i.removeEventListener(IH,m),o=null}},createHref(C){return e(i,C)},createURL:T,encodeLocation(C){let M=T(C);return{pathname:M.pathname,search:M.search,hash:M.hash}},push:_,replace:y,go(C){return a.go(C)}};return I}var PH;(function(n){n.data="data",n.deferred="deferred",n.redirect="redirect",n.error="error"})(PH||(PH={}));function jpe(n,e,t){t===void 0&&(t="/");let r=typeof e=="string"?cw(e):e,i=EA(r.pathname||"/",t);if(i==null)return null;let s=qQ(n);Wpe(s);let a=null;for(let l=0;a==null&&l<s.length;++l)a=eme(s[l],nme(i));return a}function qQ(n,e,t,r){e===void 0&&(e=[]),t===void 0&&(t=[]),r===void 0&&(r="");let i=(s,a,l)=>{let o={relativePath:l===void 0?s.path||"":l,caseSensitive:s.caseSensitive===!0,childrenIndex:a,route:s};o.relativePath.startsWith("/")&&(na(o.relativePath.startsWith(r),'Absolute route path "'+o.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),o.relativePath=o.relativePath.slice(r.length));let h=Q0([r,o.relativePath]),d=t.concat(o);s.children&&s.children.length>0&&(na(s.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+h+'".')),qQ(s.children,e,d,h)),!(s.path==null&&!s.index)&&e.push({path:h,score:Jpe(h,s.index),routesMeta:d})};return n.forEach((s,a)=>{var l;if(s.path===""||!((l=s.path)!=null&&l.includes("?")))i(s,a);else for(let o of ZQ(s.path))i(s,a,o)}),e}function ZQ(n){let e=n.split("/");if(e.length===0)return[];let[t,...r]=e,i=t.endsWith("?"),s=t.replace(/\?$/,"");if(r.length===0)return i?[s,""]:[s];let a=ZQ(r.join("/")),l=[];return l.push(...a.map(o=>o===""?s:[s,o].join("/"))),i&&l.push(...a),l.map(o=>n.startsWith("/")&&o===""?"/":o)}function Wpe(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:Qpe(e.routesMeta.map(r=>r.childrenIndex),t.routesMeta.map(r=>r.childrenIndex)))}const Xpe=/^:\w+$/,$pe=3,qpe=2,Zpe=1,Ype=10,Kpe=-2,LH=n=>n==="*";function Jpe(n,e){let t=n.split("/"),r=t.length;return t.some(LH)&&(r+=Kpe),e&&(r+=qpe),t.filter(i=>!LH(i)).reduce((i,s)=>i+(Xpe.test(s)?$pe:s===""?Zpe:Ype),r)}function Qpe(n,e){return n.length===e.length&&n.slice(0,-1).every((r,i)=>r===e[i])?n[n.length-1]-e[e.length-1]:0}function eme(n,e){let{routesMeta:t}=n,r={},i="/",s=[];for(let a=0;a<t.length;++a){let l=t[a],o=a===t.length-1,h=i==="/"?e:e.slice(i.length)||"/",d=UO({path:l.relativePath,caseSensitive:l.caseSensitive,end:o},h);if(!d)return null;Object.assign(r,d.params);let m=l.route;s.push({params:r,pathname:Q0([i,d.pathname]),pathnameBase:ame(Q0([i,d.pathnameBase])),route:m}),d.pathnameBase!=="/"&&(i=Q0([i,d.pathnameBase]))}return s}function UO(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,r]=tme(n.path,n.caseSensitive,n.end),i=e.match(t);if(!i)return null;let s=i[0],a=s.replace(/(.)\/+$/,"$1"),l=i.slice(1);return{params:r.reduce((h,d,m)=>{let{paramName:_,isOptional:y}=d;if(_==="*"){let I=l[m]||"";a=s.slice(0,s.length-I.length).replace(/(.)\/+$/,"$1")}const T=l[m];return y&&!T?h[_]=void 0:h[_]=rme(T||"",_),h},{}),pathname:s,pathnameBase:a,pattern:n}}function tme(n,e,t){e===void 0&&(e=!1),t===void 0&&(t=!0),Jz(n==="*"||!n.endsWith("*")||n.endsWith("/*"),'Route path "'+n+'" will be treated as if it were '+('"'+n.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+n.replace(/\*$/,"/*")+'".'));let r=[],i="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:(\w+)(\?)?/g,(a,l,o)=>(r.push({paramName:l,isOptional:o!=null}),o?"/?([^\\/]+)?":"/([^\\/]+)"));return n.endsWith("*")?(r.push({paramName:"*"}),i+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?i+="\\/*$":n!==""&&n!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),r]}function nme(n){try{return decodeURI(n)}catch(e){return Jz(!1,'The URL path "'+n+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),n}}function rme(n,e){try{return decodeURIComponent(n)}catch(t){return Jz(!1,'The value for the URL param "'+e+'" will not be decoded because'+(' the string "'+n+'" is a malformed URL segment. This is probably')+(" due to a bad percent encoding ("+t+").")),n}}function EA(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,r=n.charAt(t);return r&&r!=="/"?null:n.slice(t)||"/"}function ime(n,e){e===void 0&&(e="/");let{pathname:t,search:r="",hash:i=""}=typeof n=="string"?cw(n):n;return{pathname:t?t.startsWith("/")?t:sme(t,e):e,search:lme(r),hash:cme(i)}}function sme(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(i=>{i===".."?t.length>1&&t.pop():i!=="."&&t.push(i)}),t.length>1?t.join("/"):"/"}function V4(n,e,t,r){return"Cannot include a '"+n+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+t+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function ome(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function YQ(n,e){let t=ome(n);return e?t.map((r,i)=>i===n.length-1?r.pathname:r.pathnameBase):t.map(r=>r.pathnameBase)}function KQ(n,e,t,r){r===void 0&&(r=!1);let i;typeof n=="string"?i=cw(n):(i=CA({},n),na(!i.pathname||!i.pathname.includes("?"),V4("?","pathname","search",i)),na(!i.pathname||!i.pathname.includes("#"),V4("#","pathname","hash",i)),na(!i.search||!i.search.includes("#"),V4("#","search","hash",i)));let s=n===""||i.pathname==="",a=s?"/":i.pathname,l;if(a==null)l=t;else{let m=e.length-1;if(!r&&a.startsWith("..")){let _=a.split("/");for(;_[0]==="..";)_.shift(),m-=1;i.pathname=_.join("/")}l=m>=0?e[m]:"/"}let o=ime(i,l),h=a&&a!=="/"&&a.endsWith("/"),d=(s||a===".")&&t.endsWith("/");return!o.pathname.endsWith("/")&&(h||d)&&(o.pathname+="/"),o}const Q0=n=>n.join("/").replace(/\/\/+/g,"/"),ame=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),lme=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,cme=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function ume(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}const JQ=["post","put","patch","delete"];new Set(JQ);const hme=["get",...JQ];new Set(hme);/**
 * React Router v6.21.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function IA(){return IA=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},IA.apply(this,arguments)}const xL=Ae.createContext(null),QQ=Ae.createContext(null),Sv=Ae.createContext(null),bL=Ae.createContext(null),ux=Ae.createContext({outlet:null,matches:[],isDataRoute:!1}),eee=Ae.createContext(null);function fme(n,e){let{relative:t}=e===void 0?{}:e;ST()||na(!1);let{basename:r,navigator:i}=Ae.useContext(Sv),{hash:s,pathname:a,search:l}=wL(n,{relative:t}),o=a;return r!=="/"&&(o=a==="/"?r:Q0([r,a])),i.createHref({pathname:o,search:l,hash:s})}function ST(){return Ae.useContext(bL)!=null}function AT(){return ST()||na(!1),Ae.useContext(bL).location}function tee(n){Ae.useContext(Sv).static||Ae.useLayoutEffect(n)}function dme(){let{isDataRoute:n}=Ae.useContext(ux);return n?Mme():pme()}function pme(){ST()||na(!1);let n=Ae.useContext(xL),{basename:e,future:t,navigator:r}=Ae.useContext(Sv),{matches:i}=Ae.useContext(ux),{pathname:s}=AT(),a=JSON.stringify(YQ(i,t.v7_relativeSplatPath)),l=Ae.useRef(!1);return tee(()=>{l.current=!0}),Ae.useCallback(function(h,d){if(d===void 0&&(d={}),!l.current)return;if(typeof h=="number"){r.go(h);return}let m=KQ(h,JSON.parse(a),s,d.relative==="path");n==null&&e!=="/"&&(m.pathname=m.pathname==="/"?e:Q0([e,m.pathname])),(d.replace?r.replace:r.push)(m,d.state,d)},[e,r,a,s,n])}function wL(n,e){let{relative:t}=e===void 0?{}:e,{future:r}=Ae.useContext(Sv),{matches:i}=Ae.useContext(ux),{pathname:s}=AT(),a=JSON.stringify(YQ(i,r.v7_relativeSplatPath));return Ae.useMemo(()=>KQ(n,JSON.parse(a),s,t==="path"),[n,a,s,t])}function mme(n,e){return gme(n,e)}function gme(n,e,t,r){ST()||na(!1);let{navigator:i}=Ae.useContext(Sv),{matches:s}=Ae.useContext(ux),a=s[s.length-1],l=a?a.params:{};a&&a.pathname;let o=a?a.pathnameBase:"/";a&&a.route;let h=AT(),d;if(e){var m;let C=typeof e=="string"?cw(e):e;o==="/"||(m=C.pathname)!=null&&m.startsWith(o)||na(!1),d=C}else d=h;let _=d.pathname||"/",y=o==="/"?_:_.slice(o.length)||"/",T=jpe(n,{pathname:y}),I=bme(T&&T.map(C=>Object.assign({},C,{params:Object.assign({},l,C.params),pathname:Q0([o,i.encodeLocation?i.encodeLocation(C.pathname).pathname:C.pathname]),pathnameBase:C.pathnameBase==="/"?o:Q0([o,i.encodeLocation?i.encodeLocation(C.pathnameBase).pathname:C.pathnameBase])})),s,t,r);return e&&I?Ae.createElement(bL.Provider,{value:{location:IA({pathname:"/",search:"",hash:"",state:null,key:"default"},d),navigationType:F0.Pop}},I):I}function vme(){let n=Tme(),e=ume(n)?n.status+" "+n.statusText:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,i={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return Ae.createElement(Ae.Fragment,null,Ae.createElement("h2",null,"Unexpected Application Error!"),Ae.createElement("h3",{style:{fontStyle:"italic"}},e),t?Ae.createElement("pre",{style:i},t):null,null)}const _me=Ae.createElement(vme,null);class yme extends Ae.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error!==void 0?Ae.createElement(ux.Provider,{value:this.props.routeContext},Ae.createElement(eee.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function xme(n){let{routeContext:e,match:t,children:r}=n,i=Ae.useContext(xL);return i&&i.static&&i.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=t.route.id),Ae.createElement(ux.Provider,{value:e},r)}function bme(n,e,t,r){var i;if(e===void 0&&(e=[]),t===void 0&&(t=null),r===void 0&&(r=null),n==null){var s;if((s=t)!=null&&s.errors)n=t.matches;else return null}let a=n,l=(i=t)==null?void 0:i.errors;if(l!=null){let d=a.findIndex(m=>m.route.id&&(l==null?void 0:l[m.route.id]));d>=0||na(!1),a=a.slice(0,Math.min(a.length,d+1))}let o=!1,h=-1;if(t&&r&&r.v7_partialHydration)for(let d=0;d<a.length;d++){let m=a[d];if((m.route.HydrateFallback||m.route.hydrateFallbackElement)&&(h=d),m.route.id){let{loaderData:_,errors:y}=t,T=m.route.loader&&_[m.route.id]===void 0&&(!y||y[m.route.id]===void 0);if(m.route.lazy||T){o=!0,h>=0?a=a.slice(0,h+1):a=[a[0]];break}}}return a.reduceRight((d,m,_)=>{let y,T=!1,I=null,C=null;t&&(y=l&&m.route.id?l[m.route.id]:void 0,I=m.route.errorElement||_me,o&&(h<0&&_===0?(T=!0,C=null):h===_&&(T=!0,C=m.route.hydrateFallbackElement||null)));let M=e.concat(a.slice(0,_+1)),B=()=>{let k;return y?k=I:T?k=C:m.route.Component?k=Ae.createElement(m.route.Component,null):m.route.element?k=m.route.element:k=d,Ae.createElement(xme,{match:m,routeContext:{outlet:d,matches:M,isDataRoute:t!=null},children:k})};return t&&(m.route.ErrorBoundary||m.route.errorElement||_===0)?Ae.createElement(yme,{location:t.location,revalidation:t.revalidation,component:I,error:y,children:B(),routeContext:{outlet:null,matches:M,isDataRoute:!0}}):B()},null)}var nee=function(n){return n.UseBlocker="useBlocker",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n}(nee||{}),SR=function(n){return n.UseBlocker="useBlocker",n.UseLoaderData="useLoaderData",n.UseActionData="useActionData",n.UseRouteError="useRouteError",n.UseNavigation="useNavigation",n.UseRouteLoaderData="useRouteLoaderData",n.UseMatches="useMatches",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n.UseRouteId="useRouteId",n}(SR||{});function wme(n){let e=Ae.useContext(xL);return e||na(!1),e}function Sme(n){let e=Ae.useContext(QQ);return e||na(!1),e}function Ame(n){let e=Ae.useContext(ux);return e||na(!1),e}function ree(n){let e=Ame(),t=e.matches[e.matches.length-1];return t.route.id||na(!1),t.route.id}function Tme(){var n;let e=Ae.useContext(eee),t=Sme(SR.UseRouteError),r=ree(SR.UseRouteError);return e!==void 0?e:(n=t.errors)==null?void 0:n[r]}function Mme(){let{router:n}=wme(nee.UseNavigateStable),e=ree(SR.UseNavigateStable),t=Ae.useRef(!1);return tee(()=>{t.current=!0}),Ae.useCallback(function(i,s){s===void 0&&(s={}),t.current&&(typeof i=="number"?n.navigate(i):n.navigate(i,IA({fromRouteId:e},s)))},[n,e])}function Wd(n){na(!1)}function Cme(n){let{basename:e="/",children:t=null,location:r,navigationType:i=F0.Pop,navigator:s,static:a=!1,future:l}=n;ST()&&na(!1);let o=e.replace(/^\/*/,"/"),h=Ae.useMemo(()=>({basename:o,navigator:s,static:a,future:IA({v7_relativeSplatPath:!1},l)}),[o,l,s,a]);typeof r=="string"&&(r=cw(r));let{pathname:d="/",search:m="",hash:_="",state:y=null,key:T="default"}=r,I=Ae.useMemo(()=>{let C=EA(d,o);return C==null?null:{location:{pathname:C,search:m,hash:_,state:y,key:T},navigationType:i}},[o,d,m,_,y,T,i]);return I==null?null:Ae.createElement(Sv.Provider,{value:h},Ae.createElement(bL.Provider,{children:t,value:I}))}function Eme(n){let{children:e,location:t}=n;return mme(VO(e),t)}new Promise(()=>{});function VO(n,e){e===void 0&&(e=[]);let t=[];return Ae.Children.forEach(n,(r,i)=>{if(!Ae.isValidElement(r))return;let s=[...e,i];if(r.type===Ae.Fragment){t.push.apply(t,VO(r.props.children,s));return}r.type!==Wd&&na(!1),!r.props.index||!r.props.children||na(!1);let a={id:r.props.id||s.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(a.children=VO(r.props.children,s)),t.push(a)}),t}/**
 * React Router DOM v6.21.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function AR(){return AR=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},AR.apply(this,arguments)}function iee(n,e){if(n==null)return{};var t={},r=Object.keys(n),i,s;for(s=0;s<r.length;s++)i=r[s],!(e.indexOf(i)>=0)&&(t[i]=n[i]);return t}function Ime(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function Rme(n,e){return n.button===0&&(!e||e==="_self")&&!Ime(n)}const Pme=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","unstable_viewTransition"],Lme=["aria-current","caseSensitive","className","end","style","to","unstable_viewTransition","children"],Dme=Ae.createContext({isTransitioning:!1}),Bme="startTransition",DH=KI[Bme];function kme(n){let{basename:e,children:t,future:r,window:i}=n,s=Ae.useRef();s.current==null&&(s.current=Vpe({window:i,v5Compat:!0}));let a=s.current,[l,o]=Ae.useState({action:a.action,location:a.location}),{v7_startTransition:h}=r||{},d=Ae.useCallback(m=>{h&&DH?DH(()=>o(m)):o(m)},[o,h]);return Ae.useLayoutEffect(()=>a.listen(d),[a,d]),Ae.createElement(Cme,{basename:e,children:t,location:l.location,navigationType:l.action,navigator:a,future:r})}const Ome=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",Fme=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,N0=Ae.forwardRef(function(e,t){let{onClick:r,relative:i,reloadDocument:s,replace:a,state:l,target:o,to:h,preventScrollReset:d,unstable_viewTransition:m}=e,_=iee(e,Pme),{basename:y}=Ae.useContext(Sv),T,I=!1;if(typeof h=="string"&&Fme.test(h)&&(T=h,Ome))try{let k=new URL(window.location.href),j=h.startsWith("//")?new URL(k.protocol+h):new URL(h),q=EA(j.pathname,y);j.origin===k.origin&&q!=null?h=q+j.search+j.hash:I=!0}catch{}let C=fme(h,{relative:i}),M=zme(h,{replace:a,state:l,target:o,preventScrollReset:d,relative:i,unstable_viewTransition:m});function B(k){r&&r(k),k.defaultPrevented||M(k)}return Ae.createElement("a",AR({},_,{href:T||C,onClick:I||s?r:B,ref:t,target:o}))}),mC=Ae.forwardRef(function(e,t){let{"aria-current":r="page",caseSensitive:i=!1,className:s="",end:a=!1,style:l,to:o,unstable_viewTransition:h,children:d}=e,m=iee(e,Lme),_=wL(o,{relative:m.relative}),y=AT(),T=Ae.useContext(QQ),{navigator:I}=Ae.useContext(Sv),C=T!=null&&Ume(_)&&h===!0,M=I.encodeLocation?I.encodeLocation(_).pathname:_.pathname,B=y.pathname,k=T&&T.navigation&&T.navigation.location?T.navigation.location.pathname:null;i||(B=B.toLowerCase(),k=k?k.toLowerCase():null,M=M.toLowerCase());const j=M!=="/"&&M.endsWith("/")?M.length-1:M.length;let q=B===M||!a&&B.startsWith(M)&&B.charAt(j)==="/",Z=k!=null&&(k===M||!a&&k.startsWith(M)&&k.charAt(M.length)==="/"),te={isActive:q,isPending:Z,isTransitioning:C},ie=q?r:void 0,se;typeof s=="function"?se=s(te):se=[s,q?"active":null,Z?"pending":null,C?"transitioning":null].filter(Boolean).join(" ");let ae=typeof l=="function"?l(te):l;return Ae.createElement(N0,AR({},m,{"aria-current":ie,className:se,ref:t,style:ae,to:o,unstable_viewTransition:h}),typeof d=="function"?d(te):d)});var GO;(function(n){n.UseScrollRestoration="useScrollRestoration",n.UseSubmit="useSubmit",n.UseSubmitFetcher="useSubmitFetcher",n.UseFetcher="useFetcher",n.useViewTransitionState="useViewTransitionState"})(GO||(GO={}));var BH;(function(n){n.UseFetcher="useFetcher",n.UseFetchers="useFetchers",n.UseScrollRestoration="useScrollRestoration"})(BH||(BH={}));function Nme(n){let e=Ae.useContext(xL);return e||na(!1),e}function zme(n,e){let{target:t,replace:r,state:i,preventScrollReset:s,relative:a,unstable_viewTransition:l}=e===void 0?{}:e,o=dme(),h=AT(),d=wL(n,{relative:a});return Ae.useCallback(m=>{if(Rme(m,t)){m.preventDefault();let _=r!==void 0?r:wR(h)===wR(d);o(n,{replace:_,state:i,preventScrollReset:s,relative:a,unstable_viewTransition:l})}},[h,o,d,r,i,t,n,s,a,l])}function Ume(n,e){e===void 0&&(e={});let t=Ae.useContext(Dme);t==null&&na(!1);let{basename:r}=Nme(GO.useViewTransitionState),i=wL(n,{relative:e.relative});if(!t.isTransitioning)return!1;let s=EA(t.currentLocation.pathname,r)||t.currentLocation.pathname,a=EA(t.nextLocation.pathname,r)||t.nextLocation.pathname;return UO(i.pathname,a)!=null||UO(i.pathname,s)!=null}function RA(){return RA=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},RA.apply(this,arguments)}/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const TT="166",ny={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},ry={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},see=0,HO=1,oee=2,Vme=3,aee=0,SL=1,BS=2,Pf=3,Rh=0,Mc=1,bc=2,rp=0,Cy=1,Wb=2,jO=3,WO=4,lee=5,D0=100,cee=101,uee=102,hee=103,fee=104,dee=200,pee=201,mee=202,gee=203,TR=204,MR=205,vee=206,_ee=207,yee=208,xee=209,bee=210,wee=211,See=212,Aee=213,Tee=214,Mee=0,Cee=1,Eee=2,PA=3,Iee=4,Ree=5,Pee=6,Lee=7,MT=0,Dee=1,Bee=2,ip=0,kee=1,Oee=2,AL=3,TL=4,Fee=5,Nee=6,zee=7,XO="attached",Uee="detached",ML=300,Um=301,av=302,LA=303,DA=304,uw=306,Ph=1e3,ru=1001,jy=1002,wa=1003,CT=1004,Gme=1004,z0=1005,Hme=1005,Co=1006,Ey=1007,jme=1007,iu=1008,Wme=1008,Xf=1009,Qz=1010,e6=1011,Xb=1012,CL=1013,Vm=1014,Sc=1015,Ah=1016,EL=1017,IL=1018,Wy=1020,t6=35902,n6=1021,r6=1022,jl=1023,i6=1024,s6=1025,Iy=1026,Xy=1027,ET=1028,IT=1029,o6=1030,RL=1031,Xme=1032,PL=1033,kS=33776,OS=33777,FS=33778,NS=33779,CR=35840,ER=35841,IR=35842,RR=35843,PR=36196,LR=37492,DR=37496,BR=37808,kR=37809,OR=37810,FR=37811,NR=37812,zR=37813,UR=37814,VR=37815,GR=37816,HR=37817,jR=37818,WR=37819,XR=37820,$R=37821,zS=36492,qR=36494,ZR=36495,a6=36283,YR=36284,KR=36285,JR=36286,Vee=2200,Gee=2201,Hee=2202,$y=2300,lv=2301,PI=2302,dy=2400,py=2401,BA=2402,LL=2500,l6=2501,c6=0,RT=1,qy=2,jee=3200,Wee=3201,Av=0,Xee=1,bm="",Ao="srgb",Ga="srgb-linear",DL="display-p3",PT="display-p3-linear",kA="linear",eo="srgb",OA="rec709",FA="p3",$me=0,iy=7680,qme=7681,Zme=7682,Yme=7683,Kme=34055,Jme=34056,Qme=5386,ege=512,tge=513,nge=514,rge=515,ige=516,sge=517,oge=518,$O=519,$ee=512,qee=513,Zee=514,u6=515,Yee=516,Kee=517,Jee=518,Qee=519,NA=35044,age=35048,lge=35040,cge=35045,uge=35049,hge=35041,fge=35046,dge=35050,pge=35042,mge="100",qO="300 es",Yd=2e3,zA=2001;class pp{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[e]===void 0&&(r[e]=[]),r[e].indexOf(t)===-1&&r[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const r=this._listeners;return r[e]!==void 0&&r[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const i=this._listeners[e];if(i!==void 0){const s=i.indexOf(t);s!==-1&&i.splice(s,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const r=this._listeners[e.type];if(r!==void 0){e.target=this;const i=r.slice(0);for(let s=0,a=i.length;s<a;s++)i[s].call(this,e);e.target=null}}}const Dl=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let kH=1234567;const Ry=Math.PI/180,$b=180/Math.PI;function Lu(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(Dl[n&255]+Dl[n>>8&255]+Dl[n>>16&255]+Dl[n>>24&255]+"-"+Dl[e&255]+Dl[e>>8&255]+"-"+Dl[e>>16&15|64]+Dl[e>>24&255]+"-"+Dl[t&63|128]+Dl[t>>8&255]+"-"+Dl[t>>16&255]+Dl[t>>24&255]+Dl[r&255]+Dl[r>>8&255]+Dl[r>>16&255]+Dl[r>>24&255]).toLowerCase()}function ea(n,e,t){return Math.max(e,Math.min(t,n))}function h6(n,e){return(n%e+e)%e}function gge(n,e,t,r,i){return r+(n-e)*(i-r)/(t-e)}function vge(n,e,t){return n!==e?(t-n)/(e-n):0}function US(n,e,t){return(1-t)*n+t*e}function _ge(n,e,t,r){return US(n,e,1-Math.exp(-t*r))}function yge(n,e=1){return e-Math.abs(h6(n,e*2)-e)}function xge(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*(3-2*n))}function bge(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*n*(n*(n*6-15)+10))}function wge(n,e){return n+Math.floor(Math.random()*(e-n+1))}function Sge(n,e){return n+Math.random()*(e-n)}function Age(n){return n*(.5-Math.random())}function Tge(n){n!==void 0&&(kH=n);let e=kH+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function Mge(n){return n*Ry}function Cge(n){return n*$b}function Ege(n){return(n&n-1)===0&&n!==0}function Ige(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function Rge(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function Pge(n,e,t,r,i){const s=Math.cos,a=Math.sin,l=s(t/2),o=a(t/2),h=s((e+r)/2),d=a((e+r)/2),m=s((e-r)/2),_=a((e-r)/2),y=s((r-e)/2),T=a((r-e)/2);switch(i){case"XYX":n.set(l*d,o*m,o*_,l*h);break;case"YZY":n.set(o*_,l*d,o*m,l*h);break;case"ZXZ":n.set(o*m,o*_,l*d,l*h);break;case"XZX":n.set(l*d,o*T,o*y,l*h);break;case"YXY":n.set(o*y,l*d,o*T,l*h);break;case"ZYZ":n.set(o*T,o*y,l*d,l*h);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}function wc(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function wi(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return Math.round(n*4294967295);case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int32Array:return Math.round(n*2147483647);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}const to={DEG2RAD:Ry,RAD2DEG:$b,generateUUID:Lu,clamp:ea,euclideanModulo:h6,mapLinear:gge,inverseLerp:vge,lerp:US,damp:_ge,pingpong:yge,smoothstep:xge,smootherstep:bge,randInt:wge,randFloat:Sge,randFloatSpread:Age,seededRandom:Tge,degToRad:Mge,radToDeg:Cge,isPowerOfTwo:Ege,ceilPowerOfTwo:Ige,floorPowerOfTwo:Rge,setQuaternionFromProperEuler:Pge,normalize:wi,denormalize:wc};class nn{constructor(e=0,t=0){nn.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,r=this.y,i=e.elements;return this.x=i[0]*t+i[3]*r+i[6],this.y=i[1]*t+i[4]*r+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const r=this.dot(e)/t;return Math.acos(ea(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y;return t*t+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const r=Math.cos(t),i=Math.sin(t),s=this.x-e.x,a=this.y-e.y;return this.x=s*r-a*i+e.x,this.y=s*i+a*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class bi{constructor(e,t,r,i,s,a,l,o,h){bi.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,r,i,s,a,l,o,h)}set(e,t,r,i,s,a,l,o,h){const d=this.elements;return d[0]=e,d[1]=i,d[2]=l,d[3]=t,d[4]=s,d[5]=o,d[6]=r,d[7]=a,d[8]=h,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],this}extractBasis(e,t,r){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,i=t.elements,s=this.elements,a=r[0],l=r[3],o=r[6],h=r[1],d=r[4],m=r[7],_=r[2],y=r[5],T=r[8],I=i[0],C=i[3],M=i[6],B=i[1],k=i[4],j=i[7],q=i[2],Z=i[5],te=i[8];return s[0]=a*I+l*B+o*q,s[3]=a*C+l*k+o*Z,s[6]=a*M+l*j+o*te,s[1]=h*I+d*B+m*q,s[4]=h*C+d*k+m*Z,s[7]=h*M+d*j+m*te,s[2]=_*I+y*B+T*q,s[5]=_*C+y*k+T*Z,s[8]=_*M+y*j+T*te,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[1],i=e[2],s=e[3],a=e[4],l=e[5],o=e[6],h=e[7],d=e[8];return t*a*d-t*l*h-r*s*d+r*l*o+i*s*h-i*a*o}invert(){const e=this.elements,t=e[0],r=e[1],i=e[2],s=e[3],a=e[4],l=e[5],o=e[6],h=e[7],d=e[8],m=d*a-l*h,_=l*o-d*s,y=h*s-a*o,T=t*m+r*_+i*y;if(T===0)return this.set(0,0,0,0,0,0,0,0,0);const I=1/T;return e[0]=m*I,e[1]=(i*h-d*r)*I,e[2]=(l*r-i*a)*I,e[3]=_*I,e[4]=(d*t-i*o)*I,e[5]=(i*s-l*t)*I,e[6]=y*I,e[7]=(r*o-h*t)*I,e[8]=(a*t-r*s)*I,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,r,i,s,a,l){const o=Math.cos(s),h=Math.sin(s);return this.set(r*o,r*h,-r*(o*a+h*l)+a+e,-i*h,i*o,-i*(-h*a+o*l)+l+t,0,0,1),this}scale(e,t){return this.premultiply(G4.makeScale(e,t)),this}rotate(e){return this.premultiply(G4.makeRotation(-e)),this}translate(e,t){return this.premultiply(G4.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,r,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,r=e.elements;for(let i=0;i<9;i++)if(t[i]!==r[i])return!1;return!0}fromArray(e,t=0){for(let r=0;r<9;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const G4=new bi;function ete(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}const Lge={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function ab(n,e){return new Lge[n](e)}function UA(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function tte(){const n=UA("canvas");return n.style.display="block",n}const OH={};function f6(n){n in OH||(OH[n]=!0,console.warn(n))}function Dge(n,e,t){return new Promise(function(r,i){function s(){switch(n.clientWaitSync(e,n.SYNC_FLUSH_COMMANDS_BIT,0)){case n.WAIT_FAILED:i();break;case n.TIMEOUT_EXPIRED:setTimeout(s,t);break;default:r()}}setTimeout(s,t)})}const FH=new bi().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),NH=new bi().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),gC={[Ga]:{transfer:kA,primaries:OA,toReference:n=>n,fromReference:n=>n},[Ao]:{transfer:eo,primaries:OA,toReference:n=>n.convertSRGBToLinear(),fromReference:n=>n.convertLinearToSRGB()},[PT]:{transfer:kA,primaries:FA,toReference:n=>n.applyMatrix3(NH),fromReference:n=>n.applyMatrix3(FH)},[DL]:{transfer:eo,primaries:FA,toReference:n=>n.convertSRGBToLinear().applyMatrix3(NH),fromReference:n=>n.applyMatrix3(FH).convertLinearToSRGB()}},Bge=new Set([Ga,PT]),ds={enabled:!0,_workingColorSpace:Ga,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(n){if(!Bge.has(n))throw new Error(`Unsupported working color space, "${n}".`);this._workingColorSpace=n},convert:function(n,e,t){if(this.enabled===!1||e===t||!e||!t)return n;const r=gC[e].toReference,i=gC[t].fromReference;return i(r(n))},fromWorkingColorSpace:function(n,e){return this.convert(n,this._workingColorSpace,e)},toWorkingColorSpace:function(n,e){return this.convert(n,e,this._workingColorSpace)},getPrimaries:function(n){return gC[n].primaries},getTransfer:function(n){return n===bm?kA:gC[n].transfer}};function Tb(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function H4(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}let Qx;class nte{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{Qx===void 0&&(Qx=UA("canvas")),Qx.width=e.width,Qx.height=e.height;const r=Qx.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),t=Qx}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=UA("canvas");t.width=e.width,t.height=e.height;const r=t.getContext("2d");r.drawImage(e,0,0,e.width,e.height);const i=r.getImageData(0,0,e.width,e.height),s=i.data;for(let a=0;a<s.length;a++)s[a]=Tb(s[a]/255)*255;return r.putImageData(i,0,0),t}else if(e.data){const t=e.data.slice(0);for(let r=0;r<t.length;r++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[r]=Math.floor(Tb(t[r]/255)*255):t[r]=Tb(t[r]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let kge=0;class my{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:kge++}),this.uuid=Lu(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const r={uuid:this.uuid,url:""},i=this.data;if(i!==null){let s;if(Array.isArray(i)){s=[];for(let a=0,l=i.length;a<l;a++)i[a].isDataTexture?s.push(j4(i[a].image)):s.push(j4(i[a]))}else s=j4(i);r.url=s}return t||(e.images[this.uuid]=r),r}}function j4(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?nte.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Oge=0;class Ws extends pp{constructor(e=Ws.DEFAULT_IMAGE,t=Ws.DEFAULT_MAPPING,r=ru,i=ru,s=Co,a=iu,l=jl,o=Xf,h=Ws.DEFAULT_ANISOTROPY,d=bm){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Oge++}),this.uuid=Lu(),this.name="",this.source=new my(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=r,this.wrapT=i,this.magFilter=s,this.minFilter=a,this.anisotropy=h,this.format=l,this.internalFormat=null,this.type=o,this.offset=new nn(0,0),this.repeat=new nn(1,1),this.center=new nn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new bi,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=d,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const r={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),t||(e.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==ML)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Ph:e.x=e.x-Math.floor(e.x);break;case ru:e.x=e.x<0?0:1;break;case jy:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Ph:e.y=e.y-Math.floor(e.y);break;case ru:e.y=e.y<0?0:1;break;case jy:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}Ws.DEFAULT_IMAGE=null;Ws.DEFAULT_MAPPING=ML;Ws.DEFAULT_ANISOTROPY=1;class Es{constructor(e=0,t=0,r=0,i=1){Es.prototype.isVector4=!0,this.x=e,this.y=t,this.z=r,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,r,i){return this.x=e,this.y=t,this.z=r,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,r=this.y,i=this.z,s=this.w,a=e.elements;return this.x=a[0]*t+a[4]*r+a[8]*i+a[12]*s,this.y=a[1]*t+a[5]*r+a[9]*i+a[13]*s,this.z=a[2]*t+a[6]*r+a[10]*i+a[14]*s,this.w=a[3]*t+a[7]*r+a[11]*i+a[15]*s,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,r,i,s;const o=e.elements,h=o[0],d=o[4],m=o[8],_=o[1],y=o[5],T=o[9],I=o[2],C=o[6],M=o[10];if(Math.abs(d-_)<.01&&Math.abs(m-I)<.01&&Math.abs(T-C)<.01){if(Math.abs(d+_)<.1&&Math.abs(m+I)<.1&&Math.abs(T+C)<.1&&Math.abs(h+y+M-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const k=(h+1)/2,j=(y+1)/2,q=(M+1)/2,Z=(d+_)/4,te=(m+I)/4,ie=(T+C)/4;return k>j&&k>q?k<.01?(r=0,i=.707106781,s=.707106781):(r=Math.sqrt(k),i=Z/r,s=te/r):j>q?j<.01?(r=.707106781,i=0,s=.707106781):(i=Math.sqrt(j),r=Z/i,s=ie/i):q<.01?(r=.707106781,i=.707106781,s=0):(s=Math.sqrt(q),r=te/s,i=ie/s),this.set(r,i,s,t),this}let B=Math.sqrt((C-T)*(C-T)+(m-I)*(m-I)+(_-d)*(_-d));return Math.abs(B)<.001&&(B=1),this.x=(C-T)/B,this.y=(m-I)/B,this.z=(_-d)/B,this.w=Math.acos((h+y+M-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this.w=e.w+(t.w-e.w)*r,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class rte extends pp{constructor(e=1,t=1,r={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Es(0,0,e,t),this.scissorTest=!1,this.viewport=new Es(0,0,e,t);const i={width:e,height:t,depth:1};r=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Co,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},r);const s=new Ws(i,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.colorSpace);s.flipY=!1,s.generateMipmaps=r.generateMipmaps,s.internalFormat=r.internalFormat,this.textures=[];const a=r.count;for(let l=0;l<a;l++)this.textures[l]=s.clone(),this.textures[l].isRenderTargetTexture=!0;this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,this.resolveDepthBuffer=r.resolveDepthBuffer,this.resolveStencilBuffer=r.resolveStencilBuffer,this.depthTexture=r.depthTexture,this.samples=r.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}setSize(e,t,r=1){if(this.width!==e||this.height!==t||this.depth!==r){this.width=e,this.height=t,this.depth=r;for(let i=0,s=this.textures.length;i<s;i++)this.textures[i].image.width=e,this.textures[i].image.height=t,this.textures[i].image.depth=r;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let r=0,i=e.textures.length;r<i;r++)this.textures[r]=e.textures[r].clone(),this.textures[r].isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new my(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class bl extends rte{constructor(e=1,t=1,r={}){super(e,t,r),this.isWebGLRenderTarget=!0}}class BL extends Ws{constructor(e=null,t=1,r=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:r,depth:i},this.magFilter=wa,this.minFilter=wa,this.wrapR=ru,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class Fge extends bl{constructor(e=1,t=1,r=1,i={}){super(e,t,i),this.isWebGLArrayRenderTarget=!0,this.depth=r,this.texture=new BL(null,e,t,r),this.texture.isRenderTargetTexture=!0}}class d6 extends Ws{constructor(e=null,t=1,r=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:r,depth:i},this.magFilter=wa,this.minFilter=wa,this.wrapR=ru,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Nge extends bl{constructor(e=1,t=1,r=1,i={}){super(e,t,i),this.isWebGL3DRenderTarget=!0,this.depth=r,this.texture=new d6(null,e,t,r),this.texture.isRenderTargetTexture=!0}}class Aa{constructor(e=0,t=0,r=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=r,this._w=i}static slerpFlat(e,t,r,i,s,a,l){let o=r[i+0],h=r[i+1],d=r[i+2],m=r[i+3];const _=s[a+0],y=s[a+1],T=s[a+2],I=s[a+3];if(l===0){e[t+0]=o,e[t+1]=h,e[t+2]=d,e[t+3]=m;return}if(l===1){e[t+0]=_,e[t+1]=y,e[t+2]=T,e[t+3]=I;return}if(m!==I||o!==_||h!==y||d!==T){let C=1-l;const M=o*_+h*y+d*T+m*I,B=M>=0?1:-1,k=1-M*M;if(k>Number.EPSILON){const q=Math.sqrt(k),Z=Math.atan2(q,M*B);C=Math.sin(C*Z)/q,l=Math.sin(l*Z)/q}const j=l*B;if(o=o*C+_*j,h=h*C+y*j,d=d*C+T*j,m=m*C+I*j,C===1-l){const q=1/Math.sqrt(o*o+h*h+d*d+m*m);o*=q,h*=q,d*=q,m*=q}}e[t]=o,e[t+1]=h,e[t+2]=d,e[t+3]=m}static multiplyQuaternionsFlat(e,t,r,i,s,a){const l=r[i],o=r[i+1],h=r[i+2],d=r[i+3],m=s[a],_=s[a+1],y=s[a+2],T=s[a+3];return e[t]=l*T+d*m+o*y-h*_,e[t+1]=o*T+d*_+h*m-l*y,e[t+2]=h*T+d*y+l*_-o*m,e[t+3]=d*T-l*m-o*_-h*y,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,r,i){return this._x=e,this._y=t,this._z=r,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const r=e._x,i=e._y,s=e._z,a=e._order,l=Math.cos,o=Math.sin,h=l(r/2),d=l(i/2),m=l(s/2),_=o(r/2),y=o(i/2),T=o(s/2);switch(a){case"XYZ":this._x=_*d*m+h*y*T,this._y=h*y*m-_*d*T,this._z=h*d*T+_*y*m,this._w=h*d*m-_*y*T;break;case"YXZ":this._x=_*d*m+h*y*T,this._y=h*y*m-_*d*T,this._z=h*d*T-_*y*m,this._w=h*d*m+_*y*T;break;case"ZXY":this._x=_*d*m-h*y*T,this._y=h*y*m+_*d*T,this._z=h*d*T+_*y*m,this._w=h*d*m-_*y*T;break;case"ZYX":this._x=_*d*m-h*y*T,this._y=h*y*m+_*d*T,this._z=h*d*T-_*y*m,this._w=h*d*m+_*y*T;break;case"YZX":this._x=_*d*m+h*y*T,this._y=h*y*m+_*d*T,this._z=h*d*T-_*y*m,this._w=h*d*m-_*y*T;break;case"XZY":this._x=_*d*m-h*y*T,this._y=h*y*m-_*d*T,this._z=h*d*T+_*y*m,this._w=h*d*m+_*y*T;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const r=t/2,i=Math.sin(r);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,r=t[0],i=t[4],s=t[8],a=t[1],l=t[5],o=t[9],h=t[2],d=t[6],m=t[10],_=r+l+m;if(_>0){const y=.5/Math.sqrt(_+1);this._w=.25/y,this._x=(d-o)*y,this._y=(s-h)*y,this._z=(a-i)*y}else if(r>l&&r>m){const y=2*Math.sqrt(1+r-l-m);this._w=(d-o)/y,this._x=.25*y,this._y=(i+a)/y,this._z=(s+h)/y}else if(l>m){const y=2*Math.sqrt(1+l-r-m);this._w=(s-h)/y,this._x=(i+a)/y,this._y=.25*y,this._z=(o+d)/y}else{const y=2*Math.sqrt(1+m-r-l);this._w=(a-i)/y,this._x=(s+h)/y,this._y=(o+d)/y,this._z=.25*y}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let r=e.dot(t)+1;return r<Number.EPSILON?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=r),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(ea(this.dot(e),-1,1)))}rotateTowards(e,t){const r=this.angleTo(e);if(r===0)return this;const i=Math.min(1,t/r);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const r=e._x,i=e._y,s=e._z,a=e._w,l=t._x,o=t._y,h=t._z,d=t._w;return this._x=r*d+a*l+i*h-s*o,this._y=i*d+a*o+s*l-r*h,this._z=s*d+a*h+r*o-i*l,this._w=a*d-r*l-i*o-s*h,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const r=this._x,i=this._y,s=this._z,a=this._w;let l=a*e._w+r*e._x+i*e._y+s*e._z;if(l<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,l=-l):this.copy(e),l>=1)return this._w=a,this._x=r,this._y=i,this._z=s,this;const o=1-l*l;if(o<=Number.EPSILON){const y=1-t;return this._w=y*a+t*this._w,this._x=y*r+t*this._x,this._y=y*i+t*this._y,this._z=y*s+t*this._z,this.normalize(),this}const h=Math.sqrt(o),d=Math.atan2(h,l),m=Math.sin((1-t)*d)/h,_=Math.sin(t*d)/h;return this._w=a*m+this._w*_,this._x=r*m+this._x*_,this._y=i*m+this._y*_,this._z=s*m+this._z*_,this._onChangeCallback(),this}slerpQuaternions(e,t,r){return this.copy(e).slerp(t,r)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),r=Math.random(),i=Math.sqrt(1-r),s=Math.sqrt(r);return this.set(i*Math.sin(e),i*Math.cos(e),s*Math.sin(t),s*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Ze{constructor(e=0,t=0,r=0){Ze.prototype.isVector3=!0,this.x=e,this.y=t,this.z=r}set(e,t,r){return r===void 0&&(r=this.z),this.x=e,this.y=t,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(zH.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(zH.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,r=this.y,i=this.z,s=e.elements;return this.x=s[0]*t+s[3]*r+s[6]*i,this.y=s[1]*t+s[4]*r+s[7]*i,this.z=s[2]*t+s[5]*r+s[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,r=this.y,i=this.z,s=e.elements,a=1/(s[3]*t+s[7]*r+s[11]*i+s[15]);return this.x=(s[0]*t+s[4]*r+s[8]*i+s[12])*a,this.y=(s[1]*t+s[5]*r+s[9]*i+s[13])*a,this.z=(s[2]*t+s[6]*r+s[10]*i+s[14])*a,this}applyQuaternion(e){const t=this.x,r=this.y,i=this.z,s=e.x,a=e.y,l=e.z,o=e.w,h=2*(a*i-l*r),d=2*(l*t-s*i),m=2*(s*r-a*t);return this.x=t+o*h+a*m-l*d,this.y=r+o*d+l*h-s*m,this.z=i+o*m+s*d-a*h,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,r=this.y,i=this.z,s=e.elements;return this.x=s[0]*t+s[4]*r+s[8]*i,this.y=s[1]*t+s[5]*r+s[9]*i,this.z=s[2]*t+s[6]*r+s[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const r=e.x,i=e.y,s=e.z,a=t.x,l=t.y,o=t.z;return this.x=i*o-s*l,this.y=s*a-r*o,this.z=r*l-i*a,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const r=e.dot(this)/t;return this.copy(e).multiplyScalar(r)}projectOnPlane(e){return W4.copy(this).projectOnVector(e),this.sub(W4)}reflect(e){return this.sub(W4.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const r=this.dot(e)/t;return Math.acos(ea(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y,i=this.z-e.z;return t*t+r*r+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,r){const i=Math.sin(t)*e;return this.x=i*Math.sin(r),this.y=Math.cos(t)*e,this.z=i*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,r){return this.x=e*Math.sin(t),this.y=r,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,r=Math.sqrt(1-t*t);return this.x=r*Math.cos(e),this.y=t,this.z=r*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const W4=new Ze,zH=new Aa;class wl{constructor(e=new Ze(1/0,1/0,1/0),t=new Ze(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t+=3)this.expandByPoint(wf.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,r=e.count;t<r;t++)this.expandByPoint(wf.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const r=wf.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const r=e.geometry;if(r!==void 0){const s=r.getAttribute("position");if(t===!0&&s!==void 0&&e.isInstancedMesh!==!0)for(let a=0,l=s.count;a<l;a++)e.isMesh===!0?e.getVertexPosition(a,wf):wf.fromBufferAttribute(s,a),wf.applyMatrix4(e.matrixWorld),this.expandByPoint(wf);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),vC.copy(e.boundingBox)):(r.boundingBox===null&&r.computeBoundingBox(),vC.copy(r.boundingBox)),vC.applyMatrix4(e.matrixWorld),this.union(vC)}const i=e.children;for(let s=0,a=i.length;s<a;s++)this.expandByObject(i[s],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,wf),wf.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,r;return e.normal.x>0?(t=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=-e.constant&&r>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(v2),_C.subVectors(this.max,v2),e1.subVectors(e.a,v2),t1.subVectors(e.b,v2),n1.subVectors(e.c,v2),i0.subVectors(t1,e1),s0.subVectors(n1,t1),m_.subVectors(e1,n1);let t=[0,-i0.z,i0.y,0,-s0.z,s0.y,0,-m_.z,m_.y,i0.z,0,-i0.x,s0.z,0,-s0.x,m_.z,0,-m_.x,-i0.y,i0.x,0,-s0.y,s0.x,0,-m_.y,m_.x,0];return!X4(t,e1,t1,n1,_C)||(t=[1,0,0,0,1,0,0,0,1],!X4(t,e1,t1,n1,_C))?!1:(yC.crossVectors(i0,s0),t=[yC.x,yC.y,yC.z],X4(t,e1,t1,n1,_C))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,wf).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(wf).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(sm[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),sm[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),sm[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),sm[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),sm[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),sm[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),sm[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),sm[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(sm),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const sm=[new Ze,new Ze,new Ze,new Ze,new Ze,new Ze,new Ze,new Ze],wf=new Ze,vC=new wl,e1=new Ze,t1=new Ze,n1=new Ze,i0=new Ze,s0=new Ze,m_=new Ze,v2=new Ze,_C=new Ze,yC=new Ze,g_=new Ze;function X4(n,e,t,r,i){for(let s=0,a=n.length-3;s<=a;s+=3){g_.fromArray(n,s);const l=i.x*Math.abs(g_.x)+i.y*Math.abs(g_.y)+i.z*Math.abs(g_.z),o=e.dot(g_),h=t.dot(g_),d=r.dot(g_);if(Math.max(-Math.max(o,h,d),Math.min(o,h,d))>l)return!1}return!0}const zge=new wl,_2=new Ze,$4=new Ze;class rl{constructor(e=new Ze,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const r=this.center;t!==void 0?r.copy(t):zge.setFromPoints(e).getCenter(r);let i=0;for(let s=0,a=e.length;s<a;s++)i=Math.max(i,r.distanceToSquared(e[s]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const r=this.center.distanceToSquared(e);return t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;_2.subVectors(e,this.center);const t=_2.lengthSq();if(t>this.radius*this.radius){const r=Math.sqrt(t),i=(r-this.radius)*.5;this.center.addScaledVector(_2,i/r),this.radius+=i}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):($4.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(_2.copy(e.center).add($4)),this.expandByPoint(_2.copy(e.center).sub($4))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const om=new Ze,q4=new Ze,xC=new Ze,o0=new Ze,Z4=new Ze,bC=new Ze,Y4=new Ze;class hx{constructor(e=new Ze,t=new Ze(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,om)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const r=t.dot(this.direction);return r<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,r)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=om.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(om.copy(this.origin).addScaledVector(this.direction,t),om.distanceToSquared(e))}distanceSqToSegment(e,t,r,i){q4.copy(e).add(t).multiplyScalar(.5),xC.copy(t).sub(e).normalize(),o0.copy(this.origin).sub(q4);const s=e.distanceTo(t)*.5,a=-this.direction.dot(xC),l=o0.dot(this.direction),o=-o0.dot(xC),h=o0.lengthSq(),d=Math.abs(1-a*a);let m,_,y,T;if(d>0)if(m=a*o-l,_=a*l-o,T=s*d,m>=0)if(_>=-T)if(_<=T){const I=1/d;m*=I,_*=I,y=m*(m+a*_+2*l)+_*(a*m+_+2*o)+h}else _=s,m=Math.max(0,-(a*_+l)),y=-m*m+_*(_+2*o)+h;else _=-s,m=Math.max(0,-(a*_+l)),y=-m*m+_*(_+2*o)+h;else _<=-T?(m=Math.max(0,-(-a*s+l)),_=m>0?-s:Math.min(Math.max(-s,-o),s),y=-m*m+_*(_+2*o)+h):_<=T?(m=0,_=Math.min(Math.max(-s,-o),s),y=_*(_+2*o)+h):(m=Math.max(0,-(a*s+l)),_=m>0?s:Math.min(Math.max(-s,-o),s),y=-m*m+_*(_+2*o)+h);else _=a>0?-s:s,m=Math.max(0,-(a*_+l)),y=-m*m+_*(_+2*o)+h;return r&&r.copy(this.origin).addScaledVector(this.direction,m),i&&i.copy(q4).addScaledVector(xC,_),y}intersectSphere(e,t){om.subVectors(e.center,this.origin);const r=om.dot(this.direction),i=om.dot(om)-r*r,s=e.radius*e.radius;if(i>s)return null;const a=Math.sqrt(s-i),l=r-a,o=r+a;return o<0?null:l<0?this.at(o,t):this.at(l,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null}intersectPlane(e,t){const r=this.distanceToPlane(e);return r===null?null:this.at(r,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let r,i,s,a,l,o;const h=1/this.direction.x,d=1/this.direction.y,m=1/this.direction.z,_=this.origin;return h>=0?(r=(e.min.x-_.x)*h,i=(e.max.x-_.x)*h):(r=(e.max.x-_.x)*h,i=(e.min.x-_.x)*h),d>=0?(s=(e.min.y-_.y)*d,a=(e.max.y-_.y)*d):(s=(e.max.y-_.y)*d,a=(e.min.y-_.y)*d),r>a||s>i||((s>r||isNaN(r))&&(r=s),(a<i||isNaN(i))&&(i=a),m>=0?(l=(e.min.z-_.z)*m,o=(e.max.z-_.z)*m):(l=(e.max.z-_.z)*m,o=(e.min.z-_.z)*m),r>o||l>i)||((l>r||r!==r)&&(r=l),(o<i||i!==i)&&(i=o),i<0)?null:this.at(r>=0?r:i,t)}intersectsBox(e){return this.intersectBox(e,om)!==null}intersectTriangle(e,t,r,i,s){Z4.subVectors(t,e),bC.subVectors(r,e),Y4.crossVectors(Z4,bC);let a=this.direction.dot(Y4),l;if(a>0){if(i)return null;l=1}else if(a<0)l=-1,a=-a;else return null;o0.subVectors(this.origin,e);const o=l*this.direction.dot(bC.crossVectors(o0,bC));if(o<0)return null;const h=l*this.direction.dot(Z4.cross(o0));if(h<0||o+h>a)return null;const d=-l*o0.dot(Y4);return d<0?null:this.at(d/a,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Vr{constructor(e,t,r,i,s,a,l,o,h,d,m,_,y,T,I,C){Vr.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,r,i,s,a,l,o,h,d,m,_,y,T,I,C)}set(e,t,r,i,s,a,l,o,h,d,m,_,y,T,I,C){const M=this.elements;return M[0]=e,M[4]=t,M[8]=r,M[12]=i,M[1]=s,M[5]=a,M[9]=l,M[13]=o,M[2]=h,M[6]=d,M[10]=m,M[14]=_,M[3]=y,M[7]=T,M[11]=I,M[15]=C,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Vr().fromArray(this.elements)}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],this}copyPosition(e){const t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,r=e.elements,i=1/r1.setFromMatrixColumn(e,0).length(),s=1/r1.setFromMatrixColumn(e,1).length(),a=1/r1.setFromMatrixColumn(e,2).length();return t[0]=r[0]*i,t[1]=r[1]*i,t[2]=r[2]*i,t[3]=0,t[4]=r[4]*s,t[5]=r[5]*s,t[6]=r[6]*s,t[7]=0,t[8]=r[8]*a,t[9]=r[9]*a,t[10]=r[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,r=e.x,i=e.y,s=e.z,a=Math.cos(r),l=Math.sin(r),o=Math.cos(i),h=Math.sin(i),d=Math.cos(s),m=Math.sin(s);if(e.order==="XYZ"){const _=a*d,y=a*m,T=l*d,I=l*m;t[0]=o*d,t[4]=-o*m,t[8]=h,t[1]=y+T*h,t[5]=_-I*h,t[9]=-l*o,t[2]=I-_*h,t[6]=T+y*h,t[10]=a*o}else if(e.order==="YXZ"){const _=o*d,y=o*m,T=h*d,I=h*m;t[0]=_+I*l,t[4]=T*l-y,t[8]=a*h,t[1]=a*m,t[5]=a*d,t[9]=-l,t[2]=y*l-T,t[6]=I+_*l,t[10]=a*o}else if(e.order==="ZXY"){const _=o*d,y=o*m,T=h*d,I=h*m;t[0]=_-I*l,t[4]=-a*m,t[8]=T+y*l,t[1]=y+T*l,t[5]=a*d,t[9]=I-_*l,t[2]=-a*h,t[6]=l,t[10]=a*o}else if(e.order==="ZYX"){const _=a*d,y=a*m,T=l*d,I=l*m;t[0]=o*d,t[4]=T*h-y,t[8]=_*h+I,t[1]=o*m,t[5]=I*h+_,t[9]=y*h-T,t[2]=-h,t[6]=l*o,t[10]=a*o}else if(e.order==="YZX"){const _=a*o,y=a*h,T=l*o,I=l*h;t[0]=o*d,t[4]=I-_*m,t[8]=T*m+y,t[1]=m,t[5]=a*d,t[9]=-l*d,t[2]=-h*d,t[6]=y*m+T,t[10]=_-I*m}else if(e.order==="XZY"){const _=a*o,y=a*h,T=l*o,I=l*h;t[0]=o*d,t[4]=-m,t[8]=h*d,t[1]=_*m+I,t[5]=a*d,t[9]=y*m-T,t[2]=T*m-y,t[6]=l*d,t[10]=I*m+_}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Uge,e,Vge)}lookAt(e,t,r){const i=this.elements;return Tu.subVectors(e,t),Tu.lengthSq()===0&&(Tu.z=1),Tu.normalize(),a0.crossVectors(r,Tu),a0.lengthSq()===0&&(Math.abs(r.z)===1?Tu.x+=1e-4:Tu.z+=1e-4,Tu.normalize(),a0.crossVectors(r,Tu)),a0.normalize(),wC.crossVectors(Tu,a0),i[0]=a0.x,i[4]=wC.x,i[8]=Tu.x,i[1]=a0.y,i[5]=wC.y,i[9]=Tu.y,i[2]=a0.z,i[6]=wC.z,i[10]=Tu.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,i=t.elements,s=this.elements,a=r[0],l=r[4],o=r[8],h=r[12],d=r[1],m=r[5],_=r[9],y=r[13],T=r[2],I=r[6],C=r[10],M=r[14],B=r[3],k=r[7],j=r[11],q=r[15],Z=i[0],te=i[4],ie=i[8],se=i[12],ae=i[1],fe=i[5],Se=i[9],Ee=i[13],Re=i[2],qe=i[6],Le=i[10],dt=i[14],ye=i[3],Xe=i[7],He=i[11],_t=i[15];return s[0]=a*Z+l*ae+o*Re+h*ye,s[4]=a*te+l*fe+o*qe+h*Xe,s[8]=a*ie+l*Se+o*Le+h*He,s[12]=a*se+l*Ee+o*dt+h*_t,s[1]=d*Z+m*ae+_*Re+y*ye,s[5]=d*te+m*fe+_*qe+y*Xe,s[9]=d*ie+m*Se+_*Le+y*He,s[13]=d*se+m*Ee+_*dt+y*_t,s[2]=T*Z+I*ae+C*Re+M*ye,s[6]=T*te+I*fe+C*qe+M*Xe,s[10]=T*ie+I*Se+C*Le+M*He,s[14]=T*se+I*Ee+C*dt+M*_t,s[3]=B*Z+k*ae+j*Re+q*ye,s[7]=B*te+k*fe+j*qe+q*Xe,s[11]=B*ie+k*Se+j*Le+q*He,s[15]=B*se+k*Ee+j*dt+q*_t,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[4],i=e[8],s=e[12],a=e[1],l=e[5],o=e[9],h=e[13],d=e[2],m=e[6],_=e[10],y=e[14],T=e[3],I=e[7],C=e[11],M=e[15];return T*(+s*o*m-i*h*m-s*l*_+r*h*_+i*l*y-r*o*y)+I*(+t*o*y-t*h*_+s*a*_-i*a*y+i*h*d-s*o*d)+C*(+t*h*m-t*l*y-s*a*m+r*a*y+s*l*d-r*h*d)+M*(-i*l*d-t*o*m+t*l*_+i*a*m-r*a*_+r*o*d)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,r){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=r),this}invert(){const e=this.elements,t=e[0],r=e[1],i=e[2],s=e[3],a=e[4],l=e[5],o=e[6],h=e[7],d=e[8],m=e[9],_=e[10],y=e[11],T=e[12],I=e[13],C=e[14],M=e[15],B=m*C*h-I*_*h+I*o*y-l*C*y-m*o*M+l*_*M,k=T*_*h-d*C*h-T*o*y+a*C*y+d*o*M-a*_*M,j=d*I*h-T*m*h+T*l*y-a*I*y-d*l*M+a*m*M,q=T*m*o-d*I*o-T*l*_+a*I*_+d*l*C-a*m*C,Z=t*B+r*k+i*j+s*q;if(Z===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const te=1/Z;return e[0]=B*te,e[1]=(I*_*s-m*C*s-I*i*y+r*C*y+m*i*M-r*_*M)*te,e[2]=(l*C*s-I*o*s+I*i*h-r*C*h-l*i*M+r*o*M)*te,e[3]=(m*o*s-l*_*s-m*i*h+r*_*h+l*i*y-r*o*y)*te,e[4]=k*te,e[5]=(d*C*s-T*_*s+T*i*y-t*C*y-d*i*M+t*_*M)*te,e[6]=(T*o*s-a*C*s-T*i*h+t*C*h+a*i*M-t*o*M)*te,e[7]=(a*_*s-d*o*s+d*i*h-t*_*h-a*i*y+t*o*y)*te,e[8]=j*te,e[9]=(T*m*s-d*I*s-T*r*y+t*I*y+d*r*M-t*m*M)*te,e[10]=(a*I*s-T*l*s+T*r*h-t*I*h-a*r*M+t*l*M)*te,e[11]=(d*l*s-a*m*s-d*r*h+t*m*h+a*r*y-t*l*y)*te,e[12]=q*te,e[13]=(d*I*i-T*m*i+T*r*_-t*I*_-d*r*C+t*m*C)*te,e[14]=(T*l*i-a*I*i-T*r*o+t*I*o+a*r*C-t*l*C)*te,e[15]=(a*m*i-d*l*i+d*r*o-t*m*o-a*r*_+t*l*_)*te,this}scale(e){const t=this.elements,r=e.x,i=e.y,s=e.z;return t[0]*=r,t[4]*=i,t[8]*=s,t[1]*=r,t[5]*=i,t[9]*=s,t[2]*=r,t[6]*=i,t[10]*=s,t[3]*=r,t[7]*=i,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,r,i))}makeTranslation(e,t,r){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const r=Math.cos(t),i=Math.sin(t),s=1-r,a=e.x,l=e.y,o=e.z,h=s*a,d=s*l;return this.set(h*a+r,h*l-i*o,h*o+i*l,0,h*l+i*o,d*l+r,d*o-i*a,0,h*o-i*l,d*o+i*a,s*o*o+r,0,0,0,0,1),this}makeScale(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this}makeShear(e,t,r,i,s,a){return this.set(1,r,s,0,e,1,a,0,t,i,1,0,0,0,0,1),this}compose(e,t,r){const i=this.elements,s=t._x,a=t._y,l=t._z,o=t._w,h=s+s,d=a+a,m=l+l,_=s*h,y=s*d,T=s*m,I=a*d,C=a*m,M=l*m,B=o*h,k=o*d,j=o*m,q=r.x,Z=r.y,te=r.z;return i[0]=(1-(I+M))*q,i[1]=(y+j)*q,i[2]=(T-k)*q,i[3]=0,i[4]=(y-j)*Z,i[5]=(1-(_+M))*Z,i[6]=(C+B)*Z,i[7]=0,i[8]=(T+k)*te,i[9]=(C-B)*te,i[10]=(1-(_+I))*te,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,r){const i=this.elements;let s=r1.set(i[0],i[1],i[2]).length();const a=r1.set(i[4],i[5],i[6]).length(),l=r1.set(i[8],i[9],i[10]).length();this.determinant()<0&&(s=-s),e.x=i[12],e.y=i[13],e.z=i[14],Sf.copy(this);const h=1/s,d=1/a,m=1/l;return Sf.elements[0]*=h,Sf.elements[1]*=h,Sf.elements[2]*=h,Sf.elements[4]*=d,Sf.elements[5]*=d,Sf.elements[6]*=d,Sf.elements[8]*=m,Sf.elements[9]*=m,Sf.elements[10]*=m,t.setFromRotationMatrix(Sf),r.x=s,r.y=a,r.z=l,this}makePerspective(e,t,r,i,s,a,l=Yd){const o=this.elements,h=2*s/(t-e),d=2*s/(r-i),m=(t+e)/(t-e),_=(r+i)/(r-i);let y,T;if(l===Yd)y=-(a+s)/(a-s),T=-2*a*s/(a-s);else if(l===zA)y=-a/(a-s),T=-a*s/(a-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+l);return o[0]=h,o[4]=0,o[8]=m,o[12]=0,o[1]=0,o[5]=d,o[9]=_,o[13]=0,o[2]=0,o[6]=0,o[10]=y,o[14]=T,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(e,t,r,i,s,a,l=Yd){const o=this.elements,h=1/(t-e),d=1/(r-i),m=1/(a-s),_=(t+e)*h,y=(r+i)*d;let T,I;if(l===Yd)T=(a+s)*m,I=-2*m;else if(l===zA)T=s*m,I=-1*m;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+l);return o[0]=2*h,o[4]=0,o[8]=0,o[12]=-_,o[1]=0,o[5]=2*d,o[9]=0,o[13]=-y,o[2]=0,o[6]=0,o[10]=I,o[14]=-T,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(e){const t=this.elements,r=e.elements;for(let i=0;i<16;i++)if(t[i]!==r[i])return!1;return!0}fromArray(e,t=0){for(let r=0;r<16;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}}const r1=new Ze,Sf=new Vr,Uge=new Ze(0,0,0),Vge=new Ze(1,1,1),a0=new Ze,wC=new Ze,Tu=new Ze,UH=new Vr,VH=new Aa;class Ou{constructor(e=0,t=0,r=0,i=Ou.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=r,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,r,i=this._order){return this._x=e,this._y=t,this._z=r,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,r=!0){const i=e.elements,s=i[0],a=i[4],l=i[8],o=i[1],h=i[5],d=i[9],m=i[2],_=i[6],y=i[10];switch(t){case"XYZ":this._y=Math.asin(ea(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-d,y),this._z=Math.atan2(-a,s)):(this._x=Math.atan2(_,h),this._z=0);break;case"YXZ":this._x=Math.asin(-ea(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(l,y),this._z=Math.atan2(o,h)):(this._y=Math.atan2(-m,s),this._z=0);break;case"ZXY":this._x=Math.asin(ea(_,-1,1)),Math.abs(_)<.9999999?(this._y=Math.atan2(-m,y),this._z=Math.atan2(-a,h)):(this._y=0,this._z=Math.atan2(o,s));break;case"ZYX":this._y=Math.asin(-ea(m,-1,1)),Math.abs(m)<.9999999?(this._x=Math.atan2(_,y),this._z=Math.atan2(o,s)):(this._x=0,this._z=Math.atan2(-a,h));break;case"YZX":this._z=Math.asin(ea(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-d,h),this._y=Math.atan2(-m,s)):(this._x=0,this._y=Math.atan2(l,y));break;case"XZY":this._z=Math.asin(-ea(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(_,h),this._y=Math.atan2(l,s)):(this._x=Math.atan2(-d,y),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,r===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,r){return UH.makeRotationFromQuaternion(e),this.setFromRotationMatrix(UH,t,r)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return VH.setFromEuler(this),this.setFromQuaternion(VH,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Ou.DEFAULT_ORDER="XYZ";class Py{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let Gge=0;const GH=new Ze,i1=new Aa,am=new Vr,SC=new Ze,y2=new Ze,Hge=new Ze,jge=new Aa,HH=new Ze(1,0,0),jH=new Ze(0,1,0),WH=new Ze(0,0,1),XH={type:"added"},Wge={type:"removed"},s1={type:"childadded",child:null},K4={type:"childremoved",child:null};class Ii extends pp{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Gge++}),this.uuid=Lu(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Ii.DEFAULT_UP.clone();const e=new Ze,t=new Ou,r=new Aa,i=new Ze(1,1,1);function s(){r.setFromEuler(t,!1)}function a(){t.setFromQuaternion(r,void 0,!1)}t._onChange(s),r._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Vr},normalMatrix:{value:new bi}}),this.matrix=new Vr,this.matrixWorld=new Vr,this.matrixAutoUpdate=Ii.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Ii.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Py,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return i1.setFromAxisAngle(e,t),this.quaternion.multiply(i1),this}rotateOnWorldAxis(e,t){return i1.setFromAxisAngle(e,t),this.quaternion.premultiply(i1),this}rotateX(e){return this.rotateOnAxis(HH,e)}rotateY(e){return this.rotateOnAxis(jH,e)}rotateZ(e){return this.rotateOnAxis(WH,e)}translateOnAxis(e,t){return GH.copy(e).applyQuaternion(this.quaternion),this.position.add(GH.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(HH,e)}translateY(e){return this.translateOnAxis(jH,e)}translateZ(e){return this.translateOnAxis(WH,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(am.copy(this.matrixWorld).invert())}lookAt(e,t,r){e.isVector3?SC.copy(e):SC.set(e,t,r);const i=this.parent;this.updateWorldMatrix(!0,!1),y2.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?am.lookAt(y2,SC,this.up):am.lookAt(SC,y2,this.up),this.quaternion.setFromRotationMatrix(am),i&&(am.extractRotation(i.matrixWorld),i1.setFromRotationMatrix(am),this.quaternion.premultiply(i1.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(XH),s1.child=e,this.dispatchEvent(s1),s1.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(Wge),K4.child=e,this.dispatchEvent(K4),K4.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),am.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),am.multiply(e.parent.matrixWorld)),e.applyMatrix4(am),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(XH),s1.child=e,this.dispatchEvent(s1),s1.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let r=0,i=this.children.length;r<i;r++){const a=this.children[r].getObjectByProperty(e,t);if(a!==void 0)return a}}getObjectsByProperty(e,t,r=[]){this[e]===t&&r.push(this);const i=this.children;for(let s=0,a=i.length;s<a;s++)i[s].getObjectsByProperty(e,t,r);return r}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(y2,e,Hge),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(y2,jge,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].updateMatrixWorld(e)}updateWorldMatrix(e,t){const r=this.parent;if(e===!0&&r!==null&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),t===!0){const i=this.children;for(let s=0,a=i.length;s<a;s++)i[s].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",r={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.visibility=this._visibility,i.active=this._active,i.bounds=this._bounds.map(l=>({boxInitialized:l.boxInitialized,boxMin:l.box.min.toArray(),boxMax:l.box.max.toArray(),sphereInitialized:l.sphereInitialized,sphereRadius:l.sphere.radius,sphereCenter:l.sphere.center.toArray()})),i.maxInstanceCount=this._maxInstanceCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.geometryCount=this._geometryCount,i.matricesTexture=this._matricesTexture.toJSON(e),this._colorsTexture!==null&&(i.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(i.boundingSphere={center:i.boundingSphere.center.toArray(),radius:i.boundingSphere.radius}),this.boundingBox!==null&&(i.boundingBox={min:i.boundingBox.min.toArray(),max:i.boundingBox.max.toArray()}));function s(l,o){return l[o.uuid]===void 0&&(l[o.uuid]=o.toJSON(e)),o.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=s(e.geometries,this.geometry);const l=this.geometry.parameters;if(l!==void 0&&l.shapes!==void 0){const o=l.shapes;if(Array.isArray(o))for(let h=0,d=o.length;h<d;h++){const m=o[h];s(e.shapes,m)}else s(e.shapes,o)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const l=[];for(let o=0,h=this.material.length;o<h;o++)l.push(s(e.materials,this.material[o]));i.material=l}else i.material=s(e.materials,this.material);if(this.children.length>0){i.children=[];for(let l=0;l<this.children.length;l++)i.children.push(this.children[l].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let l=0;l<this.animations.length;l++){const o=this.animations[l];i.animations.push(s(e.animations,o))}}if(t){const l=a(e.geometries),o=a(e.materials),h=a(e.textures),d=a(e.images),m=a(e.shapes),_=a(e.skeletons),y=a(e.animations),T=a(e.nodes);l.length>0&&(r.geometries=l),o.length>0&&(r.materials=o),h.length>0&&(r.textures=h),d.length>0&&(r.images=d),m.length>0&&(r.shapes=m),_.length>0&&(r.skeletons=_),y.length>0&&(r.animations=y),T.length>0&&(r.nodes=T)}return r.object=i,r;function a(l){const o=[];for(const h in l){const d=l[h];delete d.metadata,o.push(d)}return o}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let r=0;r<e.children.length;r++){const i=e.children[r];this.add(i.clone())}return this}}Ii.DEFAULT_UP=new Ze(0,1,0);Ii.DEFAULT_MATRIX_AUTO_UPDATE=!0;Ii.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Af=new Ze,lm=new Ze,J4=new Ze,cm=new Ze,o1=new Ze,a1=new Ze,$H=new Ze,Q4=new Ze,e5=new Ze,t5=new Ze;let U0=class U1{constructor(e=new Ze,t=new Ze,r=new Ze){this.a=e,this.b=t,this.c=r}static getNormal(e,t,r,i){i.subVectors(r,t),Af.subVectors(e,t),i.cross(Af);const s=i.lengthSq();return s>0?i.multiplyScalar(1/Math.sqrt(s)):i.set(0,0,0)}static getBarycoord(e,t,r,i,s){Af.subVectors(i,t),lm.subVectors(r,t),J4.subVectors(e,t);const a=Af.dot(Af),l=Af.dot(lm),o=Af.dot(J4),h=lm.dot(lm),d=lm.dot(J4),m=a*h-l*l;if(m===0)return s.set(0,0,0),null;const _=1/m,y=(h*o-l*d)*_,T=(a*d-l*o)*_;return s.set(1-y-T,T,y)}static containsPoint(e,t,r,i){return this.getBarycoord(e,t,r,i,cm)===null?!1:cm.x>=0&&cm.y>=0&&cm.x+cm.y<=1}static getInterpolation(e,t,r,i,s,a,l,o){return this.getBarycoord(e,t,r,i,cm)===null?(o.x=0,o.y=0,"z"in o&&(o.z=0),"w"in o&&(o.w=0),null):(o.setScalar(0),o.addScaledVector(s,cm.x),o.addScaledVector(a,cm.y),o.addScaledVector(l,cm.z),o)}static isFrontFacing(e,t,r,i){return Af.subVectors(r,t),lm.subVectors(e,t),Af.cross(lm).dot(i)<0}set(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this}setFromPointsAndIndices(e,t,r,i){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,r,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,r),this.c.fromBufferAttribute(e,i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Af.subVectors(this.c,this.b),lm.subVectors(this.a,this.b),Af.cross(lm).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return U1.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return U1.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,r,i,s){return U1.getInterpolation(e,this.a,this.b,this.c,t,r,i,s)}containsPoint(e){return U1.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return U1.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const r=this.a,i=this.b,s=this.c;let a,l;o1.subVectors(i,r),a1.subVectors(s,r),Q4.subVectors(e,r);const o=o1.dot(Q4),h=a1.dot(Q4);if(o<=0&&h<=0)return t.copy(r);e5.subVectors(e,i);const d=o1.dot(e5),m=a1.dot(e5);if(d>=0&&m<=d)return t.copy(i);const _=o*m-d*h;if(_<=0&&o>=0&&d<=0)return a=o/(o-d),t.copy(r).addScaledVector(o1,a);t5.subVectors(e,s);const y=o1.dot(t5),T=a1.dot(t5);if(T>=0&&y<=T)return t.copy(s);const I=y*h-o*T;if(I<=0&&h>=0&&T<=0)return l=h/(h-T),t.copy(r).addScaledVector(a1,l);const C=d*T-y*m;if(C<=0&&m-d>=0&&y-T>=0)return $H.subVectors(s,i),l=(m-d)/(m-d+(y-T)),t.copy(i).addScaledVector($H,l);const M=1/(C+I+_);return a=I*M,l=_*M,t.copy(r).addScaledVector(o1,a).addScaledVector(a1,l)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}};const ite={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},l0={h:0,s:0,l:0},AC={h:0,s:0,l:0};function n5(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*6*(2/3-t):n}let Gn=class{constructor(e,t,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,r)}set(e,t,r){if(t===void 0&&r===void 0){const i=e;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(e,t,r);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Ao){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,ds.toWorkingColorSpace(this,t),this}setRGB(e,t,r,i=ds.workingColorSpace){return this.r=e,this.g=t,this.b=r,ds.toWorkingColorSpace(this,i),this}setHSL(e,t,r,i=ds.workingColorSpace){if(e=h6(e,1),t=ea(t,0,1),r=ea(r,0,1),t===0)this.r=this.g=this.b=r;else{const s=r<=.5?r*(1+t):r+t-r*t,a=2*r-s;this.r=n5(a,s,e+1/3),this.g=n5(a,s,e),this.b=n5(a,s,e-1/3)}return ds.toWorkingColorSpace(this,i),this}setStyle(e,t=Ao){function r(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const a=i[1],l=i[2];switch(a){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return r(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,t);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return r(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,t);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return r(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=i[1],a=s.length;if(a===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,t);if(a===6)return this.setHex(parseInt(s,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=Ao){const r=ite[e.toLowerCase()];return r!==void 0?this.setHex(r,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Tb(e.r),this.g=Tb(e.g),this.b=Tb(e.b),this}copyLinearToSRGB(e){return this.r=H4(e.r),this.g=H4(e.g),this.b=H4(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Ao){return ds.fromWorkingColorSpace(Bl.copy(this),e),Math.round(ea(Bl.r*255,0,255))*65536+Math.round(ea(Bl.g*255,0,255))*256+Math.round(ea(Bl.b*255,0,255))}getHexString(e=Ao){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=ds.workingColorSpace){ds.fromWorkingColorSpace(Bl.copy(this),t);const r=Bl.r,i=Bl.g,s=Bl.b,a=Math.max(r,i,s),l=Math.min(r,i,s);let o,h;const d=(l+a)/2;if(l===a)o=0,h=0;else{const m=a-l;switch(h=d<=.5?m/(a+l):m/(2-a-l),a){case r:o=(i-s)/m+(i<s?6:0);break;case i:o=(s-r)/m+2;break;case s:o=(r-i)/m+4;break}o/=6}return e.h=o,e.s=h,e.l=d,e}getRGB(e,t=ds.workingColorSpace){return ds.fromWorkingColorSpace(Bl.copy(this),t),e.r=Bl.r,e.g=Bl.g,e.b=Bl.b,e}getStyle(e=Ao){ds.fromWorkingColorSpace(Bl.copy(this),e);const t=Bl.r,r=Bl.g,i=Bl.b;return e!==Ao?`color(${e} ${t.toFixed(3)} ${r.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(r*255)},${Math.round(i*255)})`}offsetHSL(e,t,r){return this.getHSL(l0),this.setHSL(l0.h+e,l0.s+t,l0.l+r)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,r){return this.r=e.r+(t.r-e.r)*r,this.g=e.g+(t.g-e.g)*r,this.b=e.b+(t.b-e.b)*r,this}lerpHSL(e,t){this.getHSL(l0),e.getHSL(AC);const r=US(l0.h,AC.h,t),i=US(l0.s,AC.s,t),s=US(l0.l,AC.l,t);return this.setHSL(r,i,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,r=this.g,i=this.b,s=e.elements;return this.r=s[0]*t+s[3]*r+s[6]*i,this.g=s[1]*t+s[4]*r+s[7]*i,this.b=s[2]*t+s[5]*r+s[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};const Bl=new Gn;Gn.NAMES=ite;let Xge=0;class _o extends pp{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Xge++}),this.uuid=Lu(),this.name="",this.type="Material",this.blending=Cy,this.side=Rh,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=TR,this.blendDst=MR,this.blendEquation=D0,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Gn(0,0,0),this.blendAlpha=0,this.depthFunc=PA,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=$O,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=iy,this.stencilZFail=iy,this.stencilZPass=iy,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const r=e[t];if(r===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const i=this[t];if(i===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}i&&i.isColor?i.set(r):i&&i.isVector3&&r&&r.isVector3?i.copy(r):this[t]=r}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const r={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),this.roughness!==void 0&&(r.roughness=this.roughness),this.metalness!==void 0&&(r.metalness=this.metalness),this.sheen!==void 0&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(r.shininess=this.shininess),this.clearcoat!==void 0&&(r.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(r.dispersion=this.dispersion),this.iridescence!==void 0&&(r.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(r.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(r.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(r.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(r.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(r.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(r.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(r.combine=this.combine)),this.envMapRotation!==void 0&&(r.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(r.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(r.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(r.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(r.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(r.size=this.size),this.shadowSide!==null&&(r.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==Cy&&(r.blending=this.blending),this.side!==Rh&&(r.side=this.side),this.vertexColors===!0&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),this.transparent===!0&&(r.transparent=!0),this.blendSrc!==TR&&(r.blendSrc=this.blendSrc),this.blendDst!==MR&&(r.blendDst=this.blendDst),this.blendEquation!==D0&&(r.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(r.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(r.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(r.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(r.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(r.blendAlpha=this.blendAlpha),this.depthFunc!==PA&&(r.depthFunc=this.depthFunc),this.depthTest===!1&&(r.depthTest=this.depthTest),this.depthWrite===!1&&(r.depthWrite=this.depthWrite),this.colorWrite===!1&&(r.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(r.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==$O&&(r.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(r.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(r.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==iy&&(r.stencilFail=this.stencilFail),this.stencilZFail!==iy&&(r.stencilZFail=this.stencilZFail),this.stencilZPass!==iy&&(r.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(r.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(r.rotation=this.rotation),this.polygonOffset===!0&&(r.polygonOffset=!0),this.polygonOffsetFactor!==0&&(r.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(r.linewidth=this.linewidth),this.dashSize!==void 0&&(r.dashSize=this.dashSize),this.gapSize!==void 0&&(r.gapSize=this.gapSize),this.scale!==void 0&&(r.scale=this.scale),this.dithering===!0&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),this.alphaHash===!0&&(r.alphaHash=!0),this.alphaToCoverage===!0&&(r.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(r.premultipliedAlpha=!0),this.forceSinglePass===!0&&(r.forceSinglePass=!0),this.wireframe===!0&&(r.wireframe=!0),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(r.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(r.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(r.flatShading=!0),this.visible===!1&&(r.visible=!1),this.toneMapped===!1&&(r.toneMapped=!1),this.fog===!1&&(r.fog=!1),Object.keys(this.userData).length>0&&(r.userData=this.userData);function i(s){const a=[];for(const l in s){const o=s[l];delete o.metadata,a.push(o)}return a}if(t){const s=i(e.textures),a=i(e.images);s.length>0&&(r.textures=s),a.length>0&&(r.images=a)}return r}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let r=null;if(t!==null){const i=t.length;r=new Array(i);for(let s=0;s!==i;++s)r[s]=t[s].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}onBeforeRender(){console.warn("Material: onBeforeRender() has been removed.")}}class vo extends _o{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Gn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Ou,this.combine=MT,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const wm=$ge();function $ge(){const n=new ArrayBuffer(4),e=new Float32Array(n),t=new Uint32Array(n),r=new Uint32Array(512),i=new Uint32Array(512);for(let o=0;o<256;++o){const h=o-127;h<-27?(r[o]=0,r[o|256]=32768,i[o]=24,i[o|256]=24):h<-14?(r[o]=1024>>-h-14,r[o|256]=1024>>-h-14|32768,i[o]=-h-1,i[o|256]=-h-1):h<=15?(r[o]=h+15<<10,r[o|256]=h+15<<10|32768,i[o]=13,i[o|256]=13):h<128?(r[o]=31744,r[o|256]=64512,i[o]=24,i[o|256]=24):(r[o]=31744,r[o|256]=64512,i[o]=13,i[o|256]=13)}const s=new Uint32Array(2048),a=new Uint32Array(64),l=new Uint32Array(64);for(let o=1;o<1024;++o){let h=o<<13,d=0;for(;!(h&8388608);)h<<=1,d-=8388608;h&=-8388609,d+=947912704,s[o]=h|d}for(let o=1024;o<2048;++o)s[o]=939524096+(o-1024<<13);for(let o=1;o<31;++o)a[o]=o<<23;a[31]=1199570944,a[32]=2147483648;for(let o=33;o<63;++o)a[o]=2147483648+(o-32<<23);a[63]=3347054592;for(let o=1;o<64;++o)o!==32&&(l[o]=1024);return{floatView:e,uint32View:t,baseTable:r,shiftTable:i,mantissaTable:s,exponentTable:a,offsetTable:l}}function Kc(n){Math.abs(n)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),n=ea(n,-65504,65504),wm.floatView[0]=n;const e=wm.uint32View[0],t=e>>23&511;return wm.baseTable[t]+((e&8388607)>>wm.shiftTable[t])}function uS(n){const e=n>>10;return wm.uint32View[0]=wm.mantissaTable[wm.offsetTable[e]+(n&1023)]+wm.exponentTable[e],wm.floatView[0]}const qge={toHalfFloat:Kc,fromHalfFloat:uS},xa=new Ze,TC=new nn;class Di{constructor(e,t,r=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=r,this.usage=NA,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=Sc,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return f6("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,r){e*=this.itemSize,r*=t.itemSize;for(let i=0,s=this.itemSize;i<s;i++)this.array[e+i]=t.array[r+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,r=this.count;t<r;t++)TC.fromBufferAttribute(this,t),TC.applyMatrix3(e),this.setXY(t,TC.x,TC.y);else if(this.itemSize===3)for(let t=0,r=this.count;t<r;t++)xa.fromBufferAttribute(this,t),xa.applyMatrix3(e),this.setXYZ(t,xa.x,xa.y,xa.z);return this}applyMatrix4(e){for(let t=0,r=this.count;t<r;t++)xa.fromBufferAttribute(this,t),xa.applyMatrix4(e),this.setXYZ(t,xa.x,xa.y,xa.z);return this}applyNormalMatrix(e){for(let t=0,r=this.count;t<r;t++)xa.fromBufferAttribute(this,t),xa.applyNormalMatrix(e),this.setXYZ(t,xa.x,xa.y,xa.z);return this}transformDirection(e){for(let t=0,r=this.count;t<r;t++)xa.fromBufferAttribute(this,t),xa.transformDirection(e),this.setXYZ(t,xa.x,xa.y,xa.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let r=this.array[e*this.itemSize+t];return this.normalized&&(r=wc(r,this.array)),r}setComponent(e,t,r){return this.normalized&&(r=wi(r,this.array)),this.array[e*this.itemSize+t]=r,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=wc(t,this.array)),t}setX(e,t){return this.normalized&&(t=wi(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=wc(t,this.array)),t}setY(e,t){return this.normalized&&(t=wi(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=wc(t,this.array)),t}setZ(e,t){return this.normalized&&(t=wi(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=wc(t,this.array)),t}setW(e,t){return this.normalized&&(t=wi(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,r){return e*=this.itemSize,this.normalized&&(t=wi(t,this.array),r=wi(r,this.array)),this.array[e+0]=t,this.array[e+1]=r,this}setXYZ(e,t,r,i){return e*=this.itemSize,this.normalized&&(t=wi(t,this.array),r=wi(r,this.array),i=wi(i,this.array)),this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this}setXYZW(e,t,r,i,s){return e*=this.itemSize,this.normalized&&(t=wi(t,this.array),r=wi(r,this.array),i=wi(i,this.array),s=wi(s,this.array)),this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==NA&&(e.usage=this.usage),e}}class Zge extends Di{constructor(e,t,r){super(new Int8Array(e),t,r)}}class Yge extends Di{constructor(e,t,r){super(new Uint8Array(e),t,r)}}class Kge extends Di{constructor(e,t,r){super(new Uint8ClampedArray(e),t,r)}}class Jge extends Di{constructor(e,t,r){super(new Int16Array(e),t,r)}}class p6 extends Di{constructor(e,t,r){super(new Uint16Array(e),t,r)}}class Qge extends Di{constructor(e,t,r){super(new Int32Array(e),t,r)}}class m6 extends Di{constructor(e,t,r){super(new Uint32Array(e),t,r)}}class e0e extends Di{constructor(e,t,r){super(new Uint16Array(e),t,r),this.isFloat16BufferAttribute=!0}getX(e){let t=uS(this.array[e*this.itemSize]);return this.normalized&&(t=wc(t,this.array)),t}setX(e,t){return this.normalized&&(t=wi(t,this.array)),this.array[e*this.itemSize]=Kc(t),this}getY(e){let t=uS(this.array[e*this.itemSize+1]);return this.normalized&&(t=wc(t,this.array)),t}setY(e,t){return this.normalized&&(t=wi(t,this.array)),this.array[e*this.itemSize+1]=Kc(t),this}getZ(e){let t=uS(this.array[e*this.itemSize+2]);return this.normalized&&(t=wc(t,this.array)),t}setZ(e,t){return this.normalized&&(t=wi(t,this.array)),this.array[e*this.itemSize+2]=Kc(t),this}getW(e){let t=uS(this.array[e*this.itemSize+3]);return this.normalized&&(t=wc(t,this.array)),t}setW(e,t){return this.normalized&&(t=wi(t,this.array)),this.array[e*this.itemSize+3]=Kc(t),this}setXY(e,t,r){return e*=this.itemSize,this.normalized&&(t=wi(t,this.array),r=wi(r,this.array)),this.array[e+0]=Kc(t),this.array[e+1]=Kc(r),this}setXYZ(e,t,r,i){return e*=this.itemSize,this.normalized&&(t=wi(t,this.array),r=wi(r,this.array),i=wi(i,this.array)),this.array[e+0]=Kc(t),this.array[e+1]=Kc(r),this.array[e+2]=Kc(i),this}setXYZW(e,t,r,i,s){return e*=this.itemSize,this.normalized&&(t=wi(t,this.array),r=wi(r,this.array),i=wi(i,this.array),s=wi(s,this.array)),this.array[e+0]=Kc(t),this.array[e+1]=Kc(r),this.array[e+2]=Kc(i),this.array[e+3]=Kc(s),this}}class ar extends Di{constructor(e,t,r){super(new Float32Array(e),t,r)}}let t0e=0;const sh=new Vr,r5=new Ii,l1=new Ze,Mu=new wl,x2=new wl,el=new Ze;class $r extends pp{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:t0e++}),this.uuid=Lu(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(ete(e)?m6:p6)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,r=0){this.groups.push({start:e,count:t,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const r=this.attributes.normal;if(r!==void 0){const s=new bi().getNormalMatrix(e);r.applyNormalMatrix(s),r.needsUpdate=!0}const i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(e),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return sh.makeRotationFromQuaternion(e),this.applyMatrix4(sh),this}rotateX(e){return sh.makeRotationX(e),this.applyMatrix4(sh),this}rotateY(e){return sh.makeRotationY(e),this.applyMatrix4(sh),this}rotateZ(e){return sh.makeRotationZ(e),this.applyMatrix4(sh),this}translate(e,t,r){return sh.makeTranslation(e,t,r),this.applyMatrix4(sh),this}scale(e,t,r){return sh.makeScale(e,t,r),this.applyMatrix4(sh),this}lookAt(e){return r5.lookAt(e),r5.updateMatrix(),this.applyMatrix4(r5.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(l1).negate(),this.translate(l1.x,l1.y,l1.z),this}setFromPoints(e){const t=[];for(let r=0,i=e.length;r<i;r++){const s=e[r];t.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new ar(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new wl);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new Ze(-1/0,-1/0,-1/0),new Ze(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let r=0,i=t.length;r<i;r++){const s=t[r];Mu.setFromBufferAttribute(s),this.morphTargetsRelative?(el.addVectors(this.boundingBox.min,Mu.min),this.boundingBox.expandByPoint(el),el.addVectors(this.boundingBox.max,Mu.max),this.boundingBox.expandByPoint(el)):(this.boundingBox.expandByPoint(Mu.min),this.boundingBox.expandByPoint(Mu.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new rl);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new Ze,1/0);return}if(e){const r=this.boundingSphere.center;if(Mu.setFromBufferAttribute(e),t)for(let s=0,a=t.length;s<a;s++){const l=t[s];x2.setFromBufferAttribute(l),this.morphTargetsRelative?(el.addVectors(Mu.min,x2.min),Mu.expandByPoint(el),el.addVectors(Mu.max,x2.max),Mu.expandByPoint(el)):(Mu.expandByPoint(x2.min),Mu.expandByPoint(x2.max))}Mu.getCenter(r);let i=0;for(let s=0,a=e.count;s<a;s++)el.fromBufferAttribute(e,s),i=Math.max(i,r.distanceToSquared(el));if(t)for(let s=0,a=t.length;s<a;s++){const l=t[s],o=this.morphTargetsRelative;for(let h=0,d=l.count;h<d;h++)el.fromBufferAttribute(l,h),o&&(l1.fromBufferAttribute(e,h),el.add(l1)),i=Math.max(i,r.distanceToSquared(el))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const r=t.position,i=t.normal,s=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Di(new Float32Array(4*r.count),4));const a=this.getAttribute("tangent"),l=[],o=[];for(let ie=0;ie<r.count;ie++)l[ie]=new Ze,o[ie]=new Ze;const h=new Ze,d=new Ze,m=new Ze,_=new nn,y=new nn,T=new nn,I=new Ze,C=new Ze;function M(ie,se,ae){h.fromBufferAttribute(r,ie),d.fromBufferAttribute(r,se),m.fromBufferAttribute(r,ae),_.fromBufferAttribute(s,ie),y.fromBufferAttribute(s,se),T.fromBufferAttribute(s,ae),d.sub(h),m.sub(h),y.sub(_),T.sub(_);const fe=1/(y.x*T.y-T.x*y.y);isFinite(fe)&&(I.copy(d).multiplyScalar(T.y).addScaledVector(m,-y.y).multiplyScalar(fe),C.copy(m).multiplyScalar(y.x).addScaledVector(d,-T.x).multiplyScalar(fe),l[ie].add(I),l[se].add(I),l[ae].add(I),o[ie].add(C),o[se].add(C),o[ae].add(C))}let B=this.groups;B.length===0&&(B=[{start:0,count:e.count}]);for(let ie=0,se=B.length;ie<se;++ie){const ae=B[ie],fe=ae.start,Se=ae.count;for(let Ee=fe,Re=fe+Se;Ee<Re;Ee+=3)M(e.getX(Ee+0),e.getX(Ee+1),e.getX(Ee+2))}const k=new Ze,j=new Ze,q=new Ze,Z=new Ze;function te(ie){q.fromBufferAttribute(i,ie),Z.copy(q);const se=l[ie];k.copy(se),k.sub(q.multiplyScalar(q.dot(se))).normalize(),j.crossVectors(Z,se);const fe=j.dot(o[ie])<0?-1:1;a.setXYZW(ie,k.x,k.y,k.z,fe)}for(let ie=0,se=B.length;ie<se;++ie){const ae=B[ie],fe=ae.start,Se=ae.count;for(let Ee=fe,Re=fe+Se;Ee<Re;Ee+=3)te(e.getX(Ee+0)),te(e.getX(Ee+1)),te(e.getX(Ee+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let r=this.getAttribute("normal");if(r===void 0)r=new Di(new Float32Array(t.count*3),3),this.setAttribute("normal",r);else for(let _=0,y=r.count;_<y;_++)r.setXYZ(_,0,0,0);const i=new Ze,s=new Ze,a=new Ze,l=new Ze,o=new Ze,h=new Ze,d=new Ze,m=new Ze;if(e)for(let _=0,y=e.count;_<y;_+=3){const T=e.getX(_+0),I=e.getX(_+1),C=e.getX(_+2);i.fromBufferAttribute(t,T),s.fromBufferAttribute(t,I),a.fromBufferAttribute(t,C),d.subVectors(a,s),m.subVectors(i,s),d.cross(m),l.fromBufferAttribute(r,T),o.fromBufferAttribute(r,I),h.fromBufferAttribute(r,C),l.add(d),o.add(d),h.add(d),r.setXYZ(T,l.x,l.y,l.z),r.setXYZ(I,o.x,o.y,o.z),r.setXYZ(C,h.x,h.y,h.z)}else for(let _=0,y=t.count;_<y;_+=3)i.fromBufferAttribute(t,_+0),s.fromBufferAttribute(t,_+1),a.fromBufferAttribute(t,_+2),d.subVectors(a,s),m.subVectors(i,s),d.cross(m),r.setXYZ(_+0,d.x,d.y,d.z),r.setXYZ(_+1,d.x,d.y,d.z),r.setXYZ(_+2,d.x,d.y,d.z);this.normalizeNormals(),r.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,r=e.count;t<r;t++)el.fromBufferAttribute(e,t),el.normalize(),e.setXYZ(t,el.x,el.y,el.z)}toNonIndexed(){function e(l,o){const h=l.array,d=l.itemSize,m=l.normalized,_=new h.constructor(o.length*d);let y=0,T=0;for(let I=0,C=o.length;I<C;I++){l.isInterleavedBufferAttribute?y=o[I]*l.data.stride+l.offset:y=o[I]*d;for(let M=0;M<d;M++)_[T++]=h[y++]}return new Di(_,d,m)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new $r,r=this.index.array,i=this.attributes;for(const l in i){const o=i[l],h=e(o,r);t.setAttribute(l,h)}const s=this.morphAttributes;for(const l in s){const o=[],h=s[l];for(let d=0,m=h.length;d<m;d++){const _=h[d],y=e(_,r);o.push(y)}t.morphAttributes[l]=o}t.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let l=0,o=a.length;l<o;l++){const h=a[l];t.addGroup(h.start,h.count,h.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const o=this.parameters;for(const h in o)o[h]!==void 0&&(e[h]=o[h]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const r=this.attributes;for(const o in r){const h=r[o];e.data.attributes[o]=h.toJSON(e.data)}const i={};let s=!1;for(const o in this.morphAttributes){const h=this.morphAttributes[o],d=[];for(let m=0,_=h.length;m<_;m++){const y=h[m];d.push(y.toJSON(e.data))}d.length>0&&(i[o]=d,s=!0)}s&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));const l=this.boundingSphere;return l!==null&&(e.data.boundingSphere={center:l.center.toArray(),radius:l.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const r=e.index;r!==null&&this.setIndex(r.clone(t));const i=e.attributes;for(const h in i){const d=i[h];this.setAttribute(h,d.clone(t))}const s=e.morphAttributes;for(const h in s){const d=[],m=s[h];for(let _=0,y=m.length;_<y;_++)d.push(m[_].clone(t));this.morphAttributes[h]=d}this.morphTargetsRelative=e.morphTargetsRelative;const a=e.groups;for(let h=0,d=a.length;h<d;h++){const m=a[h];this.addGroup(m.start,m.count,m.materialIndex)}const l=e.boundingBox;l!==null&&(this.boundingBox=l.clone());const o=e.boundingSphere;return o!==null&&(this.boundingSphere=o.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const qH=new Vr,v_=new hx,MC=new rl,ZH=new Ze,c1=new Ze,u1=new Ze,h1=new Ze,i5=new Ze,CC=new Ze,EC=new nn,IC=new nn,RC=new nn,YH=new Ze,KH=new Ze,JH=new Ze,PC=new Ze,LC=new Ze;class Ei extends Ii{constructor(e=new $r,t=new vo){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,r=Object.keys(t);if(r.length>0){const i=t[r[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=i.length;s<a;s++){const l=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[l]=s}}}}getVertexPosition(e,t){const r=this.geometry,i=r.attributes.position,s=r.morphAttributes.position,a=r.morphTargetsRelative;t.fromBufferAttribute(i,e);const l=this.morphTargetInfluences;if(s&&l){CC.set(0,0,0);for(let o=0,h=s.length;o<h;o++){const d=l[o],m=s[o];d!==0&&(i5.fromBufferAttribute(m,e),a?CC.addScaledVector(i5,d):CC.addScaledVector(i5.sub(t),d))}t.add(CC)}return t}raycast(e,t){const r=this.geometry,i=this.material,s=this.matrixWorld;i!==void 0&&(r.boundingSphere===null&&r.computeBoundingSphere(),MC.copy(r.boundingSphere),MC.applyMatrix4(s),v_.copy(e.ray).recast(e.near),!(MC.containsPoint(v_.origin)===!1&&(v_.intersectSphere(MC,ZH)===null||v_.origin.distanceToSquared(ZH)>(e.far-e.near)**2))&&(qH.copy(s).invert(),v_.copy(e.ray).applyMatrix4(qH),!(r.boundingBox!==null&&v_.intersectsBox(r.boundingBox)===!1)&&this._computeIntersections(e,t,v_)))}_computeIntersections(e,t,r){let i;const s=this.geometry,a=this.material,l=s.index,o=s.attributes.position,h=s.attributes.uv,d=s.attributes.uv1,m=s.attributes.normal,_=s.groups,y=s.drawRange;if(l!==null)if(Array.isArray(a))for(let T=0,I=_.length;T<I;T++){const C=_[T],M=a[C.materialIndex],B=Math.max(C.start,y.start),k=Math.min(l.count,Math.min(C.start+C.count,y.start+y.count));for(let j=B,q=k;j<q;j+=3){const Z=l.getX(j),te=l.getX(j+1),ie=l.getX(j+2);i=DC(this,M,e,r,h,d,m,Z,te,ie),i&&(i.faceIndex=Math.floor(j/3),i.face.materialIndex=C.materialIndex,t.push(i))}}else{const T=Math.max(0,y.start),I=Math.min(l.count,y.start+y.count);for(let C=T,M=I;C<M;C+=3){const B=l.getX(C),k=l.getX(C+1),j=l.getX(C+2);i=DC(this,a,e,r,h,d,m,B,k,j),i&&(i.faceIndex=Math.floor(C/3),t.push(i))}}else if(o!==void 0)if(Array.isArray(a))for(let T=0,I=_.length;T<I;T++){const C=_[T],M=a[C.materialIndex],B=Math.max(C.start,y.start),k=Math.min(o.count,Math.min(C.start+C.count,y.start+y.count));for(let j=B,q=k;j<q;j+=3){const Z=j,te=j+1,ie=j+2;i=DC(this,M,e,r,h,d,m,Z,te,ie),i&&(i.faceIndex=Math.floor(j/3),i.face.materialIndex=C.materialIndex,t.push(i))}}else{const T=Math.max(0,y.start),I=Math.min(o.count,y.start+y.count);for(let C=T,M=I;C<M;C+=3){const B=C,k=C+1,j=C+2;i=DC(this,a,e,r,h,d,m,B,k,j),i&&(i.faceIndex=Math.floor(C/3),t.push(i))}}}}function n0e(n,e,t,r,i,s,a,l){let o;if(e.side===Mc?o=r.intersectTriangle(a,s,i,!0,l):o=r.intersectTriangle(i,s,a,e.side===Rh,l),o===null)return null;LC.copy(l),LC.applyMatrix4(n.matrixWorld);const h=t.ray.origin.distanceTo(LC);return h<t.near||h>t.far?null:{distance:h,point:LC.clone(),object:n}}function DC(n,e,t,r,i,s,a,l,o,h){n.getVertexPosition(l,c1),n.getVertexPosition(o,u1),n.getVertexPosition(h,h1);const d=n0e(n,e,t,r,c1,u1,h1,PC);if(d){i&&(EC.fromBufferAttribute(i,l),IC.fromBufferAttribute(i,o),RC.fromBufferAttribute(i,h),d.uv=U0.getInterpolation(PC,c1,u1,h1,EC,IC,RC,new nn)),s&&(EC.fromBufferAttribute(s,l),IC.fromBufferAttribute(s,o),RC.fromBufferAttribute(s,h),d.uv1=U0.getInterpolation(PC,c1,u1,h1,EC,IC,RC,new nn)),a&&(YH.fromBufferAttribute(a,l),KH.fromBufferAttribute(a,o),JH.fromBufferAttribute(a,h),d.normal=U0.getInterpolation(PC,c1,u1,h1,YH,KH,JH,new Ze),d.normal.dot(r.direction)>0&&d.normal.multiplyScalar(-1));const m={a:l,b:o,c:h,normal:new Ze,materialIndex:0};U0.getNormal(c1,u1,h1,m.normal),d.face=m}return d}class mp extends $r{constructor(e=1,t=1,r=1,i=1,s=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:i,heightSegments:s,depthSegments:a};const l=this;i=Math.floor(i),s=Math.floor(s),a=Math.floor(a);const o=[],h=[],d=[],m=[];let _=0,y=0;T("z","y","x",-1,-1,r,t,e,a,s,0),T("z","y","x",1,-1,r,t,-e,a,s,1),T("x","z","y",1,1,e,r,t,i,a,2),T("x","z","y",1,-1,e,r,-t,i,a,3),T("x","y","z",1,-1,e,t,r,i,s,4),T("x","y","z",-1,-1,e,t,-r,i,s,5),this.setIndex(o),this.setAttribute("position",new ar(h,3)),this.setAttribute("normal",new ar(d,3)),this.setAttribute("uv",new ar(m,2));function T(I,C,M,B,k,j,q,Z,te,ie,se){const ae=j/te,fe=q/ie,Se=j/2,Ee=q/2,Re=Z/2,qe=te+1,Le=ie+1;let dt=0,ye=0;const Xe=new Ze;for(let He=0;He<Le;He++){const _t=He*fe-Ee;for(let wt=0;wt<qe;wt++){const Gt=wt*ae-Se;Xe[I]=Gt*B,Xe[C]=_t*k,Xe[M]=Re,h.push(Xe.x,Xe.y,Xe.z),Xe[I]=0,Xe[C]=0,Xe[M]=Z>0?1:-1,d.push(Xe.x,Xe.y,Xe.z),m.push(wt/te),m.push(1-He/ie),dt+=1}}for(let He=0;He<ie;He++)for(let _t=0;_t<te;_t++){const wt=_+_t+qe*He,Gt=_+_t+qe*(He+1),at=_+(_t+1)+qe*(He+1),Ht=_+(_t+1)+qe*He;o.push(wt,Gt,Ht),o.push(Gt,at,Ht),ye+=6}l.addGroup(y,ye,se),y+=ye,_+=dt}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new mp(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function qb(n){const e={};for(const t in n){e[t]={};for(const r in n[t]){const i=n[t][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][r]=null):e[t][r]=i.clone():Array.isArray(i)?e[t][r]=i.slice():e[t][r]=i}}return e}function vc(n){const e={};for(let t=0;t<n.length;t++){const r=qb(n[t]);for(const i in r)e[i]=r[i]}return e}function r0e(n){const e=[];for(let t=0;t<n.length;t++)e.push(n[t].clone());return e}function ste(n){const e=n.getRenderTarget();return e===null?n.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:ds.workingColorSpace}const Gm={clone:qb,merge:vc};var i0e=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,s0e=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Eo extends _o{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=i0e,this.fragmentShader=s0e,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=qb(e.uniforms),this.uniformsGroups=r0e(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const a=this.uniforms[i].value;a&&a.isTexture?t.uniforms[i]={type:"t",value:a.toJSON(e).uuid}:a&&a.isColor?t.uniforms[i]={type:"c",value:a.getHex()}:a&&a.isVector2?t.uniforms[i]={type:"v2",value:a.toArray()}:a&&a.isVector3?t.uniforms[i]={type:"v3",value:a.toArray()}:a&&a.isVector4?t.uniforms[i]={type:"v4",value:a.toArray()}:a&&a.isMatrix3?t.uniforms[i]={type:"m3",value:a.toArray()}:a&&a.isMatrix4?t.uniforms[i]={type:"m4",value:a.toArray()}:t.uniforms[i]={value:a}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const r={};for(const i in this.extensions)this.extensions[i]===!0&&(r[i]=!0);return Object.keys(r).length>0&&(t.extensions=r),t}}class LT extends Ii{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Vr,this.projectionMatrix=new Vr,this.projectionMatrixInverse=new Vr,this.coordinateSystem=Yd}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const c0=new Ze,QH=new nn,ej=new nn;class Qi extends LT{constructor(e=50,t=1,r=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=r,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=$b*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(Ry*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return $b*2*Math.atan(Math.tan(Ry*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,r){c0.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(c0.x,c0.y).multiplyScalar(-e/c0.z),c0.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),r.set(c0.x,c0.y).multiplyScalar(-e/c0.z)}getViewSize(e,t){return this.getViewBounds(e,QH,ej),t.subVectors(ej,QH)}setViewOffset(e,t,r,i,s,a){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(Ry*.5*this.fov)/this.zoom,r=2*t,i=this.aspect*r,s=-.5*i;const a=this.view;if(this.view!==null&&this.view.enabled){const o=a.fullWidth,h=a.fullHeight;s+=a.offsetX*i/o,t-=a.offsetY*r/h,i*=a.width/o,r*=a.height/h}const l=this.filmOffset;l!==0&&(s+=e*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+i,t,t-r,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const f1=-90,d1=1;class ote extends Ii{constructor(e,t,r){super(),this.type="CubeCamera",this.renderTarget=r,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new Qi(f1,d1,e,t);i.layers=this.layers,this.add(i);const s=new Qi(f1,d1,e,t);s.layers=this.layers,this.add(s);const a=new Qi(f1,d1,e,t);a.layers=this.layers,this.add(a);const l=new Qi(f1,d1,e,t);l.layers=this.layers,this.add(l);const o=new Qi(f1,d1,e,t);o.layers=this.layers,this.add(o);const h=new Qi(f1,d1,e,t);h.layers=this.layers,this.add(h)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[r,i,s,a,l,o]=t;for(const h of t)this.remove(h);if(e===Yd)r.up.set(0,1,0),r.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),l.up.set(0,1,0),l.lookAt(0,0,1),o.up.set(0,1,0),o.lookAt(0,0,-1);else if(e===zA)r.up.set(0,-1,0),r.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),l.up.set(0,-1,0),l.lookAt(0,0,1),o.up.set(0,-1,0),o.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const h of t)this.add(h),h.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:r,activeMipmapLevel:i}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[s,a,l,o,h,d]=this.children,m=e.getRenderTarget(),_=e.getActiveCubeFace(),y=e.getActiveMipmapLevel(),T=e.xr.enabled;e.xr.enabled=!1;const I=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0,i),e.render(t,s),e.setRenderTarget(r,1,i),e.render(t,a),e.setRenderTarget(r,2,i),e.render(t,l),e.setRenderTarget(r,3,i),e.render(t,o),e.setRenderTarget(r,4,i),e.render(t,h),r.texture.generateMipmaps=I,e.setRenderTarget(r,5,i),e.render(t,d),e.setRenderTarget(m,_,y),e.xr.enabled=T,r.texture.needsPMREMUpdate=!0}}class DT extends Ws{constructor(e,t,r,i,s,a,l,o,h,d){e=e!==void 0?e:[],t=t!==void 0?t:Um,super(e,t,r,i,s,a,l,o,h,d),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class ate extends bl{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const r={width:e,height:e,depth:1},i=[r,r,r,r,r,r];this.texture=new DT(i,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:Co}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const r={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},i=new mp(5,5,5),s=new Eo({name:"CubemapFromEquirect",uniforms:qb(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:Mc,blending:rp});s.uniforms.tEquirect.value=t;const a=new Ei(i,s),l=t.minFilter;return t.minFilter===iu&&(t.minFilter=Co),new ote(1,10,this).update(e,a),t.minFilter=l,a.geometry.dispose(),a.material.dispose(),this}clear(e,t,r,i){const s=e.getRenderTarget();for(let a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(t,r,i);e.setRenderTarget(s)}}const s5=new Ze,o0e=new Ze,a0e=new bi;let xm=class{constructor(e=new Ze(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,r,i){return this.normal.set(e,t,r),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,r){const i=s5.subVectors(r,t).cross(o0e.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const r=e.delta(s5),i=this.normal.dot(r);if(i===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/i;return s<0||s>1?null:t.copy(e.start).addScaledVector(r,s)}intersectsLine(e){const t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return t<0&&r>0||r<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const r=t||a0e.getNormalMatrix(e),i=this.coplanarPoint(s5).applyMatrix4(e),s=this.normal.applyMatrix3(r).normalize();return this.constant=-i.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}};const __=new rl,BC=new Ze;class BT{constructor(e=new xm,t=new xm,r=new xm,i=new xm,s=new xm,a=new xm){this.planes=[e,t,r,i,s,a]}set(e,t,r,i,s,a){const l=this.planes;return l[0].copy(e),l[1].copy(t),l[2].copy(r),l[3].copy(i),l[4].copy(s),l[5].copy(a),this}copy(e){const t=this.planes;for(let r=0;r<6;r++)t[r].copy(e.planes[r]);return this}setFromProjectionMatrix(e,t=Yd){const r=this.planes,i=e.elements,s=i[0],a=i[1],l=i[2],o=i[3],h=i[4],d=i[5],m=i[6],_=i[7],y=i[8],T=i[9],I=i[10],C=i[11],M=i[12],B=i[13],k=i[14],j=i[15];if(r[0].setComponents(o-s,_-h,C-y,j-M).normalize(),r[1].setComponents(o+s,_+h,C+y,j+M).normalize(),r[2].setComponents(o+a,_+d,C+T,j+B).normalize(),r[3].setComponents(o-a,_-d,C-T,j-B).normalize(),r[4].setComponents(o-l,_-m,C-I,j-k).normalize(),t===Yd)r[5].setComponents(o+l,_+m,C+I,j+k).normalize();else if(t===zA)r[5].setComponents(l,m,I,k).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),__.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),__.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(__)}intersectsSprite(e){return __.center.set(0,0,0),__.radius=.7071067811865476,__.applyMatrix4(e.matrixWorld),this.intersectsSphere(__)}intersectsSphere(e){const t=this.planes,r=e.center,i=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(r)<i)return!1;return!0}intersectsBox(e){const t=this.planes;for(let r=0;r<6;r++){const i=t[r];if(BC.x=i.normal.x>0?e.max.x:e.min.x,BC.y=i.normal.y>0?e.max.y:e.min.y,BC.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(BC)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let r=0;r<6;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function lte(){let n=null,e=!1,t=null,r=null;function i(s,a){t(s,a),r=n.requestAnimationFrame(i)}return{start:function(){e!==!0&&t!==null&&(r=n.requestAnimationFrame(i),e=!0)},stop:function(){n.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(s){t=s},setContext:function(s){n=s}}}function l0e(n){const e=new WeakMap;function t(l,o){const h=l.array,d=l.usage,m=h.byteLength,_=n.createBuffer();n.bindBuffer(o,_),n.bufferData(o,h,d),l.onUploadCallback();let y;if(h instanceof Float32Array)y=n.FLOAT;else if(h instanceof Uint16Array)l.isFloat16BufferAttribute?y=n.HALF_FLOAT:y=n.UNSIGNED_SHORT;else if(h instanceof Int16Array)y=n.SHORT;else if(h instanceof Uint32Array)y=n.UNSIGNED_INT;else if(h instanceof Int32Array)y=n.INT;else if(h instanceof Int8Array)y=n.BYTE;else if(h instanceof Uint8Array)y=n.UNSIGNED_BYTE;else if(h instanceof Uint8ClampedArray)y=n.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+h);return{buffer:_,type:y,bytesPerElement:h.BYTES_PER_ELEMENT,version:l.version,size:m}}function r(l,o,h){const d=o.array,m=o._updateRange,_=o.updateRanges;if(n.bindBuffer(h,l),m.count===-1&&_.length===0&&n.bufferSubData(h,0,d),_.length!==0){for(let y=0,T=_.length;y<T;y++){const I=_[y];n.bufferSubData(h,I.start*d.BYTES_PER_ELEMENT,d,I.start,I.count)}o.clearUpdateRanges()}m.count!==-1&&(n.bufferSubData(h,m.offset*d.BYTES_PER_ELEMENT,d,m.offset,m.count),m.count=-1),o.onUploadCallback()}function i(l){return l.isInterleavedBufferAttribute&&(l=l.data),e.get(l)}function s(l){l.isInterleavedBufferAttribute&&(l=l.data);const o=e.get(l);o&&(n.deleteBuffer(o.buffer),e.delete(l))}function a(l,o){if(l.isGLBufferAttribute){const d=e.get(l);(!d||d.version<l.version)&&e.set(l,{buffer:l.buffer,type:l.type,bytesPerElement:l.elementSize,version:l.version});return}l.isInterleavedBufferAttribute&&(l=l.data);const h=e.get(l);if(h===void 0)e.set(l,t(l,o));else if(h.version<l.version){if(h.size!==l.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");r(h.buffer,l,o),h.version=l.version}}return{get:i,remove:s,update:a}}class Jm extends $r{constructor(e=1,t=1,r=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:i};const s=e/2,a=t/2,l=Math.floor(r),o=Math.floor(i),h=l+1,d=o+1,m=e/l,_=t/o,y=[],T=[],I=[],C=[];for(let M=0;M<d;M++){const B=M*_-a;for(let k=0;k<h;k++){const j=k*m-s;T.push(j,-B,0),I.push(0,0,1),C.push(k/l),C.push(1-M/o)}}for(let M=0;M<o;M++)for(let B=0;B<l;B++){const k=B+h*M,j=B+h*(M+1),q=B+1+h*(M+1),Z=B+1+h*M;y.push(k,j,Z),y.push(j,q,Z)}this.setIndex(y),this.setAttribute("position",new ar(T,3)),this.setAttribute("normal",new ar(I,3)),this.setAttribute("uv",new ar(C,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Jm(e.width,e.height,e.widthSegments,e.heightSegments)}}var c0e=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,u0e=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,h0e=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,f0e=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,d0e=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,p0e=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,m0e=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,g0e=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,v0e=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,_0e=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,y0e=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,x0e=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,b0e=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,w0e=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,S0e=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,A0e=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,T0e=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,M0e=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,C0e=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,E0e=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,I0e=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,R0e=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,P0e=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,L0e=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,D0e=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,B0e=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,k0e=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,O0e=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,F0e=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,N0e=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,z0e="gl_FragColor = linearToOutputTexel( gl_FragColor );",U0e=`
const mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(
	vec3( 0.8224621, 0.177538, 0.0 ),
	vec3( 0.0331941, 0.9668058, 0.0 ),
	vec3( 0.0170827, 0.0723974, 0.9105199 )
);
const mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(
	vec3( 1.2249401, - 0.2249404, 0.0 ),
	vec3( - 0.0420569, 1.0420571, 0.0 ),
	vec3( - 0.0196376, - 0.0786361, 1.0982735 )
);
vec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {
	return vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );
}
vec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {
	return vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );
}
vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return sRGBTransferOETF( value );
}`,V0e=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,G0e=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,H0e=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,j0e=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,W0e=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,X0e=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,$0e=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,q0e=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,Z0e=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,Y0e=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,K0e=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,J0e=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,Q0e=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,eve=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,tve=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,nve=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,rve=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,ive=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,sve=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,ove=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,ave=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,lve=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,cve=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,uve=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,hve=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,fve=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,dve=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,pve=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,mve=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,gve=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,vve=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,_ve=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,yve=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,xve=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,bve=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,wve=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,Sve=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,Ave=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,Tve=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,Mve=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,Cve=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,Eve=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Ive=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Rve=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,Pve=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,Lve=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,Dve=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,Bve=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,kve=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,Ove=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,Fve=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,Nve=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,zve=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,Uve=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,Vve=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,Gve=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,Hve=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,jve=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,Wve=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,Xve=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,$ve=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,qve=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,Zve=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,Yve=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,Kve=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,Jve=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,Qve=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,e_e=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,t_e=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,n_e=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,r_e=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
		
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
		
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		
		#else
		
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,i_e=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,s_e=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,o_e=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,a_e=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const l_e=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,c_e=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,u_e=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,h_e=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,f_e=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,d_e=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,p_e=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,m_e=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,g_e=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,v_e=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,__e=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,y_e=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,x_e=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,b_e=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,w_e=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,S_e=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,A_e=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,T_e=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,M_e=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,C_e=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,E_e=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,I_e=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,R_e=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,P_e=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,L_e=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,D_e=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,B_e=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,k_e=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,O_e=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,F_e=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,N_e=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,z_e=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,U_e=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,V_e=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Ti={alphahash_fragment:c0e,alphahash_pars_fragment:u0e,alphamap_fragment:h0e,alphamap_pars_fragment:f0e,alphatest_fragment:d0e,alphatest_pars_fragment:p0e,aomap_fragment:m0e,aomap_pars_fragment:g0e,batching_pars_vertex:v0e,batching_vertex:_0e,begin_vertex:y0e,beginnormal_vertex:x0e,bsdfs:b0e,iridescence_fragment:w0e,bumpmap_pars_fragment:S0e,clipping_planes_fragment:A0e,clipping_planes_pars_fragment:T0e,clipping_planes_pars_vertex:M0e,clipping_planes_vertex:C0e,color_fragment:E0e,color_pars_fragment:I0e,color_pars_vertex:R0e,color_vertex:P0e,common:L0e,cube_uv_reflection_fragment:D0e,defaultnormal_vertex:B0e,displacementmap_pars_vertex:k0e,displacementmap_vertex:O0e,emissivemap_fragment:F0e,emissivemap_pars_fragment:N0e,colorspace_fragment:z0e,colorspace_pars_fragment:U0e,envmap_fragment:V0e,envmap_common_pars_fragment:G0e,envmap_pars_fragment:H0e,envmap_pars_vertex:j0e,envmap_physical_pars_fragment:tve,envmap_vertex:W0e,fog_vertex:X0e,fog_pars_vertex:$0e,fog_fragment:q0e,fog_pars_fragment:Z0e,gradientmap_pars_fragment:Y0e,lightmap_pars_fragment:K0e,lights_lambert_fragment:J0e,lights_lambert_pars_fragment:Q0e,lights_pars_begin:eve,lights_toon_fragment:nve,lights_toon_pars_fragment:rve,lights_phong_fragment:ive,lights_phong_pars_fragment:sve,lights_physical_fragment:ove,lights_physical_pars_fragment:ave,lights_fragment_begin:lve,lights_fragment_maps:cve,lights_fragment_end:uve,logdepthbuf_fragment:hve,logdepthbuf_pars_fragment:fve,logdepthbuf_pars_vertex:dve,logdepthbuf_vertex:pve,map_fragment:mve,map_pars_fragment:gve,map_particle_fragment:vve,map_particle_pars_fragment:_ve,metalnessmap_fragment:yve,metalnessmap_pars_fragment:xve,morphinstance_vertex:bve,morphcolor_vertex:wve,morphnormal_vertex:Sve,morphtarget_pars_vertex:Ave,morphtarget_vertex:Tve,normal_fragment_begin:Mve,normal_fragment_maps:Cve,normal_pars_fragment:Eve,normal_pars_vertex:Ive,normal_vertex:Rve,normalmap_pars_fragment:Pve,clearcoat_normal_fragment_begin:Lve,clearcoat_normal_fragment_maps:Dve,clearcoat_pars_fragment:Bve,iridescence_pars_fragment:kve,opaque_fragment:Ove,packing:Fve,premultiplied_alpha_fragment:Nve,project_vertex:zve,dithering_fragment:Uve,dithering_pars_fragment:Vve,roughnessmap_fragment:Gve,roughnessmap_pars_fragment:Hve,shadowmap_pars_fragment:jve,shadowmap_pars_vertex:Wve,shadowmap_vertex:Xve,shadowmask_pars_fragment:$ve,skinbase_vertex:qve,skinning_pars_vertex:Zve,skinning_vertex:Yve,skinnormal_vertex:Kve,specularmap_fragment:Jve,specularmap_pars_fragment:Qve,tonemapping_fragment:e_e,tonemapping_pars_fragment:t_e,transmission_fragment:n_e,transmission_pars_fragment:r_e,uv_pars_fragment:i_e,uv_pars_vertex:s_e,uv_vertex:o_e,worldpos_vertex:a_e,background_vert:l_e,background_frag:c_e,backgroundCube_vert:u_e,backgroundCube_frag:h_e,cube_vert:f_e,cube_frag:d_e,depth_vert:p_e,depth_frag:m_e,distanceRGBA_vert:g_e,distanceRGBA_frag:v_e,equirect_vert:__e,equirect_frag:y_e,linedashed_vert:x_e,linedashed_frag:b_e,meshbasic_vert:w_e,meshbasic_frag:S_e,meshlambert_vert:A_e,meshlambert_frag:T_e,meshmatcap_vert:M_e,meshmatcap_frag:C_e,meshnormal_vert:E_e,meshnormal_frag:I_e,meshphong_vert:R_e,meshphong_frag:P_e,meshphysical_vert:L_e,meshphysical_frag:D_e,meshtoon_vert:B_e,meshtoon_frag:k_e,points_vert:O_e,points_frag:F_e,shadow_vert:N_e,shadow_frag:z_e,sprite_vert:U_e,sprite_frag:V_e},hr={common:{diffuse:{value:new Gn(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new bi},alphaMap:{value:null},alphaMapTransform:{value:new bi},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new bi}},envmap:{envMap:{value:null},envMapRotation:{value:new bi},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new bi}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new bi}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new bi},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new bi},normalScale:{value:new nn(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new bi},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new bi}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new bi}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new bi}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Gn(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Gn(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new bi},alphaTest:{value:0},uvTransform:{value:new bi}},sprite:{diffuse:{value:new Gn(16777215)},opacity:{value:1},center:{value:new nn(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new bi},alphaMap:{value:null},alphaMapTransform:{value:new bi},alphaTest:{value:0}}},kf={basic:{uniforms:vc([hr.common,hr.specularmap,hr.envmap,hr.aomap,hr.lightmap,hr.fog]),vertexShader:Ti.meshbasic_vert,fragmentShader:Ti.meshbasic_frag},lambert:{uniforms:vc([hr.common,hr.specularmap,hr.envmap,hr.aomap,hr.lightmap,hr.emissivemap,hr.bumpmap,hr.normalmap,hr.displacementmap,hr.fog,hr.lights,{emissive:{value:new Gn(0)}}]),vertexShader:Ti.meshlambert_vert,fragmentShader:Ti.meshlambert_frag},phong:{uniforms:vc([hr.common,hr.specularmap,hr.envmap,hr.aomap,hr.lightmap,hr.emissivemap,hr.bumpmap,hr.normalmap,hr.displacementmap,hr.fog,hr.lights,{emissive:{value:new Gn(0)},specular:{value:new Gn(1118481)},shininess:{value:30}}]),vertexShader:Ti.meshphong_vert,fragmentShader:Ti.meshphong_frag},standard:{uniforms:vc([hr.common,hr.envmap,hr.aomap,hr.lightmap,hr.emissivemap,hr.bumpmap,hr.normalmap,hr.displacementmap,hr.roughnessmap,hr.metalnessmap,hr.fog,hr.lights,{emissive:{value:new Gn(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Ti.meshphysical_vert,fragmentShader:Ti.meshphysical_frag},toon:{uniforms:vc([hr.common,hr.aomap,hr.lightmap,hr.emissivemap,hr.bumpmap,hr.normalmap,hr.displacementmap,hr.gradientmap,hr.fog,hr.lights,{emissive:{value:new Gn(0)}}]),vertexShader:Ti.meshtoon_vert,fragmentShader:Ti.meshtoon_frag},matcap:{uniforms:vc([hr.common,hr.bumpmap,hr.normalmap,hr.displacementmap,hr.fog,{matcap:{value:null}}]),vertexShader:Ti.meshmatcap_vert,fragmentShader:Ti.meshmatcap_frag},points:{uniforms:vc([hr.points,hr.fog]),vertexShader:Ti.points_vert,fragmentShader:Ti.points_frag},dashed:{uniforms:vc([hr.common,hr.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Ti.linedashed_vert,fragmentShader:Ti.linedashed_frag},depth:{uniforms:vc([hr.common,hr.displacementmap]),vertexShader:Ti.depth_vert,fragmentShader:Ti.depth_frag},normal:{uniforms:vc([hr.common,hr.bumpmap,hr.normalmap,hr.displacementmap,{opacity:{value:1}}]),vertexShader:Ti.meshnormal_vert,fragmentShader:Ti.meshnormal_frag},sprite:{uniforms:vc([hr.sprite,hr.fog]),vertexShader:Ti.sprite_vert,fragmentShader:Ti.sprite_frag},background:{uniforms:{uvTransform:{value:new bi},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Ti.background_vert,fragmentShader:Ti.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new bi}},vertexShader:Ti.backgroundCube_vert,fragmentShader:Ti.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Ti.cube_vert,fragmentShader:Ti.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Ti.equirect_vert,fragmentShader:Ti.equirect_frag},distanceRGBA:{uniforms:vc([hr.common,hr.displacementmap,{referencePosition:{value:new Ze},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Ti.distanceRGBA_vert,fragmentShader:Ti.distanceRGBA_frag},shadow:{uniforms:vc([hr.lights,hr.fog,{color:{value:new Gn(0)},opacity:{value:1}}]),vertexShader:Ti.shadow_vert,fragmentShader:Ti.shadow_frag}};kf.physical={uniforms:vc([kf.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new bi},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new bi},clearcoatNormalScale:{value:new nn(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new bi},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new bi},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new bi},sheen:{value:0},sheenColor:{value:new Gn(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new bi},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new bi},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new bi},transmissionSamplerSize:{value:new nn},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new bi},attenuationDistance:{value:0},attenuationColor:{value:new Gn(0)},specularColor:{value:new Gn(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new bi},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new bi},anisotropyVector:{value:new nn},anisotropyMap:{value:null},anisotropyMapTransform:{value:new bi}}]),vertexShader:Ti.meshphysical_vert,fragmentShader:Ti.meshphysical_frag};const kC={r:0,b:0,g:0},y_=new Ou,G_e=new Vr;function H_e(n,e,t,r,i,s,a){const l=new Gn(0);let o=s===!0?0:1,h,d,m=null,_=0,y=null;function T(B){let k=B.isScene===!0?B.background:null;return k&&k.isTexture&&(k=(B.backgroundBlurriness>0?t:e).get(k)),k}function I(B){let k=!1;const j=T(B);j===null?M(l,o):j&&j.isColor&&(M(j,1),k=!0);const q=n.xr.getEnvironmentBlendMode();q==="additive"?r.buffers.color.setClear(0,0,0,1,a):q==="alpha-blend"&&r.buffers.color.setClear(0,0,0,0,a),(n.autoClear||k)&&(r.buffers.depth.setTest(!0),r.buffers.depth.setMask(!0),r.buffers.color.setMask(!0),n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil))}function C(B,k){const j=T(k);j&&(j.isCubeTexture||j.mapping===uw)?(d===void 0&&(d=new Ei(new mp(1,1,1),new Eo({name:"BackgroundCubeMaterial",uniforms:qb(kf.backgroundCube.uniforms),vertexShader:kf.backgroundCube.vertexShader,fragmentShader:kf.backgroundCube.fragmentShader,side:Mc,depthTest:!1,depthWrite:!1,fog:!1})),d.geometry.deleteAttribute("normal"),d.geometry.deleteAttribute("uv"),d.onBeforeRender=function(q,Z,te){this.matrixWorld.copyPosition(te.matrixWorld)},Object.defineProperty(d.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(d)),y_.copy(k.backgroundRotation),y_.x*=-1,y_.y*=-1,y_.z*=-1,j.isCubeTexture&&j.isRenderTargetTexture===!1&&(y_.y*=-1,y_.z*=-1),d.material.uniforms.envMap.value=j,d.material.uniforms.flipEnvMap.value=j.isCubeTexture&&j.isRenderTargetTexture===!1?-1:1,d.material.uniforms.backgroundBlurriness.value=k.backgroundBlurriness,d.material.uniforms.backgroundIntensity.value=k.backgroundIntensity,d.material.uniforms.backgroundRotation.value.setFromMatrix4(G_e.makeRotationFromEuler(y_)),d.material.toneMapped=ds.getTransfer(j.colorSpace)!==eo,(m!==j||_!==j.version||y!==n.toneMapping)&&(d.material.needsUpdate=!0,m=j,_=j.version,y=n.toneMapping),d.layers.enableAll(),B.unshift(d,d.geometry,d.material,0,0,null)):j&&j.isTexture&&(h===void 0&&(h=new Ei(new Jm(2,2),new Eo({name:"BackgroundMaterial",uniforms:qb(kf.background.uniforms),vertexShader:kf.background.vertexShader,fragmentShader:kf.background.fragmentShader,side:Rh,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),Object.defineProperty(h.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(h)),h.material.uniforms.t2D.value=j,h.material.uniforms.backgroundIntensity.value=k.backgroundIntensity,h.material.toneMapped=ds.getTransfer(j.colorSpace)!==eo,j.matrixAutoUpdate===!0&&j.updateMatrix(),h.material.uniforms.uvTransform.value.copy(j.matrix),(m!==j||_!==j.version||y!==n.toneMapping)&&(h.material.needsUpdate=!0,m=j,_=j.version,y=n.toneMapping),h.layers.enableAll(),B.unshift(h,h.geometry,h.material,0,0,null))}function M(B,k){B.getRGB(kC,ste(n)),r.buffers.color.setClear(kC.r,kC.g,kC.b,k,a)}return{getClearColor:function(){return l},setClearColor:function(B,k=1){l.set(B),o=k,M(l,o)},getClearAlpha:function(){return o},setClearAlpha:function(B){o=B,M(l,o)},render:I,addToRenderList:C}}function j_e(n,e){const t=n.getParameter(n.MAX_VERTEX_ATTRIBS),r={},i=_(null);let s=i,a=!1;function l(ae,fe,Se,Ee,Re){let qe=!1;const Le=m(Ee,Se,fe);s!==Le&&(s=Le,h(s.object)),qe=y(ae,Ee,Se,Re),qe&&T(ae,Ee,Se,Re),Re!==null&&e.update(Re,n.ELEMENT_ARRAY_BUFFER),(qe||a)&&(a=!1,j(ae,fe,Se,Ee),Re!==null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e.get(Re).buffer))}function o(){return n.createVertexArray()}function h(ae){return n.bindVertexArray(ae)}function d(ae){return n.deleteVertexArray(ae)}function m(ae,fe,Se){const Ee=Se.wireframe===!0;let Re=r[ae.id];Re===void 0&&(Re={},r[ae.id]=Re);let qe=Re[fe.id];qe===void 0&&(qe={},Re[fe.id]=qe);let Le=qe[Ee];return Le===void 0&&(Le=_(o()),qe[Ee]=Le),Le}function _(ae){const fe=[],Se=[],Ee=[];for(let Re=0;Re<t;Re++)fe[Re]=0,Se[Re]=0,Ee[Re]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:fe,enabledAttributes:Se,attributeDivisors:Ee,object:ae,attributes:{},index:null}}function y(ae,fe,Se,Ee){const Re=s.attributes,qe=fe.attributes;let Le=0;const dt=Se.getAttributes();for(const ye in dt)if(dt[ye].location>=0){const He=Re[ye];let _t=qe[ye];if(_t===void 0&&(ye==="instanceMatrix"&&ae.instanceMatrix&&(_t=ae.instanceMatrix),ye==="instanceColor"&&ae.instanceColor&&(_t=ae.instanceColor)),He===void 0||He.attribute!==_t||_t&&He.data!==_t.data)return!0;Le++}return s.attributesNum!==Le||s.index!==Ee}function T(ae,fe,Se,Ee){const Re={},qe=fe.attributes;let Le=0;const dt=Se.getAttributes();for(const ye in dt)if(dt[ye].location>=0){let He=qe[ye];He===void 0&&(ye==="instanceMatrix"&&ae.instanceMatrix&&(He=ae.instanceMatrix),ye==="instanceColor"&&ae.instanceColor&&(He=ae.instanceColor));const _t={};_t.attribute=He,He&&He.data&&(_t.data=He.data),Re[ye]=_t,Le++}s.attributes=Re,s.attributesNum=Le,s.index=Ee}function I(){const ae=s.newAttributes;for(let fe=0,Se=ae.length;fe<Se;fe++)ae[fe]=0}function C(ae){M(ae,0)}function M(ae,fe){const Se=s.newAttributes,Ee=s.enabledAttributes,Re=s.attributeDivisors;Se[ae]=1,Ee[ae]===0&&(n.enableVertexAttribArray(ae),Ee[ae]=1),Re[ae]!==fe&&(n.vertexAttribDivisor(ae,fe),Re[ae]=fe)}function B(){const ae=s.newAttributes,fe=s.enabledAttributes;for(let Se=0,Ee=fe.length;Se<Ee;Se++)fe[Se]!==ae[Se]&&(n.disableVertexAttribArray(Se),fe[Se]=0)}function k(ae,fe,Se,Ee,Re,qe,Le){Le===!0?n.vertexAttribIPointer(ae,fe,Se,Re,qe):n.vertexAttribPointer(ae,fe,Se,Ee,Re,qe)}function j(ae,fe,Se,Ee){I();const Re=Ee.attributes,qe=Se.getAttributes(),Le=fe.defaultAttributeValues;for(const dt in qe){const ye=qe[dt];if(ye.location>=0){let Xe=Re[dt];if(Xe===void 0&&(dt==="instanceMatrix"&&ae.instanceMatrix&&(Xe=ae.instanceMatrix),dt==="instanceColor"&&ae.instanceColor&&(Xe=ae.instanceColor)),Xe!==void 0){const He=Xe.normalized,_t=Xe.itemSize,wt=e.get(Xe);if(wt===void 0)continue;const Gt=wt.buffer,at=wt.type,Ht=wt.bytesPerElement,Qt=at===n.INT||at===n.UNSIGNED_INT||Xe.gpuType===CL;if(Xe.isInterleavedBufferAttribute){const rn=Xe.data,jn=rn.stride,Bn=Xe.offset;if(rn.isInstancedInterleavedBuffer){for(let Tn=0;Tn<ye.locationSize;Tn++)M(ye.location+Tn,rn.meshPerAttribute);ae.isInstancedMesh!==!0&&Ee._maxInstanceCount===void 0&&(Ee._maxInstanceCount=rn.meshPerAttribute*rn.count)}else for(let Tn=0;Tn<ye.locationSize;Tn++)C(ye.location+Tn);n.bindBuffer(n.ARRAY_BUFFER,Gt);for(let Tn=0;Tn<ye.locationSize;Tn++)k(ye.location+Tn,_t/ye.locationSize,at,He,jn*Ht,(Bn+_t/ye.locationSize*Tn)*Ht,Qt)}else{if(Xe.isInstancedBufferAttribute){for(let rn=0;rn<ye.locationSize;rn++)M(ye.location+rn,Xe.meshPerAttribute);ae.isInstancedMesh!==!0&&Ee._maxInstanceCount===void 0&&(Ee._maxInstanceCount=Xe.meshPerAttribute*Xe.count)}else for(let rn=0;rn<ye.locationSize;rn++)C(ye.location+rn);n.bindBuffer(n.ARRAY_BUFFER,Gt);for(let rn=0;rn<ye.locationSize;rn++)k(ye.location+rn,_t/ye.locationSize,at,He,_t*Ht,_t/ye.locationSize*rn*Ht,Qt)}}else if(Le!==void 0){const He=Le[dt];if(He!==void 0)switch(He.length){case 2:n.vertexAttrib2fv(ye.location,He);break;case 3:n.vertexAttrib3fv(ye.location,He);break;case 4:n.vertexAttrib4fv(ye.location,He);break;default:n.vertexAttrib1fv(ye.location,He)}}}}B()}function q(){ie();for(const ae in r){const fe=r[ae];for(const Se in fe){const Ee=fe[Se];for(const Re in Ee)d(Ee[Re].object),delete Ee[Re];delete fe[Se]}delete r[ae]}}function Z(ae){if(r[ae.id]===void 0)return;const fe=r[ae.id];for(const Se in fe){const Ee=fe[Se];for(const Re in Ee)d(Ee[Re].object),delete Ee[Re];delete fe[Se]}delete r[ae.id]}function te(ae){for(const fe in r){const Se=r[fe];if(Se[ae.id]===void 0)continue;const Ee=Se[ae.id];for(const Re in Ee)d(Ee[Re].object),delete Ee[Re];delete Se[ae.id]}}function ie(){se(),a=!0,s!==i&&(s=i,h(s.object))}function se(){i.geometry=null,i.program=null,i.wireframe=!1}return{setup:l,reset:ie,resetDefaultState:se,dispose:q,releaseStatesOfGeometry:Z,releaseStatesOfProgram:te,initAttributes:I,enableAttribute:C,disableUnusedAttributes:B}}function W_e(n,e,t){let r;function i(h){r=h}function s(h,d){n.drawArrays(r,h,d),t.update(d,r,1)}function a(h,d,m){m!==0&&(n.drawArraysInstanced(r,h,d,m),t.update(d,r,m))}function l(h,d,m){if(m===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(r,h,0,d,0,m);let y=0;for(let T=0;T<m;T++)y+=d[T];t.update(y,r,1)}function o(h,d,m,_){if(m===0)return;const y=e.get("WEBGL_multi_draw");if(y===null)for(let T=0;T<h.length;T++)a(h[T],d[T],_[T]);else{y.multiDrawArraysInstancedWEBGL(r,h,0,d,0,_,0,m);let T=0;for(let I=0;I<m;I++)T+=d[I];for(let I=0;I<_.length;I++)t.update(T,r,_[I])}}this.setMode=i,this.render=s,this.renderInstances=a,this.renderMultiDraw=l,this.renderMultiDrawInstances=o}function X_e(n,e,t,r){let i;function s(){if(i!==void 0)return i;if(e.has("EXT_texture_filter_anisotropic")===!0){const Z=e.get("EXT_texture_filter_anisotropic");i=n.getParameter(Z.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i}function a(Z){return!(Z!==jl&&r.convert(Z)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_FORMAT))}function l(Z){const te=Z===Ah&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(Z!==Xf&&r.convert(Z)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_TYPE)&&Z!==Sc&&!te)}function o(Z){if(Z==="highp"){if(n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).precision>0)return"highp";Z="mediump"}return Z==="mediump"&&n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let h=t.precision!==void 0?t.precision:"highp";const d=o(h);d!==h&&(console.warn("THREE.WebGLRenderer:",h,"not supported, using",d,"instead."),h=d);const m=t.logarithmicDepthBuffer===!0,_=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),y=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS),T=n.getParameter(n.MAX_TEXTURE_SIZE),I=n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),C=n.getParameter(n.MAX_VERTEX_ATTRIBS),M=n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),B=n.getParameter(n.MAX_VARYING_VECTORS),k=n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS),j=y>0,q=n.getParameter(n.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:s,getMaxPrecision:o,textureFormatReadable:a,textureTypeReadable:l,precision:h,logarithmicDepthBuffer:m,maxTextures:_,maxVertexTextures:y,maxTextureSize:T,maxCubemapSize:I,maxAttributes:C,maxVertexUniforms:M,maxVaryings:B,maxFragmentUniforms:k,vertexTextures:j,maxSamples:q}}function $_e(n){const e=this;let t=null,r=0,i=!1,s=!1;const a=new xm,l=new bi,o={value:null,needsUpdate:!1};this.uniform=o,this.numPlanes=0,this.numIntersection=0,this.init=function(m,_){const y=m.length!==0||_||r!==0||i;return i=_,r=m.length,y},this.beginShadows=function(){s=!0,d(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(m,_){t=d(m,_,0)},this.setState=function(m,_,y){const T=m.clippingPlanes,I=m.clipIntersection,C=m.clipShadows,M=n.get(m);if(!i||T===null||T.length===0||s&&!C)s?d(null):h();else{const B=s?0:r,k=B*4;let j=M.clippingState||null;o.value=j,j=d(T,_,k,y);for(let q=0;q!==k;++q)j[q]=t[q];M.clippingState=j,this.numIntersection=I?this.numPlanes:0,this.numPlanes+=B}};function h(){o.value!==t&&(o.value=t,o.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function d(m,_,y,T){const I=m!==null?m.length:0;let C=null;if(I!==0){if(C=o.value,T!==!0||C===null){const M=y+I*4,B=_.matrixWorldInverse;l.getNormalMatrix(B),(C===null||C.length<M)&&(C=new Float32Array(M));for(let k=0,j=y;k!==I;++k,j+=4)a.copy(m[k]).applyMatrix4(B,l),a.normal.toArray(C,j),C[j+3]=a.constant}o.value=C,o.needsUpdate=!0}return e.numPlanes=I,e.numIntersection=0,C}}function q_e(n){let e=new WeakMap;function t(a,l){return l===LA?a.mapping=Um:l===DA&&(a.mapping=av),a}function r(a){if(a&&a.isTexture){const l=a.mapping;if(l===LA||l===DA)if(e.has(a)){const o=e.get(a).texture;return t(o,a.mapping)}else{const o=a.image;if(o&&o.height>0){const h=new ate(o.height);return h.fromEquirectangularTexture(n,a),e.set(a,h),a.addEventListener("dispose",i),t(h.texture,a.mapping)}else return null}}return a}function i(a){const l=a.target;l.removeEventListener("dispose",i);const o=e.get(l);o!==void 0&&(e.delete(l),o.dispose())}function s(){e=new WeakMap}return{get:r,dispose:s}}class Kf extends LT{constructor(e=-1,t=1,r=1,i=-1,s=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=r,this.bottom=i,this.near=s,this.far=a,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,r,i,s,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let s=r-e,a=r+e,l=i+t,o=i-t;if(this.view!==null&&this.view.enabled){const h=(this.right-this.left)/this.view.fullWidth/this.zoom,d=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=h*this.view.offsetX,a=s+h*this.view.width,l-=d*this.view.offsetY,o=l-d*this.view.height}this.projectionMatrix.makeOrthographic(s,a,l,o,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}const lb=4,tj=[.125,.215,.35,.446,.526,.582],ly=20,o5=new Kf,nj=new Gn;let a5=null,l5=0,c5=0,u5=!1;const sy=(1+Math.sqrt(5))/2,p1=1/sy,rj=[new Ze(-sy,p1,0),new Ze(sy,p1,0),new Ze(-p1,0,sy),new Ze(p1,0,sy),new Ze(0,sy,-p1),new Ze(0,sy,p1),new Ze(-1,1,-1),new Ze(1,1,-1),new Ze(-1,1,1),new Ze(1,1,1)];class ZO{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,r=.1,i=100){a5=this._renderer.getRenderTarget(),l5=this._renderer.getActiveCubeFace(),c5=this._renderer.getActiveMipmapLevel(),u5=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(e,r,i,s),t>0&&this._blur(s,0,0,t),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=oj(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=sj(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(a5,l5,c5),this._renderer.xr.enabled=u5,e.scissorTest=!1,OC(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===Um||e.mapping===av?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),a5=this._renderer.getRenderTarget(),l5=this._renderer.getActiveCubeFace(),c5=this._renderer.getActiveMipmapLevel(),u5=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const r=t||this._allocateTargets();return this._textureToCubeUV(e,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,r={magFilter:Co,minFilter:Co,generateMipmaps:!1,type:Ah,format:jl,colorSpace:Ga,depthBuffer:!1},i=ij(e,t,r);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=ij(e,t,r);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=Z_e(s)),this._blurMaterial=Y_e(s,e,t)}return i}_compileMaterial(e){const t=new Ei(this._lodPlanes[0],e);this._renderer.compile(t,o5)}_sceneToCubeUV(e,t,r,i){const l=new Qi(90,1,t,r),o=[1,-1,1,1,1,1],h=[1,1,1,-1,-1,-1],d=this._renderer,m=d.autoClear,_=d.toneMapping;d.getClearColor(nj),d.toneMapping=ip,d.autoClear=!1;const y=new vo({name:"PMREM.Background",side:Mc,depthWrite:!1,depthTest:!1}),T=new Ei(new mp,y);let I=!1;const C=e.background;C?C.isColor&&(y.color.copy(C),e.background=null,I=!0):(y.color.copy(nj),I=!0);for(let M=0;M<6;M++){const B=M%3;B===0?(l.up.set(0,o[M],0),l.lookAt(h[M],0,0)):B===1?(l.up.set(0,0,o[M]),l.lookAt(0,h[M],0)):(l.up.set(0,o[M],0),l.lookAt(0,0,h[M]));const k=this._cubeSize;OC(i,B*k,M>2?k:0,k,k),d.setRenderTarget(i),I&&d.render(T,l),d.render(e,l)}T.geometry.dispose(),T.material.dispose(),d.toneMapping=_,d.autoClear=m,e.background=C}_textureToCubeUV(e,t){const r=this._renderer,i=e.mapping===Um||e.mapping===av;i?(this._cubemapMaterial===null&&(this._cubemapMaterial=oj()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=sj());const s=i?this._cubemapMaterial:this._equirectMaterial,a=new Ei(this._lodPlanes[0],s),l=s.uniforms;l.envMap.value=e;const o=this._cubeSize;OC(t,0,0,3*o,2*o),r.setRenderTarget(t),r.render(a,o5)}_applyPMREM(e){const t=this._renderer,r=t.autoClear;t.autoClear=!1;const i=this._lodPlanes.length;for(let s=1;s<i;s++){const a=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),l=rj[(i-s-1)%rj.length];this._blur(e,s-1,s,a,l)}t.autoClear=r}_blur(e,t,r,i,s){const a=this._pingPongRenderTarget;this._halfBlur(e,a,t,r,i,"latitudinal",s),this._halfBlur(a,e,r,r,i,"longitudinal",s)}_halfBlur(e,t,r,i,s,a,l){const o=this._renderer,h=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const d=3,m=new Ei(this._lodPlanes[i],h),_=h.uniforms,y=this._sizeLods[r]-1,T=isFinite(s)?Math.PI/(2*y):2*Math.PI/(2*ly-1),I=s/T,C=isFinite(s)?1+Math.floor(d*I):ly;C>ly&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${C} samples when the maximum is set to ${ly}`);const M=[];let B=0;for(let te=0;te<ly;++te){const ie=te/I,se=Math.exp(-ie*ie/2);M.push(se),te===0?B+=se:te<C&&(B+=2*se)}for(let te=0;te<M.length;te++)M[te]=M[te]/B;_.envMap.value=e.texture,_.samples.value=C,_.weights.value=M,_.latitudinal.value=a==="latitudinal",l&&(_.poleAxis.value=l);const{_lodMax:k}=this;_.dTheta.value=T,_.mipInt.value=k-r;const j=this._sizeLods[i],q=3*j*(i>k-lb?i-k+lb:0),Z=4*(this._cubeSize-j);OC(t,q,Z,3*j,2*j),o.setRenderTarget(t),o.render(m,o5)}}function Z_e(n){const e=[],t=[],r=[];let i=n;const s=n-lb+1+tj.length;for(let a=0;a<s;a++){const l=Math.pow(2,i);t.push(l);let o=1/l;a>n-lb?o=tj[a-n+lb-1]:a===0&&(o=0),r.push(o);const h=1/(l-2),d=-h,m=1+h,_=[d,d,m,d,m,m,d,d,m,m,d,m],y=6,T=6,I=3,C=2,M=1,B=new Float32Array(I*T*y),k=new Float32Array(C*T*y),j=new Float32Array(M*T*y);for(let Z=0;Z<y;Z++){const te=Z%3*2/3-1,ie=Z>2?0:-1,se=[te,ie,0,te+2/3,ie,0,te+2/3,ie+1,0,te,ie,0,te+2/3,ie+1,0,te,ie+1,0];B.set(se,I*T*Z),k.set(_,C*T*Z);const ae=[Z,Z,Z,Z,Z,Z];j.set(ae,M*T*Z)}const q=new $r;q.setAttribute("position",new Di(B,I)),q.setAttribute("uv",new Di(k,C)),q.setAttribute("faceIndex",new Di(j,M)),e.push(q),i>lb&&i--}return{lodPlanes:e,sizeLods:t,sigmas:r}}function ij(n,e,t){const r=new bl(n,e,t);return r.texture.mapping=uw,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function OC(n,e,t,r,i){n.viewport.set(e,t,r,i),n.scissor.set(e,t,r,i)}function Y_e(n,e,t){const r=new Float32Array(ly),i=new Ze(0,1,0);return new Eo({name:"SphericalGaussianBlur",defines:{n:ly,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:g6(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:rp,depthTest:!1,depthWrite:!1})}function sj(){return new Eo({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:g6(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:rp,depthTest:!1,depthWrite:!1})}function oj(){return new Eo({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:g6(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:rp,depthTest:!1,depthWrite:!1})}function g6(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function K_e(n){let e=new WeakMap,t=null;function r(l){if(l&&l.isTexture){const o=l.mapping,h=o===LA||o===DA,d=o===Um||o===av;if(h||d){let m=e.get(l);const _=m!==void 0?m.texture.pmremVersion:0;if(l.isRenderTargetTexture&&l.pmremVersion!==_)return t===null&&(t=new ZO(n)),m=h?t.fromEquirectangular(l,m):t.fromCubemap(l,m),m.texture.pmremVersion=l.pmremVersion,e.set(l,m),m.texture;if(m!==void 0)return m.texture;{const y=l.image;return h&&y&&y.height>0||d&&y&&i(y)?(t===null&&(t=new ZO(n)),m=h?t.fromEquirectangular(l):t.fromCubemap(l),m.texture.pmremVersion=l.pmremVersion,e.set(l,m),l.addEventListener("dispose",s),m.texture):null}}}return l}function i(l){let o=0;const h=6;for(let d=0;d<h;d++)l[d]!==void 0&&o++;return o===h}function s(l){const o=l.target;o.removeEventListener("dispose",s);const h=e.get(o);h!==void 0&&(e.delete(o),h.dispose())}function a(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:r,dispose:a}}function J_e(n){const e={};function t(r){if(e[r]!==void 0)return e[r];let i;switch(r){case"WEBGL_depth_texture":i=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=n.getExtension(r)}return e[r]=i,i}return{has:function(r){return t(r)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(r){const i=t(r);return i===null&&f6("THREE.WebGLRenderer: "+r+" extension not supported."),i}}}function Q_e(n,e,t,r){const i={},s=new WeakMap;function a(m){const _=m.target;_.index!==null&&e.remove(_.index);for(const T in _.attributes)e.remove(_.attributes[T]);for(const T in _.morphAttributes){const I=_.morphAttributes[T];for(let C=0,M=I.length;C<M;C++)e.remove(I[C])}_.removeEventListener("dispose",a),delete i[_.id];const y=s.get(_);y&&(e.remove(y),s.delete(_)),r.releaseStatesOfGeometry(_),_.isInstancedBufferGeometry===!0&&delete _._maxInstanceCount,t.memory.geometries--}function l(m,_){return i[_.id]===!0||(_.addEventListener("dispose",a),i[_.id]=!0,t.memory.geometries++),_}function o(m){const _=m.attributes;for(const T in _)e.update(_[T],n.ARRAY_BUFFER);const y=m.morphAttributes;for(const T in y){const I=y[T];for(let C=0,M=I.length;C<M;C++)e.update(I[C],n.ARRAY_BUFFER)}}function h(m){const _=[],y=m.index,T=m.attributes.position;let I=0;if(y!==null){const B=y.array;I=y.version;for(let k=0,j=B.length;k<j;k+=3){const q=B[k+0],Z=B[k+1],te=B[k+2];_.push(q,Z,Z,te,te,q)}}else if(T!==void 0){const B=T.array;I=T.version;for(let k=0,j=B.length/3-1;k<j;k+=3){const q=k+0,Z=k+1,te=k+2;_.push(q,Z,Z,te,te,q)}}else return;const C=new(ete(_)?m6:p6)(_,1);C.version=I;const M=s.get(m);M&&e.remove(M),s.set(m,C)}function d(m){const _=s.get(m);if(_){const y=m.index;y!==null&&_.version<y.version&&h(m)}else h(m);return s.get(m)}return{get:l,update:o,getWireframeAttribute:d}}function eye(n,e,t){let r;function i(_){r=_}let s,a;function l(_){s=_.type,a=_.bytesPerElement}function o(_,y){n.drawElements(r,y,s,_*a),t.update(y,r,1)}function h(_,y,T){T!==0&&(n.drawElementsInstanced(r,y,s,_*a,T),t.update(y,r,T))}function d(_,y,T){if(T===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(r,y,0,s,_,0,T);let C=0;for(let M=0;M<T;M++)C+=y[M];t.update(C,r,1)}function m(_,y,T,I){if(T===0)return;const C=e.get("WEBGL_multi_draw");if(C===null)for(let M=0;M<_.length;M++)h(_[M]/a,y[M],I[M]);else{C.multiDrawElementsInstancedWEBGL(r,y,0,s,_,0,I,0,T);let M=0;for(let B=0;B<T;B++)M+=y[B];for(let B=0;B<I.length;B++)t.update(M,r,I[B])}}this.setMode=i,this.setIndex=l,this.render=o,this.renderInstances=h,this.renderMultiDraw=d,this.renderMultiDrawInstances=m}function tye(n){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function r(s,a,l){switch(t.calls++,a){case n.TRIANGLES:t.triangles+=l*(s/3);break;case n.LINES:t.lines+=l*(s/2);break;case n.LINE_STRIP:t.lines+=l*(s-1);break;case n.LINE_LOOP:t.lines+=l*s;break;case n.POINTS:t.points+=l*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a);break}}function i(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:i,update:r}}function nye(n,e,t){const r=new WeakMap,i=new Es;function s(a,l,o){const h=a.morphTargetInfluences,d=l.morphAttributes.position||l.morphAttributes.normal||l.morphAttributes.color,m=d!==void 0?d.length:0;let _=r.get(l);if(_===void 0||_.count!==m){let se=function(){te.dispose(),r.delete(l),l.removeEventListener("dispose",se)};_!==void 0&&_.texture.dispose();const y=l.morphAttributes.position!==void 0,T=l.morphAttributes.normal!==void 0,I=l.morphAttributes.color!==void 0,C=l.morphAttributes.position||[],M=l.morphAttributes.normal||[],B=l.morphAttributes.color||[];let k=0;y===!0&&(k=1),T===!0&&(k=2),I===!0&&(k=3);let j=l.attributes.position.count*k,q=1;j>e.maxTextureSize&&(q=Math.ceil(j/e.maxTextureSize),j=e.maxTextureSize);const Z=new Float32Array(j*q*4*m),te=new BL(Z,j,q,m);te.type=Sc,te.needsUpdate=!0;const ie=k*4;for(let ae=0;ae<m;ae++){const fe=C[ae],Se=M[ae],Ee=B[ae],Re=j*q*4*ae;for(let qe=0;qe<fe.count;qe++){const Le=qe*ie;y===!0&&(i.fromBufferAttribute(fe,qe),Z[Re+Le+0]=i.x,Z[Re+Le+1]=i.y,Z[Re+Le+2]=i.z,Z[Re+Le+3]=0),T===!0&&(i.fromBufferAttribute(Se,qe),Z[Re+Le+4]=i.x,Z[Re+Le+5]=i.y,Z[Re+Le+6]=i.z,Z[Re+Le+7]=0),I===!0&&(i.fromBufferAttribute(Ee,qe),Z[Re+Le+8]=i.x,Z[Re+Le+9]=i.y,Z[Re+Le+10]=i.z,Z[Re+Le+11]=Ee.itemSize===4?i.w:1)}}_={count:m,texture:te,size:new nn(j,q)},r.set(l,_),l.addEventListener("dispose",se)}if(a.isInstancedMesh===!0&&a.morphTexture!==null)o.getUniforms().setValue(n,"morphTexture",a.morphTexture,t);else{let y=0;for(let I=0;I<h.length;I++)y+=h[I];const T=l.morphTargetsRelative?1:1-y;o.getUniforms().setValue(n,"morphTargetBaseInfluence",T),o.getUniforms().setValue(n,"morphTargetInfluences",h)}o.getUniforms().setValue(n,"morphTargetsTexture",_.texture,t),o.getUniforms().setValue(n,"morphTargetsTextureSize",_.size)}return{update:s}}function rye(n,e,t,r){let i=new WeakMap;function s(o){const h=r.render.frame,d=o.geometry,m=e.get(o,d);if(i.get(m)!==h&&(e.update(m),i.set(m,h)),o.isInstancedMesh&&(o.hasEventListener("dispose",l)===!1&&o.addEventListener("dispose",l),i.get(o)!==h&&(t.update(o.instanceMatrix,n.ARRAY_BUFFER),o.instanceColor!==null&&t.update(o.instanceColor,n.ARRAY_BUFFER),i.set(o,h))),o.isSkinnedMesh){const _=o.skeleton;i.get(_)!==h&&(_.update(),i.set(_,h))}return m}function a(){i=new WeakMap}function l(o){const h=o.target;h.removeEventListener("dispose",l),t.remove(h.instanceMatrix),h.instanceColor!==null&&t.remove(h.instanceColor)}return{update:s,dispose:a}}class v6 extends Ws{constructor(e,t,r,i,s,a,l,o,h,d=Iy){if(d!==Iy&&d!==Xy)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");r===void 0&&d===Iy&&(r=Vm),r===void 0&&d===Xy&&(r=Wy),super(null,i,s,a,l,o,d,r,h),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=l!==void 0?l:wa,this.minFilter=o!==void 0?o:wa,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}const cte=new Ws,aj=new v6(1,1),ute=new BL,hte=new d6,fte=new DT,lj=[],cj=[],uj=new Float32Array(16),hj=new Float32Array(9),fj=new Float32Array(4);function hw(n,e,t){const r=n[0];if(r<=0||r>0)return n;const i=e*t;let s=lj[i];if(s===void 0&&(s=new Float32Array(i),lj[i]=s),e!==0){r.toArray(s,0);for(let a=1,l=0;a!==e;++a)l+=t,n[a].toArray(s,l)}return s}function Ha(n,e){if(n.length!==e.length)return!1;for(let t=0,r=n.length;t<r;t++)if(n[t]!==e[t])return!1;return!0}function ja(n,e){for(let t=0,r=e.length;t<r;t++)n[t]=e[t]}function kL(n,e){let t=cj[e];t===void 0&&(t=new Int32Array(e),cj[e]=t);for(let r=0;r!==e;++r)t[r]=n.allocateTextureUnit();return t}function iye(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}function sye(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Ha(t,e))return;n.uniform2fv(this.addr,e),ja(t,e)}}function oye(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(Ha(t,e))return;n.uniform3fv(this.addr,e),ja(t,e)}}function aye(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Ha(t,e))return;n.uniform4fv(this.addr,e),ja(t,e)}}function lye(n,e){const t=this.cache,r=e.elements;if(r===void 0){if(Ha(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),ja(t,e)}else{if(Ha(t,r))return;fj.set(r),n.uniformMatrix2fv(this.addr,!1,fj),ja(t,r)}}function cye(n,e){const t=this.cache,r=e.elements;if(r===void 0){if(Ha(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),ja(t,e)}else{if(Ha(t,r))return;hj.set(r),n.uniformMatrix3fv(this.addr,!1,hj),ja(t,r)}}function uye(n,e){const t=this.cache,r=e.elements;if(r===void 0){if(Ha(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),ja(t,e)}else{if(Ha(t,r))return;uj.set(r),n.uniformMatrix4fv(this.addr,!1,uj),ja(t,r)}}function hye(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}function fye(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Ha(t,e))return;n.uniform2iv(this.addr,e),ja(t,e)}}function dye(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Ha(t,e))return;n.uniform3iv(this.addr,e),ja(t,e)}}function pye(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Ha(t,e))return;n.uniform4iv(this.addr,e),ja(t,e)}}function mye(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}function gye(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Ha(t,e))return;n.uniform2uiv(this.addr,e),ja(t,e)}}function vye(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Ha(t,e))return;n.uniform3uiv(this.addr,e),ja(t,e)}}function _ye(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Ha(t,e))return;n.uniform4uiv(this.addr,e),ja(t,e)}}function yye(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i);let s;this.type===n.SAMPLER_2D_SHADOW?(aj.compareFunction=u6,s=aj):s=cte,t.setTexture2D(e||s,i)}function xye(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.setTexture3D(e||hte,i)}function bye(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.setTextureCube(e||fte,i)}function wye(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.setTexture2DArray(e||ute,i)}function Sye(n){switch(n){case 5126:return iye;case 35664:return sye;case 35665:return oye;case 35666:return aye;case 35674:return lye;case 35675:return cye;case 35676:return uye;case 5124:case 35670:return hye;case 35667:case 35671:return fye;case 35668:case 35672:return dye;case 35669:case 35673:return pye;case 5125:return mye;case 36294:return gye;case 36295:return vye;case 36296:return _ye;case 35678:case 36198:case 36298:case 36306:case 35682:return yye;case 35679:case 36299:case 36307:return xye;case 35680:case 36300:case 36308:case 36293:return bye;case 36289:case 36303:case 36311:case 36292:return wye}}function Aye(n,e){n.uniform1fv(this.addr,e)}function Tye(n,e){const t=hw(e,this.size,2);n.uniform2fv(this.addr,t)}function Mye(n,e){const t=hw(e,this.size,3);n.uniform3fv(this.addr,t)}function Cye(n,e){const t=hw(e,this.size,4);n.uniform4fv(this.addr,t)}function Eye(n,e){const t=hw(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}function Iye(n,e){const t=hw(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}function Rye(n,e){const t=hw(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}function Pye(n,e){n.uniform1iv(this.addr,e)}function Lye(n,e){n.uniform2iv(this.addr,e)}function Dye(n,e){n.uniform3iv(this.addr,e)}function Bye(n,e){n.uniform4iv(this.addr,e)}function kye(n,e){n.uniform1uiv(this.addr,e)}function Oye(n,e){n.uniform2uiv(this.addr,e)}function Fye(n,e){n.uniform3uiv(this.addr,e)}function Nye(n,e){n.uniform4uiv(this.addr,e)}function zye(n,e,t){const r=this.cache,i=e.length,s=kL(t,i);Ha(r,s)||(n.uniform1iv(this.addr,s),ja(r,s));for(let a=0;a!==i;++a)t.setTexture2D(e[a]||cte,s[a])}function Uye(n,e,t){const r=this.cache,i=e.length,s=kL(t,i);Ha(r,s)||(n.uniform1iv(this.addr,s),ja(r,s));for(let a=0;a!==i;++a)t.setTexture3D(e[a]||hte,s[a])}function Vye(n,e,t){const r=this.cache,i=e.length,s=kL(t,i);Ha(r,s)||(n.uniform1iv(this.addr,s),ja(r,s));for(let a=0;a!==i;++a)t.setTextureCube(e[a]||fte,s[a])}function Gye(n,e,t){const r=this.cache,i=e.length,s=kL(t,i);Ha(r,s)||(n.uniform1iv(this.addr,s),ja(r,s));for(let a=0;a!==i;++a)t.setTexture2DArray(e[a]||ute,s[a])}function Hye(n){switch(n){case 5126:return Aye;case 35664:return Tye;case 35665:return Mye;case 35666:return Cye;case 35674:return Eye;case 35675:return Iye;case 35676:return Rye;case 5124:case 35670:return Pye;case 35667:case 35671:return Lye;case 35668:case 35672:return Dye;case 35669:case 35673:return Bye;case 5125:return kye;case 36294:return Oye;case 36295:return Fye;case 36296:return Nye;case 35678:case 36198:case 36298:case 36306:case 35682:return zye;case 35679:case 36299:case 36307:return Uye;case 35680:case 36300:case 36308:case 36293:return Vye;case 36289:case 36303:case 36311:case 36292:return Gye}}class jye{constructor(e,t,r){this.id=e,this.addr=r,this.cache=[],this.type=t.type,this.setValue=Sye(t.type)}}class Wye{constructor(e,t,r){this.id=e,this.addr=r,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=Hye(t.type)}}class Xye{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,r){const i=this.seq;for(let s=0,a=i.length;s!==a;++s){const l=i[s];l.setValue(e,t[l.id],r)}}}const h5=/(\w+)(\])?(\[|\.)?/g;function dj(n,e){n.seq.push(e),n.map[e.id]=e}function $ye(n,e,t){const r=n.name,i=r.length;for(h5.lastIndex=0;;){const s=h5.exec(r),a=h5.lastIndex;let l=s[1];const o=s[2]==="]",h=s[3];if(o&&(l=l|0),h===void 0||h==="["&&a+2===i){dj(t,h===void 0?new jye(l,n,e):new Wye(l,n,e));break}else{let m=t.map[l];m===void 0&&(m=new Xye(l),dj(t,m)),t=m}}}class LI{constructor(e,t){this.seq=[],this.map={};const r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<r;++i){const s=e.getActiveUniform(t,i),a=e.getUniformLocation(t,s.name);$ye(s,a,this)}}setValue(e,t,r,i){const s=this.map[t];s!==void 0&&s.setValue(e,r,i)}setOptional(e,t,r){const i=t[r];i!==void 0&&this.setValue(e,r,i)}static upload(e,t,r,i){for(let s=0,a=t.length;s!==a;++s){const l=t[s],o=r[l.id];o.needsUpdate!==!1&&l.setValue(e,o.value,i)}}static seqWithValue(e,t){const r=[];for(let i=0,s=e.length;i!==s;++i){const a=e[i];a.id in t&&r.push(a)}return r}}function pj(n,e,t){const r=n.createShader(e);return n.shaderSource(r,t),n.compileShader(r),r}const qye=37297;let Zye=0;function Yye(n,e){const t=n.split(`
`),r=[],i=Math.max(e-6,0),s=Math.min(e+6,t.length);for(let a=i;a<s;a++){const l=a+1;r.push(`${l===e?">":" "} ${l}: ${t[a]}`)}return r.join(`
`)}function Kye(n){const e=ds.getPrimaries(ds.workingColorSpace),t=ds.getPrimaries(n);let r;switch(e===t?r="":e===FA&&t===OA?r="LinearDisplayP3ToLinearSRGB":e===OA&&t===FA&&(r="LinearSRGBToLinearDisplayP3"),n){case Ga:case PT:return[r,"LinearTransferOETF"];case Ao:case DL:return[r,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",n),[r,"LinearTransferOETF"]}}function mj(n,e,t){const r=n.getShaderParameter(e,n.COMPILE_STATUS),i=n.getShaderInfoLog(e).trim();if(r&&i==="")return"";const s=/ERROR: 0:(\d+)/.exec(i);if(s){const a=parseInt(s[1]);return t.toUpperCase()+`

`+i+`

`+Yye(n.getShaderSource(e),a)}else return i}function Jye(n,e){const t=Kye(e);return`vec4 ${n}( vec4 value ) { return ${t[0]}( ${t[1]}( value ) ); }`}function Qye(n,e){let t;switch(e){case kee:t="Linear";break;case Oee:t="Reinhard";break;case AL:t="OptimizedCineon";break;case TL:t="ACESFilmic";break;case Nee:t="AgX";break;case zee:t="Neutral";break;case Fee:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function exe(n){return[n.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",n.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(hS).join(`
`)}function txe(n){const e=[];for(const t in n){const r=n[t];r!==!1&&e.push("#define "+t+" "+r)}return e.join(`
`)}function nxe(n,e){const t={},r=n.getProgramParameter(e,n.ACTIVE_ATTRIBUTES);for(let i=0;i<r;i++){const s=n.getActiveAttrib(e,i),a=s.name;let l=1;s.type===n.FLOAT_MAT2&&(l=2),s.type===n.FLOAT_MAT3&&(l=3),s.type===n.FLOAT_MAT4&&(l=4),t[a]={type:s.type,location:n.getAttribLocation(e,a),locationSize:l}}return t}function hS(n){return n!==""}function gj(n,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function vj(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const rxe=/^[ \t]*#include +<([\w\d./]+)>/gm;function YO(n){return n.replace(rxe,sxe)}const ixe=new Map;function sxe(n,e){let t=Ti[e];if(t===void 0){const r=ixe.get(e);if(r!==void 0)t=Ti[r],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,r);else throw new Error("Can not resolve #include <"+e+">")}return YO(t)}const oxe=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function _j(n){return n.replace(oxe,axe)}function axe(n,e,t,r){let i="";for(let s=parseInt(e);s<parseInt(t);s++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return i}function yj(n){let e=`precision ${n.precision} float;
	precision ${n.precision} int;
	precision ${n.precision} sampler2D;
	precision ${n.precision} samplerCube;
	precision ${n.precision} sampler3D;
	precision ${n.precision} sampler2DArray;
	precision ${n.precision} sampler2DShadow;
	precision ${n.precision} samplerCubeShadow;
	precision ${n.precision} sampler2DArrayShadow;
	precision ${n.precision} isampler2D;
	precision ${n.precision} isampler3D;
	precision ${n.precision} isamplerCube;
	precision ${n.precision} isampler2DArray;
	precision ${n.precision} usampler2D;
	precision ${n.precision} usampler3D;
	precision ${n.precision} usamplerCube;
	precision ${n.precision} usampler2DArray;
	`;return n.precision==="highp"?e+=`
#define HIGH_PRECISION`:n.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:n.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function lxe(n){let e="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===SL?e="SHADOWMAP_TYPE_PCF":n.shadowMapType===BS?e="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===Pf&&(e="SHADOWMAP_TYPE_VSM"),e}function cxe(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case Um:case av:e="ENVMAP_TYPE_CUBE";break;case uw:e="ENVMAP_TYPE_CUBE_UV";break}return e}function uxe(n){let e="ENVMAP_MODE_REFLECTION";if(n.envMap)switch(n.envMapMode){case av:e="ENVMAP_MODE_REFRACTION";break}return e}function hxe(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case MT:e="ENVMAP_BLENDING_MULTIPLY";break;case Dee:e="ENVMAP_BLENDING_MIX";break;case Bee:e="ENVMAP_BLENDING_ADD";break}return e}function fxe(n){const e=n.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,r=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:r,maxMip:t}}function dxe(n,e,t,r){const i=n.getContext(),s=t.defines;let a=t.vertexShader,l=t.fragmentShader;const o=lxe(t),h=cxe(t),d=uxe(t),m=hxe(t),_=fxe(t),y=exe(t),T=txe(s),I=i.createProgram();let C,M,B=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(C=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,T].filter(hS).join(`
`),C.length>0&&(C+=`
`),M=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,T].filter(hS).join(`
`),M.length>0&&(M+=`
`)):(C=[yj(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,T,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.batchingColor?"#define USE_BATCHING_COLOR":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+d:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+o:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(hS).join(`
`),M=[yj(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,T,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+h:"",t.envMap?"#define "+d:"",t.envMap?"#define "+m:"",_?"#define CUBEUV_TEXEL_WIDTH "+_.texelWidth:"",_?"#define CUBEUV_TEXEL_HEIGHT "+_.texelHeight:"",_?"#define CUBEUV_MAX_MIP "+_.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor||t.batchingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+o:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==ip?"#define TONE_MAPPING":"",t.toneMapping!==ip?Ti.tonemapping_pars_fragment:"",t.toneMapping!==ip?Qye("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",Ti.colorspace_pars_fragment,Jye("linearToOutputTexel",t.outputColorSpace),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(hS).join(`
`)),a=YO(a),a=gj(a,t),a=vj(a,t),l=YO(l),l=gj(l,t),l=vj(l,t),a=_j(a),l=_j(l),t.isRawShaderMaterial!==!0&&(B=`#version 300 es
`,C=[y,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+C,M=["#define varying in",t.glslVersion===qO?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===qO?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+M);const k=B+C+a,j=B+M+l,q=pj(i,i.VERTEX_SHADER,k),Z=pj(i,i.FRAGMENT_SHADER,j);i.attachShader(I,q),i.attachShader(I,Z),t.index0AttributeName!==void 0?i.bindAttribLocation(I,0,t.index0AttributeName):t.morphTargets===!0&&i.bindAttribLocation(I,0,"position"),i.linkProgram(I);function te(fe){if(n.debug.checkShaderErrors){const Se=i.getProgramInfoLog(I).trim(),Ee=i.getShaderInfoLog(q).trim(),Re=i.getShaderInfoLog(Z).trim();let qe=!0,Le=!0;if(i.getProgramParameter(I,i.LINK_STATUS)===!1)if(qe=!1,typeof n.debug.onShaderError=="function")n.debug.onShaderError(i,I,q,Z);else{const dt=mj(i,q,"vertex"),ye=mj(i,Z,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(I,i.VALIDATE_STATUS)+`

Material Name: `+fe.name+`
Material Type: `+fe.type+`

Program Info Log: `+Se+`
`+dt+`
`+ye)}else Se!==""?console.warn("THREE.WebGLProgram: Program Info Log:",Se):(Ee===""||Re==="")&&(Le=!1);Le&&(fe.diagnostics={runnable:qe,programLog:Se,vertexShader:{log:Ee,prefix:C},fragmentShader:{log:Re,prefix:M}})}i.deleteShader(q),i.deleteShader(Z),ie=new LI(i,I),se=nxe(i,I)}let ie;this.getUniforms=function(){return ie===void 0&&te(this),ie};let se;this.getAttributes=function(){return se===void 0&&te(this),se};let ae=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return ae===!1&&(ae=i.getProgramParameter(I,qye)),ae},this.destroy=function(){r.releaseStatesOfProgram(this),i.deleteProgram(I),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=Zye++,this.cacheKey=e,this.usedTimes=1,this.program=I,this.vertexShader=q,this.fragmentShader=Z,this}let pxe=0;class mxe{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,r=e.fragmentShader,i=this._getShaderStage(t),s=this._getShaderStage(r),a=this._getShaderCacheForMaterial(e);return a.has(i)===!1&&(a.add(i),i.usedTimes++),a.has(s)===!1&&(a.add(s),s.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const r of t)r.usedTimes--,r.usedTimes===0&&this.shaderCache.delete(r.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let r=t.get(e);return r===void 0&&(r=new Set,t.set(e,r)),r}_getShaderStage(e){const t=this.shaderCache;let r=t.get(e);return r===void 0&&(r=new gxe(e),t.set(e,r)),r}}class gxe{constructor(e){this.id=pxe++,this.code=e,this.usedTimes=0}}function vxe(n,e,t,r,i,s,a){const l=new Py,o=new mxe,h=new Set,d=[],m=i.logarithmicDepthBuffer,_=i.vertexTextures;let y=i.precision;const T={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function I(se){return h.add(se),se===0?"uv":`uv${se}`}function C(se,ae,fe,Se,Ee){const Re=Se.fog,qe=Ee.geometry,Le=se.isMeshStandardMaterial?Se.environment:null,dt=(se.isMeshStandardMaterial?t:e).get(se.envMap||Le),ye=dt&&dt.mapping===uw?dt.image.height:null,Xe=T[se.type];se.precision!==null&&(y=i.getMaxPrecision(se.precision),y!==se.precision&&console.warn("THREE.WebGLProgram.getParameters:",se.precision,"not supported, using",y,"instead."));const He=qe.morphAttributes.position||qe.morphAttributes.normal||qe.morphAttributes.color,_t=He!==void 0?He.length:0;let wt=0;qe.morphAttributes.position!==void 0&&(wt=1),qe.morphAttributes.normal!==void 0&&(wt=2),qe.morphAttributes.color!==void 0&&(wt=3);let Gt,at,Ht,Qt;if(Xe){const ui=kf[Xe];Gt=ui.vertexShader,at=ui.fragmentShader}else Gt=se.vertexShader,at=se.fragmentShader,o.update(se),Ht=o.getVertexShaderID(se),Qt=o.getFragmentShaderID(se);const rn=n.getRenderTarget(),jn=Ee.isInstancedMesh===!0,Bn=Ee.isBatchedMesh===!0,Tn=!!se.map,Pe=!!se.matcap,$e=!!dt,mn=!!se.aoMap,cn=!!se.lightMap,St=!!se.bumpMap,Jt=!!se.normalMap,kn=!!se.displacementMap,Vn=!!se.emissiveMap,sn=!!se.metalnessMap,ot=!!se.roughnessMap,Ue=se.anisotropy>0,$t=se.clearcoat>0,An=se.dispersion>0,Sn=se.iridescence>0,jt=se.sheen>0,mr=se.transmission>0,Un=Ue&&!!se.anisotropyMap,tr=$t&&!!se.clearcoatMap,Sr=$t&&!!se.clearcoatNormalMap,Ln=$t&&!!se.clearcoatRoughnessMap,ir=Sn&&!!se.iridescenceMap,ci=Sn&&!!se.iridescenceThicknessMap,Fr=jt&&!!se.sheenColorMap,or=jt&&!!se.sheenRoughnessMap,Nr=!!se.specularMap,Hr=!!se.specularColorMap,_i=!!se.specularIntensityMap,Fe=mr&&!!se.transmissionMap,Lt=mr&&!!se.thicknessMap,Kt=!!se.gradientMap,un=!!se.alphaMap,En=se.alphaTest>0,Ar=!!se.alphaHash,Gr=!!se.extensions;let cs=ip;se.toneMapped&&(rn===null||rn.isXRRenderTarget===!0)&&(cs=n.toneMapping);const Rs={shaderID:Xe,shaderType:se.type,shaderName:se.name,vertexShader:Gt,fragmentShader:at,defines:se.defines,customVertexShaderID:Ht,customFragmentShaderID:Qt,isRawShaderMaterial:se.isRawShaderMaterial===!0,glslVersion:se.glslVersion,precision:y,batching:Bn,batchingColor:Bn&&Ee._colorsTexture!==null,instancing:jn,instancingColor:jn&&Ee.instanceColor!==null,instancingMorph:jn&&Ee.morphTexture!==null,supportsVertexTextures:_,outputColorSpace:rn===null?n.outputColorSpace:rn.isXRRenderTarget===!0?rn.texture.colorSpace:Ga,alphaToCoverage:!!se.alphaToCoverage,map:Tn,matcap:Pe,envMap:$e,envMapMode:$e&&dt.mapping,envMapCubeUVHeight:ye,aoMap:mn,lightMap:cn,bumpMap:St,normalMap:Jt,displacementMap:_&&kn,emissiveMap:Vn,normalMapObjectSpace:Jt&&se.normalMapType===Xee,normalMapTangentSpace:Jt&&se.normalMapType===Av,metalnessMap:sn,roughnessMap:ot,anisotropy:Ue,anisotropyMap:Un,clearcoat:$t,clearcoatMap:tr,clearcoatNormalMap:Sr,clearcoatRoughnessMap:Ln,dispersion:An,iridescence:Sn,iridescenceMap:ir,iridescenceThicknessMap:ci,sheen:jt,sheenColorMap:Fr,sheenRoughnessMap:or,specularMap:Nr,specularColorMap:Hr,specularIntensityMap:_i,transmission:mr,transmissionMap:Fe,thicknessMap:Lt,gradientMap:Kt,opaque:se.transparent===!1&&se.blending===Cy&&se.alphaToCoverage===!1,alphaMap:un,alphaTest:En,alphaHash:Ar,combine:se.combine,mapUv:Tn&&I(se.map.channel),aoMapUv:mn&&I(se.aoMap.channel),lightMapUv:cn&&I(se.lightMap.channel),bumpMapUv:St&&I(se.bumpMap.channel),normalMapUv:Jt&&I(se.normalMap.channel),displacementMapUv:kn&&I(se.displacementMap.channel),emissiveMapUv:Vn&&I(se.emissiveMap.channel),metalnessMapUv:sn&&I(se.metalnessMap.channel),roughnessMapUv:ot&&I(se.roughnessMap.channel),anisotropyMapUv:Un&&I(se.anisotropyMap.channel),clearcoatMapUv:tr&&I(se.clearcoatMap.channel),clearcoatNormalMapUv:Sr&&I(se.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Ln&&I(se.clearcoatRoughnessMap.channel),iridescenceMapUv:ir&&I(se.iridescenceMap.channel),iridescenceThicknessMapUv:ci&&I(se.iridescenceThicknessMap.channel),sheenColorMapUv:Fr&&I(se.sheenColorMap.channel),sheenRoughnessMapUv:or&&I(se.sheenRoughnessMap.channel),specularMapUv:Nr&&I(se.specularMap.channel),specularColorMapUv:Hr&&I(se.specularColorMap.channel),specularIntensityMapUv:_i&&I(se.specularIntensityMap.channel),transmissionMapUv:Fe&&I(se.transmissionMap.channel),thicknessMapUv:Lt&&I(se.thicknessMap.channel),alphaMapUv:un&&I(se.alphaMap.channel),vertexTangents:!!qe.attributes.tangent&&(Jt||Ue),vertexColors:se.vertexColors,vertexAlphas:se.vertexColors===!0&&!!qe.attributes.color&&qe.attributes.color.itemSize===4,pointsUvs:Ee.isPoints===!0&&!!qe.attributes.uv&&(Tn||un),fog:!!Re,useFog:se.fog===!0,fogExp2:!!Re&&Re.isFogExp2,flatShading:se.flatShading===!0,sizeAttenuation:se.sizeAttenuation===!0,logarithmicDepthBuffer:m,skinning:Ee.isSkinnedMesh===!0,morphTargets:qe.morphAttributes.position!==void 0,morphNormals:qe.morphAttributes.normal!==void 0,morphColors:qe.morphAttributes.color!==void 0,morphTargetsCount:_t,morphTextureStride:wt,numDirLights:ae.directional.length,numPointLights:ae.point.length,numSpotLights:ae.spot.length,numSpotLightMaps:ae.spotLightMap.length,numRectAreaLights:ae.rectArea.length,numHemiLights:ae.hemi.length,numDirLightShadows:ae.directionalShadowMap.length,numPointLightShadows:ae.pointShadowMap.length,numSpotLightShadows:ae.spotShadowMap.length,numSpotLightShadowsWithMaps:ae.numSpotLightShadowsWithMaps,numLightProbes:ae.numLightProbes,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:se.dithering,shadowMapEnabled:n.shadowMap.enabled&&fe.length>0,shadowMapType:n.shadowMap.type,toneMapping:cs,decodeVideoTexture:Tn&&se.map.isVideoTexture===!0&&ds.getTransfer(se.map.colorSpace)===eo,premultipliedAlpha:se.premultipliedAlpha,doubleSided:se.side===bc,flipSided:se.side===Mc,useDepthPacking:se.depthPacking>=0,depthPacking:se.depthPacking||0,index0AttributeName:se.index0AttributeName,extensionClipCullDistance:Gr&&se.extensions.clipCullDistance===!0&&r.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(Gr&&se.extensions.multiDraw===!0||Bn)&&r.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:r.has("KHR_parallel_shader_compile"),customProgramCacheKey:se.customProgramCacheKey()};return Rs.vertexUv1s=h.has(1),Rs.vertexUv2s=h.has(2),Rs.vertexUv3s=h.has(3),h.clear(),Rs}function M(se){const ae=[];if(se.shaderID?ae.push(se.shaderID):(ae.push(se.customVertexShaderID),ae.push(se.customFragmentShaderID)),se.defines!==void 0)for(const fe in se.defines)ae.push(fe),ae.push(se.defines[fe]);return se.isRawShaderMaterial===!1&&(B(ae,se),k(ae,se),ae.push(n.outputColorSpace)),ae.push(se.customProgramCacheKey),ae.join()}function B(se,ae){se.push(ae.precision),se.push(ae.outputColorSpace),se.push(ae.envMapMode),se.push(ae.envMapCubeUVHeight),se.push(ae.mapUv),se.push(ae.alphaMapUv),se.push(ae.lightMapUv),se.push(ae.aoMapUv),se.push(ae.bumpMapUv),se.push(ae.normalMapUv),se.push(ae.displacementMapUv),se.push(ae.emissiveMapUv),se.push(ae.metalnessMapUv),se.push(ae.roughnessMapUv),se.push(ae.anisotropyMapUv),se.push(ae.clearcoatMapUv),se.push(ae.clearcoatNormalMapUv),se.push(ae.clearcoatRoughnessMapUv),se.push(ae.iridescenceMapUv),se.push(ae.iridescenceThicknessMapUv),se.push(ae.sheenColorMapUv),se.push(ae.sheenRoughnessMapUv),se.push(ae.specularMapUv),se.push(ae.specularColorMapUv),se.push(ae.specularIntensityMapUv),se.push(ae.transmissionMapUv),se.push(ae.thicknessMapUv),se.push(ae.combine),se.push(ae.fogExp2),se.push(ae.sizeAttenuation),se.push(ae.morphTargetsCount),se.push(ae.morphAttributeCount),se.push(ae.numDirLights),se.push(ae.numPointLights),se.push(ae.numSpotLights),se.push(ae.numSpotLightMaps),se.push(ae.numHemiLights),se.push(ae.numRectAreaLights),se.push(ae.numDirLightShadows),se.push(ae.numPointLightShadows),se.push(ae.numSpotLightShadows),se.push(ae.numSpotLightShadowsWithMaps),se.push(ae.numLightProbes),se.push(ae.shadowMapType),se.push(ae.toneMapping),se.push(ae.numClippingPlanes),se.push(ae.numClipIntersection),se.push(ae.depthPacking)}function k(se,ae){l.disableAll(),ae.supportsVertexTextures&&l.enable(0),ae.instancing&&l.enable(1),ae.instancingColor&&l.enable(2),ae.instancingMorph&&l.enable(3),ae.matcap&&l.enable(4),ae.envMap&&l.enable(5),ae.normalMapObjectSpace&&l.enable(6),ae.normalMapTangentSpace&&l.enable(7),ae.clearcoat&&l.enable(8),ae.iridescence&&l.enable(9),ae.alphaTest&&l.enable(10),ae.vertexColors&&l.enable(11),ae.vertexAlphas&&l.enable(12),ae.vertexUv1s&&l.enable(13),ae.vertexUv2s&&l.enable(14),ae.vertexUv3s&&l.enable(15),ae.vertexTangents&&l.enable(16),ae.anisotropy&&l.enable(17),ae.alphaHash&&l.enable(18),ae.batching&&l.enable(19),ae.dispersion&&l.enable(20),ae.batchingColor&&l.enable(21),se.push(l.mask),l.disableAll(),ae.fog&&l.enable(0),ae.useFog&&l.enable(1),ae.flatShading&&l.enable(2),ae.logarithmicDepthBuffer&&l.enable(3),ae.skinning&&l.enable(4),ae.morphTargets&&l.enable(5),ae.morphNormals&&l.enable(6),ae.morphColors&&l.enable(7),ae.premultipliedAlpha&&l.enable(8),ae.shadowMapEnabled&&l.enable(9),ae.doubleSided&&l.enable(10),ae.flipSided&&l.enable(11),ae.useDepthPacking&&l.enable(12),ae.dithering&&l.enable(13),ae.transmission&&l.enable(14),ae.sheen&&l.enable(15),ae.opaque&&l.enable(16),ae.pointsUvs&&l.enable(17),ae.decodeVideoTexture&&l.enable(18),ae.alphaToCoverage&&l.enable(19),se.push(l.mask)}function j(se){const ae=T[se.type];let fe;if(ae){const Se=kf[ae];fe=Gm.clone(Se.uniforms)}else fe=se.uniforms;return fe}function q(se,ae){let fe;for(let Se=0,Ee=d.length;Se<Ee;Se++){const Re=d[Se];if(Re.cacheKey===ae){fe=Re,++fe.usedTimes;break}}return fe===void 0&&(fe=new dxe(n,ae,se,s),d.push(fe)),fe}function Z(se){if(--se.usedTimes===0){const ae=d.indexOf(se);d[ae]=d[d.length-1],d.pop(),se.destroy()}}function te(se){o.remove(se)}function ie(){o.dispose()}return{getParameters:C,getProgramCacheKey:M,getUniforms:j,acquireProgram:q,releaseProgram:Z,releaseShaderCache:te,programs:d,dispose:ie}}function _xe(){let n=new WeakMap;function e(s){let a=n.get(s);return a===void 0&&(a={},n.set(s,a)),a}function t(s){n.delete(s)}function r(s,a,l){n.get(s)[a]=l}function i(){n=new WeakMap}return{get:e,remove:t,update:r,dispose:i}}function yxe(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function xj(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function bj(){const n=[];let e=0;const t=[],r=[],i=[];function s(){e=0,t.length=0,r.length=0,i.length=0}function a(m,_,y,T,I,C){let M=n[e];return M===void 0?(M={id:m.id,object:m,geometry:_,material:y,groupOrder:T,renderOrder:m.renderOrder,z:I,group:C},n[e]=M):(M.id=m.id,M.object=m,M.geometry=_,M.material=y,M.groupOrder=T,M.renderOrder=m.renderOrder,M.z=I,M.group=C),e++,M}function l(m,_,y,T,I,C){const M=a(m,_,y,T,I,C);y.transmission>0?r.push(M):y.transparent===!0?i.push(M):t.push(M)}function o(m,_,y,T,I,C){const M=a(m,_,y,T,I,C);y.transmission>0?r.unshift(M):y.transparent===!0?i.unshift(M):t.unshift(M)}function h(m,_){t.length>1&&t.sort(m||yxe),r.length>1&&r.sort(_||xj),i.length>1&&i.sort(_||xj)}function d(){for(let m=e,_=n.length;m<_;m++){const y=n[m];if(y.id===null)break;y.id=null,y.object=null,y.geometry=null,y.material=null,y.group=null}}return{opaque:t,transmissive:r,transparent:i,init:s,push:l,unshift:o,finish:d,sort:h}}function xxe(){let n=new WeakMap;function e(r,i){const s=n.get(r);let a;return s===void 0?(a=new bj,n.set(r,[a])):i>=s.length?(a=new bj,s.push(a)):a=s[i],a}function t(){n=new WeakMap}return{get:e,dispose:t}}function bxe(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new Ze,color:new Gn};break;case"SpotLight":t={position:new Ze,direction:new Ze,color:new Gn,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new Ze,color:new Gn,distance:0,decay:0};break;case"HemisphereLight":t={direction:new Ze,skyColor:new Gn,groundColor:new Gn};break;case"RectAreaLight":t={color:new Gn,position:new Ze,halfWidth:new Ze,halfHeight:new Ze};break}return n[e.id]=t,t}}}function wxe(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new nn};break;case"SpotLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new nn};break;case"PointLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new nn,shadowCameraNear:1,shadowCameraFar:1e3};break}return n[e.id]=t,t}}}let Sxe=0;function Axe(n,e){return(e.castShadow?2:0)-(n.castShadow?2:0)+(e.map?1:0)-(n.map?1:0)}function Txe(n){const e=new bxe,t=wxe(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let h=0;h<9;h++)r.probe.push(new Ze);const i=new Ze,s=new Vr,a=new Vr;function l(h){let d=0,m=0,_=0;for(let se=0;se<9;se++)r.probe[se].set(0,0,0);let y=0,T=0,I=0,C=0,M=0,B=0,k=0,j=0,q=0,Z=0,te=0;h.sort(Axe);for(let se=0,ae=h.length;se<ae;se++){const fe=h[se],Se=fe.color,Ee=fe.intensity,Re=fe.distance,qe=fe.shadow&&fe.shadow.map?fe.shadow.map.texture:null;if(fe.isAmbientLight)d+=Se.r*Ee,m+=Se.g*Ee,_+=Se.b*Ee;else if(fe.isLightProbe){for(let Le=0;Le<9;Le++)r.probe[Le].addScaledVector(fe.sh.coefficients[Le],Ee);te++}else if(fe.isDirectionalLight){const Le=e.get(fe);if(Le.color.copy(fe.color).multiplyScalar(fe.intensity),fe.castShadow){const dt=fe.shadow,ye=t.get(fe);ye.shadowIntensity=dt.intensity,ye.shadowBias=dt.bias,ye.shadowNormalBias=dt.normalBias,ye.shadowRadius=dt.radius,ye.shadowMapSize=dt.mapSize,r.directionalShadow[y]=ye,r.directionalShadowMap[y]=qe,r.directionalShadowMatrix[y]=fe.shadow.matrix,B++}r.directional[y]=Le,y++}else if(fe.isSpotLight){const Le=e.get(fe);Le.position.setFromMatrixPosition(fe.matrixWorld),Le.color.copy(Se).multiplyScalar(Ee),Le.distance=Re,Le.coneCos=Math.cos(fe.angle),Le.penumbraCos=Math.cos(fe.angle*(1-fe.penumbra)),Le.decay=fe.decay,r.spot[I]=Le;const dt=fe.shadow;if(fe.map&&(r.spotLightMap[q]=fe.map,q++,dt.updateMatrices(fe),fe.castShadow&&Z++),r.spotLightMatrix[I]=dt.matrix,fe.castShadow){const ye=t.get(fe);ye.shadowIntensity=dt.intensity,ye.shadowBias=dt.bias,ye.shadowNormalBias=dt.normalBias,ye.shadowRadius=dt.radius,ye.shadowMapSize=dt.mapSize,r.spotShadow[I]=ye,r.spotShadowMap[I]=qe,j++}I++}else if(fe.isRectAreaLight){const Le=e.get(fe);Le.color.copy(Se).multiplyScalar(Ee),Le.halfWidth.set(fe.width*.5,0,0),Le.halfHeight.set(0,fe.height*.5,0),r.rectArea[C]=Le,C++}else if(fe.isPointLight){const Le=e.get(fe);if(Le.color.copy(fe.color).multiplyScalar(fe.intensity),Le.distance=fe.distance,Le.decay=fe.decay,fe.castShadow){const dt=fe.shadow,ye=t.get(fe);ye.shadowIntensity=dt.intensity,ye.shadowBias=dt.bias,ye.shadowNormalBias=dt.normalBias,ye.shadowRadius=dt.radius,ye.shadowMapSize=dt.mapSize,ye.shadowCameraNear=dt.camera.near,ye.shadowCameraFar=dt.camera.far,r.pointShadow[T]=ye,r.pointShadowMap[T]=qe,r.pointShadowMatrix[T]=fe.shadow.matrix,k++}r.point[T]=Le,T++}else if(fe.isHemisphereLight){const Le=e.get(fe);Le.skyColor.copy(fe.color).multiplyScalar(Ee),Le.groundColor.copy(fe.groundColor).multiplyScalar(Ee),r.hemi[M]=Le,M++}}C>0&&(n.has("OES_texture_float_linear")===!0?(r.rectAreaLTC1=hr.LTC_FLOAT_1,r.rectAreaLTC2=hr.LTC_FLOAT_2):(r.rectAreaLTC1=hr.LTC_HALF_1,r.rectAreaLTC2=hr.LTC_HALF_2)),r.ambient[0]=d,r.ambient[1]=m,r.ambient[2]=_;const ie=r.hash;(ie.directionalLength!==y||ie.pointLength!==T||ie.spotLength!==I||ie.rectAreaLength!==C||ie.hemiLength!==M||ie.numDirectionalShadows!==B||ie.numPointShadows!==k||ie.numSpotShadows!==j||ie.numSpotMaps!==q||ie.numLightProbes!==te)&&(r.directional.length=y,r.spot.length=I,r.rectArea.length=C,r.point.length=T,r.hemi.length=M,r.directionalShadow.length=B,r.directionalShadowMap.length=B,r.pointShadow.length=k,r.pointShadowMap.length=k,r.spotShadow.length=j,r.spotShadowMap.length=j,r.directionalShadowMatrix.length=B,r.pointShadowMatrix.length=k,r.spotLightMatrix.length=j+q-Z,r.spotLightMap.length=q,r.numSpotLightShadowsWithMaps=Z,r.numLightProbes=te,ie.directionalLength=y,ie.pointLength=T,ie.spotLength=I,ie.rectAreaLength=C,ie.hemiLength=M,ie.numDirectionalShadows=B,ie.numPointShadows=k,ie.numSpotShadows=j,ie.numSpotMaps=q,ie.numLightProbes=te,r.version=Sxe++)}function o(h,d){let m=0,_=0,y=0,T=0,I=0;const C=d.matrixWorldInverse;for(let M=0,B=h.length;M<B;M++){const k=h[M];if(k.isDirectionalLight){const j=r.directional[m];j.direction.setFromMatrixPosition(k.matrixWorld),i.setFromMatrixPosition(k.target.matrixWorld),j.direction.sub(i),j.direction.transformDirection(C),m++}else if(k.isSpotLight){const j=r.spot[y];j.position.setFromMatrixPosition(k.matrixWorld),j.position.applyMatrix4(C),j.direction.setFromMatrixPosition(k.matrixWorld),i.setFromMatrixPosition(k.target.matrixWorld),j.direction.sub(i),j.direction.transformDirection(C),y++}else if(k.isRectAreaLight){const j=r.rectArea[T];j.position.setFromMatrixPosition(k.matrixWorld),j.position.applyMatrix4(C),a.identity(),s.copy(k.matrixWorld),s.premultiply(C),a.extractRotation(s),j.halfWidth.set(k.width*.5,0,0),j.halfHeight.set(0,k.height*.5,0),j.halfWidth.applyMatrix4(a),j.halfHeight.applyMatrix4(a),T++}else if(k.isPointLight){const j=r.point[_];j.position.setFromMatrixPosition(k.matrixWorld),j.position.applyMatrix4(C),_++}else if(k.isHemisphereLight){const j=r.hemi[I];j.direction.setFromMatrixPosition(k.matrixWorld),j.direction.transformDirection(C),I++}}}return{setup:l,setupView:o,state:r}}function wj(n){const e=new Txe(n),t=[],r=[];function i(d){h.camera=d,t.length=0,r.length=0}function s(d){t.push(d)}function a(d){r.push(d)}function l(){e.setup(t)}function o(d){e.setupView(t,d)}const h={lightsArray:t,shadowsArray:r,camera:null,lights:e,transmissionRenderTarget:{}};return{init:i,state:h,setupLights:l,setupLightsView:o,pushLight:s,pushShadow:a}}function Mxe(n){let e=new WeakMap;function t(i,s=0){const a=e.get(i);let l;return a===void 0?(l=new wj(n),e.set(i,[l])):s>=a.length?(l=new wj(n),a.push(l)):l=a[s],l}function r(){e=new WeakMap}return{get:t,dispose:r}}class _6 extends _o{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=jee,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class y6 extends _o{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const Cxe=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,Exe=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function Ixe(n,e,t){let r=new BT;const i=new nn,s=new nn,a=new Es,l=new _6({depthPacking:Wee}),o=new y6,h={},d=t.maxTextureSize,m={[Rh]:Mc,[Mc]:Rh,[bc]:bc},_=new Eo({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new nn},radius:{value:4}},vertexShader:Cxe,fragmentShader:Exe}),y=_.clone();y.defines.HORIZONTAL_PASS=1;const T=new $r;T.setAttribute("position",new Di(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const I=new Ei(T,_),C=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=SL;let M=this.type;this.render=function(Z,te,ie){if(C.enabled===!1||C.autoUpdate===!1&&C.needsUpdate===!1||Z.length===0)return;const se=n.getRenderTarget(),ae=n.getActiveCubeFace(),fe=n.getActiveMipmapLevel(),Se=n.state;Se.setBlending(rp),Se.buffers.color.setClear(1,1,1,1),Se.buffers.depth.setTest(!0),Se.setScissorTest(!1);const Ee=M!==Pf&&this.type===Pf,Re=M===Pf&&this.type!==Pf;for(let qe=0,Le=Z.length;qe<Le;qe++){const dt=Z[qe],ye=dt.shadow;if(ye===void 0){console.warn("THREE.WebGLShadowMap:",dt,"has no shadow.");continue}if(ye.autoUpdate===!1&&ye.needsUpdate===!1)continue;i.copy(ye.mapSize);const Xe=ye.getFrameExtents();if(i.multiply(Xe),s.copy(ye.mapSize),(i.x>d||i.y>d)&&(i.x>d&&(s.x=Math.floor(d/Xe.x),i.x=s.x*Xe.x,ye.mapSize.x=s.x),i.y>d&&(s.y=Math.floor(d/Xe.y),i.y=s.y*Xe.y,ye.mapSize.y=s.y)),ye.map===null||Ee===!0||Re===!0){const _t=this.type!==Pf?{minFilter:wa,magFilter:wa}:{};ye.map!==null&&ye.map.dispose(),ye.map=new bl(i.x,i.y,_t),ye.map.texture.name=dt.name+".shadowMap",ye.camera.updateProjectionMatrix()}n.setRenderTarget(ye.map),n.clear();const He=ye.getViewportCount();for(let _t=0;_t<He;_t++){const wt=ye.getViewport(_t);a.set(s.x*wt.x,s.y*wt.y,s.x*wt.z,s.y*wt.w),Se.viewport(a),ye.updateMatrices(dt,_t),r=ye.getFrustum(),j(te,ie,ye.camera,dt,this.type)}ye.isPointLightShadow!==!0&&this.type===Pf&&B(ye,ie),ye.needsUpdate=!1}M=this.type,C.needsUpdate=!1,n.setRenderTarget(se,ae,fe)};function B(Z,te){const ie=e.update(I);_.defines.VSM_SAMPLES!==Z.blurSamples&&(_.defines.VSM_SAMPLES=Z.blurSamples,y.defines.VSM_SAMPLES=Z.blurSamples,_.needsUpdate=!0,y.needsUpdate=!0),Z.mapPass===null&&(Z.mapPass=new bl(i.x,i.y)),_.uniforms.shadow_pass.value=Z.map.texture,_.uniforms.resolution.value=Z.mapSize,_.uniforms.radius.value=Z.radius,n.setRenderTarget(Z.mapPass),n.clear(),n.renderBufferDirect(te,null,ie,_,I,null),y.uniforms.shadow_pass.value=Z.mapPass.texture,y.uniforms.resolution.value=Z.mapSize,y.uniforms.radius.value=Z.radius,n.setRenderTarget(Z.map),n.clear(),n.renderBufferDirect(te,null,ie,y,I,null)}function k(Z,te,ie,se){let ae=null;const fe=ie.isPointLight===!0?Z.customDistanceMaterial:Z.customDepthMaterial;if(fe!==void 0)ae=fe;else if(ae=ie.isPointLight===!0?o:l,n.localClippingEnabled&&te.clipShadows===!0&&Array.isArray(te.clippingPlanes)&&te.clippingPlanes.length!==0||te.displacementMap&&te.displacementScale!==0||te.alphaMap&&te.alphaTest>0||te.map&&te.alphaTest>0){const Se=ae.uuid,Ee=te.uuid;let Re=h[Se];Re===void 0&&(Re={},h[Se]=Re);let qe=Re[Ee];qe===void 0&&(qe=ae.clone(),Re[Ee]=qe,te.addEventListener("dispose",q)),ae=qe}if(ae.visible=te.visible,ae.wireframe=te.wireframe,se===Pf?ae.side=te.shadowSide!==null?te.shadowSide:te.side:ae.side=te.shadowSide!==null?te.shadowSide:m[te.side],ae.alphaMap=te.alphaMap,ae.alphaTest=te.alphaTest,ae.map=te.map,ae.clipShadows=te.clipShadows,ae.clippingPlanes=te.clippingPlanes,ae.clipIntersection=te.clipIntersection,ae.displacementMap=te.displacementMap,ae.displacementScale=te.displacementScale,ae.displacementBias=te.displacementBias,ae.wireframeLinewidth=te.wireframeLinewidth,ae.linewidth=te.linewidth,ie.isPointLight===!0&&ae.isMeshDistanceMaterial===!0){const Se=n.properties.get(ae);Se.light=ie}return ae}function j(Z,te,ie,se,ae){if(Z.visible===!1)return;if(Z.layers.test(te.layers)&&(Z.isMesh||Z.isLine||Z.isPoints)&&(Z.castShadow||Z.receiveShadow&&ae===Pf)&&(!Z.frustumCulled||r.intersectsObject(Z))){Z.modelViewMatrix.multiplyMatrices(ie.matrixWorldInverse,Z.matrixWorld);const Ee=e.update(Z),Re=Z.material;if(Array.isArray(Re)){const qe=Ee.groups;for(let Le=0,dt=qe.length;Le<dt;Le++){const ye=qe[Le],Xe=Re[ye.materialIndex];if(Xe&&Xe.visible){const He=k(Z,Xe,se,ae);Z.onBeforeShadow(n,Z,te,ie,Ee,He,ye),n.renderBufferDirect(ie,null,Ee,He,Z,ye),Z.onAfterShadow(n,Z,te,ie,Ee,He,ye)}}}else if(Re.visible){const qe=k(Z,Re,se,ae);Z.onBeforeShadow(n,Z,te,ie,Ee,qe,null),n.renderBufferDirect(ie,null,Ee,qe,Z,null),Z.onAfterShadow(n,Z,te,ie,Ee,qe,null)}}const Se=Z.children;for(let Ee=0,Re=Se.length;Ee<Re;Ee++)j(Se[Ee],te,ie,se,ae)}function q(Z){Z.target.removeEventListener("dispose",q);for(const ie in h){const se=h[ie],ae=Z.target.uuid;ae in se&&(se[ae].dispose(),delete se[ae])}}}function Rxe(n){function e(){let Fe=!1;const Lt=new Es;let Kt=null;const un=new Es(0,0,0,0);return{setMask:function(En){Kt!==En&&!Fe&&(n.colorMask(En,En,En,En),Kt=En)},setLocked:function(En){Fe=En},setClear:function(En,Ar,Gr,cs,Rs){Rs===!0&&(En*=cs,Ar*=cs,Gr*=cs),Lt.set(En,Ar,Gr,cs),un.equals(Lt)===!1&&(n.clearColor(En,Ar,Gr,cs),un.copy(Lt))},reset:function(){Fe=!1,Kt=null,un.set(-1,0,0,0)}}}function t(){let Fe=!1,Lt=null,Kt=null,un=null;return{setTest:function(En){En?Qt(n.DEPTH_TEST):rn(n.DEPTH_TEST)},setMask:function(En){Lt!==En&&!Fe&&(n.depthMask(En),Lt=En)},setFunc:function(En){if(Kt!==En){switch(En){case Mee:n.depthFunc(n.NEVER);break;case Cee:n.depthFunc(n.ALWAYS);break;case Eee:n.depthFunc(n.LESS);break;case PA:n.depthFunc(n.LEQUAL);break;case Iee:n.depthFunc(n.EQUAL);break;case Ree:n.depthFunc(n.GEQUAL);break;case Pee:n.depthFunc(n.GREATER);break;case Lee:n.depthFunc(n.NOTEQUAL);break;default:n.depthFunc(n.LEQUAL)}Kt=En}},setLocked:function(En){Fe=En},setClear:function(En){un!==En&&(n.clearDepth(En),un=En)},reset:function(){Fe=!1,Lt=null,Kt=null,un=null}}}function r(){let Fe=!1,Lt=null,Kt=null,un=null,En=null,Ar=null,Gr=null,cs=null,Rs=null;return{setTest:function(ui){Fe||(ui?Qt(n.STENCIL_TEST):rn(n.STENCIL_TEST))},setMask:function(ui){Lt!==ui&&!Fe&&(n.stencilMask(ui),Lt=ui)},setFunc:function(ui,Tt,xe){(Kt!==ui||un!==Tt||En!==xe)&&(n.stencilFunc(ui,Tt,xe),Kt=ui,un=Tt,En=xe)},setOp:function(ui,Tt,xe){(Ar!==ui||Gr!==Tt||cs!==xe)&&(n.stencilOp(ui,Tt,xe),Ar=ui,Gr=Tt,cs=xe)},setLocked:function(ui){Fe=ui},setClear:function(ui){Rs!==ui&&(n.clearStencil(ui),Rs=ui)},reset:function(){Fe=!1,Lt=null,Kt=null,un=null,En=null,Ar=null,Gr=null,cs=null,Rs=null}}}const i=new e,s=new t,a=new r,l=new WeakMap,o=new WeakMap;let h={},d={},m=new WeakMap,_=[],y=null,T=!1,I=null,C=null,M=null,B=null,k=null,j=null,q=null,Z=new Gn(0,0,0),te=0,ie=!1,se=null,ae=null,fe=null,Se=null,Ee=null;const Re=n.getParameter(n.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let qe=!1,Le=0;const dt=n.getParameter(n.VERSION);dt.indexOf("WebGL")!==-1?(Le=parseFloat(/^WebGL (\d)/.exec(dt)[1]),qe=Le>=1):dt.indexOf("OpenGL ES")!==-1&&(Le=parseFloat(/^OpenGL ES (\d)/.exec(dt)[1]),qe=Le>=2);let ye=null,Xe={};const He=n.getParameter(n.SCISSOR_BOX),_t=n.getParameter(n.VIEWPORT),wt=new Es().fromArray(He),Gt=new Es().fromArray(_t);function at(Fe,Lt,Kt,un){const En=new Uint8Array(4),Ar=n.createTexture();n.bindTexture(Fe,Ar),n.texParameteri(Fe,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(Fe,n.TEXTURE_MAG_FILTER,n.NEAREST);for(let Gr=0;Gr<Kt;Gr++)Fe===n.TEXTURE_3D||Fe===n.TEXTURE_2D_ARRAY?n.texImage3D(Lt,0,n.RGBA,1,1,un,0,n.RGBA,n.UNSIGNED_BYTE,En):n.texImage2D(Lt+Gr,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,En);return Ar}const Ht={};Ht[n.TEXTURE_2D]=at(n.TEXTURE_2D,n.TEXTURE_2D,1),Ht[n.TEXTURE_CUBE_MAP]=at(n.TEXTURE_CUBE_MAP,n.TEXTURE_CUBE_MAP_POSITIVE_X,6),Ht[n.TEXTURE_2D_ARRAY]=at(n.TEXTURE_2D_ARRAY,n.TEXTURE_2D_ARRAY,1,1),Ht[n.TEXTURE_3D]=at(n.TEXTURE_3D,n.TEXTURE_3D,1,1),i.setClear(0,0,0,1),s.setClear(1),a.setClear(0),Qt(n.DEPTH_TEST),s.setFunc(PA),St(!1),Jt(HO),Qt(n.CULL_FACE),mn(rp);function Qt(Fe){h[Fe]!==!0&&(n.enable(Fe),h[Fe]=!0)}function rn(Fe){h[Fe]!==!1&&(n.disable(Fe),h[Fe]=!1)}function jn(Fe,Lt){return d[Fe]!==Lt?(n.bindFramebuffer(Fe,Lt),d[Fe]=Lt,Fe===n.DRAW_FRAMEBUFFER&&(d[n.FRAMEBUFFER]=Lt),Fe===n.FRAMEBUFFER&&(d[n.DRAW_FRAMEBUFFER]=Lt),!0):!1}function Bn(Fe,Lt){let Kt=_,un=!1;if(Fe){Kt=m.get(Lt),Kt===void 0&&(Kt=[],m.set(Lt,Kt));const En=Fe.textures;if(Kt.length!==En.length||Kt[0]!==n.COLOR_ATTACHMENT0){for(let Ar=0,Gr=En.length;Ar<Gr;Ar++)Kt[Ar]=n.COLOR_ATTACHMENT0+Ar;Kt.length=En.length,un=!0}}else Kt[0]!==n.BACK&&(Kt[0]=n.BACK,un=!0);un&&n.drawBuffers(Kt)}function Tn(Fe){return y!==Fe?(n.useProgram(Fe),y=Fe,!0):!1}const Pe={[D0]:n.FUNC_ADD,[cee]:n.FUNC_SUBTRACT,[uee]:n.FUNC_REVERSE_SUBTRACT};Pe[hee]=n.MIN,Pe[fee]=n.MAX;const $e={[dee]:n.ZERO,[pee]:n.ONE,[mee]:n.SRC_COLOR,[TR]:n.SRC_ALPHA,[bee]:n.SRC_ALPHA_SATURATE,[yee]:n.DST_COLOR,[vee]:n.DST_ALPHA,[gee]:n.ONE_MINUS_SRC_COLOR,[MR]:n.ONE_MINUS_SRC_ALPHA,[xee]:n.ONE_MINUS_DST_COLOR,[_ee]:n.ONE_MINUS_DST_ALPHA,[wee]:n.CONSTANT_COLOR,[See]:n.ONE_MINUS_CONSTANT_COLOR,[Aee]:n.CONSTANT_ALPHA,[Tee]:n.ONE_MINUS_CONSTANT_ALPHA};function mn(Fe,Lt,Kt,un,En,Ar,Gr,cs,Rs,ui){if(Fe===rp){T===!0&&(rn(n.BLEND),T=!1);return}if(T===!1&&(Qt(n.BLEND),T=!0),Fe!==lee){if(Fe!==I||ui!==ie){if((C!==D0||k!==D0)&&(n.blendEquation(n.FUNC_ADD),C=D0,k=D0),ui)switch(Fe){case Cy:n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case Wb:n.blendFunc(n.ONE,n.ONE);break;case jO:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case WO:n.blendFuncSeparate(n.ZERO,n.SRC_COLOR,n.ZERO,n.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",Fe);break}else switch(Fe){case Cy:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case Wb:n.blendFunc(n.SRC_ALPHA,n.ONE);break;case jO:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case WO:n.blendFunc(n.ZERO,n.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",Fe);break}M=null,B=null,j=null,q=null,Z.set(0,0,0),te=0,I=Fe,ie=ui}return}En=En||Lt,Ar=Ar||Kt,Gr=Gr||un,(Lt!==C||En!==k)&&(n.blendEquationSeparate(Pe[Lt],Pe[En]),C=Lt,k=En),(Kt!==M||un!==B||Ar!==j||Gr!==q)&&(n.blendFuncSeparate($e[Kt],$e[un],$e[Ar],$e[Gr]),M=Kt,B=un,j=Ar,q=Gr),(cs.equals(Z)===!1||Rs!==te)&&(n.blendColor(cs.r,cs.g,cs.b,Rs),Z.copy(cs),te=Rs),I=Fe,ie=!1}function cn(Fe,Lt){Fe.side===bc?rn(n.CULL_FACE):Qt(n.CULL_FACE);let Kt=Fe.side===Mc;Lt&&(Kt=!Kt),St(Kt),Fe.blending===Cy&&Fe.transparent===!1?mn(rp):mn(Fe.blending,Fe.blendEquation,Fe.blendSrc,Fe.blendDst,Fe.blendEquationAlpha,Fe.blendSrcAlpha,Fe.blendDstAlpha,Fe.blendColor,Fe.blendAlpha,Fe.premultipliedAlpha),s.setFunc(Fe.depthFunc),s.setTest(Fe.depthTest),s.setMask(Fe.depthWrite),i.setMask(Fe.colorWrite);const un=Fe.stencilWrite;a.setTest(un),un&&(a.setMask(Fe.stencilWriteMask),a.setFunc(Fe.stencilFunc,Fe.stencilRef,Fe.stencilFuncMask),a.setOp(Fe.stencilFail,Fe.stencilZFail,Fe.stencilZPass)),Vn(Fe.polygonOffset,Fe.polygonOffsetFactor,Fe.polygonOffsetUnits),Fe.alphaToCoverage===!0?Qt(n.SAMPLE_ALPHA_TO_COVERAGE):rn(n.SAMPLE_ALPHA_TO_COVERAGE)}function St(Fe){se!==Fe&&(Fe?n.frontFace(n.CW):n.frontFace(n.CCW),se=Fe)}function Jt(Fe){Fe!==see?(Qt(n.CULL_FACE),Fe!==ae&&(Fe===HO?n.cullFace(n.BACK):Fe===oee?n.cullFace(n.FRONT):n.cullFace(n.FRONT_AND_BACK))):rn(n.CULL_FACE),ae=Fe}function kn(Fe){Fe!==fe&&(qe&&n.lineWidth(Fe),fe=Fe)}function Vn(Fe,Lt,Kt){Fe?(Qt(n.POLYGON_OFFSET_FILL),(Se!==Lt||Ee!==Kt)&&(n.polygonOffset(Lt,Kt),Se=Lt,Ee=Kt)):rn(n.POLYGON_OFFSET_FILL)}function sn(Fe){Fe?Qt(n.SCISSOR_TEST):rn(n.SCISSOR_TEST)}function ot(Fe){Fe===void 0&&(Fe=n.TEXTURE0+Re-1),ye!==Fe&&(n.activeTexture(Fe),ye=Fe)}function Ue(Fe,Lt,Kt){Kt===void 0&&(ye===null?Kt=n.TEXTURE0+Re-1:Kt=ye);let un=Xe[Kt];un===void 0&&(un={type:void 0,texture:void 0},Xe[Kt]=un),(un.type!==Fe||un.texture!==Lt)&&(ye!==Kt&&(n.activeTexture(Kt),ye=Kt),n.bindTexture(Fe,Lt||Ht[Fe]),un.type=Fe,un.texture=Lt)}function $t(){const Fe=Xe[ye];Fe!==void 0&&Fe.type!==void 0&&(n.bindTexture(Fe.type,null),Fe.type=void 0,Fe.texture=void 0)}function An(){try{n.compressedTexImage2D.apply(n,arguments)}catch(Fe){console.error("THREE.WebGLState:",Fe)}}function Sn(){try{n.compressedTexImage3D.apply(n,arguments)}catch(Fe){console.error("THREE.WebGLState:",Fe)}}function jt(){try{n.texSubImage2D.apply(n,arguments)}catch(Fe){console.error("THREE.WebGLState:",Fe)}}function mr(){try{n.texSubImage3D.apply(n,arguments)}catch(Fe){console.error("THREE.WebGLState:",Fe)}}function Un(){try{n.compressedTexSubImage2D.apply(n,arguments)}catch(Fe){console.error("THREE.WebGLState:",Fe)}}function tr(){try{n.compressedTexSubImage3D.apply(n,arguments)}catch(Fe){console.error("THREE.WebGLState:",Fe)}}function Sr(){try{n.texStorage2D.apply(n,arguments)}catch(Fe){console.error("THREE.WebGLState:",Fe)}}function Ln(){try{n.texStorage3D.apply(n,arguments)}catch(Fe){console.error("THREE.WebGLState:",Fe)}}function ir(){try{n.texImage2D.apply(n,arguments)}catch(Fe){console.error("THREE.WebGLState:",Fe)}}function ci(){try{n.texImage3D.apply(n,arguments)}catch(Fe){console.error("THREE.WebGLState:",Fe)}}function Fr(Fe){wt.equals(Fe)===!1&&(n.scissor(Fe.x,Fe.y,Fe.z,Fe.w),wt.copy(Fe))}function or(Fe){Gt.equals(Fe)===!1&&(n.viewport(Fe.x,Fe.y,Fe.z,Fe.w),Gt.copy(Fe))}function Nr(Fe,Lt){let Kt=o.get(Lt);Kt===void 0&&(Kt=new WeakMap,o.set(Lt,Kt));let un=Kt.get(Fe);un===void 0&&(un=n.getUniformBlockIndex(Lt,Fe.name),Kt.set(Fe,un))}function Hr(Fe,Lt){const un=o.get(Lt).get(Fe);l.get(Lt)!==un&&(n.uniformBlockBinding(Lt,un,Fe.__bindingPointIndex),l.set(Lt,un))}function _i(){n.disable(n.BLEND),n.disable(n.CULL_FACE),n.disable(n.DEPTH_TEST),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SCISSOR_TEST),n.disable(n.STENCIL_TEST),n.disable(n.SAMPLE_ALPHA_TO_COVERAGE),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ONE,n.ZERO),n.blendFuncSeparate(n.ONE,n.ZERO,n.ONE,n.ZERO),n.blendColor(0,0,0,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(n.LESS),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(n.ALWAYS,0,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),n.clearStencil(0),n.cullFace(n.BACK),n.frontFace(n.CCW),n.polygonOffset(0,0),n.activeTexture(n.TEXTURE0),n.bindFramebuffer(n.FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),h={},ye=null,Xe={},d={},m=new WeakMap,_=[],y=null,T=!1,I=null,C=null,M=null,B=null,k=null,j=null,q=null,Z=new Gn(0,0,0),te=0,ie=!1,se=null,ae=null,fe=null,Se=null,Ee=null,wt.set(0,0,n.canvas.width,n.canvas.height),Gt.set(0,0,n.canvas.width,n.canvas.height),i.reset(),s.reset(),a.reset()}return{buffers:{color:i,depth:s,stencil:a},enable:Qt,disable:rn,bindFramebuffer:jn,drawBuffers:Bn,useProgram:Tn,setBlending:mn,setMaterial:cn,setFlipSided:St,setCullFace:Jt,setLineWidth:kn,setPolygonOffset:Vn,setScissorTest:sn,activeTexture:ot,bindTexture:Ue,unbindTexture:$t,compressedTexImage2D:An,compressedTexImage3D:Sn,texImage2D:ir,texImage3D:ci,updateUBOMapping:Nr,uniformBlockBinding:Hr,texStorage2D:Sr,texStorage3D:Ln,texSubImage2D:jt,texSubImage3D:mr,compressedTexSubImage2D:Un,compressedTexSubImage3D:tr,scissor:Fr,viewport:or,reset:_i}}function Pxe(n,e){const t=n.image&&n.image.width?n.image.width/n.image.height:1;return t>e?(n.repeat.x=1,n.repeat.y=t/e,n.offset.x=0,n.offset.y=(1-n.repeat.y)/2):(n.repeat.x=e/t,n.repeat.y=1,n.offset.x=(1-n.repeat.x)/2,n.offset.y=0),n}function Lxe(n,e){const t=n.image&&n.image.width?n.image.width/n.image.height:1;return t>e?(n.repeat.x=e/t,n.repeat.y=1,n.offset.x=(1-n.repeat.x)/2,n.offset.y=0):(n.repeat.x=1,n.repeat.y=t/e,n.offset.x=0,n.offset.y=(1-n.repeat.y)/2),n}function Dxe(n){return n.repeat.x=1,n.repeat.y=1,n.offset.x=0,n.offset.y=0,n}function KO(n,e,t,r){const i=Bxe(r);switch(t){case n6:return n*e;case i6:return n*e;case s6:return n*e*2;case ET:return n*e/i.components*i.byteLength;case IT:return n*e/i.components*i.byteLength;case o6:return n*e*2/i.components*i.byteLength;case RL:return n*e*2/i.components*i.byteLength;case r6:return n*e*3/i.components*i.byteLength;case jl:return n*e*4/i.components*i.byteLength;case PL:return n*e*4/i.components*i.byteLength;case kS:case OS:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case FS:case NS:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case ER:case RR:return Math.max(n,16)*Math.max(e,8)/4;case CR:case IR:return Math.max(n,8)*Math.max(e,8)/2;case PR:case LR:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case DR:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case BR:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case kR:return Math.floor((n+4)/5)*Math.floor((e+3)/4)*16;case OR:return Math.floor((n+4)/5)*Math.floor((e+4)/5)*16;case FR:return Math.floor((n+5)/6)*Math.floor((e+4)/5)*16;case NR:return Math.floor((n+5)/6)*Math.floor((e+5)/6)*16;case zR:return Math.floor((n+7)/8)*Math.floor((e+4)/5)*16;case UR:return Math.floor((n+7)/8)*Math.floor((e+5)/6)*16;case VR:return Math.floor((n+7)/8)*Math.floor((e+7)/8)*16;case GR:return Math.floor((n+9)/10)*Math.floor((e+4)/5)*16;case HR:return Math.floor((n+9)/10)*Math.floor((e+5)/6)*16;case jR:return Math.floor((n+9)/10)*Math.floor((e+7)/8)*16;case WR:return Math.floor((n+9)/10)*Math.floor((e+9)/10)*16;case XR:return Math.floor((n+11)/12)*Math.floor((e+9)/10)*16;case $R:return Math.floor((n+11)/12)*Math.floor((e+11)/12)*16;case zS:case qR:case ZR:return Math.ceil(n/4)*Math.ceil(e/4)*16;case a6:case YR:return Math.ceil(n/4)*Math.ceil(e/4)*8;case KR:case JR:return Math.ceil(n/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${t} format.`)}function Bxe(n){switch(n){case Xf:case Qz:return{byteLength:1,components:1};case Xb:case e6:case Ah:return{byteLength:2,components:1};case EL:case IL:return{byteLength:2,components:4};case Vm:case CL:case Sc:return{byteLength:4,components:1};case t6:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${n}.`)}const kxe={contain:Pxe,cover:Lxe,fill:Dxe,getByteLength:KO};function Oxe(n,e,t,r,i,s,a){const l=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,o=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),h=new nn,d=new WeakMap;let m;const _=new WeakMap;let y=!1;try{y=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function T(ot,Ue){return y?new OffscreenCanvas(ot,Ue):UA("canvas")}function I(ot,Ue,$t){let An=1;const Sn=sn(ot);if((Sn.width>$t||Sn.height>$t)&&(An=$t/Math.max(Sn.width,Sn.height)),An<1)if(typeof HTMLImageElement<"u"&&ot instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&ot instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&ot instanceof ImageBitmap||typeof VideoFrame<"u"&&ot instanceof VideoFrame){const jt=Math.floor(An*Sn.width),mr=Math.floor(An*Sn.height);m===void 0&&(m=T(jt,mr));const Un=Ue?T(jt,mr):m;return Un.width=jt,Un.height=mr,Un.getContext("2d").drawImage(ot,0,0,jt,mr),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Sn.width+"x"+Sn.height+") to ("+jt+"x"+mr+")."),Un}else return"data"in ot&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Sn.width+"x"+Sn.height+")."),ot;return ot}function C(ot){return ot.generateMipmaps&&ot.minFilter!==wa&&ot.minFilter!==Co}function M(ot){n.generateMipmap(ot)}function B(ot,Ue,$t,An,Sn=!1){if(ot!==null){if(n[ot]!==void 0)return n[ot];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+ot+"'")}let jt=Ue;if(Ue===n.RED&&($t===n.FLOAT&&(jt=n.R32F),$t===n.HALF_FLOAT&&(jt=n.R16F),$t===n.UNSIGNED_BYTE&&(jt=n.R8)),Ue===n.RED_INTEGER&&($t===n.UNSIGNED_BYTE&&(jt=n.R8UI),$t===n.UNSIGNED_SHORT&&(jt=n.R16UI),$t===n.UNSIGNED_INT&&(jt=n.R32UI),$t===n.BYTE&&(jt=n.R8I),$t===n.SHORT&&(jt=n.R16I),$t===n.INT&&(jt=n.R32I)),Ue===n.RG&&($t===n.FLOAT&&(jt=n.RG32F),$t===n.HALF_FLOAT&&(jt=n.RG16F),$t===n.UNSIGNED_BYTE&&(jt=n.RG8)),Ue===n.RG_INTEGER&&($t===n.UNSIGNED_BYTE&&(jt=n.RG8UI),$t===n.UNSIGNED_SHORT&&(jt=n.RG16UI),$t===n.UNSIGNED_INT&&(jt=n.RG32UI),$t===n.BYTE&&(jt=n.RG8I),$t===n.SHORT&&(jt=n.RG16I),$t===n.INT&&(jt=n.RG32I)),Ue===n.RGB&&$t===n.UNSIGNED_INT_5_9_9_9_REV&&(jt=n.RGB9_E5),Ue===n.RGBA){const mr=Sn?kA:ds.getTransfer(An);$t===n.FLOAT&&(jt=n.RGBA32F),$t===n.HALF_FLOAT&&(jt=n.RGBA16F),$t===n.UNSIGNED_BYTE&&(jt=mr===eo?n.SRGB8_ALPHA8:n.RGBA8),$t===n.UNSIGNED_SHORT_4_4_4_4&&(jt=n.RGBA4),$t===n.UNSIGNED_SHORT_5_5_5_1&&(jt=n.RGB5_A1)}return(jt===n.R16F||jt===n.R32F||jt===n.RG16F||jt===n.RG32F||jt===n.RGBA16F||jt===n.RGBA32F)&&e.get("EXT_color_buffer_float"),jt}function k(ot,Ue){let $t;return ot?Ue===null||Ue===Vm||Ue===Wy?$t=n.DEPTH24_STENCIL8:Ue===Sc?$t=n.DEPTH32F_STENCIL8:Ue===Xb&&($t=n.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):Ue===null||Ue===Vm||Ue===Wy?$t=n.DEPTH_COMPONENT24:Ue===Sc?$t=n.DEPTH_COMPONENT32F:Ue===Xb&&($t=n.DEPTH_COMPONENT16),$t}function j(ot,Ue){return C(ot)===!0||ot.isFramebufferTexture&&ot.minFilter!==wa&&ot.minFilter!==Co?Math.log2(Math.max(Ue.width,Ue.height))+1:ot.mipmaps!==void 0&&ot.mipmaps.length>0?ot.mipmaps.length:ot.isCompressedTexture&&Array.isArray(ot.image)?Ue.mipmaps.length:1}function q(ot){const Ue=ot.target;Ue.removeEventListener("dispose",q),te(Ue),Ue.isVideoTexture&&d.delete(Ue)}function Z(ot){const Ue=ot.target;Ue.removeEventListener("dispose",Z),se(Ue)}function te(ot){const Ue=r.get(ot);if(Ue.__webglInit===void 0)return;const $t=ot.source,An=_.get($t);if(An){const Sn=An[Ue.__cacheKey];Sn.usedTimes--,Sn.usedTimes===0&&ie(ot),Object.keys(An).length===0&&_.delete($t)}r.remove(ot)}function ie(ot){const Ue=r.get(ot);n.deleteTexture(Ue.__webglTexture);const $t=ot.source,An=_.get($t);delete An[Ue.__cacheKey],a.memory.textures--}function se(ot){const Ue=r.get(ot);if(ot.depthTexture&&ot.depthTexture.dispose(),ot.isWebGLCubeRenderTarget)for(let An=0;An<6;An++){if(Array.isArray(Ue.__webglFramebuffer[An]))for(let Sn=0;Sn<Ue.__webglFramebuffer[An].length;Sn++)n.deleteFramebuffer(Ue.__webglFramebuffer[An][Sn]);else n.deleteFramebuffer(Ue.__webglFramebuffer[An]);Ue.__webglDepthbuffer&&n.deleteRenderbuffer(Ue.__webglDepthbuffer[An])}else{if(Array.isArray(Ue.__webglFramebuffer))for(let An=0;An<Ue.__webglFramebuffer.length;An++)n.deleteFramebuffer(Ue.__webglFramebuffer[An]);else n.deleteFramebuffer(Ue.__webglFramebuffer);if(Ue.__webglDepthbuffer&&n.deleteRenderbuffer(Ue.__webglDepthbuffer),Ue.__webglMultisampledFramebuffer&&n.deleteFramebuffer(Ue.__webglMultisampledFramebuffer),Ue.__webglColorRenderbuffer)for(let An=0;An<Ue.__webglColorRenderbuffer.length;An++)Ue.__webglColorRenderbuffer[An]&&n.deleteRenderbuffer(Ue.__webglColorRenderbuffer[An]);Ue.__webglDepthRenderbuffer&&n.deleteRenderbuffer(Ue.__webglDepthRenderbuffer)}const $t=ot.textures;for(let An=0,Sn=$t.length;An<Sn;An++){const jt=r.get($t[An]);jt.__webglTexture&&(n.deleteTexture(jt.__webglTexture),a.memory.textures--),r.remove($t[An])}r.remove(ot)}let ae=0;function fe(){ae=0}function Se(){const ot=ae;return ot>=i.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+ot+" texture units while this GPU supports only "+i.maxTextures),ae+=1,ot}function Ee(ot){const Ue=[];return Ue.push(ot.wrapS),Ue.push(ot.wrapT),Ue.push(ot.wrapR||0),Ue.push(ot.magFilter),Ue.push(ot.minFilter),Ue.push(ot.anisotropy),Ue.push(ot.internalFormat),Ue.push(ot.format),Ue.push(ot.type),Ue.push(ot.generateMipmaps),Ue.push(ot.premultiplyAlpha),Ue.push(ot.flipY),Ue.push(ot.unpackAlignment),Ue.push(ot.colorSpace),Ue.join()}function Re(ot,Ue){const $t=r.get(ot);if(ot.isVideoTexture&&kn(ot),ot.isRenderTargetTexture===!1&&ot.version>0&&$t.__version!==ot.version){const An=ot.image;if(An===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(An.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Gt($t,ot,Ue);return}}t.bindTexture(n.TEXTURE_2D,$t.__webglTexture,n.TEXTURE0+Ue)}function qe(ot,Ue){const $t=r.get(ot);if(ot.version>0&&$t.__version!==ot.version){Gt($t,ot,Ue);return}t.bindTexture(n.TEXTURE_2D_ARRAY,$t.__webglTexture,n.TEXTURE0+Ue)}function Le(ot,Ue){const $t=r.get(ot);if(ot.version>0&&$t.__version!==ot.version){Gt($t,ot,Ue);return}t.bindTexture(n.TEXTURE_3D,$t.__webglTexture,n.TEXTURE0+Ue)}function dt(ot,Ue){const $t=r.get(ot);if(ot.version>0&&$t.__version!==ot.version){at($t,ot,Ue);return}t.bindTexture(n.TEXTURE_CUBE_MAP,$t.__webglTexture,n.TEXTURE0+Ue)}const ye={[Ph]:n.REPEAT,[ru]:n.CLAMP_TO_EDGE,[jy]:n.MIRRORED_REPEAT},Xe={[wa]:n.NEAREST,[CT]:n.NEAREST_MIPMAP_NEAREST,[z0]:n.NEAREST_MIPMAP_LINEAR,[Co]:n.LINEAR,[Ey]:n.LINEAR_MIPMAP_NEAREST,[iu]:n.LINEAR_MIPMAP_LINEAR},He={[$ee]:n.NEVER,[Qee]:n.ALWAYS,[qee]:n.LESS,[u6]:n.LEQUAL,[Zee]:n.EQUAL,[Jee]:n.GEQUAL,[Yee]:n.GREATER,[Kee]:n.NOTEQUAL};function _t(ot,Ue){if(Ue.type===Sc&&e.has("OES_texture_float_linear")===!1&&(Ue.magFilter===Co||Ue.magFilter===Ey||Ue.magFilter===z0||Ue.magFilter===iu||Ue.minFilter===Co||Ue.minFilter===Ey||Ue.minFilter===z0||Ue.minFilter===iu)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),n.texParameteri(ot,n.TEXTURE_WRAP_S,ye[Ue.wrapS]),n.texParameteri(ot,n.TEXTURE_WRAP_T,ye[Ue.wrapT]),(ot===n.TEXTURE_3D||ot===n.TEXTURE_2D_ARRAY)&&n.texParameteri(ot,n.TEXTURE_WRAP_R,ye[Ue.wrapR]),n.texParameteri(ot,n.TEXTURE_MAG_FILTER,Xe[Ue.magFilter]),n.texParameteri(ot,n.TEXTURE_MIN_FILTER,Xe[Ue.minFilter]),Ue.compareFunction&&(n.texParameteri(ot,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(ot,n.TEXTURE_COMPARE_FUNC,He[Ue.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(Ue.magFilter===wa||Ue.minFilter!==z0&&Ue.minFilter!==iu||Ue.type===Sc&&e.has("OES_texture_float_linear")===!1)return;if(Ue.anisotropy>1||r.get(Ue).__currentAnisotropy){const $t=e.get("EXT_texture_filter_anisotropic");n.texParameterf(ot,$t.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Ue.anisotropy,i.getMaxAnisotropy())),r.get(Ue).__currentAnisotropy=Ue.anisotropy}}}function wt(ot,Ue){let $t=!1;ot.__webglInit===void 0&&(ot.__webglInit=!0,Ue.addEventListener("dispose",q));const An=Ue.source;let Sn=_.get(An);Sn===void 0&&(Sn={},_.set(An,Sn));const jt=Ee(Ue);if(jt!==ot.__cacheKey){Sn[jt]===void 0&&(Sn[jt]={texture:n.createTexture(),usedTimes:0},a.memory.textures++,$t=!0),Sn[jt].usedTimes++;const mr=Sn[ot.__cacheKey];mr!==void 0&&(Sn[ot.__cacheKey].usedTimes--,mr.usedTimes===0&&ie(Ue)),ot.__cacheKey=jt,ot.__webglTexture=Sn[jt].texture}return $t}function Gt(ot,Ue,$t){let An=n.TEXTURE_2D;(Ue.isDataArrayTexture||Ue.isCompressedArrayTexture)&&(An=n.TEXTURE_2D_ARRAY),Ue.isData3DTexture&&(An=n.TEXTURE_3D);const Sn=wt(ot,Ue),jt=Ue.source;t.bindTexture(An,ot.__webglTexture,n.TEXTURE0+$t);const mr=r.get(jt);if(jt.version!==mr.__version||Sn===!0){t.activeTexture(n.TEXTURE0+$t);const Un=ds.getPrimaries(ds.workingColorSpace),tr=Ue.colorSpace===bm?null:ds.getPrimaries(Ue.colorSpace),Sr=Ue.colorSpace===bm||Un===tr?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,Ue.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Ue.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,Ue.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,Sr);let Ln=I(Ue.image,!1,i.maxTextureSize);Ln=Vn(Ue,Ln);const ir=s.convert(Ue.format,Ue.colorSpace),ci=s.convert(Ue.type);let Fr=B(Ue.internalFormat,ir,ci,Ue.colorSpace,Ue.isVideoTexture);_t(An,Ue);let or;const Nr=Ue.mipmaps,Hr=Ue.isVideoTexture!==!0,_i=mr.__version===void 0||Sn===!0,Fe=jt.dataReady,Lt=j(Ue,Ln);if(Ue.isDepthTexture)Fr=k(Ue.format===Xy,Ue.type),_i&&(Hr?t.texStorage2D(n.TEXTURE_2D,1,Fr,Ln.width,Ln.height):t.texImage2D(n.TEXTURE_2D,0,Fr,Ln.width,Ln.height,0,ir,ci,null));else if(Ue.isDataTexture)if(Nr.length>0){Hr&&_i&&t.texStorage2D(n.TEXTURE_2D,Lt,Fr,Nr[0].width,Nr[0].height);for(let Kt=0,un=Nr.length;Kt<un;Kt++)or=Nr[Kt],Hr?Fe&&t.texSubImage2D(n.TEXTURE_2D,Kt,0,0,or.width,or.height,ir,ci,or.data):t.texImage2D(n.TEXTURE_2D,Kt,Fr,or.width,or.height,0,ir,ci,or.data);Ue.generateMipmaps=!1}else Hr?(_i&&t.texStorage2D(n.TEXTURE_2D,Lt,Fr,Ln.width,Ln.height),Fe&&t.texSubImage2D(n.TEXTURE_2D,0,0,0,Ln.width,Ln.height,ir,ci,Ln.data)):t.texImage2D(n.TEXTURE_2D,0,Fr,Ln.width,Ln.height,0,ir,ci,Ln.data);else if(Ue.isCompressedTexture)if(Ue.isCompressedArrayTexture){Hr&&_i&&t.texStorage3D(n.TEXTURE_2D_ARRAY,Lt,Fr,Nr[0].width,Nr[0].height,Ln.depth);for(let Kt=0,un=Nr.length;Kt<un;Kt++)if(or=Nr[Kt],Ue.format!==jl)if(ir!==null)if(Hr){if(Fe)if(Ue.layerUpdates.size>0){const En=KO(or.width,or.height,Ue.format,Ue.type);for(const Ar of Ue.layerUpdates){const Gr=or.data.subarray(Ar*En/or.data.BYTES_PER_ELEMENT,(Ar+1)*En/or.data.BYTES_PER_ELEMENT);t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,Kt,0,0,Ar,or.width,or.height,1,ir,Gr,0,0)}Ue.clearLayerUpdates()}else t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,Kt,0,0,0,or.width,or.height,Ln.depth,ir,or.data,0,0)}else t.compressedTexImage3D(n.TEXTURE_2D_ARRAY,Kt,Fr,or.width,or.height,Ln.depth,0,or.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else Hr?Fe&&t.texSubImage3D(n.TEXTURE_2D_ARRAY,Kt,0,0,0,or.width,or.height,Ln.depth,ir,ci,or.data):t.texImage3D(n.TEXTURE_2D_ARRAY,Kt,Fr,or.width,or.height,Ln.depth,0,ir,ci,or.data)}else{Hr&&_i&&t.texStorage2D(n.TEXTURE_2D,Lt,Fr,Nr[0].width,Nr[0].height);for(let Kt=0,un=Nr.length;Kt<un;Kt++)or=Nr[Kt],Ue.format!==jl?ir!==null?Hr?Fe&&t.compressedTexSubImage2D(n.TEXTURE_2D,Kt,0,0,or.width,or.height,ir,or.data):t.compressedTexImage2D(n.TEXTURE_2D,Kt,Fr,or.width,or.height,0,or.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Hr?Fe&&t.texSubImage2D(n.TEXTURE_2D,Kt,0,0,or.width,or.height,ir,ci,or.data):t.texImage2D(n.TEXTURE_2D,Kt,Fr,or.width,or.height,0,ir,ci,or.data)}else if(Ue.isDataArrayTexture)if(Hr){if(_i&&t.texStorage3D(n.TEXTURE_2D_ARRAY,Lt,Fr,Ln.width,Ln.height,Ln.depth),Fe)if(Ue.layerUpdates.size>0){const Kt=KO(Ln.width,Ln.height,Ue.format,Ue.type);for(const un of Ue.layerUpdates){const En=Ln.data.subarray(un*Kt/Ln.data.BYTES_PER_ELEMENT,(un+1)*Kt/Ln.data.BYTES_PER_ELEMENT);t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,un,Ln.width,Ln.height,1,ir,ci,En)}Ue.clearLayerUpdates()}else t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,Ln.width,Ln.height,Ln.depth,ir,ci,Ln.data)}else t.texImage3D(n.TEXTURE_2D_ARRAY,0,Fr,Ln.width,Ln.height,Ln.depth,0,ir,ci,Ln.data);else if(Ue.isData3DTexture)Hr?(_i&&t.texStorage3D(n.TEXTURE_3D,Lt,Fr,Ln.width,Ln.height,Ln.depth),Fe&&t.texSubImage3D(n.TEXTURE_3D,0,0,0,0,Ln.width,Ln.height,Ln.depth,ir,ci,Ln.data)):t.texImage3D(n.TEXTURE_3D,0,Fr,Ln.width,Ln.height,Ln.depth,0,ir,ci,Ln.data);else if(Ue.isFramebufferTexture){if(_i)if(Hr)t.texStorage2D(n.TEXTURE_2D,Lt,Fr,Ln.width,Ln.height);else{let Kt=Ln.width,un=Ln.height;for(let En=0;En<Lt;En++)t.texImage2D(n.TEXTURE_2D,En,Fr,Kt,un,0,ir,ci,null),Kt>>=1,un>>=1}}else if(Nr.length>0){if(Hr&&_i){const Kt=sn(Nr[0]);t.texStorage2D(n.TEXTURE_2D,Lt,Fr,Kt.width,Kt.height)}for(let Kt=0,un=Nr.length;Kt<un;Kt++)or=Nr[Kt],Hr?Fe&&t.texSubImage2D(n.TEXTURE_2D,Kt,0,0,ir,ci,or):t.texImage2D(n.TEXTURE_2D,Kt,Fr,ir,ci,or);Ue.generateMipmaps=!1}else if(Hr){if(_i){const Kt=sn(Ln);t.texStorage2D(n.TEXTURE_2D,Lt,Fr,Kt.width,Kt.height)}Fe&&t.texSubImage2D(n.TEXTURE_2D,0,0,0,ir,ci,Ln)}else t.texImage2D(n.TEXTURE_2D,0,Fr,ir,ci,Ln);C(Ue)&&M(An),mr.__version=jt.version,Ue.onUpdate&&Ue.onUpdate(Ue)}ot.__version=Ue.version}function at(ot,Ue,$t){if(Ue.image.length!==6)return;const An=wt(ot,Ue),Sn=Ue.source;t.bindTexture(n.TEXTURE_CUBE_MAP,ot.__webglTexture,n.TEXTURE0+$t);const jt=r.get(Sn);if(Sn.version!==jt.__version||An===!0){t.activeTexture(n.TEXTURE0+$t);const mr=ds.getPrimaries(ds.workingColorSpace),Un=Ue.colorSpace===bm?null:ds.getPrimaries(Ue.colorSpace),tr=Ue.colorSpace===bm||mr===Un?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,Ue.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Ue.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,Ue.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,tr);const Sr=Ue.isCompressedTexture||Ue.image[0].isCompressedTexture,Ln=Ue.image[0]&&Ue.image[0].isDataTexture,ir=[];for(let un=0;un<6;un++)!Sr&&!Ln?ir[un]=I(Ue.image[un],!0,i.maxCubemapSize):ir[un]=Ln?Ue.image[un].image:Ue.image[un],ir[un]=Vn(Ue,ir[un]);const ci=ir[0],Fr=s.convert(Ue.format,Ue.colorSpace),or=s.convert(Ue.type),Nr=B(Ue.internalFormat,Fr,or,Ue.colorSpace),Hr=Ue.isVideoTexture!==!0,_i=jt.__version===void 0||An===!0,Fe=Sn.dataReady;let Lt=j(Ue,ci);_t(n.TEXTURE_CUBE_MAP,Ue);let Kt;if(Sr){Hr&&_i&&t.texStorage2D(n.TEXTURE_CUBE_MAP,Lt,Nr,ci.width,ci.height);for(let un=0;un<6;un++){Kt=ir[un].mipmaps;for(let En=0;En<Kt.length;En++){const Ar=Kt[En];Ue.format!==jl?Fr!==null?Hr?Fe&&t.compressedTexSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+un,En,0,0,Ar.width,Ar.height,Fr,Ar.data):t.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+un,En,Nr,Ar.width,Ar.height,0,Ar.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Hr?Fe&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+un,En,0,0,Ar.width,Ar.height,Fr,or,Ar.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+un,En,Nr,Ar.width,Ar.height,0,Fr,or,Ar.data)}}}else{if(Kt=Ue.mipmaps,Hr&&_i){Kt.length>0&&Lt++;const un=sn(ir[0]);t.texStorage2D(n.TEXTURE_CUBE_MAP,Lt,Nr,un.width,un.height)}for(let un=0;un<6;un++)if(Ln){Hr?Fe&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+un,0,0,0,ir[un].width,ir[un].height,Fr,or,ir[un].data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+un,0,Nr,ir[un].width,ir[un].height,0,Fr,or,ir[un].data);for(let En=0;En<Kt.length;En++){const Gr=Kt[En].image[un].image;Hr?Fe&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+un,En+1,0,0,Gr.width,Gr.height,Fr,or,Gr.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+un,En+1,Nr,Gr.width,Gr.height,0,Fr,or,Gr.data)}}else{Hr?Fe&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+un,0,0,0,Fr,or,ir[un]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+un,0,Nr,Fr,or,ir[un]);for(let En=0;En<Kt.length;En++){const Ar=Kt[En];Hr?Fe&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+un,En+1,0,0,Fr,or,Ar.image[un]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+un,En+1,Nr,Fr,or,Ar.image[un])}}}C(Ue)&&M(n.TEXTURE_CUBE_MAP),jt.__version=Sn.version,Ue.onUpdate&&Ue.onUpdate(Ue)}ot.__version=Ue.version}function Ht(ot,Ue,$t,An,Sn,jt){const mr=s.convert($t.format,$t.colorSpace),Un=s.convert($t.type),tr=B($t.internalFormat,mr,Un,$t.colorSpace);if(!r.get(Ue).__hasExternalTextures){const Ln=Math.max(1,Ue.width>>jt),ir=Math.max(1,Ue.height>>jt);Sn===n.TEXTURE_3D||Sn===n.TEXTURE_2D_ARRAY?t.texImage3D(Sn,jt,tr,Ln,ir,Ue.depth,0,mr,Un,null):t.texImage2D(Sn,jt,tr,Ln,ir,0,mr,Un,null)}t.bindFramebuffer(n.FRAMEBUFFER,ot),Jt(Ue)?l.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,An,Sn,r.get($t).__webglTexture,0,St(Ue)):(Sn===n.TEXTURE_2D||Sn>=n.TEXTURE_CUBE_MAP_POSITIVE_X&&Sn<=n.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&n.framebufferTexture2D(n.FRAMEBUFFER,An,Sn,r.get($t).__webglTexture,jt),t.bindFramebuffer(n.FRAMEBUFFER,null)}function Qt(ot,Ue,$t){if(n.bindRenderbuffer(n.RENDERBUFFER,ot),Ue.depthBuffer){const An=Ue.depthTexture,Sn=An&&An.isDepthTexture?An.type:null,jt=k(Ue.stencilBuffer,Sn),mr=Ue.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,Un=St(Ue);Jt(Ue)?l.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,Un,jt,Ue.width,Ue.height):$t?n.renderbufferStorageMultisample(n.RENDERBUFFER,Un,jt,Ue.width,Ue.height):n.renderbufferStorage(n.RENDERBUFFER,jt,Ue.width,Ue.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,mr,n.RENDERBUFFER,ot)}else{const An=Ue.textures;for(let Sn=0;Sn<An.length;Sn++){const jt=An[Sn],mr=s.convert(jt.format,jt.colorSpace),Un=s.convert(jt.type),tr=B(jt.internalFormat,mr,Un,jt.colorSpace),Sr=St(Ue);$t&&Jt(Ue)===!1?n.renderbufferStorageMultisample(n.RENDERBUFFER,Sr,tr,Ue.width,Ue.height):Jt(Ue)?l.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,Sr,tr,Ue.width,Ue.height):n.renderbufferStorage(n.RENDERBUFFER,tr,Ue.width,Ue.height)}}n.bindRenderbuffer(n.RENDERBUFFER,null)}function rn(ot,Ue){if(Ue&&Ue.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(n.FRAMEBUFFER,ot),!(Ue.depthTexture&&Ue.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!r.get(Ue.depthTexture).__webglTexture||Ue.depthTexture.image.width!==Ue.width||Ue.depthTexture.image.height!==Ue.height)&&(Ue.depthTexture.image.width=Ue.width,Ue.depthTexture.image.height=Ue.height,Ue.depthTexture.needsUpdate=!0),Re(Ue.depthTexture,0);const An=r.get(Ue.depthTexture).__webglTexture,Sn=St(Ue);if(Ue.depthTexture.format===Iy)Jt(Ue)?l.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,An,0,Sn):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,An,0);else if(Ue.depthTexture.format===Xy)Jt(Ue)?l.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,An,0,Sn):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,An,0);else throw new Error("Unknown depthTexture format")}function jn(ot){const Ue=r.get(ot),$t=ot.isWebGLCubeRenderTarget===!0;if(ot.depthTexture&&!Ue.__autoAllocateDepthBuffer){if($t)throw new Error("target.depthTexture not supported in Cube render targets");rn(Ue.__webglFramebuffer,ot)}else if($t){Ue.__webglDepthbuffer=[];for(let An=0;An<6;An++)t.bindFramebuffer(n.FRAMEBUFFER,Ue.__webglFramebuffer[An]),Ue.__webglDepthbuffer[An]=n.createRenderbuffer(),Qt(Ue.__webglDepthbuffer[An],ot,!1)}else t.bindFramebuffer(n.FRAMEBUFFER,Ue.__webglFramebuffer),Ue.__webglDepthbuffer=n.createRenderbuffer(),Qt(Ue.__webglDepthbuffer,ot,!1);t.bindFramebuffer(n.FRAMEBUFFER,null)}function Bn(ot,Ue,$t){const An=r.get(ot);Ue!==void 0&&Ht(An.__webglFramebuffer,ot,ot.texture,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,0),$t!==void 0&&jn(ot)}function Tn(ot){const Ue=ot.texture,$t=r.get(ot),An=r.get(Ue);ot.addEventListener("dispose",Z);const Sn=ot.textures,jt=ot.isWebGLCubeRenderTarget===!0,mr=Sn.length>1;if(mr||(An.__webglTexture===void 0&&(An.__webglTexture=n.createTexture()),An.__version=Ue.version,a.memory.textures++),jt){$t.__webglFramebuffer=[];for(let Un=0;Un<6;Un++)if(Ue.mipmaps&&Ue.mipmaps.length>0){$t.__webglFramebuffer[Un]=[];for(let tr=0;tr<Ue.mipmaps.length;tr++)$t.__webglFramebuffer[Un][tr]=n.createFramebuffer()}else $t.__webglFramebuffer[Un]=n.createFramebuffer()}else{if(Ue.mipmaps&&Ue.mipmaps.length>0){$t.__webglFramebuffer=[];for(let Un=0;Un<Ue.mipmaps.length;Un++)$t.__webglFramebuffer[Un]=n.createFramebuffer()}else $t.__webglFramebuffer=n.createFramebuffer();if(mr)for(let Un=0,tr=Sn.length;Un<tr;Un++){const Sr=r.get(Sn[Un]);Sr.__webglTexture===void 0&&(Sr.__webglTexture=n.createTexture(),a.memory.textures++)}if(ot.samples>0&&Jt(ot)===!1){$t.__webglMultisampledFramebuffer=n.createFramebuffer(),$t.__webglColorRenderbuffer=[],t.bindFramebuffer(n.FRAMEBUFFER,$t.__webglMultisampledFramebuffer);for(let Un=0;Un<Sn.length;Un++){const tr=Sn[Un];$t.__webglColorRenderbuffer[Un]=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,$t.__webglColorRenderbuffer[Un]);const Sr=s.convert(tr.format,tr.colorSpace),Ln=s.convert(tr.type),ir=B(tr.internalFormat,Sr,Ln,tr.colorSpace,ot.isXRRenderTarget===!0),ci=St(ot);n.renderbufferStorageMultisample(n.RENDERBUFFER,ci,ir,ot.width,ot.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Un,n.RENDERBUFFER,$t.__webglColorRenderbuffer[Un])}n.bindRenderbuffer(n.RENDERBUFFER,null),ot.depthBuffer&&($t.__webglDepthRenderbuffer=n.createRenderbuffer(),Qt($t.__webglDepthRenderbuffer,ot,!0)),t.bindFramebuffer(n.FRAMEBUFFER,null)}}if(jt){t.bindTexture(n.TEXTURE_CUBE_MAP,An.__webglTexture),_t(n.TEXTURE_CUBE_MAP,Ue);for(let Un=0;Un<6;Un++)if(Ue.mipmaps&&Ue.mipmaps.length>0)for(let tr=0;tr<Ue.mipmaps.length;tr++)Ht($t.__webglFramebuffer[Un][tr],ot,Ue,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+Un,tr);else Ht($t.__webglFramebuffer[Un],ot,Ue,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+Un,0);C(Ue)&&M(n.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(mr){for(let Un=0,tr=Sn.length;Un<tr;Un++){const Sr=Sn[Un],Ln=r.get(Sr);t.bindTexture(n.TEXTURE_2D,Ln.__webglTexture),_t(n.TEXTURE_2D,Sr),Ht($t.__webglFramebuffer,ot,Sr,n.COLOR_ATTACHMENT0+Un,n.TEXTURE_2D,0),C(Sr)&&M(n.TEXTURE_2D)}t.unbindTexture()}else{let Un=n.TEXTURE_2D;if((ot.isWebGL3DRenderTarget||ot.isWebGLArrayRenderTarget)&&(Un=ot.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY),t.bindTexture(Un,An.__webglTexture),_t(Un,Ue),Ue.mipmaps&&Ue.mipmaps.length>0)for(let tr=0;tr<Ue.mipmaps.length;tr++)Ht($t.__webglFramebuffer[tr],ot,Ue,n.COLOR_ATTACHMENT0,Un,tr);else Ht($t.__webglFramebuffer,ot,Ue,n.COLOR_ATTACHMENT0,Un,0);C(Ue)&&M(Un),t.unbindTexture()}ot.depthBuffer&&jn(ot)}function Pe(ot){const Ue=ot.textures;for(let $t=0,An=Ue.length;$t<An;$t++){const Sn=Ue[$t];if(C(Sn)){const jt=ot.isWebGLCubeRenderTarget?n.TEXTURE_CUBE_MAP:n.TEXTURE_2D,mr=r.get(Sn).__webglTexture;t.bindTexture(jt,mr),M(jt),t.unbindTexture()}}}const $e=[],mn=[];function cn(ot){if(ot.samples>0){if(Jt(ot)===!1){const Ue=ot.textures,$t=ot.width,An=ot.height;let Sn=n.COLOR_BUFFER_BIT;const jt=ot.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,mr=r.get(ot),Un=Ue.length>1;if(Un)for(let tr=0;tr<Ue.length;tr++)t.bindFramebuffer(n.FRAMEBUFFER,mr.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+tr,n.RENDERBUFFER,null),t.bindFramebuffer(n.FRAMEBUFFER,mr.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+tr,n.TEXTURE_2D,null,0);t.bindFramebuffer(n.READ_FRAMEBUFFER,mr.__webglMultisampledFramebuffer),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,mr.__webglFramebuffer);for(let tr=0;tr<Ue.length;tr++){if(ot.resolveDepthBuffer&&(ot.depthBuffer&&(Sn|=n.DEPTH_BUFFER_BIT),ot.stencilBuffer&&ot.resolveStencilBuffer&&(Sn|=n.STENCIL_BUFFER_BIT)),Un){n.framebufferRenderbuffer(n.READ_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,mr.__webglColorRenderbuffer[tr]);const Sr=r.get(Ue[tr]).__webglTexture;n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,Sr,0)}n.blitFramebuffer(0,0,$t,An,0,0,$t,An,Sn,n.NEAREST),o===!0&&($e.length=0,mn.length=0,$e.push(n.COLOR_ATTACHMENT0+tr),ot.depthBuffer&&ot.resolveDepthBuffer===!1&&($e.push(jt),mn.push(jt),n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,mn)),n.invalidateFramebuffer(n.READ_FRAMEBUFFER,$e))}if(t.bindFramebuffer(n.READ_FRAMEBUFFER,null),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),Un)for(let tr=0;tr<Ue.length;tr++){t.bindFramebuffer(n.FRAMEBUFFER,mr.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+tr,n.RENDERBUFFER,mr.__webglColorRenderbuffer[tr]);const Sr=r.get(Ue[tr]).__webglTexture;t.bindFramebuffer(n.FRAMEBUFFER,mr.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+tr,n.TEXTURE_2D,Sr,0)}t.bindFramebuffer(n.DRAW_FRAMEBUFFER,mr.__webglMultisampledFramebuffer)}else if(ot.depthBuffer&&ot.resolveDepthBuffer===!1&&o){const Ue=ot.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT;n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,[Ue])}}}function St(ot){return Math.min(i.maxSamples,ot.samples)}function Jt(ot){const Ue=r.get(ot);return ot.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&Ue.__useRenderToTexture!==!1}function kn(ot){const Ue=a.render.frame;d.get(ot)!==Ue&&(d.set(ot,Ue),ot.update())}function Vn(ot,Ue){const $t=ot.colorSpace,An=ot.format,Sn=ot.type;return ot.isCompressedTexture===!0||ot.isVideoTexture===!0||$t!==Ga&&$t!==bm&&(ds.getTransfer($t)===eo?(An!==jl||Sn!==Xf)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",$t)),Ue}function sn(ot){return typeof HTMLImageElement<"u"&&ot instanceof HTMLImageElement?(h.width=ot.naturalWidth||ot.width,h.height=ot.naturalHeight||ot.height):typeof VideoFrame<"u"&&ot instanceof VideoFrame?(h.width=ot.displayWidth,h.height=ot.displayHeight):(h.width=ot.width,h.height=ot.height),h}this.allocateTextureUnit=Se,this.resetTextureUnits=fe,this.setTexture2D=Re,this.setTexture2DArray=qe,this.setTexture3D=Le,this.setTextureCube=dt,this.rebindTextures=Bn,this.setupRenderTarget=Tn,this.updateRenderTargetMipmap=Pe,this.updateMultisampleRenderTarget=cn,this.setupDepthRenderbuffer=jn,this.setupFrameBufferTexture=Ht,this.useMultisampledRTT=Jt}function dte(n,e){function t(r,i=bm){let s;const a=ds.getTransfer(i);if(r===Xf)return n.UNSIGNED_BYTE;if(r===EL)return n.UNSIGNED_SHORT_4_4_4_4;if(r===IL)return n.UNSIGNED_SHORT_5_5_5_1;if(r===t6)return n.UNSIGNED_INT_5_9_9_9_REV;if(r===Qz)return n.BYTE;if(r===e6)return n.SHORT;if(r===Xb)return n.UNSIGNED_SHORT;if(r===CL)return n.INT;if(r===Vm)return n.UNSIGNED_INT;if(r===Sc)return n.FLOAT;if(r===Ah)return n.HALF_FLOAT;if(r===n6)return n.ALPHA;if(r===r6)return n.RGB;if(r===jl)return n.RGBA;if(r===i6)return n.LUMINANCE;if(r===s6)return n.LUMINANCE_ALPHA;if(r===Iy)return n.DEPTH_COMPONENT;if(r===Xy)return n.DEPTH_STENCIL;if(r===ET)return n.RED;if(r===IT)return n.RED_INTEGER;if(r===o6)return n.RG;if(r===RL)return n.RG_INTEGER;if(r===PL)return n.RGBA_INTEGER;if(r===kS||r===OS||r===FS||r===NS)if(a===eo)if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(r===kS)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(r===OS)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(r===FS)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(r===NS)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=e.get("WEBGL_compressed_texture_s3tc"),s!==null){if(r===kS)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===OS)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===FS)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===NS)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(r===CR||r===ER||r===IR||r===RR)if(s=e.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(r===CR)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===ER)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===IR)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===RR)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(r===PR||r===LR||r===DR)if(s=e.get("WEBGL_compressed_texture_etc"),s!==null){if(r===PR||r===LR)return a===eo?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(r===DR)return a===eo?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(r===BR||r===kR||r===OR||r===FR||r===NR||r===zR||r===UR||r===VR||r===GR||r===HR||r===jR||r===WR||r===XR||r===$R)if(s=e.get("WEBGL_compressed_texture_astc"),s!==null){if(r===BR)return a===eo?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(r===kR)return a===eo?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(r===OR)return a===eo?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(r===FR)return a===eo?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(r===NR)return a===eo?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(r===zR)return a===eo?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(r===UR)return a===eo?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(r===VR)return a===eo?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(r===GR)return a===eo?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(r===HR)return a===eo?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(r===jR)return a===eo?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(r===WR)return a===eo?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(r===XR)return a===eo?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(r===$R)return a===eo?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(r===zS||r===qR||r===ZR)if(s=e.get("EXT_texture_compression_bptc"),s!==null){if(r===zS)return a===eo?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(r===qR)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(r===ZR)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(r===a6||r===YR||r===KR||r===JR)if(s=e.get("EXT_texture_compression_rgtc"),s!==null){if(r===zS)return s.COMPRESSED_RED_RGTC1_EXT;if(r===YR)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(r===KR)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(r===JR)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return r===Wy?n.UNSIGNED_INT_24_8:n[r]!==void 0?n[r]:null}return{convert:t}}class pte extends Qi{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}let Wl=class extends Ii{constructor(){super(),this.isGroup=!0,this.type="Group"}};const Fxe={type:"move"};class f5{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Wl,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Wl,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Ze,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Ze),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Wl,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Ze,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Ze),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const r of e.hand.values())this._getHandJoint(t,r)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,r){let i=null,s=null,a=null;const l=this._targetRay,o=this._grip,h=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(h&&e.hand){a=!0;for(const I of e.hand.values()){const C=t.getJointPose(I,r),M=this._getHandJoint(h,I);C!==null&&(M.matrix.fromArray(C.transform.matrix),M.matrix.decompose(M.position,M.rotation,M.scale),M.matrixWorldNeedsUpdate=!0,M.jointRadius=C.radius),M.visible=C!==null}const d=h.joints["index-finger-tip"],m=h.joints["thumb-tip"],_=d.position.distanceTo(m.position),y=.02,T=.005;h.inputState.pinching&&_>y+T?(h.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!h.inputState.pinching&&_<=y-T&&(h.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else o!==null&&e.gripSpace&&(s=t.getPose(e.gripSpace,r),s!==null&&(o.matrix.fromArray(s.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,s.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(s.linearVelocity)):o.hasLinearVelocity=!1,s.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(s.angularVelocity)):o.hasAngularVelocity=!1));l!==null&&(i=t.getPose(e.targetRaySpace,r),i===null&&s!==null&&(i=s),i!==null&&(l.matrix.fromArray(i.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,i.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(i.linearVelocity)):l.hasLinearVelocity=!1,i.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(i.angularVelocity)):l.hasAngularVelocity=!1,this.dispatchEvent(Fxe)))}return l!==null&&(l.visible=i!==null),o!==null&&(o.visible=s!==null),h!==null&&(h.visible=a!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const r=new Wl;r.matrixAutoUpdate=!1,r.visible=!1,e.joints[t.jointName]=r,e.add(r)}return e.joints[t.jointName]}}const Nxe=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,zxe=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class Uxe{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,r){if(this.texture===null){const i=new Ws,s=e.properties.get(i);s.__webglTexture=t.texture,(t.depthNear!=r.depthNear||t.depthFar!=r.depthFar)&&(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=i}}getMesh(e){if(this.texture!==null&&this.mesh===null){const t=e.cameras[0].viewport,r=new Eo({vertexShader:Nxe,fragmentShader:zxe,uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new Ei(new Jm(20,20),r)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class Vxe extends pp{constructor(e,t){super();const r=this;let i=null,s=1,a=null,l="local-floor",o=1,h=null,d=null,m=null,_=null,y=null,T=null;const I=new Uxe,C=t.getContextAttributes();let M=null,B=null;const k=[],j=[],q=new nn;let Z=null;const te=new Qi;te.layers.enable(1),te.viewport=new Es;const ie=new Qi;ie.layers.enable(2),ie.viewport=new Es;const se=[te,ie],ae=new pte;ae.layers.enable(1),ae.layers.enable(2);let fe=null,Se=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(at){let Ht=k[at];return Ht===void 0&&(Ht=new f5,k[at]=Ht),Ht.getTargetRaySpace()},this.getControllerGrip=function(at){let Ht=k[at];return Ht===void 0&&(Ht=new f5,k[at]=Ht),Ht.getGripSpace()},this.getHand=function(at){let Ht=k[at];return Ht===void 0&&(Ht=new f5,k[at]=Ht),Ht.getHandSpace()};function Ee(at){const Ht=j.indexOf(at.inputSource);if(Ht===-1)return;const Qt=k[Ht];Qt!==void 0&&(Qt.update(at.inputSource,at.frame,h||a),Qt.dispatchEvent({type:at.type,data:at.inputSource}))}function Re(){i.removeEventListener("select",Ee),i.removeEventListener("selectstart",Ee),i.removeEventListener("selectend",Ee),i.removeEventListener("squeeze",Ee),i.removeEventListener("squeezestart",Ee),i.removeEventListener("squeezeend",Ee),i.removeEventListener("end",Re),i.removeEventListener("inputsourceschange",qe);for(let at=0;at<k.length;at++){const Ht=j[at];Ht!==null&&(j[at]=null,k[at].disconnect(Ht))}fe=null,Se=null,I.reset(),e.setRenderTarget(M),y=null,_=null,m=null,i=null,B=null,Gt.stop(),r.isPresenting=!1,e.setPixelRatio(Z),e.setSize(q.width,q.height,!1),r.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(at){s=at,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(at){l=at,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return h||a},this.setReferenceSpace=function(at){h=at},this.getBaseLayer=function(){return _!==null?_:y},this.getBinding=function(){return m},this.getFrame=function(){return T},this.getSession=function(){return i},this.setSession=async function(at){if(i=at,i!==null){if(M=e.getRenderTarget(),i.addEventListener("select",Ee),i.addEventListener("selectstart",Ee),i.addEventListener("selectend",Ee),i.addEventListener("squeeze",Ee),i.addEventListener("squeezestart",Ee),i.addEventListener("squeezeend",Ee),i.addEventListener("end",Re),i.addEventListener("inputsourceschange",qe),C.xrCompatible!==!0&&await t.makeXRCompatible(),Z=e.getPixelRatio(),e.getSize(q),i.renderState.layers===void 0){const Ht={antialias:C.antialias,alpha:!0,depth:C.depth,stencil:C.stencil,framebufferScaleFactor:s};y=new XRWebGLLayer(i,t,Ht),i.updateRenderState({baseLayer:y}),e.setPixelRatio(1),e.setSize(y.framebufferWidth,y.framebufferHeight,!1),B=new bl(y.framebufferWidth,y.framebufferHeight,{format:jl,type:Xf,colorSpace:e.outputColorSpace,stencilBuffer:C.stencil})}else{let Ht=null,Qt=null,rn=null;C.depth&&(rn=C.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,Ht=C.stencil?Xy:Iy,Qt=C.stencil?Wy:Vm);const jn={colorFormat:t.RGBA8,depthFormat:rn,scaleFactor:s};m=new XRWebGLBinding(i,t),_=m.createProjectionLayer(jn),i.updateRenderState({layers:[_]}),e.setPixelRatio(1),e.setSize(_.textureWidth,_.textureHeight,!1),B=new bl(_.textureWidth,_.textureHeight,{format:jl,type:Xf,depthTexture:new v6(_.textureWidth,_.textureHeight,Qt,void 0,void 0,void 0,void 0,void 0,void 0,Ht),stencilBuffer:C.stencil,colorSpace:e.outputColorSpace,samples:C.antialias?4:0,resolveDepthBuffer:_.ignoreDepthValues===!1})}B.isXRRenderTarget=!0,this.setFoveation(o),h=null,a=await i.requestReferenceSpace(l),Gt.setContext(i),Gt.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(i!==null)return i.environmentBlendMode},this.getDepthTexture=function(){return I.getDepthTexture()};function qe(at){for(let Ht=0;Ht<at.removed.length;Ht++){const Qt=at.removed[Ht],rn=j.indexOf(Qt);rn>=0&&(j[rn]=null,k[rn].disconnect(Qt))}for(let Ht=0;Ht<at.added.length;Ht++){const Qt=at.added[Ht];let rn=j.indexOf(Qt);if(rn===-1){for(let Bn=0;Bn<k.length;Bn++)if(Bn>=j.length){j.push(Qt),rn=Bn;break}else if(j[Bn]===null){j[Bn]=Qt,rn=Bn;break}if(rn===-1)break}const jn=k[rn];jn&&jn.connect(Qt)}}const Le=new Ze,dt=new Ze;function ye(at,Ht,Qt){Le.setFromMatrixPosition(Ht.matrixWorld),dt.setFromMatrixPosition(Qt.matrixWorld);const rn=Le.distanceTo(dt),jn=Ht.projectionMatrix.elements,Bn=Qt.projectionMatrix.elements,Tn=jn[14]/(jn[10]-1),Pe=jn[14]/(jn[10]+1),$e=(jn[9]+1)/jn[5],mn=(jn[9]-1)/jn[5],cn=(jn[8]-1)/jn[0],St=(Bn[8]+1)/Bn[0],Jt=Tn*cn,kn=Tn*St,Vn=rn/(-cn+St),sn=Vn*-cn;Ht.matrixWorld.decompose(at.position,at.quaternion,at.scale),at.translateX(sn),at.translateZ(Vn),at.matrixWorld.compose(at.position,at.quaternion,at.scale),at.matrixWorldInverse.copy(at.matrixWorld).invert();const ot=Tn+Vn,Ue=Pe+Vn,$t=Jt-sn,An=kn+(rn-sn),Sn=$e*Pe/Ue*ot,jt=mn*Pe/Ue*ot;at.projectionMatrix.makePerspective($t,An,Sn,jt,ot,Ue),at.projectionMatrixInverse.copy(at.projectionMatrix).invert()}function Xe(at,Ht){Ht===null?at.matrixWorld.copy(at.matrix):at.matrixWorld.multiplyMatrices(Ht.matrixWorld,at.matrix),at.matrixWorldInverse.copy(at.matrixWorld).invert()}this.updateCamera=function(at){if(i===null)return;I.texture!==null&&(at.near=I.depthNear,at.far=I.depthFar),ae.near=ie.near=te.near=at.near,ae.far=ie.far=te.far=at.far,(fe!==ae.near||Se!==ae.far)&&(i.updateRenderState({depthNear:ae.near,depthFar:ae.far}),fe=ae.near,Se=ae.far,te.near=fe,te.far=Se,ie.near=fe,ie.far=Se,te.updateProjectionMatrix(),ie.updateProjectionMatrix(),at.updateProjectionMatrix());const Ht=at.parent,Qt=ae.cameras;Xe(ae,Ht);for(let rn=0;rn<Qt.length;rn++)Xe(Qt[rn],Ht);Qt.length===2?ye(ae,te,ie):ae.projectionMatrix.copy(te.projectionMatrix),He(at,ae,Ht)};function He(at,Ht,Qt){Qt===null?at.matrix.copy(Ht.matrixWorld):(at.matrix.copy(Qt.matrixWorld),at.matrix.invert(),at.matrix.multiply(Ht.matrixWorld)),at.matrix.decompose(at.position,at.quaternion,at.scale),at.updateMatrixWorld(!0),at.projectionMatrix.copy(Ht.projectionMatrix),at.projectionMatrixInverse.copy(Ht.projectionMatrixInverse),at.isPerspectiveCamera&&(at.fov=$b*2*Math.atan(1/at.projectionMatrix.elements[5]),at.zoom=1)}this.getCamera=function(){return ae},this.getFoveation=function(){if(!(_===null&&y===null))return o},this.setFoveation=function(at){o=at,_!==null&&(_.fixedFoveation=at),y!==null&&y.fixedFoveation!==void 0&&(y.fixedFoveation=at)},this.hasDepthSensing=function(){return I.texture!==null},this.getDepthSensingMesh=function(){return I.getMesh(ae)};let _t=null;function wt(at,Ht){if(d=Ht.getViewerPose(h||a),T=Ht,d!==null){const Qt=d.views;y!==null&&(e.setRenderTargetFramebuffer(B,y.framebuffer),e.setRenderTarget(B));let rn=!1;Qt.length!==ae.cameras.length&&(ae.cameras.length=0,rn=!0);for(let Bn=0;Bn<Qt.length;Bn++){const Tn=Qt[Bn];let Pe=null;if(y!==null)Pe=y.getViewport(Tn);else{const mn=m.getViewSubImage(_,Tn);Pe=mn.viewport,Bn===0&&(e.setRenderTargetTextures(B,mn.colorTexture,_.ignoreDepthValues?void 0:mn.depthStencilTexture),e.setRenderTarget(B))}let $e=se[Bn];$e===void 0&&($e=new Qi,$e.layers.enable(Bn),$e.viewport=new Es,se[Bn]=$e),$e.matrix.fromArray(Tn.transform.matrix),$e.matrix.decompose($e.position,$e.quaternion,$e.scale),$e.projectionMatrix.fromArray(Tn.projectionMatrix),$e.projectionMatrixInverse.copy($e.projectionMatrix).invert(),$e.viewport.set(Pe.x,Pe.y,Pe.width,Pe.height),Bn===0&&(ae.matrix.copy($e.matrix),ae.matrix.decompose(ae.position,ae.quaternion,ae.scale)),rn===!0&&ae.cameras.push($e)}const jn=i.enabledFeatures;if(jn&&jn.includes("depth-sensing")){const Bn=m.getDepthInformation(Qt[0]);Bn&&Bn.isValid&&Bn.texture&&I.init(e,Bn,i.renderState)}}for(let Qt=0;Qt<k.length;Qt++){const rn=j[Qt],jn=k[Qt];rn!==null&&jn!==void 0&&jn.update(rn,Ht,h||a)}_t&&_t(at,Ht),Ht.detectedPlanes&&r.dispatchEvent({type:"planesdetected",data:Ht}),T=null}const Gt=new lte;Gt.setAnimationLoop(wt),this.setAnimationLoop=function(at){_t=at},this.dispose=function(){}}}const x_=new Ou,Gxe=new Vr;function Hxe(n,e){function t(C,M){C.matrixAutoUpdate===!0&&C.updateMatrix(),M.value.copy(C.matrix)}function r(C,M){M.color.getRGB(C.fogColor.value,ste(n)),M.isFog?(C.fogNear.value=M.near,C.fogFar.value=M.far):M.isFogExp2&&(C.fogDensity.value=M.density)}function i(C,M,B,k,j){M.isMeshBasicMaterial||M.isMeshLambertMaterial?s(C,M):M.isMeshToonMaterial?(s(C,M),m(C,M)):M.isMeshPhongMaterial?(s(C,M),d(C,M)):M.isMeshStandardMaterial?(s(C,M),_(C,M),M.isMeshPhysicalMaterial&&y(C,M,j)):M.isMeshMatcapMaterial?(s(C,M),T(C,M)):M.isMeshDepthMaterial?s(C,M):M.isMeshDistanceMaterial?(s(C,M),I(C,M)):M.isMeshNormalMaterial?s(C,M):M.isLineBasicMaterial?(a(C,M),M.isLineDashedMaterial&&l(C,M)):M.isPointsMaterial?o(C,M,B,k):M.isSpriteMaterial?h(C,M):M.isShadowMaterial?(C.color.value.copy(M.color),C.opacity.value=M.opacity):M.isShaderMaterial&&(M.uniformsNeedUpdate=!1)}function s(C,M){C.opacity.value=M.opacity,M.color&&C.diffuse.value.copy(M.color),M.emissive&&C.emissive.value.copy(M.emissive).multiplyScalar(M.emissiveIntensity),M.map&&(C.map.value=M.map,t(M.map,C.mapTransform)),M.alphaMap&&(C.alphaMap.value=M.alphaMap,t(M.alphaMap,C.alphaMapTransform)),M.bumpMap&&(C.bumpMap.value=M.bumpMap,t(M.bumpMap,C.bumpMapTransform),C.bumpScale.value=M.bumpScale,M.side===Mc&&(C.bumpScale.value*=-1)),M.normalMap&&(C.normalMap.value=M.normalMap,t(M.normalMap,C.normalMapTransform),C.normalScale.value.copy(M.normalScale),M.side===Mc&&C.normalScale.value.negate()),M.displacementMap&&(C.displacementMap.value=M.displacementMap,t(M.displacementMap,C.displacementMapTransform),C.displacementScale.value=M.displacementScale,C.displacementBias.value=M.displacementBias),M.emissiveMap&&(C.emissiveMap.value=M.emissiveMap,t(M.emissiveMap,C.emissiveMapTransform)),M.specularMap&&(C.specularMap.value=M.specularMap,t(M.specularMap,C.specularMapTransform)),M.alphaTest>0&&(C.alphaTest.value=M.alphaTest);const B=e.get(M),k=B.envMap,j=B.envMapRotation;k&&(C.envMap.value=k,x_.copy(j),x_.x*=-1,x_.y*=-1,x_.z*=-1,k.isCubeTexture&&k.isRenderTargetTexture===!1&&(x_.y*=-1,x_.z*=-1),C.envMapRotation.value.setFromMatrix4(Gxe.makeRotationFromEuler(x_)),C.flipEnvMap.value=k.isCubeTexture&&k.isRenderTargetTexture===!1?-1:1,C.reflectivity.value=M.reflectivity,C.ior.value=M.ior,C.refractionRatio.value=M.refractionRatio),M.lightMap&&(C.lightMap.value=M.lightMap,C.lightMapIntensity.value=M.lightMapIntensity,t(M.lightMap,C.lightMapTransform)),M.aoMap&&(C.aoMap.value=M.aoMap,C.aoMapIntensity.value=M.aoMapIntensity,t(M.aoMap,C.aoMapTransform))}function a(C,M){C.diffuse.value.copy(M.color),C.opacity.value=M.opacity,M.map&&(C.map.value=M.map,t(M.map,C.mapTransform))}function l(C,M){C.dashSize.value=M.dashSize,C.totalSize.value=M.dashSize+M.gapSize,C.scale.value=M.scale}function o(C,M,B,k){C.diffuse.value.copy(M.color),C.opacity.value=M.opacity,C.size.value=M.size*B,C.scale.value=k*.5,M.map&&(C.map.value=M.map,t(M.map,C.uvTransform)),M.alphaMap&&(C.alphaMap.value=M.alphaMap,t(M.alphaMap,C.alphaMapTransform)),M.alphaTest>0&&(C.alphaTest.value=M.alphaTest)}function h(C,M){C.diffuse.value.copy(M.color),C.opacity.value=M.opacity,C.rotation.value=M.rotation,M.map&&(C.map.value=M.map,t(M.map,C.mapTransform)),M.alphaMap&&(C.alphaMap.value=M.alphaMap,t(M.alphaMap,C.alphaMapTransform)),M.alphaTest>0&&(C.alphaTest.value=M.alphaTest)}function d(C,M){C.specular.value.copy(M.specular),C.shininess.value=Math.max(M.shininess,1e-4)}function m(C,M){M.gradientMap&&(C.gradientMap.value=M.gradientMap)}function _(C,M){C.metalness.value=M.metalness,M.metalnessMap&&(C.metalnessMap.value=M.metalnessMap,t(M.metalnessMap,C.metalnessMapTransform)),C.roughness.value=M.roughness,M.roughnessMap&&(C.roughnessMap.value=M.roughnessMap,t(M.roughnessMap,C.roughnessMapTransform)),M.envMap&&(C.envMapIntensity.value=M.envMapIntensity)}function y(C,M,B){C.ior.value=M.ior,M.sheen>0&&(C.sheenColor.value.copy(M.sheenColor).multiplyScalar(M.sheen),C.sheenRoughness.value=M.sheenRoughness,M.sheenColorMap&&(C.sheenColorMap.value=M.sheenColorMap,t(M.sheenColorMap,C.sheenColorMapTransform)),M.sheenRoughnessMap&&(C.sheenRoughnessMap.value=M.sheenRoughnessMap,t(M.sheenRoughnessMap,C.sheenRoughnessMapTransform))),M.clearcoat>0&&(C.clearcoat.value=M.clearcoat,C.clearcoatRoughness.value=M.clearcoatRoughness,M.clearcoatMap&&(C.clearcoatMap.value=M.clearcoatMap,t(M.clearcoatMap,C.clearcoatMapTransform)),M.clearcoatRoughnessMap&&(C.clearcoatRoughnessMap.value=M.clearcoatRoughnessMap,t(M.clearcoatRoughnessMap,C.clearcoatRoughnessMapTransform)),M.clearcoatNormalMap&&(C.clearcoatNormalMap.value=M.clearcoatNormalMap,t(M.clearcoatNormalMap,C.clearcoatNormalMapTransform),C.clearcoatNormalScale.value.copy(M.clearcoatNormalScale),M.side===Mc&&C.clearcoatNormalScale.value.negate())),M.dispersion>0&&(C.dispersion.value=M.dispersion),M.iridescence>0&&(C.iridescence.value=M.iridescence,C.iridescenceIOR.value=M.iridescenceIOR,C.iridescenceThicknessMinimum.value=M.iridescenceThicknessRange[0],C.iridescenceThicknessMaximum.value=M.iridescenceThicknessRange[1],M.iridescenceMap&&(C.iridescenceMap.value=M.iridescenceMap,t(M.iridescenceMap,C.iridescenceMapTransform)),M.iridescenceThicknessMap&&(C.iridescenceThicknessMap.value=M.iridescenceThicknessMap,t(M.iridescenceThicknessMap,C.iridescenceThicknessMapTransform))),M.transmission>0&&(C.transmission.value=M.transmission,C.transmissionSamplerMap.value=B.texture,C.transmissionSamplerSize.value.set(B.width,B.height),M.transmissionMap&&(C.transmissionMap.value=M.transmissionMap,t(M.transmissionMap,C.transmissionMapTransform)),C.thickness.value=M.thickness,M.thicknessMap&&(C.thicknessMap.value=M.thicknessMap,t(M.thicknessMap,C.thicknessMapTransform)),C.attenuationDistance.value=M.attenuationDistance,C.attenuationColor.value.copy(M.attenuationColor)),M.anisotropy>0&&(C.anisotropyVector.value.set(M.anisotropy*Math.cos(M.anisotropyRotation),M.anisotropy*Math.sin(M.anisotropyRotation)),M.anisotropyMap&&(C.anisotropyMap.value=M.anisotropyMap,t(M.anisotropyMap,C.anisotropyMapTransform))),C.specularIntensity.value=M.specularIntensity,C.specularColor.value.copy(M.specularColor),M.specularColorMap&&(C.specularColorMap.value=M.specularColorMap,t(M.specularColorMap,C.specularColorMapTransform)),M.specularIntensityMap&&(C.specularIntensityMap.value=M.specularIntensityMap,t(M.specularIntensityMap,C.specularIntensityMapTransform))}function T(C,M){M.matcap&&(C.matcap.value=M.matcap)}function I(C,M){const B=e.get(M).light;C.referencePosition.value.setFromMatrixPosition(B.matrixWorld),C.nearDistance.value=B.shadow.camera.near,C.farDistance.value=B.shadow.camera.far}return{refreshFogUniforms:r,refreshMaterialUniforms:i}}function jxe(n,e,t,r){let i={},s={},a=[];const l=n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS);function o(B,k){const j=k.program;r.uniformBlockBinding(B,j)}function h(B,k){let j=i[B.id];j===void 0&&(T(B),j=d(B),i[B.id]=j,B.addEventListener("dispose",C));const q=k.program;r.updateUBOMapping(B,q);const Z=e.render.frame;s[B.id]!==Z&&(_(B),s[B.id]=Z)}function d(B){const k=m();B.__bindingPointIndex=k;const j=n.createBuffer(),q=B.__size,Z=B.usage;return n.bindBuffer(n.UNIFORM_BUFFER,j),n.bufferData(n.UNIFORM_BUFFER,q,Z),n.bindBuffer(n.UNIFORM_BUFFER,null),n.bindBufferBase(n.UNIFORM_BUFFER,k,j),j}function m(){for(let B=0;B<l;B++)if(a.indexOf(B)===-1)return a.push(B),B;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function _(B){const k=i[B.id],j=B.uniforms,q=B.__cache;n.bindBuffer(n.UNIFORM_BUFFER,k);for(let Z=0,te=j.length;Z<te;Z++){const ie=Array.isArray(j[Z])?j[Z]:[j[Z]];for(let se=0,ae=ie.length;se<ae;se++){const fe=ie[se];if(y(fe,Z,se,q)===!0){const Se=fe.__offset,Ee=Array.isArray(fe.value)?fe.value:[fe.value];let Re=0;for(let qe=0;qe<Ee.length;qe++){const Le=Ee[qe],dt=I(Le);typeof Le=="number"||typeof Le=="boolean"?(fe.__data[0]=Le,n.bufferSubData(n.UNIFORM_BUFFER,Se+Re,fe.__data)):Le.isMatrix3?(fe.__data[0]=Le.elements[0],fe.__data[1]=Le.elements[1],fe.__data[2]=Le.elements[2],fe.__data[3]=0,fe.__data[4]=Le.elements[3],fe.__data[5]=Le.elements[4],fe.__data[6]=Le.elements[5],fe.__data[7]=0,fe.__data[8]=Le.elements[6],fe.__data[9]=Le.elements[7],fe.__data[10]=Le.elements[8],fe.__data[11]=0):(Le.toArray(fe.__data,Re),Re+=dt.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(n.UNIFORM_BUFFER,Se,fe.__data)}}}n.bindBuffer(n.UNIFORM_BUFFER,null)}function y(B,k,j,q){const Z=B.value,te=k+"_"+j;if(q[te]===void 0)return typeof Z=="number"||typeof Z=="boolean"?q[te]=Z:q[te]=Z.clone(),!0;{const ie=q[te];if(typeof Z=="number"||typeof Z=="boolean"){if(ie!==Z)return q[te]=Z,!0}else if(ie.equals(Z)===!1)return ie.copy(Z),!0}return!1}function T(B){const k=B.uniforms;let j=0;const q=16;for(let te=0,ie=k.length;te<ie;te++){const se=Array.isArray(k[te])?k[te]:[k[te]];for(let ae=0,fe=se.length;ae<fe;ae++){const Se=se[ae],Ee=Array.isArray(Se.value)?Se.value:[Se.value];for(let Re=0,qe=Ee.length;Re<qe;Re++){const Le=Ee[Re],dt=I(Le),ye=j%q;ye!==0&&q-ye<dt.boundary&&(j+=q-ye),Se.__data=new Float32Array(dt.storage/Float32Array.BYTES_PER_ELEMENT),Se.__offset=j,j+=dt.storage}}}const Z=j%q;return Z>0&&(j+=q-Z),B.__size=j,B.__cache={},this}function I(B){const k={boundary:0,storage:0};return typeof B=="number"||typeof B=="boolean"?(k.boundary=4,k.storage=4):B.isVector2?(k.boundary=8,k.storage=8):B.isVector3||B.isColor?(k.boundary=16,k.storage=12):B.isVector4?(k.boundary=16,k.storage=16):B.isMatrix3?(k.boundary=48,k.storage=48):B.isMatrix4?(k.boundary=64,k.storage=64):B.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",B),k}function C(B){const k=B.target;k.removeEventListener("dispose",C);const j=a.indexOf(k.__bindingPointIndex);a.splice(j,1),n.deleteBuffer(i[k.id]),delete i[k.id],delete s[k.id]}function M(){for(const B in i)n.deleteBuffer(i[B]);a=[],i={},s={}}return{bind:o,update:h,dispose:M}}class Zl{constructor(e={}){const{canvas:t=tte(),context:r=null,depth:i=!0,stencil:s=!1,alpha:a=!1,antialias:l=!1,premultipliedAlpha:o=!0,preserveDrawingBuffer:h=!1,powerPreference:d="default",failIfMajorPerformanceCaveat:m=!1}=e;this.isWebGLRenderer=!0;let _;if(r!==null){if(typeof WebGLRenderingContext<"u"&&r instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");_=r.getContextAttributes().alpha}else _=a;const y=new Uint32Array(4),T=new Int32Array(4);let I=null,C=null;const M=[],B=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=Ao,this.toneMapping=ip,this.toneMappingExposure=1;const k=this;let j=!1,q=0,Z=0,te=null,ie=-1,se=null;const ae=new Es,fe=new Es;let Se=null;const Ee=new Gn(0);let Re=0,qe=t.width,Le=t.height,dt=1,ye=null,Xe=null;const He=new Es(0,0,qe,Le),_t=new Es(0,0,qe,Le);let wt=!1;const Gt=new BT;let at=!1,Ht=!1;const Qt=new Vr,rn=new Ze,jn=new Es,Bn={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let Tn=!1;function Pe(){return te===null?dt:1}let $e=r;function mn(Ve,yt){return t.getContext(Ve,yt)}try{const Ve={alpha:!0,depth:i,stencil:s,antialias:l,premultipliedAlpha:o,preserveDrawingBuffer:h,powerPreference:d,failIfMajorPerformanceCaveat:m};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${TT}`),t.addEventListener("webglcontextlost",Kt,!1),t.addEventListener("webglcontextrestored",un,!1),t.addEventListener("webglcontextcreationerror",En,!1),$e===null){const yt="webgl2";if($e=mn(yt,Ve),$e===null)throw mn(yt)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(Ve){throw console.error("THREE.WebGLRenderer: "+Ve.message),Ve}let cn,St,Jt,kn,Vn,sn,ot,Ue,$t,An,Sn,jt,mr,Un,tr,Sr,Ln,ir,ci,Fr,or,Nr,Hr,_i;function Fe(){cn=new J_e($e),cn.init(),Nr=new dte($e,cn),St=new X_e($e,cn,e,Nr),Jt=new Rxe($e),kn=new tye($e),Vn=new _xe,sn=new Oxe($e,cn,Jt,Vn,St,Nr,kn),ot=new q_e(k),Ue=new K_e(k),$t=new l0e($e),Hr=new j_e($e,$t),An=new Q_e($e,$t,kn,Hr),Sn=new rye($e,An,$t,kn),ci=new nye($e,St,sn),Sr=new $_e(Vn),jt=new vxe(k,ot,Ue,cn,St,Hr,Sr),mr=new Hxe(k,Vn),Un=new xxe,tr=new Mxe(cn),ir=new H_e(k,ot,Ue,Jt,Sn,_,o),Ln=new Ixe(k,Sn,St),_i=new jxe($e,kn,St,Jt),Fr=new W_e($e,cn,kn),or=new eye($e,cn,kn),kn.programs=jt.programs,k.capabilities=St,k.extensions=cn,k.properties=Vn,k.renderLists=Un,k.shadowMap=Ln,k.state=Jt,k.info=kn}Fe();const Lt=new Vxe(k,$e);this.xr=Lt,this.getContext=function(){return $e},this.getContextAttributes=function(){return $e.getContextAttributes()},this.forceContextLoss=function(){const Ve=cn.get("WEBGL_lose_context");Ve&&Ve.loseContext()},this.forceContextRestore=function(){const Ve=cn.get("WEBGL_lose_context");Ve&&Ve.restoreContext()},this.getPixelRatio=function(){return dt},this.setPixelRatio=function(Ve){Ve!==void 0&&(dt=Ve,this.setSize(qe,Le,!1))},this.getSize=function(Ve){return Ve.set(qe,Le)},this.setSize=function(Ve,yt,Mt=!0){if(Lt.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}qe=Ve,Le=yt,t.width=Math.floor(Ve*dt),t.height=Math.floor(yt*dt),Mt===!0&&(t.style.width=Ve+"px",t.style.height=yt+"px"),this.setViewport(0,0,Ve,yt)},this.getDrawingBufferSize=function(Ve){return Ve.set(qe*dt,Le*dt).floor()},this.setDrawingBufferSize=function(Ve,yt,Mt){qe=Ve,Le=yt,dt=Mt,t.width=Math.floor(Ve*Mt),t.height=Math.floor(yt*Mt),this.setViewport(0,0,Ve,yt)},this.getCurrentViewport=function(Ve){return Ve.copy(ae)},this.getViewport=function(Ve){return Ve.copy(He)},this.setViewport=function(Ve,yt,Mt,Ct){Ve.isVector4?He.set(Ve.x,Ve.y,Ve.z,Ve.w):He.set(Ve,yt,Mt,Ct),Jt.viewport(ae.copy(He).multiplyScalar(dt).round())},this.getScissor=function(Ve){return Ve.copy(_t)},this.setScissor=function(Ve,yt,Mt,Ct){Ve.isVector4?_t.set(Ve.x,Ve.y,Ve.z,Ve.w):_t.set(Ve,yt,Mt,Ct),Jt.scissor(fe.copy(_t).multiplyScalar(dt).round())},this.getScissorTest=function(){return wt},this.setScissorTest=function(Ve){Jt.setScissorTest(wt=Ve)},this.setOpaqueSort=function(Ve){ye=Ve},this.setTransparentSort=function(Ve){Xe=Ve},this.getClearColor=function(Ve){return Ve.copy(ir.getClearColor())},this.setClearColor=function(){ir.setClearColor.apply(ir,arguments)},this.getClearAlpha=function(){return ir.getClearAlpha()},this.setClearAlpha=function(){ir.setClearAlpha.apply(ir,arguments)},this.clear=function(Ve=!0,yt=!0,Mt=!0){let Ct=0;if(Ve){let It=!1;if(te!==null){const wn=te.texture.format;It=wn===PL||wn===RL||wn===IT}if(It){const wn=te.texture.type,_n=wn===Xf||wn===Vm||wn===Xb||wn===Wy||wn===EL||wn===IL,zn=ir.getClearColor(),Xn=ir.getClearAlpha(),lr=zn.r,gr=zn.g,dr=zn.b;_n?(y[0]=lr,y[1]=gr,y[2]=dr,y[3]=Xn,$e.clearBufferuiv($e.COLOR,0,y)):(T[0]=lr,T[1]=gr,T[2]=dr,T[3]=Xn,$e.clearBufferiv($e.COLOR,0,T))}else Ct|=$e.COLOR_BUFFER_BIT}yt&&(Ct|=$e.DEPTH_BUFFER_BIT),Mt&&(Ct|=$e.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),$e.clear(Ct)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Kt,!1),t.removeEventListener("webglcontextrestored",un,!1),t.removeEventListener("webglcontextcreationerror",En,!1),Un.dispose(),tr.dispose(),Vn.dispose(),ot.dispose(),Ue.dispose(),Sn.dispose(),Hr.dispose(),_i.dispose(),jt.dispose(),Lt.dispose(),Lt.removeEventListener("sessionstart",xe),Lt.removeEventListener("sessionend",Ce),We.stop()};function Kt(Ve){Ve.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),j=!0}function un(){console.log("THREE.WebGLRenderer: Context Restored."),j=!1;const Ve=kn.autoReset,yt=Ln.enabled,Mt=Ln.autoUpdate,Ct=Ln.needsUpdate,It=Ln.type;Fe(),kn.autoReset=Ve,Ln.enabled=yt,Ln.autoUpdate=Mt,Ln.needsUpdate=Ct,Ln.type=It}function En(Ve){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",Ve.statusMessage)}function Ar(Ve){const yt=Ve.target;yt.removeEventListener("dispose",Ar),Gr(yt)}function Gr(Ve){cs(Ve),Vn.remove(Ve)}function cs(Ve){const yt=Vn.get(Ve).programs;yt!==void 0&&(yt.forEach(function(Mt){jt.releaseProgram(Mt)}),Ve.isShaderMaterial&&jt.releaseShaderCache(Ve))}this.renderBufferDirect=function(Ve,yt,Mt,Ct,It,wn){yt===null&&(yt=Bn);const _n=It.isMesh&&It.matrixWorld.determinant()<0,zn=ln(Ve,yt,Mt,Ct,It);Jt.setMaterial(Ct,_n);let Xn=Mt.index,lr=1;if(Ct.wireframe===!0){if(Xn=An.getWireframeAttribute(Mt),Xn===void 0)return;lr=2}const gr=Mt.drawRange,dr=Mt.attributes.position;let hi=gr.start*lr,Bi=(gr.start+gr.count)*lr;wn!==null&&(hi=Math.max(hi,wn.start*lr),Bi=Math.min(Bi,(wn.start+wn.count)*lr)),Xn!==null?(hi=Math.max(hi,0),Bi=Math.min(Bi,Xn.count)):dr!=null&&(hi=Math.max(hi,0),Bi=Math.min(Bi,dr.count));const Gi=Bi-hi;if(Gi<0||Gi===1/0)return;Hr.setup(It,Ct,zn,Mt,Xn);let ws,Er=Fr;if(Xn!==null&&(ws=$t.get(Xn),Er=or,Er.setIndex(ws)),It.isMesh)Ct.wireframe===!0?(Jt.setLineWidth(Ct.wireframeLinewidth*Pe()),Er.setMode($e.LINES)):Er.setMode($e.TRIANGLES);else if(It.isLine){let Qn=Ct.linewidth;Qn===void 0&&(Qn=1),Jt.setLineWidth(Qn*Pe()),It.isLineSegments?Er.setMode($e.LINES):It.isLineLoop?Er.setMode($e.LINE_LOOP):Er.setMode($e.LINE_STRIP)}else It.isPoints?Er.setMode($e.POINTS):It.isSprite&&Er.setMode($e.TRIANGLES);if(It.isBatchedMesh)if(It._multiDrawInstances!==null)Er.renderMultiDrawInstances(It._multiDrawStarts,It._multiDrawCounts,It._multiDrawCount,It._multiDrawInstances);else if(cn.get("WEBGL_multi_draw"))Er.renderMultiDraw(It._multiDrawStarts,It._multiDrawCounts,It._multiDrawCount);else{const Qn=It._multiDrawStarts,qi=It._multiDrawCounts,qr=It._multiDrawCount,gs=Xn?$t.get(Xn).bytesPerElement:1,Wo=Vn.get(Ct).currentProgram.getUniforms();for(let Ps=0;Ps<qr;Ps++)Wo.setValue($e,"_gl_DrawID",Ps),Er.render(Qn[Ps]/gs,qi[Ps])}else if(It.isInstancedMesh)Er.renderInstances(hi,Gi,It.count);else if(Mt.isInstancedBufferGeometry){const Qn=Mt._maxInstanceCount!==void 0?Mt._maxInstanceCount:1/0,qi=Math.min(Mt.instanceCount,Qn);Er.renderInstances(hi,Gi,qi)}else Er.render(hi,Gi)};function Rs(Ve,yt,Mt){Ve.transparent===!0&&Ve.side===bc&&Ve.forceSinglePass===!1?(Ve.side=Mc,Ve.needsUpdate=!0,Pt(Ve,yt,Mt),Ve.side=Rh,Ve.needsUpdate=!0,Pt(Ve,yt,Mt),Ve.side=bc):Pt(Ve,yt,Mt)}this.compile=function(Ve,yt,Mt=null){Mt===null&&(Mt=Ve),C=tr.get(Mt),C.init(yt),B.push(C),Mt.traverseVisible(function(It){It.isLight&&It.layers.test(yt.layers)&&(C.pushLight(It),It.castShadow&&C.pushShadow(It))}),Ve!==Mt&&Ve.traverseVisible(function(It){It.isLight&&It.layers.test(yt.layers)&&(C.pushLight(It),It.castShadow&&C.pushShadow(It))}),C.setupLights();const Ct=new Set;return Ve.traverse(function(It){const wn=It.material;if(wn)if(Array.isArray(wn))for(let _n=0;_n<wn.length;_n++){const zn=wn[_n];Rs(zn,Mt,It),Ct.add(zn)}else Rs(wn,Mt,It),Ct.add(wn)}),B.pop(),C=null,Ct},this.compileAsync=function(Ve,yt,Mt=null){const Ct=this.compile(Ve,yt,Mt);return new Promise(It=>{function wn(){if(Ct.forEach(function(_n){Vn.get(_n).currentProgram.isReady()&&Ct.delete(_n)}),Ct.size===0){It(Ve);return}setTimeout(wn,10)}cn.get("KHR_parallel_shader_compile")!==null?wn():setTimeout(wn,10)})};let ui=null;function Tt(Ve){ui&&ui(Ve)}function xe(){We.stop()}function Ce(){We.start()}const We=new lte;We.setAnimationLoop(Tt),typeof self<"u"&&We.setContext(self),this.setAnimationLoop=function(Ve){ui=Ve,Lt.setAnimationLoop(Ve),Ve===null?We.stop():We.start()},Lt.addEventListener("sessionstart",xe),Lt.addEventListener("sessionend",Ce),this.render=function(Ve,yt){if(yt!==void 0&&yt.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(j===!0)return;if(Ve.matrixWorldAutoUpdate===!0&&Ve.updateMatrixWorld(),yt.parent===null&&yt.matrixWorldAutoUpdate===!0&&yt.updateMatrixWorld(),Lt.enabled===!0&&Lt.isPresenting===!0&&(Lt.cameraAutoUpdate===!0&&Lt.updateCamera(yt),yt=Lt.getCamera()),Ve.isScene===!0&&Ve.onBeforeRender(k,Ve,yt,te),C=tr.get(Ve,B.length),C.init(yt),B.push(C),Qt.multiplyMatrices(yt.projectionMatrix,yt.matrixWorldInverse),Gt.setFromProjectionMatrix(Qt),Ht=this.localClippingEnabled,at=Sr.init(this.clippingPlanes,Ht),I=Un.get(Ve,M.length),I.init(),M.push(I),Lt.enabled===!0&&Lt.isPresenting===!0){const wn=k.xr.getDepthSensingMesh();wn!==null&&nt(wn,yt,-1/0,k.sortObjects)}nt(Ve,yt,0,k.sortObjects),I.finish(),k.sortObjects===!0&&I.sort(ye,Xe),Tn=Lt.enabled===!1||Lt.isPresenting===!1||Lt.hasDepthSensing()===!1,Tn&&ir.addToRenderList(I,Ve),this.info.render.frame++,at===!0&&Sr.beginShadows();const Mt=C.state.shadowsArray;Ln.render(Mt,Ve,yt),at===!0&&Sr.endShadows(),this.info.autoReset===!0&&this.info.reset();const Ct=I.opaque,It=I.transmissive;if(C.setupLights(),yt.isArrayCamera){const wn=yt.cameras;if(It.length>0)for(let _n=0,zn=wn.length;_n<zn;_n++){const Xn=wn[_n];pt(Ct,It,Ve,Xn)}Tn&&ir.render(Ve);for(let _n=0,zn=wn.length;_n<zn;_n++){const Xn=wn[_n];Je(I,Ve,Xn,Xn.viewport)}}else It.length>0&&pt(Ct,It,Ve,yt),Tn&&ir.render(Ve),Je(I,Ve,yt);te!==null&&(sn.updateMultisampleRenderTarget(te),sn.updateRenderTargetMipmap(te)),Ve.isScene===!0&&Ve.onAfterRender(k,Ve,yt),Hr.resetDefaultState(),ie=-1,se=null,B.pop(),B.length>0?(C=B[B.length-1],at===!0&&Sr.setGlobalState(k.clippingPlanes,C.state.camera)):C=null,M.pop(),M.length>0?I=M[M.length-1]:I=null};function nt(Ve,yt,Mt,Ct){if(Ve.visible===!1)return;if(Ve.layers.test(yt.layers)){if(Ve.isGroup)Mt=Ve.renderOrder;else if(Ve.isLOD)Ve.autoUpdate===!0&&Ve.update(yt);else if(Ve.isLight)C.pushLight(Ve),Ve.castShadow&&C.pushShadow(Ve);else if(Ve.isSprite){if(!Ve.frustumCulled||Gt.intersectsSprite(Ve)){Ct&&jn.setFromMatrixPosition(Ve.matrixWorld).applyMatrix4(Qt);const _n=Sn.update(Ve),zn=Ve.material;zn.visible&&I.push(Ve,_n,zn,Mt,jn.z,null)}}else if((Ve.isMesh||Ve.isLine||Ve.isPoints)&&(!Ve.frustumCulled||Gt.intersectsObject(Ve))){const _n=Sn.update(Ve),zn=Ve.material;if(Ct&&(Ve.boundingSphere!==void 0?(Ve.boundingSphere===null&&Ve.computeBoundingSphere(),jn.copy(Ve.boundingSphere.center)):(_n.boundingSphere===null&&_n.computeBoundingSphere(),jn.copy(_n.boundingSphere.center)),jn.applyMatrix4(Ve.matrixWorld).applyMatrix4(Qt)),Array.isArray(zn)){const Xn=_n.groups;for(let lr=0,gr=Xn.length;lr<gr;lr++){const dr=Xn[lr],hi=zn[dr.materialIndex];hi&&hi.visible&&I.push(Ve,_n,hi,Mt,jn.z,dr)}}else zn.visible&&I.push(Ve,_n,zn,Mt,jn.z,null)}}const wn=Ve.children;for(let _n=0,zn=wn.length;_n<zn;_n++)nt(wn[_n],yt,Mt,Ct)}function Je(Ve,yt,Mt,Ct){const It=Ve.opaque,wn=Ve.transmissive,_n=Ve.transparent;C.setupLightsView(Mt),at===!0&&Sr.setGlobalState(k.clippingPlanes,Mt),Ct&&Jt.viewport(ae.copy(Ct)),It.length>0&&Rt(It,yt,Mt),wn.length>0&&Rt(wn,yt,Mt),_n.length>0&&Rt(_n,yt,Mt),Jt.buffers.depth.setTest(!0),Jt.buffers.depth.setMask(!0),Jt.buffers.color.setMask(!0),Jt.setPolygonOffset(!1)}function pt(Ve,yt,Mt,Ct){if((Mt.isScene===!0?Mt.overrideMaterial:null)!==null)return;C.state.transmissionRenderTarget[Ct.id]===void 0&&(C.state.transmissionRenderTarget[Ct.id]=new bl(1,1,{generateMipmaps:!0,type:cn.has("EXT_color_buffer_half_float")||cn.has("EXT_color_buffer_float")?Ah:Xf,minFilter:iu,samples:4,stencilBuffer:s,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:ds.workingColorSpace}));const wn=C.state.transmissionRenderTarget[Ct.id],_n=Ct.viewport||ae;wn.setSize(_n.z,_n.w);const zn=k.getRenderTarget();k.setRenderTarget(wn),k.getClearColor(Ee),Re=k.getClearAlpha(),Re<1&&k.setClearColor(16777215,.5),Tn?ir.render(Mt):k.clear();const Xn=k.toneMapping;k.toneMapping=ip;const lr=Ct.viewport;if(Ct.viewport!==void 0&&(Ct.viewport=void 0),C.setupLightsView(Ct),at===!0&&Sr.setGlobalState(k.clippingPlanes,Ct),Rt(Ve,Mt,Ct),sn.updateMultisampleRenderTarget(wn),sn.updateRenderTargetMipmap(wn),cn.has("WEBGL_multisampled_render_to_texture")===!1){let gr=!1;for(let dr=0,hi=yt.length;dr<hi;dr++){const Bi=yt[dr],Gi=Bi.object,ws=Bi.geometry,Er=Bi.material,Qn=Bi.group;if(Er.side===bc&&Gi.layers.test(Ct.layers)){const qi=Er.side;Er.side=Mc,Er.needsUpdate=!0,gt(Gi,Mt,Ct,ws,Er,Qn),Er.side=qi,Er.needsUpdate=!0,gr=!0}}gr===!0&&(sn.updateMultisampleRenderTarget(wn),sn.updateRenderTargetMipmap(wn))}k.setRenderTarget(zn),k.setClearColor(Ee,Re),lr!==void 0&&(Ct.viewport=lr),k.toneMapping=Xn}function Rt(Ve,yt,Mt){const Ct=yt.isScene===!0?yt.overrideMaterial:null;for(let It=0,wn=Ve.length;It<wn;It++){const _n=Ve[It],zn=_n.object,Xn=_n.geometry,lr=Ct===null?_n.material:Ct,gr=_n.group;zn.layers.test(Mt.layers)&&gt(zn,yt,Mt,Xn,lr,gr)}}function gt(Ve,yt,Mt,Ct,It,wn){Ve.onBeforeRender(k,yt,Mt,Ct,It,wn),Ve.modelViewMatrix.multiplyMatrices(Mt.matrixWorldInverse,Ve.matrixWorld),Ve.normalMatrix.getNormalMatrix(Ve.modelViewMatrix),It.transparent===!0&&It.side===bc&&It.forceSinglePass===!1?(It.side=Mc,It.needsUpdate=!0,k.renderBufferDirect(Mt,yt,Ct,It,Ve,wn),It.side=Rh,It.needsUpdate=!0,k.renderBufferDirect(Mt,yt,Ct,It,Ve,wn),It.side=bc):k.renderBufferDirect(Mt,yt,Ct,It,Ve,wn),Ve.onAfterRender(k,yt,Mt,Ct,It,wn)}function Pt(Ve,yt,Mt){yt.isScene!==!0&&(yt=Bn);const Ct=Vn.get(Ve),It=C.state.lights,wn=C.state.shadowsArray,_n=It.state.version,zn=jt.getParameters(Ve,It.state,wn,yt,Mt),Xn=jt.getProgramCacheKey(zn);let lr=Ct.programs;Ct.environment=Ve.isMeshStandardMaterial?yt.environment:null,Ct.fog=yt.fog,Ct.envMap=(Ve.isMeshStandardMaterial?Ue:ot).get(Ve.envMap||Ct.environment),Ct.envMapRotation=Ct.environment!==null&&Ve.envMap===null?yt.environmentRotation:Ve.envMapRotation,lr===void 0&&(Ve.addEventListener("dispose",Ar),lr=new Map,Ct.programs=lr);let gr=lr.get(Xn);if(gr!==void 0){if(Ct.currentProgram===gr&&Ct.lightsStateVersion===_n)return Bt(Ve,zn),gr}else zn.uniforms=jt.getUniforms(Ve),Ve.onBeforeCompile(zn,k),gr=jt.acquireProgram(zn,Xn),lr.set(Xn,gr),Ct.uniforms=zn.uniforms;const dr=Ct.uniforms;return(!Ve.isShaderMaterial&&!Ve.isRawShaderMaterial||Ve.clipping===!0)&&(dr.clippingPlanes=Sr.uniform),Bt(Ve,zn),Ct.needsLights=Cn(Ve),Ct.lightsStateVersion=_n,Ct.needsLights&&(dr.ambientLightColor.value=It.state.ambient,dr.lightProbe.value=It.state.probe,dr.directionalLights.value=It.state.directional,dr.directionalLightShadows.value=It.state.directionalShadow,dr.spotLights.value=It.state.spot,dr.spotLightShadows.value=It.state.spotShadow,dr.rectAreaLights.value=It.state.rectArea,dr.ltc_1.value=It.state.rectAreaLTC1,dr.ltc_2.value=It.state.rectAreaLTC2,dr.pointLights.value=It.state.point,dr.pointLightShadows.value=It.state.pointShadow,dr.hemisphereLights.value=It.state.hemi,dr.directionalShadowMap.value=It.state.directionalShadowMap,dr.directionalShadowMatrix.value=It.state.directionalShadowMatrix,dr.spotShadowMap.value=It.state.spotShadowMap,dr.spotLightMatrix.value=It.state.spotLightMatrix,dr.spotLightMap.value=It.state.spotLightMap,dr.pointShadowMap.value=It.state.pointShadowMap,dr.pointShadowMatrix.value=It.state.pointShadowMatrix),Ct.currentProgram=gr,Ct.uniformsList=null,gr}function zt(Ve){if(Ve.uniformsList===null){const yt=Ve.currentProgram.getUniforms();Ve.uniformsList=LI.seqWithValue(yt.seq,Ve.uniforms)}return Ve.uniformsList}function Bt(Ve,yt){const Mt=Vn.get(Ve);Mt.outputColorSpace=yt.outputColorSpace,Mt.batching=yt.batching,Mt.batchingColor=yt.batchingColor,Mt.instancing=yt.instancing,Mt.instancingColor=yt.instancingColor,Mt.instancingMorph=yt.instancingMorph,Mt.skinning=yt.skinning,Mt.morphTargets=yt.morphTargets,Mt.morphNormals=yt.morphNormals,Mt.morphColors=yt.morphColors,Mt.morphTargetsCount=yt.morphTargetsCount,Mt.numClippingPlanes=yt.numClippingPlanes,Mt.numIntersection=yt.numClipIntersection,Mt.vertexAlphas=yt.vertexAlphas,Mt.vertexTangents=yt.vertexTangents,Mt.toneMapping=yt.toneMapping}function ln(Ve,yt,Mt,Ct,It){yt.isScene!==!0&&(yt=Bn),sn.resetTextureUnits();const wn=yt.fog,_n=Ct.isMeshStandardMaterial?yt.environment:null,zn=te===null?k.outputColorSpace:te.isXRRenderTarget===!0?te.texture.colorSpace:Ga,Xn=(Ct.isMeshStandardMaterial?Ue:ot).get(Ct.envMap||_n),lr=Ct.vertexColors===!0&&!!Mt.attributes.color&&Mt.attributes.color.itemSize===4,gr=!!Mt.attributes.tangent&&(!!Ct.normalMap||Ct.anisotropy>0),dr=!!Mt.morphAttributes.position,hi=!!Mt.morphAttributes.normal,Bi=!!Mt.morphAttributes.color;let Gi=ip;Ct.toneMapped&&(te===null||te.isXRRenderTarget===!0)&&(Gi=k.toneMapping);const ws=Mt.morphAttributes.position||Mt.morphAttributes.normal||Mt.morphAttributes.color,Er=ws!==void 0?ws.length:0,Qn=Vn.get(Ct),qi=C.state.lights;if(at===!0&&(Ht===!0||Ve!==se)){const Ss=Ve===se&&Ct.id===ie;Sr.setState(Ct,Ve,Ss)}let qr=!1;Ct.version===Qn.__version?(Qn.needsLights&&Qn.lightsStateVersion!==qi.state.version||Qn.outputColorSpace!==zn||It.isBatchedMesh&&Qn.batching===!1||!It.isBatchedMesh&&Qn.batching===!0||It.isBatchedMesh&&Qn.batchingColor===!0&&It.colorTexture===null||It.isBatchedMesh&&Qn.batchingColor===!1&&It.colorTexture!==null||It.isInstancedMesh&&Qn.instancing===!1||!It.isInstancedMesh&&Qn.instancing===!0||It.isSkinnedMesh&&Qn.skinning===!1||!It.isSkinnedMesh&&Qn.skinning===!0||It.isInstancedMesh&&Qn.instancingColor===!0&&It.instanceColor===null||It.isInstancedMesh&&Qn.instancingColor===!1&&It.instanceColor!==null||It.isInstancedMesh&&Qn.instancingMorph===!0&&It.morphTexture===null||It.isInstancedMesh&&Qn.instancingMorph===!1&&It.morphTexture!==null||Qn.envMap!==Xn||Ct.fog===!0&&Qn.fog!==wn||Qn.numClippingPlanes!==void 0&&(Qn.numClippingPlanes!==Sr.numPlanes||Qn.numIntersection!==Sr.numIntersection)||Qn.vertexAlphas!==lr||Qn.vertexTangents!==gr||Qn.morphTargets!==dr||Qn.morphNormals!==hi||Qn.morphColors!==Bi||Qn.toneMapping!==Gi||Qn.morphTargetsCount!==Er)&&(qr=!0):(qr=!0,Qn.__version=Ct.version);let gs=Qn.currentProgram;qr===!0&&(gs=Pt(Ct,yt,It));let Wo=!1,Ps=!1,us=!1;const Ri=gs.getUniforms(),so=Qn.uniforms;if(Jt.useProgram(gs.program)&&(Wo=!0,Ps=!0,us=!0),Ct.id!==ie&&(ie=Ct.id,Ps=!0),Wo||se!==Ve){Ri.setValue($e,"projectionMatrix",Ve.projectionMatrix),Ri.setValue($e,"viewMatrix",Ve.matrixWorldInverse);const Ss=Ri.map.cameraPosition;Ss!==void 0&&Ss.setValue($e,rn.setFromMatrixPosition(Ve.matrixWorld)),St.logarithmicDepthBuffer&&Ri.setValue($e,"logDepthBufFC",2/(Math.log(Ve.far+1)/Math.LN2)),(Ct.isMeshPhongMaterial||Ct.isMeshToonMaterial||Ct.isMeshLambertMaterial||Ct.isMeshBasicMaterial||Ct.isMeshStandardMaterial||Ct.isShaderMaterial)&&Ri.setValue($e,"isOrthographic",Ve.isOrthographicCamera===!0),se!==Ve&&(se=Ve,Ps=!0,us=!0)}if(It.isSkinnedMesh){Ri.setOptional($e,It,"bindMatrix"),Ri.setOptional($e,It,"bindMatrixInverse");const Ss=It.skeleton;Ss&&(Ss.boneTexture===null&&Ss.computeBoneTexture(),Ri.setValue($e,"boneTexture",Ss.boneTexture,sn))}It.isBatchedMesh&&(Ri.setOptional($e,It,"batchingTexture"),Ri.setValue($e,"batchingTexture",It._matricesTexture,sn),Ri.setOptional($e,It,"batchingIdTexture"),Ri.setValue($e,"batchingIdTexture",It._indirectTexture,sn),Ri.setOptional($e,It,"batchingColorTexture"),It._colorsTexture!==null&&Ri.setValue($e,"batchingColorTexture",It._colorsTexture,sn));const Ro=Mt.morphAttributes;if((Ro.position!==void 0||Ro.normal!==void 0||Ro.color!==void 0)&&ci.update(It,Mt,gs),(Ps||Qn.receiveShadow!==It.receiveShadow)&&(Qn.receiveShadow=It.receiveShadow,Ri.setValue($e,"receiveShadow",It.receiveShadow)),Ct.isMeshGouraudMaterial&&Ct.envMap!==null&&(so.envMap.value=Xn,so.flipEnvMap.value=Xn.isCubeTexture&&Xn.isRenderTargetTexture===!1?-1:1),Ct.isMeshStandardMaterial&&Ct.envMap===null&&yt.environment!==null&&(so.envMapIntensity.value=yt.environmentIntensity),Ps&&(Ri.setValue($e,"toneMappingExposure",k.toneMappingExposure),Qn.needsLights&&Mn(so,us),wn&&Ct.fog===!0&&mr.refreshFogUniforms(so,wn),mr.refreshMaterialUniforms(so,Ct,dt,Le,C.state.transmissionRenderTarget[Ve.id]),LI.upload($e,zt(Qn),so,sn)),Ct.isShaderMaterial&&Ct.uniformsNeedUpdate===!0&&(LI.upload($e,zt(Qn),so,sn),Ct.uniformsNeedUpdate=!1),Ct.isSpriteMaterial&&Ri.setValue($e,"center",It.center),Ri.setValue($e,"modelViewMatrix",It.modelViewMatrix),Ri.setValue($e,"normalMatrix",It.normalMatrix),Ri.setValue($e,"modelMatrix",It.matrixWorld),Ct.isShaderMaterial||Ct.isRawShaderMaterial){const Ss=Ct.uniformsGroups;for(let Dc=0,Ia=Ss.length;Dc<Ia;Dc++){const sd=Ss[Dc];_i.update(sd,gs),_i.bind(sd,gs)}}return gs}function Mn(Ve,yt){Ve.ambientLightColor.needsUpdate=yt,Ve.lightProbe.needsUpdate=yt,Ve.directionalLights.needsUpdate=yt,Ve.directionalLightShadows.needsUpdate=yt,Ve.pointLights.needsUpdate=yt,Ve.pointLightShadows.needsUpdate=yt,Ve.spotLights.needsUpdate=yt,Ve.spotLightShadows.needsUpdate=yt,Ve.rectAreaLights.needsUpdate=yt,Ve.hemisphereLights.needsUpdate=yt}function Cn(Ve){return Ve.isMeshLambertMaterial||Ve.isMeshToonMaterial||Ve.isMeshPhongMaterial||Ve.isMeshStandardMaterial||Ve.isShadowMaterial||Ve.isShaderMaterial&&Ve.lights===!0}this.getActiveCubeFace=function(){return q},this.getActiveMipmapLevel=function(){return Z},this.getRenderTarget=function(){return te},this.setRenderTargetTextures=function(Ve,yt,Mt){Vn.get(Ve.texture).__webglTexture=yt,Vn.get(Ve.depthTexture).__webglTexture=Mt;const Ct=Vn.get(Ve);Ct.__hasExternalTextures=!0,Ct.__autoAllocateDepthBuffer=Mt===void 0,Ct.__autoAllocateDepthBuffer||cn.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Ct.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(Ve,yt){const Mt=Vn.get(Ve);Mt.__webglFramebuffer=yt,Mt.__useDefaultFramebuffer=yt===void 0},this.setRenderTarget=function(Ve,yt=0,Mt=0){te=Ve,q=yt,Z=Mt;let Ct=!0,It=null,wn=!1,_n=!1;if(Ve){const Xn=Vn.get(Ve);Xn.__useDefaultFramebuffer!==void 0?(Jt.bindFramebuffer($e.FRAMEBUFFER,null),Ct=!1):Xn.__webglFramebuffer===void 0?sn.setupRenderTarget(Ve):Xn.__hasExternalTextures&&sn.rebindTextures(Ve,Vn.get(Ve.texture).__webglTexture,Vn.get(Ve.depthTexture).__webglTexture);const lr=Ve.texture;(lr.isData3DTexture||lr.isDataArrayTexture||lr.isCompressedArrayTexture)&&(_n=!0);const gr=Vn.get(Ve).__webglFramebuffer;Ve.isWebGLCubeRenderTarget?(Array.isArray(gr[yt])?It=gr[yt][Mt]:It=gr[yt],wn=!0):Ve.samples>0&&sn.useMultisampledRTT(Ve)===!1?It=Vn.get(Ve).__webglMultisampledFramebuffer:Array.isArray(gr)?It=gr[Mt]:It=gr,ae.copy(Ve.viewport),fe.copy(Ve.scissor),Se=Ve.scissorTest}else ae.copy(He).multiplyScalar(dt).floor(),fe.copy(_t).multiplyScalar(dt).floor(),Se=wt;if(Jt.bindFramebuffer($e.FRAMEBUFFER,It)&&Ct&&Jt.drawBuffers(Ve,It),Jt.viewport(ae),Jt.scissor(fe),Jt.setScissorTest(Se),wn){const Xn=Vn.get(Ve.texture);$e.framebufferTexture2D($e.FRAMEBUFFER,$e.COLOR_ATTACHMENT0,$e.TEXTURE_CUBE_MAP_POSITIVE_X+yt,Xn.__webglTexture,Mt)}else if(_n){const Xn=Vn.get(Ve.texture),lr=yt||0;$e.framebufferTextureLayer($e.FRAMEBUFFER,$e.COLOR_ATTACHMENT0,Xn.__webglTexture,Mt||0,lr)}ie=-1},this.readRenderTargetPixels=function(Ve,yt,Mt,Ct,It,wn,_n){if(!(Ve&&Ve.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let zn=Vn.get(Ve).__webglFramebuffer;if(Ve.isWebGLCubeRenderTarget&&_n!==void 0&&(zn=zn[_n]),zn){Jt.bindFramebuffer($e.FRAMEBUFFER,zn);try{const Xn=Ve.texture,lr=Xn.format,gr=Xn.type;if(!St.textureFormatReadable(lr)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!St.textureTypeReadable(gr)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}yt>=0&&yt<=Ve.width-Ct&&Mt>=0&&Mt<=Ve.height-It&&$e.readPixels(yt,Mt,Ct,It,Nr.convert(lr),Nr.convert(gr),wn)}finally{const Xn=te!==null?Vn.get(te).__webglFramebuffer:null;Jt.bindFramebuffer($e.FRAMEBUFFER,Xn)}}},this.readRenderTargetPixelsAsync=async function(Ve,yt,Mt,Ct,It,wn,_n){if(!(Ve&&Ve.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let zn=Vn.get(Ve).__webglFramebuffer;if(Ve.isWebGLCubeRenderTarget&&_n!==void 0&&(zn=zn[_n]),zn){Jt.bindFramebuffer($e.FRAMEBUFFER,zn);try{const Xn=Ve.texture,lr=Xn.format,gr=Xn.type;if(!St.textureFormatReadable(lr))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!St.textureTypeReadable(gr))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(yt>=0&&yt<=Ve.width-Ct&&Mt>=0&&Mt<=Ve.height-It){const dr=$e.createBuffer();$e.bindBuffer($e.PIXEL_PACK_BUFFER,dr),$e.bufferData($e.PIXEL_PACK_BUFFER,wn.byteLength,$e.STREAM_READ),$e.readPixels(yt,Mt,Ct,It,Nr.convert(lr),Nr.convert(gr),0),$e.flush();const hi=$e.fenceSync($e.SYNC_GPU_COMMANDS_COMPLETE,0);await Dge($e,hi,4);try{$e.bindBuffer($e.PIXEL_PACK_BUFFER,dr),$e.getBufferSubData($e.PIXEL_PACK_BUFFER,0,wn)}finally{$e.deleteBuffer(dr),$e.deleteSync(hi)}return wn}}finally{const Xn=te!==null?Vn.get(te).__webglFramebuffer:null;Jt.bindFramebuffer($e.FRAMEBUFFER,Xn)}}},this.copyFramebufferToTexture=function(Ve,yt=null,Mt=0){Ve.isTexture!==!0&&(console.warn("WebGLRenderer: copyFramebufferToTexture function signature has changed."),yt=arguments[0]||null,Ve=arguments[1]);const Ct=Math.pow(2,-Mt),It=Math.floor(Ve.image.width*Ct),wn=Math.floor(Ve.image.height*Ct),_n=yt!==null?yt.x:0,zn=yt!==null?yt.y:0;sn.setTexture2D(Ve,0),$e.copyTexSubImage2D($e.TEXTURE_2D,Mt,0,0,_n,zn,It,wn),Jt.unbindTexture()},this.copyTextureToTexture=function(Ve,yt,Mt=null,Ct=null,It=0){Ve.isTexture!==!0&&(console.warn("WebGLRenderer: copyTextureToTexture function signature has changed."),Ct=arguments[0]||null,Ve=arguments[1],yt=arguments[2],It=arguments[3]||0,Mt=null);let wn,_n,zn,Xn,lr,gr;Mt!==null?(wn=Mt.max.x-Mt.min.x,_n=Mt.max.y-Mt.min.y,zn=Mt.min.x,Xn=Mt.min.y):(wn=Ve.image.width,_n=Ve.image.height,zn=0,Xn=0),Ct!==null?(lr=Ct.x,gr=Ct.y):(lr=0,gr=0);const dr=Nr.convert(yt.format),hi=Nr.convert(yt.type);sn.setTexture2D(yt,0),$e.pixelStorei($e.UNPACK_FLIP_Y_WEBGL,yt.flipY),$e.pixelStorei($e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,yt.premultiplyAlpha),$e.pixelStorei($e.UNPACK_ALIGNMENT,yt.unpackAlignment);const Bi=$e.getParameter($e.UNPACK_ROW_LENGTH),Gi=$e.getParameter($e.UNPACK_IMAGE_HEIGHT),ws=$e.getParameter($e.UNPACK_SKIP_PIXELS),Er=$e.getParameter($e.UNPACK_SKIP_ROWS),Qn=$e.getParameter($e.UNPACK_SKIP_IMAGES),qi=Ve.isCompressedTexture?Ve.mipmaps[It]:Ve.image;$e.pixelStorei($e.UNPACK_ROW_LENGTH,qi.width),$e.pixelStorei($e.UNPACK_IMAGE_HEIGHT,qi.height),$e.pixelStorei($e.UNPACK_SKIP_PIXELS,zn),$e.pixelStorei($e.UNPACK_SKIP_ROWS,Xn),Ve.isDataTexture?$e.texSubImage2D($e.TEXTURE_2D,It,lr,gr,wn,_n,dr,hi,qi.data):Ve.isCompressedTexture?$e.compressedTexSubImage2D($e.TEXTURE_2D,It,lr,gr,qi.width,qi.height,dr,qi.data):$e.texSubImage2D($e.TEXTURE_2D,It,lr,gr,wn,_n,dr,hi,qi),$e.pixelStorei($e.UNPACK_ROW_LENGTH,Bi),$e.pixelStorei($e.UNPACK_IMAGE_HEIGHT,Gi),$e.pixelStorei($e.UNPACK_SKIP_PIXELS,ws),$e.pixelStorei($e.UNPACK_SKIP_ROWS,Er),$e.pixelStorei($e.UNPACK_SKIP_IMAGES,Qn),It===0&&yt.generateMipmaps&&$e.generateMipmap($e.TEXTURE_2D),Jt.unbindTexture()},this.copyTextureToTexture3D=function(Ve,yt,Mt=null,Ct=null,It=0){Ve.isTexture!==!0&&(console.warn("WebGLRenderer: copyTextureToTexture3D function signature has changed."),Mt=arguments[0]||null,Ct=arguments[1]||null,Ve=arguments[2],yt=arguments[3],It=arguments[4]||0);let wn,_n,zn,Xn,lr,gr,dr,hi,Bi;const Gi=Ve.isCompressedTexture?Ve.mipmaps[It]:Ve.image;Mt!==null?(wn=Mt.max.x-Mt.min.x,_n=Mt.max.y-Mt.min.y,zn=Mt.max.z-Mt.min.z,Xn=Mt.min.x,lr=Mt.min.y,gr=Mt.min.z):(wn=Gi.width,_n=Gi.height,zn=Gi.depth,Xn=0,lr=0,gr=0),Ct!==null?(dr=Ct.x,hi=Ct.y,Bi=Ct.z):(dr=0,hi=0,Bi=0);const ws=Nr.convert(yt.format),Er=Nr.convert(yt.type);let Qn;if(yt.isData3DTexture)sn.setTexture3D(yt,0),Qn=$e.TEXTURE_3D;else if(yt.isDataArrayTexture||yt.isCompressedArrayTexture)sn.setTexture2DArray(yt,0),Qn=$e.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}$e.pixelStorei($e.UNPACK_FLIP_Y_WEBGL,yt.flipY),$e.pixelStorei($e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,yt.premultiplyAlpha),$e.pixelStorei($e.UNPACK_ALIGNMENT,yt.unpackAlignment);const qi=$e.getParameter($e.UNPACK_ROW_LENGTH),qr=$e.getParameter($e.UNPACK_IMAGE_HEIGHT),gs=$e.getParameter($e.UNPACK_SKIP_PIXELS),Wo=$e.getParameter($e.UNPACK_SKIP_ROWS),Ps=$e.getParameter($e.UNPACK_SKIP_IMAGES);$e.pixelStorei($e.UNPACK_ROW_LENGTH,Gi.width),$e.pixelStorei($e.UNPACK_IMAGE_HEIGHT,Gi.height),$e.pixelStorei($e.UNPACK_SKIP_PIXELS,Xn),$e.pixelStorei($e.UNPACK_SKIP_ROWS,lr),$e.pixelStorei($e.UNPACK_SKIP_IMAGES,gr),Ve.isDataTexture||Ve.isData3DTexture?$e.texSubImage3D(Qn,It,dr,hi,Bi,wn,_n,zn,ws,Er,Gi.data):yt.isCompressedArrayTexture?$e.compressedTexSubImage3D(Qn,It,dr,hi,Bi,wn,_n,zn,ws,Gi.data):$e.texSubImage3D(Qn,It,dr,hi,Bi,wn,_n,zn,ws,Er,Gi),$e.pixelStorei($e.UNPACK_ROW_LENGTH,qi),$e.pixelStorei($e.UNPACK_IMAGE_HEIGHT,qr),$e.pixelStorei($e.UNPACK_SKIP_PIXELS,gs),$e.pixelStorei($e.UNPACK_SKIP_ROWS,Wo),$e.pixelStorei($e.UNPACK_SKIP_IMAGES,Ps),It===0&&yt.generateMipmaps&&$e.generateMipmap(Qn),Jt.unbindTexture()},this.initRenderTarget=function(Ve){Vn.get(Ve).__webglFramebuffer===void 0&&sn.setupRenderTarget(Ve)},this.initTexture=function(Ve){Ve.isCubeTexture?sn.setTextureCube(Ve,0):Ve.isData3DTexture?sn.setTexture3D(Ve,0):Ve.isDataArrayTexture||Ve.isCompressedArrayTexture?sn.setTexture2DArray(Ve,0):sn.setTexture2D(Ve,0),Jt.unbindTexture()},this.resetState=function(){q=0,Z=0,te=null,Jt.reset(),Hr.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Yd}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=e===DL?"display-p3":"srgb",t.unpackColorSpace=ds.workingColorSpace===PT?"display-p3":"srgb"}}class kT{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new Gn(e),this.density=t}clone(){return new kT(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class fw{constructor(e,t=1,r=1e3){this.isFog=!0,this.name="",this.color=new Gn(e),this.near=t,this.far=r}clone(){return new fw(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class Al extends Ii{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Ou,this.environmentIntensity=1,this.environmentRotation=new Ou,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class dw{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=NA,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=Lu()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return f6("THREE.InterleavedBuffer: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,r){e*=this.stride,r*=t.stride;for(let i=0,s=this.stride;i<s;i++)this.array[e+i]=t.array[r+i];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Lu()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),r=new this.constructor(t,this.stride);return r.setUsage(this.usage),r}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Lu()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const pc=new Ze;class Hm{constructor(e,t,r,i=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=r,this.normalized=i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,r=this.data.count;t<r;t++)pc.fromBufferAttribute(this,t),pc.applyMatrix4(e),this.setXYZ(t,pc.x,pc.y,pc.z);return this}applyNormalMatrix(e){for(let t=0,r=this.count;t<r;t++)pc.fromBufferAttribute(this,t),pc.applyNormalMatrix(e),this.setXYZ(t,pc.x,pc.y,pc.z);return this}transformDirection(e){for(let t=0,r=this.count;t<r;t++)pc.fromBufferAttribute(this,t),pc.transformDirection(e),this.setXYZ(t,pc.x,pc.y,pc.z);return this}getComponent(e,t){let r=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(r=wc(r,this.array)),r}setComponent(e,t,r){return this.normalized&&(r=wi(r,this.array)),this.data.array[e*this.data.stride+this.offset+t]=r,this}setX(e,t){return this.normalized&&(t=wi(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=wi(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=wi(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=wi(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=wc(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=wc(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=wc(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=wc(t,this.array)),t}setXY(e,t,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=wi(t,this.array),r=wi(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=r,this}setXYZ(e,t,r,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=wi(t,this.array),r=wi(r,this.array),i=wi(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=i,this}setXYZW(e,t,r,i,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=wi(t,this.array),r=wi(r,this.array),i=wi(i,this.array),s=wi(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=i,this.data.array[e+3]=s,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let r=0;r<this.count;r++){const i=r*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[i+s])}return new Di(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Hm(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let r=0;r<this.count;r++){const i=r*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[i+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class OL extends _o{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Gn(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let m1;const b2=new Ze,g1=new Ze,v1=new Ze,_1=new nn,w2=new nn,mte=new Vr,FC=new Ze,S2=new Ze,NC=new Ze,Sj=new nn,d5=new nn,Aj=new nn;class x6 extends Ii{constructor(e=new OL){if(super(),this.isSprite=!0,this.type="Sprite",m1===void 0){m1=new $r;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),r=new dw(t,5);m1.setIndex([0,1,2,0,2,3]),m1.setAttribute("position",new Hm(r,3,0,!1)),m1.setAttribute("uv",new Hm(r,2,3,!1))}this.geometry=m1,this.material=e,this.center=new nn(.5,.5)}raycast(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),g1.setFromMatrixScale(this.matrixWorld),mte.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),v1.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&g1.multiplyScalar(-v1.z);const r=this.material.rotation;let i,s;r!==0&&(s=Math.cos(r),i=Math.sin(r));const a=this.center;zC(FC.set(-.5,-.5,0),v1,a,g1,i,s),zC(S2.set(.5,-.5,0),v1,a,g1,i,s),zC(NC.set(.5,.5,0),v1,a,g1,i,s),Sj.set(0,0),d5.set(1,0),Aj.set(1,1);let l=e.ray.intersectTriangle(FC,S2,NC,!1,b2);if(l===null&&(zC(S2.set(-.5,.5,0),v1,a,g1,i,s),d5.set(0,1),l=e.ray.intersectTriangle(FC,NC,S2,!1,b2),l===null))return;const o=e.ray.origin.distanceTo(b2);o<e.near||o>e.far||t.push({distance:o,point:b2.clone(),uv:U0.getInterpolation(b2,FC,S2,NC,Sj,d5,Aj,new nn),face:null,object:this})}copy(e,t){return super.copy(e,t),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function zC(n,e,t,r,i,s){_1.subVectors(n,t).addScalar(.5).multiply(r),i!==void 0?(w2.x=s*_1.x-i*_1.y,w2.y=i*_1.x+s*_1.y):w2.copy(_1),n.copy(e),n.x+=w2.x,n.y+=w2.y,n.applyMatrix4(mte)}const UC=new Ze,Tj=new Ze;class gte extends Ii{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let r=0,i=t.length;r<i;r++){const s=t[r];this.addLevel(s.object.clone(),s.distance,s.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0,r=0){t=Math.abs(t);const i=this.levels;let s;for(s=0;s<i.length&&!(t<i[s].distance);s++);return i.splice(s,0,{distance:t,hysteresis:r,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let r,i;for(r=1,i=t.length;r<i;r++){let s=t[r].distance;if(t[r].object.visible&&(s-=s*t[r].hysteresis),e<s)break}return t[r-1].object}return null}raycast(e,t){if(this.levels.length>0){UC.setFromMatrixPosition(this.matrixWorld);const i=e.ray.origin.distanceTo(UC);this.getObjectForDistance(i).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){UC.setFromMatrixPosition(e.matrixWorld),Tj.setFromMatrixPosition(this.matrixWorld);const r=UC.distanceTo(Tj)/e.zoom;t[0].object.visible=!0;let i,s;for(i=1,s=t.length;i<s;i++){let a=t[i].distance;if(t[i].object.visible&&(a-=a*t[i].hysteresis),r>=a)t[i-1].object.visible=!1,t[i].object.visible=!0;else break}for(this._currentLevel=i-1;i<s;i++)t[i].object.visible=!1}}toJSON(e){const t=super.toJSON(e);this.autoUpdate===!1&&(t.object.autoUpdate=!1),t.object.levels=[];const r=this.levels;for(let i=0,s=r.length;i<s;i++){const a=r[i];t.object.levels.push({object:a.object.uuid,distance:a.distance,hysteresis:a.hysteresis})}return t}}const Mj=new Ze,Cj=new Es,Ej=new Es,Wxe=new Ze,Ij=new Vr,VC=new Ze,p5=new rl,Rj=new Vr,m5=new hx;class FL extends Ei{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=XO,this.bindMatrix=new Vr,this.bindMatrixInverse=new Vr,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new wl),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let r=0;r<t.count;r++)this.getVertexPosition(r,VC),this.boundingBox.expandByPoint(VC)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new rl),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let r=0;r<t.count;r++)this.getVertexPosition(r,VC),this.boundingSphere.expandByPoint(VC)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const r=this.material,i=this.matrixWorld;r!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),p5.copy(this.boundingSphere),p5.applyMatrix4(i),e.ray.intersectsSphere(p5)!==!1&&(Rj.copy(i).invert(),m5.copy(e.ray).applyMatrix4(Rj),!(this.boundingBox!==null&&m5.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,t,m5)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Es,t=this.geometry.attributes.skinWeight;for(let r=0,i=t.count;r<i;r++){e.fromBufferAttribute(t,r);const s=1/e.manhattanLength();s!==1/0?e.multiplyScalar(s):e.set(1,0,0,0),t.setXYZW(r,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===XO?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===Uee?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const r=this.skeleton,i=this.geometry;Cj.fromBufferAttribute(i.attributes.skinIndex,e),Ej.fromBufferAttribute(i.attributes.skinWeight,e),Mj.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let s=0;s<4;s++){const a=Ej.getComponent(s);if(a!==0){const l=Cj.getComponent(s);Ij.multiplyMatrices(r.bones[l].matrixWorld,r.boneInverses[l]),t.addScaledVector(Wxe.copy(Mj).applyMatrix4(Ij),a)}}return t.applyMatrix4(this.bindMatrixInverse)}}class OT extends Ii{constructor(){super(),this.isBone=!0,this.type="Bone"}}class jf extends Ws{constructor(e=null,t=1,r=1,i,s,a,l,o,h=wa,d=wa,m,_){super(null,a,l,o,h,d,i,s,m,_),this.isDataTexture=!0,this.image={data:e,width:t,height:r},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const Pj=new Vr,Xxe=new Vr;class pw{constructor(e=[],t=[]){this.uuid=Lu(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let r=0,i=this.bones.length;r<i;r++)this.boneInverses.push(new Vr)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const r=new Vr;this.bones[e]&&r.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(r)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const r=this.bones[e];r&&r.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const r=this.bones[e];r&&(r.parent&&r.parent.isBone?(r.matrix.copy(r.parent.matrixWorld).invert(),r.matrix.multiply(r.matrixWorld)):r.matrix.copy(r.matrixWorld),r.matrix.decompose(r.position,r.quaternion,r.scale))}}update(){const e=this.bones,t=this.boneInverses,r=this.boneMatrices,i=this.boneTexture;for(let s=0,a=e.length;s<a;s++){const l=e[s]?e[s].matrixWorld:Xxe;Pj.multiplyMatrices(l,t[s]),Pj.toArray(r,s*16)}i!==null&&(i.needsUpdate=!0)}clone(){return new pw(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const r=new jf(t,e,e,jl,Sc);return r.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=r,this}getBoneByName(e){for(let t=0,r=this.bones.length;t<r;t++){const i=this.bones[t];if(i.name===e)return i}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let r=0,i=e.bones.length;r<i;r++){const s=e.bones[r];let a=t[s];a===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",s),a=new OT),this.bones.push(a),this.boneInverses.push(new Vr().fromArray(e.boneInverses[r]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,r=this.boneInverses;for(let i=0,s=t.length;i<s;i++){const a=t[i];e.bones.push(a.uuid);const l=r[i];e.boneInverses.push(l.toArray())}return e}}class cv extends Di{constructor(e,t,r,i=1){super(e,t,r),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const y1=new Vr,Lj=new Vr,GC=[],Dj=new wl,$xe=new Vr,A2=new Ei,T2=new rl;class NL extends Ei{constructor(e,t,r){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new cv(new Float32Array(r*16),16),this.instanceColor=null,this.morphTexture=null,this.count=r,this.boundingBox=null,this.boundingSphere=null;for(let i=0;i<r;i++)this.setMatrixAt(i,$xe)}computeBoundingBox(){const e=this.geometry,t=this.count;this.boundingBox===null&&(this.boundingBox=new wl),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let r=0;r<t;r++)this.getMatrixAt(r,y1),Dj.copy(e.boundingBox).applyMatrix4(y1),this.boundingBox.union(Dj)}computeBoundingSphere(){const e=this.geometry,t=this.count;this.boundingSphere===null&&(this.boundingSphere=new rl),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let r=0;r<t;r++)this.getMatrixAt(r,y1),T2.copy(e.boundingSphere).applyMatrix4(y1),this.boundingSphere.union(T2)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone()),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}getMorphAt(e,t){const r=t.morphTargetInfluences,i=this.morphTexture.source.data.data,s=r.length+1,a=e*s+1;for(let l=0;l<r.length;l++)r[l]=i[a+l]}raycast(e,t){const r=this.matrixWorld,i=this.count;if(A2.geometry=this.geometry,A2.material=this.material,A2.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),T2.copy(this.boundingSphere),T2.applyMatrix4(r),e.ray.intersectsSphere(T2)!==!1))for(let s=0;s<i;s++){this.getMatrixAt(s,y1),Lj.multiplyMatrices(r,y1),A2.matrixWorld=Lj,A2.raycast(e,GC);for(let a=0,l=GC.length;a<l;a++){const o=GC[a];o.instanceId=s,o.object=this,t.push(o)}GC.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new cv(new Float32Array(this.instanceMatrix.count*3),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}setMorphAt(e,t){const r=t.morphTargetInfluences,i=r.length+1;this.morphTexture===null&&(this.morphTexture=new jf(new Float32Array(i*this.count),i,this.count,ET,Sc));const s=this.morphTexture.source.data.data;let a=0;for(let h=0;h<r.length;h++)a+=r[h];const l=this.geometry.morphTargetsRelative?1:1-a,o=i*e;s[o]=l,s.set(r,o+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null),this}}function qxe(n,e){return n.z-e.z}function Zxe(n,e){return e.z-n.z}class Yxe{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,t,r){const i=this.pool,s=this.list;this.index>=i.length&&i.push({start:-1,count:-1,z:-1,index:-1});const a=i[this.index];s.push(a),this.index++,a.start=e.start,a.count=e.count,a.z=t,a.index=r}reset(){this.list.length=0,this.index=0}}const u0=new Vr,g5=new Vr,Kxe=new Vr,Jxe=new Gn(1,1,1),Bj=new Vr,v5=new BT,HC=new wl,b_=new rl,M2=new Ze,kj=new Ze,Qxe=new Ze,_5=new Yxe,kl=new Ei,jC=[];function e1e(n,e,t=0){const r=e.itemSize;if(n.isInterleavedBufferAttribute||n.array.constructor!==e.array.constructor){const i=n.count;for(let s=0;s<i;s++)for(let a=0;a<r;a++)e.setComponent(s+t,a,n.getComponent(s,a))}else e.array.set(n.array,t*r);e.needsUpdate=!0}class vte extends Ei{get maxInstanceCount(){return this._maxInstanceCount}constructor(e,t,r=t*2,i){super(new $r,i),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._drawInfo=[],this._drawRanges=[],this._reservedRanges=[],this._bounds=[],this._maxInstanceCount=e,this._maxVertexCount=t,this._maxIndexCount=r,this._geometryInitialized=!1,this._geometryCount=0,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._multiDrawInstances=null,this._visibilityChanged=!0,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}_initMatricesTexture(){let e=Math.sqrt(this._maxInstanceCount*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4),r=new jf(t,e,e,jl,Sc);this._matricesTexture=r}_initIndirectTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=new Uint32Array(e*e),r=new jf(t,e,e,IT,Vm);this._indirectTexture=r}_initColorsTexture(){let e=Math.sqrt(this._maxIndexCount);e=Math.ceil(e);const t=new Float32Array(e*e*4).fill(1),r=new jf(t,e,e,jl,Sc);r.colorSpace=ds.workingColorSpace,this._colorsTexture=r}_initializeGeometry(e){const t=this.geometry,r=this._maxVertexCount,i=this._maxIndexCount;if(this._geometryInitialized===!1){for(const s in e.attributes){const a=e.getAttribute(s),{array:l,itemSize:o,normalized:h}=a,d=new l.constructor(r*o),m=new Di(d,o,h);t.setAttribute(s,m)}if(e.getIndex()!==null){const s=r>65535?new Uint32Array(i):new Uint16Array(i);t.setIndex(new Di(s,1))}this._geometryInitialized=!0}}_validateGeometry(e){const t=this.geometry;if(!!e.getIndex()!=!!t.getIndex())throw new Error('BatchedMesh: All geometries must consistently have "index".');for(const r in t.attributes){if(!e.hasAttribute(r))throw new Error(`BatchedMesh: Added geometry missing "${r}". All geometries must have consistent attributes.`);const i=e.getAttribute(r),s=t.getAttribute(r);if(i.itemSize!==s.itemSize||i.normalized!==s.normalized)throw new Error("BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new wl);const e=this._geometryCount,t=this.boundingBox,r=this._drawInfo;t.makeEmpty();for(let i=0;i<e;i++){if(r[i].active===!1)continue;const s=r[i].geometryIndex;this.getMatrixAt(i,u0),this.getBoundingBoxAt(s,HC).applyMatrix4(u0),t.union(HC)}}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new rl);const e=this.boundingSphere,t=this._drawInfo;e.makeEmpty();for(let r=0,i=t.length;r<i;r++){if(t[r].active===!1)continue;const s=t[r].geometryIndex;this.getMatrixAt(r,u0),this.getBoundingSphereAt(s,b_).applyMatrix4(u0),e.union(b_)}}addInstance(e){if(this._drawInfo.length>=this._maxInstanceCount)throw new Error("BatchedMesh: Maximum item count reached.");this._drawInfo.push({visible:!0,active:!0,geometryIndex:e});const t=this._drawInfo.length-1,r=this._matricesTexture,i=r.image.data;Kxe.toArray(i,t*16),r.needsUpdate=!0;const s=this._colorsTexture;return s&&(Jxe.toArray(s.image.data,t*4),s.needsUpdate=!0),t}addGeometry(e,t=-1,r=-1){if(this._initializeGeometry(e),this._validateGeometry(e),this._drawInfo.length>=this._maxInstanceCount)throw new Error("BatchedMesh: Maximum item count reached.");const i={vertexStart:-1,vertexCount:-1,indexStart:-1,indexCount:-1};let s=null;const a=this._reservedRanges,l=this._drawRanges,o=this._bounds;this._geometryCount!==0&&(s=a[a.length-1]),t===-1?i.vertexCount=e.getAttribute("position").count:i.vertexCount=t,s===null?i.vertexStart=0:i.vertexStart=s.vertexStart+s.vertexCount;const h=e.getIndex(),d=h!==null;if(d&&(r===-1?i.indexCount=h.count:i.indexCount=r,s===null?i.indexStart=0:i.indexStart=s.indexStart+s.indexCount),i.indexStart!==-1&&i.indexStart+i.indexCount>this._maxIndexCount||i.vertexStart+i.vertexCount>this._maxVertexCount)throw new Error("BatchedMesh: Reserved space request exceeds the maximum buffer size.");const m=this._geometryCount;return this._geometryCount++,a.push(i),l.push({start:d?i.indexStart:i.vertexStart,count:-1}),o.push({boxInitialized:!1,box:new wl,sphereInitialized:!1,sphere:new rl}),this.setGeometryAt(m,e),m}setGeometryAt(e,t){if(e>=this._geometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");this._validateGeometry(t);const r=this.geometry,i=r.getIndex()!==null,s=r.getIndex(),a=t.getIndex(),l=this._reservedRanges[e];if(i&&a.count>l.indexCount||t.attributes.position.count>l.vertexCount)throw new Error("BatchedMesh: Reserved space not large enough for provided geometry.");const o=l.vertexStart,h=l.vertexCount;for(const y in r.attributes){const T=t.getAttribute(y),I=r.getAttribute(y);e1e(T,I,o);const C=T.itemSize;for(let M=T.count,B=h;M<B;M++){const k=o+M;for(let j=0;j<C;j++)I.setComponent(k,j,0)}I.needsUpdate=!0,I.addUpdateRange(o*C,h*C)}if(i){const y=l.indexStart;for(let T=0;T<a.count;T++)s.setX(y+T,o+a.getX(T));for(let T=a.count,I=l.indexCount;T<I;T++)s.setX(y+T,o);s.needsUpdate=!0,s.addUpdateRange(y,l.indexCount)}const d=this._bounds[e];t.boundingBox!==null?(d.box.copy(t.boundingBox),d.boxInitialized=!0):d.boxInitialized=!1,t.boundingSphere!==null?(d.sphere.copy(t.boundingSphere),d.sphereInitialized=!0):d.sphereInitialized=!1;const m=this._drawRanges[e],_=t.getAttribute("position");return m.count=i?a.count:_.count,this._visibilityChanged=!0,e}getBoundingBoxAt(e,t){if(e>=this._geometryCount)return null;const r=this._bounds[e],i=r.box,s=this.geometry;if(r.boxInitialized===!1){i.makeEmpty();const a=s.index,l=s.attributes.position,o=this._drawRanges[e];for(let h=o.start,d=o.start+o.count;h<d;h++){let m=h;a&&(m=a.getX(m)),i.expandByPoint(M2.fromBufferAttribute(l,m))}r.boxInitialized=!0}return t.copy(i),t}getBoundingSphereAt(e,t){if(e>=this._geometryCount)return null;const r=this._bounds[e],i=r.sphere,s=this.geometry;if(r.sphereInitialized===!1){i.makeEmpty(),this.getBoundingBoxAt(e,HC),HC.getCenter(i.center);const a=s.index,l=s.attributes.position,o=this._drawRanges[e];let h=0;for(let d=o.start,m=o.start+o.count;d<m;d++){let _=d;a&&(_=a.getX(_)),M2.fromBufferAttribute(l,_),h=Math.max(h,i.center.distanceToSquared(M2))}i.radius=Math.sqrt(h),r.sphereInitialized=!0}return t.copy(i),t}setMatrixAt(e,t){const r=this._drawInfo,i=this._matricesTexture,s=this._matricesTexture.image.data;return e>=r.length||r[e].active===!1?this:(t.toArray(s,e*16),i.needsUpdate=!0,this)}getMatrixAt(e,t){const r=this._drawInfo,i=this._matricesTexture.image.data;return e>=r.length||r[e].active===!1?null:t.fromArray(i,e*16)}setColorAt(e,t){this._colorsTexture===null&&this._initColorsTexture();const r=this._colorsTexture,i=this._colorsTexture.image.data,s=this._drawInfo;return e>=s.length||s[e].active===!1?this:(t.toArray(i,e*4),r.needsUpdate=!0,this)}getColorAt(e,t){const r=this._colorsTexture.image.data,i=this._drawInfo;return e>=i.length||i[e].active===!1?null:t.fromArray(r,e*4)}setVisibleAt(e,t){const r=this._drawInfo;return e>=r.length||r[e].active===!1||r[e].visible===t?this:(r[e].visible=t,this._visibilityChanged=!0,this)}getVisibleAt(e){const t=this._drawInfo;return e>=t.length||t[e].active===!1?!1:t[e].visible}raycast(e,t){const r=this._drawInfo,i=this._drawRanges,s=this.matrixWorld,a=this.geometry;kl.material=this.material,kl.geometry.index=a.index,kl.geometry.attributes=a.attributes,kl.geometry.boundingBox===null&&(kl.geometry.boundingBox=new wl),kl.geometry.boundingSphere===null&&(kl.geometry.boundingSphere=new rl);for(let l=0,o=r.length;l<o;l++){if(!r[l].visible||!r[l].active)continue;const h=r[l].geometryIndex,d=i[h];kl.geometry.setDrawRange(d.start,d.count),this.getMatrixAt(l,kl.matrixWorld).premultiply(s),this.getBoundingBoxAt(h,kl.geometry.boundingBox),this.getBoundingSphereAt(h,kl.geometry.boundingSphere),kl.raycast(e,jC);for(let m=0,_=jC.length;m<_;m++){const y=jC[m];y.object=this,y.batchId=l,t.push(y)}jC.length=0}kl.material=null,kl.geometry.index=null,kl.geometry.attributes={},kl.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=e.boundingBox!==null?e.boundingBox.clone():null,this.boundingSphere=e.boundingSphere!==null?e.boundingSphere.clone():null,this._drawRanges=e._drawRanges.map(t=>({...t})),this._reservedRanges=e._reservedRanges.map(t=>({...t})),this._drawInfo=e._drawInfo.map(t=>({...t})),this._bounds=e._bounds.map(t=>({boxInitialized:t.boxInitialized,box:t.box.clone(),sphereInitialized:t.sphereInitialized,sphere:t.sphere.clone()})),this._maxInstanceCount=e._maxInstanceCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._geometryCount=e._geometryCount,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.slice(),this._colorsTexture!==null&&(this._colorsTexture=e._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.slice()),this}dispose(){return this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,this._colorsTexture!==null&&(this._colorsTexture.dispose(),this._colorsTexture=null),this}onBeforeRender(e,t,r,i,s){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const a=i.getIndex(),l=a===null?1:a.array.BYTES_PER_ELEMENT,o=this._drawInfo,h=this._multiDrawStarts,d=this._multiDrawCounts,m=this._drawRanges,_=this.perObjectFrustumCulled,y=this._indirectTexture,T=y.image.data;_&&(Bj.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse).multiply(this.matrixWorld),v5.setFromProjectionMatrix(Bj,e.coordinateSystem));let I=0;if(this.sortObjects){g5.copy(this.matrixWorld).invert(),M2.setFromMatrixPosition(r.matrixWorld).applyMatrix4(g5),kj.set(0,0,-1).transformDirection(r.matrixWorld).transformDirection(g5);for(let B=0,k=o.length;B<k;B++)if(o[B].visible&&o[B].active){const j=o[B].geometryIndex;this.getMatrixAt(B,u0),this.getBoundingSphereAt(j,b_).applyMatrix4(u0);let q=!1;if(_&&(q=!v5.intersectsSphere(b_)),!q){const Z=Qxe.subVectors(b_.center,M2).dot(kj);_5.push(m[j],Z,B)}}const C=_5.list,M=this.customSort;M===null?C.sort(s.transparent?Zxe:qxe):M.call(this,C,r);for(let B=0,k=C.length;B<k;B++){const j=C[B];h[I]=j.start*l,d[I]=j.count,T[I]=j.index,I++}_5.reset()}else for(let C=0,M=o.length;C<M;C++)if(o[C].visible&&o[C].active){const B=o[C].geometryIndex;let k=!1;if(_&&(this.getMatrixAt(C,u0),this.getBoundingSphereAt(B,b_).applyMatrix4(u0),k=!v5.intersectsSphere(b_)),!k){const j=m[B];h[I]=j.start*l,d[I]=j.count,T[I]=C,I++}}y.needsUpdate=!0,this._multiDrawCount=I,this._visibilityChanged=!1}onBeforeShadow(e,t,r,i,s,a){this.onBeforeRender(e,null,i,s,a)}}class Ta extends _o{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Gn(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const QR=new Ze,eP=new Ze,Oj=new Vr,C2=new hx,WC=new rl,y5=new Ze,Fj=new Ze;let $f=class extends Ii{constructor(e=new $r,t=new Ta){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,r=[0];for(let i=1,s=t.count;i<s;i++)QR.fromBufferAttribute(t,i-1),eP.fromBufferAttribute(t,i),r[i]=r[i-1],r[i]+=QR.distanceTo(eP);e.setAttribute("lineDistance",new ar(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const r=this.geometry,i=this.matrixWorld,s=e.params.Line.threshold,a=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),WC.copy(r.boundingSphere),WC.applyMatrix4(i),WC.radius+=s,e.ray.intersectsSphere(WC)===!1)return;Oj.copy(i).invert(),C2.copy(e.ray).applyMatrix4(Oj);const l=s/((this.scale.x+this.scale.y+this.scale.z)/3),o=l*l,h=this.isLineSegments?2:1,d=r.index,_=r.attributes.position;if(d!==null){const y=Math.max(0,a.start),T=Math.min(d.count,a.start+a.count);for(let I=y,C=T-1;I<C;I+=h){const M=d.getX(I),B=d.getX(I+1),k=XC(this,e,C2,o,M,B);k&&t.push(k)}if(this.isLineLoop){const I=d.getX(T-1),C=d.getX(y),M=XC(this,e,C2,o,I,C);M&&t.push(M)}}else{const y=Math.max(0,a.start),T=Math.min(_.count,a.start+a.count);for(let I=y,C=T-1;I<C;I+=h){const M=XC(this,e,C2,o,I,I+1);M&&t.push(M)}if(this.isLineLoop){const I=XC(this,e,C2,o,T-1,y);I&&t.push(I)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,r=Object.keys(t);if(r.length>0){const i=t[r[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=i.length;s<a;s++){const l=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[l]=s}}}}};function XC(n,e,t,r,i,s){const a=n.geometry.attributes.position;if(QR.fromBufferAttribute(a,i),eP.fromBufferAttribute(a,s),t.distanceSqToSegment(QR,eP,y5,Fj)>r)return;y5.applyMatrix4(n.matrixWorld);const o=e.ray.origin.distanceTo(y5);if(!(o<e.near||o>e.far))return{distance:o,point:Fj.clone().applyMatrix4(n.matrixWorld),index:i,face:null,faceIndex:null,object:n}}const Nj=new Ze,zj=new Ze;class uu extends $f{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,r=[];for(let i=0,s=t.count;i<s;i+=2)Nj.fromBufferAttribute(t,i),zj.fromBufferAttribute(t,i+1),r[i]=i===0?0:r[i-1],r[i+1]=r[i]+Nj.distanceTo(zj);e.setAttribute("lineDistance",new ar(r,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class zL extends $f{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class su extends _o{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Gn(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const Uj=new Vr,JO=new hx,$C=new rl,qC=new Ze;class wh extends Ii{constructor(e=new $r,t=new su){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const r=this.geometry,i=this.matrixWorld,s=e.params.Points.threshold,a=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),$C.copy(r.boundingSphere),$C.applyMatrix4(i),$C.radius+=s,e.ray.intersectsSphere($C)===!1)return;Uj.copy(i).invert(),JO.copy(e.ray).applyMatrix4(Uj);const l=s/((this.scale.x+this.scale.y+this.scale.z)/3),o=l*l,h=r.index,m=r.attributes.position;if(h!==null){const _=Math.max(0,a.start),y=Math.min(h.count,a.start+a.count);for(let T=_,I=y;T<I;T++){const C=h.getX(T);qC.fromBufferAttribute(m,C),Vj(qC,C,o,i,e,t,this)}}else{const _=Math.max(0,a.start),y=Math.min(m.count,a.start+a.count);for(let T=_,I=y;T<I;T++)qC.fromBufferAttribute(m,T),Vj(qC,T,o,i,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,r=Object.keys(t);if(r.length>0){const i=t[r[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=i.length;s<a;s++){const l=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[l]=s}}}}}function Vj(n,e,t,r,i,s,a){const l=JO.distanceSqToPoint(n);if(l<t){const o=new Ze;JO.closestPointToPoint(n,o),o.applyMatrix4(r);const h=i.ray.origin.distanceTo(o);if(h<i.near||h>i.far)return;s.push({distance:h,distanceToRay:Math.sqrt(l),point:o,index:e,face:null,object:a})}}class _te extends Ws{constructor(e,t,r,i,s,a,l,o,h){super(e,t,r,i,s,a,l,o,h),this.isVideoTexture=!0,this.minFilter=a!==void 0?a:Co,this.magFilter=s!==void 0?s:Co,this.generateMipmaps=!1;const d=this;function m(){d.needsUpdate=!0,e.requestVideoFrameCallback(m)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(m)}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class t1e extends Ws{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=wa,this.minFilter=wa,this.generateMipmaps=!1,this.needsUpdate=!0}}class UL extends Ws{constructor(e,t,r,i,s,a,l,o,h,d,m,_){super(null,a,l,o,h,d,i,s,m,_),this.isCompressedTexture=!0,this.image={width:t,height:r},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class n1e extends UL{constructor(e,t,r,i,s,a){super(e,t,r,s,a),this.isCompressedArrayTexture=!0,this.image.depth=i,this.wrapR=ru,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class r1e extends UL{constructor(e,t,r){super(void 0,e[0].width,e[0].height,t,r,Um),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class QO extends Ws{constructor(e,t,r,i,s,a,l,o,h){super(e,t,r,i,s,a,l,o,h),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Jf{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const r=this.getUtoTmapping(e);return this.getPoint(r,t)}getPoints(e=5){const t=[];for(let r=0;r<=e;r++)t.push(this.getPoint(r/e));return t}getSpacedPoints(e=5){const t=[];for(let r=0;r<=e;r++)t.push(this.getPointAt(r/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let r,i=this.getPoint(0),s=0;t.push(0);for(let a=1;a<=e;a++)r=this.getPoint(a/e),s+=r.distanceTo(i),t.push(s),i=r;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const r=this.getLengths();let i=0;const s=r.length;let a;t?a=t:a=e*r[s-1];let l=0,o=s-1,h;for(;l<=o;)if(i=Math.floor(l+(o-l)/2),h=r[i]-a,h<0)l=i+1;else if(h>0)o=i-1;else{o=i;break}if(i=o,r[i]===a)return i/(s-1);const d=r[i],_=r[i+1]-d,y=(a-d)/_;return(i+y)/(s-1)}getTangent(e,t){let i=e-1e-4,s=e+1e-4;i<0&&(i=0),s>1&&(s=1);const a=this.getPoint(i),l=this.getPoint(s),o=t||(a.isVector2?new nn:new Ze);return o.copy(l).sub(a).normalize(),o}getTangentAt(e,t){const r=this.getUtoTmapping(e);return this.getTangent(r,t)}computeFrenetFrames(e,t){const r=new Ze,i=[],s=[],a=[],l=new Ze,o=new Vr;for(let y=0;y<=e;y++){const T=y/e;i[y]=this.getTangentAt(T,new Ze)}s[0]=new Ze,a[0]=new Ze;let h=Number.MAX_VALUE;const d=Math.abs(i[0].x),m=Math.abs(i[0].y),_=Math.abs(i[0].z);d<=h&&(h=d,r.set(1,0,0)),m<=h&&(h=m,r.set(0,1,0)),_<=h&&r.set(0,0,1),l.crossVectors(i[0],r).normalize(),s[0].crossVectors(i[0],l),a[0].crossVectors(i[0],s[0]);for(let y=1;y<=e;y++){if(s[y]=s[y-1].clone(),a[y]=a[y-1].clone(),l.crossVectors(i[y-1],i[y]),l.length()>Number.EPSILON){l.normalize();const T=Math.acos(ea(i[y-1].dot(i[y]),-1,1));s[y].applyMatrix4(o.makeRotationAxis(l,T))}a[y].crossVectors(i[y],s[y])}if(t===!0){let y=Math.acos(ea(s[0].dot(s[e]),-1,1));y/=e,i[0].dot(l.crossVectors(s[0],s[e]))>0&&(y=-y);for(let T=1;T<=e;T++)s[T].applyMatrix4(o.makeRotationAxis(i[T],y*T)),a[T].crossVectors(i[T],s[T])}return{tangents:i,normals:s,binormals:a}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class VL extends Jf{constructor(e=0,t=0,r=1,i=1,s=0,a=Math.PI*2,l=!1,o=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=r,this.yRadius=i,this.aStartAngle=s,this.aEndAngle=a,this.aClockwise=l,this.aRotation=o}getPoint(e,t=new nn){const r=t,i=Math.PI*2;let s=this.aEndAngle-this.aStartAngle;const a=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=i;for(;s>i;)s-=i;s<Number.EPSILON&&(a?s=0:s=i),this.aClockwise===!0&&!a&&(s===i?s=-i:s=s-i);const l=this.aStartAngle+e*s;let o=this.aX+this.xRadius*Math.cos(l),h=this.aY+this.yRadius*Math.sin(l);if(this.aRotation!==0){const d=Math.cos(this.aRotation),m=Math.sin(this.aRotation),_=o-this.aX,y=h-this.aY;o=_*d-y*m+this.aX,h=_*m+y*d+this.aY}return r.set(o,h)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class yte extends VL{constructor(e,t,r,i,s,a){super(e,t,r,r,i,s,a),this.isArcCurve=!0,this.type="ArcCurve"}}function b6(){let n=0,e=0,t=0,r=0;function i(s,a,l,o){n=s,e=l,t=-3*s+3*a-2*l-o,r=2*s-2*a+l+o}return{initCatmullRom:function(s,a,l,o,h){i(a,l,h*(l-s),h*(o-a))},initNonuniformCatmullRom:function(s,a,l,o,h,d,m){let _=(a-s)/h-(l-s)/(h+d)+(l-a)/d,y=(l-a)/d-(o-a)/(d+m)+(o-l)/m;_*=d,y*=d,i(a,l,_,y)},calc:function(s){const a=s*s,l=a*s;return n+e*s+t*a+r*l}}}const ZC=new Ze,x5=new b6,b5=new b6,w5=new b6;class xte extends Jf{constructor(e=[],t=!1,r="centripetal",i=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=r,this.tension=i}getPoint(e,t=new Ze){const r=t,i=this.points,s=i.length,a=(s-(this.closed?0:1))*e;let l=Math.floor(a),o=a-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/s)+1)*s:o===0&&l===s-1&&(l=s-2,o=1);let h,d;this.closed||l>0?h=i[(l-1)%s]:(ZC.subVectors(i[0],i[1]).add(i[0]),h=ZC);const m=i[l%s],_=i[(l+1)%s];if(this.closed||l+2<s?d=i[(l+2)%s]:(ZC.subVectors(i[s-1],i[s-2]).add(i[s-1]),d=ZC),this.curveType==="centripetal"||this.curveType==="chordal"){const y=this.curveType==="chordal"?.5:.25;let T=Math.pow(h.distanceToSquared(m),y),I=Math.pow(m.distanceToSquared(_),y),C=Math.pow(_.distanceToSquared(d),y);I<1e-4&&(I=1),T<1e-4&&(T=I),C<1e-4&&(C=I),x5.initNonuniformCatmullRom(h.x,m.x,_.x,d.x,T,I,C),b5.initNonuniformCatmullRom(h.y,m.y,_.y,d.y,T,I,C),w5.initNonuniformCatmullRom(h.z,m.z,_.z,d.z,T,I,C)}else this.curveType==="catmullrom"&&(x5.initCatmullRom(h.x,m.x,_.x,d.x,this.tension),b5.initCatmullRom(h.y,m.y,_.y,d.y,this.tension),w5.initCatmullRom(h.z,m.z,_.z,d.z,this.tension));return r.set(x5.calc(o),b5.calc(o),w5.calc(o)),r}copy(e){super.copy(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){const i=e.points[t];this.points.push(i.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,r=this.points.length;t<r;t++){const i=this.points[t];e.points.push(i.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){const i=e.points[t];this.points.push(new Ze().fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function Gj(n,e,t,r,i){const s=(r-e)*.5,a=(i-t)*.5,l=n*n,o=n*l;return(2*t-2*r+s+a)*o+(-3*t+3*r-2*s-a)*l+s*n+t}function i1e(n,e){const t=1-n;return t*t*e}function s1e(n,e){return 2*(1-n)*n*e}function o1e(n,e){return n*n*e}function VS(n,e,t,r){return i1e(n,e)+s1e(n,t)+o1e(n,r)}function a1e(n,e){const t=1-n;return t*t*t*e}function l1e(n,e){const t=1-n;return 3*t*t*n*e}function c1e(n,e){return 3*(1-n)*n*n*e}function u1e(n,e){return n*n*n*e}function GS(n,e,t,r,i){return a1e(n,e)+l1e(n,t)+c1e(n,r)+u1e(n,i)}class w6 extends Jf{constructor(e=new nn,t=new nn,r=new nn,i=new nn){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=r,this.v3=i}getPoint(e,t=new nn){const r=t,i=this.v0,s=this.v1,a=this.v2,l=this.v3;return r.set(GS(e,i.x,s.x,a.x,l.x),GS(e,i.y,s.y,a.y,l.y)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class bte extends Jf{constructor(e=new Ze,t=new Ze,r=new Ze,i=new Ze){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=r,this.v3=i}getPoint(e,t=new Ze){const r=t,i=this.v0,s=this.v1,a=this.v2,l=this.v3;return r.set(GS(e,i.x,s.x,a.x,l.x),GS(e,i.y,s.y,a.y,l.y),GS(e,i.z,s.z,a.z,l.z)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class S6 extends Jf{constructor(e=new nn,t=new nn){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new nn){const r=t;return e===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new nn){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class wte extends Jf{constructor(e=new Ze,t=new Ze){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new Ze){const r=t;return e===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new Ze){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class A6 extends Jf{constructor(e=new nn,t=new nn,r=new nn){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=r}getPoint(e,t=new nn){const r=t,i=this.v0,s=this.v1,a=this.v2;return r.set(VS(e,i.x,s.x,a.x),VS(e,i.y,s.y,a.y)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class T6 extends Jf{constructor(e=new Ze,t=new Ze,r=new Ze){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=r}getPoint(e,t=new Ze){const r=t,i=this.v0,s=this.v1,a=this.v2;return r.set(VS(e,i.x,s.x,a.x),VS(e,i.y,s.y,a.y),VS(e,i.z,s.z,a.z)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class M6 extends Jf{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new nn){const r=t,i=this.points,s=(i.length-1)*e,a=Math.floor(s),l=s-a,o=i[a===0?a:a-1],h=i[a],d=i[a>i.length-2?i.length-1:a+1],m=i[a>i.length-3?i.length-1:a+2];return r.set(Gj(l,o.x,h.x,d.x,m.x),Gj(l,o.y,h.y,d.y,m.y)),r}copy(e){super.copy(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){const i=e.points[t];this.points.push(i.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,r=this.points.length;t<r;t++){const i=this.points[t];e.points.push(i.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){const i=e.points[t];this.points.push(new nn().fromArray(i))}return this}}var tP=Object.freeze({__proto__:null,ArcCurve:yte,CatmullRomCurve3:xte,CubicBezierCurve:w6,CubicBezierCurve3:bte,EllipseCurve:VL,LineCurve:S6,LineCurve3:wte,QuadraticBezierCurve:A6,QuadraticBezierCurve3:T6,SplineCurve:M6});class Ste extends Jf{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){const r=e.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new tP[r](t,e))}return this}getPoint(e,t){const r=e*this.getLength(),i=this.getCurveLengths();let s=0;for(;s<i.length;){if(i[s]>=r){const a=i[s]-r,l=this.curves[s],o=l.getLength(),h=o===0?0:1-a/o;return l.getPointAt(h,t)}s++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let r=0,i=this.curves.length;r<i;r++)t+=this.curves[r].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let r=0;r<=e;r++)t.push(this.getPoint(r/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let r;for(let i=0,s=this.curves;i<s.length;i++){const a=s[i],l=a.isEllipseCurve?e*2:a.isLineCurve||a.isLineCurve3?1:a.isSplineCurve?e*a.points.length:e,o=a.getPoints(l);for(let h=0;h<o.length;h++){const d=o[h];r&&r.equals(d)||(t.push(d),r=d)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,r=e.curves.length;t<r;t++){const i=e.curves[t];this.curves.push(i.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,r=this.curves.length;t<r;t++){const i=this.curves[t];e.curves.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,r=e.curves.length;t<r;t++){const i=e.curves[t];this.curves.push(new tP[i.type]().fromJSON(i))}return this}}let VA=class extends Ste{constructor(e){super(),this.type="Path",this.currentPoint=new nn,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,r=e.length;t<r;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const r=new S6(this.currentPoint.clone(),new nn(e,t));return this.curves.push(r),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,r,i){const s=new A6(this.currentPoint.clone(),new nn(e,t),new nn(r,i));return this.curves.push(s),this.currentPoint.set(r,i),this}bezierCurveTo(e,t,r,i,s,a){const l=new w6(this.currentPoint.clone(),new nn(e,t),new nn(r,i),new nn(s,a));return this.curves.push(l),this.currentPoint.set(s,a),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),r=new M6(t);return this.curves.push(r),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,r,i,s,a){const l=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(e+l,t+o,r,i,s,a),this}absarc(e,t,r,i,s,a){return this.absellipse(e,t,r,r,i,s,a),this}ellipse(e,t,r,i,s,a,l,o){const h=this.currentPoint.x,d=this.currentPoint.y;return this.absellipse(e+h,t+d,r,i,s,a,l,o),this}absellipse(e,t,r,i,s,a,l,o){const h=new VL(e,t,r,i,s,a,l,o);if(this.curves.length>0){const m=h.getPoint(0);m.equals(this.currentPoint)||this.lineTo(m.x,m.y)}this.curves.push(h);const d=h.getPoint(1);return this.currentPoint.copy(d),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}};class FT extends $r{constructor(e=[new nn(0,-.5),new nn(.5,0),new nn(0,.5)],t=12,r=0,i=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:i},t=Math.floor(t),i=ea(i,0,Math.PI*2);const s=[],a=[],l=[],o=[],h=[],d=1/t,m=new Ze,_=new nn,y=new Ze,T=new Ze,I=new Ze;let C=0,M=0;for(let B=0;B<=e.length-1;B++)switch(B){case 0:C=e[B+1].x-e[B].x,M=e[B+1].y-e[B].y,y.x=M*1,y.y=-C,y.z=M*0,I.copy(y),y.normalize(),o.push(y.x,y.y,y.z);break;case e.length-1:o.push(I.x,I.y,I.z);break;default:C=e[B+1].x-e[B].x,M=e[B+1].y-e[B].y,y.x=M*1,y.y=-C,y.z=M*0,T.copy(y),y.x+=I.x,y.y+=I.y,y.z+=I.z,y.normalize(),o.push(y.x,y.y,y.z),I.copy(T)}for(let B=0;B<=t;B++){const k=r+B*d*i,j=Math.sin(k),q=Math.cos(k);for(let Z=0;Z<=e.length-1;Z++){m.x=e[Z].x*j,m.y=e[Z].y,m.z=e[Z].x*q,a.push(m.x,m.y,m.z),_.x=B/t,_.y=Z/(e.length-1),l.push(_.x,_.y);const te=o[3*Z+0]*j,ie=o[3*Z+1],se=o[3*Z+0]*q;h.push(te,ie,se)}}for(let B=0;B<t;B++)for(let k=0;k<e.length-1;k++){const j=k+B*e.length,q=j,Z=j+e.length,te=j+e.length+1,ie=j+1;s.push(q,Z,ie),s.push(te,ie,Z)}this.setIndex(s),this.setAttribute("position",new ar(a,3)),this.setAttribute("uv",new ar(l,2)),this.setAttribute("normal",new ar(h,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new FT(e.points,e.segments,e.phiStart,e.phiLength)}}class GL extends FT{constructor(e=1,t=1,r=4,i=8){const s=new VA;s.absarc(0,-t/2,e,Math.PI*1.5,0),s.absarc(0,t/2,e,0,Math.PI*.5),super(s.getPoints(r),i),this.type="CapsuleGeometry",this.parameters={radius:e,length:t,capSegments:r,radialSegments:i}}static fromJSON(e){return new GL(e.radius,e.length,e.capSegments,e.radialSegments)}}class HL extends $r{constructor(e=1,t=32,r=0,i=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:i},t=Math.max(3,t);const s=[],a=[],l=[],o=[],h=new Ze,d=new nn;a.push(0,0,0),l.push(0,0,1),o.push(.5,.5);for(let m=0,_=3;m<=t;m++,_+=3){const y=r+m/t*i;h.x=e*Math.cos(y),h.y=e*Math.sin(y),a.push(h.x,h.y,h.z),l.push(0,0,1),d.x=(a[_]/e+1)/2,d.y=(a[_+1]/e+1)/2,o.push(d.x,d.y)}for(let m=1;m<=t;m++)s.push(m,m+1,0);this.setIndex(s),this.setAttribute("position",new ar(a,3)),this.setAttribute("normal",new ar(l,3)),this.setAttribute("uv",new ar(o,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new HL(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class mw extends $r{constructor(e=1,t=1,r=1,i=32,s=1,a=!1,l=0,o=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:i,heightSegments:s,openEnded:a,thetaStart:l,thetaLength:o};const h=this;i=Math.floor(i),s=Math.floor(s);const d=[],m=[],_=[],y=[];let T=0;const I=[],C=r/2;let M=0;B(),a===!1&&(e>0&&k(!0),t>0&&k(!1)),this.setIndex(d),this.setAttribute("position",new ar(m,3)),this.setAttribute("normal",new ar(_,3)),this.setAttribute("uv",new ar(y,2));function B(){const j=new Ze,q=new Ze;let Z=0;const te=(t-e)/r;for(let ie=0;ie<=s;ie++){const se=[],ae=ie/s,fe=ae*(t-e)+e;for(let Se=0;Se<=i;Se++){const Ee=Se/i,Re=Ee*o+l,qe=Math.sin(Re),Le=Math.cos(Re);q.x=fe*qe,q.y=-ae*r+C,q.z=fe*Le,m.push(q.x,q.y,q.z),j.set(qe,te,Le).normalize(),_.push(j.x,j.y,j.z),y.push(Ee,1-ae),se.push(T++)}I.push(se)}for(let ie=0;ie<i;ie++)for(let se=0;se<s;se++){const ae=I[se][ie],fe=I[se+1][ie],Se=I[se+1][ie+1],Ee=I[se][ie+1];d.push(ae,fe,Ee),d.push(fe,Se,Ee),Z+=6}h.addGroup(M,Z,0),M+=Z}function k(j){const q=T,Z=new nn,te=new Ze;let ie=0;const se=j===!0?e:t,ae=j===!0?1:-1;for(let Se=1;Se<=i;Se++)m.push(0,C*ae,0),_.push(0,ae,0),y.push(.5,.5),T++;const fe=T;for(let Se=0;Se<=i;Se++){const Re=Se/i*o+l,qe=Math.cos(Re),Le=Math.sin(Re);te.x=se*Le,te.y=C*ae,te.z=se*qe,m.push(te.x,te.y,te.z),_.push(0,ae,0),Z.x=qe*.5+.5,Z.y=Le*.5*ae+.5,y.push(Z.x,Z.y),T++}for(let Se=0;Se<i;Se++){const Ee=q+Se,Re=fe+Se;j===!0?d.push(Re,Re+1,Ee):d.push(Re+1,Re,Ee),ie+=3}h.addGroup(M,ie,j===!0?1:2),M+=ie}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new mw(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class jL extends mw{constructor(e=1,t=1,r=32,i=1,s=!1,a=0,l=Math.PI*2){super(0,e,t,r,i,s,a,l),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:r,heightSegments:i,openEnded:s,thetaStart:a,thetaLength:l}}static fromJSON(e){return new jL(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Tv extends $r{constructor(e=[],t=[],r=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:i};const s=[],a=[];l(i),h(r),d(),this.setAttribute("position",new ar(s,3)),this.setAttribute("normal",new ar(s.slice(),3)),this.setAttribute("uv",new ar(a,2)),i===0?this.computeVertexNormals():this.normalizeNormals();function l(B){const k=new Ze,j=new Ze,q=new Ze;for(let Z=0;Z<t.length;Z+=3)y(t[Z+0],k),y(t[Z+1],j),y(t[Z+2],q),o(k,j,q,B)}function o(B,k,j,q){const Z=q+1,te=[];for(let ie=0;ie<=Z;ie++){te[ie]=[];const se=B.clone().lerp(j,ie/Z),ae=k.clone().lerp(j,ie/Z),fe=Z-ie;for(let Se=0;Se<=fe;Se++)Se===0&&ie===Z?te[ie][Se]=se:te[ie][Se]=se.clone().lerp(ae,Se/fe)}for(let ie=0;ie<Z;ie++)for(let se=0;se<2*(Z-ie)-1;se++){const ae=Math.floor(se/2);se%2===0?(_(te[ie][ae+1]),_(te[ie+1][ae]),_(te[ie][ae])):(_(te[ie][ae+1]),_(te[ie+1][ae+1]),_(te[ie+1][ae]))}}function h(B){const k=new Ze;for(let j=0;j<s.length;j+=3)k.x=s[j+0],k.y=s[j+1],k.z=s[j+2],k.normalize().multiplyScalar(B),s[j+0]=k.x,s[j+1]=k.y,s[j+2]=k.z}function d(){const B=new Ze;for(let k=0;k<s.length;k+=3){B.x=s[k+0],B.y=s[k+1],B.z=s[k+2];const j=C(B)/2/Math.PI+.5,q=M(B)/Math.PI+.5;a.push(j,1-q)}T(),m()}function m(){for(let B=0;B<a.length;B+=6){const k=a[B+0],j=a[B+2],q=a[B+4],Z=Math.max(k,j,q),te=Math.min(k,j,q);Z>.9&&te<.1&&(k<.2&&(a[B+0]+=1),j<.2&&(a[B+2]+=1),q<.2&&(a[B+4]+=1))}}function _(B){s.push(B.x,B.y,B.z)}function y(B,k){const j=B*3;k.x=e[j+0],k.y=e[j+1],k.z=e[j+2]}function T(){const B=new Ze,k=new Ze,j=new Ze,q=new Ze,Z=new nn,te=new nn,ie=new nn;for(let se=0,ae=0;se<s.length;se+=9,ae+=6){B.set(s[se+0],s[se+1],s[se+2]),k.set(s[se+3],s[se+4],s[se+5]),j.set(s[se+6],s[se+7],s[se+8]),Z.set(a[ae+0],a[ae+1]),te.set(a[ae+2],a[ae+3]),ie.set(a[ae+4],a[ae+5]),q.copy(B).add(k).add(j).divideScalar(3);const fe=C(q);I(Z,ae+0,B,fe),I(te,ae+2,k,fe),I(ie,ae+4,j,fe)}}function I(B,k,j,q){q<0&&B.x===1&&(a[k]=B.x-1),j.x===0&&j.z===0&&(a[k]=q/2/Math.PI+.5)}function C(B){return Math.atan2(B.z,-B.x)}function M(B){return Math.atan2(-B.y,Math.sqrt(B.x*B.x+B.z*B.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Tv(e.vertices,e.indices,e.radius,e.details)}}class WL extends Tv{constructor(e=1,t=0){const r=(1+Math.sqrt(5))/2,i=1/r,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-r,0,-i,r,0,i,-r,0,i,r,-i,-r,0,-i,r,0,i,-r,0,i,r,0,-r,0,-i,r,0,-i,-r,0,i,r,0,i],a=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(s,a,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new WL(e.radius,e.detail)}}const YC=new Ze,KC=new Ze,S5=new Ze,JC=new U0;class Ate extends $r{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},e!==null){const i=Math.pow(10,4),s=Math.cos(Ry*t),a=e.getIndex(),l=e.getAttribute("position"),o=a?a.count:l.count,h=[0,0,0],d=["a","b","c"],m=new Array(3),_={},y=[];for(let T=0;T<o;T+=3){a?(h[0]=a.getX(T),h[1]=a.getX(T+1),h[2]=a.getX(T+2)):(h[0]=T,h[1]=T+1,h[2]=T+2);const{a:I,b:C,c:M}=JC;if(I.fromBufferAttribute(l,h[0]),C.fromBufferAttribute(l,h[1]),M.fromBufferAttribute(l,h[2]),JC.getNormal(S5),m[0]=`${Math.round(I.x*i)},${Math.round(I.y*i)},${Math.round(I.z*i)}`,m[1]=`${Math.round(C.x*i)},${Math.round(C.y*i)},${Math.round(C.z*i)}`,m[2]=`${Math.round(M.x*i)},${Math.round(M.y*i)},${Math.round(M.z*i)}`,!(m[0]===m[1]||m[1]===m[2]||m[2]===m[0]))for(let B=0;B<3;B++){const k=(B+1)%3,j=m[B],q=m[k],Z=JC[d[B]],te=JC[d[k]],ie=`${j}_${q}`,se=`${q}_${j}`;se in _&&_[se]?(S5.dot(_[se].normal)<=s&&(y.push(Z.x,Z.y,Z.z),y.push(te.x,te.y,te.z)),_[se]=null):ie in _||(_[ie]={index0:h[B],index1:h[k],normal:S5.clone()})}}for(const T in _)if(_[T]){const{index0:I,index1:C}=_[T];YC.fromBufferAttribute(l,I),KC.fromBufferAttribute(l,C),y.push(YC.x,YC.y,YC.z),y.push(KC.x,KC.y,KC.z)}this.setAttribute("position",new ar(y,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class Ly extends VA{constructor(e){super(e),this.uuid=Lu(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let r=0,i=this.holes.length;r<i;r++)t[r]=this.holes[r].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,r=e.holes.length;t<r;t++){const i=e.holes[t];this.holes.push(i.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,r=this.holes.length;t<r;t++){const i=this.holes[t];e.holes.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,r=e.holes.length;t<r;t++){const i=e.holes[t];this.holes.push(new VA().fromJSON(i))}return this}}const h1e={triangulate:function(n,e,t=2){const r=e&&e.length,i=r?e[0]*t:n.length;let s=Tte(n,0,i,t,!0);const a=[];if(!s||s.next===s.prev)return a;let l,o,h,d,m,_,y;if(r&&(s=g1e(n,e,s,t)),n.length>80*t){l=h=n[0],o=d=n[1];for(let T=t;T<i;T+=t)m=n[T],_=n[T+1],m<l&&(l=m),_<o&&(o=_),m>h&&(h=m),_>d&&(d=_);y=Math.max(h-l,d-o),y=y!==0?32767/y:0}return GA(s,a,t,l,o,y,0),a}};function Tte(n,e,t,r,i){let s,a;if(i===C1e(n,e,t,r)>0)for(s=e;s<t;s+=r)a=Hj(s,n[s],n[s+1],a);else for(s=t-r;s>=e;s-=r)a=Hj(s,n[s],n[s+1],a);return a&&XL(a,a.next)&&(jA(a),a=a.next),a}function Zy(n,e){if(!n)return n;e||(e=n);let t=n,r;do if(r=!1,!t.steiner&&(XL(t,t.next)||Uo(t.prev,t,t.next)===0)){if(jA(t),t=e=t.prev,t===t.next)break;r=!0}else t=t.next;while(r||t!==e);return e}function GA(n,e,t,r,i,s,a){if(!n)return;!a&&s&&b1e(n,r,i,s);let l=n,o,h;for(;n.prev!==n.next;){if(o=n.prev,h=n.next,s?d1e(n,r,i,s):f1e(n)){e.push(o.i/t|0),e.push(n.i/t|0),e.push(h.i/t|0),jA(n),n=h.next,l=h.next;continue}if(n=h,n===l){a?a===1?(n=p1e(Zy(n),e,t),GA(n,e,t,r,i,s,2)):a===2&&m1e(n,e,t,r,i,s):GA(Zy(n),e,t,r,i,s,1);break}}}function f1e(n){const e=n.prev,t=n,r=n.next;if(Uo(e,t,r)>=0)return!1;const i=e.x,s=t.x,a=r.x,l=e.y,o=t.y,h=r.y,d=i<s?i<a?i:a:s<a?s:a,m=l<o?l<h?l:h:o<h?o:h,_=i>s?i>a?i:a:s>a?s:a,y=l>o?l>h?l:h:o>h?o:h;let T=r.next;for(;T!==e;){if(T.x>=d&&T.x<=_&&T.y>=m&&T.y<=y&&cb(i,l,s,o,a,h,T.x,T.y)&&Uo(T.prev,T,T.next)>=0)return!1;T=T.next}return!0}function d1e(n,e,t,r){const i=n.prev,s=n,a=n.next;if(Uo(i,s,a)>=0)return!1;const l=i.x,o=s.x,h=a.x,d=i.y,m=s.y,_=a.y,y=l<o?l<h?l:h:o<h?o:h,T=d<m?d<_?d:_:m<_?m:_,I=l>o?l>h?l:h:o>h?o:h,C=d>m?d>_?d:_:m>_?m:_,M=eF(y,T,e,t,r),B=eF(I,C,e,t,r);let k=n.prevZ,j=n.nextZ;for(;k&&k.z>=M&&j&&j.z<=B;){if(k.x>=y&&k.x<=I&&k.y>=T&&k.y<=C&&k!==i&&k!==a&&cb(l,d,o,m,h,_,k.x,k.y)&&Uo(k.prev,k,k.next)>=0||(k=k.prevZ,j.x>=y&&j.x<=I&&j.y>=T&&j.y<=C&&j!==i&&j!==a&&cb(l,d,o,m,h,_,j.x,j.y)&&Uo(j.prev,j,j.next)>=0))return!1;j=j.nextZ}for(;k&&k.z>=M;){if(k.x>=y&&k.x<=I&&k.y>=T&&k.y<=C&&k!==i&&k!==a&&cb(l,d,o,m,h,_,k.x,k.y)&&Uo(k.prev,k,k.next)>=0)return!1;k=k.prevZ}for(;j&&j.z<=B;){if(j.x>=y&&j.x<=I&&j.y>=T&&j.y<=C&&j!==i&&j!==a&&cb(l,d,o,m,h,_,j.x,j.y)&&Uo(j.prev,j,j.next)>=0)return!1;j=j.nextZ}return!0}function p1e(n,e,t){let r=n;do{const i=r.prev,s=r.next.next;!XL(i,s)&&Mte(i,r,r.next,s)&&HA(i,s)&&HA(s,i)&&(e.push(i.i/t|0),e.push(r.i/t|0),e.push(s.i/t|0),jA(r),jA(r.next),r=n=s),r=r.next}while(r!==n);return Zy(r)}function m1e(n,e,t,r,i,s){let a=n;do{let l=a.next.next;for(;l!==a.prev;){if(a.i!==l.i&&A1e(a,l)){let o=Cte(a,l);a=Zy(a,a.next),o=Zy(o,o.next),GA(a,e,t,r,i,s,0),GA(o,e,t,r,i,s,0);return}l=l.next}a=a.next}while(a!==n)}function g1e(n,e,t,r){const i=[];let s,a,l,o,h;for(s=0,a=e.length;s<a;s++)l=e[s]*r,o=s<a-1?e[s+1]*r:n.length,h=Tte(n,l,o,r,!1),h===h.next&&(h.steiner=!0),i.push(S1e(h));for(i.sort(v1e),s=0;s<i.length;s++)t=_1e(i[s],t);return t}function v1e(n,e){return n.x-e.x}function _1e(n,e){const t=y1e(n,e);if(!t)return e;const r=Cte(t,n);return Zy(r,r.next),Zy(t,t.next)}function y1e(n,e){let t=e,r=-1/0,i;const s=n.x,a=n.y;do{if(a<=t.y&&a>=t.next.y&&t.next.y!==t.y){const _=t.x+(a-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(_<=s&&_>r&&(r=_,i=t.x<t.next.x?t:t.next,_===s))return i}t=t.next}while(t!==e);if(!i)return null;const l=i,o=i.x,h=i.y;let d=1/0,m;t=i;do s>=t.x&&t.x>=o&&s!==t.x&&cb(a<h?s:r,a,o,h,a<h?r:s,a,t.x,t.y)&&(m=Math.abs(a-t.y)/(s-t.x),HA(t,n)&&(m<d||m===d&&(t.x>i.x||t.x===i.x&&x1e(i,t)))&&(i=t,d=m)),t=t.next;while(t!==l);return i}function x1e(n,e){return Uo(n.prev,n,e.prev)<0&&Uo(e.next,n,n.next)<0}function b1e(n,e,t,r){let i=n;do i.z===0&&(i.z=eF(i.x,i.y,e,t,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==n);i.prevZ.nextZ=null,i.prevZ=null,w1e(i)}function w1e(n){let e,t,r,i,s,a,l,o,h=1;do{for(t=n,n=null,s=null,a=0;t;){for(a++,r=t,l=0,e=0;e<h&&(l++,r=r.nextZ,!!r);e++);for(o=h;l>0||o>0&&r;)l!==0&&(o===0||!r||t.z<=r.z)?(i=t,t=t.nextZ,l--):(i=r,r=r.nextZ,o--),s?s.nextZ=i:n=i,i.prevZ=s,s=i;t=r}s.nextZ=null,h*=2}while(a>1);return n}function eF(n,e,t,r,i){return n=(n-t)*i|0,e=(e-r)*i|0,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,n|e<<1}function S1e(n){let e=n,t=n;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==n);return t}function cb(n,e,t,r,i,s,a,l){return(i-a)*(e-l)>=(n-a)*(s-l)&&(n-a)*(r-l)>=(t-a)*(e-l)&&(t-a)*(s-l)>=(i-a)*(r-l)}function A1e(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!T1e(n,e)&&(HA(n,e)&&HA(e,n)&&M1e(n,e)&&(Uo(n.prev,n,e.prev)||Uo(n,e.prev,e))||XL(n,e)&&Uo(n.prev,n,n.next)>0&&Uo(e.prev,e,e.next)>0)}function Uo(n,e,t){return(e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y)}function XL(n,e){return n.x===e.x&&n.y===e.y}function Mte(n,e,t,r){const i=eE(Uo(n,e,t)),s=eE(Uo(n,e,r)),a=eE(Uo(t,r,n)),l=eE(Uo(t,r,e));return!!(i!==s&&a!==l||i===0&&QC(n,t,e)||s===0&&QC(n,r,e)||a===0&&QC(t,n,r)||l===0&&QC(t,e,r))}function QC(n,e,t){return e.x<=Math.max(n.x,t.x)&&e.x>=Math.min(n.x,t.x)&&e.y<=Math.max(n.y,t.y)&&e.y>=Math.min(n.y,t.y)}function eE(n){return n>0?1:n<0?-1:0}function T1e(n,e){let t=n;do{if(t.i!==n.i&&t.next.i!==n.i&&t.i!==e.i&&t.next.i!==e.i&&Mte(t,t.next,n,e))return!0;t=t.next}while(t!==n);return!1}function HA(n,e){return Uo(n.prev,n,n.next)<0?Uo(n,e,n.next)>=0&&Uo(n,n.prev,e)>=0:Uo(n,e,n.prev)<0||Uo(n,n.next,e)<0}function M1e(n,e){let t=n,r=!1;const i=(n.x+e.x)/2,s=(n.y+e.y)/2;do t.y>s!=t.next.y>s&&t.next.y!==t.y&&i<(t.next.x-t.x)*(s-t.y)/(t.next.y-t.y)+t.x&&(r=!r),t=t.next;while(t!==n);return r}function Cte(n,e){const t=new tF(n.i,n.x,n.y),r=new tF(e.i,e.x,e.y),i=n.next,s=e.prev;return n.next=e,e.prev=n,t.next=i,i.prev=t,r.next=t,t.prev=r,s.next=r,r.prev=s,r}function Hj(n,e,t,r){const i=new tF(n,e,t);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function jA(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function tF(n,e,t){this.i=n,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function C1e(n,e,t,r){let i=0;for(let s=e,a=t-r;s<t;s+=r)i+=(n[a]-n[s])*(n[s+1]+n[a+1]),a=s;return i}class sp{static area(e){const t=e.length;let r=0;for(let i=t-1,s=0;s<t;i=s++)r+=e[i].x*e[s].y-e[s].x*e[i].y;return r*.5}static isClockWise(e){return sp.area(e)<0}static triangulateShape(e,t){const r=[],i=[],s=[];jj(e),Wj(r,e);let a=e.length;t.forEach(jj);for(let o=0;o<t.length;o++)i.push(a),a+=t[o].length,Wj(r,t[o]);const l=h1e.triangulate(r,i);for(let o=0;o<l.length;o+=3)s.push(l.slice(o,o+3));return s}}function jj(n){const e=n.length;e>2&&n[e-1].equals(n[0])&&n.pop()}function Wj(n,e){for(let t=0;t<e.length;t++)n.push(e[t].x),n.push(e[t].y)}class $L extends $r{constructor(e=new Ly([new nn(.5,.5),new nn(-.5,.5),new nn(-.5,-.5),new nn(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const r=this,i=[],s=[];for(let l=0,o=e.length;l<o;l++){const h=e[l];a(h)}this.setAttribute("position",new ar(i,3)),this.setAttribute("uv",new ar(s,2)),this.computeVertexNormals();function a(l){const o=[],h=t.curveSegments!==void 0?t.curveSegments:12,d=t.steps!==void 0?t.steps:1,m=t.depth!==void 0?t.depth:1;let _=t.bevelEnabled!==void 0?t.bevelEnabled:!0,y=t.bevelThickness!==void 0?t.bevelThickness:.2,T=t.bevelSize!==void 0?t.bevelSize:y-.1,I=t.bevelOffset!==void 0?t.bevelOffset:0,C=t.bevelSegments!==void 0?t.bevelSegments:3;const M=t.extrudePath,B=t.UVGenerator!==void 0?t.UVGenerator:E1e;let k,j=!1,q,Z,te,ie;M&&(k=M.getSpacedPoints(d),j=!0,_=!1,q=M.computeFrenetFrames(d,!1),Z=new Ze,te=new Ze,ie=new Ze),_||(C=0,y=0,T=0,I=0);const se=l.extractPoints(h);let ae=se.shape;const fe=se.holes;if(!sp.isClockWise(ae)){ae=ae.reverse();for(let $e=0,mn=fe.length;$e<mn;$e++){const cn=fe[$e];sp.isClockWise(cn)&&(fe[$e]=cn.reverse())}}const Ee=sp.triangulateShape(ae,fe),Re=ae;for(let $e=0,mn=fe.length;$e<mn;$e++){const cn=fe[$e];ae=ae.concat(cn)}function qe($e,mn,cn){return mn||console.error("THREE.ExtrudeGeometry: vec does not exist"),$e.clone().addScaledVector(mn,cn)}const Le=ae.length,dt=Ee.length;function ye($e,mn,cn){let St,Jt,kn;const Vn=$e.x-mn.x,sn=$e.y-mn.y,ot=cn.x-$e.x,Ue=cn.y-$e.y,$t=Vn*Vn+sn*sn,An=Vn*Ue-sn*ot;if(Math.abs(An)>Number.EPSILON){const Sn=Math.sqrt($t),jt=Math.sqrt(ot*ot+Ue*Ue),mr=mn.x-sn/Sn,Un=mn.y+Vn/Sn,tr=cn.x-Ue/jt,Sr=cn.y+ot/jt,Ln=((tr-mr)*Ue-(Sr-Un)*ot)/(Vn*Ue-sn*ot);St=mr+Vn*Ln-$e.x,Jt=Un+sn*Ln-$e.y;const ir=St*St+Jt*Jt;if(ir<=2)return new nn(St,Jt);kn=Math.sqrt(ir/2)}else{let Sn=!1;Vn>Number.EPSILON?ot>Number.EPSILON&&(Sn=!0):Vn<-Number.EPSILON?ot<-Number.EPSILON&&(Sn=!0):Math.sign(sn)===Math.sign(Ue)&&(Sn=!0),Sn?(St=-sn,Jt=Vn,kn=Math.sqrt($t)):(St=Vn,Jt=sn,kn=Math.sqrt($t/2))}return new nn(St/kn,Jt/kn)}const Xe=[];for(let $e=0,mn=Re.length,cn=mn-1,St=$e+1;$e<mn;$e++,cn++,St++)cn===mn&&(cn=0),St===mn&&(St=0),Xe[$e]=ye(Re[$e],Re[cn],Re[St]);const He=[];let _t,wt=Xe.concat();for(let $e=0,mn=fe.length;$e<mn;$e++){const cn=fe[$e];_t=[];for(let St=0,Jt=cn.length,kn=Jt-1,Vn=St+1;St<Jt;St++,kn++,Vn++)kn===Jt&&(kn=0),Vn===Jt&&(Vn=0),_t[St]=ye(cn[St],cn[kn],cn[Vn]);He.push(_t),wt=wt.concat(_t)}for(let $e=0;$e<C;$e++){const mn=$e/C,cn=y*Math.cos(mn*Math.PI/2),St=T*Math.sin(mn*Math.PI/2)+I;for(let Jt=0,kn=Re.length;Jt<kn;Jt++){const Vn=qe(Re[Jt],Xe[Jt],St);rn(Vn.x,Vn.y,-cn)}for(let Jt=0,kn=fe.length;Jt<kn;Jt++){const Vn=fe[Jt];_t=He[Jt];for(let sn=0,ot=Vn.length;sn<ot;sn++){const Ue=qe(Vn[sn],_t[sn],St);rn(Ue.x,Ue.y,-cn)}}}const Gt=T+I;for(let $e=0;$e<Le;$e++){const mn=_?qe(ae[$e],wt[$e],Gt):ae[$e];j?(te.copy(q.normals[0]).multiplyScalar(mn.x),Z.copy(q.binormals[0]).multiplyScalar(mn.y),ie.copy(k[0]).add(te).add(Z),rn(ie.x,ie.y,ie.z)):rn(mn.x,mn.y,0)}for(let $e=1;$e<=d;$e++)for(let mn=0;mn<Le;mn++){const cn=_?qe(ae[mn],wt[mn],Gt):ae[mn];j?(te.copy(q.normals[$e]).multiplyScalar(cn.x),Z.copy(q.binormals[$e]).multiplyScalar(cn.y),ie.copy(k[$e]).add(te).add(Z),rn(ie.x,ie.y,ie.z)):rn(cn.x,cn.y,m/d*$e)}for(let $e=C-1;$e>=0;$e--){const mn=$e/C,cn=y*Math.cos(mn*Math.PI/2),St=T*Math.sin(mn*Math.PI/2)+I;for(let Jt=0,kn=Re.length;Jt<kn;Jt++){const Vn=qe(Re[Jt],Xe[Jt],St);rn(Vn.x,Vn.y,m+cn)}for(let Jt=0,kn=fe.length;Jt<kn;Jt++){const Vn=fe[Jt];_t=He[Jt];for(let sn=0,ot=Vn.length;sn<ot;sn++){const Ue=qe(Vn[sn],_t[sn],St);j?rn(Ue.x,Ue.y+k[d-1].y,k[d-1].x+cn):rn(Ue.x,Ue.y,m+cn)}}}at(),Ht();function at(){const $e=i.length/3;if(_){let mn=0,cn=Le*mn;for(let St=0;St<dt;St++){const Jt=Ee[St];jn(Jt[2]+cn,Jt[1]+cn,Jt[0]+cn)}mn=d+C*2,cn=Le*mn;for(let St=0;St<dt;St++){const Jt=Ee[St];jn(Jt[0]+cn,Jt[1]+cn,Jt[2]+cn)}}else{for(let mn=0;mn<dt;mn++){const cn=Ee[mn];jn(cn[2],cn[1],cn[0])}for(let mn=0;mn<dt;mn++){const cn=Ee[mn];jn(cn[0]+Le*d,cn[1]+Le*d,cn[2]+Le*d)}}r.addGroup($e,i.length/3-$e,0)}function Ht(){const $e=i.length/3;let mn=0;Qt(Re,mn),mn+=Re.length;for(let cn=0,St=fe.length;cn<St;cn++){const Jt=fe[cn];Qt(Jt,mn),mn+=Jt.length}r.addGroup($e,i.length/3-$e,1)}function Qt($e,mn){let cn=$e.length;for(;--cn>=0;){const St=cn;let Jt=cn-1;Jt<0&&(Jt=$e.length-1);for(let kn=0,Vn=d+C*2;kn<Vn;kn++){const sn=Le*kn,ot=Le*(kn+1),Ue=mn+St+sn,$t=mn+Jt+sn,An=mn+Jt+ot,Sn=mn+St+ot;Bn(Ue,$t,An,Sn)}}}function rn($e,mn,cn){o.push($e),o.push(mn),o.push(cn)}function jn($e,mn,cn){Tn($e),Tn(mn),Tn(cn);const St=i.length/3,Jt=B.generateTopUV(r,i,St-3,St-2,St-1);Pe(Jt[0]),Pe(Jt[1]),Pe(Jt[2])}function Bn($e,mn,cn,St){Tn($e),Tn(mn),Tn(St),Tn(mn),Tn(cn),Tn(St);const Jt=i.length/3,kn=B.generateSideWallUV(r,i,Jt-6,Jt-3,Jt-2,Jt-1);Pe(kn[0]),Pe(kn[1]),Pe(kn[3]),Pe(kn[1]),Pe(kn[2]),Pe(kn[3])}function Tn($e){i.push(o[$e*3+0]),i.push(o[$e*3+1]),i.push(o[$e*3+2])}function Pe($e){s.push($e.x),s.push($e.y)}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes,r=this.parameters.options;return I1e(t,r,e)}static fromJSON(e,t){const r=[];for(let s=0,a=e.shapes.length;s<a;s++){const l=t[e.shapes[s]];r.push(l)}const i=e.options.extrudePath;return i!==void 0&&(e.options.extrudePath=new tP[i.type]().fromJSON(i)),new $L(r,e.options)}}const E1e={generateTopUV:function(n,e,t,r,i){const s=e[t*3],a=e[t*3+1],l=e[r*3],o=e[r*3+1],h=e[i*3],d=e[i*3+1];return[new nn(s,a),new nn(l,o),new nn(h,d)]},generateSideWallUV:function(n,e,t,r,i,s){const a=e[t*3],l=e[t*3+1],o=e[t*3+2],h=e[r*3],d=e[r*3+1],m=e[r*3+2],_=e[i*3],y=e[i*3+1],T=e[i*3+2],I=e[s*3],C=e[s*3+1],M=e[s*3+2];return Math.abs(l-d)<Math.abs(a-h)?[new nn(a,1-o),new nn(h,1-m),new nn(_,1-T),new nn(I,1-M)]:[new nn(l,1-o),new nn(d,1-m),new nn(y,1-T),new nn(C,1-M)]}};function I1e(n,e,t){if(t.shapes=[],Array.isArray(n))for(let r=0,i=n.length;r<i;r++){const s=n[r];t.shapes.push(s.uuid)}else t.shapes.push(n.uuid);return t.options=Object.assign({},e),e.extrudePath!==void 0&&(t.options.extrudePath=e.extrudePath.toJSON()),t}class Yy extends Tv{constructor(e=1,t=0){const r=(1+Math.sqrt(5))/2,i=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(i,s,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Yy(e.radius,e.detail)}}class NT extends Tv{constructor(e=1,t=0){const r=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],i=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(r,i,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new NT(e.radius,e.detail)}}class qL extends $r{constructor(e=.5,t=1,r=32,i=1,s=0,a=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:i,thetaStart:s,thetaLength:a},r=Math.max(3,r),i=Math.max(1,i);const l=[],o=[],h=[],d=[];let m=e;const _=(t-e)/i,y=new Ze,T=new nn;for(let I=0;I<=i;I++){for(let C=0;C<=r;C++){const M=s+C/r*a;y.x=m*Math.cos(M),y.y=m*Math.sin(M),o.push(y.x,y.y,y.z),h.push(0,0,1),T.x=(y.x/t+1)/2,T.y=(y.y/t+1)/2,d.push(T.x,T.y)}m+=_}for(let I=0;I<i;I++){const C=I*(r+1);for(let M=0;M<r;M++){const B=M+C,k=B,j=B+r+1,q=B+r+2,Z=B+1;l.push(k,j,Z),l.push(j,q,Z)}}this.setIndex(l),this.setAttribute("position",new ar(o,3)),this.setAttribute("normal",new ar(h,3)),this.setAttribute("uv",new ar(d,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new qL(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class ZL extends $r{constructor(e=new Ly([new nn(0,.5),new nn(-.5,-.5),new nn(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const r=[],i=[],s=[],a=[];let l=0,o=0;if(Array.isArray(e)===!1)h(e);else for(let d=0;d<e.length;d++)h(e[d]),this.addGroup(l,o,d),l+=o,o=0;this.setIndex(r),this.setAttribute("position",new ar(i,3)),this.setAttribute("normal",new ar(s,3)),this.setAttribute("uv",new ar(a,2));function h(d){const m=i.length/3,_=d.extractPoints(t);let y=_.shape;const T=_.holes;sp.isClockWise(y)===!1&&(y=y.reverse());for(let C=0,M=T.length;C<M;C++){const B=T[C];sp.isClockWise(B)===!0&&(T[C]=B.reverse())}const I=sp.triangulateShape(y,T);for(let C=0,M=T.length;C<M;C++){const B=T[C];y=y.concat(B)}for(let C=0,M=y.length;C<M;C++){const B=y[C];i.push(B.x,B.y,0),s.push(0,0,1),a.push(B.x,B.y)}for(let C=0,M=I.length;C<M;C++){const B=I[C],k=B[0]+m,j=B[1]+m,q=B[2]+m;r.push(k,j,q),o+=3}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes;return R1e(t,e)}static fromJSON(e,t){const r=[];for(let i=0,s=e.shapes.length;i<s;i++){const a=t[e.shapes[i]];r.push(a)}return new ZL(r,e.curveSegments)}}function R1e(n,e){if(e.shapes=[],Array.isArray(n))for(let t=0,r=n.length;t<r;t++){const i=n[t];e.shapes.push(i.uuid)}else e.shapes.push(n.uuid);return e}class Lm extends $r{constructor(e=1,t=32,r=16,i=0,s=Math.PI*2,a=0,l=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:i,phiLength:s,thetaStart:a,thetaLength:l},t=Math.max(3,Math.floor(t)),r=Math.max(2,Math.floor(r));const o=Math.min(a+l,Math.PI);let h=0;const d=[],m=new Ze,_=new Ze,y=[],T=[],I=[],C=[];for(let M=0;M<=r;M++){const B=[],k=M/r;let j=0;M===0&&a===0?j=.5/t:M===r&&o===Math.PI&&(j=-.5/t);for(let q=0;q<=t;q++){const Z=q/t;m.x=-e*Math.cos(i+Z*s)*Math.sin(a+k*l),m.y=e*Math.cos(a+k*l),m.z=e*Math.sin(i+Z*s)*Math.sin(a+k*l),T.push(m.x,m.y,m.z),_.copy(m).normalize(),I.push(_.x,_.y,_.z),C.push(Z+j,1-k),B.push(h++)}d.push(B)}for(let M=0;M<r;M++)for(let B=0;B<t;B++){const k=d[M][B+1],j=d[M][B],q=d[M+1][B],Z=d[M+1][B+1];(M!==0||a>0)&&y.push(k,j,Z),(M!==r-1||o<Math.PI)&&y.push(j,q,Z)}this.setIndex(y),this.setAttribute("position",new ar(T,3)),this.setAttribute("normal",new ar(I,3)),this.setAttribute("uv",new ar(C,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Lm(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class YL extends Tv{constructor(e=1,t=0){const r=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],i=[2,1,0,0,3,2,1,3,0,2,3,1];super(r,i,e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new YL(e.radius,e.detail)}}class zT extends $r{constructor(e=1,t=.4,r=12,i=48,s=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:i,arc:s},r=Math.floor(r),i=Math.floor(i);const a=[],l=[],o=[],h=[],d=new Ze,m=new Ze,_=new Ze;for(let y=0;y<=r;y++)for(let T=0;T<=i;T++){const I=T/i*s,C=y/r*Math.PI*2;m.x=(e+t*Math.cos(C))*Math.cos(I),m.y=(e+t*Math.cos(C))*Math.sin(I),m.z=t*Math.sin(C),l.push(m.x,m.y,m.z),d.x=e*Math.cos(I),d.y=e*Math.sin(I),_.subVectors(m,d).normalize(),o.push(_.x,_.y,_.z),h.push(T/i),h.push(y/r)}for(let y=1;y<=r;y++)for(let T=1;T<=i;T++){const I=(i+1)*y+T-1,C=(i+1)*(y-1)+T-1,M=(i+1)*(y-1)+T,B=(i+1)*y+T;a.push(I,C,B),a.push(C,M,B)}this.setIndex(a),this.setAttribute("position",new ar(l,3)),this.setAttribute("normal",new ar(o,3)),this.setAttribute("uv",new ar(h,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new zT(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class KL extends $r{constructor(e=1,t=.4,r=64,i=8,s=2,a=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:r,radialSegments:i,p:s,q:a},r=Math.floor(r),i=Math.floor(i);const l=[],o=[],h=[],d=[],m=new Ze,_=new Ze,y=new Ze,T=new Ze,I=new Ze,C=new Ze,M=new Ze;for(let k=0;k<=r;++k){const j=k/r*s*Math.PI*2;B(j,s,a,e,y),B(j+.01,s,a,e,T),C.subVectors(T,y),M.addVectors(T,y),I.crossVectors(C,M),M.crossVectors(I,C),I.normalize(),M.normalize();for(let q=0;q<=i;++q){const Z=q/i*Math.PI*2,te=-t*Math.cos(Z),ie=t*Math.sin(Z);m.x=y.x+(te*M.x+ie*I.x),m.y=y.y+(te*M.y+ie*I.y),m.z=y.z+(te*M.z+ie*I.z),o.push(m.x,m.y,m.z),_.subVectors(m,y).normalize(),h.push(_.x,_.y,_.z),d.push(k/r),d.push(q/i)}}for(let k=1;k<=r;k++)for(let j=1;j<=i;j++){const q=(i+1)*(k-1)+(j-1),Z=(i+1)*k+(j-1),te=(i+1)*k+j,ie=(i+1)*(k-1)+j;l.push(q,Z,ie),l.push(Z,te,ie)}this.setIndex(l),this.setAttribute("position",new ar(o,3)),this.setAttribute("normal",new ar(h,3)),this.setAttribute("uv",new ar(d,2));function B(k,j,q,Z,te){const ie=Math.cos(k),se=Math.sin(k),ae=q/j*k,fe=Math.cos(ae);te.x=Z*(2+fe)*.5*ie,te.y=Z*(2+fe)*se*.5,te.z=Z*Math.sin(ae)*.5}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new KL(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class JL extends $r{constructor(e=new T6(new Ze(-1,-1,0),new Ze(-1,1,0),new Ze(1,1,0)),t=64,r=1,i=8,s=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:r,radialSegments:i,closed:s};const a=e.computeFrenetFrames(t,s);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;const l=new Ze,o=new Ze,h=new nn;let d=new Ze;const m=[],_=[],y=[],T=[];I(),this.setIndex(T),this.setAttribute("position",new ar(m,3)),this.setAttribute("normal",new ar(_,3)),this.setAttribute("uv",new ar(y,2));function I(){for(let k=0;k<t;k++)C(k);C(s===!1?t:0),B(),M()}function C(k){d=e.getPointAt(k/t,d);const j=a.normals[k],q=a.binormals[k];for(let Z=0;Z<=i;Z++){const te=Z/i*Math.PI*2,ie=Math.sin(te),se=-Math.cos(te);o.x=se*j.x+ie*q.x,o.y=se*j.y+ie*q.y,o.z=se*j.z+ie*q.z,o.normalize(),_.push(o.x,o.y,o.z),l.x=d.x+r*o.x,l.y=d.y+r*o.y,l.z=d.z+r*o.z,m.push(l.x,l.y,l.z)}}function M(){for(let k=1;k<=t;k++)for(let j=1;j<=i;j++){const q=(i+1)*(k-1)+(j-1),Z=(i+1)*k+(j-1),te=(i+1)*k+j,ie=(i+1)*(k-1)+j;T.push(q,Z,ie),T.push(Z,te,ie)}}function B(){for(let k=0;k<=t;k++)for(let j=0;j<=i;j++)h.x=k/t,h.y=j/i,y.push(h.x,h.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new JL(new tP[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class Ete extends $r{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const t=[],r=new Set,i=new Ze,s=new Ze;if(e.index!==null){const a=e.attributes.position,l=e.index;let o=e.groups;o.length===0&&(o=[{start:0,count:l.count,materialIndex:0}]);for(let h=0,d=o.length;h<d;++h){const m=o[h],_=m.start,y=m.count;for(let T=_,I=_+y;T<I;T+=3)for(let C=0;C<3;C++){const M=l.getX(T+C),B=l.getX(T+(C+1)%3);i.fromBufferAttribute(a,M),s.fromBufferAttribute(a,B),Xj(i,s,r)===!0&&(t.push(i.x,i.y,i.z),t.push(s.x,s.y,s.z))}}}else{const a=e.attributes.position;for(let l=0,o=a.count/3;l<o;l++)for(let h=0;h<3;h++){const d=3*l+h,m=3*l+(h+1)%3;i.fromBufferAttribute(a,d),s.fromBufferAttribute(a,m),Xj(i,s,r)===!0&&(t.push(i.x,i.y,i.z),t.push(s.x,s.y,s.z))}}this.setAttribute("position",new ar(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function Xj(n,e,t){const r=`${n.x},${n.y},${n.z}-${e.x},${e.y},${e.z}`,i=`${e.x},${e.y},${e.z}-${n.x},${n.y},${n.z}`;return t.has(r)===!0||t.has(i)===!0?!1:(t.add(r),t.add(i),!0)}var $j=Object.freeze({__proto__:null,BoxGeometry:mp,CapsuleGeometry:GL,CircleGeometry:HL,ConeGeometry:jL,CylinderGeometry:mw,DodecahedronGeometry:WL,EdgesGeometry:Ate,ExtrudeGeometry:$L,IcosahedronGeometry:Yy,LatheGeometry:FT,OctahedronGeometry:NT,PlaneGeometry:Jm,PolyhedronGeometry:Tv,RingGeometry:qL,ShapeGeometry:ZL,SphereGeometry:Lm,TetrahedronGeometry:YL,TorusGeometry:zT,TorusKnotGeometry:KL,TubeGeometry:JL,WireframeGeometry:Ete});class Ite extends _o{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Gn(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class Rte extends Eo{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class cp extends _o{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Gn(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Gn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Av,this.normalScale=new nn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Ou,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class jo extends cp{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new nn(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return ea(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Gn(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Gn(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Gn(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class UT extends _o{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Gn(16777215),this.specular=new Gn(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Gn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Av,this.normalScale=new nn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Ou,this.combine=MT,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Pte extends _o{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Gn(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Gn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Av,this.normalScale=new nn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class Lte extends _o{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Av,this.normalScale=new nn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class VT extends _o{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Gn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Gn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Av,this.normalScale=new nn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Ou,this.combine=MT,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Dte extends _o{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Gn(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Av,this.normalScale=new nn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class C6 extends Ta{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function gy(n,e,t){return!n||!t&&n.constructor===e?n:typeof e.BYTES_PER_ELEMENT=="number"?new e(n):Array.prototype.slice.call(n)}function Bte(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function kte(n){function e(i,s){return n[i]-n[s]}const t=n.length,r=new Array(t);for(let i=0;i!==t;++i)r[i]=i;return r.sort(e),r}function nF(n,e,t){const r=n.length,i=new n.constructor(r);for(let s=0,a=0;a!==r;++s){const l=t[s]*e;for(let o=0;o!==e;++o)i[a++]=n[l+o]}return i}function E6(n,e,t,r){let i=1,s=n[0];for(;s!==void 0&&s[r]===void 0;)s=n[i++];if(s===void 0)return;let a=s[r];if(a!==void 0)if(Array.isArray(a))do a=s[r],a!==void 0&&(e.push(s.time),t.push.apply(t,a)),s=n[i++];while(s!==void 0);else if(a.toArray!==void 0)do a=s[r],a!==void 0&&(e.push(s.time),a.toArray(t,t.length)),s=n[i++];while(s!==void 0);else do a=s[r],a!==void 0&&(e.push(s.time),t.push(a)),s=n[i++];while(s!==void 0)}function P1e(n,e,t,r,i=30){const s=n.clone();s.name=e;const a=[];for(let o=0;o<s.tracks.length;++o){const h=s.tracks[o],d=h.getValueSize(),m=[],_=[];for(let y=0;y<h.times.length;++y){const T=h.times[y]*i;if(!(T<t||T>=r)){m.push(h.times[y]);for(let I=0;I<d;++I)_.push(h.values[y*d+I])}}m.length!==0&&(h.times=gy(m,h.times.constructor),h.values=gy(_,h.values.constructor),a.push(h))}s.tracks=a;let l=1/0;for(let o=0;o<s.tracks.length;++o)l>s.tracks[o].times[0]&&(l=s.tracks[o].times[0]);for(let o=0;o<s.tracks.length;++o)s.tracks[o].shift(-1*l);return s.resetDuration(),s}function L1e(n,e=0,t=n,r=30){r<=0&&(r=30);const i=t.tracks.length,s=e/r;for(let a=0;a<i;++a){const l=t.tracks[a],o=l.ValueTypeName;if(o==="bool"||o==="string")continue;const h=n.tracks.find(function(M){return M.name===l.name&&M.ValueTypeName===o});if(h===void 0)continue;let d=0;const m=l.getValueSize();l.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(d=m/3);let _=0;const y=h.getValueSize();h.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(_=y/3);const T=l.times.length-1;let I;if(s<=l.times[0]){const M=d,B=m-d;I=l.values.slice(M,B)}else if(s>=l.times[T]){const M=T*m+d,B=M+m-d;I=l.values.slice(M,B)}else{const M=l.createInterpolant(),B=d,k=m-d;M.evaluate(s),I=M.resultBuffer.slice(B,k)}o==="quaternion"&&new Aa().fromArray(I).normalize().conjugate().toArray(I);const C=h.times.length;for(let M=0;M<C;++M){const B=M*y+_;if(o==="quaternion")Aa.multiplyQuaternionsFlat(h.values,B,I,0,h.values,B);else{const k=y-_*2;for(let j=0;j<k;++j)h.values[B+j]-=I[j]}}}return n.blendMode=l6,n}const D1e={convertArray:gy,isTypedArray:Bte,getKeyframeOrder:kte,sortedArray:nF,flattenJSON:E6,subclip:P1e,makeClipAdditive:L1e};class fx{constructor(e,t,r,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=i!==void 0?i:new t.constructor(r),this.sampleValues=t,this.valueSize=r,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let r=this._cachedIndex,i=t[r],s=t[r-1];e:{t:{let a;n:{r:if(!(e<i)){for(let l=r+2;;){if(i===void 0){if(e<s)break r;return r=t.length,this._cachedIndex=r,this.copySampleValue_(r-1)}if(r===l)break;if(s=i,i=t[++r],e<i)break t}a=t.length;break n}if(!(e>=s)){const l=t[1];e<l&&(r=2,s=l);for(let o=r-2;;){if(s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===o)break;if(i=s,s=t[--r-1],e>=s)break t}a=r,r=0;break n}break e}for(;r<a;){const l=r+a>>>1;e<t[l]?a=l:r=l+1}if(i=t[r],s=t[r-1],s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===void 0)return r=t.length,this._cachedIndex=r,this.copySampleValue_(r-1)}this._cachedIndex=r,this.intervalChanged_(r,s,i)}return this.interpolate_(r,s,e,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,r=this.sampleValues,i=this.valueSize,s=e*i;for(let a=0;a!==i;++a)t[a]=r[s+a];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class Ote extends fx{constructor(e,t,r,i){super(e,t,r,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:dy,endingEnd:dy}}intervalChanged_(e,t,r){const i=this.parameterPositions;let s=e-2,a=e+1,l=i[s],o=i[a];if(l===void 0)switch(this.getSettings_().endingStart){case py:s=e,l=2*t-r;break;case BA:s=i.length-2,l=t+i[s]-i[s+1];break;default:s=e,l=r}if(o===void 0)switch(this.getSettings_().endingEnd){case py:a=e,o=2*r-t;break;case BA:a=1,o=r+i[1]-i[0];break;default:a=e-1,o=t}const h=(r-t)*.5,d=this.valueSize;this._weightPrev=h/(t-l),this._weightNext=h/(o-r),this._offsetPrev=s*d,this._offsetNext=a*d}interpolate_(e,t,r,i){const s=this.resultBuffer,a=this.sampleValues,l=this.valueSize,o=e*l,h=o-l,d=this._offsetPrev,m=this._offsetNext,_=this._weightPrev,y=this._weightNext,T=(r-t)/(i-t),I=T*T,C=I*T,M=-_*C+2*_*I-_*T,B=(1+_)*C+(-1.5-2*_)*I+(-.5+_)*T+1,k=(-1-y)*C+(1.5+y)*I+.5*T,j=y*C-y*I;for(let q=0;q!==l;++q)s[q]=M*a[d+q]+B*a[h+q]+k*a[o+q]+j*a[m+q];return s}}class I6 extends fx{constructor(e,t,r,i){super(e,t,r,i)}interpolate_(e,t,r,i){const s=this.resultBuffer,a=this.sampleValues,l=this.valueSize,o=e*l,h=o-l,d=(r-t)/(i-t),m=1-d;for(let _=0;_!==l;++_)s[_]=a[h+_]*m+a[o+_]*d;return s}}class Fte extends fx{constructor(e,t,r,i){super(e,t,r,i)}interpolate_(e){return this.copySampleValue_(e-1)}}class Qf{constructor(e,t,r,i){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=gy(t,this.TimeBufferType),this.values=gy(r,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let r;if(t.toJSON!==this.toJSON)r=t.toJSON(e);else{r={name:e.name,times:gy(e.times,Array),values:gy(e.values,Array)};const i=e.getInterpolation();i!==e.DefaultInterpolation&&(r.interpolation=i)}return r.type=e.ValueTypeName,r}InterpolantFactoryMethodDiscrete(e){return new Fte(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new I6(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new Ote(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case $y:t=this.InterpolantFactoryMethodDiscrete;break;case lv:t=this.InterpolantFactoryMethodLinear;break;case PI:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(r);return console.warn("THREE.KeyframeTrack:",r),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return $y;case this.InterpolantFactoryMethodLinear:return lv;case this.InterpolantFactoryMethodSmooth:return PI}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let r=0,i=t.length;r!==i;++r)t[r]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let r=0,i=t.length;r!==i;++r)t[r]*=e}return this}trim(e,t){const r=this.times,i=r.length;let s=0,a=i-1;for(;s!==i&&r[s]<e;)++s;for(;a!==-1&&r[a]>t;)--a;if(++a,s!==0||a!==i){s>=a&&(a=Math.max(a,1),s=a-1);const l=this.getValueSize();this.times=r.slice(s,a),this.values=this.values.slice(s*l,a*l)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const r=this.times,i=this.values,s=r.length;s===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let a=null;for(let l=0;l!==s;l++){const o=r[l];if(typeof o=="number"&&isNaN(o)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,l,o),e=!1;break}if(a!==null&&a>o){console.error("THREE.KeyframeTrack: Out of order keys.",this,l,o,a),e=!1;break}a=o}if(i!==void 0&&Bte(i))for(let l=0,o=i.length;l!==o;++l){const h=i[l];if(isNaN(h)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,l,h),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),r=this.getValueSize(),i=this.getInterpolation()===PI,s=e.length-1;let a=1;for(let l=1;l<s;++l){let o=!1;const h=e[l],d=e[l+1];if(h!==d&&(l!==1||h!==e[0]))if(i)o=!0;else{const m=l*r,_=m-r,y=m+r;for(let T=0;T!==r;++T){const I=t[m+T];if(I!==t[_+T]||I!==t[y+T]){o=!0;break}}}if(o){if(l!==a){e[a]=e[l];const m=l*r,_=a*r;for(let y=0;y!==r;++y)t[_+y]=t[m+y]}++a}}if(s>0){e[a]=e[s];for(let l=s*r,o=a*r,h=0;h!==r;++h)t[o+h]=t[l+h];++a}return a!==e.length?(this.times=e.slice(0,a),this.values=t.slice(0,a*r)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),r=this.constructor,i=new r(this.name,e,t);return i.createInterpolant=this.createInterpolant,i}}Qf.prototype.TimeBufferType=Float32Array;Qf.prototype.ValueBufferType=Float32Array;Qf.prototype.DefaultInterpolation=lv;class dx extends Qf{constructor(e,t,r){super(e,t,r)}}dx.prototype.ValueTypeName="bool";dx.prototype.ValueBufferType=Array;dx.prototype.DefaultInterpolation=$y;dx.prototype.InterpolantFactoryMethodLinear=void 0;dx.prototype.InterpolantFactoryMethodSmooth=void 0;class R6 extends Qf{}R6.prototype.ValueTypeName="color";class jm extends Qf{}jm.prototype.ValueTypeName="number";class Nte extends fx{constructor(e,t,r,i){super(e,t,r,i)}interpolate_(e,t,r,i){const s=this.resultBuffer,a=this.sampleValues,l=this.valueSize,o=(r-t)/(i-t);let h=e*l;for(let d=h+l;h!==d;h+=4)Aa.slerpFlat(s,0,a,h-l,a,h,o);return s}}class Wm extends Qf{InterpolantFactoryMethodLinear(e){return new Nte(this.times,this.values,this.getValueSize(),e)}}Wm.prototype.ValueTypeName="quaternion";Wm.prototype.InterpolantFactoryMethodSmooth=void 0;class px extends Qf{constructor(e,t,r){super(e,t,r)}}px.prototype.ValueTypeName="string";px.prototype.ValueBufferType=Array;px.prototype.DefaultInterpolation=$y;px.prototype.InterpolantFactoryMethodLinear=void 0;px.prototype.InterpolantFactoryMethodSmooth=void 0;class Xm extends Qf{}Xm.prototype.ValueTypeName="vector";class Ky{constructor(e="",t=-1,r=[],i=LL){this.name=e,this.tracks=r,this.duration=t,this.blendMode=i,this.uuid=Lu(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],r=e.tracks,i=1/(e.fps||1);for(let a=0,l=r.length;a!==l;++a)t.push(k1e(r[a]).scale(i));const s=new this(e.name,e.duration,t,e.blendMode);return s.uuid=e.uuid,s}static toJSON(e){const t=[],r=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let s=0,a=r.length;s!==a;++s)t.push(Qf.toJSON(r[s]));return i}static CreateFromMorphTargetSequence(e,t,r,i){const s=t.length,a=[];for(let l=0;l<s;l++){let o=[],h=[];o.push((l+s-1)%s,l,(l+1)%s),h.push(0,1,0);const d=kte(o);o=nF(o,1,d),h=nF(h,1,d),!i&&o[0]===0&&(o.push(s),h.push(h[0])),a.push(new jm(".morphTargetInfluences["+t[l].name+"]",o,h).scale(1/r))}return new this(e,-1,a)}static findByName(e,t){let r=e;if(!Array.isArray(e)){const i=e;r=i.geometry&&i.geometry.animations||i.animations}for(let i=0;i<r.length;i++)if(r[i].name===t)return r[i];return null}static CreateClipsFromMorphTargetSequences(e,t,r){const i={},s=/^([\w-]*?)([\d]+)$/;for(let l=0,o=e.length;l<o;l++){const h=e[l],d=h.name.match(s);if(d&&d.length>1){const m=d[1];let _=i[m];_||(i[m]=_=[]),_.push(h)}}const a=[];for(const l in i)a.push(this.CreateFromMorphTargetSequence(l,i[l],t,r));return a}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const r=function(m,_,y,T,I){if(y.length!==0){const C=[],M=[];E6(y,C,M,T),C.length!==0&&I.push(new m(_,C,M))}},i=[],s=e.name||"default",a=e.fps||30,l=e.blendMode;let o=e.length||-1;const h=e.hierarchy||[];for(let m=0;m<h.length;m++){const _=h[m].keys;if(!(!_||_.length===0))if(_[0].morphTargets){const y={};let T;for(T=0;T<_.length;T++)if(_[T].morphTargets)for(let I=0;I<_[T].morphTargets.length;I++)y[_[T].morphTargets[I]]=-1;for(const I in y){const C=[],M=[];for(let B=0;B!==_[T].morphTargets.length;++B){const k=_[T];C.push(k.time),M.push(k.morphTarget===I?1:0)}i.push(new jm(".morphTargetInfluence["+I+"]",C,M))}o=y.length*a}else{const y=".bones["+t[m].name+"]";r(Xm,y+".position",_,"pos",i),r(Wm,y+".quaternion",_,"rot",i),r(Xm,y+".scale",_,"scl",i)}}return i.length===0?null:new this(s,o,i,l)}resetDuration(){const e=this.tracks;let t=0;for(let r=0,i=e.length;r!==i;++r){const s=this.tracks[r];t=Math.max(t,s.times[s.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function B1e(n){switch(n.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return jm;case"vector":case"vector2":case"vector3":case"vector4":return Xm;case"color":return R6;case"quaternion":return Wm;case"bool":case"boolean":return dx;case"string":return px}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+n)}function k1e(n){if(n.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=B1e(n.type);if(n.times===void 0){const t=[],r=[];E6(n.keys,t,r,"value"),n.times=t,n.values=r}return e.parse!==void 0?e.parse(n):new e(n.name,n.times,n.values,n.interpolation)}const Mm={enabled:!1,files:{},add:function(n,e){this.enabled!==!1&&(this.files[n]=e)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class GT{constructor(e,t,r){const i=this;let s=!1,a=0,l=0,o;const h=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(d){l++,s===!1&&i.onStart!==void 0&&i.onStart(d,a,l),s=!0},this.itemEnd=function(d){a++,i.onProgress!==void 0&&i.onProgress(d,a,l),a===l&&(s=!1,i.onLoad!==void 0&&i.onLoad())},this.itemError=function(d){i.onError!==void 0&&i.onError(d)},this.resolveURL=function(d){return o?o(d):d},this.setURLModifier=function(d){return o=d,this},this.addHandler=function(d,m){return h.push(d,m),this},this.removeHandler=function(d){const m=h.indexOf(d);return m!==-1&&h.splice(m,2),this},this.getHandler=function(d){for(let m=0,_=h.length;m<_;m+=2){const y=h[m],T=h[m+1];if(y.global&&(y.lastIndex=0),y.test(d))return T}return null}}}const P6=new GT;let Ea=class{constructor(e){this.manager=e!==void 0?e:P6,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const r=this;return new Promise(function(i,s){r.load(e,i,t,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}};Ea.DEFAULT_MATERIAL_NAME="__DEFAULT";const um={};class O1e extends Error{constructor(e,t){super(e),this.response=t}}class Wa extends Ea{constructor(e){super(e)}load(e,t,r,i){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=Mm.get(e);if(s!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(s),this.manager.itemEnd(e)},0),s;if(um[e]!==void 0){um[e].push({onLoad:t,onProgress:r,onError:i});return}um[e]=[],um[e].push({onLoad:t,onProgress:r,onError:i});const a=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),l=this.mimeType,o=this.responseType;fetch(a).then(h=>{if(h.status===200||h.status===0){if(h.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||h.body===void 0||h.body.getReader===void 0)return h;const d=um[e],m=h.body.getReader(),_=h.headers.get("X-File-Size")||h.headers.get("Content-Length"),y=_?parseInt(_):0,T=y!==0;let I=0;const C=new ReadableStream({start(M){B();function B(){m.read().then(({done:k,value:j})=>{if(k)M.close();else{I+=j.byteLength;const q=new ProgressEvent("progress",{lengthComputable:T,loaded:I,total:y});for(let Z=0,te=d.length;Z<te;Z++){const ie=d[Z];ie.onProgress&&ie.onProgress(q)}M.enqueue(j),B()}},k=>{M.error(k)})}}});return new Response(C)}else throw new O1e(`fetch for "${h.url}" responded with ${h.status}: ${h.statusText}`,h)}).then(h=>{switch(o){case"arraybuffer":return h.arrayBuffer();case"blob":return h.blob();case"document":return h.text().then(d=>new DOMParser().parseFromString(d,l));case"json":return h.json();default:if(l===void 0)return h.text();{const m=/charset="?([^;"\s]*)"?/i.exec(l),_=m&&m[1]?m[1].toLowerCase():void 0,y=new TextDecoder(_);return h.arrayBuffer().then(T=>y.decode(T))}}}).then(h=>{Mm.add(e,h);const d=um[e];delete um[e];for(let m=0,_=d.length;m<_;m++){const y=d[m];y.onLoad&&y.onLoad(h)}}).catch(h=>{const d=um[e];if(d===void 0)throw this.manager.itemError(e),h;delete um[e];for(let m=0,_=d.length;m<_;m++){const y=d[m];y.onError&&y.onError(h)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class F1e extends Ea{constructor(e){super(e)}load(e,t,r,i){const s=this,a=new Wa(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(l){try{t(s.parse(JSON.parse(l)))}catch(o){i?i(o):console.error(o),s.manager.itemError(e)}},r,i)}parse(e){const t=[];for(let r=0;r<e.length;r++){const i=Ky.parse(e[r]);t.push(i)}return t}}class N1e extends Ea{constructor(e){super(e)}load(e,t,r,i){const s=this,a=[],l=new UL,o=new Wa(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(s.withCredentials);let h=0;function d(m){o.load(e[m],function(_){const y=s.parse(_,!0);a[m]={width:y.width,height:y.height,format:y.format,mipmaps:y.mipmaps},h+=1,h===6&&(y.mipmapCount===1&&(l.minFilter=Co),l.image=a,l.format=y.format,l.needsUpdate=!0,t&&t(l))},r,i)}if(Array.isArray(e))for(let m=0,_=e.length;m<_;++m)d(m);else o.load(e,function(m){const _=s.parse(m,!0);if(_.isCubemap){const y=_.mipmaps.length/_.mipmapCount;for(let T=0;T<y;T++){a[T]={mipmaps:[]};for(let I=0;I<_.mipmapCount;I++)a[T].mipmaps.push(_.mipmaps[T*_.mipmapCount+I]),a[T].format=_.format,a[T].width=_.width,a[T].height=_.height}l.image=a}else l.image.width=_.width,l.image.height=_.height,l.mipmaps=_.mipmaps;_.mipmapCount===1&&(l.minFilter=Co),l.format=_.format,l.needsUpdate=!0,t&&t(l)},r,i);return l}}class WA extends Ea{constructor(e){super(e)}load(e,t,r,i){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,a=Mm.get(e);if(a!==void 0)return s.manager.itemStart(e),setTimeout(function(){t&&t(a),s.manager.itemEnd(e)},0),a;const l=UA("img");function o(){d(),Mm.add(e,this),t&&t(this),s.manager.itemEnd(e)}function h(m){d(),i&&i(m),s.manager.itemError(e),s.manager.itemEnd(e)}function d(){l.removeEventListener("load",o,!1),l.removeEventListener("error",h,!1)}return l.addEventListener("load",o,!1),l.addEventListener("error",h,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(l.crossOrigin=this.crossOrigin),s.manager.itemStart(e),l.src=e,l}}class zte extends Ea{constructor(e){super(e)}load(e,t,r,i){const s=new DT;s.colorSpace=Ao;const a=new WA(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);let l=0;function o(h){a.load(e[h],function(d){s.images[h]=d,l++,l===6&&(s.needsUpdate=!0,t&&t(s))},void 0,i)}for(let h=0;h<e.length;++h)o(h);return s}}class z1e extends Ea{constructor(e){super(e)}load(e,t,r,i){const s=this,a=new jf,l=new Wa(this.manager);return l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setPath(this.path),l.setWithCredentials(s.withCredentials),l.load(e,function(o){let h;try{h=s.parse(o)}catch(d){if(i!==void 0)i(d);else{console.error(d);return}}h.image!==void 0?a.image=h.image:h.data!==void 0&&(a.image.width=h.width,a.image.height=h.height,a.image.data=h.data),a.wrapS=h.wrapS!==void 0?h.wrapS:ru,a.wrapT=h.wrapT!==void 0?h.wrapT:ru,a.magFilter=h.magFilter!==void 0?h.magFilter:Co,a.minFilter=h.minFilter!==void 0?h.minFilter:Co,a.anisotropy=h.anisotropy!==void 0?h.anisotropy:1,h.colorSpace!==void 0&&(a.colorSpace=h.colorSpace),h.flipY!==void 0&&(a.flipY=h.flipY),h.format!==void 0&&(a.format=h.format),h.type!==void 0&&(a.type=h.type),h.mipmaps!==void 0&&(a.mipmaps=h.mipmaps,a.minFilter=iu),h.mipmapCount===1&&(a.minFilter=Co),h.generateMipmaps!==void 0&&(a.generateMipmaps=h.generateMipmaps),a.needsUpdate=!0,t&&t(a,h)},r,i),a}}class qf extends Ea{constructor(e){super(e)}load(e,t,r,i){const s=new Ws,a=new WA(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(l){s.image=l,s.needsUpdate=!0,t!==void 0&&t(s)},r,i),s}}class Mv extends Ii{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Gn(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(t.object.target=this.target.uuid),t}}class Ute extends Mv{constructor(e,t,r){super(e,r),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Ii.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Gn(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const A5=new Vr,qj=new Ze,Zj=new Ze;class L6{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new nn(512,512),this.map=null,this.mapPass=null,this.matrix=new Vr,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new BT,this._frameExtents=new nn(1,1),this._viewportCount=1,this._viewports=[new Es(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,r=this.matrix;qj.setFromMatrixPosition(e.matrixWorld),t.position.copy(qj),Zj.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(Zj),t.updateMatrixWorld(),A5.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(A5),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(A5)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class U1e extends L6{constructor(){super(new Qi(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,r=$b*2*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height,s=e.distance||t.far;(r!==t.fov||i!==t.aspect||s!==t.far)&&(t.fov=r,t.aspect=i,t.far=s,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class QL extends Mv{constructor(e,t,r=0,i=Math.PI/3,s=0,a=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Ii.DEFAULT_UP),this.updateMatrix(),this.target=new Ii,this.distance=r,this.angle=i,this.penumbra=s,this.decay=a,this.map=null,this.shadow=new U1e}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const Yj=new Vr,E2=new Ze,T5=new Ze;class V1e extends L6{constructor(){super(new Qi(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new nn(4,2),this._viewportCount=6,this._viewports=[new Es(2,1,1,1),new Es(0,1,1,1),new Es(3,1,1,1),new Es(1,1,1,1),new Es(3,0,1,1),new Es(1,0,1,1)],this._cubeDirections=[new Ze(1,0,0),new Ze(-1,0,0),new Ze(0,0,1),new Ze(0,0,-1),new Ze(0,1,0),new Ze(0,-1,0)],this._cubeUps=[new Ze(0,1,0),new Ze(0,1,0),new Ze(0,1,0),new Ze(0,1,0),new Ze(0,0,1),new Ze(0,0,-1)]}updateMatrices(e,t=0){const r=this.camera,i=this.matrix,s=e.distance||r.far;s!==r.far&&(r.far=s,r.updateProjectionMatrix()),E2.setFromMatrixPosition(e.matrixWorld),r.position.copy(E2),T5.copy(r.position),T5.add(this._cubeDirections[t]),r.up.copy(this._cubeUps[t]),r.lookAt(T5),r.updateMatrixWorld(),i.makeTranslation(-E2.x,-E2.y,-E2.z),Yj.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Yj)}}class ev extends Mv{constructor(e,t,r=0,i=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=r,this.decay=i,this.shadow=new V1e}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class G1e extends L6{constructor(){super(new Kf(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class Cv extends Mv{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Ii.DEFAULT_UP),this.updateMatrix(),this.target=new Ii,this.shadow=new G1e}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class mx extends Mv{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class Vte extends Mv{constructor(e,t,r=10,i=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=r,this.height=i}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class Gte{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new Ze)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const r=e.x,i=e.y,s=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.282095),t.addScaledVector(a[1],.488603*i),t.addScaledVector(a[2],.488603*s),t.addScaledVector(a[3],.488603*r),t.addScaledVector(a[4],1.092548*(r*i)),t.addScaledVector(a[5],1.092548*(i*s)),t.addScaledVector(a[6],.315392*(3*s*s-1)),t.addScaledVector(a[7],1.092548*(r*s)),t.addScaledVector(a[8],.546274*(r*r-i*i)),t}getIrradianceAt(e,t){const r=e.x,i=e.y,s=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.886227),t.addScaledVector(a[1],2*.511664*i),t.addScaledVector(a[2],2*.511664*s),t.addScaledVector(a[3],2*.511664*r),t.addScaledVector(a[4],2*.429043*r*i),t.addScaledVector(a[5],2*.429043*i*s),t.addScaledVector(a[6],.743125*s*s-.247708),t.addScaledVector(a[7],2*.429043*r*s),t.addScaledVector(a[8],.429043*(r*r-i*i)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let r=0;r<9;r++)this.coefficients[r].addScaledVector(e.coefficients[r],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let r=0;r<9;r++)this.coefficients[r].lerp(e.coefficients[r],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const r=this.coefficients;for(let i=0;i<9;i++)r[i].fromArray(e,t+i*3);return this}toArray(e=[],t=0){const r=this.coefficients;for(let i=0;i<9;i++)r[i].toArray(e,t+i*3);return e}static getBasisAt(e,t){const r=e.x,i=e.y,s=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*s,t[3]=.488603*r,t[4]=1.092548*r*i,t[5]=1.092548*i*s,t[6]=.315392*(3*s*s-1),t[7]=1.092548*r*s,t[8]=.546274*(r*r-i*i)}}class Hte extends Mv{constructor(e=new Gte,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class eD extends Ea{constructor(e){super(e),this.textures={}}load(e,t,r,i){const s=this,a=new Wa(s.manager);a.setPath(s.path),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(e,function(l){try{t(s.parse(JSON.parse(l)))}catch(o){i?i(o):console.error(o),s.manager.itemError(e)}},r,i)}parse(e){const t=this.textures;function r(s){return t[s]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",s),t[s]}const i=eD.createMaterialFromType(e.type);if(e.uuid!==void 0&&(i.uuid=e.uuid),e.name!==void 0&&(i.name=e.name),e.color!==void 0&&i.color!==void 0&&i.color.setHex(e.color),e.roughness!==void 0&&(i.roughness=e.roughness),e.metalness!==void 0&&(i.metalness=e.metalness),e.sheen!==void 0&&(i.sheen=e.sheen),e.sheenColor!==void 0&&(i.sheenColor=new Gn().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(i.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&i.emissive!==void 0&&i.emissive.setHex(e.emissive),e.specular!==void 0&&i.specular!==void 0&&i.specular.setHex(e.specular),e.specularIntensity!==void 0&&(i.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&i.specularColor!==void 0&&i.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(i.shininess=e.shininess),e.clearcoat!==void 0&&(i.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=e.clearcoatRoughness),e.dispersion!==void 0&&(i.dispersion=e.dispersion),e.iridescence!==void 0&&(i.iridescence=e.iridescence),e.iridescenceIOR!==void 0&&(i.iridescenceIOR=e.iridescenceIOR),e.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=e.iridescenceThicknessRange),e.transmission!==void 0&&(i.transmission=e.transmission),e.thickness!==void 0&&(i.thickness=e.thickness),e.attenuationDistance!==void 0&&(i.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&i.attenuationColor!==void 0&&i.attenuationColor.setHex(e.attenuationColor),e.anisotropy!==void 0&&(i.anisotropy=e.anisotropy),e.anisotropyRotation!==void 0&&(i.anisotropyRotation=e.anisotropyRotation),e.fog!==void 0&&(i.fog=e.fog),e.flatShading!==void 0&&(i.flatShading=e.flatShading),e.blending!==void 0&&(i.blending=e.blending),e.combine!==void 0&&(i.combine=e.combine),e.side!==void 0&&(i.side=e.side),e.shadowSide!==void 0&&(i.shadowSide=e.shadowSide),e.opacity!==void 0&&(i.opacity=e.opacity),e.transparent!==void 0&&(i.transparent=e.transparent),e.alphaTest!==void 0&&(i.alphaTest=e.alphaTest),e.alphaHash!==void 0&&(i.alphaHash=e.alphaHash),e.depthFunc!==void 0&&(i.depthFunc=e.depthFunc),e.depthTest!==void 0&&(i.depthTest=e.depthTest),e.depthWrite!==void 0&&(i.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(i.colorWrite=e.colorWrite),e.blendSrc!==void 0&&(i.blendSrc=e.blendSrc),e.blendDst!==void 0&&(i.blendDst=e.blendDst),e.blendEquation!==void 0&&(i.blendEquation=e.blendEquation),e.blendSrcAlpha!==void 0&&(i.blendSrcAlpha=e.blendSrcAlpha),e.blendDstAlpha!==void 0&&(i.blendDstAlpha=e.blendDstAlpha),e.blendEquationAlpha!==void 0&&(i.blendEquationAlpha=e.blendEquationAlpha),e.blendColor!==void 0&&i.blendColor!==void 0&&i.blendColor.setHex(e.blendColor),e.blendAlpha!==void 0&&(i.blendAlpha=e.blendAlpha),e.stencilWriteMask!==void 0&&(i.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(i.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(i.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(i.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(i.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(i.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(i.stencilZPass=e.stencilZPass),e.stencilWrite!==void 0&&(i.stencilWrite=e.stencilWrite),e.wireframe!==void 0&&(i.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(i.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(i.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(i.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(i.rotation=e.rotation),e.linewidth!==void 0&&(i.linewidth=e.linewidth),e.dashSize!==void 0&&(i.dashSize=e.dashSize),e.gapSize!==void 0&&(i.gapSize=e.gapSize),e.scale!==void 0&&(i.scale=e.scale),e.polygonOffset!==void 0&&(i.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(i.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(i.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(i.dithering=e.dithering),e.alphaToCoverage!==void 0&&(i.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(i.premultipliedAlpha=e.premultipliedAlpha),e.forceSinglePass!==void 0&&(i.forceSinglePass=e.forceSinglePass),e.visible!==void 0&&(i.visible=e.visible),e.toneMapped!==void 0&&(i.toneMapped=e.toneMapped),e.userData!==void 0&&(i.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?i.vertexColors=e.vertexColors>0:i.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const s in e.uniforms){const a=e.uniforms[s];switch(i.uniforms[s]={},a.type){case"t":i.uniforms[s].value=r(a.value);break;case"c":i.uniforms[s].value=new Gn().setHex(a.value);break;case"v2":i.uniforms[s].value=new nn().fromArray(a.value);break;case"v3":i.uniforms[s].value=new Ze().fromArray(a.value);break;case"v4":i.uniforms[s].value=new Es().fromArray(a.value);break;case"m3":i.uniforms[s].value=new bi().fromArray(a.value);break;case"m4":i.uniforms[s].value=new Vr().fromArray(a.value);break;default:i.uniforms[s].value=a.value}}if(e.defines!==void 0&&(i.defines=e.defines),e.vertexShader!==void 0&&(i.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(i.fragmentShader=e.fragmentShader),e.glslVersion!==void 0&&(i.glslVersion=e.glslVersion),e.extensions!==void 0)for(const s in e.extensions)i.extensions[s]=e.extensions[s];if(e.lights!==void 0&&(i.lights=e.lights),e.clipping!==void 0&&(i.clipping=e.clipping),e.size!==void 0&&(i.size=e.size),e.sizeAttenuation!==void 0&&(i.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(i.map=r(e.map)),e.matcap!==void 0&&(i.matcap=r(e.matcap)),e.alphaMap!==void 0&&(i.alphaMap=r(e.alphaMap)),e.bumpMap!==void 0&&(i.bumpMap=r(e.bumpMap)),e.bumpScale!==void 0&&(i.bumpScale=e.bumpScale),e.normalMap!==void 0&&(i.normalMap=r(e.normalMap)),e.normalMapType!==void 0&&(i.normalMapType=e.normalMapType),e.normalScale!==void 0){let s=e.normalScale;Array.isArray(s)===!1&&(s=[s,s]),i.normalScale=new nn().fromArray(s)}return e.displacementMap!==void 0&&(i.displacementMap=r(e.displacementMap)),e.displacementScale!==void 0&&(i.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(i.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(i.roughnessMap=r(e.roughnessMap)),e.metalnessMap!==void 0&&(i.metalnessMap=r(e.metalnessMap)),e.emissiveMap!==void 0&&(i.emissiveMap=r(e.emissiveMap)),e.emissiveIntensity!==void 0&&(i.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(i.specularMap=r(e.specularMap)),e.specularIntensityMap!==void 0&&(i.specularIntensityMap=r(e.specularIntensityMap)),e.specularColorMap!==void 0&&(i.specularColorMap=r(e.specularColorMap)),e.envMap!==void 0&&(i.envMap=r(e.envMap)),e.envMapRotation!==void 0&&i.envMapRotation.fromArray(e.envMapRotation),e.envMapIntensity!==void 0&&(i.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(i.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(i.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(i.lightMap=r(e.lightMap)),e.lightMapIntensity!==void 0&&(i.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(i.aoMap=r(e.aoMap)),e.aoMapIntensity!==void 0&&(i.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(i.gradientMap=r(e.gradientMap)),e.clearcoatMap!==void 0&&(i.clearcoatMap=r(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(i.clearcoatRoughnessMap=r(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(i.clearcoatNormalMap=r(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(i.clearcoatNormalScale=new nn().fromArray(e.clearcoatNormalScale)),e.iridescenceMap!==void 0&&(i.iridescenceMap=r(e.iridescenceMap)),e.iridescenceThicknessMap!==void 0&&(i.iridescenceThicknessMap=r(e.iridescenceThicknessMap)),e.transmissionMap!==void 0&&(i.transmissionMap=r(e.transmissionMap)),e.thicknessMap!==void 0&&(i.thicknessMap=r(e.thicknessMap)),e.anisotropyMap!==void 0&&(i.anisotropyMap=r(e.anisotropyMap)),e.sheenColorMap!==void 0&&(i.sheenColorMap=r(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(i.sheenRoughnessMap=r(e.sheenRoughnessMap)),i}setTextures(e){return this.textures=e,this}static createMaterialFromType(e){const t={ShadowMaterial:Ite,SpriteMaterial:OL,RawShaderMaterial:Rte,ShaderMaterial:Eo,PointsMaterial:su,MeshPhysicalMaterial:jo,MeshStandardMaterial:cp,MeshPhongMaterial:UT,MeshToonMaterial:Pte,MeshNormalMaterial:Lte,MeshLambertMaterial:VT,MeshDepthMaterial:_6,MeshDistanceMaterial:y6,MeshBasicMaterial:vo,MeshMatcapMaterial:Dte,LineDashedMaterial:C6,LineBasicMaterial:Ta,Material:_o};return new t[e]}}class cu{static decodeText(e){if(console.warn("THREE.LoaderUtils: decodeText() has been deprecated with r165 and will be removed with r175. Use TextDecoder instead."),typeof TextDecoder<"u")return new TextDecoder().decode(e);let t="";for(let r=0,i=e.length;r<i;r++)t+=String.fromCharCode(e[r]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class jte extends $r{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class Wte extends Ea{constructor(e){super(e)}load(e,t,r,i){const s=this,a=new Wa(s.manager);a.setPath(s.path),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(e,function(l){try{t(s.parse(JSON.parse(l)))}catch(o){i?i(o):console.error(o),s.manager.itemError(e)}},r,i)}parse(e){const t={},r={};function i(y,T){if(t[T]!==void 0)return t[T];const C=y.interleavedBuffers[T],M=s(y,C.buffer),B=ab(C.type,M),k=new dw(B,C.stride);return k.uuid=C.uuid,t[T]=k,k}function s(y,T){if(r[T]!==void 0)return r[T];const C=y.arrayBuffers[T],M=new Uint32Array(C).buffer;return r[T]=M,M}const a=e.isInstancedBufferGeometry?new jte:new $r,l=e.data.index;if(l!==void 0){const y=ab(l.type,l.array);a.setIndex(new Di(y,1))}const o=e.data.attributes;for(const y in o){const T=o[y];let I;if(T.isInterleavedBufferAttribute){const C=i(e.data,T.data);I=new Hm(C,T.itemSize,T.offset,T.normalized)}else{const C=ab(T.type,T.array),M=T.isInstancedBufferAttribute?cv:Di;I=new M(C,T.itemSize,T.normalized)}T.name!==void 0&&(I.name=T.name),T.usage!==void 0&&I.setUsage(T.usage),a.setAttribute(y,I)}const h=e.data.morphAttributes;if(h)for(const y in h){const T=h[y],I=[];for(let C=0,M=T.length;C<M;C++){const B=T[C];let k;if(B.isInterleavedBufferAttribute){const j=i(e.data,B.data);k=new Hm(j,B.itemSize,B.offset,B.normalized)}else{const j=ab(B.type,B.array);k=new Di(j,B.itemSize,B.normalized)}B.name!==void 0&&(k.name=B.name),I.push(k)}a.morphAttributes[y]=I}e.data.morphTargetsRelative&&(a.morphTargetsRelative=!0);const m=e.data.groups||e.data.drawcalls||e.data.offsets;if(m!==void 0)for(let y=0,T=m.length;y!==T;++y){const I=m[y];a.addGroup(I.start,I.count,I.materialIndex)}const _=e.data.boundingSphere;if(_!==void 0){const y=new Ze;_.center!==void 0&&y.fromArray(_.center),a.boundingSphere=new rl(y,_.radius)}return e.name&&(a.name=e.name),e.userData&&(a.userData=e.userData),a}}class H1e extends Ea{constructor(e){super(e)}load(e,t,r,i){const s=this,a=this.path===""?cu.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||a;const l=new Wa(this.manager);l.setPath(this.path),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(o){let h=null;try{h=JSON.parse(o)}catch(m){i!==void 0&&i(m),console.error("THREE:ObjectLoader: Can't parse "+e+".",m.message);return}const d=h.metadata;if(d===void 0||d.type===void 0||d.type.toLowerCase()==="geometry"){i!==void 0&&i(new Error("THREE.ObjectLoader: Can't load "+e)),console.error("THREE.ObjectLoader: Can't load "+e);return}s.parse(h,t)},r,i)}async loadAsync(e,t){const r=this,i=this.path===""?cu.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||i;const s=new Wa(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials);const a=await s.loadAsync(e,t),l=JSON.parse(a),o=l.metadata;if(o===void 0||o.type===void 0||o.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await r.parseAsync(l)}parse(e,t){const r=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),s=this.parseGeometries(e.geometries,i),a=this.parseImages(e.images,function(){t!==void 0&&t(h)}),l=this.parseTextures(e.textures,a),o=this.parseMaterials(e.materials,l),h=this.parseObject(e.object,s,o,l,r),d=this.parseSkeletons(e.skeletons,h);if(this.bindSkeletons(h,d),this.bindLightTargets(h),t!==void 0){let m=!1;for(const _ in a)if(a[_].data instanceof HTMLImageElement){m=!0;break}m===!1&&t(h)}return h}async parseAsync(e){const t=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),i=this.parseGeometries(e.geometries,r),s=await this.parseImagesAsync(e.images),a=this.parseTextures(e.textures,s),l=this.parseMaterials(e.materials,a),o=this.parseObject(e.object,i,l,a,t),h=this.parseSkeletons(e.skeletons,o);return this.bindSkeletons(o,h),this.bindLightTargets(o),o}parseShapes(e){const t={};if(e!==void 0)for(let r=0,i=e.length;r<i;r++){const s=new Ly().fromJSON(e[r]);t[s.uuid]=s}return t}parseSkeletons(e,t){const r={},i={};if(t.traverse(function(s){s.isBone&&(i[s.uuid]=s)}),e!==void 0)for(let s=0,a=e.length;s<a;s++){const l=new pw().fromJSON(e[s],i);r[l.uuid]=l}return r}parseGeometries(e,t){const r={};if(e!==void 0){const i=new Wte;for(let s=0,a=e.length;s<a;s++){let l;const o=e[s];switch(o.type){case"BufferGeometry":case"InstancedBufferGeometry":l=i.parse(o);break;default:o.type in $j?l=$j[o.type].fromJSON(o,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${o.type}"`)}l.uuid=o.uuid,o.name!==void 0&&(l.name=o.name),o.userData!==void 0&&(l.userData=o.userData),r[o.uuid]=l}}return r}parseMaterials(e,t){const r={},i={};if(e!==void 0){const s=new eD;s.setTextures(t);for(let a=0,l=e.length;a<l;a++){const o=e[a];r[o.uuid]===void 0&&(r[o.uuid]=s.parse(o)),i[o.uuid]=r[o.uuid]}}return i}parseAnimations(e){const t={};if(e!==void 0)for(let r=0;r<e.length;r++){const i=e[r],s=Ky.parse(i);t[s.uuid]=s}return t}parseImages(e,t){const r=this,i={};let s;function a(o){return r.manager.itemStart(o),s.load(o,function(){r.manager.itemEnd(o)},void 0,function(){r.manager.itemError(o),r.manager.itemEnd(o)})}function l(o){if(typeof o=="string"){const h=o,d=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(h)?h:r.resourcePath+h;return a(d)}else return o.data?{data:ab(o.type,o.data),width:o.width,height:o.height}:null}if(e!==void 0&&e.length>0){const o=new GT(t);s=new WA(o),s.setCrossOrigin(this.crossOrigin);for(let h=0,d=e.length;h<d;h++){const m=e[h],_=m.url;if(Array.isArray(_)){const y=[];for(let T=0,I=_.length;T<I;T++){const C=_[T],M=l(C);M!==null&&(M instanceof HTMLImageElement?y.push(M):y.push(new jf(M.data,M.width,M.height)))}i[m.uuid]=new my(y)}else{const y=l(m.url);i[m.uuid]=new my(y)}}}return i}async parseImagesAsync(e){const t=this,r={};let i;async function s(a){if(typeof a=="string"){const l=a,o=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(l)?l:t.resourcePath+l;return await i.loadAsync(o)}else return a.data?{data:ab(a.type,a.data),width:a.width,height:a.height}:null}if(e!==void 0&&e.length>0){i=new WA(this.manager),i.setCrossOrigin(this.crossOrigin);for(let a=0,l=e.length;a<l;a++){const o=e[a],h=o.url;if(Array.isArray(h)){const d=[];for(let m=0,_=h.length;m<_;m++){const y=h[m],T=await s(y);T!==null&&(T instanceof HTMLImageElement?d.push(T):d.push(new jf(T.data,T.width,T.height)))}r[o.uuid]=new my(d)}else{const d=await s(o.url);r[o.uuid]=new my(d)}}}return r}parseTextures(e,t){function r(s,a){return typeof s=="number"?s:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",s),a[s])}const i={};if(e!==void 0)for(let s=0,a=e.length;s<a;s++){const l=e[s];l.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',l.uuid),t[l.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",l.image);const o=t[l.image],h=o.data;let d;Array.isArray(h)?(d=new DT,h.length===6&&(d.needsUpdate=!0)):(h&&h.data?d=new jf:d=new Ws,h&&(d.needsUpdate=!0)),d.source=o,d.uuid=l.uuid,l.name!==void 0&&(d.name=l.name),l.mapping!==void 0&&(d.mapping=r(l.mapping,j1e)),l.channel!==void 0&&(d.channel=l.channel),l.offset!==void 0&&d.offset.fromArray(l.offset),l.repeat!==void 0&&d.repeat.fromArray(l.repeat),l.center!==void 0&&d.center.fromArray(l.center),l.rotation!==void 0&&(d.rotation=l.rotation),l.wrap!==void 0&&(d.wrapS=r(l.wrap[0],Kj),d.wrapT=r(l.wrap[1],Kj)),l.format!==void 0&&(d.format=l.format),l.internalFormat!==void 0&&(d.internalFormat=l.internalFormat),l.type!==void 0&&(d.type=l.type),l.colorSpace!==void 0&&(d.colorSpace=l.colorSpace),l.minFilter!==void 0&&(d.minFilter=r(l.minFilter,Jj)),l.magFilter!==void 0&&(d.magFilter=r(l.magFilter,Jj)),l.anisotropy!==void 0&&(d.anisotropy=l.anisotropy),l.flipY!==void 0&&(d.flipY=l.flipY),l.generateMipmaps!==void 0&&(d.generateMipmaps=l.generateMipmaps),l.premultiplyAlpha!==void 0&&(d.premultiplyAlpha=l.premultiplyAlpha),l.unpackAlignment!==void 0&&(d.unpackAlignment=l.unpackAlignment),l.compareFunction!==void 0&&(d.compareFunction=l.compareFunction),l.userData!==void 0&&(d.userData=l.userData),i[l.uuid]=d}return i}parseObject(e,t,r,i,s){let a;function l(_){return t[_]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",_),t[_]}function o(_){if(_!==void 0){if(Array.isArray(_)){const y=[];for(let T=0,I=_.length;T<I;T++){const C=_[T];r[C]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",C),y.push(r[C])}return y}return r[_]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",_),r[_]}}function h(_){return i[_]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",_),i[_]}let d,m;switch(e.type){case"Scene":a=new Al,e.background!==void 0&&(Number.isInteger(e.background)?a.background=new Gn(e.background):a.background=h(e.background)),e.environment!==void 0&&(a.environment=h(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?a.fog=new fw(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(a.fog=new kT(e.fog.color,e.fog.density)),e.fog.name!==""&&(a.fog.name=e.fog.name)),e.backgroundBlurriness!==void 0&&(a.backgroundBlurriness=e.backgroundBlurriness),e.backgroundIntensity!==void 0&&(a.backgroundIntensity=e.backgroundIntensity),e.backgroundRotation!==void 0&&a.backgroundRotation.fromArray(e.backgroundRotation),e.environmentIntensity!==void 0&&(a.environmentIntensity=e.environmentIntensity),e.environmentRotation!==void 0&&a.environmentRotation.fromArray(e.environmentRotation);break;case"PerspectiveCamera":a=new Qi(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(a.focus=e.focus),e.zoom!==void 0&&(a.zoom=e.zoom),e.filmGauge!==void 0&&(a.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(a.filmOffset=e.filmOffset),e.view!==void 0&&(a.view=Object.assign({},e.view));break;case"OrthographicCamera":a=new Kf(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(a.zoom=e.zoom),e.view!==void 0&&(a.view=Object.assign({},e.view));break;case"AmbientLight":a=new mx(e.color,e.intensity);break;case"DirectionalLight":a=new Cv(e.color,e.intensity),a.target=e.target||"";break;case"PointLight":a=new ev(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":a=new Vte(e.color,e.intensity,e.width,e.height);break;case"SpotLight":a=new QL(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay),a.target=e.target||"";break;case"HemisphereLight":a=new Ute(e.color,e.groundColor,e.intensity);break;case"LightProbe":a=new Hte().fromJSON(e);break;case"SkinnedMesh":d=l(e.geometry),m=o(e.material),a=new FL(d,m),e.bindMode!==void 0&&(a.bindMode=e.bindMode),e.bindMatrix!==void 0&&a.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(a.skeleton=e.skeleton);break;case"Mesh":d=l(e.geometry),m=o(e.material),a=new Ei(d,m);break;case"InstancedMesh":d=l(e.geometry),m=o(e.material);const _=e.count,y=e.instanceMatrix,T=e.instanceColor;a=new NL(d,m,_),a.instanceMatrix=new cv(new Float32Array(y.array),16),T!==void 0&&(a.instanceColor=new cv(new Float32Array(T.array),T.itemSize));break;case"BatchedMesh":d=l(e.geometry),m=o(e.material),a=new vte(e.maxInstanceCount,e.maxVertexCount,e.maxIndexCount,m),a.geometry=d,a.perObjectFrustumCulled=e.perObjectFrustumCulled,a.sortObjects=e.sortObjects,a._drawRanges=e.drawRanges,a._reservedRanges=e.reservedRanges,a._visibility=e.visibility,a._active=e.active,a._bounds=e.bounds.map(I=>{const C=new wl;C.min.fromArray(I.boxMin),C.max.fromArray(I.boxMax);const M=new rl;return M.radius=I.sphereRadius,M.center.fromArray(I.sphereCenter),{boxInitialized:I.boxInitialized,box:C,sphereInitialized:I.sphereInitialized,sphere:M}}),a._maxInstanceCount=e.maxInstanceCount,a._maxVertexCount=e.maxVertexCount,a._maxIndexCount=e.maxIndexCount,a._geometryInitialized=e.geometryInitialized,a._geometryCount=e.geometryCount,a._matricesTexture=h(e.matricesTexture.uuid),e.colorsTexture!==void 0&&(a._colorsTexture=h(e.colorsTexture.uuid));break;case"LOD":a=new gte;break;case"Line":a=new $f(l(e.geometry),o(e.material));break;case"LineLoop":a=new zL(l(e.geometry),o(e.material));break;case"LineSegments":a=new uu(l(e.geometry),o(e.material));break;case"PointCloud":case"Points":a=new wh(l(e.geometry),o(e.material));break;case"Sprite":a=new x6(o(e.material));break;case"Group":a=new Wl;break;case"Bone":a=new OT;break;default:a=new Ii}if(a.uuid=e.uuid,e.name!==void 0&&(a.name=e.name),e.matrix!==void 0?(a.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(a.matrixAutoUpdate=e.matrixAutoUpdate),a.matrixAutoUpdate&&a.matrix.decompose(a.position,a.quaternion,a.scale)):(e.position!==void 0&&a.position.fromArray(e.position),e.rotation!==void 0&&a.rotation.fromArray(e.rotation),e.quaternion!==void 0&&a.quaternion.fromArray(e.quaternion),e.scale!==void 0&&a.scale.fromArray(e.scale)),e.up!==void 0&&a.up.fromArray(e.up),e.castShadow!==void 0&&(a.castShadow=e.castShadow),e.receiveShadow!==void 0&&(a.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.intensity!==void 0&&(a.shadow.intensity=e.shadow.intensity),e.shadow.bias!==void 0&&(a.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(a.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(a.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&a.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(a.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(a.visible=e.visible),e.frustumCulled!==void 0&&(a.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(a.renderOrder=e.renderOrder),e.userData!==void 0&&(a.userData=e.userData),e.layers!==void 0&&(a.layers.mask=e.layers),e.children!==void 0){const _=e.children;for(let y=0;y<_.length;y++)a.add(this.parseObject(_[y],t,r,i,s))}if(e.animations!==void 0){const _=e.animations;for(let y=0;y<_.length;y++){const T=_[y];a.animations.push(s[T])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(a.autoUpdate=e.autoUpdate);const _=e.levels;for(let y=0;y<_.length;y++){const T=_[y],I=a.getObjectByProperty("uuid",T.object);I!==void 0&&a.addLevel(I,T.distance,T.hysteresis)}}return a}bindSkeletons(e,t){Object.keys(t).length!==0&&e.traverse(function(r){if(r.isSkinnedMesh===!0&&r.skeleton!==void 0){const i=t[r.skeleton];i===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",r.skeleton):r.bind(i,r.bindMatrix)}})}bindLightTargets(e){e.traverse(function(t){if(t.isDirectionalLight||t.isSpotLight){const r=t.target,i=e.getObjectByProperty("uuid",r);i!==void 0?t.target=i:t.target=new Ii}})}}const j1e={UVMapping:ML,CubeReflectionMapping:Um,CubeRefractionMapping:av,EquirectangularReflectionMapping:LA,EquirectangularRefractionMapping:DA,CubeUVReflectionMapping:uw},Kj={RepeatWrapping:Ph,ClampToEdgeWrapping:ru,MirroredRepeatWrapping:jy},Jj={NearestFilter:wa,NearestMipmapNearestFilter:CT,NearestMipmapLinearFilter:z0,LinearFilter:Co,LinearMipmapNearestFilter:Ey,LinearMipmapLinearFilter:iu};class D6 extends Ea{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,r,i){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,a=Mm.get(e);if(a!==void 0){if(s.manager.itemStart(e),a.then){a.then(h=>{t&&t(h),s.manager.itemEnd(e)}).catch(h=>{i&&i(h)});return}return setTimeout(function(){t&&t(a),s.manager.itemEnd(e)},0),a}const l={};l.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",l.headers=this.requestHeader;const o=fetch(e,l).then(function(h){return h.blob()}).then(function(h){return createImageBitmap(h,Object.assign(s.options,{colorSpaceConversion:"none"}))}).then(function(h){return Mm.add(e,h),t&&t(h),s.manager.itemEnd(e),h}).catch(function(h){i&&i(h),Mm.remove(e),s.manager.itemError(e),s.manager.itemEnd(e)});Mm.add(e,o),s.manager.itemStart(e)}}let tE;class B6{static getContext(){return tE===void 0&&(tE=new(window.AudioContext||window.webkitAudioContext)),tE}static setContext(e){tE=e}}class Xte extends Ea{constructor(e){super(e)}load(e,t,r,i){const s=this,a=new Wa(this.manager);a.setResponseType("arraybuffer"),a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(o){try{const h=o.slice(0);B6.getContext().decodeAudioData(h,function(m){t(m)}).catch(l)}catch(h){l(h)}},r,i);function l(o){i?i(o):console.error(o),s.manager.itemError(e)}}}const Qj=new Vr,eW=new Vr,w_=new Vr;class W1e{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Qi,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Qi,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,w_.copy(e.projectionMatrix);const i=t.eyeSep/2,s=i*t.near/t.focus,a=t.near*Math.tan(Ry*t.fov*.5)/t.zoom;let l,o;eW.elements[12]=-i,Qj.elements[12]=i,l=-a*t.aspect+s,o=a*t.aspect+s,w_.elements[0]=2*t.near/(o-l),w_.elements[8]=(o+l)/(o-l),this.cameraL.projectionMatrix.copy(w_),l=-a*t.aspect-s,o=a*t.aspect-s,w_.elements[0]=2*t.near/(o-l),w_.elements[8]=(o+l)/(o-l),this.cameraR.projectionMatrix.copy(w_)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(eW),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(Qj)}}class Qm{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=tW(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=tW();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function tW(){return(typeof performance>"u"?Date:performance).now()}const S_=new Ze,nW=new Aa,X1e=new Ze,A_=new Ze;class $te extends Ii{constructor(){super(),this.type="AudioListener",this.context=B6.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Qm}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,r=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(S_,nW,X1e),A_.set(0,0,-1).applyQuaternion(nW),t.positionX){const i=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(S_.x,i),t.positionY.linearRampToValueAtTime(S_.y,i),t.positionZ.linearRampToValueAtTime(S_.z,i),t.forwardX.linearRampToValueAtTime(A_.x,i),t.forwardY.linearRampToValueAtTime(A_.y,i),t.forwardZ.linearRampToValueAtTime(A_.z,i),t.upX.linearRampToValueAtTime(r.x,i),t.upY.linearRampToValueAtTime(r.y,i),t.upZ.linearRampToValueAtTime(r.z,i)}else t.setPosition(S_.x,S_.y,S_.z),t.setOrientation(A_.x,A_.y,A_.z,r.x,r.y,r.z)}}let qte=class extends Ii{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){return this.detune=e,this.isPlaying===!0&&this.source.detune!==void 0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}};const T_=new Ze,rW=new Aa,$1e=new Ze,M_=new Ze;class Zte extends qte{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,r){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=r,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(T_,rW,$1e),M_.set(0,0,1).applyQuaternion(rW);const t=this.panner;if(t.positionX){const r=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(T_.x,r),t.positionY.linearRampToValueAtTime(T_.y,r),t.positionZ.linearRampToValueAtTime(T_.z,r),t.orientationX.linearRampToValueAtTime(M_.x,r),t.orientationY.linearRampToValueAtTime(M_.y,r),t.orientationZ.linearRampToValueAtTime(M_.z,r)}else t.setPosition(T_.x,T_.y,T_.z),t.setOrientation(M_.x,M_.y,M_.z)}}class q1e{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let r=0;r<t.length;r++)e+=t[r];return e/t.length}}class Yte{constructor(e,t,r){this.binding=e,this.valueSize=r;let i,s,a;switch(t){case"quaternion":i=this._slerp,s=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(r*6),this._workIndex=5;break;case"string":case"bool":i=this._select,s=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(r*5);break;default:i=this._lerp,s=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(r*5)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=s,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const r=this.buffer,i=this.valueSize,s=e*i+i;let a=this.cumulativeWeight;if(a===0){for(let l=0;l!==i;++l)r[s+l]=r[l];a=t}else{a+=t;const l=t/a;this._mixBufferRegion(r,s,0,l,i)}this.cumulativeWeight=a}accumulateAdditive(e){const t=this.buffer,r=this.valueSize,i=r*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,i,0,e,r),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,r=this.buffer,i=e*t+t,s=this.cumulativeWeight,a=this.cumulativeWeightAdditive,l=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1){const o=t*this._origIndex;this._mixBufferRegion(r,i,o,1-s,t)}a>0&&this._mixBufferRegionAdditive(r,i,this._addIndex*t,1,t);for(let o=t,h=t+t;o!==h;++o)if(r[o]!==r[o+t]){l.setValue(r,i);break}}saveOriginalState(){const e=this.binding,t=this.buffer,r=this.valueSize,i=r*this._origIndex;e.getValue(t,i);for(let s=r,a=i;s!==a;++s)t[s]=t[i+s%r];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let r=e;r<t;r++)this.buffer[r]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let r=0;r<this.valueSize;r++)this.buffer[t+r]=this.buffer[e+r]}_select(e,t,r,i,s){if(i>=.5)for(let a=0;a!==s;++a)e[t+a]=e[r+a]}_slerp(e,t,r,i){Aa.slerpFlat(e,t,e,t,e,r,i)}_slerpAdditive(e,t,r,i,s){const a=this._workIndex*s;Aa.multiplyQuaternionsFlat(e,a,e,t,e,r),Aa.slerpFlat(e,t,e,t,e,a,i)}_lerp(e,t,r,i,s){const a=1-i;for(let l=0;l!==s;++l){const o=t+l;e[o]=e[o]*a+e[r+l]*i}}_lerpAdditive(e,t,r,i,s){for(let a=0;a!==s;++a){const l=t+a;e[l]=e[l]+e[r+a]*i}}}const k6="\\[\\]\\.:\\/",Z1e=new RegExp("["+k6+"]","g"),O6="[^"+k6+"]",Y1e="[^"+k6.replace("\\.","")+"]",K1e=/((?:WC+[\/:])*)/.source.replace("WC",O6),J1e=/(WCOD+)?/.source.replace("WCOD",Y1e),Q1e=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",O6),ebe=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",O6),tbe=new RegExp("^"+K1e+J1e+Q1e+ebe+"$"),nbe=["material","materials","bones","map"];class rbe{constructor(e,t,r){const i=r||Ji.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}getValue(e,t){this.bind();const r=this._targetGroup.nCachedObjects_,i=this._bindings[r];i!==void 0&&i.getValue(e,t)}setValue(e,t){const r=this._bindings;for(let i=this._targetGroup.nCachedObjects_,s=r.length;i!==s;++i)r[i].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].unbind()}}class Ji{constructor(e,t,r){this.path=t,this.parsedPath=r||Ji.parseTrackName(t),this.node=Ji.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,r){return e&&e.isAnimationObjectGroup?new Ji.Composite(e,t,r):new Ji(e,t,r)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(Z1e,"")}static parseTrackName(e){const t=tbe.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const r={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=r.nodeName&&r.nodeName.lastIndexOf(".");if(i!==void 0&&i!==-1){const s=r.nodeName.substring(i+1);nbe.indexOf(s)!==-1&&(r.nodeName=r.nodeName.substring(0,i),r.objectName=s)}if(r.propertyName===null||r.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return r}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const r=e.skeleton.getBoneByName(t);if(r!==void 0)return r}if(e.children){const r=function(s){for(let a=0;a<s.length;a++){const l=s[a];if(l.name===t||l.uuid===t)return l;const o=r(l.children);if(o)return o}return null},i=r(e.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const r=this.resolvedProperty;for(let i=0,s=r.length;i!==s;++i)e[t++]=r[i]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const r=this.resolvedProperty;for(let i=0,s=r.length;i!==s;++i)r[i]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const r=this.resolvedProperty;for(let i=0,s=r.length;i!==s;++i)r[i]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const r=this.resolvedProperty;for(let i=0,s=r.length;i!==s;++i)r[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,r=t.objectName,i=t.propertyName;let s=t.propertyIndex;if(e||(e=Ji.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(r){let h=t.objectIndex;switch(r){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let d=0;d<e.length;d++)if(e[d].name===h){h=d;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[r]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[r]}if(h!==void 0){if(e[h]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[h]}}const a=e[i];if(a===void 0){const h=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+h+"."+i+" but it wasn't found.",e);return}let l=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?l=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(l=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(s!==void 0){if(i==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[s]!==void 0&&(s=e.morphTargetDictionary[s])}o=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=s}else a.fromArray!==void 0&&a.toArray!==void 0?(o=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(o=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=i;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][l]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Ji.Composite=rbe;Ji.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};Ji.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};Ji.prototype.GetterByBindingType=[Ji.prototype._getValue_direct,Ji.prototype._getValue_array,Ji.prototype._getValue_arrayElement,Ji.prototype._getValue_toArray];Ji.prototype.SetterByBindingTypeAndVersioning=[[Ji.prototype._setValue_direct,Ji.prototype._setValue_direct_setNeedsUpdate,Ji.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Ji.prototype._setValue_array,Ji.prototype._setValue_array_setNeedsUpdate,Ji.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Ji.prototype._setValue_arrayElement,Ji.prototype._setValue_arrayElement_setNeedsUpdate,Ji.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Ji.prototype._setValue_fromArray,Ji.prototype._setValue_fromArray_setNeedsUpdate,Ji.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class ibe{constructor(){this.isAnimationObjectGroup=!0,this.uuid=Lu(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let r=0,i=arguments.length;r!==i;++r)e[arguments[r].uuid]=r;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,r=this._paths,i=this._parsedPaths,s=this._bindings,a=s.length;let l,o=e.length,h=this.nCachedObjects_;for(let d=0,m=arguments.length;d!==m;++d){const _=arguments[d],y=_.uuid;let T=t[y];if(T===void 0){T=o++,t[y]=T,e.push(_);for(let I=0,C=a;I!==C;++I)s[I].push(new Ji(_,r[I],i[I]))}else if(T<h){l=e[T];const I=--h,C=e[I];t[C.uuid]=T,e[T]=C,t[y]=I,e[I]=_;for(let M=0,B=a;M!==B;++M){const k=s[M],j=k[I];let q=k[T];k[T]=j,q===void 0&&(q=new Ji(_,r[M],i[M])),k[I]=q}}else e[T]!==l&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=h}remove(){const e=this._objects,t=this._indicesByUUID,r=this._bindings,i=r.length;let s=this.nCachedObjects_;for(let a=0,l=arguments.length;a!==l;++a){const o=arguments[a],h=o.uuid,d=t[h];if(d!==void 0&&d>=s){const m=s++,_=e[m];t[_.uuid]=d,e[d]=_,t[h]=m,e[m]=o;for(let y=0,T=i;y!==T;++y){const I=r[y],C=I[m],M=I[d];I[d]=C,I[m]=M}}}this.nCachedObjects_=s}uncache(){const e=this._objects,t=this._indicesByUUID,r=this._bindings,i=r.length;let s=this.nCachedObjects_,a=e.length;for(let l=0,o=arguments.length;l!==o;++l){const h=arguments[l],d=h.uuid,m=t[d];if(m!==void 0)if(delete t[d],m<s){const _=--s,y=e[_],T=--a,I=e[T];t[y.uuid]=m,e[m]=y,t[I.uuid]=_,e[_]=I,e.pop();for(let C=0,M=i;C!==M;++C){const B=r[C],k=B[_],j=B[T];B[m]=k,B[_]=j,B.pop()}}else{const _=--a,y=e[_];_>0&&(t[y.uuid]=m),e[m]=y,e.pop();for(let T=0,I=i;T!==I;++T){const C=r[T];C[m]=C[_],C.pop()}}}this.nCachedObjects_=s}subscribe_(e,t){const r=this._bindingsIndicesByPath;let i=r[e];const s=this._bindings;if(i!==void 0)return s[i];const a=this._paths,l=this._parsedPaths,o=this._objects,h=o.length,d=this.nCachedObjects_,m=new Array(h);i=s.length,r[e]=i,a.push(e),l.push(t),s.push(m);for(let _=d,y=o.length;_!==y;++_){const T=o[_];m[_]=new Ji(T,e,t)}return m}unsubscribe_(e){const t=this._bindingsIndicesByPath,r=t[e];if(r!==void 0){const i=this._paths,s=this._parsedPaths,a=this._bindings,l=a.length-1,o=a[l],h=e[l];t[h]=r,a[r]=o,a.pop(),s[r]=s[l],s.pop(),i[r]=i[l],i.pop()}}}class Kte{constructor(e,t,r=null,i=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=r,this.blendMode=i;const s=t.tracks,a=s.length,l=new Array(a),o={endingStart:dy,endingEnd:dy};for(let h=0;h!==a;++h){const d=s[h].createInterpolant(null);l[h]=d,d.settings=o}this._interpolantSettings=o,this._interpolants=l,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Gee,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,r){if(e.fadeOut(t),this.fadeIn(t),r){const i=this._clip.duration,s=e._clip.duration,a=s/i,l=i/s;e.warp(1,a,t),this.warp(l,1,t)}return this}crossFadeTo(e,t,r){return e.crossFadeFrom(this,t,r)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,r){const i=this._mixer,s=i.time,a=this.timeScale;let l=this._timeScaleInterpolant;l===null&&(l=i._lendControlInterpolant(),this._timeScaleInterpolant=l);const o=l.parameterPositions,h=l.sampleValues;return o[0]=s,o[1]=s+r,h[0]=e/a,h[1]=t/a,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,r,i){if(!this.enabled){this._updateWeight(e);return}const s=this._startTime;if(s!==null){const o=(e-s)*r;o<0||r===0?t=0:(this._startTime=null,t=r*o)}t*=this._updateTimeScale(e);const a=this._updateTime(t),l=this._updateWeight(e);if(l>0){const o=this._interpolants,h=this._propertyBindings;switch(this.blendMode){case l6:for(let d=0,m=o.length;d!==m;++d)o[d].evaluate(a),h[d].accumulateAdditive(l);break;case LL:default:for(let d=0,m=o.length;d!==m;++d)o[d].evaluate(a),h[d].accumulate(i,l)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const r=this._weightInterpolant;if(r!==null){const i=r.evaluate(e)[0];t*=i,e>r.parameterPositions[1]&&(this.stopFading(),i===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const r=this._timeScaleInterpolant;if(r!==null){const i=r.evaluate(e)[0];t*=i,e>r.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,r=this.loop;let i=this.time+e,s=this._loopCount;const a=r===Hee;if(e===0)return s===-1?i:a&&(s&1)===1?t-i:i;if(r===Vee){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(i>=t)i=t;else if(i<0)i=0;else{this.time=i;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(s===-1&&(e>=0?(s=0,this._setEndings(!0,this.repetitions===0,a)):this._setEndings(this.repetitions===0,!0,a)),i>=t||i<0){const l=Math.floor(i/t);i-=t*l,s+=Math.abs(l);const o=this.repetitions-s;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=e>0?t:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(o===1){const h=e<0;this._setEndings(h,!h,a)}else this._setEndings(!1,!1,a);this._loopCount=s,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:l})}}else this.time=i;if(a&&(s&1)===1)return t-i}return i}_setEndings(e,t,r){const i=this._interpolantSettings;r?(i.endingStart=py,i.endingEnd=py):(e?i.endingStart=this.zeroSlopeAtStart?py:dy:i.endingStart=BA,t?i.endingEnd=this.zeroSlopeAtEnd?py:dy:i.endingEnd=BA)}_scheduleFading(e,t,r){const i=this._mixer,s=i.time;let a=this._weightInterpolant;a===null&&(a=i._lendControlInterpolant(),this._weightInterpolant=a);const l=a.parameterPositions,o=a.sampleValues;return l[0]=s,o[0]=t,l[1]=s+e,o[1]=r,this}}const sbe=new Float32Array(1);class Jte extends pp{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const r=e._localRoot||this._root,i=e._clip.tracks,s=i.length,a=e._propertyBindings,l=e._interpolants,o=r.uuid,h=this._bindingsByRootAndName;let d=h[o];d===void 0&&(d={},h[o]=d);for(let m=0;m!==s;++m){const _=i[m],y=_.name;let T=d[y];if(T!==void 0)++T.referenceCount,a[m]=T;else{if(T=a[m],T!==void 0){T._cacheIndex===null&&(++T.referenceCount,this._addInactiveBinding(T,o,y));continue}const I=t&&t._propertyBindings[m].binding.parsedPath;T=new Yte(Ji.create(r,y,I),_.ValueTypeName,_.getValueSize()),++T.referenceCount,this._addInactiveBinding(T,o,y),a[m]=T}l[m].resultBuffer=T.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const r=(e._localRoot||this._root).uuid,i=e._clip.uuid,s=this._actionsByClip[i];this._bindAction(e,s&&s.knownActions[0]),this._addInactiveAction(e,i,r)}const t=e._propertyBindings;for(let r=0,i=t.length;r!==i;++r){const s=t[r];s.useCount++===0&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let r=0,i=t.length;r!==i;++r){const s=t[r];--s.useCount===0&&(s.restoreOriginalState(),this._takeBackBinding(s))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,r){const i=this._actions,s=this._actionsByClip;let a=s[t];if(a===void 0)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,s[t]=a;else{const l=a.knownActions;e._byClipCacheIndex=l.length,l.push(e)}e._cacheIndex=i.length,i.push(e),a.actionByRoot[r]=e}_removeInactiveAction(e){const t=this._actions,r=t[t.length-1],i=e._cacheIndex;r._cacheIndex=i,t[i]=r,t.pop(),e._cacheIndex=null;const s=e._clip.uuid,a=this._actionsByClip,l=a[s],o=l.knownActions,h=o[o.length-1],d=e._byClipCacheIndex;h._byClipCacheIndex=d,o[d]=h,o.pop(),e._byClipCacheIndex=null;const m=l.actionByRoot,_=(e._localRoot||this._root).uuid;delete m[_],o.length===0&&delete a[s],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let r=0,i=t.length;r!==i;++r){const s=t[r];--s.referenceCount===0&&this._removeInactiveBinding(s)}}_lendAction(e){const t=this._actions,r=e._cacheIndex,i=this._nActiveActions++,s=t[i];e._cacheIndex=i,t[i]=e,s._cacheIndex=r,t[r]=s}_takeBackAction(e){const t=this._actions,r=e._cacheIndex,i=--this._nActiveActions,s=t[i];e._cacheIndex=i,t[i]=e,s._cacheIndex=r,t[r]=s}_addInactiveBinding(e,t,r){const i=this._bindingsByRootAndName,s=this._bindings;let a=i[t];a===void 0&&(a={},i[t]=a),a[r]=e,e._cacheIndex=s.length,s.push(e)}_removeInactiveBinding(e){const t=this._bindings,r=e.binding,i=r.rootNode.uuid,s=r.path,a=this._bindingsByRootAndName,l=a[i],o=t[t.length-1],h=e._cacheIndex;o._cacheIndex=h,t[h]=o,t.pop(),delete l[s],Object.keys(l).length===0&&delete a[i]}_lendBinding(e){const t=this._bindings,r=e._cacheIndex,i=this._nActiveBindings++,s=t[i];e._cacheIndex=i,t[i]=e,s._cacheIndex=r,t[r]=s}_takeBackBinding(e){const t=this._bindings,r=e._cacheIndex,i=--this._nActiveBindings,s=t[i];e._cacheIndex=i,t[i]=e,s._cacheIndex=r,t[r]=s}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let r=e[t];return r===void 0&&(r=new I6(new Float32Array(2),new Float32Array(2),1,sbe),r.__cacheIndex=t,e[t]=r),r}_takeBackControlInterpolant(e){const t=this._controlInterpolants,r=e.__cacheIndex,i=--this._nActiveControlInterpolants,s=t[i];e.__cacheIndex=i,t[i]=e,s.__cacheIndex=r,t[r]=s}clipAction(e,t,r){const i=t||this._root,s=i.uuid;let a=typeof e=="string"?Ky.findByName(i,e):e;const l=a!==null?a.uuid:e,o=this._actionsByClip[l];let h=null;if(r===void 0&&(a!==null?r=a.blendMode:r=LL),o!==void 0){const m=o.actionByRoot[s];if(m!==void 0&&m.blendMode===r)return m;h=o.knownActions[0],a===null&&(a=h._clip)}if(a===null)return null;const d=new Kte(this,a,t,r);return this._bindAction(d,h),this._addInactiveAction(d,l,s),d}existingAction(e,t){const r=t||this._root,i=r.uuid,s=typeof e=="string"?Ky.findByName(r,e):e,a=s?s.uuid:e,l=this._actionsByClip[a];return l!==void 0&&l.actionByRoot[i]||null}stopAllAction(){const e=this._actions,t=this._nActiveActions;for(let r=t-1;r>=0;--r)e[r].stop();return this}update(e){e*=this.timeScale;const t=this._actions,r=this._nActiveActions,i=this.time+=e,s=Math.sign(e),a=this._accuIndex^=1;for(let h=0;h!==r;++h)t[h]._update(i,e,s,a);const l=this._bindings,o=this._nActiveBindings;for(let h=0;h!==o;++h)l[h].apply(a);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,r=e.uuid,i=this._actionsByClip,s=i[r];if(s!==void 0){const a=s.knownActions;for(let l=0,o=a.length;l!==o;++l){const h=a[l];this._deactivateAction(h);const d=h._cacheIndex,m=t[t.length-1];h._cacheIndex=null,h._byClipCacheIndex=null,m._cacheIndex=d,t[d]=m,t.pop(),this._removeInactiveBindingsForAction(h)}delete i[r]}}uncacheRoot(e){const t=e.uuid,r=this._actionsByClip;for(const a in r){const l=r[a].actionByRoot,o=l[t];o!==void 0&&(this._deactivateAction(o),this._removeInactiveAction(o))}const i=this._bindingsByRootAndName,s=i[t];if(s!==void 0)for(const a in s){const l=s[a];l.restoreOriginalState(),this._removeInactiveBinding(l)}}uncacheAction(e,t){const r=this.existingAction(e,t);r!==null&&(this._deactivateAction(r),this._removeInactiveAction(r))}}class F6{constructor(e){this.value=e}clone(){return new F6(this.value.clone===void 0?this.value:this.value.clone())}}let obe=0;class abe extends pp{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:obe++}),this.name="",this.usage=NA,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let r=0,i=t.length;r<i;r++){const s=Array.isArray(t[r])?t[r]:[t[r]];for(let a=0;a<s.length;a++)this.uniforms.push(s[a].clone())}return this}clone(){return new this.constructor().copy(this)}}class lbe extends dw{constructor(e,t,r=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class cbe{constructor(e,t,r,i,s){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=r,this.elementSize=i,this.count=s,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}const iW=new Vr;class tD{constructor(e,t,r=0,i=1/0){this.ray=new hx(e,t),this.near=r,this.far=i,this.camera=null,this.layers=new Py,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return iW.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(iW),this}intersectObject(e,t=!0,r=[]){return rF(e,this,r,t),r.sort(sW),r}intersectObjects(e,t=!0,r=[]){for(let i=0,s=e.length;i<s;i++)rF(e[i],this,r,t);return r.sort(sW),r}}function sW(n,e){return n.distance-e.distance}function rF(n,e,t,r){let i=!0;if(n.layers.test(e.layers)&&n.raycast(e,t)===!1&&(i=!1),i===!0&&r===!0){const s=n.children;for(let a=0,l=s.length;a<l;a++)rF(s[a],e,t,!0)}}class XA{constructor(e=1,t=0,r=0){return this.radius=e,this.phi=t,this.theta=r,this}set(e,t,r){return this.radius=e,this.phi=t,this.theta=r,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,r){return this.radius=Math.sqrt(e*e+t*t+r*r),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,r),this.phi=Math.acos(ea(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class ube{constructor(e=1,t=0,r=0){return this.radius=e,this.theta=t,this.y=r,this}set(e,t,r){return this.radius=e,this.theta=t,this.y=r,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,r){return this.radius=Math.sqrt(e*e+r*r),this.theta=Math.atan2(e,r),this.y=t,this}clone(){return new this.constructor().copy(this)}}const oW=new nn;class hbe{constructor(e=new nn(1/0,1/0),t=new nn(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const r=oW.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,oW).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const aW=new Ze,nE=new Ze;class fbe{constructor(e=new Ze,t=new Ze){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){aW.subVectors(e,this.start),nE.subVectors(this.end,this.start);const r=nE.dot(nE);let s=nE.dot(aW)/r;return t&&(s=ea(s,0,1)),s}closestPointToPoint(e,t,r){const i=this.closestPointToPointParameter(e,t);return this.delta(r).multiplyScalar(i).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const lW=new Ze;class dbe extends Ii{constructor(e,t){super(),this.light=e,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";const r=new $r,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let a=0,l=1,o=32;a<o;a++,l++){const h=a/o*Math.PI*2,d=l/o*Math.PI*2;i.push(Math.cos(h),Math.sin(h),1,Math.cos(d),Math.sin(d),1)}r.setAttribute("position",new ar(i,3));const s=new Ta({fog:!1,toneMapped:!1});this.cone=new uu(r,s),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),lW.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(lW),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const h0=new Ze,rE=new Vr,M5=new Vr;class pbe extends uu{constructor(e){const t=Qte(e),r=new $r,i=[],s=[],a=new Gn(0,0,1),l=new Gn(0,1,0);for(let h=0;h<t.length;h++){const d=t[h];d.parent&&d.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),s.push(a.r,a.g,a.b),s.push(l.r,l.g,l.b))}r.setAttribute("position",new ar(i,3)),r.setAttribute("color",new ar(s,3));const o=new Ta({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(r,o),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,r=this.geometry,i=r.getAttribute("position");M5.copy(this.root.matrixWorld).invert();for(let s=0,a=0;s<t.length;s++){const l=t[s];l.parent&&l.parent.isBone&&(rE.multiplyMatrices(M5,l.matrixWorld),h0.setFromMatrixPosition(rE),i.setXYZ(a,h0.x,h0.y,h0.z),rE.multiplyMatrices(M5,l.parent.matrixWorld),h0.setFromMatrixPosition(rE),i.setXYZ(a+1,h0.x,h0.y,h0.z),a+=2)}r.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}}function Qte(n){const e=[];n.isBone===!0&&e.push(n);for(let t=0;t<n.children.length;t++)e.push.apply(e,Qte(n.children[t]));return e}class mbe extends Ei{constructor(e,t,r){const i=new Lm(t,4,2),s=new vo({wireframe:!0,fog:!1,toneMapped:!1});super(i,s),this.light=e,this.color=r,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const gbe=new Ze,cW=new Gn,uW=new Gn;class vbe extends Ii{constructor(e,t,r){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,this.type="HemisphereLightHelper";const i=new NT(t);i.rotateY(Math.PI*.5),this.material=new vo({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const s=i.getAttribute("position"),a=new Float32Array(s.count*3);i.setAttribute("color",new Di(a,3)),this.add(new Ei(i,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");cW.copy(this.light.color),uW.copy(this.light.groundColor);for(let r=0,i=t.count;r<i;r++){const s=r<i/2?cW:uW;t.setXYZ(r,s.r,s.g,s.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(gbe.setFromMatrixPosition(this.light.matrixWorld).negate())}}class _be extends uu{constructor(e=10,t=10,r=4473924,i=8947848){r=new Gn(r),i=new Gn(i);const s=t/2,a=e/t,l=e/2,o=[],h=[];for(let _=0,y=0,T=-l;_<=t;_++,T+=a){o.push(-l,0,T,l,0,T),o.push(T,0,-l,T,0,l);const I=_===s?r:i;I.toArray(h,y),y+=3,I.toArray(h,y),y+=3,I.toArray(h,y),y+=3,I.toArray(h,y),y+=3}const d=new $r;d.setAttribute("position",new ar(o,3)),d.setAttribute("color",new ar(h,3));const m=new Ta({vertexColors:!0,toneMapped:!1});super(d,m),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class ybe extends uu{constructor(e=10,t=16,r=8,i=64,s=4473924,a=8947848){s=new Gn(s),a=new Gn(a);const l=[],o=[];if(t>1)for(let m=0;m<t;m++){const _=m/t*(Math.PI*2),y=Math.sin(_)*e,T=Math.cos(_)*e;l.push(0,0,0),l.push(y,0,T);const I=m&1?s:a;o.push(I.r,I.g,I.b),o.push(I.r,I.g,I.b)}for(let m=0;m<r;m++){const _=m&1?s:a,y=e-e/r*m;for(let T=0;T<i;T++){let I=T/i*(Math.PI*2),C=Math.sin(I)*y,M=Math.cos(I)*y;l.push(C,0,M),o.push(_.r,_.g,_.b),I=(T+1)/i*(Math.PI*2),C=Math.sin(I)*y,M=Math.cos(I)*y,l.push(C,0,M),o.push(_.r,_.g,_.b)}}const h=new $r;h.setAttribute("position",new ar(l,3)),h.setAttribute("color",new ar(o,3));const d=new Ta({vertexColors:!0,toneMapped:!1});super(h,d),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const hW=new Ze,iE=new Ze,fW=new Ze;class xbe extends Ii{constructor(e,t,r){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,this.type="DirectionalLightHelper",t===void 0&&(t=1);let i=new $r;i.setAttribute("position",new ar([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const s=new Ta({fog:!1,toneMapped:!1});this.lightPlane=new $f(i,s),this.add(this.lightPlane),i=new $r,i.setAttribute("position",new ar([0,0,0,0,0,1],3)),this.targetLine=new $f(i,s),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),hW.setFromMatrixPosition(this.light.matrixWorld),iE.setFromMatrixPosition(this.light.target.matrixWorld),fW.subVectors(iE,hW),this.lightPlane.lookAt(iE),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(iE),this.targetLine.scale.z=fW.length()}}const sE=new Ze,Ko=new LT;class bbe extends uu{constructor(e){const t=new $r,r=new Ta({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],s=[],a={};l("n1","n2"),l("n2","n4"),l("n4","n3"),l("n3","n1"),l("f1","f2"),l("f2","f4"),l("f4","f3"),l("f3","f1"),l("n1","f1"),l("n2","f2"),l("n3","f3"),l("n4","f4"),l("p","n1"),l("p","n2"),l("p","n3"),l("p","n4"),l("u1","u2"),l("u2","u3"),l("u3","u1"),l("c","t"),l("p","c"),l("cn1","cn2"),l("cn3","cn4"),l("cf1","cf2"),l("cf3","cf4");function l(T,I){o(T),o(I)}function o(T){i.push(0,0,0),s.push(0,0,0),a[T]===void 0&&(a[T]=[]),a[T].push(i.length/3-1)}t.setAttribute("position",new ar(i,3)),t.setAttribute("color",new ar(s,3)),super(t,r),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update();const h=new Gn(16755200),d=new Gn(16711680),m=new Gn(43775),_=new Gn(16777215),y=new Gn(3355443);this.setColors(h,d,m,_,y)}setColors(e,t,r,i,s){const l=this.geometry.getAttribute("color");l.setXYZ(0,e.r,e.g,e.b),l.setXYZ(1,e.r,e.g,e.b),l.setXYZ(2,e.r,e.g,e.b),l.setXYZ(3,e.r,e.g,e.b),l.setXYZ(4,e.r,e.g,e.b),l.setXYZ(5,e.r,e.g,e.b),l.setXYZ(6,e.r,e.g,e.b),l.setXYZ(7,e.r,e.g,e.b),l.setXYZ(8,e.r,e.g,e.b),l.setXYZ(9,e.r,e.g,e.b),l.setXYZ(10,e.r,e.g,e.b),l.setXYZ(11,e.r,e.g,e.b),l.setXYZ(12,e.r,e.g,e.b),l.setXYZ(13,e.r,e.g,e.b),l.setXYZ(14,e.r,e.g,e.b),l.setXYZ(15,e.r,e.g,e.b),l.setXYZ(16,e.r,e.g,e.b),l.setXYZ(17,e.r,e.g,e.b),l.setXYZ(18,e.r,e.g,e.b),l.setXYZ(19,e.r,e.g,e.b),l.setXYZ(20,e.r,e.g,e.b),l.setXYZ(21,e.r,e.g,e.b),l.setXYZ(22,e.r,e.g,e.b),l.setXYZ(23,e.r,e.g,e.b),l.setXYZ(24,t.r,t.g,t.b),l.setXYZ(25,t.r,t.g,t.b),l.setXYZ(26,t.r,t.g,t.b),l.setXYZ(27,t.r,t.g,t.b),l.setXYZ(28,t.r,t.g,t.b),l.setXYZ(29,t.r,t.g,t.b),l.setXYZ(30,t.r,t.g,t.b),l.setXYZ(31,t.r,t.g,t.b),l.setXYZ(32,r.r,r.g,r.b),l.setXYZ(33,r.r,r.g,r.b),l.setXYZ(34,r.r,r.g,r.b),l.setXYZ(35,r.r,r.g,r.b),l.setXYZ(36,r.r,r.g,r.b),l.setXYZ(37,r.r,r.g,r.b),l.setXYZ(38,i.r,i.g,i.b),l.setXYZ(39,i.r,i.g,i.b),l.setXYZ(40,s.r,s.g,s.b),l.setXYZ(41,s.r,s.g,s.b),l.setXYZ(42,s.r,s.g,s.b),l.setXYZ(43,s.r,s.g,s.b),l.setXYZ(44,s.r,s.g,s.b),l.setXYZ(45,s.r,s.g,s.b),l.setXYZ(46,s.r,s.g,s.b),l.setXYZ(47,s.r,s.g,s.b),l.setXYZ(48,s.r,s.g,s.b),l.setXYZ(49,s.r,s.g,s.b),l.needsUpdate=!0}update(){const e=this.geometry,t=this.pointMap,r=1,i=1;Ko.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),ua("c",t,e,Ko,0,0,-1),ua("t",t,e,Ko,0,0,1),ua("n1",t,e,Ko,-r,-i,-1),ua("n2",t,e,Ko,r,-i,-1),ua("n3",t,e,Ko,-r,i,-1),ua("n4",t,e,Ko,r,i,-1),ua("f1",t,e,Ko,-r,-i,1),ua("f2",t,e,Ko,r,-i,1),ua("f3",t,e,Ko,-r,i,1),ua("f4",t,e,Ko,r,i,1),ua("u1",t,e,Ko,r*.7,i*1.1,-1),ua("u2",t,e,Ko,-r*.7,i*1.1,-1),ua("u3",t,e,Ko,0,i*2,-1),ua("cf1",t,e,Ko,-r,0,1),ua("cf2",t,e,Ko,r,0,1),ua("cf3",t,e,Ko,0,-i,1),ua("cf4",t,e,Ko,0,i,1),ua("cn1",t,e,Ko,-r,0,-1),ua("cn2",t,e,Ko,r,0,-1),ua("cn3",t,e,Ko,0,-i,-1),ua("cn4",t,e,Ko,0,i,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function ua(n,e,t,r,i,s,a){sE.set(i,s,a).unproject(r);const l=e[n];if(l!==void 0){const o=t.getAttribute("position");for(let h=0,d=l.length;h<d;h++)o.setXYZ(l[h],sE.x,sE.y,sE.z)}}const oE=new wl;class wbe extends uu{constructor(e,t=16776960){const r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(8*3),s=new $r;s.setIndex(new Di(r,1)),s.setAttribute("position",new Di(i,3)),super(s,new Ta({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(e!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&oE.setFromObject(this.object),oE.isEmpty())return;const t=oE.min,r=oE.max,i=this.geometry.attributes.position,s=i.array;s[0]=r.x,s[1]=r.y,s[2]=r.z,s[3]=t.x,s[4]=r.y,s[5]=r.z,s[6]=t.x,s[7]=t.y,s[8]=r.z,s[9]=r.x,s[10]=t.y,s[11]=r.z,s[12]=r.x,s[13]=r.y,s[14]=t.z,s[15]=t.x,s[16]=r.y,s[17]=t.z,s[18]=t.x,s[19]=t.y,s[20]=t.z,s[21]=r.x,s[22]=t.y,s[23]=t.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Sbe extends uu{constructor(e,t=16776960){const r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],s=new $r;s.setIndex(new Di(r,1)),s.setAttribute("position",new ar(i,3)),super(s,new Ta({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class Abe extends $f{constructor(e,t=1,r=16776960){const i=r,s=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],a=new $r;a.setAttribute("position",new ar(s,3)),a.computeBoundingSphere(),super(a,new Ta({color:i,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const l=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],o=new $r;o.setAttribute("position",new ar(l,3)),o.computeBoundingSphere(),this.add(new Ei(o,new vo({color:i,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const dW=new Ze;let aE,C5;class Tbe extends Ii{constructor(e=new Ze(0,0,1),t=new Ze(0,0,0),r=1,i=16776960,s=r*.2,a=s*.2){super(),this.type="ArrowHelper",aE===void 0&&(aE=new $r,aE.setAttribute("position",new ar([0,0,0,0,1,0],3)),C5=new mw(0,.5,1,5,1),C5.translate(0,-.5,0)),this.position.copy(t),this.line=new $f(aE,new Ta({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Ei(C5,new vo({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(r,s,a)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{dW.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(dW,t)}}setLength(e,t=e*.2,r=t*.2){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(r,t,r),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class Mbe extends uu{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],r=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],i=new $r;i.setAttribute("position",new ar(t,3)),i.setAttribute("color",new ar(r,3));const s=new Ta({vertexColors:!0,toneMapped:!1});super(i,s),this.type="AxesHelper"}setColors(e,t,r){const i=new Gn,s=this.geometry.attributes.color.array;return i.set(e),i.toArray(s,0),i.toArray(s,3),i.set(t),i.toArray(s,6),i.toArray(s,9),i.set(r),i.toArray(s,12),i.toArray(s,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Cbe{constructor(){this.type="ShapePath",this.color=new Gn,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new VA,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,r,i){return this.currentPath.quadraticCurveTo(e,t,r,i),this}bezierCurveTo(e,t,r,i,s,a){return this.currentPath.bezierCurveTo(e,t,r,i,s,a),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(M){const B=[];for(let k=0,j=M.length;k<j;k++){const q=M[k],Z=new Ly;Z.curves=q.curves,B.push(Z)}return B}function r(M,B){const k=B.length;let j=!1;for(let q=k-1,Z=0;Z<k;q=Z++){let te=B[q],ie=B[Z],se=ie.x-te.x,ae=ie.y-te.y;if(Math.abs(ae)>Number.EPSILON){if(ae<0&&(te=B[Z],se=-se,ie=B[q],ae=-ae),M.y<te.y||M.y>ie.y)continue;if(M.y===te.y){if(M.x===te.x)return!0}else{const fe=ae*(M.x-te.x)-se*(M.y-te.y);if(fe===0)return!0;if(fe<0)continue;j=!j}}else{if(M.y!==te.y)continue;if(ie.x<=M.x&&M.x<=te.x||te.x<=M.x&&M.x<=ie.x)return!0}}return j}const i=sp.isClockWise,s=this.subPaths;if(s.length===0)return[];let a,l,o;const h=[];if(s.length===1)return l=s[0],o=new Ly,o.curves=l.curves,h.push(o),h;let d=!i(s[0].getPoints());d=e?!d:d;const m=[],_=[];let y=[],T=0,I;_[T]=void 0,y[T]=[];for(let M=0,B=s.length;M<B;M++)l=s[M],I=l.getPoints(),a=i(I),a=e?!a:a,a?(!d&&_[T]&&T++,_[T]={s:new Ly,p:I},_[T].s.curves=l.curves,d&&T++,y[T]=[]):y[T].push({h:l,p:I[0]});if(!_[0])return t(s);if(_.length>1){let M=!1,B=0;for(let k=0,j=_.length;k<j;k++)m[k]=[];for(let k=0,j=_.length;k<j;k++){const q=y[k];for(let Z=0;Z<q.length;Z++){const te=q[Z];let ie=!0;for(let se=0;se<_.length;se++)r(te.p,_[se].p)&&(k!==se&&B++,ie?(ie=!1,m[se].push(te)):M=!0);ie&&m[k].push(te)}}B>0&&M===!1&&(y=m)}let C;for(let M=0,B=_.length;M<B;M++){o=_[M].s,h.push(o),C=y[M];for(let k=0,j=C.length;k<j;k++)o.holes.push(C[k].h)}return h}}class Ebe extends bl{constructor(e=1,t=1,r=1,i={}){console.warn('THREE.WebGLMultipleRenderTargets has been deprecated and will be removed in r172. Use THREE.WebGLRenderTarget and set the "count" parameter to enable MRT.'),super(e,t,{...i,count:r}),this.isWebGLMultipleRenderTargets=!0}get texture(){return this.textures}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:TT}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=TT);const ene=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:TL,AddEquation:D0,AddOperation:Bee,AdditiveAnimationBlendMode:l6,AdditiveBlending:Wb,AgXToneMapping:Nee,AlphaFormat:n6,AlwaysCompare:Qee,AlwaysDepth:Cee,AlwaysStencilFunc:$O,AmbientLight:mx,AnimationAction:Kte,AnimationClip:Ky,AnimationLoader:F1e,AnimationMixer:Jte,AnimationObjectGroup:ibe,AnimationUtils:D1e,ArcCurve:yte,ArrayCamera:pte,ArrowHelper:Tbe,AttachedBindMode:XO,Audio:qte,AudioAnalyser:q1e,AudioContext:B6,AudioListener:$te,AudioLoader:Xte,AxesHelper:Mbe,BackSide:Mc,BasicDepthPacking:jee,BasicShadowMap:aee,BatchedMesh:vte,Bone:OT,BooleanKeyframeTrack:dx,Box2:hbe,Box3:wl,Box3Helper:Sbe,BoxGeometry:mp,BoxHelper:wbe,BufferAttribute:Di,BufferGeometry:$r,BufferGeometryLoader:Wte,ByteType:Qz,Cache:Mm,Camera:LT,CameraHelper:bbe,CanvasTexture:QO,CapsuleGeometry:GL,CatmullRomCurve3:xte,CineonToneMapping:AL,CircleGeometry:HL,ClampToEdgeWrapping:ru,Clock:Qm,Color:Gn,ColorKeyframeTrack:R6,ColorManagement:ds,CompressedArrayTexture:n1e,CompressedCubeTexture:r1e,CompressedTexture:UL,CompressedTextureLoader:N1e,ConeGeometry:jL,ConstantAlphaFactor:Aee,ConstantColorFactor:wee,CubeCamera:ote,CubeReflectionMapping:Um,CubeRefractionMapping:av,CubeTexture:DT,CubeTextureLoader:zte,CubeUVReflectionMapping:uw,CubicBezierCurve:w6,CubicBezierCurve3:bte,CubicInterpolant:Ote,CullFaceBack:HO,CullFaceFront:oee,CullFaceFrontBack:Vme,CullFaceNone:see,Curve:Jf,CurvePath:Ste,CustomBlending:lee,CustomToneMapping:Fee,CylinderGeometry:mw,Cylindrical:ube,Data3DTexture:d6,DataArrayTexture:BL,DataTexture:jf,DataTextureLoader:z1e,DataUtils:qge,DecrementStencilOp:Yme,DecrementWrapStencilOp:Jme,DefaultLoadingManager:P6,DepthFormat:Iy,DepthStencilFormat:Xy,DepthTexture:v6,DetachedBindMode:Uee,DirectionalLight:Cv,DirectionalLightHelper:xbe,DiscreteInterpolant:Fte,DisplayP3ColorSpace:DL,DodecahedronGeometry:WL,DoubleSide:bc,DstAlphaFactor:vee,DstColorFactor:yee,DynamicCopyUsage:dge,DynamicDrawUsage:age,DynamicReadUsage:uge,EdgesGeometry:Ate,EllipseCurve:VL,EqualCompare:Zee,EqualDepth:Iee,EqualStencilFunc:nge,EquirectangularReflectionMapping:LA,EquirectangularRefractionMapping:DA,Euler:Ou,EventDispatcher:pp,ExtrudeGeometry:$L,FileLoader:Wa,Float16BufferAttribute:e0e,Float32BufferAttribute:ar,FloatType:Sc,Fog:fw,FogExp2:kT,FramebufferTexture:t1e,FrontSide:Rh,Frustum:BT,GLBufferAttribute:cbe,GLSL1:mge,GLSL3:qO,GreaterCompare:Yee,GreaterDepth:Pee,GreaterEqualCompare:Jee,GreaterEqualDepth:Ree,GreaterEqualStencilFunc:oge,GreaterStencilFunc:ige,GridHelper:_be,Group:Wl,HalfFloatType:Ah,HemisphereLight:Ute,HemisphereLightHelper:vbe,IcosahedronGeometry:Yy,ImageBitmapLoader:D6,ImageLoader:WA,ImageUtils:nte,IncrementStencilOp:Zme,IncrementWrapStencilOp:Kme,InstancedBufferAttribute:cv,InstancedBufferGeometry:jte,InstancedInterleavedBuffer:lbe,InstancedMesh:NL,Int16BufferAttribute:Jge,Int32BufferAttribute:Qge,Int8BufferAttribute:Zge,IntType:CL,InterleavedBuffer:dw,InterleavedBufferAttribute:Hm,Interpolant:fx,InterpolateDiscrete:$y,InterpolateLinear:lv,InterpolateSmooth:PI,InvertStencilOp:Qme,KeepStencilOp:iy,KeyframeTrack:Qf,LOD:gte,LatheGeometry:FT,Layers:Py,LessCompare:qee,LessDepth:Eee,LessEqualCompare:u6,LessEqualDepth:PA,LessEqualStencilFunc:rge,LessStencilFunc:tge,Light:Mv,LightProbe:Hte,Line:$f,Line3:fbe,LineBasicMaterial:Ta,LineCurve:S6,LineCurve3:wte,LineDashedMaterial:C6,LineLoop:zL,LineSegments:uu,LinearDisplayP3ColorSpace:PT,LinearFilter:Co,LinearInterpolant:I6,LinearMipMapLinearFilter:Wme,LinearMipMapNearestFilter:jme,LinearMipmapLinearFilter:iu,LinearMipmapNearestFilter:Ey,LinearSRGBColorSpace:Ga,LinearToneMapping:kee,LinearTransfer:kA,Loader:Ea,LoaderUtils:cu,LoadingManager:GT,LoopOnce:Vee,LoopPingPong:Hee,LoopRepeat:Gee,LuminanceAlphaFormat:s6,LuminanceFormat:i6,MOUSE:ny,Material:_o,MaterialLoader:eD,MathUtils:to,Matrix3:bi,Matrix4:Vr,MaxEquation:fee,Mesh:Ei,MeshBasicMaterial:vo,MeshDepthMaterial:_6,MeshDistanceMaterial:y6,MeshLambertMaterial:VT,MeshMatcapMaterial:Dte,MeshNormalMaterial:Lte,MeshPhongMaterial:UT,MeshPhysicalMaterial:jo,MeshStandardMaterial:cp,MeshToonMaterial:Pte,MinEquation:hee,MirroredRepeatWrapping:jy,MixOperation:Dee,MultiplyBlending:WO,MultiplyOperation:MT,NearestFilter:wa,NearestMipMapLinearFilter:Hme,NearestMipMapNearestFilter:Gme,NearestMipmapLinearFilter:z0,NearestMipmapNearestFilter:CT,NeutralToneMapping:zee,NeverCompare:$ee,NeverDepth:Mee,NeverStencilFunc:ege,NoBlending:rp,NoColorSpace:bm,NoToneMapping:ip,NormalAnimationBlendMode:LL,NormalBlending:Cy,NotEqualCompare:Kee,NotEqualDepth:Lee,NotEqualStencilFunc:sge,NumberKeyframeTrack:jm,Object3D:Ii,ObjectLoader:H1e,ObjectSpaceNormalMap:Xee,OctahedronGeometry:NT,OneFactor:pee,OneMinusConstantAlphaFactor:Tee,OneMinusConstantColorFactor:See,OneMinusDstAlphaFactor:_ee,OneMinusDstColorFactor:xee,OneMinusSrcAlphaFactor:MR,OneMinusSrcColorFactor:gee,OrthographicCamera:Kf,P3Primaries:FA,PCFShadowMap:SL,PCFSoftShadowMap:BS,PMREMGenerator:ZO,Path:VA,PerspectiveCamera:Qi,Plane:xm,PlaneGeometry:Jm,PlaneHelper:Abe,PointLight:ev,PointLightHelper:mbe,Points:wh,PointsMaterial:su,PolarGridHelper:ybe,PolyhedronGeometry:Tv,PositionalAudio:Zte,PropertyBinding:Ji,PropertyMixer:Yte,QuadraticBezierCurve:A6,QuadraticBezierCurve3:T6,Quaternion:Aa,QuaternionKeyframeTrack:Wm,QuaternionLinearInterpolant:Nte,RED_GREEN_RGTC2_Format:KR,RED_RGTC1_Format:a6,REVISION:TT,RGBADepthPacking:Wee,RGBAFormat:jl,RGBAIntegerFormat:PL,RGBA_ASTC_10x10_Format:WR,RGBA_ASTC_10x5_Format:GR,RGBA_ASTC_10x6_Format:HR,RGBA_ASTC_10x8_Format:jR,RGBA_ASTC_12x10_Format:XR,RGBA_ASTC_12x12_Format:$R,RGBA_ASTC_4x4_Format:BR,RGBA_ASTC_5x4_Format:kR,RGBA_ASTC_5x5_Format:OR,RGBA_ASTC_6x5_Format:FR,RGBA_ASTC_6x6_Format:NR,RGBA_ASTC_8x5_Format:zR,RGBA_ASTC_8x6_Format:UR,RGBA_ASTC_8x8_Format:VR,RGBA_BPTC_Format:zS,RGBA_ETC2_EAC_Format:DR,RGBA_PVRTC_2BPPV1_Format:RR,RGBA_PVRTC_4BPPV1_Format:IR,RGBA_S3TC_DXT1_Format:OS,RGBA_S3TC_DXT3_Format:FS,RGBA_S3TC_DXT5_Format:NS,RGBFormat:r6,RGBIntegerFormat:Xme,RGB_BPTC_SIGNED_Format:qR,RGB_BPTC_UNSIGNED_Format:ZR,RGB_ETC1_Format:PR,RGB_ETC2_Format:LR,RGB_PVRTC_2BPPV1_Format:ER,RGB_PVRTC_4BPPV1_Format:CR,RGB_S3TC_DXT1_Format:kS,RGFormat:o6,RGIntegerFormat:RL,RawShaderMaterial:Rte,Ray:hx,Raycaster:tD,Rec709Primaries:OA,RectAreaLight:Vte,RedFormat:ET,RedIntegerFormat:IT,ReinhardToneMapping:Oee,RenderTarget:rte,RepeatWrapping:Ph,ReplaceStencilOp:qme,ReverseSubtractEquation:uee,RingGeometry:qL,SIGNED_RED_GREEN_RGTC2_Format:JR,SIGNED_RED_RGTC1_Format:YR,SRGBColorSpace:Ao,SRGBTransfer:eo,Scene:Al,ShaderChunk:Ti,ShaderLib:kf,ShaderMaterial:Eo,ShadowMaterial:Ite,Shape:Ly,ShapeGeometry:ZL,ShapePath:Cbe,ShapeUtils:sp,ShortType:e6,Skeleton:pw,SkeletonHelper:pbe,SkinnedMesh:FL,Source:my,Sphere:rl,SphereGeometry:Lm,Spherical:XA,SphericalHarmonics3:Gte,SplineCurve:M6,SpotLight:QL,SpotLightHelper:dbe,Sprite:x6,SpriteMaterial:OL,SrcAlphaFactor:TR,SrcAlphaSaturateFactor:bee,SrcColorFactor:mee,StaticCopyUsage:fge,StaticDrawUsage:NA,StaticReadUsage:cge,StereoCamera:W1e,StreamCopyUsage:pge,StreamDrawUsage:lge,StreamReadUsage:hge,StringKeyframeTrack:px,SubtractEquation:cee,SubtractiveBlending:jO,TOUCH:ry,TangentSpaceNormalMap:Av,TetrahedronGeometry:YL,Texture:Ws,TextureLoader:qf,TextureUtils:kxe,TorusGeometry:zT,TorusKnotGeometry:KL,Triangle:U0,TriangleFanDrawMode:qy,TriangleStripDrawMode:RT,TrianglesDrawMode:c6,TubeGeometry:JL,UVMapping:ML,Uint16BufferAttribute:p6,Uint32BufferAttribute:m6,Uint8BufferAttribute:Yge,Uint8ClampedBufferAttribute:Kge,Uniform:F6,UniformsGroup:abe,UniformsLib:hr,UniformsUtils:Gm,UnsignedByteType:Xf,UnsignedInt248Type:Wy,UnsignedInt5999Type:t6,UnsignedIntType:Vm,UnsignedShort4444Type:EL,UnsignedShort5551Type:IL,UnsignedShortType:Xb,VSMShadowMap:Pf,Vector2:nn,Vector3:Ze,Vector4:Es,VectorKeyframeTrack:Xm,VideoTexture:_te,WebGL3DRenderTarget:Nge,WebGLArrayRenderTarget:Fge,WebGLCoordinateSystem:Yd,WebGLCubeRenderTarget:ate,WebGLMultipleRenderTargets:Ebe,WebGLRenderTarget:bl,WebGLRenderer:Zl,WebGLUtils:dte,WebGPUCoordinateSystem:zA,WireframeGeometry:Ete,WrapAroundEnding:BA,ZeroCurvatureEnding:dy,ZeroFactor:dee,ZeroSlopeEnding:py,ZeroStencilOp:$me,createCanvasElement:tte},Symbol.toStringTag,{value:"Module"}));var tne={exports:{}},gx={};/**
 * @license React
 * react-reconciler-constants.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */gx.ConcurrentRoot=1;gx.ContinuousEventPriority=4;gx.DefaultEventPriority=16;gx.DiscreteEventPriority=1;gx.IdleEventPriority=536870912;gx.LegacyRoot=0;tne.exports=gx;var ub=tne.exports;function Ibe(n){let e;const t=new Set,r=(h,d)=>{const m=typeof h=="function"?h(e):h;if(m!==e){const _=e;e=d?m:Object.assign({},e,m),t.forEach(y=>y(e,_))}},i=()=>e,s=(h,d=i,m=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let _=d(e);function y(){const T=d(e);if(!m(_,T)){const I=_;h(_=T,I)}}return t.add(y),()=>t.delete(y)},o={setState:r,getState:i,subscribe:(h,d,m)=>d||m?s(h,d,m):(t.add(h),()=>t.delete(h)),destroy:()=>t.clear()};return e=n(r,i,o),o}const Rbe=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),pW=Rbe?Ae.useEffect:Ae.useLayoutEffect;function Pbe(n){const e=typeof n=="function"?Ibe(n):n,t=(r=e.getState,i=Object.is)=>{const[,s]=Ae.useReducer(C=>C+1,0),a=e.getState(),l=Ae.useRef(a),o=Ae.useRef(r),h=Ae.useRef(i),d=Ae.useRef(!1),m=Ae.useRef();m.current===void 0&&(m.current=r(a));let _,y=!1;(l.current!==a||o.current!==r||h.current!==i||d.current)&&(_=r(a),y=!i(m.current,_)),pW(()=>{y&&(m.current=_),l.current=a,o.current=r,h.current=i,d.current=!1});const T=Ae.useRef(a);pW(()=>{const C=()=>{try{const B=e.getState(),k=o.current(B);h.current(m.current,k)||(l.current=B,m.current=k,s())}catch{d.current=!0,s()}},M=e.subscribe(C);return e.getState()!==T.current&&C(),M},[]);const I=y?_:m.current;return Ae.useDebugValue(I),I};return Object.assign(t,e),t[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const r=[t,e];return{next(){const i=r.length<=0;return{value:r.shift(),done:i}}}},t}var nne={exports:{}},E5={exports:{}},I5={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var mW;function Lbe(){return mW||(mW=1,function(n){function e(ye,Xe){var He=ye.length;ye.push(Xe);e:for(;0<He;){var _t=He-1>>>1,wt=ye[_t];if(0<i(wt,Xe))ye[_t]=Xe,ye[He]=wt,He=_t;else break e}}function t(ye){return ye.length===0?null:ye[0]}function r(ye){if(ye.length===0)return null;var Xe=ye[0],He=ye.pop();if(He!==Xe){ye[0]=He;e:for(var _t=0,wt=ye.length,Gt=wt>>>1;_t<Gt;){var at=2*(_t+1)-1,Ht=ye[at],Qt=at+1,rn=ye[Qt];if(0>i(Ht,He))Qt<wt&&0>i(rn,Ht)?(ye[_t]=rn,ye[Qt]=He,_t=Qt):(ye[_t]=Ht,ye[at]=He,_t=at);else if(Qt<wt&&0>i(rn,He))ye[_t]=rn,ye[Qt]=He,_t=Qt;else break e}}return Xe}function i(ye,Xe){var He=ye.sortIndex-Xe.sortIndex;return He!==0?He:ye.id-Xe.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;n.unstable_now=function(){return s.now()}}else{var a=Date,l=a.now();n.unstable_now=function(){return a.now()-l}}var o=[],h=[],d=1,m=null,_=3,y=!1,T=!1,I=!1,C=typeof setTimeout=="function"?setTimeout:null,M=typeof clearTimeout=="function"?clearTimeout:null,B=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function k(ye){for(var Xe=t(h);Xe!==null;){if(Xe.callback===null)r(h);else if(Xe.startTime<=ye)r(h),Xe.sortIndex=Xe.expirationTime,e(o,Xe);else break;Xe=t(h)}}function j(ye){if(I=!1,k(ye),!T)if(t(o)!==null)T=!0,Le(q);else{var Xe=t(h);Xe!==null&&dt(j,Xe.startTime-ye)}}function q(ye,Xe){T=!1,I&&(I=!1,M(ie),ie=-1),y=!0;var He=_;try{for(k(Xe),m=t(o);m!==null&&(!(m.expirationTime>Xe)||ye&&!fe());){var _t=m.callback;if(typeof _t=="function"){m.callback=null,_=m.priorityLevel;var wt=_t(m.expirationTime<=Xe);Xe=n.unstable_now(),typeof wt=="function"?m.callback=wt:m===t(o)&&r(o),k(Xe)}else r(o);m=t(o)}if(m!==null)var Gt=!0;else{var at=t(h);at!==null&&dt(j,at.startTime-Xe),Gt=!1}return Gt}finally{m=null,_=He,y=!1}}var Z=!1,te=null,ie=-1,se=5,ae=-1;function fe(){return!(n.unstable_now()-ae<se)}function Se(){if(te!==null){var ye=n.unstable_now();ae=ye;var Xe=!0;try{Xe=te(!0,ye)}finally{Xe?Ee():(Z=!1,te=null)}}else Z=!1}var Ee;if(typeof B=="function")Ee=function(){B(Se)};else if(typeof MessageChannel<"u"){var Re=new MessageChannel,qe=Re.port2;Re.port1.onmessage=Se,Ee=function(){qe.postMessage(null)}}else Ee=function(){C(Se,0)};function Le(ye){te=ye,Z||(Z=!0,Ee())}function dt(ye,Xe){ie=C(function(){ye(n.unstable_now())},Xe)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(ye){ye.callback=null},n.unstable_continueExecution=function(){T||y||(T=!0,Le(q))},n.unstable_forceFrameRate=function(ye){0>ye||125<ye?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):se=0<ye?Math.floor(1e3/ye):5},n.unstable_getCurrentPriorityLevel=function(){return _},n.unstable_getFirstCallbackNode=function(){return t(o)},n.unstable_next=function(ye){switch(_){case 1:case 2:case 3:var Xe=3;break;default:Xe=_}var He=_;_=Xe;try{return ye()}finally{_=He}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(ye,Xe){switch(ye){case 1:case 2:case 3:case 4:case 5:break;default:ye=3}var He=_;_=ye;try{return Xe()}finally{_=He}},n.unstable_scheduleCallback=function(ye,Xe,He){var _t=n.unstable_now();switch(typeof He=="object"&&He!==null?(He=He.delay,He=typeof He=="number"&&0<He?_t+He:_t):He=_t,ye){case 1:var wt=-1;break;case 2:wt=250;break;case 5:wt=1073741823;break;case 4:wt=1e4;break;default:wt=5e3}return wt=He+wt,ye={id:d++,callback:Xe,priorityLevel:ye,startTime:He,expirationTime:wt,sortIndex:-1},He>_t?(ye.sortIndex=He,e(h,ye),t(o)===null&&ye===t(h)&&(I?(M(ie),ie=-1):I=!0,dt(j,He-_t))):(ye.sortIndex=wt,e(o,ye),T||y||(T=!0,Le(q))),ye},n.unstable_shouldYield=fe,n.unstable_wrapCallback=function(ye){var Xe=_;return function(){var He=_;_=Xe;try{return ye.apply(this,arguments)}finally{_=He}}}}(I5)),I5}var gW;function Dbe(){return gW||(gW=1,E5.exports=Lbe()),E5.exports}/**
 * @license React
 * react-reconciler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Bbe=function(e){var t={},r=Ae,i=Dbe(),s=Object.assign;function a(L){for(var O="https://reactjs.org/docs/error-decoder.html?invariant="+L,Y=1;Y<arguments.length;Y++)O+="&args[]="+encodeURIComponent(arguments[Y]);return"Minified React error #"+L+"; visit "+O+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var l=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,o=Symbol.for("react.element"),h=Symbol.for("react.portal"),d=Symbol.for("react.fragment"),m=Symbol.for("react.strict_mode"),_=Symbol.for("react.profiler"),y=Symbol.for("react.provider"),T=Symbol.for("react.context"),I=Symbol.for("react.forward_ref"),C=Symbol.for("react.suspense"),M=Symbol.for("react.suspense_list"),B=Symbol.for("react.memo"),k=Symbol.for("react.lazy"),j=Symbol.for("react.offscreen"),q=Symbol.iterator;function Z(L){return L===null||typeof L!="object"?null:(L=q&&L[q]||L["@@iterator"],typeof L=="function"?L:null)}function te(L){if(L==null)return null;if(typeof L=="function")return L.displayName||L.name||null;if(typeof L=="string")return L;switch(L){case d:return"Fragment";case h:return"Portal";case _:return"Profiler";case m:return"StrictMode";case C:return"Suspense";case M:return"SuspenseList"}if(typeof L=="object")switch(L.$$typeof){case T:return(L.displayName||"Context")+".Consumer";case y:return(L._context.displayName||"Context")+".Provider";case I:var O=L.render;return L=L.displayName,L||(L=O.displayName||O.name||"",L=L!==""?"ForwardRef("+L+")":"ForwardRef"),L;case B:return O=L.displayName||null,O!==null?O:te(L.type)||"Memo";case k:O=L._payload,L=L._init;try{return te(L(O))}catch{}}return null}function ie(L){var O=L.type;switch(L.tag){case 24:return"Cache";case 9:return(O.displayName||"Context")+".Consumer";case 10:return(O._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return L=O.render,L=L.displayName||L.name||"",O.displayName||(L!==""?"ForwardRef("+L+")":"ForwardRef");case 7:return"Fragment";case 5:return O;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return te(O);case 8:return O===m?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof O=="function")return O.displayName||O.name||null;if(typeof O=="string")return O}return null}function se(L){var O=L,Y=L;if(L.alternate)for(;O.return;)O=O.return;else{L=O;do O=L,O.flags&4098&&(Y=O.return),L=O.return;while(L)}return O.tag===3?Y:null}function ae(L){if(se(L)!==L)throw Error(a(188))}function fe(L){var O=L.alternate;if(!O){if(O=se(L),O===null)throw Error(a(188));return O!==L?null:L}for(var Y=L,re=O;;){var pe=Y.return;if(pe===null)break;var Te=pe.alternate;if(Te===null){if(re=pe.return,re!==null){Y=re;continue}break}if(pe.child===Te.child){for(Te=pe.child;Te;){if(Te===Y)return ae(pe),L;if(Te===re)return ae(pe),O;Te=Te.sibling}throw Error(a(188))}if(Y.return!==re.return)Y=pe,re=Te;else{for(var ft=!1,Ot=pe.child;Ot;){if(Ot===Y){ft=!0,Y=pe,re=Te;break}if(Ot===re){ft=!0,re=pe,Y=Te;break}Ot=Ot.sibling}if(!ft){for(Ot=Te.child;Ot;){if(Ot===Y){ft=!0,Y=Te,re=pe;break}if(Ot===re){ft=!0,re=Te,Y=pe;break}Ot=Ot.sibling}if(!ft)throw Error(a(189))}}if(Y.alternate!==re)throw Error(a(190))}if(Y.tag!==3)throw Error(a(188));return Y.stateNode.current===Y?L:O}function Se(L){return L=fe(L),L!==null?Ee(L):null}function Ee(L){if(L.tag===5||L.tag===6)return L;for(L=L.child;L!==null;){var O=Ee(L);if(O!==null)return O;L=L.sibling}return null}function Re(L){if(L.tag===5||L.tag===6)return L;for(L=L.child;L!==null;){if(L.tag!==4){var O=Re(L);if(O!==null)return O}L=L.sibling}return null}var qe=Array.isArray,Le=e.getPublicInstance,dt=e.getRootHostContext,ye=e.getChildHostContext,Xe=e.prepareForCommit,He=e.resetAfterCommit,_t=e.createInstance,wt=e.appendInitialChild,Gt=e.finalizeInitialChildren,at=e.prepareUpdate,Ht=e.shouldSetTextContent,Qt=e.createTextInstance,rn=e.scheduleTimeout,jn=e.cancelTimeout,Bn=e.noTimeout,Tn=e.isPrimaryRenderer,Pe=e.supportsMutation,$e=e.supportsPersistence,mn=e.supportsHydration,cn=e.getInstanceFromNode,St=e.preparePortalMount,Jt=e.getCurrentEventPriority,kn=e.detachDeletedInstance,Vn=e.supportsMicrotasks,sn=e.scheduleMicrotask,ot=e.supportsTestSelectors,Ue=e.findFiberRoot,$t=e.getBoundingRect,An=e.getTextContent,Sn=e.isHiddenSubtree,jt=e.matchAccessibilityRole,mr=e.setFocusIfFocusable,Un=e.setupIntersectionObserver,tr=e.appendChild,Sr=e.appendChildToContainer,Ln=e.commitTextUpdate,ir=e.commitMount,ci=e.commitUpdate,Fr=e.insertBefore,or=e.insertInContainerBefore,Nr=e.removeChild,Hr=e.removeChildFromContainer,_i=e.resetTextContent,Fe=e.hideInstance,Lt=e.hideTextInstance,Kt=e.unhideInstance,un=e.unhideTextInstance,En=e.clearContainer,Ar=e.cloneInstance,Gr=e.createContainerChildSet,cs=e.appendChildToContainerChildSet,Rs=e.finalizeContainerChildren,ui=e.replaceContainerChildren,Tt=e.cloneHiddenInstance,xe=e.cloneHiddenTextInstance,Ce=e.canHydrateInstance,We=e.canHydrateTextInstance,nt=e.canHydrateSuspenseInstance,Je=e.isSuspenseInstancePending,pt=e.isSuspenseInstanceFallback,Rt=e.registerSuspenseInstanceRetry,gt=e.getNextHydratableSibling,Pt=e.getFirstHydratableChild,zt=e.getFirstHydratableChildWithinContainer,Bt=e.getFirstHydratableChildWithinSuspenseInstance,ln=e.hydrateInstance,Mn=e.hydrateTextInstance,Cn=e.hydrateSuspenseInstance,Ve=e.getNextHydratableInstanceAfterSuspenseInstance,yt=e.commitHydratedContainer,Mt=e.commitHydratedSuspenseInstance,Ct=e.clearSuspenseBoundary,It=e.clearSuspenseBoundaryFromContainer,wn=e.shouldDeleteUnhydratedTailInstances,_n=e.didNotMatchHydratedContainerTextInstance,zn=e.didNotMatchHydratedTextInstance,Xn;function lr(L){if(Xn===void 0)try{throw Error()}catch(Y){var O=Y.stack.trim().match(/\n( *(at )?)/);Xn=O&&O[1]||""}return`
`+Xn+L}var gr=!1;function dr(L,O){if(!L||gr)return"";gr=!0;var Y=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(O)if(O=function(){throw Error()},Object.defineProperty(O.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(O,[])}catch(Wn){var re=Wn}Reflect.construct(L,[],O)}else{try{O.call()}catch(Wn){re=Wn}L.call(O.prototype)}else{try{throw Error()}catch(Wn){re=Wn}L()}}catch(Wn){if(Wn&&re&&typeof Wn.stack=="string"){for(var pe=Wn.stack.split(`
`),Te=re.stack.split(`
`),ft=pe.length-1,Ot=Te.length-1;1<=ft&&0<=Ot&&pe[ft]!==Te[Ot];)Ot--;for(;1<=ft&&0<=Ot;ft--,Ot--)if(pe[ft]!==Te[Ot]){if(ft!==1||Ot!==1)do if(ft--,Ot--,0>Ot||pe[ft]!==Te[Ot]){var vn=`
`+pe[ft].replace(" at new "," at ");return L.displayName&&vn.includes("<anonymous>")&&(vn=vn.replace("<anonymous>",L.displayName)),vn}while(1<=ft&&0<=Ot);break}}}finally{gr=!1,Error.prepareStackTrace=Y}return(L=L?L.displayName||L.name:"")?lr(L):""}var hi=Object.prototype.hasOwnProperty,Bi=[],Gi=-1;function ws(L){return{current:L}}function Er(L){0>Gi||(L.current=Bi[Gi],Bi[Gi]=null,Gi--)}function Qn(L,O){Gi++,Bi[Gi]=L.current,L.current=O}var qi={},qr=ws(qi),gs=ws(!1),Wo=qi;function Ps(L,O){var Y=L.type.contextTypes;if(!Y)return qi;var re=L.stateNode;if(re&&re.__reactInternalMemoizedUnmaskedChildContext===O)return re.__reactInternalMemoizedMaskedChildContext;var pe={},Te;for(Te in Y)pe[Te]=O[Te];return re&&(L=L.stateNode,L.__reactInternalMemoizedUnmaskedChildContext=O,L.__reactInternalMemoizedMaskedChildContext=pe),pe}function us(L){return L=L.childContextTypes,L!=null}function Ri(){Er(gs),Er(qr)}function so(L,O,Y){if(qr.current!==qi)throw Error(a(168));Qn(qr,O),Qn(gs,Y)}function Ro(L,O,Y){var re=L.stateNode;if(O=O.childContextTypes,typeof re.getChildContext!="function")return Y;re=re.getChildContext();for(var pe in re)if(!(pe in O))throw Error(a(108,ie(L)||"Unknown",pe));return s({},Y,re)}function Ss(L){return L=(L=L.stateNode)&&L.__reactInternalMemoizedMergedChildContext||qi,Wo=qr.current,Qn(qr,L),Qn(gs,gs.current),!0}function Dc(L,O,Y){var re=L.stateNode;if(!re)throw Error(a(169));Y?(L=Ro(L,O,Wo),re.__reactInternalMemoizedMergedChildContext=L,Er(gs),Er(qr),Qn(qr,L)):Er(gs),Qn(gs,Y)}var Ia=Math.clz32?Math.clz32:rg,sd=Math.log,Bc=Math.LN2;function rg(L){return L>>>=0,L===0?32:31-(sd(L)/Bc|0)|0}var bp=64,ig=4194304;function Xo(L){switch(L&-L){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return L&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return L&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return L}}function Yl(L,O){var Y=L.pendingLanes;if(Y===0)return 0;var re=0,pe=L.suspendedLanes,Te=L.pingedLanes,ft=Y&268435455;if(ft!==0){var Ot=ft&~pe;Ot!==0?re=Xo(Ot):(Te&=ft,Te!==0&&(re=Xo(Te)))}else ft=Y&~pe,ft!==0?re=Xo(ft):Te!==0&&(re=Xo(Te));if(re===0)return 0;if(O!==0&&O!==re&&!(O&pe)&&(pe=re&-re,Te=O&-O,pe>=Te||pe===16&&(Te&4194240)!==0))return O;if(re&4&&(re|=Y&16),O=L.entangledLanes,O!==0)for(L=L.entanglements,O&=re;0<O;)Y=31-Ia(O),pe=1<<Y,re|=L[Y],O&=~pe;return re}function wp(L,O){switch(L){case 1:case 2:case 4:return O+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return O+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function od(L,O){for(var Y=L.suspendedLanes,re=L.pingedLanes,pe=L.expirationTimes,Te=L.pendingLanes;0<Te;){var ft=31-Ia(Te),Ot=1<<ft,vn=pe[ft];vn===-1?(!(Ot&Y)||Ot&re)&&(pe[ft]=wp(Ot,O)):vn<=O&&(L.expiredLanes|=Ot),Te&=~Ot}}function Sp(L){return L=L.pendingLanes&-1073741825,L!==0?L:L&1073741824?1073741824:0}function zu(L){for(var O=[],Y=0;31>Y;Y++)O.push(L);return O}function Nh(L,O,Y){L.pendingLanes|=O,O!==536870912&&(L.suspendedLanes=0,L.pingedLanes=0),L=L.eventTimes,O=31-Ia(O),L[O]=Y}function ii(L,O){var Y=L.pendingLanes&~O;L.pendingLanes=O,L.suspendedLanes=0,L.pingedLanes=0,L.expiredLanes&=O,L.mutableReadLanes&=O,L.entangledLanes&=O,O=L.entanglements;var re=L.eventTimes;for(L=L.expirationTimes;0<Y;){var pe=31-Ia(Y),Te=1<<pe;O[pe]=0,re[pe]=-1,L[pe]=-1,Y&=~Te}}function Ap(L,O){var Y=L.entangledLanes|=O;for(L=L.entanglements;Y;){var re=31-Ia(Y),pe=1<<re;pe&O|L[re]&O&&(L[re]|=O),Y&=~pe}}var vr=0;function xx(L){return L&=-L,1<L?4<L?L&268435455?16:536870912:4:1}var cr=i.unstable_scheduleCallback,ad=i.unstable_cancelCallback,zh=i.unstable_shouldYield,ld=i.unstable_requestPaint,ys=i.unstable_now,cd=i.unstable_ImmediatePriority,Kl=i.unstable_UserBlockingPriority,On=i.unstable_NormalPriority,ei=i.unstable_IdlePriority,Zr=null,zs=null;function ma(L){if(zs&&typeof zs.onCommitFiberRoot=="function")try{zs.onCommitFiberRoot(Zr,L,void 0,(L.current.flags&128)===128)}catch{}}function ni(L,O){return L===O&&(L!==0||1/L===1/O)||L!==L&&O!==O}var ol=typeof Object.is=="function"?Object.is:ni,Xa=null,fu=!1,ia=!1;function As(L){Xa===null?Xa=[L]:Xa.push(L)}function bx(L){fu=!0,As(L)}function Ra(){if(!ia&&Xa!==null){ia=!0;var L=0,O=vr;try{var Y=Xa;for(vr=1;L<Y.length;L++){var re=Y[L];do re=re(!0);while(re!==null)}Xa=null,fu=!1}catch(pe){throw Xa!==null&&(Xa=Xa.slice(L+1)),cr(cd,Ra),pe}finally{vr=O,ia=!1}}return null}var ud=l.ReactCurrentBatchConfig;function al(L,O){if(ol(L,O))return!0;if(typeof L!="object"||L===null||typeof O!="object"||O===null)return!1;var Y=Object.keys(L),re=Object.keys(O);if(Y.length!==re.length)return!1;for(re=0;re<Y.length;re++){var pe=Y[re];if(!hi.call(O,pe)||!ol(L[pe],O[pe]))return!1}return!0}function sg(L){switch(L.tag){case 5:return lr(L.type);case 16:return lr("Lazy");case 13:return lr("Suspense");case 19:return lr("SuspenseList");case 0:case 2:case 15:return L=dr(L.type,!1),L;case 11:return L=dr(L.type.render,!1),L;case 1:return L=dr(L.type,!0),L;default:return""}}function Us(L,O){if(L&&L.defaultProps){O=s({},O),L=L.defaultProps;for(var Y in L)O[Y]===void 0&&(O[Y]=L[Y]);return O}return O}var Po=ws(null),$o=null,Uh=null,kc=null;function Ls(){kc=Uh=$o=null}function ga(L,O,Y){Tn?(Qn(Po,O._currentValue),O._currentValue=Y):(Qn(Po,O._currentValue2),O._currentValue2=Y)}function ll(L){var O=Po.current;Er(Po),Tn?L._currentValue=O:L._currentValue2=O}function $s(L,O,Y){for(;L!==null;){var re=L.alternate;if((L.childLanes&O)!==O?(L.childLanes|=O,re!==null&&(re.childLanes|=O)):re!==null&&(re.childLanes&O)!==O&&(re.childLanes|=O),L===Y)break;L=L.return}}function Uu(L,O){$o=L,kc=Uh=null,L=L.dependencies,L!==null&&L.firstContext!==null&&(L.lanes&O&&(xo=!0),L.firstContext=null)}function qs(L){var O=Tn?L._currentValue:L._currentValue2;if(kc!==L)if(L={context:L,memoizedValue:O,next:null},Uh===null){if($o===null)throw Error(a(308));Uh=L,$o.dependencies={lanes:0,firstContext:L}}else Uh=Uh.next=L;return O}var Pa=null,$a=!1;function du(L){L.updateQueue={baseState:L.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Tp(L,O){L=L.updateQueue,O.updateQueue===L&&(O.updateQueue={baseState:L.baseState,firstBaseUpdate:L.firstBaseUpdate,lastBaseUpdate:L.lastBaseUpdate,shared:L.shared,effects:L.effects})}function sa(L,O){return{eventTime:L,lane:O,tag:0,payload:null,callback:null,next:null}}function Vu(L,O){var Y=L.updateQueue;Y!==null&&(Y=Y.shared,Ys!==null&&L.mode&1&&!(fi&2)?(L=Y.interleaved,L===null?(O.next=O,Pa===null?Pa=[Y]:Pa.push(Y)):(O.next=L.next,L.next=O),Y.interleaved=O):(L=Y.pending,L===null?O.next=O:(O.next=L.next,L.next=O),Y.pending=O))}function Mp(L,O,Y){if(O=O.updateQueue,O!==null&&(O=O.shared,(Y&4194240)!==0)){var re=O.lanes;re&=L.pendingLanes,Y|=re,O.lanes=Y,Ap(L,Y)}}function La(L,O){var Y=L.updateQueue,re=L.alternate;if(re!==null&&(re=re.updateQueue,Y===re)){var pe=null,Te=null;if(Y=Y.firstBaseUpdate,Y!==null){do{var ft={eventTime:Y.eventTime,lane:Y.lane,tag:Y.tag,payload:Y.payload,callback:Y.callback,next:null};Te===null?pe=Te=ft:Te=Te.next=ft,Y=Y.next}while(Y!==null);Te===null?pe=Te=O:Te=Te.next=O}else pe=Te=O;Y={baseState:re.baseState,firstBaseUpdate:pe,lastBaseUpdate:Te,shared:re.shared,effects:re.effects},L.updateQueue=Y;return}L=Y.lastBaseUpdate,L===null?Y.firstBaseUpdate=O:L.next=O,Y.lastBaseUpdate=O}function og(L,O,Y,re){var pe=L.updateQueue;$a=!1;var Te=pe.firstBaseUpdate,ft=pe.lastBaseUpdate,Ot=pe.shared.pending;if(Ot!==null){pe.shared.pending=null;var vn=Ot,Wn=vn.next;vn.next=null,ft===null?Te=Wn:ft.next=Wn,ft=vn;var br=L.alternate;br!==null&&(br=br.updateQueue,Ot=br.lastBaseUpdate,Ot!==ft&&(Ot===null?br.firstBaseUpdate=Wn:Ot.next=Wn,br.lastBaseUpdate=vn))}if(Te!==null){var oi=pe.baseState;ft=0,br=Wn=vn=null,Ot=Te;do{var zr=Ot.lane,fs=Ot.eventTime;if((re&zr)===zr){br!==null&&(br=br.next={eventTime:fs,lane:0,tag:Ot.tag,payload:Ot.payload,callback:Ot.callback,next:null});e:{var Ir=L,co=Ot;switch(zr=O,fs=Y,co.tag){case 1:if(Ir=co.payload,typeof Ir=="function"){oi=Ir.call(fs,oi,zr);break e}oi=Ir;break e;case 3:Ir.flags=Ir.flags&-65537|128;case 0:if(Ir=co.payload,zr=typeof Ir=="function"?Ir.call(fs,oi,zr):Ir,zr==null)break e;oi=s({},oi,zr);break e;case 2:$a=!0}}Ot.callback!==null&&Ot.lane!==0&&(L.flags|=64,zr=pe.effects,zr===null?pe.effects=[Ot]:zr.push(Ot))}else fs={eventTime:fs,lane:zr,tag:Ot.tag,payload:Ot.payload,callback:Ot.callback,next:null},br===null?(Wn=br=fs,vn=oi):br=br.next=fs,ft|=zr;if(Ot=Ot.next,Ot===null){if(Ot=pe.shared.pending,Ot===null)break;zr=Ot,Ot=zr.next,zr.next=null,pe.lastBaseUpdate=zr,pe.shared.pending=null}}while(!0);if(br===null&&(vn=oi),pe.baseState=vn,pe.firstBaseUpdate=Wn,pe.lastBaseUpdate=br,O=pe.shared.interleaved,O!==null){pe=O;do ft|=pe.lane,pe=pe.next;while(pe!==O)}else Te===null&&(pe.shared.lanes=0);af|=ft,L.lanes=ft,L.memoizedState=oi}}function Cp(L,O,Y){if(L=O.effects,O.effects=null,L!==null)for(O=0;O<L.length;O++){var re=L[O],pe=re.callback;if(pe!==null){if(re.callback=null,re=Y,typeof pe!="function")throw Error(a(191,pe));pe.call(re)}}}var Dv=new r.Component().refs;function Gu(L,O,Y,re){O=L.memoizedState,Y=Y(re,O),Y=Y==null?O:s({},O,Y),L.memoizedState=Y,L.lanes===0&&(L.updateQueue.baseState=Y)}var pu={isMounted:function(L){return(L=L._reactInternals)?se(L)===L:!1},enqueueSetState:function(L,O,Y){L=L._reactInternals;var re=Ks(),pe=cc(L),Te=sa(re,pe);Te.payload=O,Y!=null&&(Te.callback=Y),Vu(L,Te),O=Ja(L,pe,re),O!==null&&Mp(O,L,pe)},enqueueReplaceState:function(L,O,Y){L=L._reactInternals;var re=Ks(),pe=cc(L),Te=sa(re,pe);Te.tag=1,Te.payload=O,Y!=null&&(Te.callback=Y),Vu(L,Te),O=Ja(L,pe,re),O!==null&&Mp(O,L,pe)},enqueueForceUpdate:function(L,O){L=L._reactInternals;var Y=Ks(),re=cc(L),pe=sa(Y,re);pe.tag=2,O!=null&&(pe.callback=O),Vu(L,pe),O=Ja(L,re,Y),O!==null&&Mp(O,L,re)}};function Sx(L,O,Y,re,pe,Te,ft){return L=L.stateNode,typeof L.shouldComponentUpdate=="function"?L.shouldComponentUpdate(re,Te,ft):O.prototype&&O.prototype.isPureReactComponent?!al(Y,re)||!al(pe,Te):!0}function hd(L,O,Y){var re=!1,pe=qi,Te=O.contextType;return typeof Te=="object"&&Te!==null?Te=qs(Te):(pe=us(O)?Wo:qr.current,re=O.contextTypes,Te=(re=re!=null)?Ps(L,pe):qi),O=new O(Y,Te),L.memoizedState=O.state!==null&&O.state!==void 0?O.state:null,O.updater=pu,L.stateNode=O,O._reactInternals=L,re&&(L=L.stateNode,L.__reactInternalMemoizedUnmaskedChildContext=pe,L.__reactInternalMemoizedMaskedChildContext=Te),O}function Hu(L,O,Y,re){L=O.state,typeof O.componentWillReceiveProps=="function"&&O.componentWillReceiveProps(Y,re),typeof O.UNSAFE_componentWillReceiveProps=="function"&&O.UNSAFE_componentWillReceiveProps(Y,re),O.state!==L&&pu.enqueueReplaceState(O,O.state,null)}function Bv(L,O,Y,re){var pe=L.stateNode;pe.props=Y,pe.state=L.memoizedState,pe.refs=Dv,du(L);var Te=O.contextType;typeof Te=="object"&&Te!==null?pe.context=qs(Te):(Te=us(O)?Wo:qr.current,pe.context=Ps(L,Te)),pe.state=L.memoizedState,Te=O.getDerivedStateFromProps,typeof Te=="function"&&(Gu(L,O,Te,Y),pe.state=L.memoizedState),typeof O.getDerivedStateFromProps=="function"||typeof pe.getSnapshotBeforeUpdate=="function"||typeof pe.UNSAFE_componentWillMount!="function"&&typeof pe.componentWillMount!="function"||(O=pe.state,typeof pe.componentWillMount=="function"&&pe.componentWillMount(),typeof pe.UNSAFE_componentWillMount=="function"&&pe.UNSAFE_componentWillMount(),O!==pe.state&&pu.enqueueReplaceState(pe,pe.state,null),og(L,Y,pe,re),pe.state=L.memoizedState),typeof pe.componentDidMount=="function"&&(L.flags|=4194308)}var Jl=[],Vh=0,Gh=null,va=0,Mr=[],$n=0,mu=null,pr=1,Ql="";function ec(L,O){Jl[Vh++]=va,Jl[Vh++]=Gh,Gh=L,va=O}function _r(L,O,Y){Mr[$n++]=pr,Mr[$n++]=Ql,Mr[$n++]=mu,mu=L;var re=pr;L=Ql;var pe=32-Ia(re)-1;re&=~(1<<pe),Y+=1;var Te=32-Ia(O)+pe;if(30<Te){var ft=pe-pe%5;Te=(re&(1<<ft)-1).toString(32),re>>=ft,pe-=ft,pr=1<<32-Ia(O)+pe|Y<<pe|re,Ql=Te+L}else pr=1<<Te|Y<<pe|re,Ql=L}function Ep(L){L.return!==null&&(ec(L,1),_r(L,1,0))}function fd(L){for(;L===Gh;)Gh=Jl[--Vh],Jl[Vh]=null,va=Jl[--Vh],Jl[Vh]=null;for(;L===mu;)mu=Mr[--$n],Mr[$n]=null,Ql=Mr[--$n],Mr[$n]=null,pr=Mr[--$n],Mr[$n]=null}var Da=null,yo=null,es=!1,oo=!1,qa=null;function Hh(L,O){var Y=Qa(5,null,null,0);Y.elementType="DELETED",Y.stateNode=O,Y.return=L,O=L.deletions,O===null?(L.deletions=[Y],L.flags|=16):O.push(Y)}function jh(L,O){switch(L.tag){case 5:return O=Ce(O,L.type,L.pendingProps),O!==null?(L.stateNode=O,Da=L,yo=Pt(O),!0):!1;case 6:return O=We(O,L.pendingProps),O!==null?(L.stateNode=O,Da=L,yo=null,!0):!1;case 13:if(O=nt(O),O!==null){var Y=mu!==null?{id:pr,overflow:Ql}:null;return L.memoizedState={dehydrated:O,treeContext:Y,retryLane:1073741824},Y=Qa(18,null,null,0),Y.stateNode=O,Y.return=L,L.child=Y,Da=L,yo=null,!0}return!1;default:return!1}}function dd(L){return(L.mode&1)!==0&&(L.flags&128)===0}function tc(L){if(es){var O=yo;if(O){var Y=O;if(!jh(L,O)){if(dd(L))throw Error(a(418));O=gt(Y);var re=Da;O&&jh(L,O)?Hh(re,Y):(L.flags=L.flags&-4097|2,es=!1,Da=L)}}else{if(dd(L))throw Error(a(418));L.flags=L.flags&-4097|2,es=!1,Da=L}}}function vs(L){for(L=L.return;L!==null&&L.tag!==5&&L.tag!==3&&L.tag!==13;)L=L.return;Da=L}function Wh(L){if(!mn||L!==Da)return!1;if(!es)return vs(L),es=!0,!1;if(L.tag!==3&&(L.tag!==5||wn(L.type)&&!Ht(L.type,L.memoizedProps))){var O=yo;if(O){if(dd(L)){for(L=yo;L;)L=gt(L);throw Error(a(418))}for(;O;)Hh(L,O),O=gt(O)}}if(vs(L),L.tag===13){if(!mn)throw Error(a(316));if(L=L.memoizedState,L=L!==null?L.dehydrated:null,!L)throw Error(a(317));yo=Ve(L)}else yo=Da?gt(L.stateNode):null;return!0}function yn(){mn&&(yo=Da=null,oo=es=!1)}function ag(L){qa===null?qa=[L]:qa.push(L)}function Oc(L,O,Y){if(L=Y.ref,L!==null&&typeof L!="function"&&typeof L!="object"){if(Y._owner){if(Y=Y._owner,Y){if(Y.tag!==1)throw Error(a(309));var re=Y.stateNode}if(!re)throw Error(a(147,L));var pe=re,Te=""+L;return O!==null&&O.ref!==null&&typeof O.ref=="function"&&O.ref._stringRef===Te?O.ref:(O=function(ft){var Ot=pe.refs;Ot===Dv&&(Ot=pe.refs={}),ft===null?delete Ot[Te]:Ot[Te]=ft},O._stringRef=Te,O)}if(typeof L!="string")throw Error(a(284));if(!Y._owner)throw Error(a(290,L))}return L}function Xh(L,O){throw L=Object.prototype.toString.call(O),Error(a(31,L==="[object Object]"?"object with keys {"+Object.keys(O).join(", ")+"}":L))}function Ip(L){var O=L._init;return O(L._payload)}function Rp(L){function O(Xt,Nt){if(L){var on=Xt.deletions;on===null?(Xt.deletions=[Nt],Xt.flags|=16):on.push(Nt)}}function Y(Xt,Nt){if(!L)return null;for(;Nt!==null;)O(Xt,Nt),Nt=Nt.sibling;return null}function re(Xt,Nt){for(Xt=new Map;Nt!==null;)Nt.key!==null?Xt.set(Nt.key,Nt):Xt.set(Nt.index,Nt),Nt=Nt.sibling;return Xt}function pe(Xt,Nt){return Xt=wu(Xt,Nt),Xt.index=0,Xt.sibling=null,Xt}function Te(Xt,Nt,on){return Xt.index=on,L?(on=Xt.alternate,on!==null?(on=on.index,on<Nt?(Xt.flags|=2,Nt):on):(Xt.flags|=2,Nt)):(Xt.flags|=1048576,Nt)}function ft(Xt){return L&&Xt.alternate===null&&(Xt.flags|=2),Xt}function Ot(Xt,Nt,on,rr){return Nt===null||Nt.tag!==6?(Nt=tm(on,Xt.mode,rr),Nt.return=Xt,Nt):(Nt=pe(Nt,on),Nt.return=Xt,Nt)}function vn(Xt,Nt,on,rr){var Rr=on.type;return Rr===d?br(Xt,Nt,on.props.children,rr,on.key):Nt!==null&&(Nt.elementType===Rr||typeof Rr=="object"&&Rr!==null&&Rr.$$typeof===k&&Ip(Rr)===Nt.type)?(rr=pe(Nt,on.props),rr.ref=Oc(Xt,Nt,on),rr.return=Xt,rr):(rr=Qp(on.type,on.key,on.props,null,Xt.mode,rr),rr.ref=Oc(Xt,Nt,on),rr.return=Xt,rr)}function Wn(Xt,Nt,on,rr){return Nt===null||Nt.tag!==4||Nt.stateNode.containerInfo!==on.containerInfo||Nt.stateNode.implementation!==on.implementation?(Nt=i_(on,Xt.mode,rr),Nt.return=Xt,Nt):(Nt=pe(Nt,on.children||[]),Nt.return=Xt,Nt)}function br(Xt,Nt,on,rr,Rr){return Nt===null||Nt.tag!==7?(Nt=eh(on,Xt.mode,rr,Rr),Nt.return=Xt,Nt):(Nt=pe(Nt,on),Nt.return=Xt,Nt)}function oi(Xt,Nt,on){if(typeof Nt=="string"&&Nt!==""||typeof Nt=="number")return Nt=tm(""+Nt,Xt.mode,on),Nt.return=Xt,Nt;if(typeof Nt=="object"&&Nt!==null){switch(Nt.$$typeof){case o:return on=Qp(Nt.type,Nt.key,Nt.props,null,Xt.mode,on),on.ref=Oc(Xt,null,Nt),on.return=Xt,on;case h:return Nt=i_(Nt,Xt.mode,on),Nt.return=Xt,Nt;case k:var rr=Nt._init;return oi(Xt,rr(Nt._payload),on)}if(qe(Nt)||Z(Nt))return Nt=eh(Nt,Xt.mode,on,null),Nt.return=Xt,Nt;Xh(Xt,Nt)}return null}function zr(Xt,Nt,on,rr){var Rr=Nt!==null?Nt.key:null;if(typeof on=="string"&&on!==""||typeof on=="number")return Rr!==null?null:Ot(Xt,Nt,""+on,rr);if(typeof on=="object"&&on!==null){switch(on.$$typeof){case o:return on.key===Rr?vn(Xt,Nt,on,rr):null;case h:return on.key===Rr?Wn(Xt,Nt,on,rr):null;case k:return Rr=on._init,zr(Xt,Nt,Rr(on._payload),rr)}if(qe(on)||Z(on))return Rr!==null?null:br(Xt,Nt,on,rr,null);Xh(Xt,on)}return null}function fs(Xt,Nt,on,rr,Rr){if(typeof rr=="string"&&rr!==""||typeof rr=="number")return Xt=Xt.get(on)||null,Ot(Nt,Xt,""+rr,Rr);if(typeof rr=="object"&&rr!==null){switch(rr.$$typeof){case o:return Xt=Xt.get(rr.key===null?on:rr.key)||null,vn(Nt,Xt,rr,Rr);case h:return Xt=Xt.get(rr.key===null?on:rr.key)||null,Wn(Nt,Xt,rr,Rr);case k:var mi=rr._init;return fs(Xt,Nt,on,mi(rr._payload),Rr)}if(qe(rr)||Z(rr))return Xt=Xt.get(on)||null,br(Nt,Xt,rr,Rr,null);Xh(Nt,rr)}return null}function Ir(Xt,Nt,on,rr){for(var Rr=null,mi=null,ai=Nt,Fi=Nt=0,b=null;ai!==null&&Fi<on.length;Fi++){ai.index>Fi?(b=ai,ai=null):b=ai.sibling;var u=zr(Xt,ai,on[Fi],rr);if(u===null){ai===null&&(ai=b);break}L&&ai&&u.alternate===null&&O(Xt,ai),Nt=Te(u,Nt,Fi),mi===null?Rr=u:mi.sibling=u,mi=u,ai=b}if(Fi===on.length)return Y(Xt,ai),es&&ec(Xt,Fi),Rr;if(ai===null){for(;Fi<on.length;Fi++)ai=oi(Xt,on[Fi],rr),ai!==null&&(Nt=Te(ai,Nt,Fi),mi===null?Rr=ai:mi.sibling=ai,mi=ai);return es&&ec(Xt,Fi),Rr}for(ai=re(Xt,ai);Fi<on.length;Fi++)b=fs(ai,Xt,Fi,on[Fi],rr),b!==null&&(L&&b.alternate!==null&&ai.delete(b.key===null?Fi:b.key),Nt=Te(b,Nt,Fi),mi===null?Rr=b:mi.sibling=b,mi=b);return L&&ai.forEach(function(p){return O(Xt,p)}),es&&ec(Xt,Fi),Rr}function co(Xt,Nt,on,rr){var Rr=Z(on);if(typeof Rr!="function")throw Error(a(150));if(on=Rr.call(on),on==null)throw Error(a(151));for(var mi=Rr=null,ai=Nt,Fi=Nt=0,b=null,u=on.next();ai!==null&&!u.done;Fi++,u=on.next()){ai.index>Fi?(b=ai,ai=null):b=ai.sibling;var p=zr(Xt,ai,u.value,rr);if(p===null){ai===null&&(ai=b);break}L&&ai&&p.alternate===null&&O(Xt,ai),Nt=Te(p,Nt,Fi),mi===null?Rr=p:mi.sibling=p,mi=p,ai=b}if(u.done)return Y(Xt,ai),es&&ec(Xt,Fi),Rr;if(ai===null){for(;!u.done;Fi++,u=on.next())u=oi(Xt,u.value,rr),u!==null&&(Nt=Te(u,Nt,Fi),mi===null?Rr=u:mi.sibling=u,mi=u);return es&&ec(Xt,Fi),Rr}for(ai=re(Xt,ai);!u.done;Fi++,u=on.next())u=fs(ai,Xt,Fi,u.value,rr),u!==null&&(L&&u.alternate!==null&&ai.delete(u.key===null?Fi:u.key),Nt=Te(u,Nt,Fi),mi===null?Rr=u:mi.sibling=u,mi=u);return L&&ai.forEach(function(w){return O(Xt,w)}),es&&ec(Xt,Fi),Rr}function uo(Xt,Nt,on,rr){if(typeof on=="object"&&on!==null&&on.type===d&&on.key===null&&(on=on.props.children),typeof on=="object"&&on!==null){switch(on.$$typeof){case o:e:{for(var Rr=on.key,mi=Nt;mi!==null;){if(mi.key===Rr){if(Rr=on.type,Rr===d){if(mi.tag===7){Y(Xt,mi.sibling),Nt=pe(mi,on.props.children),Nt.return=Xt,Xt=Nt;break e}}else if(mi.elementType===Rr||typeof Rr=="object"&&Rr!==null&&Rr.$$typeof===k&&Ip(Rr)===mi.type){Y(Xt,mi.sibling),Nt=pe(mi,on.props),Nt.ref=Oc(Xt,mi,on),Nt.return=Xt,Xt=Nt;break e}Y(Xt,mi);break}else O(Xt,mi);mi=mi.sibling}on.type===d?(Nt=eh(on.props.children,Xt.mode,rr,on.key),Nt.return=Xt,Xt=Nt):(rr=Qp(on.type,on.key,on.props,null,Xt.mode,rr),rr.ref=Oc(Xt,Nt,on),rr.return=Xt,Xt=rr)}return ft(Xt);case h:e:{for(mi=on.key;Nt!==null;){if(Nt.key===mi)if(Nt.tag===4&&Nt.stateNode.containerInfo===on.containerInfo&&Nt.stateNode.implementation===on.implementation){Y(Xt,Nt.sibling),Nt=pe(Nt,on.children||[]),Nt.return=Xt,Xt=Nt;break e}else{Y(Xt,Nt);break}else O(Xt,Nt);Nt=Nt.sibling}Nt=i_(on,Xt.mode,rr),Nt.return=Xt,Xt=Nt}return ft(Xt);case k:return mi=on._init,uo(Xt,Nt,mi(on._payload),rr)}if(qe(on))return Ir(Xt,Nt,on,rr);if(Z(on))return co(Xt,Nt,on,rr);Xh(Xt,on)}return typeof on=="string"&&on!==""||typeof on=="number"?(on=""+on,Nt!==null&&Nt.tag===6?(Y(Xt,Nt.sibling),Nt=pe(Nt,on),Nt.return=Xt,Xt=Nt):(Y(Xt,Nt),Nt=tm(on,Xt.mode,rr),Nt.return=Xt,Xt=Nt),ft(Xt)):Y(Xt,Nt)}return uo}var Za=Rp(!0),lg=Rp(!1),oa={},Ba=ws(oa),Fc=ws(oa),$h=ws(oa);function nc(L){if(L===oa)throw Error(a(174));return L}function ka(L,O){Qn($h,O),Qn(Fc,L),Qn(Ba,oa),L=dt(O),Er(Ba),Qn(Ba,L)}function qh(){Er(Ba),Er(Fc),Er($h)}function cg(L){var O=nc($h.current),Y=nc(Ba.current);O=ye(Y,L.type,O),Y!==O&&(Qn(Fc,L),Qn(Ba,O))}function Pp(L){Fc.current===L&&(Er(Ba),Er(Fc))}var Ts=ws(0);function Lp(L){for(var O=L;O!==null;){if(O.tag===13){var Y=O.memoizedState;if(Y!==null&&(Y=Y.dehydrated,Y===null||Je(Y)||pt(Y)))return O}else if(O.tag===19&&O.memoizedProps.revealOrder!==void 0){if(O.flags&128)return O}else if(O.child!==null){O.child.return=O,O=O.child;continue}if(O===L)break;for(;O.sibling===null;){if(O.return===null||O.return===L)return null;O=O.return}O.sibling.return=O.return,O=O.sibling}return null}var ug=[];function hg(){for(var L=0;L<ug.length;L++){var O=ug[L];Tn?O._workInProgressVersionPrimary=null:O._workInProgressVersionSecondary=null}ug.length=0}var Dp=l.ReactCurrentDispatcher,Ya=l.ReactCurrentBatchConfig,Zh=0,Ms=null,Lo=null,Zs=null,gu=!1,vu=!1,ju=0,Wu=0;function Vs(){throw Error(a(321))}function Kr(L,O){if(O===null)return!1;for(var Y=0;Y<O.length&&Y<L.length;Y++)if(!ol(L[Y],O[Y]))return!1;return!0}function Xu(L,O,Y,re,pe,Te){if(Zh=Te,Ms=O,O.memoizedState=null,O.updateQueue=null,O.lanes=0,Dp.current=L===null||L.memoizedState===null?Hv:Np,L=Y(re,pe),vu){Te=0;do{if(vu=!1,ju=0,25<=Te)throw Error(a(301));Te+=1,Zs=Lo=null,O.updateQueue=null,Dp.current=wg,L=Y(re,pe)}while(vu)}if(Dp.current=Jh,O=Lo!==null&&Lo.next!==null,Zh=0,Zs=Lo=Ms=null,gu=!1,O)throw Error(a(300));return L}function Yh(){var L=ju!==0;return ju=0,L}function Tl(){var L={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Zs===null?Ms.memoizedState=Zs=L:Zs=Zs.next=L,Zs}function cl(){if(Lo===null){var L=Ms.alternate;L=L!==null?L.memoizedState:null}else L=Lo.next;var O=Zs===null?Ms.memoizedState:Zs.next;if(O!==null)Zs=O,Lo=L;else{if(L===null)throw Error(a(310));Lo=L,L={memoizedState:Lo.memoizedState,baseState:Lo.baseState,baseQueue:Lo.baseQueue,queue:Lo.queue,next:null},Zs===null?Ms.memoizedState=Zs=L:Zs=Zs.next=L}return Zs}function rc(L,O){return typeof O=="function"?O(L):O}function yi(L){var O=cl(),Y=O.queue;if(Y===null)throw Error(a(311));Y.lastRenderedReducer=L;var re=Lo,pe=re.baseQueue,Te=Y.pending;if(Te!==null){if(pe!==null){var ft=pe.next;pe.next=Te.next,Te.next=ft}re.baseQueue=pe=Te,Y.pending=null}if(pe!==null){Te=pe.next,re=re.baseState;var Ot=ft=null,vn=null,Wn=Te;do{var br=Wn.lane;if((Zh&br)===br)vn!==null&&(vn=vn.next={lane:0,action:Wn.action,hasEagerState:Wn.hasEagerState,eagerState:Wn.eagerState,next:null}),re=Wn.hasEagerState?Wn.eagerState:L(re,Wn.action);else{var oi={lane:br,action:Wn.action,hasEagerState:Wn.hasEagerState,eagerState:Wn.eagerState,next:null};vn===null?(Ot=vn=oi,ft=re):vn=vn.next=oi,Ms.lanes|=br,af|=br}Wn=Wn.next}while(Wn!==null&&Wn!==Te);vn===null?ft=re:vn.next=Ot,ol(re,O.memoizedState)||(xo=!0),O.memoizedState=re,O.baseState=ft,O.baseQueue=vn,Y.lastRenderedState=re}if(L=Y.interleaved,L!==null){pe=L;do Te=pe.lane,Ms.lanes|=Te,af|=Te,pe=pe.next;while(pe!==L)}else pe===null&&(Y.lanes=0);return[O.memoizedState,Y.dispatch]}function pd(L){var O=cl(),Y=O.queue;if(Y===null)throw Error(a(311));Y.lastRenderedReducer=L;var re=Y.dispatch,pe=Y.pending,Te=O.memoizedState;if(pe!==null){Y.pending=null;var ft=pe=pe.next;do Te=L(Te,ft.action),ft=ft.next;while(ft!==pe);ol(Te,O.memoizedState)||(xo=!0),O.memoizedState=Te,O.baseQueue===null&&(O.baseState=Te),Y.lastRenderedState=Te}return[Te,re]}function kv(){}function fg(L,O){var Y=Ms,re=cl(),pe=O(),Te=!ol(re.memoizedState,pe);if(Te&&(re.memoizedState=pe,xo=!0),re=re.queue,Kh(Ov.bind(null,Y,re,L),[L]),re.getSnapshot!==O||Te||Zs!==null&&Zs.memoizedState.tag&1){if(Y.flags|=2048,Nc(9,md.bind(null,Y,re,pe,O),void 0,null),Ys===null)throw Error(a(349));Zh&30||Bp(Y,O,pe)}return pe}function Bp(L,O,Y){L.flags|=16384,L={getSnapshot:O,value:Y},O=Ms.updateQueue,O===null?(O={lastEffect:null,stores:null},Ms.updateQueue=O,O.stores=[L]):(Y=O.stores,Y===null?O.stores=[L]:Y.push(L))}function md(L,O,Y,re){O.value=Y,O.getSnapshot=re,Fv(O)&&Ja(L,1,-1)}function Ov(L,O,Y){return Y(function(){Fv(O)&&Ja(L,1,-1)})}function Fv(L){var O=L.getSnapshot;L=L.value;try{var Y=O();return!ol(L,Y)}catch{return!0}}function dg(L){var O=Tl();return typeof L=="function"&&(L=L()),O.memoizedState=O.baseState=L,L={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:rc,lastRenderedState:L},O.queue=L,L=L.dispatch=Gv.bind(null,Ms,L),[O.memoizedState,L]}function Nc(L,O,Y,re){return L={tag:L,create:O,destroy:Y,deps:re,next:null},O=Ms.updateQueue,O===null?(O={lastEffect:null,stores:null},Ms.updateQueue=O,O.lastEffect=L.next=L):(Y=O.lastEffect,Y===null?O.lastEffect=L.next=L:(re=Y.next,Y.next=L,L.next=re,O.lastEffect=L)),L}function Nv(){return cl().memoizedState}function pg(L,O,Y,re){var pe=Tl();Ms.flags|=L,pe.memoizedState=Nc(1|O,Y,void 0,re===void 0?null:re)}function mg(L,O,Y,re){var pe=cl();re=re===void 0?null:re;var Te=void 0;if(Lo!==null){var ft=Lo.memoizedState;if(Te=ft.destroy,re!==null&&Kr(re,ft.deps)){pe.memoizedState=Nc(O,Y,Te,re);return}}Ms.flags|=L,pe.memoizedState=Nc(1|O,Y,Te,re)}function zv(L,O){return pg(8390656,8,L,O)}function Kh(L,O){return mg(2048,8,L,O)}function gg(L,O){return mg(4,2,L,O)}function vg(L,O){return mg(4,4,L,O)}function _g(L,O){if(typeof O=="function")return L=L(),O(L),function(){O(null)};if(O!=null)return L=L(),O.current=L,function(){O.current=null}}function Uv(L,O,Y){return Y=Y!=null?Y.concat([L]):null,mg(4,4,_g.bind(null,O,L),Y)}function yg(){}function Ax(L,O){var Y=cl();O=O===void 0?null:O;var re=Y.memoizedState;return re!==null&&O!==null&&Kr(O,re[1])?re[0]:(Y.memoizedState=[L,O],L)}function gd(L,O){var Y=cl();O=O===void 0?null:O;var re=Y.memoizedState;return re!==null&&O!==null&&Kr(O,re[1])?re[0]:(L=L(),Y.memoizedState=[L,O],L)}function kp(L,O){var Y=vr;vr=Y!==0&&4>Y?Y:4,L(!0);var re=Ya.transition;Ya.transition={};try{L(!1),O()}finally{vr=Y,Ya.transition=re}}function Vv(){return cl().memoizedState}function ul(L,O,Y){var re=cc(L);Y={lane:re,action:Y,hasEagerState:!1,eagerState:null,next:null},Op(L)?Fp(O,Y):(xg(L,O,Y),Y=Ks(),L=Ja(L,re,Y),L!==null&&bg(L,O,re))}function Gv(L,O,Y){var re=cc(L),pe={lane:re,action:Y,hasEagerState:!1,eagerState:null,next:null};if(Op(L))Fp(O,pe);else{xg(L,O,pe);var Te=L.alternate;if(L.lanes===0&&(Te===null||Te.lanes===0)&&(Te=O.lastRenderedReducer,Te!==null))try{var ft=O.lastRenderedState,Ot=Te(ft,Y);if(pe.hasEagerState=!0,pe.eagerState=Ot,ol(Ot,ft))return}catch{}finally{}Y=Ks(),L=Ja(L,re,Y),L!==null&&bg(L,O,re)}}function Op(L){var O=L.alternate;return L===Ms||O!==null&&O===Ms}function Fp(L,O){vu=gu=!0;var Y=L.pending;Y===null?O.next=O:(O.next=Y.next,Y.next=O),L.pending=O}function xg(L,O,Y){Ys!==null&&L.mode&1&&!(fi&2)?(L=O.interleaved,L===null?(Y.next=Y,Pa===null?Pa=[O]:Pa.push(O)):(Y.next=L.next,L.next=Y),O.interleaved=Y):(L=O.pending,L===null?Y.next=Y:(Y.next=L.next,L.next=Y),O.pending=Y)}function bg(L,O,Y){if(Y&4194240){var re=O.lanes;re&=L.pendingLanes,Y|=re,O.lanes=Y,Ap(L,Y)}}var Jh={readContext:qs,useCallback:Vs,useContext:Vs,useEffect:Vs,useImperativeHandle:Vs,useInsertionEffect:Vs,useLayoutEffect:Vs,useMemo:Vs,useReducer:Vs,useRef:Vs,useState:Vs,useDebugValue:Vs,useDeferredValue:Vs,useTransition:Vs,useMutableSource:Vs,useSyncExternalStore:Vs,useId:Vs,unstable_isNewReconciler:!1},Hv={readContext:qs,useCallback:function(L,O){return Tl().memoizedState=[L,O===void 0?null:O],L},useContext:qs,useEffect:zv,useImperativeHandle:function(L,O,Y){return Y=Y!=null?Y.concat([L]):null,pg(4194308,4,_g.bind(null,O,L),Y)},useLayoutEffect:function(L,O){return pg(4194308,4,L,O)},useInsertionEffect:function(L,O){return pg(4,2,L,O)},useMemo:function(L,O){var Y=Tl();return O=O===void 0?null:O,L=L(),Y.memoizedState=[L,O],L},useReducer:function(L,O,Y){var re=Tl();return O=Y!==void 0?Y(O):O,re.memoizedState=re.baseState=O,L={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:L,lastRenderedState:O},re.queue=L,L=L.dispatch=ul.bind(null,Ms,L),[re.memoizedState,L]},useRef:function(L){var O=Tl();return L={current:L},O.memoizedState=L},useState:dg,useDebugValue:yg,useDeferredValue:function(L){var O=dg(L),Y=O[0],re=O[1];return zv(function(){var pe=Ya.transition;Ya.transition={};try{re(L)}finally{Ya.transition=pe}},[L]),Y},useTransition:function(){var L=dg(!1),O=L[0];return L=kp.bind(null,L[1]),Tl().memoizedState=L,[O,L]},useMutableSource:function(){},useSyncExternalStore:function(L,O,Y){var re=Ms,pe=Tl();if(es){if(Y===void 0)throw Error(a(407));Y=Y()}else{if(Y=O(),Ys===null)throw Error(a(349));Zh&30||Bp(re,O,Y)}pe.memoizedState=Y;var Te={value:Y,getSnapshot:O};return pe.queue=Te,zv(Ov.bind(null,re,Te,L),[L]),re.flags|=2048,Nc(9,md.bind(null,re,Te,Y,O),void 0,null),Y},useId:function(){var L=Tl(),O=Ys.identifierPrefix;if(es){var Y=Ql,re=pr;Y=(re&~(1<<32-Ia(re)-1)).toString(32)+Y,O=":"+O+"R"+Y,Y=ju++,0<Y&&(O+="H"+Y.toString(32)),O+=":"}else Y=Wu++,O=":"+O+"r"+Y.toString(32)+":";return L.memoizedState=O},unstable_isNewReconciler:!1},Np={readContext:qs,useCallback:Ax,useContext:qs,useEffect:Kh,useImperativeHandle:Uv,useInsertionEffect:gg,useLayoutEffect:vg,useMemo:gd,useReducer:yi,useRef:Nv,useState:function(){return yi(rc)},useDebugValue:yg,useDeferredValue:function(L){var O=yi(rc),Y=O[0],re=O[1];return Kh(function(){var pe=Ya.transition;Ya.transition={};try{re(L)}finally{Ya.transition=pe}},[L]),Y},useTransition:function(){var L=yi(rc)[0],O=cl().memoizedState;return[L,O]},useMutableSource:kv,useSyncExternalStore:fg,useId:Vv,unstable_isNewReconciler:!1},wg={readContext:qs,useCallback:Ax,useContext:qs,useEffect:Kh,useImperativeHandle:Uv,useInsertionEffect:gg,useLayoutEffect:vg,useMemo:gd,useReducer:pd,useRef:Nv,useState:function(){return pd(rc)},useDebugValue:yg,useDeferredValue:function(L){var O=pd(rc),Y=O[0],re=O[1];return Kh(function(){var pe=Ya.transition;Ya.transition={};try{re(L)}finally{Ya.transition=pe}},[L]),Y},useTransition:function(){var L=pd(rc)[0],O=cl().memoizedState;return[L,O]},useMutableSource:kv,useSyncExternalStore:fg,useId:Vv,unstable_isNewReconciler:!1};function zp(L,O){try{var Y="",re=O;do Y+=sg(re),re=re.return;while(re);var pe=Y}catch(Te){pe=`
Error generating stack: `+Te.message+`
`+Te.stack}return{value:L,source:O,stack:pe}}function Sg(L,O){try{console.error(O.value)}catch(Y){setTimeout(function(){throw Y})}}var vd=typeof WeakMap=="function"?WeakMap:Map;function Tx(L,O,Y){Y=sa(-1,Y),Y.tag=3,Y.payload={element:null};var re=O.value;return Y.callback=function(){Ka||(Ka=!0,e_=re),Sg(L,O)},Y}function jv(L,O,Y){Y=sa(-1,Y),Y.tag=3;var re=L.type.getDerivedStateFromError;if(typeof re=="function"){var pe=O.value;Y.payload=function(){return re(pe)},Y.callback=function(){Sg(L,O)}}var Te=L.stateNode;return Te!==null&&typeof Te.componentDidCatch=="function"&&(Y.callback=function(){Sg(L,O),typeof re!="function"&&(Gs===null?Gs=new Set([this]):Gs.add(this));var ft=O.stack;this.componentDidCatch(O.value,{componentStack:ft!==null?ft:""})}),Y}function Wv(L,O,Y){var re=L.pingCache;if(re===null){re=L.pingCache=new vd;var pe=new Set;re.set(O,pe)}else pe=re.get(O),pe===void 0&&(pe=new Set,re.set(O,pe));pe.has(Y)||(pe.add(Y),L=zg.bind(null,L,O,Y),O.then(L,L))}function Qh(L){do{var O;if((O=L.tag===13)&&(O=L.memoizedState,O=O!==null?O.dehydrated!==null:!0),O)return L;L=L.return}while(L!==null);return null}function Xv(L,O,Y,re,pe){return L.mode&1?(L.flags|=65536,L.lanes=pe,L):(L===O?L.flags|=65536:(L.flags|=128,Y.flags|=131072,Y.flags&=-52805,Y.tag===1&&(Y.alternate===null?Y.tag=17:(O=sa(-1,1),O.tag=2,Vu(Y,O))),Y.lanes|=1),L)}function ic(L){L.flags|=4}function Ag(L,O){if(L!==null&&L.child===O.child)return!0;if(O.flags&16)return!1;for(L=O.child;L!==null;){if(L.flags&12854||L.subtreeFlags&12854)return!1;L=L.sibling}return!0}var _u,$u,yu,Up;if(Pe)_u=function(L,O){for(var Y=O.child;Y!==null;){if(Y.tag===5||Y.tag===6)wt(L,Y.stateNode);else if(Y.tag!==4&&Y.child!==null){Y.child.return=Y,Y=Y.child;continue}if(Y===O)break;for(;Y.sibling===null;){if(Y.return===null||Y.return===O)return;Y=Y.return}Y.sibling.return=Y.return,Y=Y.sibling}},$u=function(){},yu=function(L,O,Y,re,pe){if(L=L.memoizedProps,L!==re){var Te=O.stateNode,ft=nc(Ba.current);Y=at(Te,Y,L,re,pe,ft),(O.updateQueue=Y)&&ic(O)}},Up=function(L,O,Y,re){Y!==re&&ic(O)};else if($e){_u=function(L,O,Y,re){for(var pe=O.child;pe!==null;){if(pe.tag===5){var Te=pe.stateNode;Y&&re&&(Te=Tt(Te,pe.type,pe.memoizedProps,pe)),wt(L,Te)}else if(pe.tag===6)Te=pe.stateNode,Y&&re&&(Te=xe(Te,pe.memoizedProps,pe)),wt(L,Te);else if(pe.tag!==4){if(pe.tag===22&&pe.memoizedState!==null)Te=pe.child,Te!==null&&(Te.return=pe),_u(L,pe,!0,!0);else if(pe.child!==null){pe.child.return=pe,pe=pe.child;continue}}if(pe===O)break;for(;pe.sibling===null;){if(pe.return===null||pe.return===O)return;pe=pe.return}pe.sibling.return=pe.return,pe=pe.sibling}};var Tg=function(L,O,Y,re){for(var pe=O.child;pe!==null;){if(pe.tag===5){var Te=pe.stateNode;Y&&re&&(Te=Tt(Te,pe.type,pe.memoizedProps,pe)),cs(L,Te)}else if(pe.tag===6)Te=pe.stateNode,Y&&re&&(Te=xe(Te,pe.memoizedProps,pe)),cs(L,Te);else if(pe.tag!==4){if(pe.tag===22&&pe.memoizedState!==null)Te=pe.child,Te!==null&&(Te.return=pe),Tg(L,pe,!0,!0);else if(pe.child!==null){pe.child.return=pe,pe=pe.child;continue}}if(pe===O)break;for(;pe.sibling===null;){if(pe.return===null||pe.return===O)return;pe=pe.return}pe.sibling.return=pe.return,pe=pe.sibling}};$u=function(L,O){var Y=O.stateNode;if(!Ag(L,O)){L=Y.containerInfo;var re=Gr(L);Tg(re,O,!1,!1),Y.pendingChildren=re,ic(O),Rs(L,re)}},yu=function(L,O,Y,re,pe){var Te=L.stateNode,ft=L.memoizedProps;if((L=Ag(L,O))&&ft===re)O.stateNode=Te;else{var Ot=O.stateNode,vn=nc(Ba.current),Wn=null;ft!==re&&(Wn=at(Ot,Y,ft,re,pe,vn)),L&&Wn===null?O.stateNode=Te:(Te=Ar(Te,Wn,Y,ft,re,O,L,Ot),Gt(Te,Y,re,pe,vn)&&ic(O),O.stateNode=Te,L?ic(O):_u(Te,O,!1,!1))}},Up=function(L,O,Y,re){Y!==re?(L=nc($h.current),Y=nc(Ba.current),O.stateNode=Qt(re,L,Y,O),ic(O)):O.stateNode=L.stateNode}}else $u=function(){},yu=function(){},Up=function(){};function ef(L,O){if(!es)switch(L.tailMode){case"hidden":O=L.tail;for(var Y=null;O!==null;)O.alternate!==null&&(Y=O),O=O.sibling;Y===null?L.tail=null:Y.sibling=null;break;case"collapsed":Y=L.tail;for(var re=null;Y!==null;)Y.alternate!==null&&(re=Y),Y=Y.sibling;re===null?O||L.tail===null?L.tail=null:L.tail.sibling=null:re.sibling=null}}function qo(L){var O=L.alternate!==null&&L.alternate.child===L.child,Y=0,re=0;if(O)for(var pe=L.child;pe!==null;)Y|=pe.lanes|pe.childLanes,re|=pe.subtreeFlags&14680064,re|=pe.flags&14680064,pe.return=L,pe=pe.sibling;else for(pe=L.child;pe!==null;)Y|=pe.lanes|pe.childLanes,re|=pe.subtreeFlags,re|=pe.flags,pe.return=L,pe=pe.sibling;return L.subtreeFlags|=re,L.childLanes=Y,O}function tf(L,O,Y){var re=O.pendingProps;switch(fd(O),O.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return qo(O),null;case 1:return us(O.type)&&Ri(),qo(O),null;case 3:return re=O.stateNode,qh(),Er(gs),Er(qr),hg(),re.pendingContext&&(re.context=re.pendingContext,re.pendingContext=null),(L===null||L.child===null)&&(Wh(O)?ic(O):L===null||L.memoizedState.isDehydrated&&!(O.flags&256)||(O.flags|=1024,qa!==null&&(Ed(qa),qa=null))),$u(L,O),qo(O),null;case 5:Pp(O),Y=nc($h.current);var pe=O.type;if(L!==null&&O.stateNode!=null)yu(L,O,pe,re,Y),L.ref!==O.ref&&(O.flags|=512,O.flags|=2097152);else{if(!re){if(O.stateNode===null)throw Error(a(166));return qo(O),null}if(L=nc(Ba.current),Wh(O)){if(!mn)throw Error(a(175));L=ln(O.stateNode,O.type,O.memoizedProps,Y,L,O,!oo),O.updateQueue=L,L!==null&&ic(O)}else{var Te=_t(pe,re,Y,L,O);_u(Te,O,!1,!1),O.stateNode=Te,Gt(Te,pe,re,Y,L)&&ic(O)}O.ref!==null&&(O.flags|=512,O.flags|=2097152)}return qo(O),null;case 6:if(L&&O.stateNode!=null)Up(L,O,L.memoizedProps,re);else{if(typeof re!="string"&&O.stateNode===null)throw Error(a(166));if(L=nc($h.current),Y=nc(Ba.current),Wh(O)){if(!mn)throw Error(a(176));if(L=O.stateNode,re=O.memoizedProps,(Y=Mn(L,re,O,!oo))&&(pe=Da,pe!==null))switch(Te=(pe.mode&1)!==0,pe.tag){case 3:_n(pe.stateNode.containerInfo,L,re,Te);break;case 5:zn(pe.type,pe.memoizedProps,pe.stateNode,L,re,Te)}Y&&ic(O)}else O.stateNode=Qt(re,L,Y,O)}return qo(O),null;case 13:if(Er(Ts),re=O.memoizedState,es&&yo!==null&&O.mode&1&&!(O.flags&128)){for(L=yo;L;)L=gt(L);return yn(),O.flags|=98560,O}if(re!==null&&re.dehydrated!==null){if(re=Wh(O),L===null){if(!re)throw Error(a(318));if(!mn)throw Error(a(344));if(L=O.memoizedState,L=L!==null?L.dehydrated:null,!L)throw Error(a(317));Cn(L,O)}else yn(),!(O.flags&128)&&(O.memoizedState=null),O.flags|=4;return qo(O),null}return qa!==null&&(Ed(qa),qa=null),O.flags&128?(O.lanes=Y,O):(re=re!==null,Y=!1,L===null?Wh(O):Y=L.memoizedState!==null,re&&!Y&&(O.child.flags|=8192,O.mode&1&&(L===null||Ts.current&1?ko===0&&(ko=3):bo())),O.updateQueue!==null&&(O.flags|=4),qo(O),null);case 4:return qh(),$u(L,O),L===null&&St(O.stateNode.containerInfo),qo(O),null;case 10:return ll(O.type._context),qo(O),null;case 17:return us(O.type)&&Ri(),qo(O),null;case 19:if(Er(Ts),pe=O.memoizedState,pe===null)return qo(O),null;if(re=(O.flags&128)!==0,Te=pe.rendering,Te===null)if(re)ef(pe,!1);else{if(ko!==0||L!==null&&L.flags&128)for(L=O.child;L!==null;){if(Te=Lp(L),Te!==null){for(O.flags|=128,ef(pe,!1),L=Te.updateQueue,L!==null&&(O.updateQueue=L,O.flags|=4),O.subtreeFlags=0,L=Y,re=O.child;re!==null;)Y=re,pe=L,Y.flags&=14680066,Te=Y.alternate,Te===null?(Y.childLanes=0,Y.lanes=pe,Y.child=null,Y.subtreeFlags=0,Y.memoizedProps=null,Y.memoizedState=null,Y.updateQueue=null,Y.dependencies=null,Y.stateNode=null):(Y.childLanes=Te.childLanes,Y.lanes=Te.lanes,Y.child=Te.child,Y.subtreeFlags=0,Y.deletions=null,Y.memoizedProps=Te.memoizedProps,Y.memoizedState=Te.memoizedState,Y.updateQueue=Te.updateQueue,Y.type=Te.type,pe=Te.dependencies,Y.dependencies=pe===null?null:{lanes:pe.lanes,firstContext:pe.firstContext}),re=re.sibling;return Qn(Ts,Ts.current&1|2),O.child}L=L.sibling}pe.tail!==null&&ys()>Ju&&(O.flags|=128,re=!0,ef(pe,!1),O.lanes=4194304)}else{if(!re)if(L=Lp(Te),L!==null){if(O.flags|=128,re=!0,L=L.updateQueue,L!==null&&(O.updateQueue=L,O.flags|=4),ef(pe,!0),pe.tail===null&&pe.tailMode==="hidden"&&!Te.alternate&&!es)return qo(O),null}else 2*ys()-pe.renderingStartTime>Ju&&Y!==1073741824&&(O.flags|=128,re=!0,ef(pe,!1),O.lanes=4194304);pe.isBackwards?(Te.sibling=O.child,O.child=Te):(L=pe.last,L!==null?L.sibling=Te:O.child=Te,pe.last=Te)}return pe.tail!==null?(O=pe.tail,pe.rendering=O,pe.tail=O.sibling,pe.renderingStartTime=ys(),O.sibling=null,L=Ts.current,Qn(Ts,re?L&1|2:L&1),O):(qo(O),null);case 22:case 23:return Qu(),re=O.memoizedState!==null,L!==null&&L.memoizedState!==null!==re&&(O.flags|=8192),re&&O.mode&1?Bo&1073741824&&(qo(O),Pe&&O.subtreeFlags&6&&(O.flags|=8192)):qo(O),null;case 24:return null;case 25:return null}throw Error(a(156,O.tag))}var Mx=l.ReactCurrentOwner,xo=!1;function aa(L,O,Y,re){O.child=L===null?lg(O,null,Y,re):Za(O,L.child,Y,re)}function Vp(L,O,Y,re,pe){Y=Y.render;var Te=O.ref;return Uu(O,pe),re=Xu(L,O,Y,re,Te,pe),Y=Yh(),L!==null&&!xo?(O.updateQueue=L.updateQueue,O.flags&=-2053,L.lanes&=~pe,Ml(L,O,pe)):(es&&Y&&Ep(O),O.flags|=1,aa(L,O,re,pe),O.child)}function Mg(L,O,Y,re,pe){if(L===null){var Te=Y.type;return typeof Te=="function"&&!Gg(Te)&&Te.defaultProps===void 0&&Y.compare===null&&Y.defaultProps===void 0?(O.tag=15,O.type=Te,$v(L,O,Te,re,pe)):(L=Qp(Y.type,null,re,O,O.mode,pe),L.ref=O.ref,L.return=O,O.child=L)}if(Te=L.child,!(L.lanes&pe)){var ft=Te.memoizedProps;if(Y=Y.compare,Y=Y!==null?Y:al,Y(ft,re)&&L.ref===O.ref)return Ml(L,O,pe)}return O.flags|=1,L=wu(Te,re),L.ref=O.ref,L.return=O,O.child=L}function $v(L,O,Y,re,pe){if(L!==null&&al(L.memoizedProps,re)&&L.ref===O.ref)if(xo=!1,(L.lanes&pe)!==0)L.flags&131072&&(xo=!0);else return O.lanes=L.lanes,Ml(L,O,pe);return Eg(L,O,Y,re,pe)}function Cg(L,O,Y){var re=O.pendingProps,pe=re.children,Te=L!==null?L.memoizedState:null;if(re.mode==="hidden")if(!(O.mode&1))O.memoizedState={baseLanes:0,cachePool:null},Qn(ac,Bo),Bo|=Y;else if(Y&1073741824)O.memoizedState={baseLanes:0,cachePool:null},re=Te!==null?Te.baseLanes:Y,Qn(ac,Bo),Bo|=re;else return L=Te!==null?Te.baseLanes|Y:Y,O.lanes=O.childLanes=1073741824,O.memoizedState={baseLanes:L,cachePool:null},O.updateQueue=null,Qn(ac,Bo),Bo|=L,null;else Te!==null?(re=Te.baseLanes|Y,O.memoizedState=null):re=Y,Qn(ac,Bo),Bo|=re;return aa(L,O,pe,Y),O.child}function Gp(L,O){var Y=O.ref;(L===null&&Y!==null||L!==null&&L.ref!==Y)&&(O.flags|=512,O.flags|=2097152)}function Eg(L,O,Y,re,pe){var Te=us(Y)?Wo:qr.current;return Te=Ps(O,Te),Uu(O,pe),Y=Xu(L,O,Y,re,Te,pe),re=Yh(),L!==null&&!xo?(O.updateQueue=L.updateQueue,O.flags&=-2053,L.lanes&=~pe,Ml(L,O,pe)):(es&&re&&Ep(O),O.flags|=1,aa(L,O,Y,pe),O.child)}function qv(L,O,Y,re,pe){if(us(Y)){var Te=!0;Ss(O)}else Te=!1;if(Uu(O,pe),O.stateNode===null)L!==null&&(L.alternate=null,O.alternate=null,O.flags|=2),hd(O,Y,re),Bv(O,Y,re,pe),re=!0;else if(L===null){var ft=O.stateNode,Ot=O.memoizedProps;ft.props=Ot;var vn=ft.context,Wn=Y.contextType;typeof Wn=="object"&&Wn!==null?Wn=qs(Wn):(Wn=us(Y)?Wo:qr.current,Wn=Ps(O,Wn));var br=Y.getDerivedStateFromProps,oi=typeof br=="function"||typeof ft.getSnapshotBeforeUpdate=="function";oi||typeof ft.UNSAFE_componentWillReceiveProps!="function"&&typeof ft.componentWillReceiveProps!="function"||(Ot!==re||vn!==Wn)&&Hu(O,ft,re,Wn),$a=!1;var zr=O.memoizedState;ft.state=zr,og(O,re,ft,pe),vn=O.memoizedState,Ot!==re||zr!==vn||gs.current||$a?(typeof br=="function"&&(Gu(O,Y,br,re),vn=O.memoizedState),(Ot=$a||Sx(O,Y,Ot,re,zr,vn,Wn))?(oi||typeof ft.UNSAFE_componentWillMount!="function"&&typeof ft.componentWillMount!="function"||(typeof ft.componentWillMount=="function"&&ft.componentWillMount(),typeof ft.UNSAFE_componentWillMount=="function"&&ft.UNSAFE_componentWillMount()),typeof ft.componentDidMount=="function"&&(O.flags|=4194308)):(typeof ft.componentDidMount=="function"&&(O.flags|=4194308),O.memoizedProps=re,O.memoizedState=vn),ft.props=re,ft.state=vn,ft.context=Wn,re=Ot):(typeof ft.componentDidMount=="function"&&(O.flags|=4194308),re=!1)}else{ft=O.stateNode,Tp(L,O),Ot=O.memoizedProps,Wn=O.type===O.elementType?Ot:Us(O.type,Ot),ft.props=Wn,oi=O.pendingProps,zr=ft.context,vn=Y.contextType,typeof vn=="object"&&vn!==null?vn=qs(vn):(vn=us(Y)?Wo:qr.current,vn=Ps(O,vn));var fs=Y.getDerivedStateFromProps;(br=typeof fs=="function"||typeof ft.getSnapshotBeforeUpdate=="function")||typeof ft.UNSAFE_componentWillReceiveProps!="function"&&typeof ft.componentWillReceiveProps!="function"||(Ot!==oi||zr!==vn)&&Hu(O,ft,re,vn),$a=!1,zr=O.memoizedState,ft.state=zr,og(O,re,ft,pe);var Ir=O.memoizedState;Ot!==oi||zr!==Ir||gs.current||$a?(typeof fs=="function"&&(Gu(O,Y,fs,re),Ir=O.memoizedState),(Wn=$a||Sx(O,Y,Wn,re,zr,Ir,vn)||!1)?(br||typeof ft.UNSAFE_componentWillUpdate!="function"&&typeof ft.componentWillUpdate!="function"||(typeof ft.componentWillUpdate=="function"&&ft.componentWillUpdate(re,Ir,vn),typeof ft.UNSAFE_componentWillUpdate=="function"&&ft.UNSAFE_componentWillUpdate(re,Ir,vn)),typeof ft.componentDidUpdate=="function"&&(O.flags|=4),typeof ft.getSnapshotBeforeUpdate=="function"&&(O.flags|=1024)):(typeof ft.componentDidUpdate!="function"||Ot===L.memoizedProps&&zr===L.memoizedState||(O.flags|=4),typeof ft.getSnapshotBeforeUpdate!="function"||Ot===L.memoizedProps&&zr===L.memoizedState||(O.flags|=1024),O.memoizedProps=re,O.memoizedState=Ir),ft.props=re,ft.state=Ir,ft.context=vn,re=Wn):(typeof ft.componentDidUpdate!="function"||Ot===L.memoizedProps&&zr===L.memoizedState||(O.flags|=4),typeof ft.getSnapshotBeforeUpdate!="function"||Ot===L.memoizedProps&&zr===L.memoizedState||(O.flags|=1024),re=!1)}return nf(L,O,Y,re,Te,pe)}function nf(L,O,Y,re,pe,Te){Gp(L,O);var ft=(O.flags&128)!==0;if(!re&&!ft)return pe&&Dc(O,Y,!1),Ml(L,O,Te);re=O.stateNode,Mx.current=O;var Ot=ft&&typeof Y.getDerivedStateFromError!="function"?null:re.render();return O.flags|=1,L!==null&&ft?(O.child=Za(O,L.child,null,Te),O.child=Za(O,null,Ot,Te)):aa(L,O,Ot,Te),O.memoizedState=re.state,pe&&Dc(O,Y,!0),O.child}function Cx(L){var O=L.stateNode;O.pendingContext?so(L,O.pendingContext,O.pendingContext!==O.context):O.context&&so(L,O.context,!1),ka(L,O.containerInfo)}function Zv(L,O,Y,re,pe){return yn(),ag(pe),O.flags|=256,aa(L,O,Y,re),O.child}var Hp={dehydrated:null,treeContext:null,retryLane:0};function Ig(L){return{baseLanes:L,cachePool:null}}function jp(L,O,Y){var re=O.pendingProps,pe=Ts.current,Te=!1,ft=(O.flags&128)!==0,Ot;if((Ot=ft)||(Ot=L!==null&&L.memoizedState===null?!1:(pe&2)!==0),Ot?(Te=!0,O.flags&=-129):(L===null||L.memoizedState!==null)&&(pe|=1),Qn(Ts,pe&1),L===null)return tc(O),L=O.memoizedState,L!==null&&(L=L.dehydrated,L!==null)?(O.mode&1?pt(L)?O.lanes=8:O.lanes=1073741824:O.lanes=1,null):(pe=re.children,L=re.fallback,Te?(re=O.mode,Te=O.child,pe={mode:"hidden",children:pe},!(re&1)&&Te!==null?(Te.childLanes=0,Te.pendingProps=pe):Te=em(pe,re,0,null),L=eh(L,re,Y,null),Te.return=O,L.return=O,Te.sibling=L,O.child=Te,O.child.memoizedState=Ig(Y),O.memoizedState=Hp,L):_d(O,pe));if(pe=L.memoizedState,pe!==null){if(Ot=pe.dehydrated,Ot!==null){if(ft)return O.flags&256?(O.flags&=-257,hl(L,O,Y,Error(a(422)))):O.memoizedState!==null?(O.child=L.child,O.flags|=128,null):(Te=re.fallback,pe=O.mode,re=em({mode:"visible",children:re.children},pe,0,null),Te=eh(Te,pe,Y,null),Te.flags|=2,re.return=O,Te.return=O,re.sibling=Te,O.child=re,O.mode&1&&Za(O,L.child,null,Y),O.child.memoizedState=Ig(Y),O.memoizedState=Hp,Te);if(!(O.mode&1))O=hl(L,O,Y,null);else if(pt(Ot))O=hl(L,O,Y,Error(a(419)));else if(re=(Y&L.childLanes)!==0,xo||re){if(re=Ys,re!==null){switch(Y&-Y){case 4:Te=2;break;case 16:Te=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:Te=32;break;case 536870912:Te=268435456;break;default:Te=0}re=Te&(re.suspendedLanes|Y)?0:Te,re!==0&&re!==pe.retryLane&&(pe.retryLane=re,Ja(L,re,-1))}bo(),O=hl(L,O,Y,Error(a(421)))}else Je(Ot)?(O.flags|=128,O.child=L.child,O=Lx.bind(null,L),Rt(Ot,O),O=null):(Y=pe.treeContext,mn&&(yo=Bt(Ot),Da=O,es=!0,qa=null,oo=!1,Y!==null&&(Mr[$n++]=pr,Mr[$n++]=Ql,Mr[$n++]=mu,pr=Y.id,Ql=Y.overflow,mu=O)),O=_d(O,O.pendingProps.children),O.flags|=4096);return O}return Te?(re=Rg(L,O,re.children,re.fallback,Y),Te=O.child,pe=L.child.memoizedState,Te.memoizedState=pe===null?Ig(Y):{baseLanes:pe.baseLanes|Y,cachePool:null},Te.childLanes=L.childLanes&~Y,O.memoizedState=Hp,re):(Y=yd(L,O,re.children,Y),O.memoizedState=null,Y)}return Te?(re=Rg(L,O,re.children,re.fallback,Y),Te=O.child,pe=L.child.memoizedState,Te.memoizedState=pe===null?Ig(Y):{baseLanes:pe.baseLanes|Y,cachePool:null},Te.childLanes=L.childLanes&~Y,O.memoizedState=Hp,re):(Y=yd(L,O,re.children,Y),O.memoizedState=null,Y)}function _d(L,O){return O=em({mode:"visible",children:O},L.mode,0,null),O.return=L,L.child=O}function yd(L,O,Y,re){var pe=L.child;return L=pe.sibling,Y=wu(pe,{mode:"visible",children:Y}),!(O.mode&1)&&(Y.lanes=re),Y.return=O,Y.sibling=null,L!==null&&(re=O.deletions,re===null?(O.deletions=[L],O.flags|=16):re.push(L)),O.child=Y}function Rg(L,O,Y,re,pe){var Te=O.mode;L=L.child;var ft=L.sibling,Ot={mode:"hidden",children:Y};return!(Te&1)&&O.child!==L?(Y=O.child,Y.childLanes=0,Y.pendingProps=Ot,O.deletions=null):(Y=wu(L,Ot),Y.subtreeFlags=L.subtreeFlags&14680064),ft!==null?re=wu(ft,re):(re=eh(re,Te,pe,null),re.flags|=2),re.return=O,Y.return=O,Y.sibling=re,O.child=Y,re}function hl(L,O,Y,re){return re!==null&&ag(re),Za(O,L.child,null,Y),L=_d(O,O.pendingProps.children),L.flags|=2,O.memoizedState=null,L}function Yv(L,O,Y){L.lanes|=O;var re=L.alternate;re!==null&&(re.lanes|=O),$s(L.return,O,Y)}function xd(L,O,Y,re,pe){var Te=L.memoizedState;Te===null?L.memoizedState={isBackwards:O,rendering:null,renderingStartTime:0,last:re,tail:Y,tailMode:pe}:(Te.isBackwards=O,Te.rendering=null,Te.renderingStartTime=0,Te.last=re,Te.tail=Y,Te.tailMode=pe)}function Wp(L,O,Y){var re=O.pendingProps,pe=re.revealOrder,Te=re.tail;if(aa(L,O,re.children,Y),re=Ts.current,re&2)re=re&1|2,O.flags|=128;else{if(L!==null&&L.flags&128)e:for(L=O.child;L!==null;){if(L.tag===13)L.memoizedState!==null&&Yv(L,Y,O);else if(L.tag===19)Yv(L,Y,O);else if(L.child!==null){L.child.return=L,L=L.child;continue}if(L===O)break e;for(;L.sibling===null;){if(L.return===null||L.return===O)break e;L=L.return}L.sibling.return=L.return,L=L.sibling}re&=1}if(Qn(Ts,re),!(O.mode&1))O.memoizedState=null;else switch(pe){case"forwards":for(Y=O.child,pe=null;Y!==null;)L=Y.alternate,L!==null&&Lp(L)===null&&(pe=Y),Y=Y.sibling;Y=pe,Y===null?(pe=O.child,O.child=null):(pe=Y.sibling,Y.sibling=null),xd(O,!1,pe,Y,Te);break;case"backwards":for(Y=null,pe=O.child,O.child=null;pe!==null;){if(L=pe.alternate,L!==null&&Lp(L)===null){O.child=pe;break}L=pe.sibling,pe.sibling=Y,Y=pe,pe=L}xd(O,!0,Y,null,Te);break;case"together":xd(O,!1,null,null,void 0);break;default:O.memoizedState=null}return O.child}function Ml(L,O,Y){if(L!==null&&(O.dependencies=L.dependencies),af|=O.lanes,!(Y&O.childLanes))return null;if(L!==null&&O.child!==L.child)throw Error(a(153));if(O.child!==null){for(L=O.child,Y=wu(L,L.pendingProps),O.child=Y,Y.return=O;L.sibling!==null;)L=L.sibling,Y=Y.sibling=wu(L,L.pendingProps),Y.return=O;Y.sibling=null}return O.child}function Kv(L,O,Y){switch(O.tag){case 3:Cx(O),yn();break;case 5:cg(O);break;case 1:us(O.type)&&Ss(O);break;case 4:ka(O,O.stateNode.containerInfo);break;case 10:ga(O,O.type._context,O.memoizedProps.value);break;case 13:var re=O.memoizedState;if(re!==null)return re.dehydrated!==null?(Qn(Ts,Ts.current&1),O.flags|=128,null):Y&O.child.childLanes?jp(L,O,Y):(Qn(Ts,Ts.current&1),L=Ml(L,O,Y),L!==null?L.sibling:null);Qn(Ts,Ts.current&1);break;case 19:if(re=(Y&O.childLanes)!==0,L.flags&128){if(re)return Wp(L,O,Y);O.flags|=128}var pe=O.memoizedState;if(pe!==null&&(pe.rendering=null,pe.tail=null,pe.lastEffect=null),Qn(Ts,Ts.current),re)break;return null;case 22:case 23:return O.lanes=0,Cg(L,O,Y)}return Ml(L,O,Y)}function Ex(L,O){switch(fd(O),O.tag){case 1:return us(O.type)&&Ri(),L=O.flags,L&65536?(O.flags=L&-65537|128,O):null;case 3:return qh(),Er(gs),Er(qr),hg(),L=O.flags,L&65536&&!(L&128)?(O.flags=L&-65537|128,O):null;case 5:return Pp(O),null;case 13:if(Er(Ts),L=O.memoizedState,L!==null&&L.dehydrated!==null){if(O.alternate===null)throw Error(a(340));yn()}return L=O.flags,L&65536?(O.flags=L&-65537|128,O):null;case 19:return Er(Ts),null;case 4:return qh(),null;case 10:return ll(O.type._context),null;case 22:case 23:return Qu(),null;case 24:return null;default:return null}}var zc=!1,Cl=!1,Fn=typeof WeakSet=="function"?WeakSet:Set,sr=null;function Xp(L,O){var Y=L.ref;if(Y!==null)if(typeof Y=="function")try{Y(null)}catch(re){la(L,O,re)}else Y.current=null}function _a(L,O,Y){try{Y()}catch(re){la(L,O,re)}}var qu=!1;function Yn(L,O){for(Xe(L.containerInfo),sr=O;sr!==null;)if(L=sr,O=L.child,(L.subtreeFlags&1028)!==0&&O!==null)O.return=L,sr=O;else for(;sr!==null;){L=sr;try{var Y=L.alternate;if(L.flags&1024)switch(L.tag){case 0:case 11:case 15:break;case 1:if(Y!==null){var re=Y.memoizedProps,pe=Y.memoizedState,Te=L.stateNode,ft=Te.getSnapshotBeforeUpdate(L.elementType===L.type?re:Us(L.type,re),pe);Te.__reactInternalSnapshotBeforeUpdate=ft}break;case 3:Pe&&En(L.stateNode.containerInfo);break;case 5:case 6:case 4:case 17:break;default:throw Error(a(163))}}catch(Ot){la(L,L.return,Ot)}if(O=L.sibling,O!==null){O.return=L.return,sr=O;break}sr=L.return}return Y=qu,qu=!1,Y}function Uc(L,O,Y){var re=O.updateQueue;if(re=re!==null?re.lastEffect:null,re!==null){var pe=re=re.next;do{if((pe.tag&L)===L){var Te=pe.destroy;pe.destroy=void 0,Te!==void 0&&_a(O,Y,Te)}pe=pe.next}while(pe!==re)}}function $p(L,O){if(O=O.updateQueue,O=O!==null?O.lastEffect:null,O!==null){var Y=O=O.next;do{if((Y.tag&L)===L){var re=Y.create;Y.destroy=re()}Y=Y.next}while(Y!==O)}}function bd(L){var O=L.ref;if(O!==null){var Y=L.stateNode;switch(L.tag){case 5:L=Le(Y);break;default:L=Y}typeof O=="function"?O(L):O.current=L}}function qp(L,O,Y){if(zs&&typeof zs.onCommitFiberUnmount=="function")try{zs.onCommitFiberUnmount(Zr,O)}catch{}switch(O.tag){case 0:case 11:case 14:case 15:if(L=O.updateQueue,L!==null&&(L=L.lastEffect,L!==null)){var re=L=L.next;do{var pe=re,Te=pe.destroy;pe=pe.tag,Te!==void 0&&(pe&2||pe&4)&&_a(O,Y,Te),re=re.next}while(re!==L)}break;case 1:if(Xp(O,Y),L=O.stateNode,typeof L.componentWillUnmount=="function")try{L.props=O.memoizedProps,L.state=O.memoizedState,L.componentWillUnmount()}catch(ft){la(O,Y,ft)}break;case 5:Xp(O,Y);break;case 4:Pe?sf(L,O,Y):$e&&$e&&(O=O.stateNode.containerInfo,Y=Gr(O),ui(O,Y))}}function wd(L,O,Y){for(var re=O;;)if(qp(L,re,Y),re.child===null||Pe&&re.tag===4){if(re===O)break;for(;re.sibling===null;){if(re.return===null||re.return===O)return;re=re.return}re.sibling.return=re.return,re=re.sibling}else re.child.return=re,re=re.child}function Pg(L){var O=L.alternate;O!==null&&(L.alternate=null,Pg(O)),L.child=null,L.deletions=null,L.sibling=null,L.tag===5&&(O=L.stateNode,O!==null&&kn(O)),L.stateNode=null,L.return=null,L.dependencies=null,L.memoizedProps=null,L.memoizedState=null,L.pendingProps=null,L.stateNode=null,L.updateQueue=null}function Ix(L){return L.tag===5||L.tag===3||L.tag===4}function Rx(L){e:for(;;){for(;L.sibling===null;){if(L.return===null||Ix(L.return))return null;L=L.return}for(L.sibling.return=L.return,L=L.sibling;L.tag!==5&&L.tag!==6&&L.tag!==18;){if(L.flags&2||L.child===null||L.tag===4)continue e;L.child.return=L,L=L.child}if(!(L.flags&2))return L.stateNode}}function Sd(L){if(Pe){e:{for(var O=L.return;O!==null;){if(Ix(O))break e;O=O.return}throw Error(a(160))}var Y=O;switch(Y.tag){case 5:O=Y.stateNode,Y.flags&32&&(_i(O),Y.flags&=-33),Y=Rx(L),Ad(L,Y,O);break;case 3:case 4:O=Y.stateNode.containerInfo,Y=Rx(L),rf(L,Y,O);break;default:throw Error(a(161))}}}function rf(L,O,Y){var re=L.tag;if(re===5||re===6)L=L.stateNode,O?or(Y,L,O):Sr(Y,L);else if(re!==4&&(L=L.child,L!==null))for(rf(L,O,Y),L=L.sibling;L!==null;)rf(L,O,Y),L=L.sibling}function Ad(L,O,Y){var re=L.tag;if(re===5||re===6)L=L.stateNode,O?Fr(Y,L,O):tr(Y,L);else if(re!==4&&(L=L.child,L!==null))for(Ad(L,O,Y),L=L.sibling;L!==null;)Ad(L,O,Y),L=L.sibling}function sf(L,O,Y){for(var re=O,pe=!1,Te,ft;;){if(!pe){pe=re.return;e:for(;;){if(pe===null)throw Error(a(160));switch(Te=pe.stateNode,pe.tag){case 5:ft=!1;break e;case 3:Te=Te.containerInfo,ft=!0;break e;case 4:Te=Te.containerInfo,ft=!0;break e}pe=pe.return}pe=!0}if(re.tag===5||re.tag===6)wd(L,re,Y),ft?Hr(Te,re.stateNode):Nr(Te,re.stateNode);else if(re.tag===18)ft?It(Te,re.stateNode):Ct(Te,re.stateNode);else if(re.tag===4){if(re.child!==null){Te=re.stateNode.containerInfo,ft=!0,re.child.return=re,re=re.child;continue}}else if(qp(L,re,Y),re.child!==null){re.child.return=re,re=re.child;continue}if(re===O)break;for(;re.sibling===null;){if(re.return===null||re.return===O)return;re=re.return,re.tag===4&&(pe=!1)}re.sibling.return=re.return,re=re.sibling}}function ao(L,O){if(Pe){switch(O.tag){case 0:case 11:case 14:case 15:Uc(3,O,O.return),$p(3,O),Uc(5,O,O.return);return;case 1:return;case 5:var Y=O.stateNode;if(Y!=null){var re=O.memoizedProps;L=L!==null?L.memoizedProps:re;var pe=O.type,Te=O.updateQueue;O.updateQueue=null,Te!==null&&ci(Y,Te,pe,L,re,O)}return;case 6:if(O.stateNode===null)throw Error(a(162));Y=O.memoizedProps,Ln(O.stateNode,L!==null?L.memoizedProps:Y,Y);return;case 3:mn&&L!==null&&L.memoizedState.isDehydrated&&yt(O.stateNode.containerInfo);return;case 12:return;case 13:sc(O);return;case 19:sc(O);return;case 17:return}throw Error(a(163))}switch(O.tag){case 0:case 11:case 14:case 15:Uc(3,O,O.return),$p(3,O),Uc(5,O,O.return);return;case 12:return;case 13:sc(O);return;case 19:sc(O);return;case 3:mn&&L!==null&&L.memoizedState.isDehydrated&&yt(O.stateNode.containerInfo);break;case 22:case 23:return}e:if($e){switch(O.tag){case 1:case 5:case 6:break e;case 3:case 4:O=O.stateNode,ui(O.containerInfo,O.pendingChildren);break e}throw Error(a(163))}}function sc(L){var O=L.updateQueue;if(O!==null){L.updateQueue=null;var Y=L.stateNode;Y===null&&(Y=L.stateNode=new Fn),O.forEach(function(re){var pe=Ug.bind(null,L,re);Y.has(re)||(Y.add(re),re.then(pe,pe))})}}function Px(L,O){for(sr=O;sr!==null;){O=sr;var Y=O.deletions;if(Y!==null)for(var re=0;re<Y.length;re++){var pe=Y[re];try{var Te=L;Pe?sf(Te,pe,O):wd(Te,pe,O);var ft=pe.alternate;ft!==null&&(ft.return=null),pe.return=null}catch(Rr){la(pe,O,Rr)}}if(Y=O.child,O.subtreeFlags&12854&&Y!==null)Y.return=O,sr=Y;else for(;sr!==null;){O=sr;try{var Ot=O.flags;if(Ot&32&&Pe&&_i(O.stateNode),Ot&512){var vn=O.alternate;if(vn!==null){var Wn=vn.ref;Wn!==null&&(typeof Wn=="function"?Wn(null):Wn.current=null)}}if(Ot&8192)switch(O.tag){case 13:if(O.memoizedState!==null){var br=O.alternate;(br===null||br.memoizedState===null)&&(cf=ys())}break;case 22:var oi=O.memoizedState!==null,zr=O.alternate,fs=zr!==null&&zr.memoizedState!==null;if(Y=O,Pe){e:if(re=Y,pe=oi,Te=null,Pe)for(var Ir=re;;){if(Ir.tag===5){if(Te===null){Te=Ir;var co=Ir.stateNode;pe?Fe(co):Kt(Ir.stateNode,Ir.memoizedProps)}}else if(Ir.tag===6){if(Te===null){var uo=Ir.stateNode;pe?Lt(uo):un(uo,Ir.memoizedProps)}}else if((Ir.tag!==22&&Ir.tag!==23||Ir.memoizedState===null||Ir===re)&&Ir.child!==null){Ir.child.return=Ir,Ir=Ir.child;continue}if(Ir===re)break;for(;Ir.sibling===null;){if(Ir.return===null||Ir.return===re)break e;Te===Ir&&(Te=null),Ir=Ir.return}Te===Ir&&(Te=null),Ir.sibling.return=Ir.return,Ir=Ir.sibling}}if(oi&&!fs&&Y.mode&1){sr=Y;for(var Xt=Y.child;Xt!==null;){for(Y=sr=Xt;sr!==null;){re=sr;var Nt=re.child;switch(re.tag){case 0:case 11:case 14:case 15:Uc(4,re,re.return);break;case 1:Xp(re,re.return);var on=re.stateNode;if(typeof on.componentWillUnmount=="function"){var rr=re.return;try{on.props=re.memoizedProps,on.state=re.memoizedState,on.componentWillUnmount()}catch(Rr){la(re,rr,Rr)}}break;case 5:Xp(re,re.return);break;case 22:if(re.memoizedState!==null){Bg(Y);continue}}Nt!==null?(Nt.return=re,sr=Nt):Bg(Y)}Xt=Xt.sibling}}}switch(Ot&4102){case 2:Sd(O),O.flags&=-3;break;case 6:Sd(O),O.flags&=-3,ao(O.alternate,O);break;case 4096:O.flags&=-4097;break;case 4100:O.flags&=-4097,ao(O.alternate,O);break;case 4:ao(O.alternate,O)}}catch(Rr){la(O,O.return,Rr)}if(Y=O.sibling,Y!==null){Y.return=O.return,sr=Y;break}sr=O.return}}}function Jv(L,O,Y){sr=L,Lg(L)}function Lg(L,O,Y){for(var re=(L.mode&1)!==0;sr!==null;){var pe=sr,Te=pe.child;if(pe.tag===22&&re){var ft=pe.memoizedState!==null||zc;if(!ft){var Ot=pe.alternate,vn=Ot!==null&&Ot.memoizedState!==null||Cl;Ot=zc;var Wn=Cl;if(zc=ft,(Cl=vn)&&!Wn)for(sr=pe;sr!==null;)ft=sr,vn=ft.child,ft.tag===22&&ft.memoizedState!==null?Oa(pe):vn!==null?(vn.return=ft,sr=vn):Oa(pe);for(;Te!==null;)sr=Te,Lg(Te),Te=Te.sibling;sr=pe,zc=Ot,Cl=Wn}Dg(L)}else pe.subtreeFlags&8772&&Te!==null?(Te.return=pe,sr=Te):Dg(L)}}function Dg(L){for(;sr!==null;){var O=sr;if(O.flags&8772){var Y=O.alternate;try{if(O.flags&8772)switch(O.tag){case 0:case 11:case 15:Cl||$p(5,O);break;case 1:var re=O.stateNode;if(O.flags&4&&!Cl)if(Y===null)re.componentDidMount();else{var pe=O.elementType===O.type?Y.memoizedProps:Us(O.type,Y.memoizedProps);re.componentDidUpdate(pe,Y.memoizedState,re.__reactInternalSnapshotBeforeUpdate)}var Te=O.updateQueue;Te!==null&&Cp(O,Te,re);break;case 3:var ft=O.updateQueue;if(ft!==null){if(Y=null,O.child!==null)switch(O.child.tag){case 5:Y=Le(O.child.stateNode);break;case 1:Y=O.child.stateNode}Cp(O,ft,Y)}break;case 5:var Ot=O.stateNode;Y===null&&O.flags&4&&ir(Ot,O.type,O.memoizedProps,O);break;case 6:break;case 4:break;case 12:break;case 13:if(mn&&O.memoizedState===null){var vn=O.alternate;if(vn!==null){var Wn=vn.memoizedState;if(Wn!==null){var br=Wn.dehydrated;br!==null&&Mt(br)}}}break;case 19:case 17:case 21:case 22:case 23:break;default:throw Error(a(163))}Cl||O.flags&512&&bd(O)}catch(oi){la(O,O.return,oi)}}if(O===L){sr=null;break}if(Y=O.sibling,Y!==null){Y.return=O.return,sr=Y;break}sr=O.return}}function Bg(L){for(;sr!==null;){var O=sr;if(O===L){sr=null;break}var Y=O.sibling;if(Y!==null){Y.return=O.return,sr=Y;break}sr=O.return}}function Oa(L){for(;sr!==null;){var O=sr;try{switch(O.tag){case 0:case 11:case 15:var Y=O.return;try{$p(4,O)}catch(vn){la(O,Y,vn)}break;case 1:var re=O.stateNode;if(typeof re.componentDidMount=="function"){var pe=O.return;try{re.componentDidMount()}catch(vn){la(O,pe,vn)}}var Te=O.return;try{bd(O)}catch(vn){la(O,Te,vn)}break;case 5:var ft=O.return;try{bd(O)}catch(vn){la(O,ft,vn)}}}catch(vn){la(O,O.return,vn)}if(O===L){sr=null;break}var Ot=O.sibling;if(Ot!==null){Ot.return=O.return,sr=Ot;break}sr=O.return}}var hs=0,of=1,Td=2,Zp=3,Yp=4;if(typeof Symbol=="function"&&Symbol.for){var Md=Symbol.for;hs=Md("selector.component"),of=Md("selector.has_pseudo_class"),Td=Md("selector.role"),Zp=Md("selector.test_id"),Yp=Md("selector.text")}function Qv(L){var O=cn(L);if(O!=null){if(typeof O.memoizedProps["data-testname"]!="string")throw Error(a(364));return O}if(L=Ue(L),L===null)throw Error(a(362));return L.stateNode.current}function Zu(L,O){switch(O.$$typeof){case hs:if(L.type===O.value)return!0;break;case of:e:{O=O.value,L=[L,0];for(var Y=0;Y<L.length;){var re=L[Y++],pe=L[Y++],Te=O[pe];if(re.tag!==5||!Sn(re)){for(;Te!=null&&Zu(re,Te);)pe++,Te=O[pe];if(pe===O.length){O=!0;break e}else for(re=re.child;re!==null;)L.push(re,pe),re=re.sibling}}O=!1}return O;case Td:if(L.tag===5&&jt(L.stateNode,O.value))return!0;break;case Yp:if((L.tag===5||L.tag===6)&&(L=An(L),L!==null&&0<=L.indexOf(O.value)))return!0;break;case Zp:if(L.tag===5&&(L=L.memoizedProps["data-testname"],typeof L=="string"&&L.toLowerCase()===O.value.toLowerCase()))return!0;break;default:throw Error(a(365))}return!1}function Yu(L){switch(L.$$typeof){case hs:return"<"+(te(L.value)||"Unknown")+">";case of:return":has("+(Yu(L)||"")+")";case Td:return'[role="'+L.value+'"]';case Yp:return'"'+L.value+'"';case Zp:return'[data-testname="'+L.value+'"]';default:throw Error(a(365))}}function gn(L,O){var Y=[];L=[L,0];for(var re=0;re<L.length;){var pe=L[re++],Te=L[re++],ft=O[Te];if(pe.tag!==5||!Sn(pe)){for(;ft!=null&&Zu(pe,ft);)Te++,ft=O[Te];if(Te===O.length)Y.push(pe);else for(pe=pe.child;pe!==null;)L.push(pe,Te),pe=pe.sibling}}return Y}function Kn(L,O){if(!ot)throw Error(a(363));L=Qv(L),L=gn(L,O),O=[],L=Array.from(L);for(var Y=0;Y<L.length;){var re=L[Y++];if(re.tag===5)Sn(re)||O.push(re.stateNode);else for(re=re.child;re!==null;)L.push(re),re=re.sibling}return O}var oc=Math.ceil,Hi=l.ReactCurrentDispatcher,At=l.ReactCurrentOwner,Ds=l.ReactCurrentBatchConfig,fi=0,Ys=null,ts=null,Do=0,Bo=0,ac=ws(0),ko=0,Kp=null,af=0,lf=0,Cd=0,Ku=null,Zo=null,cf=0,Ju=1/0;function uf(){Ju=ys()+500}var Ka=!1,e_=null,Gs=null,kg=!1,El=null,ki=0,Qr=0,Og=null,lc=-1,hf=0;function Ks(){return fi&6?ys():lc!==-1?lc:lc=ys()}function cc(L){return L.mode&1?fi&2&&Do!==0?Do&-Do:ud.transition!==null?(hf===0&&(L=bp,bp<<=1,!(bp&4194240)&&(bp=64),hf=L),hf):(L=vr,L!==0?L:Jt()):1}function Ja(L,O,Y){if(50<Qr)throw Qr=0,Og=null,Error(a(185));var re=Il(L,O);return re===null?null:(Nh(re,O,Y),(!(fi&2)||re!==Ys)&&(re===Ys&&(!(fi&2)&&(lf|=O),ko===4&&Gc(re,Do)),lo(re,Y),O===1&&fi===0&&!(L.mode&1)&&(uf(),fu&&Ra())),re)}function Il(L,O){L.lanes|=O;var Y=L.alternate;for(Y!==null&&(Y.lanes|=O),Y=L,L=L.return;L!==null;)L.childLanes|=O,Y=L.alternate,Y!==null&&(Y.childLanes|=O),Y=L,L=L.return;return Y.tag===3?Y.stateNode:null}function lo(L,O){var Y=L.callbackNode;od(L,O);var re=Yl(L,L===Ys?Do:0);if(re===0)Y!==null&&ad(Y),L.callbackNode=null,L.callbackPriority=0;else if(O=re&-re,L.callbackPriority!==O){if(Y!=null&&ad(Y),O===1)L.tag===0?bx(Fg.bind(null,L)):As(Fg.bind(null,L)),Vn?sn(function(){fi===0&&Ra()}):cr(cd,Ra),Y=null;else{switch(xx(re)){case 1:Y=cd;break;case 4:Y=Kl;break;case 16:Y=On;break;case 536870912:Y=ei;break;default:Y=On}Y=Vg(Y,Vc.bind(null,L))}L.callbackPriority=O,L.callbackNode=Y}}function Vc(L,O){if(lc=-1,hf=0,fi&6)throw Error(a(327));var Y=L.callbackNode;if(hc()&&L.callbackNode!==Y)return null;var re=Yl(L,L===Ys?Do:0);if(re===0)return null;if(re&30||re&L.expiredLanes||O)O=Id(L,re);else{O=re;var pe=fi;fi|=2;var Te=ff();(Ys!==L||Do!==O)&&(uf(),fl(L,O));do try{Rd();break}catch(Ot){ya(L,Ot)}while(!0);Ls(),Hi.current=Te,fi=pe,ts!==null?O=0:(Ys=null,Do=0,O=ko)}if(O!==0){if(O===2&&(pe=Sp(L),pe!==0&&(re=pe,O=xu(L,pe))),O===1)throw Y=Kp,fl(L,0),Gc(L,re),lo(L,ys()),Y;if(O===6)Gc(L,re);else{if(pe=L.current.alternate,!(re&30)&&!t_(pe)&&(O=Id(L,re),O===2&&(Te=Sp(L),Te!==0&&(re=Te,O=xu(L,Te))),O===1))throw Y=Kp,fl(L,0),Gc(L,re),lo(L,ys()),Y;switch(L.finishedWork=pe,L.finishedLanes=re,O){case 0:case 1:throw Error(a(345));case 2:uc(L,Zo);break;case 3:if(Gc(L,re),(re&130023424)===re&&(O=cf+500-ys(),10<O)){if(Yl(L,0)!==0)break;if(pe=L.suspendedLanes,(pe&re)!==re){Ks(),L.pingedLanes|=L.suspendedLanes&pe;break}L.timeoutHandle=rn(uc.bind(null,L,Zo),O);break}uc(L,Zo);break;case 4:if(Gc(L,re),(re&4194240)===re)break;for(O=L.eventTimes,pe=-1;0<re;){var ft=31-Ia(re);Te=1<<ft,ft=O[ft],ft>pe&&(pe=ft),re&=~Te}if(re=pe,re=ys()-re,re=(120>re?120:480>re?480:1080>re?1080:1920>re?1920:3e3>re?3e3:4320>re?4320:1960*oc(re/1960))-re,10<re){L.timeoutHandle=rn(uc.bind(null,L,Zo),re);break}uc(L,Zo);break;case 5:uc(L,Zo);break;default:throw Error(a(329))}}}return lo(L,ys()),L.callbackNode===Y?Vc.bind(null,L):null}function xu(L,O){var Y=Ku;return L.current.memoizedState.isDehydrated&&(fl(L,O).flags|=256),L=Id(L,O),L!==2&&(O=Zo,Zo=Y,O!==null&&Ed(O)),L}function Ed(L){Zo===null?Zo=L:Zo.push.apply(Zo,L)}function t_(L){for(var O=L;;){if(O.flags&16384){var Y=O.updateQueue;if(Y!==null&&(Y=Y.stores,Y!==null))for(var re=0;re<Y.length;re++){var pe=Y[re],Te=pe.getSnapshot;pe=pe.value;try{if(!ol(Te(),pe))return!1}catch{return!1}}}if(Y=O.child,O.subtreeFlags&16384&&Y!==null)Y.return=O,O=Y;else{if(O===L)break;for(;O.sibling===null;){if(O.return===null||O.return===L)return!0;O=O.return}O.sibling.return=O.return,O=O.sibling}}return!0}function Gc(L,O){for(O&=~Cd,O&=~lf,L.suspendedLanes|=O,L.pingedLanes&=~O,L=L.expirationTimes;0<O;){var Y=31-Ia(O),re=1<<Y;L[Y]=-1,O&=~re}}function Fg(L){if(fi&6)throw Error(a(327));hc();var O=Yl(L,0);if(!(O&1))return lo(L,ys()),null;var Y=Id(L,O);if(L.tag!==0&&Y===2){var re=Sp(L);re!==0&&(O=re,Y=xu(L,re))}if(Y===1)throw Y=Kp,fl(L,0),Gc(L,O),lo(L,ys()),Y;if(Y===6)throw Error(a(345));return L.finishedWork=L.current.alternate,L.finishedLanes=O,uc(L,Zo),lo(L,ys()),null}function bu(L){El!==null&&El.tag===0&&!(fi&6)&&hc();var O=fi;fi|=1;var Y=Ds.transition,re=vr;try{if(Ds.transition=null,vr=1,L)return L()}finally{vr=re,Ds.transition=Y,fi=O,!(fi&6)&&Ra()}}function Qu(){Bo=ac.current,Er(ac)}function fl(L,O){L.finishedWork=null,L.finishedLanes=0;var Y=L.timeoutHandle;if(Y!==Bn&&(L.timeoutHandle=Bn,jn(Y)),ts!==null)for(Y=ts.return;Y!==null;){var re=Y;switch(fd(re),re.tag){case 1:re=re.type.childContextTypes,re!=null&&Ri();break;case 3:qh(),Er(gs),Er(qr),hg();break;case 5:Pp(re);break;case 4:qh();break;case 13:Er(Ts);break;case 19:Er(Ts);break;case 10:ll(re.type._context);break;case 22:case 23:Qu()}Y=Y.return}if(Ys=L,ts=L=wu(L.current,null),Do=Bo=O,ko=0,Kp=null,Cd=lf=af=0,Zo=Ku=null,Pa!==null){for(O=0;O<Pa.length;O++)if(Y=Pa[O],re=Y.interleaved,re!==null){Y.interleaved=null;var pe=re.next,Te=Y.pending;if(Te!==null){var ft=Te.next;Te.next=pe,re.next=ft}Y.pending=re}Pa=null}return L}function ya(L,O){do{var Y=ts;try{if(Ls(),Dp.current=Jh,gu){for(var re=Ms.memoizedState;re!==null;){var pe=re.queue;pe!==null&&(pe.pending=null),re=re.next}gu=!1}if(Zh=0,Zs=Lo=Ms=null,vu=!1,ju=0,At.current=null,Y===null||Y.return===null){ko=1,Kp=O,ts=null;break}e:{var Te=L,ft=Y.return,Ot=Y,vn=O;if(O=Do,Ot.flags|=32768,vn!==null&&typeof vn=="object"&&typeof vn.then=="function"){var Wn=vn,br=Ot,oi=br.tag;if(!(br.mode&1)&&(oi===0||oi===11||oi===15)){var zr=br.alternate;zr?(br.updateQueue=zr.updateQueue,br.memoizedState=zr.memoizedState,br.lanes=zr.lanes):(br.updateQueue=null,br.memoizedState=null)}var fs=Qh(ft);if(fs!==null){fs.flags&=-257,Xv(fs,ft,Ot,Te,O),fs.mode&1&&Wv(Te,Wn,O),O=fs,vn=Wn;var Ir=O.updateQueue;if(Ir===null){var co=new Set;co.add(vn),O.updateQueue=co}else Ir.add(vn);break e}else{if(!(O&1)){Wv(Te,Wn,O),bo();break e}vn=Error(a(426))}}else if(es&&Ot.mode&1){var uo=Qh(ft);if(uo!==null){!(uo.flags&65536)&&(uo.flags|=256),Xv(uo,ft,Ot,Te,O),ag(vn);break e}}Te=vn,ko!==4&&(ko=2),Ku===null?Ku=[Te]:Ku.push(Te),vn=zp(vn,Ot),Ot=ft;do{switch(Ot.tag){case 3:Ot.flags|=65536,O&=-O,Ot.lanes|=O;var Xt=Tx(Ot,vn,O);La(Ot,Xt);break e;case 1:Te=vn;var Nt=Ot.type,on=Ot.stateNode;if(!(Ot.flags&128)&&(typeof Nt.getDerivedStateFromError=="function"||on!==null&&typeof on.componentDidCatch=="function"&&(Gs===null||!Gs.has(on)))){Ot.flags|=65536,O&=-O,Ot.lanes|=O;var rr=jv(Ot,Te,O);La(Ot,rr);break e}}Ot=Ot.return}while(Ot!==null)}Ng(Y)}catch(Rr){O=Rr,ts===Y&&Y!==null&&(ts=Y=Y.return);continue}break}while(!0)}function ff(){var L=Hi.current;return Hi.current=Jh,L===null?Jh:L}function bo(){(ko===0||ko===3||ko===2)&&(ko=4),Ys===null||!(af&268435455)&&!(lf&268435455)||Gc(Ys,Do)}function Id(L,O){var Y=fi;fi|=2;var re=ff();Ys===L&&Do===O||fl(L,O);do try{n_();break}catch(pe){ya(L,pe)}while(!0);if(Ls(),fi=Y,Hi.current=re,ts!==null)throw Error(a(261));return Ys=null,Do=0,ko}function n_(){for(;ts!==null;)Hc(ts)}function Rd(){for(;ts!==null&&!zh();)Hc(ts)}function Hc(L){var O=Ld(L.alternate,L,Bo);L.memoizedProps=L.pendingProps,O===null?Ng(L):ts=O,At.current=null}function Ng(L){var O=L;do{var Y=O.alternate;if(L=O.return,O.flags&32768){if(Y=Ex(Y,O),Y!==null){Y.flags&=32767,ts=Y;return}if(L!==null)L.flags|=32768,L.subtreeFlags=0,L.deletions=null;else{ko=6,ts=null;return}}else if(Y=tf(Y,O,Bo),Y!==null){ts=Y;return}if(O=O.sibling,O!==null){ts=O;return}ts=O=L}while(O!==null);ko===0&&(ko=5)}function uc(L,O){var Y=vr,re=Ds.transition;try{Ds.transition=null,vr=1,r_(L,O,Y)}finally{Ds.transition=re,vr=Y}return null}function r_(L,O,Y){do hc();while(El!==null);if(fi&6)throw Error(a(327));var re=L.finishedWork,pe=L.finishedLanes;if(re===null)return null;if(L.finishedWork=null,L.finishedLanes=0,re===L.current)throw Error(a(177));L.callbackNode=null,L.callbackPriority=0;var Te=re.lanes|re.childLanes;if(ii(L,Te),L===Ys&&(ts=Ys=null,Do=0),!(re.subtreeFlags&2064)&&!(re.flags&2064)||kg||(kg=!0,Vg(On,function(){return hc(),null})),Te=(re.flags&15990)!==0,re.subtreeFlags&15990||Te){Te=Ds.transition,Ds.transition=null;var ft=vr;vr=1;var Ot=fi;fi|=4,At.current=null,Yn(L,re),Px(L,re),He(L.containerInfo),L.current=re,Jv(re),ld(),fi=Ot,vr=ft,Ds.transition=Te}else L.current=re;if(kg&&(kg=!1,El=L,ki=pe),Te=L.pendingLanes,Te===0&&(Gs=null),ma(re.stateNode),lo(L,ys()),O!==null)for(Y=L.onRecoverableError,re=0;re<O.length;re++)Y(O[re]);if(Ka)throw Ka=!1,L=e_,e_=null,L;return ki&1&&L.tag!==0&&hc(),Te=L.pendingLanes,Te&1?L===Og?Qr++:(Qr=0,Og=L):Qr=0,Ra(),null}function hc(){if(El!==null){var L=xx(ki),O=Ds.transition,Y=vr;try{if(Ds.transition=null,vr=16>L?16:L,El===null)var re=!1;else{if(L=El,El=null,ki=0,fi&6)throw Error(a(331));var pe=fi;for(fi|=4,sr=L.current;sr!==null;){var Te=sr,ft=Te.child;if(sr.flags&16){var Ot=Te.deletions;if(Ot!==null){for(var vn=0;vn<Ot.length;vn++){var Wn=Ot[vn];for(sr=Wn;sr!==null;){var br=sr;switch(br.tag){case 0:case 11:case 15:Uc(8,br,Te)}var oi=br.child;if(oi!==null)oi.return=br,sr=oi;else for(;sr!==null;){br=sr;var zr=br.sibling,fs=br.return;if(Pg(br),br===Wn){sr=null;break}if(zr!==null){zr.return=fs,sr=zr;break}sr=fs}}}var Ir=Te.alternate;if(Ir!==null){var co=Ir.child;if(co!==null){Ir.child=null;do{var uo=co.sibling;co.sibling=null,co=uo}while(co!==null)}}sr=Te}}if(Te.subtreeFlags&2064&&ft!==null)ft.return=Te,sr=ft;else e:for(;sr!==null;){if(Te=sr,Te.flags&2048)switch(Te.tag){case 0:case 11:case 15:Uc(9,Te,Te.return)}var Xt=Te.sibling;if(Xt!==null){Xt.return=Te.return,sr=Xt;break e}sr=Te.return}}var Nt=L.current;for(sr=Nt;sr!==null;){ft=sr;var on=ft.child;if(ft.subtreeFlags&2064&&on!==null)on.return=ft,sr=on;else e:for(ft=Nt;sr!==null;){if(Ot=sr,Ot.flags&2048)try{switch(Ot.tag){case 0:case 11:case 15:$p(9,Ot)}}catch(Rr){la(Ot,Ot.return,Rr)}if(Ot===ft){sr=null;break e}var rr=Ot.sibling;if(rr!==null){rr.return=Ot.return,sr=rr;break e}sr=Ot.return}}if(fi=pe,Ra(),zs&&typeof zs.onPostCommitFiberRoot=="function")try{zs.onPostCommitFiberRoot(Zr,L)}catch{}re=!0}return re}finally{vr=Y,Ds.transition=O}}return!1}function Pd(L,O,Y){O=zp(Y,O),O=Tx(L,O,1),Vu(L,O),O=Ks(),L=Il(L,1),L!==null&&(Nh(L,1,O),lo(L,O))}function la(L,O,Y){if(L.tag===3)Pd(L,L,Y);else for(;O!==null;){if(O.tag===3){Pd(O,L,Y);break}else if(O.tag===1){var re=O.stateNode;if(typeof O.type.getDerivedStateFromError=="function"||typeof re.componentDidCatch=="function"&&(Gs===null||!Gs.has(re))){L=zp(Y,L),L=jv(O,L,1),Vu(O,L),L=Ks(),O=Il(O,1),O!==null&&(Nh(O,1,L),lo(O,L));break}}O=O.return}}function zg(L,O,Y){var re=L.pingCache;re!==null&&re.delete(O),O=Ks(),L.pingedLanes|=L.suspendedLanes&Y,Ys===L&&(Do&Y)===Y&&(ko===4||ko===3&&(Do&130023424)===Do&&500>ys()-cf?fl(L,0):Cd|=Y),lo(L,O)}function Jp(L,O){O===0&&(L.mode&1?(O=ig,ig<<=1,!(ig&130023424)&&(ig=4194304)):O=1);var Y=Ks();L=Il(L,O),L!==null&&(Nh(L,O,Y),lo(L,Y))}function Lx(L){var O=L.memoizedState,Y=0;O!==null&&(Y=O.retryLane),Jp(L,Y)}function Ug(L,O){var Y=0;switch(L.tag){case 13:var re=L.stateNode,pe=L.memoizedState;pe!==null&&(Y=pe.retryLane);break;case 19:re=L.stateNode;break;default:throw Error(a(314))}re!==null&&re.delete(O),Jp(L,Y)}var Ld;Ld=function(L,O,Y){if(L!==null)if(L.memoizedProps!==O.pendingProps||gs.current)xo=!0;else{if(!(L.lanes&Y)&&!(O.flags&128))return xo=!1,Kv(L,O,Y);xo=!!(L.flags&131072)}else xo=!1,es&&O.flags&1048576&&_r(O,va,O.index);switch(O.lanes=0,O.tag){case 2:var re=O.type;L!==null&&(L.alternate=null,O.alternate=null,O.flags|=2),L=O.pendingProps;var pe=Ps(O,qr.current);Uu(O,Y),pe=Xu(null,O,re,L,pe,Y);var Te=Yh();return O.flags|=1,typeof pe=="object"&&pe!==null&&typeof pe.render=="function"&&pe.$$typeof===void 0?(O.tag=1,O.memoizedState=null,O.updateQueue=null,us(re)?(Te=!0,Ss(O)):Te=!1,O.memoizedState=pe.state!==null&&pe.state!==void 0?pe.state:null,du(O),pe.updater=pu,O.stateNode=pe,pe._reactInternals=O,Bv(O,re,L,Y),O=nf(null,O,re,!0,Te,Y)):(O.tag=0,es&&Te&&Ep(O),aa(null,O,pe,Y),O=O.child),O;case 16:re=O.elementType;e:{switch(L!==null&&(L.alternate=null,O.alternate=null,O.flags|=2),L=O.pendingProps,pe=re._init,re=pe(re._payload),O.type=re,pe=O.tag=Hg(re),L=Us(re,L),pe){case 0:O=Eg(null,O,re,L,Y);break e;case 1:O=qv(null,O,re,L,Y);break e;case 11:O=Vp(null,O,re,L,Y);break e;case 14:O=Mg(null,O,re,Us(re.type,L),Y);break e}throw Error(a(306,re,""))}return O;case 0:return re=O.type,pe=O.pendingProps,pe=O.elementType===re?pe:Us(re,pe),Eg(L,O,re,pe,Y);case 1:return re=O.type,pe=O.pendingProps,pe=O.elementType===re?pe:Us(re,pe),qv(L,O,re,pe,Y);case 3:e:{if(Cx(O),L===null)throw Error(a(387));re=O.pendingProps,Te=O.memoizedState,pe=Te.element,Tp(L,O),og(O,re,null,Y);var ft=O.memoizedState;if(re=ft.element,mn&&Te.isDehydrated)if(Te={element:re,isDehydrated:!1,cache:ft.cache,transitions:ft.transitions},O.updateQueue.baseState=Te,O.memoizedState=Te,O.flags&256){pe=Error(a(423)),O=Zv(L,O,re,Y,pe);break e}else if(re!==pe){pe=Error(a(424)),O=Zv(L,O,re,Y,pe);break e}else for(mn&&(yo=zt(O.stateNode.containerInfo),Da=O,es=!0,qa=null,oo=!1),Y=lg(O,null,re,Y),O.child=Y;Y;)Y.flags=Y.flags&-3|4096,Y=Y.sibling;else{if(yn(),re===pe){O=Ml(L,O,Y);break e}aa(L,O,re,Y)}O=O.child}return O;case 5:return cg(O),L===null&&tc(O),re=O.type,pe=O.pendingProps,Te=L!==null?L.memoizedProps:null,ft=pe.children,Ht(re,pe)?ft=null:Te!==null&&Ht(re,Te)&&(O.flags|=32),Gp(L,O),aa(L,O,ft,Y),O.child;case 6:return L===null&&tc(O),null;case 13:return jp(L,O,Y);case 4:return ka(O,O.stateNode.containerInfo),re=O.pendingProps,L===null?O.child=Za(O,null,re,Y):aa(L,O,re,Y),O.child;case 11:return re=O.type,pe=O.pendingProps,pe=O.elementType===re?pe:Us(re,pe),Vp(L,O,re,pe,Y);case 7:return aa(L,O,O.pendingProps,Y),O.child;case 8:return aa(L,O,O.pendingProps.children,Y),O.child;case 12:return aa(L,O,O.pendingProps.children,Y),O.child;case 10:e:{if(re=O.type._context,pe=O.pendingProps,Te=O.memoizedProps,ft=pe.value,ga(O,re,ft),Te!==null)if(ol(Te.value,ft)){if(Te.children===pe.children&&!gs.current){O=Ml(L,O,Y);break e}}else for(Te=O.child,Te!==null&&(Te.return=O);Te!==null;){var Ot=Te.dependencies;if(Ot!==null){ft=Te.child;for(var vn=Ot.firstContext;vn!==null;){if(vn.context===re){if(Te.tag===1){vn=sa(-1,Y&-Y),vn.tag=2;var Wn=Te.updateQueue;if(Wn!==null){Wn=Wn.shared;var br=Wn.pending;br===null?vn.next=vn:(vn.next=br.next,br.next=vn),Wn.pending=vn}}Te.lanes|=Y,vn=Te.alternate,vn!==null&&(vn.lanes|=Y),$s(Te.return,Y,O),Ot.lanes|=Y;break}vn=vn.next}}else if(Te.tag===10)ft=Te.type===O.type?null:Te.child;else if(Te.tag===18){if(ft=Te.return,ft===null)throw Error(a(341));ft.lanes|=Y,Ot=ft.alternate,Ot!==null&&(Ot.lanes|=Y),$s(ft,Y,O),ft=Te.sibling}else ft=Te.child;if(ft!==null)ft.return=Te;else for(ft=Te;ft!==null;){if(ft===O){ft=null;break}if(Te=ft.sibling,Te!==null){Te.return=ft.return,ft=Te;break}ft=ft.return}Te=ft}aa(L,O,pe.children,Y),O=O.child}return O;case 9:return pe=O.type,re=O.pendingProps.children,Uu(O,Y),pe=qs(pe),re=re(pe),O.flags|=1,aa(L,O,re,Y),O.child;case 14:return re=O.type,pe=Us(re,O.pendingProps),pe=Us(re.type,pe),Mg(L,O,re,pe,Y);case 15:return $v(L,O,O.type,O.pendingProps,Y);case 17:return re=O.type,pe=O.pendingProps,pe=O.elementType===re?pe:Us(re,pe),L!==null&&(L.alternate=null,O.alternate=null,O.flags|=2),O.tag=1,us(re)?(L=!0,Ss(O)):L=!1,Uu(O,Y),hd(O,re,pe),Bv(O,re,pe,Y),nf(null,O,re,!0,L,Y);case 19:return Wp(L,O,Y);case 22:return Cg(L,O,Y)}throw Error(a(156,O.tag))};function Vg(L,O){return cr(L,O)}function Dx(L,O,Y,re){this.tag=L,this.key=Y,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=O,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=re,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Qa(L,O,Y,re){return new Dx(L,O,Y,re)}function Gg(L){return L=L.prototype,!(!L||!L.isReactComponent)}function Hg(L){if(typeof L=="function")return Gg(L)?1:0;if(L!=null){if(L=L.$$typeof,L===I)return 11;if(L===B)return 14}return 2}function wu(L,O){var Y=L.alternate;return Y===null?(Y=Qa(L.tag,O,L.key,L.mode),Y.elementType=L.elementType,Y.type=L.type,Y.stateNode=L.stateNode,Y.alternate=L,L.alternate=Y):(Y.pendingProps=O,Y.type=L.type,Y.flags=0,Y.subtreeFlags=0,Y.deletions=null),Y.flags=L.flags&14680064,Y.childLanes=L.childLanes,Y.lanes=L.lanes,Y.child=L.child,Y.memoizedProps=L.memoizedProps,Y.memoizedState=L.memoizedState,Y.updateQueue=L.updateQueue,O=L.dependencies,Y.dependencies=O===null?null:{lanes:O.lanes,firstContext:O.firstContext},Y.sibling=L.sibling,Y.index=L.index,Y.ref=L.ref,Y}function Qp(L,O,Y,re,pe,Te){var ft=2;if(re=L,typeof L=="function")Gg(L)&&(ft=1);else if(typeof L=="string")ft=5;else e:switch(L){case d:return eh(Y.children,pe,Te,O);case m:ft=8,pe|=8;break;case _:return L=Qa(12,Y,O,pe|2),L.elementType=_,L.lanes=Te,L;case C:return L=Qa(13,Y,O,pe),L.elementType=C,L.lanes=Te,L;case M:return L=Qa(19,Y,O,pe),L.elementType=M,L.lanes=Te,L;case j:return em(Y,pe,Te,O);default:if(typeof L=="object"&&L!==null)switch(L.$$typeof){case y:ft=10;break e;case T:ft=9;break e;case I:ft=11;break e;case B:ft=14;break e;case k:ft=16,re=null;break e}throw Error(a(130,L==null?L:typeof L,""))}return O=Qa(ft,Y,O,pe),O.elementType=L,O.type=re,O.lanes=Te,O}function eh(L,O,Y,re){return L=Qa(7,L,re,O),L.lanes=Y,L}function em(L,O,Y,re){return L=Qa(22,L,re,O),L.elementType=j,L.lanes=Y,L.stateNode={},L}function tm(L,O,Y){return L=Qa(6,L,null,O),L.lanes=Y,L}function i_(L,O,Y){return O=Qa(4,L.children!==null?L.children:[],L.key,O),O.lanes=Y,O.stateNode={containerInfo:L.containerInfo,pendingChildren:null,implementation:L.implementation},O}function Iw(L,O,Y,re,pe){this.tag=O,this.containerInfo=L,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=Bn,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=zu(0),this.expirationTimes=zu(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=zu(0),this.identifierPrefix=re,this.onRecoverableError=pe,mn&&(this.mutableSourceEagerHydrationData=null)}function xs(L,O,Y,re,pe,Te,ft,Ot,vn){return L=new Iw(L,O,Y,Ot,vn),O===1?(O=1,Te===!0&&(O|=8)):O=0,Te=Qa(3,null,null,O),L.current=Te,Te.stateNode=L,Te.memoizedState={element:re,isDehydrated:Y,cache:null,transitions:null},du(Te),L}function s_(L){if(!L)return qi;L=L._reactInternals;e:{if(se(L)!==L||L.tag!==1)throw Error(a(170));var O=L;do{switch(O.tag){case 3:O=O.stateNode.context;break e;case 1:if(us(O.type)){O=O.stateNode.__reactInternalMemoizedMergedChildContext;break e}}O=O.return}while(O!==null);throw Error(a(171))}if(L.tag===1){var Y=L.type;if(us(Y))return Ro(L,Y,O)}return O}function Bx(L){var O=L._reactInternals;if(O===void 0)throw typeof L.render=="function"?Error(a(188)):(L=Object.keys(L).join(","),Error(a(268,L)));return L=Se(O),L===null?null:L.stateNode}function kx(L,O){if(L=L.memoizedState,L!==null&&L.dehydrated!==null){var Y=L.retryLane;L.retryLane=Y!==0&&Y<O?Y:O}}function df(L,O){kx(L,O),(L=L.alternate)&&kx(L,O)}function Ox(L){return L=Se(L),L===null?null:L.stateNode}function Dd(){return null}return t.attemptContinuousHydration=function(L){if(L.tag===13){var O=Ks();Ja(L,134217728,O),df(L,134217728)}},t.attemptHydrationAtCurrentPriority=function(L){if(L.tag===13){var O=Ks(),Y=cc(L);Ja(L,Y,O),df(L,Y)}},t.attemptSynchronousHydration=function(L){switch(L.tag){case 3:var O=L.stateNode;if(O.current.memoizedState.isDehydrated){var Y=Xo(O.pendingLanes);Y!==0&&(Ap(O,Y|1),lo(O,ys()),!(fi&6)&&(uf(),Ra()))}break;case 13:var re=Ks();bu(function(){return Ja(L,1,re)}),df(L,1)}},t.batchedUpdates=function(L,O){var Y=fi;fi|=1;try{return L(O)}finally{fi=Y,fi===0&&(uf(),fu&&Ra())}},t.createComponentSelector=function(L){return{$$typeof:hs,value:L}},t.createContainer=function(L,O,Y,re,pe,Te,ft){return xs(L,O,!1,null,Y,re,pe,Te,ft)},t.createHasPseudoClassSelector=function(L){return{$$typeof:of,value:L}},t.createHydrationContainer=function(L,O,Y,re,pe,Te,ft,Ot,vn){return L=xs(Y,re,!0,L,pe,Te,ft,Ot,vn),L.context=s_(null),Y=L.current,re=Ks(),pe=cc(Y),Te=sa(re,pe),Te.callback=O??null,Vu(Y,Te),L.current.lanes=pe,Nh(L,pe,re),lo(L,re),L},t.createPortal=function(L,O,Y){var re=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:h,key:re==null?null:""+re,children:L,containerInfo:O,implementation:Y}},t.createRoleSelector=function(L){return{$$typeof:Td,value:L}},t.createTestNameSelector=function(L){return{$$typeof:Zp,value:L}},t.createTextSelector=function(L){return{$$typeof:Yp,value:L}},t.deferredUpdates=function(L){var O=vr,Y=Ds.transition;try{return Ds.transition=null,vr=16,L()}finally{vr=O,Ds.transition=Y}},t.discreteUpdates=function(L,O,Y,re,pe){var Te=vr,ft=Ds.transition;try{return Ds.transition=null,vr=1,L(O,Y,re,pe)}finally{vr=Te,Ds.transition=ft,fi===0&&uf()}},t.findAllNodes=Kn,t.findBoundingRects=function(L,O){if(!ot)throw Error(a(363));O=Kn(L,O),L=[];for(var Y=0;Y<O.length;Y++)L.push($t(O[Y]));for(O=L.length-1;0<O;O--){Y=L[O];for(var re=Y.x,pe=re+Y.width,Te=Y.y,ft=Te+Y.height,Ot=O-1;0<=Ot;Ot--)if(O!==Ot){var vn=L[Ot],Wn=vn.x,br=Wn+vn.width,oi=vn.y,zr=oi+vn.height;if(re>=Wn&&Te>=oi&&pe<=br&&ft<=zr){L.splice(O,1);break}else if(re!==Wn||Y.width!==vn.width||zr<Te||oi>ft){if(!(Te!==oi||Y.height!==vn.height||br<re||Wn>pe)){Wn>re&&(vn.width+=Wn-re,vn.x=re),br<pe&&(vn.width=pe-Wn),L.splice(O,1);break}}else{oi>Te&&(vn.height+=oi-Te,vn.y=Te),zr<ft&&(vn.height=ft-oi),L.splice(O,1);break}}}return L},t.findHostInstance=Bx,t.findHostInstanceWithNoPortals=function(L){return L=fe(L),L=L!==null?Re(L):null,L===null?null:L.stateNode},t.findHostInstanceWithWarning=function(L){return Bx(L)},t.flushControlled=function(L){var O=fi;fi|=1;var Y=Ds.transition,re=vr;try{Ds.transition=null,vr=1,L()}finally{vr=re,Ds.transition=Y,fi=O,fi===0&&(uf(),Ra())}},t.flushPassiveEffects=hc,t.flushSync=bu,t.focusWithin=function(L,O){if(!ot)throw Error(a(363));for(L=Qv(L),O=gn(L,O),O=Array.from(O),L=0;L<O.length;){var Y=O[L++];if(!Sn(Y)){if(Y.tag===5&&mr(Y.stateNode))return!0;for(Y=Y.child;Y!==null;)O.push(Y),Y=Y.sibling}}return!1},t.getCurrentUpdatePriority=function(){return vr},t.getFindAllNodesFailureDescription=function(L,O){if(!ot)throw Error(a(363));var Y=0,re=[];L=[Qv(L),0];for(var pe=0;pe<L.length;){var Te=L[pe++],ft=L[pe++],Ot=O[ft];if((Te.tag!==5||!Sn(Te))&&(Zu(Te,Ot)&&(re.push(Yu(Ot)),ft++,ft>Y&&(Y=ft)),ft<O.length))for(Te=Te.child;Te!==null;)L.push(Te,ft),Te=Te.sibling}if(Y<O.length){for(L=[];Y<O.length;Y++)L.push(Yu(O[Y]));return`findAllNodes was able to match part of the selector:
  `+(re.join(" > ")+`

No matching component was found for:
  `)+L.join(" > ")}return null},t.getPublicRootInstance=function(L){if(L=L.current,!L.child)return null;switch(L.child.tag){case 5:return Le(L.child.stateNode);default:return L.child.stateNode}},t.injectIntoDevTools=function(L){if(L={bundleType:L.bundleType,version:L.version,rendererPackageName:L.rendererPackageName,rendererConfig:L.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:l.ReactCurrentDispatcher,findHostInstanceByFiber:Ox,findFiberByHostInstance:L.findFiberByHostInstance||Dd,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.0.0-fc46dba67-20220329"},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")L=!1;else{var O=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(O.isDisabled||!O.supportsFiber)L=!0;else{try{Zr=O.inject(L),zs=O}catch{}L=!!O.checkDCE}}return L},t.isAlreadyRendering=function(){return!1},t.observeVisibleRects=function(L,O,Y,re){if(!ot)throw Error(a(363));L=Kn(L,O);var pe=Un(L,Y,re).disconnect;return{disconnect:function(){pe()}}},t.registerMutableSourceForHydration=function(L,O){var Y=O._getVersion;Y=Y(O._source),L.mutableSourceEagerHydrationData==null?L.mutableSourceEagerHydrationData=[O,Y]:L.mutableSourceEagerHydrationData.push(O,Y)},t.runWithPriority=function(L,O){var Y=vr;try{return vr=L,O()}finally{vr=Y}},t.shouldError=function(){return null},t.shouldSuspend=function(){return!1},t.updateContainer=function(L,O,Y,re){var pe=O.current,Te=Ks(),ft=cc(pe);return Y=s_(Y),O.context===null?O.context=Y:O.pendingContext=Y,O=sa(Te,ft),O.payload={element:L},re=re===void 0?null:re,re!==null&&(O.callback=re),Vu(pe,O),L=Ja(pe,ft,Te),L!==null&&Mp(L,pe,ft),ft},t};nne.exports=Bbe;var kbe=nne.exports;const Obe=rL(kbe);var rne={exports:{}},ine={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(ye,Xe){var He=ye.length;ye.push(Xe);e:for(;0<He;){var _t=He-1>>>1,wt=ye[_t];if(0<i(wt,Xe))ye[_t]=Xe,ye[He]=wt,He=_t;else break e}}function t(ye){return ye.length===0?null:ye[0]}function r(ye){if(ye.length===0)return null;var Xe=ye[0],He=ye.pop();if(He!==Xe){ye[0]=He;e:for(var _t=0,wt=ye.length,Gt=wt>>>1;_t<Gt;){var at=2*(_t+1)-1,Ht=ye[at],Qt=at+1,rn=ye[Qt];if(0>i(Ht,He))Qt<wt&&0>i(rn,Ht)?(ye[_t]=rn,ye[Qt]=He,_t=Qt):(ye[_t]=Ht,ye[at]=He,_t=at);else if(Qt<wt&&0>i(rn,He))ye[_t]=rn,ye[Qt]=He,_t=Qt;else break e}}return Xe}function i(ye,Xe){var He=ye.sortIndex-Xe.sortIndex;return He!==0?He:ye.id-Xe.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;n.unstable_now=function(){return s.now()}}else{var a=Date,l=a.now();n.unstable_now=function(){return a.now()-l}}var o=[],h=[],d=1,m=null,_=3,y=!1,T=!1,I=!1,C=typeof setTimeout=="function"?setTimeout:null,M=typeof clearTimeout=="function"?clearTimeout:null,B=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function k(ye){for(var Xe=t(h);Xe!==null;){if(Xe.callback===null)r(h);else if(Xe.startTime<=ye)r(h),Xe.sortIndex=Xe.expirationTime,e(o,Xe);else break;Xe=t(h)}}function j(ye){if(I=!1,k(ye),!T)if(t(o)!==null)T=!0,Le(q);else{var Xe=t(h);Xe!==null&&dt(j,Xe.startTime-ye)}}function q(ye,Xe){T=!1,I&&(I=!1,M(ie),ie=-1),y=!0;var He=_;try{for(k(Xe),m=t(o);m!==null&&(!(m.expirationTime>Xe)||ye&&!fe());){var _t=m.callback;if(typeof _t=="function"){m.callback=null,_=m.priorityLevel;var wt=_t(m.expirationTime<=Xe);Xe=n.unstable_now(),typeof wt=="function"?m.callback=wt:m===t(o)&&r(o),k(Xe)}else r(o);m=t(o)}if(m!==null)var Gt=!0;else{var at=t(h);at!==null&&dt(j,at.startTime-Xe),Gt=!1}return Gt}finally{m=null,_=He,y=!1}}var Z=!1,te=null,ie=-1,se=5,ae=-1;function fe(){return!(n.unstable_now()-ae<se)}function Se(){if(te!==null){var ye=n.unstable_now();ae=ye;var Xe=!0;try{Xe=te(!0,ye)}finally{Xe?Ee():(Z=!1,te=null)}}else Z=!1}var Ee;if(typeof B=="function")Ee=function(){B(Se)};else if(typeof MessageChannel<"u"){var Re=new MessageChannel,qe=Re.port2;Re.port1.onmessage=Se,Ee=function(){qe.postMessage(null)}}else Ee=function(){C(Se,0)};function Le(ye){te=ye,Z||(Z=!0,Ee())}function dt(ye,Xe){ie=C(function(){ye(n.unstable_now())},Xe)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(ye){ye.callback=null},n.unstable_continueExecution=function(){T||y||(T=!0,Le(q))},n.unstable_forceFrameRate=function(ye){0>ye||125<ye?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):se=0<ye?Math.floor(1e3/ye):5},n.unstable_getCurrentPriorityLevel=function(){return _},n.unstable_getFirstCallbackNode=function(){return t(o)},n.unstable_next=function(ye){switch(_){case 1:case 2:case 3:var Xe=3;break;default:Xe=_}var He=_;_=Xe;try{return ye()}finally{_=He}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(ye,Xe){switch(ye){case 1:case 2:case 3:case 4:case 5:break;default:ye=3}var He=_;_=ye;try{return Xe()}finally{_=He}},n.unstable_scheduleCallback=function(ye,Xe,He){var _t=n.unstable_now();switch(typeof He=="object"&&He!==null?(He=He.delay,He=typeof He=="number"&&0<He?_t+He:_t):He=_t,ye){case 1:var wt=-1;break;case 2:wt=250;break;case 5:wt=1073741823;break;case 4:wt=1e4;break;default:wt=5e3}return wt=He+wt,ye={id:d++,callback:Xe,priorityLevel:ye,startTime:He,expirationTime:wt,sortIndex:-1},He>_t?(ye.sortIndex=He,e(h,ye),t(o)===null&&ye===t(h)&&(I?(M(ie),ie=-1):I=!0,dt(j,He-_t))):(ye.sortIndex=wt,e(o,ye),T||y||(T=!0,Le(q))),ye},n.unstable_shouldYield=fe,n.unstable_wrapCallback=function(ye){var Xe=_;return function(){var He=_;_=Xe;try{return ye.apply(this,arguments)}finally{_=He}}}})(ine);rne.exports=ine;var vW=rne.exports;const Fbe=n=>typeof n=="object"&&typeof n.then=="function",vy=[];function sne(n,e,t=(r,i)=>r===i){if(n===e)return!0;if(!n||!e)return!1;const r=n.length;if(e.length!==r)return!1;for(let i=0;i<r;i++)if(!t(n[i],e[i]))return!1;return!0}function one(n,e=null,t=!1,r={}){e===null&&(e=[n]);for(const s of vy)if(sne(e,s.keys,s.equal)){if(t)return;if(Object.prototype.hasOwnProperty.call(s,"error"))throw s.error;if(Object.prototype.hasOwnProperty.call(s,"response"))return r.lifespan&&r.lifespan>0&&(s.timeout&&clearTimeout(s.timeout),s.timeout=setTimeout(s.remove,r.lifespan)),s.response;if(!t)throw s.promise}const i={keys:e,equal:r.equal,remove:()=>{const s=vy.indexOf(i);s!==-1&&vy.splice(s,1)},promise:(Fbe(n)?n:n(...e)).then(s=>{i.response=s,r.lifespan&&r.lifespan>0&&(i.timeout=setTimeout(i.remove,r.lifespan))}).catch(s=>i.error=s)};if(vy.push(i),!t)throw i.promise}const Nbe=(n,e,t)=>one(n,e,!1,t),zbe=(n,e,t)=>void one(n,e,!0,t),Ube=n=>{if(n===void 0||n.length===0)vy.splice(0,vy.length);else{const e=vy.find(t=>sne(n,t.keys,t.equal));e&&e.remove()}},N6={},Vbe=n=>void Object.assign(N6,n);function Gbe(n,e){function t(d,{args:m=[],attach:_,...y},T){let I=`${d[0].toUpperCase()}${d.slice(1)}`,C;if(d==="primitive"){if(y.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const M=y.object;C=V1(M,{type:d,root:T,attach:_,primitive:!0})}else{const M=N6[I];if(!M)throw new Error(`R3F: ${I} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(m))throw new Error("R3F: The args prop must be an array!");C=V1(new M(...m),{type:d,root:T,attach:_,memoizedProps:{args:m}})}return C.__r3f.attach===void 0&&(C instanceof $r?C.__r3f.attach="geometry":C instanceof _o&&(C.__r3f.attach="material")),I!=="inject"&&L5(C,y),C}function r(d,m){let _=!1;if(m){var y,T;(y=m.__r3f)!=null&&y.attach?P5(d,m,m.__r3f.attach):m.isObject3D&&d.isObject3D&&(d.add(m),_=!0),_||(T=d.__r3f)==null||T.objects.push(m),m.__r3f||V1(m,{}),m.__r3f.parent=d,sF(m),G1(m)}}function i(d,m,_){let y=!1;if(m){var T,I;if((T=m.__r3f)!=null&&T.attach)P5(d,m,m.__r3f.attach);else if(m.isObject3D&&d.isObject3D){m.parent=d,m.dispatchEvent({type:"added"});const C=d.children.filter(B=>B!==m),M=C.indexOf(_);d.children=[...C.slice(0,M),m,...C.slice(M)],y=!0}y||(I=d.__r3f)==null||I.objects.push(m),m.__r3f||V1(m,{}),m.__r3f.parent=d,sF(m),G1(m)}}function s(d,m,_=!1){d&&[...d].forEach(y=>a(m,y,_))}function a(d,m,_){if(m){var y,T,I;if(m.__r3f&&(m.__r3f.parent=null),(y=d.__r3f)!=null&&y.objects&&(d.__r3f.objects=d.__r3f.objects.filter(j=>j!==m)),(T=m.__r3f)!=null&&T.attach)wW(d,m,m.__r3f.attach);else if(m.isObject3D&&d.isObject3D){var C;d.remove(m),(C=m.__r3f)!=null&&C.root&&Kbe(m.__r3f.root,m)}const B=(I=m.__r3f)==null?void 0:I.primitive,k=!B&&(_===void 0?m.dispose!==null:_);if(!B){var M;s((M=m.__r3f)==null?void 0:M.objects,m,k),s(m.children,m,k)}if(delete m.__r3f,k&&m.dispose&&m.type!=="Scene"){const j=()=>{try{m.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?vW.unstable_scheduleCallback(vW.unstable_IdlePriority,j):j()}G1(d)}}function l(d,m,_,y){var T;const I=(T=d.__r3f)==null?void 0:T.parent;if(!I)return;const C=t(m,_,d.__r3f.root);if(d.children){for(const M of d.children)M.__r3f&&r(C,M);d.children=d.children.filter(M=>!M.__r3f)}d.__r3f.objects.forEach(M=>r(C,M)),d.__r3f.objects=[],d.__r3f.autoRemovedBeforeAppend||a(I,d),C.parent&&(C.__r3f.autoRemovedBeforeAppend=!0),r(I,C),C.raycast&&C.__r3f.eventCount&&C.__r3f.root.getState().internal.interaction.push(C),[y,y.alternate].forEach(M=>{M!==null&&(M.stateNode=C,M.ref&&(typeof M.ref=="function"?M.ref(C):M.ref.current=C))})}const o=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:Obe({createInstance:t,removeChild:a,appendChild:r,appendInitialChild:r,insertBefore:i,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(d,m)=>{if(!m)return;const _=d.getState().scene;_.__r3f&&(_.__r3f.root=d,r(_,m))},removeChildFromContainer:(d,m)=>{m&&a(d.getState().scene,m)},insertInContainerBefore:(d,m,_)=>{if(!m||!_)return;const y=d.getState().scene;y.__r3f&&i(y,m,_)},getRootHostContext:()=>null,getChildHostContext:d=>d,finalizeInitialChildren(d){var m;return!!((m=d==null?void 0:d.__r3f)!=null?m:{}).handlers},prepareUpdate(d,m,_,y){var T;if(((T=d==null?void 0:d.__r3f)!=null?T:{}).primitive&&y.object&&y.object!==d)return[!0];{const{args:C=[],children:M,...B}=y,{args:k=[],children:j,...q}=_;if(!Array.isArray(C))throw new Error("R3F: the args prop must be an array!");if(C.some((te,ie)=>te!==k[ie]))return[!0];const Z=dne(d,B,q,!0);return Z.changes.length?[!1,Z]:null}},commitUpdate(d,[m,_],y,T,I,C){m?l(d,y,I,C):L5(d,_)},commitMount(d,m,_,y){var T;const I=(T=d.__r3f)!=null?T:{};d.raycast&&I.handlers&&I.eventCount&&d.__r3f.root.getState().internal.interaction.push(d)},getPublicInstance:d=>d,prepareForCommit:()=>null,preparePortalMount:d=>V1(d.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(d){var m;const{attach:_,parent:y}=(m=d.__r3f)!=null?m:{};_&&y&&wW(y,d,_),d.isObject3D&&(d.visible=!1),G1(d)},unhideInstance(d,m){var _;const{attach:y,parent:T}=(_=d.__r3f)!=null?_:{};y&&T&&P5(T,d,y),(d.isObject3D&&m.visible==null||m.visible)&&(d.visible=!0),G1(d)},createTextInstance:o,hideTextInstance:o,unhideTextInstance:o,getCurrentEventPriority:()=>e?e():ub.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&mo.fun(performance.now)?performance.now:mo.fun(Date.now)?Date.now:()=>0,scheduleTimeout:mo.fun(setTimeout)?setTimeout:void 0,cancelTimeout:mo.fun(clearTimeout)?clearTimeout:void 0}),applyProps:L5}}var _W,yW;const R5=n=>"colorSpace"in n||"outputColorSpace"in n,ane=()=>{var n;return(n=N6.ColorManagement)!=null?n:null},lne=n=>n&&n.isOrthographicCamera,Hbe=n=>n&&n.hasOwnProperty("current"),HT=typeof window<"u"&&((_W=window.document)!=null&&_W.createElement||((yW=window.navigator)==null?void 0:yW.product)==="ReactNative")?Ae.useLayoutEffect:Ae.useEffect;function cne(n){const e=Ae.useRef(n);return HT(()=>void(e.current=n),[n]),e}function jbe({set:n}){return HT(()=>(n(new Promise(()=>null)),()=>n(!1)),[n]),null}class une extends Ae.Component{constructor(...e){super(...e),this.state={error:!1}}componentDidCatch(e){this.props.set(e)}render(){return this.state.error?null:this.props.children}}une.getDerivedStateFromError=()=>({error:!0});const hne="__default",xW=new Map,Wbe=n=>n&&!!n.memoized&&!!n.changes;function fne(n){var e;const t=typeof window<"u"?(e=window.devicePixelRatio)!=null?e:2:1;return Array.isArray(n)?Math.min(Math.max(n[0],t),n[1]):n}const I2=n=>{var e;return(e=n.__r3f)==null?void 0:e.root.getState()},mo={obj:n=>n===Object(n)&&!mo.arr(n)&&typeof n!="function",fun:n=>typeof n=="function",str:n=>typeof n=="string",num:n=>typeof n=="number",boo:n=>typeof n=="boolean",und:n=>n===void 0,arr:n=>Array.isArray(n),equ(n,e,{arrays:t="shallow",objects:r="reference",strict:i=!0}={}){if(typeof n!=typeof e||!!n!=!!e)return!1;if(mo.str(n)||mo.num(n))return n===e;const s=mo.obj(n);if(s&&r==="reference")return n===e;const a=mo.arr(n);if(a&&t==="reference")return n===e;if((a||s)&&n===e)return!0;let l;for(l in n)if(!(l in e))return!1;if(s&&t==="shallow"&&r==="shallow"){for(l in i?e:n)if(!mo.equ(n[l],e[l],{strict:i,objects:"reference"}))return!1}else for(l in i?e:n)if(n[l]!==e[l])return!1;if(mo.und(l)){if(a&&n.length===0&&e.length===0||s&&Object.keys(n).length===0&&Object.keys(e).length===0)return!0;if(n!==e)return!1}return!0}};function Xbe(n){const e={nodes:{},materials:{}};return n&&n.traverse(t=>{t.name&&(e.nodes[t.name]=t),t.material&&!e.materials[t.material.name]&&(e.materials[t.material.name]=t.material)}),e}function $be(n){n.dispose&&n.type!=="Scene"&&n.dispose();for(const e in n)e.dispose==null||e.dispose(),delete n[e]}function V1(n,e){const t=n;return t.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...e},n}function iF(n,e){let t=n;if(e.includes("-")){const r=e.split("-"),i=r.pop();return t=r.reduce((s,a)=>s[a],n),{target:t,key:i}}else return{target:t,key:e}}const bW=/-\d+$/;function P5(n,e,t){if(mo.str(t)){if(bW.test(t)){const s=t.replace(bW,""),{target:a,key:l}=iF(n,s);Array.isArray(a[l])||(a[l]=[])}const{target:r,key:i}=iF(n,t);e.__r3f.previousAttach=r[i],r[i]=e}else e.__r3f.previousAttach=t(n,e)}function wW(n,e,t){var r,i;if(mo.str(t)){const{target:s,key:a}=iF(n,t),l=e.__r3f.previousAttach;l===void 0?delete s[a]:s[a]=l}else(r=e.__r3f)==null||r.previousAttach==null||r.previousAttach(n,e);(i=e.__r3f)==null||delete i.previousAttach}function dne(n,{children:e,key:t,ref:r,...i},{children:s,key:a,ref:l,...o}={},h=!1){var d;const m=(d=n==null?void 0:n.__r3f)!=null?d:{},_=Object.entries(i),y=[];if(h){const I=Object.keys(o);for(let C=0;C<I.length;C++)i.hasOwnProperty(I[C])||_.unshift([I[C],hne+"remove"])}_.forEach(([I,C])=>{var M;if((M=n.__r3f)!=null&&M.primitive&&I==="object"||mo.equ(C,o[I]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(I))return y.push([I,C,!0,[]]);let B=[];I.includes("-")&&(B=I.split("-")),y.push([I,C,!1,B]);for(const k in i){const j=i[k];k.startsWith(`${I}-`)&&y.push([k,j,!1,k.split("-")])}});const T={...i};return m.memoizedProps&&m.memoizedProps.args&&(T.args=m.memoizedProps.args),m.memoizedProps&&m.memoizedProps.attach&&(T.attach=m.memoizedProps.attach),{memoized:T,changes:y}}const qbe=typeof process<"u"&&!1;function L5(n,e){var t,r,i;const s=(t=n.__r3f)!=null?t:{},a=s.root,l=(r=a==null||a.getState==null?void 0:a.getState())!=null?r:{},{memoized:o,changes:h}=Wbe(e)?e:dne(n,e),d=s.eventCount;n.__r3f&&(n.__r3f.memoizedProps=o);for(let _=0;_<h.length;_++){let[y,T,I,C]=h[_];if(R5(n)){const j="srgb",q="srgb-linear";y==="encoding"?(y="colorSpace",T=T===3001?j:q):y==="outputEncoding"&&(y="outputColorSpace",T=T===3001?j:q)}let M=n,B=M[y];if(C.length&&(B=C.reduce((k,j)=>k[j],n),!(B&&B.set))){const[k,...j]=C.reverse();M=j.reverse().reduce((q,Z)=>q[Z],n),y=k}if(T===hne+"remove")if(M.constructor){let k=xW.get(M.constructor);k||(k=new M.constructor,xW.set(M.constructor,k)),T=k[y]}else T=0;if(I)T?s.handlers[y]=T:delete s.handlers[y],s.eventCount=Object.keys(s.handlers).length;else if(B&&B.set&&(B.copy||B instanceof Py)){if(Array.isArray(T))B.fromArray?B.fromArray(T):B.set(...T);else if(B.copy&&T&&T.constructor&&(qbe?B.constructor.name===T.constructor.name:B.constructor===T.constructor))B.copy(T);else if(T!==void 0){const k=B instanceof Gn;!k&&B.setScalar?B.setScalar(T):B instanceof Py&&T instanceof Py?B.mask=T.mask:B.set(T),!ane()&&!l.linear&&k&&B.convertSRGBToLinear()}}else if(M[y]=T,M[y]instanceof Ws&&M[y].format===jl&&M[y].type===Xf){const k=M[y];R5(k)&&R5(l.gl)?k.colorSpace=l.gl.outputColorSpace:k.encoding=l.gl.outputEncoding}G1(n)}if(s.parent&&l.internal&&n.raycast&&d!==s.eventCount){const _=l.internal.interaction.indexOf(n);_>-1&&l.internal.interaction.splice(_,1),s.eventCount&&l.internal.interaction.push(n)}return!(h.length===1&&h[0][0]==="onUpdate")&&h.length&&(i=n.__r3f)!=null&&i.parent&&sF(n),n}function G1(n){var e,t;const r=(e=n.__r3f)==null||(t=e.root)==null||t.getState==null?void 0:t.getState();r&&r.internal.frames===0&&r.invalidate()}function sF(n){n.onUpdate==null||n.onUpdate(n)}function Zbe(n,e){n.manual||(lne(n)?(n.left=e.width/-2,n.right=e.width/2,n.top=e.height/2,n.bottom=e.height/-2):n.aspect=e.width/e.height,n.updateProjectionMatrix(),n.updateMatrixWorld())}function lE(n){return(n.eventObject||n.object).uuid+"/"+n.index+n.instanceId}function Ybe(){var n;const e=typeof self<"u"&&self||typeof window<"u"&&window;if(!e)return ub.DefaultEventPriority;switch((n=e.event)==null?void 0:n.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return ub.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return ub.ContinuousEventPriority;default:return ub.DefaultEventPriority}}function pne(n,e,t,r){const i=t.get(e);i&&(t.delete(e),t.size===0&&(n.delete(r),i.target.releasePointerCapture(r)))}function Kbe(n,e){const{internal:t}=n.getState();t.interaction=t.interaction.filter(r=>r!==e),t.initialHits=t.initialHits.filter(r=>r!==e),t.hovered.forEach((r,i)=>{(r.eventObject===e||r.object===e)&&t.hovered.delete(i)}),t.capturedMap.forEach((r,i)=>{pne(t.capturedMap,e,r,i)})}function Jbe(n){function e(o){const{internal:h}=n.getState(),d=o.offsetX-h.initialClick[0],m=o.offsetY-h.initialClick[1];return Math.round(Math.sqrt(d*d+m*m))}function t(o){return o.filter(h=>["Move","Over","Enter","Out","Leave"].some(d=>{var m;return(m=h.__r3f)==null?void 0:m.handlers["onPointer"+d]}))}function r(o,h){const d=n.getState(),m=new Set,_=[],y=h?h(d.internal.interaction):d.internal.interaction;for(let M=0;M<y.length;M++){const B=I2(y[M]);B&&(B.raycaster.camera=void 0)}d.previousRoot||d.events.compute==null||d.events.compute(o,d);function T(M){const B=I2(M);if(!B||!B.events.enabled||B.raycaster.camera===null)return[];if(B.raycaster.camera===void 0){var k;B.events.compute==null||B.events.compute(o,B,(k=B.previousRoot)==null?void 0:k.getState()),B.raycaster.camera===void 0&&(B.raycaster.camera=null)}return B.raycaster.camera?B.raycaster.intersectObject(M,!0):[]}let I=y.flatMap(T).sort((M,B)=>{const k=I2(M.object),j=I2(B.object);return!k||!j?M.distance-B.distance:j.events.priority-k.events.priority||M.distance-B.distance}).filter(M=>{const B=lE(M);return m.has(B)?!1:(m.add(B),!0)});d.events.filter&&(I=d.events.filter(I,d));for(const M of I){let B=M.object;for(;B;){var C;(C=B.__r3f)!=null&&C.eventCount&&_.push({...M,eventObject:B}),B=B.parent}}if("pointerId"in o&&d.internal.capturedMap.has(o.pointerId))for(let M of d.internal.capturedMap.get(o.pointerId).values())m.has(lE(M.intersection))||_.push(M.intersection);return _}function i(o,h,d,m){const _=n.getState();if(o.length){const y={stopped:!1};for(const T of o){const I=I2(T.object)||_,{raycaster:C,pointer:M,camera:B,internal:k}=I,j=new Ze(M.x,M.y,0).unproject(B),q=ae=>{var fe,Se;return(fe=(Se=k.capturedMap.get(ae))==null?void 0:Se.has(T.eventObject))!=null?fe:!1},Z=ae=>{const fe={intersection:T,target:h.target};k.capturedMap.has(ae)?k.capturedMap.get(ae).set(T.eventObject,fe):k.capturedMap.set(ae,new Map([[T.eventObject,fe]])),h.target.setPointerCapture(ae)},te=ae=>{const fe=k.capturedMap.get(ae);fe&&pne(k.capturedMap,T.eventObject,fe,ae)};let ie={};for(let ae in h){let fe=h[ae];typeof fe!="function"&&(ie[ae]=fe)}let se={...T,...ie,pointer:M,intersections:o,stopped:y.stopped,delta:d,unprojectedPoint:j,ray:C.ray,camera:B,stopPropagation(){const ae="pointerId"in h&&k.capturedMap.get(h.pointerId);if((!ae||ae.has(T.eventObject))&&(se.stopped=y.stopped=!0,k.hovered.size&&Array.from(k.hovered.values()).find(fe=>fe.eventObject===T.eventObject))){const fe=o.slice(0,o.indexOf(T));s([...fe,T])}},target:{hasPointerCapture:q,setPointerCapture:Z,releasePointerCapture:te},currentTarget:{hasPointerCapture:q,setPointerCapture:Z,releasePointerCapture:te},nativeEvent:h};if(m(se),y.stopped===!0)break}}return o}function s(o){const{internal:h}=n.getState();for(const d of h.hovered.values())if(!o.length||!o.find(m=>m.object===d.object&&m.index===d.index&&m.instanceId===d.instanceId)){const _=d.eventObject.__r3f,y=_==null?void 0:_.handlers;if(h.hovered.delete(lE(d)),_!=null&&_.eventCount){const T={...d,intersections:o};y.onPointerOut==null||y.onPointerOut(T),y.onPointerLeave==null||y.onPointerLeave(T)}}}function a(o,h){for(let d=0;d<h.length;d++){const m=h[d].__r3f;m==null||m.handlers.onPointerMissed==null||m.handlers.onPointerMissed(o)}}function l(o){switch(o){case"onPointerLeave":case"onPointerCancel":return()=>s([]);case"onLostPointerCapture":return h=>{const{internal:d}=n.getState();"pointerId"in h&&d.capturedMap.has(h.pointerId)&&requestAnimationFrame(()=>{d.capturedMap.has(h.pointerId)&&(d.capturedMap.delete(h.pointerId),s([]))})}}return function(d){const{onPointerMissed:m,internal:_}=n.getState();_.lastEvent.current=d;const y=o==="onPointerMove",T=o==="onClick"||o==="onContextMenu"||o==="onDoubleClick",C=r(d,y?t:void 0),M=T?e(d):0;o==="onPointerDown"&&(_.initialClick=[d.offsetX,d.offsetY],_.initialHits=C.map(k=>k.eventObject)),T&&!C.length&&M<=2&&(a(d,_.interaction),m&&m(d)),y&&s(C);function B(k){const j=k.eventObject,q=j.__r3f,Z=q==null?void 0:q.handlers;if(q!=null&&q.eventCount)if(y){if(Z.onPointerOver||Z.onPointerEnter||Z.onPointerOut||Z.onPointerLeave){const te=lE(k),ie=_.hovered.get(te);ie?ie.stopped&&k.stopPropagation():(_.hovered.set(te,k),Z.onPointerOver==null||Z.onPointerOver(k),Z.onPointerEnter==null||Z.onPointerEnter(k))}Z.onPointerMove==null||Z.onPointerMove(k)}else{const te=Z[o];te?(!T||_.initialHits.includes(j))&&(a(d,_.interaction.filter(ie=>!_.initialHits.includes(ie))),te(k)):T&&_.initialHits.includes(j)&&a(d,_.interaction.filter(ie=>!_.initialHits.includes(ie)))}}i(C,d,M,B)}}return{handlePointer:l}}const mne=n=>!!(n!=null&&n.render),gne=Ae.createContext(null),Qbe=(n,e)=>{const t=Pbe((l,o)=>{const h=new Ze,d=new Ze,m=new Ze;function _(M=o().camera,B=d,k=o().size){const{width:j,height:q,top:Z,left:te}=k,ie=j/q;B instanceof Ze?m.copy(B):m.set(...B);const se=M.getWorldPosition(h).distanceTo(m);if(lne(M))return{width:j/M.zoom,height:q/M.zoom,top:Z,left:te,factor:1,distance:se,aspect:ie};{const ae=M.fov*Math.PI/180,fe=2*Math.tan(ae/2)*se,Se=fe*(j/q);return{width:Se,height:fe,top:Z,left:te,factor:j/Se,distance:se,aspect:ie}}}let y;const T=M=>l(B=>({performance:{...B.performance,current:M}})),I=new nn;return{set:l,get:o,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(M=1)=>n(o(),M),advance:(M,B)=>e(M,B,o()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new Qm,pointer:I,mouse:I,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const M=o();y&&clearTimeout(y),M.performance.current!==M.performance.min&&T(M.performance.min),y=setTimeout(()=>T(o().performance.max),M.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:_},setEvents:M=>l(B=>({...B,events:{...B.events,...M}})),setSize:(M,B,k,j,q)=>{const Z=o().camera,te={width:M,height:B,top:j||0,left:q||0,updateStyle:k};l(ie=>({size:te,viewport:{...ie.viewport,..._(Z,d,te)}}))},setDpr:M=>l(B=>{const k=fne(M);return{viewport:{...B.viewport,dpr:k,initialDpr:B.viewport.initialDpr||k}}}),setFrameloop:(M="always")=>{const B=o().clock;B.stop(),B.elapsedTime=0,M!=="never"&&(B.start(),B.elapsedTime=0),l(()=>({frameloop:M}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:Ae.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(M,B,k)=>{const j=o().internal;return j.priority=j.priority+(B>0?1:0),j.subscribers.push({ref:M,priority:B,store:k}),j.subscribers=j.subscribers.sort((q,Z)=>q.priority-Z.priority),()=>{const q=o().internal;q!=null&&q.subscribers&&(q.priority=q.priority-(B>0?1:0),q.subscribers=q.subscribers.filter(Z=>Z.ref!==M))}}}}}),r=t.getState();let i=r.size,s=r.viewport.dpr,a=r.camera;return t.subscribe(()=>{const{camera:l,size:o,viewport:h,gl:d,set:m}=t.getState();if(o.width!==i.width||o.height!==i.height||h.dpr!==s){var _;i=o,s=h.dpr,Zbe(l,o),d.setPixelRatio(h.dpr);const y=(_=o.updateStyle)!=null?_:typeof HTMLCanvasElement<"u"&&d.domElement instanceof HTMLCanvasElement;d.setSize(o.width,o.height,y)}l!==a&&(a=l,m(y=>({viewport:{...y.viewport,...y.viewport.getCurrentViewport(l)}})))}),t.subscribe(l=>n(l)),t};function ewe(n,e){const t={callback:n};return e.add(t),()=>void e.delete(t)}let cE,vne=new Set,twe=new Set,nwe=new Set;const rwe=n=>ewe(n,vne);function D5(n,e){if(n.size)for(const{callback:t}of n.values())t(e)}function R2(n,e){switch(n){case"before":return D5(vne,e);case"after":return D5(twe,e);case"tail":return D5(nwe,e)}}let B5,k5;function O5(n,e,t){let r=e.clock.getDelta();for(e.frameloop==="never"&&typeof n=="number"&&(r=n-e.clock.elapsedTime,e.clock.oldTime=e.clock.elapsedTime,e.clock.elapsedTime=n),B5=e.internal.subscribers,cE=0;cE<B5.length;cE++)k5=B5[cE],k5.ref.current(k5.store.getState(),r,t);return!e.internal.priority&&e.gl.render&&e.gl.render(e.scene,e.camera),e.internal.frames=Math.max(0,e.internal.frames-1),e.frameloop==="always"?1:e.internal.frames}function iwe(n){let e=!1,t,r,i;function s(o){r=requestAnimationFrame(s),e=!0,t=0,R2("before",o);for(const d of n.values()){var h;i=d.store.getState(),i.internal.active&&(i.frameloop==="always"||i.internal.frames>0)&&!((h=i.gl.xr)!=null&&h.isPresenting)&&(t+=O5(o,i))}if(R2("after",o),t===0)return R2("tail",o),e=!1,cancelAnimationFrame(r)}function a(o,h=1){var d;if(!o)return n.forEach(m=>a(m.store.getState()),h);(d=o.gl.xr)!=null&&d.isPresenting||!o.internal.active||o.frameloop==="never"||(o.internal.frames=Math.min(60,o.internal.frames+h),e||(e=!0,requestAnimationFrame(s)))}function l(o,h=!0,d,m){if(h&&R2("before",o),d)O5(o,d,m);else for(const _ of n.values())O5(o,_.store.getState());h&&R2("after",o)}return{loop:s,invalidate:a,advance:l}}function _ne(){const n=Ae.useContext(gne);if(!n)throw new Error("R3F: Hooks can only be used within the Canvas component!");return n}function yne(n=t=>t,e){return _ne()(n,e)}function jT(n,e=0){const t=_ne(),r=t.getState().internal.subscribe,i=cne(n);return HT(()=>r(i,e,t),[e,r,t]),null}const SW=new WeakMap;function xne(n,e){return function(t,...r){let i=SW.get(t);return i||(i=new t,SW.set(t,i)),n&&n(i),Promise.all(r.map(s=>new Promise((a,l)=>i.load(s,o=>{o.scene&&Object.assign(o,Xbe(o.scene)),a(o)},e,o=>l(new Error(`Could not load ${s}: ${o==null?void 0:o.message}`)))))).finally(()=>i.dispose==null?void 0:i.dispose())}}function WT(n,e,t,r){const i=Array.isArray(e)?e:[e],s=Nbe(xne(t,r),[n,...i],{equal:mo.equ});return Array.isArray(e)?s:s[0]}WT.preload=function(n,e,t){const r=Array.isArray(e)?e:[e];return zbe(xne(t),[n,...r])};WT.clear=function(n,e){const t=Array.isArray(e)?e:[e];return Ube([n,...t])};const Zb=new Map,{invalidate:AW,advance:TW}=iwe(Zb),{reconciler:nP,applyProps:oy}=Gbe(Zb,Ybe),x1={objects:"shallow",strict:!1},swe=(n,e)=>{const t=typeof n=="function"?n(e):n;return mne(t)?t:new Zl({powerPreference:"high-performance",canvas:e,antialias:!0,alpha:!0,...n})};function owe(n,e){const t=typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement;if(e){const{width:r,height:i,top:s,left:a,updateStyle:l=t}=e;return{width:r,height:i,top:s,left:a,updateStyle:l}}else if(typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement&&n.parentElement){const{width:r,height:i,top:s,left:a}=n.parentElement.getBoundingClientRect();return{width:r,height:i,top:s,left:a,updateStyle:t}}else if(typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas)return{width:n.width,height:n.height,top:0,left:0,updateStyle:t};return{width:0,height:0,top:0,left:0}}function awe(n){const e=Zb.get(n),t=e==null?void 0:e.fiber,r=e==null?void 0:e.store;e&&console.warn("R3F.createRoot should only be called once!");const i=typeof reportError=="function"?reportError:console.error,s=r||Qbe(AW,TW),a=t||nP.createContainer(s,ub.ConcurrentRoot,null,!1,null,"",i,null);e||Zb.set(n,{fiber:a,store:s});let l,o=!1,h;return{configure(d={}){let{gl:m,size:_,scene:y,events:T,onCreated:I,shadows:C=!1,linear:M=!1,flat:B=!1,legacy:k=!1,orthographic:j=!1,frameloop:q="always",dpr:Z=[1,2],performance:te,raycaster:ie,camera:se,onPointerMissed:ae}=d,fe=s.getState(),Se=fe.gl;fe.gl||fe.set({gl:Se=swe(m,n)});let Ee=fe.raycaster;Ee||fe.set({raycaster:Ee=new tD});const{params:Re,...qe}=ie||{};if(mo.equ(qe,Ee,x1)||oy(Ee,{...qe}),mo.equ(Re,Ee.params,x1)||oy(Ee,{params:{...Ee.params,...Re}}),!fe.camera||fe.camera===h&&!mo.equ(h,se,x1)){h=se;const wt=se instanceof LT,Gt=wt?se:j?new Kf(0,0,0,0,.1,1e3):new Qi(75,0,.1,1e3);wt||(Gt.position.z=5,se&&oy(Gt,se),!fe.camera&&!(se!=null&&se.rotation)&&Gt.lookAt(0,0,0)),fe.set({camera:Gt}),Ee.camera=Gt}if(!fe.scene){let wt;y instanceof Al?wt=y:(wt=new Al,y&&oy(wt,y)),fe.set({scene:V1(wt)})}if(!fe.xr){var Le;const wt=(Ht,Qt)=>{const rn=s.getState();rn.frameloop!=="never"&&TW(Ht,!0,rn,Qt)},Gt=()=>{const Ht=s.getState();Ht.gl.xr.enabled=Ht.gl.xr.isPresenting,Ht.gl.xr.setAnimationLoop(Ht.gl.xr.isPresenting?wt:null),Ht.gl.xr.isPresenting||AW(Ht)},at={connect(){const Ht=s.getState().gl;Ht.xr.addEventListener("sessionstart",Gt),Ht.xr.addEventListener("sessionend",Gt)},disconnect(){const Ht=s.getState().gl;Ht.xr.removeEventListener("sessionstart",Gt),Ht.xr.removeEventListener("sessionend",Gt)}};typeof((Le=Se.xr)==null?void 0:Le.addEventListener)=="function"&&at.connect(),fe.set({xr:at})}if(Se.shadowMap){const wt=Se.shadowMap.enabled,Gt=Se.shadowMap.type;if(Se.shadowMap.enabled=!!C,mo.boo(C))Se.shadowMap.type=BS;else if(mo.str(C)){var dt;const at={basic:aee,percentage:SL,soft:BS,variance:Pf};Se.shadowMap.type=(dt=at[C])!=null?dt:BS}else mo.obj(C)&&Object.assign(Se.shadowMap,C);(wt!==Se.shadowMap.enabled||Gt!==Se.shadowMap.type)&&(Se.shadowMap.needsUpdate=!0)}const ye=ane();ye&&("enabled"in ye?ye.enabled=!k:"legacyMode"in ye&&(ye.legacyMode=k)),oy(Se,{outputEncoding:M?3e3:3001,toneMapping:B?ip:TL}),fe.legacy!==k&&fe.set(()=>({legacy:k})),fe.linear!==M&&fe.set(()=>({linear:M})),fe.flat!==B&&fe.set(()=>({flat:B})),m&&!mo.fun(m)&&!mne(m)&&!mo.equ(m,Se,x1)&&oy(Se,m),T&&!fe.events.handlers&&fe.set({events:T(s)});const _t=owe(n,_);return mo.equ(_t,fe.size,x1)||fe.setSize(_t.width,_t.height,_t.updateStyle,_t.top,_t.left),Z&&fe.viewport.dpr!==fne(Z)&&fe.setDpr(Z),fe.frameloop!==q&&fe.setFrameloop(q),fe.onPointerMissed||fe.set({onPointerMissed:ae}),te&&!mo.equ(te,fe.performance,x1)&&fe.set(wt=>({performance:{...wt.performance,...te}})),l=I,o=!0,this},render(d){return o||this.configure(),nP.updateContainer(Ae.createElement(lwe,{store:s,children:d,onCreated:l,rootElement:n}),a,null,()=>{}),s},unmount(){bne(n)}}}function lwe({store:n,children:e,onCreated:t,rootElement:r}){return HT(()=>{const i=n.getState();i.set(s=>({internal:{...s.internal,active:!0}})),t&&t(i),n.getState().events.connected||i.events.connect==null||i.events.connect(r)},[]),Ae.createElement(gne.Provider,{value:n},e)}function bne(n,e){const t=Zb.get(n),r=t==null?void 0:t.fiber;if(r){const i=t==null?void 0:t.store.getState();i&&(i.internal.active=!1),nP.updateContainer(null,r,null,()=>{i&&setTimeout(()=>{try{var s,a,l,o;i.events.disconnect==null||i.events.disconnect(),(s=i.gl)==null||(a=s.renderLists)==null||a.dispose==null||a.dispose(),(l=i.gl)==null||l.forceContextLoss==null||l.forceContextLoss(),(o=i.gl)!=null&&o.xr&&i.xr.disconnect(),$be(i),Zb.delete(n)}catch{}},500)})}}nP.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:Ae.version});function oF(n,e,t){var r,i,s,a,l;e==null&&(e=100);function o(){var d=Date.now()-a;d<e&&d>=0?r=setTimeout(o,e-d):(r=null,t||(l=n.apply(s,i),s=i=null))}var h=function(){s=this,i=arguments,a=Date.now();var d=t&&!r;return r||(r=setTimeout(o,e)),d&&(l=n.apply(s,i),s=i=null),l};return h.clear=function(){r&&(clearTimeout(r),r=null)},h.flush=function(){r&&(l=n.apply(s,i),s=i=null,clearTimeout(r),r=null)},h}oF.debounce=oF;var cwe=oF;const MW=rL(cwe);function uwe(n){let{debounce:e,scroll:t,polyfill:r,offsetSize:i}=n===void 0?{debounce:0,scroll:!1,offsetSize:!1}:n;const s=r||(typeof window>"u"?class{}:window.ResizeObserver);if(!s)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[a,l]=Ae.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),o=Ae.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:a}),h=e?typeof e=="number"?e:e.scroll:null,d=e?typeof e=="number"?e:e.resize:null,m=Ae.useRef(!1);Ae.useEffect(()=>(m.current=!0,()=>void(m.current=!1)));const[_,y,T]=Ae.useMemo(()=>{const B=()=>{if(!o.current.element)return;const{left:k,top:j,width:q,height:Z,bottom:te,right:ie,x:se,y:ae}=o.current.element.getBoundingClientRect(),fe={left:k,top:j,width:q,height:Z,bottom:te,right:ie,x:se,y:ae};o.current.element instanceof HTMLElement&&i&&(fe.height=o.current.element.offsetHeight,fe.width=o.current.element.offsetWidth),Object.freeze(fe),m.current&&!pwe(o.current.lastBounds,fe)&&l(o.current.lastBounds=fe)};return[B,d?MW(B,d):B,h?MW(B,h):B]},[l,i,h,d]);function I(){o.current.scrollContainers&&(o.current.scrollContainers.forEach(B=>B.removeEventListener("scroll",T,!0)),o.current.scrollContainers=null),o.current.resizeObserver&&(o.current.resizeObserver.disconnect(),o.current.resizeObserver=null)}function C(){o.current.element&&(o.current.resizeObserver=new s(T),o.current.resizeObserver.observe(o.current.element),t&&o.current.scrollContainers&&o.current.scrollContainers.forEach(B=>B.addEventListener("scroll",T,{capture:!0,passive:!0})))}const M=B=>{!B||B===o.current.element||(I(),o.current.element=B,o.current.scrollContainers=wne(B),C())};return fwe(T,!!t),hwe(y),Ae.useEffect(()=>{I(),C()},[t,T,y]),Ae.useEffect(()=>I,[]),[M,a,_]}function hwe(n){Ae.useEffect(()=>{const e=n;return window.addEventListener("resize",e),()=>void window.removeEventListener("resize",e)},[n])}function fwe(n,e){Ae.useEffect(()=>{if(e){const t=n;return window.addEventListener("scroll",t,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",t,!0)}},[n,e])}function wne(n){const e=[];if(!n||n===document.body)return e;const{overflow:t,overflowX:r,overflowY:i}=window.getComputedStyle(n);return[t,r,i].some(s=>s==="auto"||s==="scroll")&&e.push(n),[...e,...wne(n.parentElement)]}const dwe=["x","y","top","bottom","left","right","width","height"],pwe=(n,e)=>dwe.every(t=>n[t]===e[t]);var mwe=Object.defineProperty,gwe=Object.defineProperties,vwe=Object.getOwnPropertyDescriptors,CW=Object.getOwnPropertySymbols,_we=Object.prototype.hasOwnProperty,ywe=Object.prototype.propertyIsEnumerable,EW=(n,e,t)=>e in n?mwe(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,IW=(n,e)=>{for(var t in e||(e={}))_we.call(e,t)&&EW(n,t,e[t]);if(CW)for(var t of CW(e))ywe.call(e,t)&&EW(n,t,e[t]);return n},xwe=(n,e)=>gwe(n,vwe(e));function Sne(n,e,t){if(!n)return;if(t(n)===!0)return n;let r=n.child;for(;r;){const i=Sne(r,e,t);if(i)return i;r=r.sibling}}function Ane(n){try{return Object.defineProperties(n,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return n}}const z6=Ane(Ae.createContext(null));class Tne extends Ae.Component{render(){return Ae.createElement(z6.Provider,{value:this._reactInternals},this.props.children)}}const{ReactCurrentOwner:RW,ReactCurrentDispatcher:PW}=Ae.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function bwe(){const n=Ae.useContext(z6);if(n===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const e=Ae.useId();return Ae.useMemo(()=>{for(const r of[RW==null?void 0:RW.current,n,n==null?void 0:n.alternate]){if(!r)continue;const i=Sne(r,!1,s=>{let a=s.memoizedState;for(;a;){if(a.memoizedState===e)return!0;a=a.next}});if(i)return i}},[n,e])}function wwe(){var n,e;const t=bwe(),[r]=Ae.useState(()=>new Map);r.clear();let i=t;for(;i;){const s=(n=i.type)==null?void 0:n._context;s&&s!==z6&&!r.has(s)&&r.set(s,(e=PW==null?void 0:PW.current)==null?void 0:e.readContext(Ane(s))),i=i.return}return r}function Swe(){const n=wwe();return Ae.useMemo(()=>Array.from(n.keys()).reduce((e,t)=>r=>Ae.createElement(e,null,Ae.createElement(t.Provider,xwe(IW({},r),{value:n.get(t)}))),e=>Ae.createElement(Tne,IW({},e))),[n])}const F5={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function Awe(n){const{handlePointer:e}=Jbe(n);return{priority:1,enabled:!0,compute(t,r,i){r.pointer.set(t.offsetX/r.size.width*2-1,-(t.offsetY/r.size.height)*2+1),r.raycaster.setFromCamera(r.pointer,r.camera)},connected:void 0,handlers:Object.keys(F5).reduce((t,r)=>({...t,[r]:e(r)}),{}),update:()=>{var t;const{events:r,internal:i}=n.getState();(t=i.lastEvent)!=null&&t.current&&r.handlers&&r.handlers.onPointerMove(i.lastEvent.current)},connect:t=>{var r;const{set:i,events:s}=n.getState();s.disconnect==null||s.disconnect(),i(a=>({events:{...a.events,connected:t}})),Object.entries((r=s.handlers)!=null?r:[]).forEach(([a,l])=>{const[o,h]=F5[a];t.addEventListener(o,l,{passive:h})})},disconnect:()=>{const{set:t,events:r}=n.getState();if(r.connected){var i;Object.entries((i=r.handlers)!=null?i:[]).forEach(([s,a])=>{if(r&&r.connected instanceof HTMLElement){const[l]=F5[s];r.connected.removeEventListener(l,a)}}),t(s=>({events:{...s.events,connected:void 0}}))}}}}const Twe=Ae.forwardRef(function({children:e,fallback:t,resize:r,style:i,gl:s,events:a=Awe,eventSource:l,eventPrefix:o,shadows:h,linear:d,flat:m,legacy:_,orthographic:y,frameloop:T,dpr:I,performance:C,raycaster:M,camera:B,scene:k,onPointerMissed:j,onCreated:q,...Z},te){Ae.useMemo(()=>Vbe(ene),[]);const ie=Swe(),[se,ae]=uwe({scroll:!0,debounce:{scroll:50,resize:0},...r}),fe=Ae.useRef(null),Se=Ae.useRef(null);Ae.useImperativeHandle(te,()=>fe.current);const Ee=cne(j),[Re,qe]=Ae.useState(!1),[Le,dt]=Ae.useState(!1);if(Re)throw Re;if(Le)throw Le;const ye=Ae.useRef(null);HT(()=>{const He=fe.current;ae.width>0&&ae.height>0&&He&&(ye.current||(ye.current=awe(He)),ye.current.configure({gl:s,events:a,shadows:h,linear:d,flat:m,legacy:_,orthographic:y,frameloop:T,dpr:I,performance:C,raycaster:M,camera:B,scene:k,size:ae,onPointerMissed:(..._t)=>Ee.current==null?void 0:Ee.current(..._t),onCreated:_t=>{_t.events.connect==null||_t.events.connect(l?Hbe(l)?l.current:l:Se.current),o&&_t.setEvents({compute:(wt,Gt)=>{const at=wt[o+"X"],Ht=wt[o+"Y"];Gt.pointer.set(at/Gt.size.width*2-1,-(Ht/Gt.size.height)*2+1),Gt.raycaster.setFromCamera(Gt.pointer,Gt.camera)}}),q==null||q(_t)}}),ye.current.render(Ae.createElement(ie,null,Ae.createElement(une,{set:dt},Ae.createElement(Ae.Suspense,{fallback:Ae.createElement(jbe,{set:qe})},e)))))}),Ae.useEffect(()=>{const He=fe.current;if(He)return()=>bne(He)},[]);const Xe=l?"none":"auto";return Ae.createElement("div",RA({ref:Se,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:Xe,...i}},Z),Ae.createElement("div",{ref:se,style:{width:"100%",height:"100%"}},Ae.createElement("canvas",{ref:fe,style:{display:"block"}},t)))}),nD=Ae.forwardRef(function(e,t){return Ae.createElement(Tne,null,Ae.createElement(Twe,RA({},e,{ref:t})))}),XT=new Ze,U6=new Ze,Mwe=new Ze,LW=new nn;function Cwe(n,e,t){const r=XT.setFromMatrixPosition(n.matrixWorld);r.project(e);const i=t.width/2,s=t.height/2;return[r.x*i+i,-(r.y*s)+s]}function Ewe(n,e){const t=XT.setFromMatrixPosition(n.matrixWorld),r=U6.setFromMatrixPosition(e.matrixWorld),i=t.sub(r),s=e.getWorldDirection(Mwe);return i.angleTo(s)>Math.PI/2}function Iwe(n,e,t,r){const i=XT.setFromMatrixPosition(n.matrixWorld),s=i.clone();s.project(e),LW.set(s.x,s.y),t.setFromCamera(LW,e);const a=t.intersectObjects(r,!0);if(a.length){const l=a[0].distance;return i.distanceTo(t.ray.origin)<l}return!0}function Rwe(n,e){if(e instanceof Kf)return e.zoom;if(e instanceof Qi){const t=XT.setFromMatrixPosition(n.matrixWorld),r=U6.setFromMatrixPosition(e.matrixWorld),i=e.fov*Math.PI/180,s=t.distanceTo(r);return 1/(2*Math.tan(i/2)*s)}else return 1}function Pwe(n,e,t){if(e instanceof Qi||e instanceof Kf){const r=XT.setFromMatrixPosition(n.matrixWorld),i=U6.setFromMatrixPosition(e.matrixWorld),s=r.distanceTo(i),a=(t[1]-t[0])/(e.far-e.near),l=t[1]-a*e.far;return Math.round(a*s+l)}}const aF=n=>Math.abs(n)<1e-10?0:n;function Mne(n,e,t=""){let r="matrix3d(";for(let i=0;i!==16;i++)r+=aF(e[i]*n.elements[i])+(i!==15?",":")");return t+r}const Lwe=(n=>e=>Mne(e,n))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),Dwe=(n=>(e,t)=>Mne(e,n(t),"translate(-50%,-50%)"))(n=>[1/n,1/n,1/n,1,-1/n,-1/n,-1/n,-1,1/n,1/n,1/n,1,1,1,1,1]);function Bwe(n){return n&&typeof n=="object"&&"current"in n}const kwe=Ae.forwardRef(({children:n,eps:e=.001,style:t,className:r,prepend:i,center:s,fullscreen:a,portal:l,distanceFactor:o,sprite:h=!1,transform:d=!1,occlude:m,onOcclude:_,castShadow:y,receiveShadow:T,material:I,geometry:C,zIndexRange:M=[16777271,0],calculatePosition:B=Cwe,as:k="div",wrapperClass:j,pointerEvents:q="auto",...Z},te)=>{const{gl:ie,camera:se,scene:ae,size:fe,raycaster:Se,events:Ee,viewport:Re}=yne(),[qe]=Ae.useState(()=>document.createElement(k)),Le=Ae.useRef(),dt=Ae.useRef(null),ye=Ae.useRef(0),Xe=Ae.useRef([0,0]),He=Ae.useRef(null),_t=Ae.useRef(null),wt=(l==null?void 0:l.current)||Ee.connected||ie.domElement.parentNode,Gt=Ae.useRef(null),at=Ae.useRef(!1),Ht=Ae.useMemo(()=>m&&m!=="blending"||Array.isArray(m)&&m.length&&Bwe(m[0]),[m]);Ae.useLayoutEffect(()=>{const Tn=ie.domElement;m&&m==="blending"?(Tn.style.zIndex=`${Math.floor(M[0]/2)}`,Tn.style.position="absolute",Tn.style.pointerEvents="none"):(Tn.style.zIndex=null,Tn.style.position=null,Tn.style.pointerEvents=null)},[m]),Ae.useLayoutEffect(()=>{if(dt.current){const Tn=Le.current=$Q(qe);if(ae.updateMatrixWorld(),d)qe.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const Pe=B(dt.current,se,fe);qe.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${Pe[0]}px,${Pe[1]}px,0);transform-origin:0 0;`}return wt&&(i?wt.prepend(qe):wt.appendChild(qe)),()=>{wt&&wt.removeChild(qe),Tn.unmount()}}},[wt,d]),Ae.useLayoutEffect(()=>{j&&(qe.className=j)},[j]);const Qt=Ae.useMemo(()=>d?{position:"absolute",top:0,left:0,width:fe.width,height:fe.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:s?"translate3d(-50%,-50%,0)":"none",...a&&{top:-fe.height/2,left:-fe.width/2,width:fe.width,height:fe.height},...t},[t,s,a,fe,d]),rn=Ae.useMemo(()=>({position:"absolute",pointerEvents:q}),[q]);Ae.useLayoutEffect(()=>{if(at.current=!1,d){var Tn;(Tn=Le.current)==null||Tn.render(Ae.createElement("div",{ref:He,style:Qt},Ae.createElement("div",{ref:_t,style:rn},Ae.createElement("div",{ref:te,className:r,style:t,children:n}))))}else{var Pe;(Pe=Le.current)==null||Pe.render(Ae.createElement("div",{ref:te,style:Qt,className:r,children:n}))}});const jn=Ae.useRef(!0);jT(Tn=>{if(dt.current){se.updateMatrixWorld(),dt.current.updateWorldMatrix(!0,!1);const Pe=d?Xe.current:B(dt.current,se,fe);if(d||Math.abs(ye.current-se.zoom)>e||Math.abs(Xe.current[0]-Pe[0])>e||Math.abs(Xe.current[1]-Pe[1])>e){const $e=Ewe(dt.current,se);let mn=!1;Ht&&(Array.isArray(m)?mn=m.map(kn=>kn.current):m!=="blending"&&(mn=[ae]));const cn=jn.current;if(mn){const kn=Iwe(dt.current,se,Se,mn);jn.current=kn&&!$e}else jn.current=!$e;cn!==jn.current&&(_?_(!jn.current):qe.style.display=jn.current?"block":"none");const St=Math.floor(M[0]/2),Jt=m?Ht?[M[0],St]:[St-1,0]:M;if(qe.style.zIndex=`${Pwe(dt.current,se,Jt)}`,d){const[kn,Vn]=[fe.width/2,fe.height/2],sn=se.projectionMatrix.elements[5]*Vn,{isOrthographicCamera:ot,top:Ue,left:$t,bottom:An,right:Sn}=se,jt=Lwe(se.matrixWorldInverse),mr=ot?`scale(${sn})translate(${aF(-(Sn+$t)/2)}px,${aF((Ue+An)/2)}px)`:`translateZ(${sn}px)`;let Un=dt.current.matrixWorld;h&&(Un=se.matrixWorldInverse.clone().transpose().copyPosition(Un).scale(dt.current.scale),Un.elements[3]=Un.elements[7]=Un.elements[11]=0,Un.elements[15]=1),qe.style.width=fe.width+"px",qe.style.height=fe.height+"px",qe.style.perspective=ot?"":`${sn}px`,He.current&&_t.current&&(He.current.style.transform=`${mr}${jt}translate(${kn}px,${Vn}px)`,_t.current.style.transform=Dwe(Un,1/((o||10)/400)))}else{const kn=o===void 0?1:Rwe(dt.current,se)*o;qe.style.transform=`translate3d(${Pe[0]}px,${Pe[1]}px,0) scale(${kn})`}Xe.current=Pe,ye.current=se.zoom}}if(!Ht&&Gt.current&&!at.current)if(d){if(He.current){const Pe=He.current.children[0];if(Pe!=null&&Pe.clientWidth&&Pe!=null&&Pe.clientHeight){const{isOrthographicCamera:$e}=se;if($e||C)Z.scale&&(Array.isArray(Z.scale)?Z.scale instanceof Ze?Gt.current.scale.copy(Z.scale.clone().divideScalar(1)):Gt.current.scale.set(1/Z.scale[0],1/Z.scale[1],1/Z.scale[2]):Gt.current.scale.setScalar(1/Z.scale));else{const mn=(o||10)/400,cn=Pe.clientWidth*mn,St=Pe.clientHeight*mn;Gt.current.scale.set(cn,St,1)}at.current=!0}}}else{const Pe=qe.children[0];if(Pe!=null&&Pe.clientWidth&&Pe!=null&&Pe.clientHeight){const $e=1/Re.factor,mn=Pe.clientWidth*$e,cn=Pe.clientHeight*$e;Gt.current.scale.set(mn,cn,1),at.current=!0}Gt.current.lookAt(Tn.camera.position)}});const Bn=Ae.useMemo(()=>({vertexShader:d?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom"
            is false.
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;

            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[d]);return Ae.createElement("group",RA({},Z,{ref:dt}),m&&!Ht&&Ae.createElement("mesh",{castShadow:y,receiveShadow:T,ref:Gt},C||Ae.createElement("planeGeometry",null),I||Ae.createElement("shaderMaterial",{side:bc,vertexShader:Bn.vertexShader,fragmentShader:Bn.fragmentShader})))});function DW(n,e){if(e===c6)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),n;if(e===qy||e===RT){let t=n.getIndex();if(t===null){const a=[],l=n.getAttribute("position");if(l!==void 0){for(let o=0;o<l.count;o++)a.push(o);n.setIndex(a),t=n.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),n}const r=t.count-2,i=[];if(t)if(e===qy)for(let a=1;a<=r;a++)i.push(t.getX(0)),i.push(t.getX(a)),i.push(t.getX(a+1));else for(let a=0;a<r;a++)a%2===0?(i.push(t.getX(a)),i.push(t.getX(a+1)),i.push(t.getX(a+2))):(i.push(t.getX(a+2)),i.push(t.getX(a+1)),i.push(t.getX(a)));i.length/3!==r&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=n.clone();return s.setIndex(i),s.clearGroups(),s}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),n}const Owe=parseInt(TT.replace(/\D+/g,""));function rP(n){if(typeof TextDecoder<"u")return new TextDecoder().decode(n);let e="";for(let t=0,r=n.length;t<r;t++)e+=String.fromCharCode(n[t]);try{return decodeURIComponent(escape(e))}catch{return e}}const _y="srgb",Dm="srgb-linear",BW=3001,Fwe=3e3;let V6=class extends Ea{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new Gwe(t)}),this.register(function(t){return new Hwe(t)}),this.register(function(t){return new Jwe(t)}),this.register(function(t){return new Qwe(t)}),this.register(function(t){return new e2e(t)}),this.register(function(t){return new Wwe(t)}),this.register(function(t){return new Xwe(t)}),this.register(function(t){return new $we(t)}),this.register(function(t){return new qwe(t)}),this.register(function(t){return new Vwe(t)}),this.register(function(t){return new Zwe(t)}),this.register(function(t){return new jwe(t)}),this.register(function(t){return new Kwe(t)}),this.register(function(t){return new Ywe(t)}),this.register(function(t){return new zwe(t)}),this.register(function(t){return new t2e(t)}),this.register(function(t){return new n2e(t)})}load(e,t,r,i){const s=this;let a;if(this.resourcePath!=="")a=this.resourcePath;else if(this.path!==""){const h=cu.extractUrlBase(e);a=cu.resolveURL(h,this.path)}else a=cu.extractUrlBase(e);this.manager.itemStart(e);const l=function(h){i?i(h):console.error(h),s.manager.itemError(e),s.manager.itemEnd(e)},o=new Wa(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(h){try{s.parse(h,a,function(d){t(d),s.manager.itemEnd(e)},l)}catch(d){l(d)}},r,l)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,r,i){let s;const a={},l={};if(typeof e=="string")s=JSON.parse(e);else if(e instanceof ArrayBuffer)if(rP(new Uint8Array(e.slice(0,4)))===Cne){try{a[Ui.KHR_BINARY_GLTF]=new r2e(e)}catch(d){i&&i(d);return}s=JSON.parse(a[Ui.KHR_BINARY_GLTF].content)}else s=JSON.parse(rP(new Uint8Array(e)));else s=e;if(s.asset===void 0||s.asset.version[0]<2){i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const o=new g2e(s,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});o.fileLoader.setRequestHeader(this.requestHeader);for(let h=0;h<this.pluginCallbacks.length;h++){const d=this.pluginCallbacks[h](o);d.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),l[d.name]=d,a[d.name]=!0}if(s.extensionsUsed)for(let h=0;h<s.extensionsUsed.length;++h){const d=s.extensionsUsed[h],m=s.extensionsRequired||[];switch(d){case Ui.KHR_MATERIALS_UNLIT:a[d]=new Uwe;break;case Ui.KHR_DRACO_MESH_COMPRESSION:a[d]=new i2e(s,this.dracoLoader);break;case Ui.KHR_TEXTURE_TRANSFORM:a[d]=new s2e;break;case Ui.KHR_MESH_QUANTIZATION:a[d]=new o2e;break;default:m.indexOf(d)>=0&&l[d]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+d+'".')}}o.setExtensions(a),o.setPlugins(l),o.parse(r,i)}parseAsync(e,t){const r=this;return new Promise(function(i,s){r.parse(e,t,i,s)})}};function Nwe(){let n={};return{get:function(e){return n[e]},add:function(e,t){n[e]=t},remove:function(e){delete n[e]},removeAll:function(){n={}}}}const Ui={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};let zwe=class{constructor(e){this.parser=e,this.name=Ui.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let r=0,i=t.length;r<i;r++){const s=t[r];s.extensions&&s.extensions[this.name]&&s.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(e){const t=this.parser,r="light:"+e;let i=t.cache.get(r);if(i)return i;const s=t.json,o=((s.extensions&&s.extensions[this.name]||{}).lights||[])[e];let h;const d=new Gn(16777215);o.color!==void 0&&d.setRGB(o.color[0],o.color[1],o.color[2],Dm);const m=o.range!==void 0?o.range:0;switch(o.type){case"directional":h=new Cv(d),h.target.position.set(0,0,-1),h.add(h.target);break;case"point":h=new ev(d),h.distance=m;break;case"spot":h=new QL(d),h.distance=m,o.spot=o.spot||{},o.spot.innerConeAngle=o.spot.innerConeAngle!==void 0?o.spot.innerConeAngle:0,o.spot.outerConeAngle=o.spot.outerConeAngle!==void 0?o.spot.outerConeAngle:Math.PI/4,h.angle=o.spot.outerConeAngle,h.penumbra=1-o.spot.innerConeAngle/o.spot.outerConeAngle,h.target.position.set(0,0,-1),h.add(h.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+o.type)}return h.position.set(0,0,0),h.decay=2,mm(h,o),o.intensity!==void 0&&(h.intensity=o.intensity),h.name=t.createUniqueName(o.name||"light_"+e),i=Promise.resolve(h),t.cache.add(r,i),i}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,r=this.parser,s=r.json.nodes[e],l=(s.extensions&&s.extensions[this.name]||{}).light;return l===void 0?null:this._loadLight(l).then(function(o){return r._getNodeRef(t.cache,l,o)})}},Uwe=class{constructor(){this.name=Ui.KHR_MATERIALS_UNLIT}getMaterialType(){return vo}extendParams(e,t,r){const i=[];e.color=new Gn(1,1,1),e.opacity=1;const s=t.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const a=s.baseColorFactor;e.color.setRGB(a[0],a[1],a[2],Dm),e.opacity=a[3]}s.baseColorTexture!==void 0&&i.push(r.assignTexture(e,"map",s.baseColorTexture,_y))}return Promise.all(i)}},Vwe=class{constructor(e){this.parser=e,this.name=Ui.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name].emissiveStrength;return s!==void 0&&(t.emissiveIntensity=s),Promise.resolve()}},Gwe=class{constructor(e){this.parser=e,this.name=Ui.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:jo}extendMaterialParams(e,t){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],a=i.extensions[this.name];if(a.clearcoatFactor!==void 0&&(t.clearcoat=a.clearcoatFactor),a.clearcoatTexture!==void 0&&s.push(r.assignTexture(t,"clearcoatMap",a.clearcoatTexture)),a.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=a.clearcoatRoughnessFactor),a.clearcoatRoughnessTexture!==void 0&&s.push(r.assignTexture(t,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),a.clearcoatNormalTexture!==void 0&&(s.push(r.assignTexture(t,"clearcoatNormalMap",a.clearcoatNormalTexture)),a.clearcoatNormalTexture.scale!==void 0)){const l=a.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new nn(l,l)}return Promise.all(s)}},Hwe=class{constructor(e){this.parser=e,this.name=Ui.KHR_MATERIALS_DISPERSION}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:jo}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name];return t.dispersion=s.dispersion!==void 0?s.dispersion:0,Promise.resolve()}},jwe=class{constructor(e){this.parser=e,this.name=Ui.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:jo}extendMaterialParams(e,t){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],a=i.extensions[this.name];return a.iridescenceFactor!==void 0&&(t.iridescence=a.iridescenceFactor),a.iridescenceTexture!==void 0&&s.push(r.assignTexture(t,"iridescenceMap",a.iridescenceTexture)),a.iridescenceIor!==void 0&&(t.iridescenceIOR=a.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),a.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=a.iridescenceThicknessMinimum),a.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=a.iridescenceThicknessMaximum),a.iridescenceThicknessTexture!==void 0&&s.push(r.assignTexture(t,"iridescenceThicknessMap",a.iridescenceThicknessTexture)),Promise.all(s)}},Wwe=class{constructor(e){this.parser=e,this.name=Ui.KHR_MATERIALS_SHEEN}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:jo}extendMaterialParams(e,t){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[];t.sheenColor=new Gn(0,0,0),t.sheenRoughness=0,t.sheen=1;const a=i.extensions[this.name];if(a.sheenColorFactor!==void 0){const l=a.sheenColorFactor;t.sheenColor.setRGB(l[0],l[1],l[2],Dm)}return a.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=a.sheenRoughnessFactor),a.sheenColorTexture!==void 0&&s.push(r.assignTexture(t,"sheenColorMap",a.sheenColorTexture,_y)),a.sheenRoughnessTexture!==void 0&&s.push(r.assignTexture(t,"sheenRoughnessMap",a.sheenRoughnessTexture)),Promise.all(s)}},Xwe=class{constructor(e){this.parser=e,this.name=Ui.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:jo}extendMaterialParams(e,t){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],a=i.extensions[this.name];return a.transmissionFactor!==void 0&&(t.transmission=a.transmissionFactor),a.transmissionTexture!==void 0&&s.push(r.assignTexture(t,"transmissionMap",a.transmissionTexture)),Promise.all(s)}},$we=class{constructor(e){this.parser=e,this.name=Ui.KHR_MATERIALS_VOLUME}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:jo}extendMaterialParams(e,t){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],a=i.extensions[this.name];t.thickness=a.thicknessFactor!==void 0?a.thicknessFactor:0,a.thicknessTexture!==void 0&&s.push(r.assignTexture(t,"thicknessMap",a.thicknessTexture)),t.attenuationDistance=a.attenuationDistance||1/0;const l=a.attenuationColor||[1,1,1];return t.attenuationColor=new Gn().setRGB(l[0],l[1],l[2],Dm),Promise.all(s)}},qwe=class{constructor(e){this.parser=e,this.name=Ui.KHR_MATERIALS_IOR}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:jo}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name];return t.ior=s.ior!==void 0?s.ior:1.5,Promise.resolve()}},Zwe=class{constructor(e){this.parser=e,this.name=Ui.KHR_MATERIALS_SPECULAR}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:jo}extendMaterialParams(e,t){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],a=i.extensions[this.name];t.specularIntensity=a.specularFactor!==void 0?a.specularFactor:1,a.specularTexture!==void 0&&s.push(r.assignTexture(t,"specularIntensityMap",a.specularTexture));const l=a.specularColorFactor||[1,1,1];return t.specularColor=new Gn().setRGB(l[0],l[1],l[2],Dm),a.specularColorTexture!==void 0&&s.push(r.assignTexture(t,"specularColorMap",a.specularColorTexture,_y)),Promise.all(s)}},Ywe=class{constructor(e){this.parser=e,this.name=Ui.EXT_MATERIALS_BUMP}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:jo}extendMaterialParams(e,t){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],a=i.extensions[this.name];return t.bumpScale=a.bumpFactor!==void 0?a.bumpFactor:1,a.bumpTexture!==void 0&&s.push(r.assignTexture(t,"bumpMap",a.bumpTexture)),Promise.all(s)}},Kwe=class{constructor(e){this.parser=e,this.name=Ui.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:jo}extendMaterialParams(e,t){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],a=i.extensions[this.name];return a.anisotropyStrength!==void 0&&(t.anisotropy=a.anisotropyStrength),a.anisotropyRotation!==void 0&&(t.anisotropyRotation=a.anisotropyRotation),a.anisotropyTexture!==void 0&&s.push(r.assignTexture(t,"anisotropyMap",a.anisotropyTexture)),Promise.all(s)}},Jwe=class{constructor(e){this.parser=e,this.name=Ui.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,r=t.json,i=r.textures[e];if(!i.extensions||!i.extensions[this.name])return null;const s=i.extensions[this.name],a=t.options.ktx2Loader;if(!a){if(r.extensionsRequired&&r.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,s.source,a)}},Qwe=class{constructor(e){this.parser=e,this.name=Ui.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,r=this.parser,i=r.json,s=i.textures[e];if(!s.extensions||!s.extensions[t])return null;const a=s.extensions[t],l=i.images[a.source];let o=r.textureLoader;if(l.uri){const h=r.options.manager.getHandler(l.uri);h!==null&&(o=h)}return this.detectSupport().then(function(h){if(h)return r.loadTextureImage(e,a.source,o);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return r.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}},e2e=class{constructor(e){this.parser=e,this.name=Ui.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,r=this.parser,i=r.json,s=i.textures[e];if(!s.extensions||!s.extensions[t])return null;const a=s.extensions[t],l=i.images[a.source];let o=r.textureLoader;if(l.uri){const h=r.options.manager.getHandler(l.uri);h!==null&&(o=h)}return this.detectSupport().then(function(h){if(h)return r.loadTextureImage(e,a.source,o);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return r.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}},t2e=class{constructor(e){this.name=Ui.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,r=t.bufferViews[e];if(r.extensions&&r.extensions[this.name]){const i=r.extensions[this.name],s=this.parser.getDependency("buffer",i.buffer),a=this.parser.options.meshoptDecoder;if(!a||!a.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return s.then(function(l){const o=i.byteOffset||0,h=i.byteLength||0,d=i.count,m=i.byteStride,_=new Uint8Array(l,o,h);return a.decodeGltfBufferAsync?a.decodeGltfBufferAsync(d,m,_,i.mode,i.filter).then(function(y){return y.buffer}):a.ready.then(function(){const y=new ArrayBuffer(d*m);return a.decodeGltfBuffer(new Uint8Array(y),d,m,_,i.mode,i.filter),y})})}else return null}},n2e=class{constructor(e){this.name=Ui.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,r=t.nodes[e];if(!r.extensions||!r.extensions[this.name]||r.mesh===void 0)return null;const i=t.meshes[r.mesh];for(const h of i.primitives)if(h.mode!==uh.TRIANGLES&&h.mode!==uh.TRIANGLE_STRIP&&h.mode!==uh.TRIANGLE_FAN&&h.mode!==void 0)return null;const a=r.extensions[this.name].attributes,l=[],o={};for(const h in a)l.push(this.parser.getDependency("accessor",a[h]).then(d=>(o[h]=d,o[h])));return l.length<1?null:(l.push(this.parser.createNodeMesh(e)),Promise.all(l).then(h=>{const d=h.pop(),m=d.isGroup?d.children:[d],_=h[0].count,y=[];for(const T of m){const I=new Vr,C=new Ze,M=new Aa,B=new Ze(1,1,1),k=new NL(T.geometry,T.material,_);for(let j=0;j<_;j++)o.TRANSLATION&&C.fromBufferAttribute(o.TRANSLATION,j),o.ROTATION&&M.fromBufferAttribute(o.ROTATION,j),o.SCALE&&B.fromBufferAttribute(o.SCALE,j),k.setMatrixAt(j,I.compose(C,M,B));for(const j in o)if(j==="_COLOR_0"){const q=o[j];k.instanceColor=new cv(q.array,q.itemSize,q.normalized)}else j!=="TRANSLATION"&&j!=="ROTATION"&&j!=="SCALE"&&T.geometry.setAttribute(j,o[j]);Ii.prototype.copy.call(k,T),this.parser.assignFinalMaterial(k),y.push(k)}return d.isGroup?(d.clear(),d.add(...y),d):y[0]}))}};const Cne="glTF",P2=12,kW={JSON:1313821514,BIN:5130562};let r2e=class{constructor(e){this.name=Ui.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,P2);if(this.header={magic:rP(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==Cne)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const r=this.header.length-P2,i=new DataView(e,P2);let s=0;for(;s<r;){const a=i.getUint32(s,!0);s+=4;const l=i.getUint32(s,!0);if(s+=4,l===kW.JSON){const o=new Uint8Array(e,P2+s,a);this.content=rP(o)}else if(l===kW.BIN){const o=P2+s;this.body=e.slice(o,o+a)}s+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}},i2e=class{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Ui.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const r=this.json,i=this.dracoLoader,s=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,l={},o={},h={};for(const d in a){const m=lF[d]||d.toLowerCase();l[m]=a[d]}for(const d in e.attributes){const m=lF[d]||d.toLowerCase();if(a[d]!==void 0){const _=r.accessors[e.attributes[d]],y=Mb[_.componentType];h[m]=y.name,o[m]=_.normalized===!0}}return t.getDependency("bufferView",s).then(function(d){return new Promise(function(m,_){i.decodeDracoFile(d,function(y){for(const T in y.attributes){const I=y.attributes[T],C=o[T];C!==void 0&&(I.normalized=C)}m(y)},l,h,Dm,_)})})}},s2e=class{constructor(){this.name=Ui.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}},o2e=class{constructor(){this.name=Ui.KHR_MESH_QUANTIZATION}},Ene=class extends fx{constructor(e,t,r,i){super(e,t,r,i)}copySampleValue_(e){const t=this.resultBuffer,r=this.sampleValues,i=this.valueSize,s=e*i*3+i;for(let a=0;a!==i;a++)t[a]=r[s+a];return t}interpolate_(e,t,r,i){const s=this.resultBuffer,a=this.sampleValues,l=this.valueSize,o=l*2,h=l*3,d=i-t,m=(r-t)/d,_=m*m,y=_*m,T=e*h,I=T-h,C=-2*y+3*_,M=y-_,B=1-C,k=M-_+m;for(let j=0;j!==l;j++){const q=a[I+j+l],Z=a[I+j+o]*d,te=a[T+j+l],ie=a[T+j]*d;s[j]=B*q+k*Z+C*te+M*ie}return s}};const a2e=new Aa;let l2e=class extends Ene{interpolate_(e,t,r,i){const s=super.interpolate_(e,t,r,i);return a2e.fromArray(s).normalize().toArray(s),s}};const uh={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Mb={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},OW={9728:wa,9729:Co,9984:CT,9985:Ey,9986:z0,9987:iu},FW={33071:ru,33648:jy,10497:Ph},N5={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},lF={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",...Owe>=152?{TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3"}:{TEXCOORD_0:"uv",TEXCOORD_1:"uv2"},COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},f0={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},c2e={CUBICSPLINE:void 0,LINEAR:lv,STEP:$y},z5={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function u2e(n){return n.DefaultMaterial===void 0&&(n.DefaultMaterial=new cp({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Rh})),n.DefaultMaterial}function C_(n,e,t){for(const r in t.extensions)n[r]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[r]=t.extensions[r])}function mm(n,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(n.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function h2e(n,e,t){let r=!1,i=!1,s=!1;for(let h=0,d=e.length;h<d;h++){const m=e[h];if(m.POSITION!==void 0&&(r=!0),m.NORMAL!==void 0&&(i=!0),m.COLOR_0!==void 0&&(s=!0),r&&i&&s)break}if(!r&&!i&&!s)return Promise.resolve(n);const a=[],l=[],o=[];for(let h=0,d=e.length;h<d;h++){const m=e[h];if(r){const _=m.POSITION!==void 0?t.getDependency("accessor",m.POSITION):n.attributes.position;a.push(_)}if(i){const _=m.NORMAL!==void 0?t.getDependency("accessor",m.NORMAL):n.attributes.normal;l.push(_)}if(s){const _=m.COLOR_0!==void 0?t.getDependency("accessor",m.COLOR_0):n.attributes.color;o.push(_)}}return Promise.all([Promise.all(a),Promise.all(l),Promise.all(o)]).then(function(h){const d=h[0],m=h[1],_=h[2];return r&&(n.morphAttributes.position=d),i&&(n.morphAttributes.normal=m),s&&(n.morphAttributes.color=_),n.morphTargetsRelative=!0,n})}function f2e(n,e){if(n.updateMorphTargets(),e.weights!==void 0)for(let t=0,r=e.weights.length;t<r;t++)n.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(n.morphTargetInfluences.length===t.length){n.morphTargetDictionary={};for(let r=0,i=t.length;r<i;r++)n.morphTargetDictionary[t[r]]=r}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function d2e(n){let e;const t=n.extensions&&n.extensions[Ui.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+U5(t.attributes):e=n.indices+":"+U5(n.attributes)+":"+n.mode,n.targets!==void 0)for(let r=0,i=n.targets.length;r<i;r++)e+=":"+U5(n.targets[r]);return e}function U5(n){let e="";const t=Object.keys(n).sort();for(let r=0,i=t.length;r<i;r++)e+=t[r]+":"+n[t[r]]+";";return e}function cF(n){switch(n){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function p2e(n){return n.search(/\.jpe?g($|\?)/i)>0||n.search(/^data\:image\/jpeg/)===0?"image/jpeg":n.search(/\.webp($|\?)/i)>0||n.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const m2e=new Vr;let g2e=class{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new Nwe,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let r=!1,i=!1,s=-1;typeof navigator<"u"&&typeof navigator.userAgent<"u"&&(r=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,i=navigator.userAgent.indexOf("Firefox")>-1,s=i?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||r||i&&s<98?this.textureLoader=new qf(this.options.manager):this.textureLoader=new D6(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Wa(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const r=this,i=this.json,s=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(a){return a._markDefs&&a._markDefs()}),Promise.all(this._invokeAll(function(a){return a.beforeRoot&&a.beforeRoot()})).then(function(){return Promise.all([r.getDependencies("scene"),r.getDependencies("animation"),r.getDependencies("camera")])}).then(function(a){const l={scene:a[0][i.scene||0],scenes:a[0],animations:a[1],cameras:a[2],asset:i.asset,parser:r,userData:{}};return C_(s,l,i),mm(l,i),Promise.all(r._invokeAll(function(o){return o.afterRoot&&o.afterRoot(l)})).then(function(){for(const o of l.scenes)o.updateMatrixWorld();e(l)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],r=this.json.meshes||[];for(let i=0,s=t.length;i<s;i++){const a=t[i].joints;for(let l=0,o=a.length;l<o;l++)e[a[l]].isBone=!0}for(let i=0,s=e.length;i<s;i++){const a=e[i];a.mesh!==void 0&&(this._addNodeRef(this.meshCache,a.mesh),a.skin!==void 0&&(r[a.mesh].isSkinnedMesh=!0)),a.camera!==void 0&&this._addNodeRef(this.cameraCache,a.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,r){if(e.refs[t]<=1)return r;const i=r.clone(),s=(a,l)=>{const o=this.associations.get(a);o!=null&&this.associations.set(l,o);for(const[h,d]of a.children.entries())s(d,l.children[h])};return s(r,i),i.name+="_instance_"+e.uses[t]++,i}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let r=0;r<t.length;r++){const i=e(t[r]);if(i)return i}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const r=[];for(let i=0;i<t.length;i++){const s=e(t[i]);s&&r.push(s)}return r}getDependency(e,t){const r=e+":"+t;let i=this.cache.get(r);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this._invokeOne(function(s){return s.loadNode&&s.loadNode(t)});break;case"mesh":i=this._invokeOne(function(s){return s.loadMesh&&s.loadMesh(t)});break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this._invokeOne(function(s){return s.loadBufferView&&s.loadBufferView(t)});break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this._invokeOne(function(s){return s.loadMaterial&&s.loadMaterial(t)});break;case"texture":i=this._invokeOne(function(s){return s.loadTexture&&s.loadTexture(t)});break;case"skin":i=this.loadSkin(t);break;case"animation":i=this._invokeOne(function(s){return s.loadAnimation&&s.loadAnimation(t)});break;case"camera":i=this.loadCamera(t);break;default:if(i=this._invokeOne(function(s){return s!=this&&s.getDependency&&s.getDependency(e,t)}),!i)throw new Error("Unknown type: "+e);break}this.cache.add(r,i)}return i}getDependencies(e){let t=this.cache.get(e);if(!t){const r=this,i=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(i.map(function(s,a){return r.getDependency(e,a)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],r=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[Ui.KHR_BINARY_GLTF].body);const i=this.options;return new Promise(function(s,a){r.load(cu.resolveURL(t.uri,i.path),s,void 0,function(){a(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(r){const i=t.byteLength||0,s=t.byteOffset||0;return r.slice(s,s+i)})}loadAccessor(e){const t=this,r=this.json,i=this.json.accessors[e];if(i.bufferView===void 0&&i.sparse===void 0){const a=N5[i.type],l=Mb[i.componentType],o=i.normalized===!0,h=new l(i.count*a);return Promise.resolve(new Di(h,a,o))}const s=[];return i.bufferView!==void 0?s.push(this.getDependency("bufferView",i.bufferView)):s.push(null),i.sparse!==void 0&&(s.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(s).then(function(a){const l=a[0],o=N5[i.type],h=Mb[i.componentType],d=h.BYTES_PER_ELEMENT,m=d*o,_=i.byteOffset||0,y=i.bufferView!==void 0?r.bufferViews[i.bufferView].byteStride:void 0,T=i.normalized===!0;let I,C;if(y&&y!==m){const M=Math.floor(_/y),B="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+M+":"+i.count;let k=t.cache.get(B);k||(I=new h(l,M*y,i.count*y/d),k=new dw(I,y/d),t.cache.add(B,k)),C=new Hm(k,o,_%y/d,T)}else l===null?I=new h(i.count*o):I=new h(l,_,i.count*o),C=new Di(I,o,T);if(i.sparse!==void 0){const M=N5.SCALAR,B=Mb[i.sparse.indices.componentType],k=i.sparse.indices.byteOffset||0,j=i.sparse.values.byteOffset||0,q=new B(a[1],k,i.sparse.count*M),Z=new h(a[2],j,i.sparse.count*o);l!==null&&(C=new Di(C.array.slice(),C.itemSize,C.normalized));for(let te=0,ie=q.length;te<ie;te++){const se=q[te];if(C.setX(se,Z[te*o]),o>=2&&C.setY(se,Z[te*o+1]),o>=3&&C.setZ(se,Z[te*o+2]),o>=4&&C.setW(se,Z[te*o+3]),o>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return C})}loadTexture(e){const t=this.json,r=this.options,s=t.textures[e].source,a=t.images[s];let l=this.textureLoader;if(a.uri){const o=r.manager.getHandler(a.uri);o!==null&&(l=o)}return this.loadTextureImage(e,s,l)}loadTextureImage(e,t,r){const i=this,s=this.json,a=s.textures[e],l=s.images[t],o=(l.uri||l.bufferView)+":"+a.sampler;if(this.textureCache[o])return this.textureCache[o];const h=this.loadImageSource(t,r).then(function(d){d.flipY=!1,d.name=a.name||l.name||"",d.name===""&&typeof l.uri=="string"&&l.uri.startsWith("data:image/")===!1&&(d.name=l.uri);const _=(s.samplers||{})[a.sampler]||{};return d.magFilter=OW[_.magFilter]||Co,d.minFilter=OW[_.minFilter]||iu,d.wrapS=FW[_.wrapS]||Ph,d.wrapT=FW[_.wrapT]||Ph,i.associations.set(d,{textures:e}),d}).catch(function(){return null});return this.textureCache[o]=h,h}loadImageSource(e,t){const r=this,i=this.json,s=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(m=>m.clone());const a=i.images[e],l=self.URL||self.webkitURL;let o=a.uri||"",h=!1;if(a.bufferView!==void 0)o=r.getDependency("bufferView",a.bufferView).then(function(m){h=!0;const _=new Blob([m],{type:a.mimeType});return o=l.createObjectURL(_),o});else if(a.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const d=Promise.resolve(o).then(function(m){return new Promise(function(_,y){let T=_;t.isImageBitmapLoader===!0&&(T=function(I){const C=new Ws(I);C.needsUpdate=!0,_(C)}),t.load(cu.resolveURL(m,s.path),T,void 0,y)})}).then(function(m){return h===!0&&l.revokeObjectURL(o),mm(m,a),m.userData.mimeType=a.mimeType||p2e(a.uri),m}).catch(function(m){throw console.error("THREE.GLTFLoader: Couldn't load texture",o),m});return this.sourceCache[e]=d,d}assignTexture(e,t,r,i){const s=this;return this.getDependency("texture",r.index).then(function(a){if(!a)return null;if(r.texCoord!==void 0&&r.texCoord>0&&(a=a.clone(),a.channel=r.texCoord),s.extensions[Ui.KHR_TEXTURE_TRANSFORM]){const l=r.extensions!==void 0?r.extensions[Ui.KHR_TEXTURE_TRANSFORM]:void 0;if(l){const o=s.associations.get(a);a=s.extensions[Ui.KHR_TEXTURE_TRANSFORM].extendTexture(a,l),s.associations.set(a,o)}}return i!==void 0&&(typeof i=="number"&&(i=i===BW?_y:Dm),"colorSpace"in a?a.colorSpace=i:a.encoding=i===_y?BW:Fwe),e[t]=a,a})}assignFinalMaterial(e){const t=e.geometry;let r=e.material;const i=t.attributes.tangent===void 0,s=t.attributes.color!==void 0,a=t.attributes.normal===void 0;if(e.isPoints){const l="PointsMaterial:"+r.uuid;let o=this.cache.get(l);o||(o=new su,_o.prototype.copy.call(o,r),o.color.copy(r.color),o.map=r.map,o.sizeAttenuation=!1,this.cache.add(l,o)),r=o}else if(e.isLine){const l="LineBasicMaterial:"+r.uuid;let o=this.cache.get(l);o||(o=new Ta,_o.prototype.copy.call(o,r),o.color.copy(r.color),o.map=r.map,this.cache.add(l,o)),r=o}if(i||s||a){let l="ClonedMaterial:"+r.uuid+":";i&&(l+="derivative-tangents:"),s&&(l+="vertex-colors:"),a&&(l+="flat-shading:");let o=this.cache.get(l);o||(o=r.clone(),s&&(o.vertexColors=!0),a&&(o.flatShading=!0),i&&(o.normalScale&&(o.normalScale.y*=-1),o.clearcoatNormalScale&&(o.clearcoatNormalScale.y*=-1)),this.cache.add(l,o),this.associations.set(o,this.associations.get(r))),r=o}e.material=r}getMaterialType(){return cp}loadMaterial(e){const t=this,r=this.json,i=this.extensions,s=r.materials[e];let a;const l={},o=s.extensions||{},h=[];if(o[Ui.KHR_MATERIALS_UNLIT]){const m=i[Ui.KHR_MATERIALS_UNLIT];a=m.getMaterialType(),h.push(m.extendParams(l,s,t))}else{const m=s.pbrMetallicRoughness||{};if(l.color=new Gn(1,1,1),l.opacity=1,Array.isArray(m.baseColorFactor)){const _=m.baseColorFactor;l.color.setRGB(_[0],_[1],_[2],Dm),l.opacity=_[3]}m.baseColorTexture!==void 0&&h.push(t.assignTexture(l,"map",m.baseColorTexture,_y)),l.metalness=m.metallicFactor!==void 0?m.metallicFactor:1,l.roughness=m.roughnessFactor!==void 0?m.roughnessFactor:1,m.metallicRoughnessTexture!==void 0&&(h.push(t.assignTexture(l,"metalnessMap",m.metallicRoughnessTexture)),h.push(t.assignTexture(l,"roughnessMap",m.metallicRoughnessTexture))),a=this._invokeOne(function(_){return _.getMaterialType&&_.getMaterialType(e)}),h.push(Promise.all(this._invokeAll(function(_){return _.extendMaterialParams&&_.extendMaterialParams(e,l)})))}s.doubleSided===!0&&(l.side=bc);const d=s.alphaMode||z5.OPAQUE;if(d===z5.BLEND?(l.transparent=!0,l.depthWrite=!1):(l.transparent=!1,d===z5.MASK&&(l.alphaTest=s.alphaCutoff!==void 0?s.alphaCutoff:.5)),s.normalTexture!==void 0&&a!==vo&&(h.push(t.assignTexture(l,"normalMap",s.normalTexture)),l.normalScale=new nn(1,1),s.normalTexture.scale!==void 0)){const m=s.normalTexture.scale;l.normalScale.set(m,m)}if(s.occlusionTexture!==void 0&&a!==vo&&(h.push(t.assignTexture(l,"aoMap",s.occlusionTexture)),s.occlusionTexture.strength!==void 0&&(l.aoMapIntensity=s.occlusionTexture.strength)),s.emissiveFactor!==void 0&&a!==vo){const m=s.emissiveFactor;l.emissive=new Gn().setRGB(m[0],m[1],m[2],Dm)}return s.emissiveTexture!==void 0&&a!==vo&&h.push(t.assignTexture(l,"emissiveMap",s.emissiveTexture,_y)),Promise.all(h).then(function(){const m=new a(l);return s.name&&(m.name=s.name),mm(m,s),t.associations.set(m,{materials:e}),s.extensions&&C_(i,m,s),m})}createUniqueName(e){const t=Ji.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,r=this.extensions,i=this.primitiveCache;function s(l){return r[Ui.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(l,t).then(function(o){return NW(o,l,t)})}const a=[];for(let l=0,o=e.length;l<o;l++){const h=e[l],d=d2e(h),m=i[d];if(m)a.push(m.promise);else{let _;h.extensions&&h.extensions[Ui.KHR_DRACO_MESH_COMPRESSION]?_=s(h):_=NW(new $r,h,t),i[d]={primitive:h,promise:_},a.push(_)}}return Promise.all(a)}loadMesh(e){const t=this,r=this.json,i=this.extensions,s=r.meshes[e],a=s.primitives,l=[];for(let o=0,h=a.length;o<h;o++){const d=a[o].material===void 0?u2e(this.cache):this.getDependency("material",a[o].material);l.push(d)}return l.push(t.loadGeometries(a)),Promise.all(l).then(function(o){const h=o.slice(0,o.length-1),d=o[o.length-1],m=[];for(let y=0,T=d.length;y<T;y++){const I=d[y],C=a[y];let M;const B=h[y];if(C.mode===uh.TRIANGLES||C.mode===uh.TRIANGLE_STRIP||C.mode===uh.TRIANGLE_FAN||C.mode===void 0)M=s.isSkinnedMesh===!0?new FL(I,B):new Ei(I,B),M.isSkinnedMesh===!0&&M.normalizeSkinWeights(),C.mode===uh.TRIANGLE_STRIP?M.geometry=DW(M.geometry,RT):C.mode===uh.TRIANGLE_FAN&&(M.geometry=DW(M.geometry,qy));else if(C.mode===uh.LINES)M=new uu(I,B);else if(C.mode===uh.LINE_STRIP)M=new $f(I,B);else if(C.mode===uh.LINE_LOOP)M=new zL(I,B);else if(C.mode===uh.POINTS)M=new wh(I,B);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+C.mode);Object.keys(M.geometry.morphAttributes).length>0&&f2e(M,s),M.name=t.createUniqueName(s.name||"mesh_"+e),mm(M,s),C.extensions&&C_(i,M,C),t.assignFinalMaterial(M),m.push(M)}for(let y=0,T=m.length;y<T;y++)t.associations.set(m[y],{meshes:e,primitives:y});if(m.length===1)return s.extensions&&C_(i,m[0],s),m[0];const _=new Wl;s.extensions&&C_(i,_,s),t.associations.set(_,{meshes:e});for(let y=0,T=m.length;y<T;y++)_.add(m[y]);return _})}loadCamera(e){let t;const r=this.json.cameras[e],i=r[r.type];if(!i){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return r.type==="perspective"?t=new Qi(to.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):r.type==="orthographic"&&(t=new Kf(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),r.name&&(t.name=this.createUniqueName(r.name)),mm(t,r),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],r=[];for(let i=0,s=t.joints.length;i<s;i++)r.push(this._loadNodeShallow(t.joints[i]));return t.inverseBindMatrices!==void 0?r.push(this.getDependency("accessor",t.inverseBindMatrices)):r.push(null),Promise.all(r).then(function(i){const s=i.pop(),a=i,l=[],o=[];for(let h=0,d=a.length;h<d;h++){const m=a[h];if(m){l.push(m);const _=new Vr;s!==null&&_.fromArray(s.array,h*16),o.push(_)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[h])}return new pw(l,o)})}loadAnimation(e){const t=this.json,r=this,i=t.animations[e],s=i.name?i.name:"animation_"+e,a=[],l=[],o=[],h=[],d=[];for(let m=0,_=i.channels.length;m<_;m++){const y=i.channels[m],T=i.samplers[y.sampler],I=y.target,C=I.node,M=i.parameters!==void 0?i.parameters[T.input]:T.input,B=i.parameters!==void 0?i.parameters[T.output]:T.output;I.node!==void 0&&(a.push(this.getDependency("node",C)),l.push(this.getDependency("accessor",M)),o.push(this.getDependency("accessor",B)),h.push(T),d.push(I))}return Promise.all([Promise.all(a),Promise.all(l),Promise.all(o),Promise.all(h),Promise.all(d)]).then(function(m){const _=m[0],y=m[1],T=m[2],I=m[3],C=m[4],M=[];for(let B=0,k=_.length;B<k;B++){const j=_[B],q=y[B],Z=T[B],te=I[B],ie=C[B];if(j===void 0)continue;j.updateMatrix&&j.updateMatrix();const se=r._createAnimationTracks(j,q,Z,te,ie);if(se)for(let ae=0;ae<se.length;ae++)M.push(se[ae])}return new Ky(s,void 0,M)})}createNodeMesh(e){const t=this.json,r=this,i=t.nodes[e];return i.mesh===void 0?null:r.getDependency("mesh",i.mesh).then(function(s){const a=r._getNodeRef(r.meshCache,i.mesh,s);return i.weights!==void 0&&a.traverse(function(l){if(l.isMesh)for(let o=0,h=i.weights.length;o<h;o++)l.morphTargetInfluences[o]=i.weights[o]}),a})}loadNode(e){const t=this.json,r=this,i=t.nodes[e],s=r._loadNodeShallow(e),a=[],l=i.children||[];for(let h=0,d=l.length;h<d;h++)a.push(r.getDependency("node",l[h]));const o=i.skin===void 0?Promise.resolve(null):r.getDependency("skin",i.skin);return Promise.all([s,Promise.all(a),o]).then(function(h){const d=h[0],m=h[1],_=h[2];_!==null&&d.traverse(function(y){y.isSkinnedMesh&&y.bind(_,m2e)});for(let y=0,T=m.length;y<T;y++)d.add(m[y]);return d})}_loadNodeShallow(e){const t=this.json,r=this.extensions,i=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const s=t.nodes[e],a=s.name?i.createUniqueName(s.name):"",l=[],o=i._invokeOne(function(h){return h.createNodeMesh&&h.createNodeMesh(e)});return o&&l.push(o),s.camera!==void 0&&l.push(i.getDependency("camera",s.camera).then(function(h){return i._getNodeRef(i.cameraCache,s.camera,h)})),i._invokeAll(function(h){return h.createNodeAttachment&&h.createNodeAttachment(e)}).forEach(function(h){l.push(h)}),this.nodeCache[e]=Promise.all(l).then(function(h){let d;if(s.isBone===!0?d=new OT:h.length>1?d=new Wl:h.length===1?d=h[0]:d=new Ii,d!==h[0])for(let m=0,_=h.length;m<_;m++)d.add(h[m]);if(s.name&&(d.userData.name=s.name,d.name=a),mm(d,s),s.extensions&&C_(r,d,s),s.matrix!==void 0){const m=new Vr;m.fromArray(s.matrix),d.applyMatrix4(m)}else s.translation!==void 0&&d.position.fromArray(s.translation),s.rotation!==void 0&&d.quaternion.fromArray(s.rotation),s.scale!==void 0&&d.scale.fromArray(s.scale);return i.associations.has(d)||i.associations.set(d,{}),i.associations.get(d).nodes=e,d}),this.nodeCache[e]}loadScene(e){const t=this.extensions,r=this.json.scenes[e],i=this,s=new Wl;r.name&&(s.name=i.createUniqueName(r.name)),mm(s,r),r.extensions&&C_(t,s,r);const a=r.nodes||[],l=[];for(let o=0,h=a.length;o<h;o++)l.push(i.getDependency("node",a[o]));return Promise.all(l).then(function(o){for(let d=0,m=o.length;d<m;d++)s.add(o[d]);const h=d=>{const m=new Map;for(const[_,y]of i.associations)(_ instanceof _o||_ instanceof Ws)&&m.set(_,y);return d.traverse(_=>{const y=i.associations.get(_);y!=null&&m.set(_,y)}),m};return i.associations=h(s),s})}_createAnimationTracks(e,t,r,i,s){const a=[],l=e.name?e.name:e.uuid,o=[];f0[s.path]===f0.weights?e.traverse(function(_){_.morphTargetInfluences&&o.push(_.name?_.name:_.uuid)}):o.push(l);let h;switch(f0[s.path]){case f0.weights:h=jm;break;case f0.rotation:h=Wm;break;case f0.position:case f0.scale:h=Xm;break;default:switch(r.itemSize){case 1:h=jm;break;case 2:case 3:default:h=Xm;break}break}const d=i.interpolation!==void 0?c2e[i.interpolation]:lv,m=this._getArrayFromAccessor(r);for(let _=0,y=o.length;_<y;_++){const T=new h(o[_]+"."+f0[s.path],t.array,m,d);i.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(T),a.push(T)}return a}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const r=cF(t.constructor),i=new Float32Array(t.length);for(let s=0,a=t.length;s<a;s++)i[s]=t[s]*r;t=i}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(r){const i=this instanceof Wm?l2e:Ene;return new i(this.times,this.values,this.getValueSize()/3,r)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}};function v2e(n,e,t){const r=e.attributes,i=new wl;if(r.POSITION!==void 0){const l=t.json.accessors[r.POSITION],o=l.min,h=l.max;if(o!==void 0&&h!==void 0){if(i.set(new Ze(o[0],o[1],o[2]),new Ze(h[0],h[1],h[2])),l.normalized){const d=cF(Mb[l.componentType]);i.min.multiplyScalar(d),i.max.multiplyScalar(d)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const s=e.targets;if(s!==void 0){const l=new Ze,o=new Ze;for(let h=0,d=s.length;h<d;h++){const m=s[h];if(m.POSITION!==void 0){const _=t.json.accessors[m.POSITION],y=_.min,T=_.max;if(y!==void 0&&T!==void 0){if(o.setX(Math.max(Math.abs(y[0]),Math.abs(T[0]))),o.setY(Math.max(Math.abs(y[1]),Math.abs(T[1]))),o.setZ(Math.max(Math.abs(y[2]),Math.abs(T[2]))),_.normalized){const I=cF(Mb[_.componentType]);o.multiplyScalar(I)}l.max(o)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}i.expandByVector(l)}n.boundingBox=i;const a=new rl;i.getCenter(a.center),a.radius=i.min.distanceTo(i.max)/2,n.boundingSphere=a}function NW(n,e,t){const r=e.attributes,i=[];function s(a,l){return t.getDependency("accessor",a).then(function(o){n.setAttribute(l,o)})}for(const a in r){const l=lF[a]||a.toLowerCase();l in n.attributes||i.push(s(r[a],l))}if(e.indices!==void 0&&!n.index){const a=t.getDependency("accessor",e.indices).then(function(l){n.setIndex(l)});i.push(a)}return mm(n,e),v2e(n,e,t),Promise.all(i).then(function(){return e.targets!==void 0?h2e(n,e.targets,t):n})}const V5=new WeakMap;let _2e=class extends Ea{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,r,i){const s=new Wa(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,a=>{const l={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(a,l).then(t).catch(i)},r,i)}decodeDracoFile(e,t,r,i){const s={attributeIDs:r||this.defaultAttributeIDs,attributeTypes:i||this.defaultAttributeTypes,useUniqueIDs:!!r};this.decodeGeometry(e,s).then(t)}decodeGeometry(e,t){for(const o in t.attributeTypes){const h=t.attributeTypes[o];h.BYTES_PER_ELEMENT!==void 0&&(t.attributeTypes[o]=h.name)}const r=JSON.stringify(t);if(V5.has(e)){const o=V5.get(e);if(o.key===r)return o.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let i;const s=this.workerNextTaskID++,a=e.byteLength,l=this._getWorker(s,a).then(o=>(i=o,new Promise((h,d)=>{i._callbacks[s]={resolve:h,reject:d},i.postMessage({type:"decode",id:s,taskConfig:t,buffer:e},[e])}))).then(o=>this._createGeometry(o.geometry));return l.catch(()=>!0).then(()=>{i&&s&&this._releaseTask(i,s)}),V5.set(e,{key:r,promise:l}),l}_createGeometry(e){const t=new $r;e.index&&t.setIndex(new Di(e.index.array,1));for(let r=0;r<e.attributes.length;r++){const i=e.attributes[r],s=i.name,a=i.array,l=i.itemSize;t.setAttribute(s,new Di(a,l))}return t}_loadLibrary(e,t){const r=new Wa(this.manager);return r.setPath(this.decoderPath),r.setResponseType(t),r.setWithCredentials(this.withCredentials),new Promise((i,s)=>{r.load(e,i,void 0,s)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(r=>{const i=r[0];e||(this.decoderConfig.wasmBinary=r[1]);const s=y2e.toString(),a=["/* draco decoder */",i,"","/* worker */",s.substring(s.indexOf("{")+1,s.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([a]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const i=new Worker(this.workerSourceURL);i._callbacks={},i._taskCosts={},i._taskLoad=0,i.postMessage({type:"init",decoderConfig:this.decoderConfig}),i.onmessage=function(s){const a=s.data;switch(a.type){case"decode":i._callbacks[a.id].resolve(a);break;case"error":i._callbacks[a.id].reject(a);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+a.type+'"')}},this.workerPool.push(i)}else this.workerPool.sort(function(i,s){return i._taskLoad>s._taskLoad?-1:1});const r=this.workerPool[this.workerPool.length-1];return r._taskCosts[e]=t,r._taskLoad+=t,r})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}};function y2e(){let n,e;onmessage=function(a){const l=a.data;switch(l.type){case"init":n=l.decoderConfig,e=new Promise(function(d){n.onModuleLoaded=function(m){d({draco:m})},DracoDecoderModule(n)});break;case"decode":const o=l.buffer,h=l.taskConfig;e.then(d=>{const m=d.draco,_=new m.Decoder,y=new m.DecoderBuffer;y.Init(new Int8Array(o),o.byteLength);try{const T=t(m,_,y,h),I=T.attributes.map(C=>C.array.buffer);T.index&&I.push(T.index.array.buffer),self.postMessage({type:"decode",id:l.id,geometry:T},I)}catch(T){console.error(T),self.postMessage({type:"error",id:l.id,error:T.message})}finally{m.destroy(y),m.destroy(_)}});break}};function t(a,l,o,h){const d=h.attributeIDs,m=h.attributeTypes;let _,y;const T=l.GetEncodedGeometryType(o);if(T===a.TRIANGULAR_MESH)_=new a.Mesh,y=l.DecodeBufferToMesh(o,_);else if(T===a.POINT_CLOUD)_=new a.PointCloud,y=l.DecodeBufferToPointCloud(o,_);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!y.ok()||_.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+y.error_msg());const I={index:null,attributes:[]};for(const C in d){const M=self[m[C]];let B,k;if(h.useUniqueIDs)k=d[C],B=l.GetAttributeByUniqueId(_,k);else{if(k=l.GetAttributeId(_,a[d[C]]),k===-1)continue;B=l.GetAttribute(_,k)}I.attributes.push(i(a,l,_,C,M,B))}return T===a.TRIANGULAR_MESH&&(I.index=r(a,l,_)),a.destroy(_),I}function r(a,l,o){const d=o.num_faces()*3,m=d*4,_=a._malloc(m);l.GetTrianglesUInt32Array(o,m,_);const y=new Uint32Array(a.HEAPF32.buffer,_,d).slice();return a._free(_),{array:y,itemSize:1}}function i(a,l,o,h,d,m){const _=m.num_components(),T=o.num_points()*_,I=T*d.BYTES_PER_ELEMENT,C=s(a,d),M=a._malloc(I);l.GetAttributeDataArrayForAllPoints(o,m,C,I,M);const B=new d(a.HEAPF32.buffer,M,T).slice();return a._free(M),{name:h,array:B,itemSize:_}}function s(a,l){switch(l){case Float32Array:return a.DT_FLOAT32;case Int8Array:return a.DT_INT8;case Int16Array:return a.DT_INT16;case Int32Array:return a.DT_INT32;case Uint8Array:return a.DT_UINT8;case Uint16Array:return a.DT_UINT16;case Uint32Array:return a.DT_UINT32}}}let uE;const G5=()=>{if(uE)return uE;const n="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",e="B9h9z9tFBBBFiI9gBB9gLaaaaaFa9gEaaaB9gFaFaEMcBBFBFFGGGEILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBOn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBNI9z9iqlBVc+N9IcIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMk8lLbaE97F9+FaL978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAeDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAeDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBReCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBH8ZCFD9tA8ZAPD9OD9hD9RH8ZDQBTFtGmEYIPLdKeOnHpAIAQJDBIBHyCFD9tAyAPD9OD9hD9RHyAIASJDBIBH8cCFD9tA8cAPD9OD9hD9RH8cDQBTFtGmEYIPLdKeOnH8dDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAeD9uHeDyBjGBAEAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeApA8dDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNiV8ZcpMyS8cQ8df8eb8fHdAyA8cDQNiV8ZcpMyS8cQ8df8eb8fH8ZDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/dLEK97FaF97GXGXAGCI9HQBAF9FQFCBRGEXABABDBBBHECiD+rFCiD+sFD/6FHIAECND+rFCiD+sFD/6FAID/gFAECTD+rFCiD+sFD/6FHLD/gFD/kFD/lFHKCBDtD+2FHOAICUUUU94DtHND9OD9RD/kFHI9DBB/+hDYAIAID/mFAKAKD/mFALAOALAND9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHLD/mF9DBBX9LDYHOD/kFCgFDtD9OAECUUU94DtD9OD9QAIALD/mFAOD/kFCND+rFCU/+EDtD9OD9QAKALD/mFAOD/kFCTD+rFCUU/8ODtD9OD9QDMBBABCTJRBAGCIJHGAF9JQBSGMMAF9FQBCBRGEXABCTJHVAVDBBBHECBDtHOCUU98D8cFCUU98D8cEHND9OABDBBBHKAEDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAKAEDQBFGENVcMTtmYi8ZpyHECTD+sFD/6FHID/gFAECTD+rFCTD+sFD/6FHLD/gFD/kFD/lFHE9DB/+g6DYALAEAOD+2FHOALCUUUU94DtHcD9OD9RD/kFHLALD/mFAEAED/mFAIAOAIAcD9OD9RD/kFHEAED/mFD/kFD/kFD/jFD/nFHID/mF9DBBX9LDYHOD/kFCTD+rFALAID/mFAOD/kFCggEDtD9OD9QHLAEAID/mFAOD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHEDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAKAND9OALAEDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM/hEIGaF97FaL978jUUUUBCTlREGXAF9FQBCBRIEXAEABDBBBHLABCTJHKDBBBHODQILKOSQfbPden8c8d8e8fHNCTD+sFHVCID+rFDMIBAB9DBBU8/DY9D/zI818/DYAVCEDtD9QD/6FD/nFHVALAODQBFGENVcMTtmYi8ZpyHLCTD+rFCTD+sFD/6FD/mFHOAOD/mFAVALCTD+sFD/6FD/mFHcAcD/mFAVANCTD+rFCTD+sFD/6FD/mFHNAND/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHVD/mF9DBBX9LDYHLD/kFCggEDtHMD9OAcAVD/mFALD/kFCTD+rFD9QHcANAVD/mFALD/kFCTD+rFAOAVD/mFALD/kFAMD9OD9QHVDQBFTtGEmYILPdKOenHLD8dBAEDBIBDyB+t+J83EBABCNJALD8dFAEDBIBDyF+t+J83EBAKAcAVDQNVi8ZcMpySQ8c8dfb8e8fHVD8dBAEDBIBDyG+t+J83EBABCiJAVD8dFAEDBIBDyE+t+J83EBABCAJRBAICIJHIAF9JQBMMM9jFF97GXAGCGrAF9sHG9FQBCBRFEXABABDBBBHECND+rFCND+sFD/6FAECiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBABCTJRBAFCIJHFAG9JQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),r=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]);if(typeof WebAssembly!="object")return{supported:!1};let i=n;WebAssembly.validate(t)&&(i=e);let s;const a=WebAssembly.instantiate(l(i),{}).then(m=>{s=m.instance,s.exports.__wasm_call_ctors()});function l(m){const _=new Uint8Array(m.length);for(let T=0;T<m.length;++T){const I=m.charCodeAt(T);_[T]=I>96?I-71:I>64?I-65:I>47?I+4:I>46?63:62}let y=0;for(let T=0;T<m.length;++T)_[y++]=_[T]<60?r[_[T]]:(_[T]-60)*64+_[++T];return _.buffer.slice(0,y)}function o(m,_,y,T,I,C){const M=s.exports.sbrk,B=y+3&-4,k=M(B*T),j=M(I.length),q=new Uint8Array(s.exports.memory.buffer);q.set(I,j);const Z=m(k,y,T,j,I.length);if(Z===0&&C&&C(k,B,T),_.set(q.subarray(k,k+y*T)),M(k-M(0)),Z!==0)throw new Error(`Malformed buffer data: ${Z}`)}const h={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},d={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return uE={ready:a,supported:!0,decodeVertexBuffer(m,_,y,T,I){o(s.exports.meshopt_decodeVertexBuffer,m,_,y,T,s.exports[h[I]])},decodeIndexBuffer(m,_,y,T){o(s.exports.meshopt_decodeIndexBuffer,m,_,y,T)},decodeIndexSequence(m,_,y,T){o(s.exports.meshopt_decodeIndexSequence,m,_,y,T)},decodeGltfBuffer(m,_,y,T,I,C){o(s.exports[d[I]],m,_,y,T,s.exports[h[C]])}},uE};let hE=null,Ine="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function Rne(n,e,t){return r=>{t&&t(r),n&&(hE||(hE=new _2e),hE.setDecoderPath(typeof n=="string"?n:Ine),r.setDRACOLoader(hE)),e&&r.setMeshoptDecoder(typeof G5=="function"?G5():G5)}}function eg(n,e=!0,t=!0,r){return WT(V6,n,Rne(e,t,r))}eg.preload=(n,e=!0,t=!0,r)=>WT.preload(V6,n,Rne(e,t,r));eg.clear=n=>WT.clear(V6,n);eg.setDecoderPath=n=>{Ine=n};function G6(n,e){const t=Ae.useRef(),[r]=Ae.useState(()=>e?e instanceof Ii?{current:e}:e:t),[i]=Ae.useState(()=>new Jte(void 0));Ae.useLayoutEffect(()=>{e&&(r.current=e instanceof Ii?e:e.current),i._root=r.current});const s=Ae.useRef({}),a=Ae.useMemo(()=>{const l={};return n.forEach(o=>Object.defineProperty(l,o.name,{enumerable:!0,get(){if(r.current)return s.current[o.name]||(s.current[o.name]=i.clipAction(o,r.current))},configurable:!0})),{ref:r,clips:n,actions:l,names:n.map(o=>o.name),mixer:i}},[n]);return jT((l,o)=>i.update(o)),Ae.useEffect(()=>{const l=r.current;return()=>{s.current={},i.stopAllAction(),Object.values(a.actions).forEach(o=>{l&&i.uncacheAction(o,l)})}},[n]),a}var Pne={exports:{}},x2e="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",b2e=x2e,w2e=b2e;function Lne(){}function Dne(){}Dne.resetWarningCache=Lne;var S2e=function(){function n(r,i,s,a,l,o){if(o!==w2e){var h=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw h.name="Invariant Violation",h}}n.isRequired=n;function e(){return n}var t={array:n,bigint:n,bool:n,func:n,number:n,object:n,string:n,symbol:n,any:n,arrayOf:e,element:n,elementType:n,instanceOf:e,node:n,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:Dne,resetWarningCache:Lne};return t.PropTypes=t,t};Pne.exports=S2e();var Bne=Pne.exports;const H6=()=>me.jsx(kwe,{children:me.jsx("div",{className:"flex justify-center items-center ",children:me.jsx("div",{className:"w-20 h-20 border-4 border-opacity-20 border-blue-500 border-t-indigo-800 rounded-full animate-spin"})})}),A2e=()=>me.jsxs("header",{className:"header",children:[me.jsx(mC,{to:"/about_portfolio",className:"w-10 h-10 rounded-lg bg-white items-center justify-center flex font-bold shadow-md",children:me.jsx("p",{className:"blue-gradient_text",children:"AH"})}),me.jsxs("nav",{className:"flex text-lg gap-7 font-medium shadow-text",children:[me.jsx(mC,{to:"/about_portfolio/about",className:({isActive:n})=>n?"text-blue-500":"text-black",children:"About"}),me.jsx(mC,{to:"/about_portfolio/projects",className:({isActive:n})=>n?"text-blue-500":"text-black",children:"Projects"}),me.jsx(mC,{to:"/about_portfolio/arts",className:({isActive:n})=>n?"text-blue-500":"text-black",children:"Gallery"})]})]}),T2e="data:image/svg+xml,%3csvg%20width='50'%20height='50'%20viewBox='0%200%2050%2050'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M7.03125%2044.9219L2.92969%200H46.9727L42.9688%2044.9219L25%2050'%20fill='%23264DE4'/%3e%3cpath%20d='M25%203.61328V46.0938L39.5508%2042.0898L42.9688%203.61328'%20fill='%232965F1'/%3e%3cpath%20d='M11.1328%209.17969H25V14.6484H11.6211M12.1094%2020.3125H25V25.8789H12.5977M12.8906%2028.6133H18.3594L18.75%2033.0078L25%2034.668V40.4297L13.5742%2037.3047'%20fill='%23EBEBEB'/%3e%3cpath%20d='M25%2020.3125V25.8789H31.7383L31.0547%2033.0078L25%2034.668V40.4297L36.2305%2037.3047L38.7695%209.17969H25V14.6484H32.8125L32.2754%2020.3125H25Z'%20fill='white'/%3e%3c/svg%3e",M2e="data:image/svg+xml,%3csvg%20width='51'%20height='50'%20viewBox='0%200%2051%2050'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M49%2038.2998C47.254%2038.7303%2046.174%2038.3187%2045.205%2036.908L38.314%2027.6642L37.318%2026.3844L29.2705%2036.9385C28.351%2038.2082%2027.3865%2038.7608%2025.6705%2038.3114L35.9755%2024.8995L26.3815%2012.7849C28.0315%2012.4737%2029.1715%2012.6322%2030.184%2014.0647L37.3315%2023.4234L44.5315%2014.1156C45.454%2012.846%2046.4455%2012.3632%2048.1015%2012.8315L44.3815%2017.6133L39.3415%2023.976C38.7415%2024.7032%2038.824%2025.2006%2039.376%2025.903L49%2038.2998ZM1.012%2024.6756L1.855%2020.6558C4.15%2012.7006%2013.555%209.39485%2020.041%2014.3105C23.8315%2017.2017%2024.7735%2021.2913%2024.586%2025.8725H3.22C2.899%2034.1186%209.0205%2039.0953%2016.825%2036.5561C19.5625%2035.6645%2021.175%2033.5863%2021.982%2030.9859C22.3915%2029.6829%2023.0695%2029.4792%2024.3325%2029.8516C23.6875%2033.1035%2022.2325%2035.8202%2019.1575%2037.5203C14.563%2040.0654%208.005%2039.2422%204.555%2035.7053C2.5%2033.6532%201.651%2031.0528%201.27%2028.2721C1.21%2027.8126%201.09%2027.3748%201%2026.9342C1.008%2026.1818%201.012%2025.4294%201.012%2024.677V24.6756ZM3.259%2024.1229H22.567C22.441%2018.1601%2018.6115%2013.9251%2013.378%2013.8888C7.633%2013.8451%203.508%2017.9798%203.259%2024.1229Z'%20fill='black'/%3e%3c/svg%3e",C2e="data:image/svg+xml,%3csvg%20width='51'%20height='50'%20viewBox='0%200%2051%2050'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20clip-path='url(%23clip0_1479_21476)'%3e%3cpath%20d='M2.04529%2027.5236C0.651571%2026.1298%200.651571%2023.8702%202.04529%2022.4764L23.4764%201.04529C24.8702%20-0.348429%2027.1298%20-0.348429%2028.5236%201.04529L49.9547%2022.4764C51.3484%2023.8702%2051.3484%2026.1298%2049.9547%2027.5236L28.5236%2048.9547C27.1298%2050.3484%2024.8702%2050.3484%2023.4764%2048.9547L2.04529%2027.5236Z'%20fill='%23EE513B'/%3e%3cpath%20d='M19.1342%205L17%207.17115L22.5122%2012.7787C22.2892%2013.2653%2022.1647%2013.8081%2022.1647%2014.3805C22.1647%2016.0054%2023.1683%2017.3919%2024.5793%2017.9334V31.6509C23.1683%2032.1923%2022.1647%2033.5788%2022.1647%2035.2038C22.1647%2037.3004%2023.8354%2039%2025.8963%2039C27.9573%2039%2029.628%2037.3004%2029.628%2035.2038C29.628%2033.7307%2028.8032%2032.4533%2027.5976%2031.8242V17.9521L32.8668%2023.3124C32.6546%2023.7892%2032.5366%2024.3185%2032.5366%2024.8759C32.5366%2026.9725%2034.2074%2028.6721%2036.2683%2028.6721C38.3293%2028.6721%2040%2026.9725%2040%2024.8759C40%2022.7793%2038.3293%2021.0797%2036.2683%2021.0797C35.8678%2021.0797%2035.4821%2021.1438%2035.1204%2021.2626L29.4614%2015.5058C29.5697%2015.1503%2029.628%2014.7722%2029.628%2014.3805C29.628%2012.2839%2027.9573%2010.5842%2025.8963%2010.5842C25.5112%2010.5842%2025.1398%2010.6436%2024.7902%2010.7538L19.1342%205Z'%20fill='white'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='clip0_1479_21476'%3e%3crect%20width='50'%20height='50'%20fill='white'%20transform='translate(0.820312)'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e",E2e="data:image/svg+xml,%3csvg%20width='51'%20height='50'%20viewBox='0%200%2051%2050'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20clip-path='url(%23clip0_1479_21481)'%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M25.557%200.520996C11.7523%200.520996%200.558594%2011.7575%200.558594%2025.6216C0.558594%2036.7092%207.72108%2046.1167%2017.657%2049.436C18.907%2049.6666%2019.3633%2048.8916%2019.3633%2048.2265C19.3633%2047.6304%2019.3414%2046.0523%2019.3289%2043.9581C12.3742%2045.4751%2010.907%2040.5933%2010.907%2040.5933C9.7711%2037.6944%208.13204%2036.9226%208.13204%2036.9226C5.86173%2035.3648%208.30389%2035.3962%208.30389%2035.3962C10.8117%2035.5734%2012.132%2037.983%2012.132%2037.983C14.3633%2041.8184%2017.9836%2040.7109%2019.4086%2040.0678C19.6352%2038.4457%2020.282%2037.3398%2020.9961%2036.7124C15.4445%2036.0786%209.60858%2033.9263%209.60858%2024.3087C9.60858%2021.5682%2010.582%2019.3281%2012.182%2017.5727C11.9242%2016.9374%2011.0664%2014.3867%2012.4258%2010.9309C12.4258%2010.9309%2014.5258%2010.2563%2019.3008%2013.5035C21.2961%2012.9466%2023.4336%2012.6689%2025.5602%2012.658C27.6836%2012.6689%2029.8227%2012.9466%2031.8195%2013.5035C36.5914%2010.2563%2038.6867%2010.9309%2038.6867%2010.9309C40.0508%2014.3867%2039.193%2016.9374%2038.9351%2017.5727C40.5383%2019.3281%2041.5055%2021.5682%2041.5055%2024.3087C41.5055%2033.9499%2035.6602%2036.0723%2030.0914%2036.6935C30.9883%2037.4684%2031.7883%2038.9995%2031.7883%2041.3416C31.7883%2044.697%2031.757%2047.403%2031.757%2048.2265C31.757%2048.8979%2032.2071%2049.6791%2033.4758%2049.4329C43.4024%2046.1072%2050.5586%2036.706%2050.5586%2025.6216C50.5586%2011.7575%2039.3648%200.520996%2025.557%200.520996Z'%20fill='black'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='clip0_1479_21481'%3e%3crect%20width='50'%20height='50'%20fill='white'%20transform='translate(0.558594)'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e",I2e="data:image/svg+xml,%3csvg%20width='50'%20height='50'%20viewBox='0%200%2050%2050'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M6.93359%2044.9219L2.92969%200H46.9727L42.9688%2044.9219L24.9023%2050'%20fill='%23E34F26'/%3e%3cpath%20d='M25%2046.0938L39.5508%2042.0898L42.9688%203.61328H25'%20fill='%23EF652A'/%3e%3cpath%20d='M25%2020.3125H17.6758L17.1875%2014.6484H25V9.17969H11.1328L12.5977%2025.8789H25V20.3125ZM24.9023%2034.668L18.75%2033.0078L18.3594%2028.6133H12.8906L13.5742%2037.3047L24.9023%2040.4297V34.668Z'%20fill='%23EBEBEB'/%3e%3cpath%20d='M24.9023%2020.3125V25.8789H31.7383L31.0547%2033.0078L24.9023%2034.668V40.4297L36.2305%2037.3047L37.793%2020.3125H24.9023ZM24.9023%209.17969V14.6484H38.2812L38.7695%209.17969H24.9023Z'%20fill='white'/%3e%3c/svg%3e",R2e="data:image/svg+xml,%3csvg%20width='51'%20height='50'%20viewBox='0%200%2051%2050'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20clip-path='url(%23clip0_1479_21409)'%3e%3cpath%20d='M43%200H8C3.85786%200%200.5%203.35786%200.5%207.5V42.5C0.5%2046.6421%203.85786%2050%208%2050H43C47.1421%2050%2050.5%2046.6421%2050.5%2042.5V7.5C50.5%203.35786%2047.1421%200%2043%200Z'%20fill='%23F0DB4F'/%3e%3cpath%20d='M32.1406%2036.1328C33.1172%2037.793%2034.4844%2038.9648%2036.7305%2038.9648C38.6836%2038.9648%2039.9531%2037.9883%2039.9531%2036.6211C39.9531%2035.0586%2038.6836%2034.4727%2036.5352%2033.4961L35.3633%2033.0078C31.9453%2031.543%2029.6992%2029.7852%2029.6992%2025.9766C29.6992%2022.4609%2032.3359%2019.7266%2036.5352%2019.7266C39.5625%2019.7266%2041.7109%2020.8008%2043.1758%2023.5352L39.5625%2025.8789C38.7812%2024.4141%2037.9023%2023.8281%2036.5352%2023.8281C35.168%2023.8281%2034.2891%2024.707%2034.2891%2025.8789C34.2891%2027.2461%2035.168%2027.832%2037.2188%2028.7109L38.3906%2029.1992C42.3945%2030.957%2044.6406%2032.6172%2044.6406%2036.6211C44.6406%2040.8203%2041.3203%2043.1641%2036.8281%2043.1641C32.4336%2043.1641%2029.6016%2041.1133%2028.2344%2038.3789L32.1406%2036.1328ZM15.5391%2036.5234C16.3203%2037.793%2016.9062%2038.9648%2018.5664%2038.9648C20.1289%2038.9648%2021.1055%2038.3789%2021.1055%2036.0352V19.8242H25.793V35.8398C25.793%2040.7227%2022.9609%2042.8711%2018.7617%2042.8711C14.9531%2042.8711%2012.8047%2040.918%2011.7305%2038.5742L15.5391%2036.5234Z'%20fill='%23323330'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='clip0_1479_21409'%3e%3crect%20width='50'%20height='50'%20fill='white'%20transform='translate(0.5)'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e",P2e="data:image/svg+xml,%3csvg%20width='51'%20height='50'%20viewBox='0%200%2051%2050'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20clip-path='url(%23clip0_1479_21496)'%3e%3cpath%20d='M25.7715%2050C39.5786%2050%2050.7715%2038.8071%2050.7715%2025C50.7715%2011.1929%2039.5786%200%2025.7715%200C11.9644%200%200.771484%2011.1929%200.771484%2025C0.771484%2038.8071%2011.9644%2050%2025.7715%2050Z'%20fill='%2313AA52'/%3e%3cpath%20d='M32.4546%2021.9453C30.8755%2014.9761%2027.1436%2012.6846%2026.7417%2011.8091C26.3023%2011.1914%2025.857%2010.0928%2025.857%2010.0928C25.8497%2010.0742%2025.8379%2010.0415%2025.8243%2010.0098C25.7789%2010.6274%2025.7554%2010.8657%2025.1714%2011.4888C24.2671%2012.1958%2019.6275%2016.0889%2019.2501%2024.0068C18.898%2031.3916%2024.5845%2035.792%2025.3536%2036.353L25.441%2036.415V36.4097C25.4459%2036.4468%2025.6851%2038.1675%2025.8531%2039.9907H26.4556C26.597%2038.7019%2026.8089%2037.4219%2027.0904%2036.1562L27.1392%2036.1245C27.4832%2035.8779%2027.8112%2035.6096%2028.1211%2035.3213L28.1563%2035.2896C29.7911%2033.7793%2032.73%2030.2861%2032.7012%2024.7168C32.6951%2023.7878%2032.6127%2022.8608%2032.4546%2021.9453ZM25.7891%2032.1836C25.7891%2032.1836%2025.7891%2021.8262%2026.1309%2021.8281C26.3975%2021.8281%2026.7427%2035.188%2026.7427%2035.188C26.2681%2035.1309%2025.7891%2032.9893%2025.7891%2032.1836Z'%20fill='white'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='clip0_1479_21496'%3e%3crect%20width='50'%20height='50'%20fill='white'%20transform='translate(0.771484)'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e",L2e="data:image/svg+xml,%3csvg%20width='50'%20height='50'%20viewBox='0%200%2050%2050'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20clip-path='url(%23clip0_1479_21469)'%3e%3cpath%20d='M50%200V25L25%2050L12.5%2037.5L25%2025L50%200Z'%20fill='%2359529D'/%3e%3cpath%20d='M50%2025V50L37.5%2037.5L50%2025Z'%20fill='%235271B4'/%3e%3cpath%20d='M25%2025L0%2050V0L25%2025Z'%20fill='%23BB4B96'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='clip0_1479_21469'%3e%3crect%20width='50'%20height='50'%20fill='white'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e",D2e="data:image/svg+xml,%3csvg%20width='50'%20height='50'%20viewBox='0%200%2050%2050'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M0%2026.7281V5.07812L18.75%2015.9031V23.1198L6.25%2015.9031V30.3365L0%2026.7281Z'%20fill='%2300B0FF'/%3e%3cpath%20d='M18.75%2015.9031L37.5%205.07812V26.7281L25%2033.9448L18.75%2030.3365L31.25%2023.1198V15.9031L18.75%2023.1198V15.9031Z'%20fill='%230081CB'/%3e%3cpath%20d='M18.75%2030.3364V37.5531L31.25%2044.7698V37.5531L18.75%2030.3364Z'%20fill='%2300B0FF'/%3e%3cpath%20d='M31.25%2044.7698L50%2033.9448V19.5115L43.75%2023.1198V30.3365L31.25%2037.5531V44.7698ZM43.75%2015.9031V8.68646L50%205.07812V12.2948L43.75%2015.9031Z'%20fill='%230081CB'/%3e%3c/svg%3e",B2e="data:image/svg+xml,%3csvg%20width='50'%20height='50'%20viewBox='0%200%2050%2050'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cmask%20id='mask0_1479_21424'%20style='mask-type:alpha'%20maskUnits='userSpaceOnUse'%20x='0'%20y='0'%20width='50'%20height='50'%3e%3cpath%20d='M25%2050C38.8071%2050%2050%2038.8071%2050%2025C50%2011.1929%2038.8071%200%2025%200C11.1929%200%200%2011.1929%200%2025C0%2038.8071%2011.1929%2050%2025%2050Z'%20fill='black'/%3e%3c/mask%3e%3cg%20mask='url(%23mask0_1479_21424)'%3e%3cpath%20d='M25%2050C38.8071%2050%2050%2038.8071%2050%2025C50%2011.1929%2038.8071%200%2025%200C11.1929%200%200%2011.1929%200%2025C0%2038.8071%2011.1929%2050%2025%2050Z'%20fill='%23192333'/%3e%3cpath%20d='M41.53%2043.7556L19.2061%2015H15V34.9917H18.3649V19.2732L38.8886%2045.7903C39.8147%2045.1706%2040.6969%2044.4903%2041.53%2043.7556Z'%20fill='url(%23paint0_linear_1479_21424)'/%3e%3cpath%20d='M35.2786%2015H31.9453V35H35.2786V15Z'%20fill='url(%23paint1_linear_1479_21424)'/%3e%3c/g%3e%3cdefs%3e%3clinearGradient%20id='paint0_linear_1479_21424'%20x1='30.2778'%20y1='32.3611'%20x2='40.1389'%20y2='44.5833'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='white'/%3e%3cstop%20offset='1'%20stop-color='white'%20stop-opacity='0'/%3e%3c/linearGradient%3e%3clinearGradient%20id='paint1_linear_1479_21424'%20x1='33.612'%20y1='15'%20x2='33.5561'%20y2='29.6875'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='white'/%3e%3cstop%20offset='1'%20stop-color='white'%20stop-opacity='0'/%3e%3c/linearGradient%3e%3c/defs%3e%3c/svg%3e",k2e="data:image/svg+xml,%3csvg%20width='45'%20height='50'%20viewBox='0%200%2045%2050'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M22.2977%2049.9072C21.6099%2049.9072%2020.968%2049.7238%2020.372%2049.4029L14.274%2045.7808C13.357%2045.2764%2013.8155%2045.093%2014.0906%2045.0013C15.3285%2044.5887%2015.5578%2044.497%2016.8416%2043.7634C16.9791%2043.6717%2017.1625%2043.7175%2017.3001%2043.8092L21.9767%2046.6061C22.1601%2046.6978%2022.3894%2046.6978%2022.5269%2046.6061L40.8209%2036.0148C41.0043%2035.9231%2041.096%2035.7397%2041.096%2035.5105V14.3738C41.096%2014.1446%2041.0043%2013.9612%2040.8209%2013.8695L22.5269%203.32409C22.3435%203.23239%2022.1143%203.23239%2021.9767%203.32409L3.68276%2013.8695C3.49936%2013.9612%203.40766%2014.1904%203.40766%2014.3738V35.5105C3.40766%2035.6939%203.49936%2035.9231%203.68276%2036.0148L8.68036%2038.9033C11.3855%2040.2788%2013.0819%2038.6741%2013.0819%2037.0694V16.2078C13.0819%2015.9327%2013.3112%2015.6576%2013.6321%2015.6576H15.9704C16.2455%2015.6576%2016.5206%2015.8869%2016.5206%2016.2078V37.0694C16.5206%2040.6915%2014.5491%2042.8005%2011.1104%2042.8005C10.0558%2042.8005%209.23055%2042.8005%206.89223%2041.6543L2.07802%2038.9033C0.885936%2038.2156%200.152344%2036.9318%200.152344%2035.5563V14.4197C0.152344%2013.0442%200.885936%2011.7604%202.07802%2011.0727L20.372%200.48142C21.5182%20-0.160473%2023.0771%20-0.160473%2024.2234%200.48142L42.5173%2011.0727C43.7094%2011.7604%2044.443%2013.0442%2044.443%2014.4197V35.5563C44.443%2036.9318%2043.7094%2038.2156%2042.5173%2038.9033L24.2234%2049.4946C23.6273%2049.7697%2022.9396%2049.9072%2022.2977%2049.9072ZM27.9372%2035.3729C19.9135%2035.3729%2018.2629%2031.705%2018.2629%2028.5872C18.2629%2028.3121%2018.4922%2028.037%2018.8131%2028.037H21.1973C21.4724%2028.037%2021.7016%2028.2204%2021.7016%2028.4955C22.0684%2030.9255%2023.123%2032.1176%2027.983%2032.1176C31.8344%2032.1176%2033.485%2031.2465%2033.485%2029.1832C33.485%2027.9911%2033.0265%2027.12%2027.0202%2026.524C22.0226%2026.0196%2018.9048%2024.9192%2018.9048%2020.9303C18.9048%2017.2165%2022.0226%2015.0157%2027.2494%2015.0157C33.1182%2015.0157%2036.0067%2017.0331%2036.3735%2021.4347C36.3735%2021.5722%2036.3276%2021.7098%2036.2359%2021.8473C36.1442%2021.939%2036.0067%2022.0307%2035.8691%2022.0307H33.485C33.2557%2022.0307%2033.0265%2021.8473%2032.9806%2021.6181C32.4304%2019.0963%2031.0091%2018.271%2027.2494%2018.271C23.0313%2018.271%2022.5269%2019.7382%2022.5269%2020.8386C22.5269%2022.1683%2023.123%2022.5809%2028.8083%2023.3145C34.4478%2024.0481%2037.1071%2025.1026%2037.1071%2029.0457C37.0612%2033.0804%2033.7601%2035.3729%2027.9372%2035.3729Z'%20fill='%23539E43'/%3e%3c/svg%3e",O2e="data:image/svg+xml,%3csvg%20width='81'%20height='80'%20viewBox='0%200%2081%2080'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20clip-path='url(%23clip0_1479_21414)'%3e%3cpath%20d='M45.458%2041.5776C46.4212%2038.9707%2045.0226%2036.0517%2042.3335%2035.0581C39.6448%2034.0647%2036.6839%2035.3729%2035.7207%2037.9798C34.7574%2040.5871%2036.1565%2043.506%2038.8452%2044.4994C41.5342%2045.493%2044.4947%2044.1848%2045.458%2041.5776Z'%20fill='%2353C1DE'/%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M59.6393%2036.8569C62.1641%2033.1859%2066.232%2026.1515%2062.6171%2021.9214C59.0193%2017.7103%2051.3231%2020.3888%2047.1296%2022.154C45.0896%2018.1187%2040.8104%2011.0391%2035.3144%2011.9121C29.8415%2012.7815%2028.5099%2020.6853%2028.0547%2025.1499C23.3961%2024.752%2015.221%2024.5819%2013.3277%2029.7061C11.4398%2034.8158%2017.6725%2040.2198%2021.4461%2042.9362C18.8768%2046.6453%2014.8585%2053.4365%2018.4592%2057.652C22.0844%2061.8945%2029.8773%2059.4062%2034.1115%2057.6197C36.1635%2061.7121%2040.2513%2068.6252%2045.7274%2067.7553C51.2207%2066.8827%2052.774%2059.0337%2053.2378%2054.5454C57.7432%2054.885%2065.9859%2054.8969%2067.8502%2049.851C69.7253%2044.7761%2063.3722%2039.5552%2059.6393%2036.8569ZM53.4062%2052.1383C53.4986%2049.7653%2053.3994%2047.1688%2053.1197%2044.4212C55.0466%2042.5513%2056.7633%2040.6588%2058.2117%2038.8023C60.9457%2040.7872%2066.9143%2045.2201%2065.5212%2048.9905C64.115%2052.7964%2056.9614%2052.402%2053.4062%2052.1383ZM45.2824%2065.3697C41.1967%2066.0185%2037.8496%2059.6152%2036.3318%2056.5991C38.4703%2055.5375%2040.7055%2054.2107%2042.9811%2052.661C45.7008%2053.4083%2048.3278%2053.9576%2050.7731%2054.2858C50.4413%2057.4592%2049.3862%2064.7177%2045.2824%2065.3697ZM20.3459%2056.1254C17.6606%2052.9828%2021.6084%2047.0564%2023.5%2044.3238C25.5561%2045.628%2027.901%2046.886%2030.4664%2048.0699C31.2143%2050.6853%2032.0952%2053.1607%2033.0751%2055.4057C30.4265%2056.5238%2023.0437%2059.2825%2020.3459%2056.1254ZM15.6567%2030.5667C17.0682%2026.7466%2024.4399%2027.2588%2027.8765%2027.5563C27.7639%2029.96%2027.8276%2032.5405%2028.067%2035.2146C26.1199%2037.1192%2024.3678%2039.0692%2022.8747%2040.9918C20.2045%2039.0667%2014.2445%2034.389%2015.6567%2030.5667ZM35.7592%2014.2977C39.862%2013.6461%2043.4186%2020.239%2044.902%2023.163C42.7088%2024.2269%2040.4497%2025.5261%2038.1983%2027.0198C35.549%2026.3028%2032.9576%2025.7659%2030.5178%2025.4279C30.8859%2021.8274%2031.6608%2014.9486%2035.7592%2014.2977ZM51.5018%2034.7248C53.1628%2035.5804%2054.7249%2036.4794%2056.1619%2037.404C55.1526%2038.6905%2054.0029%2040.001%2052.7349%2041.3113C52.4147%2039.1027%2052.0074%2036.9038%2051.5018%2034.7248ZM45.9385%2025.3801C46.5958%2026.9054%2047.2062%2028.563%2047.7595%2030.3211C45.649%2029.4294%2043.4988%2028.6345%2041.3159%2027.9387C42.8757%2026.9757%2044.4257%2026.1185%2045.9385%2025.3801ZM30.3849%2033.0516C30.2829%2031.2413%2030.2692%2029.4933%2030.3425%2027.8372C32.0228%2028.0745%2033.7838%2028.4116%2035.5895%2028.8408C33.7866%2030.1626%2032.0496%2031.5683%2030.3849%2033.0516ZM29.6689%2045.0176C27.9548%2044.1647%2026.3675%2043.2806%2024.9336%2042.3778C25.9718%2041.0486%2027.1437%2039.7012%2028.4252%2038.3638C28.7319%2040.5974%2029.1476%2042.8183%2029.6689%2045.0176ZM35.297%2054.3797C34.6199%2052.8169%2033.9907%2051.1325%2033.423%2049.3612C35.5517%2050.2411%2037.7149%2051.0406%2039.9084%2051.7449C38.3297%2052.7516%2036.7849%2053.6348%2035.297%2054.3797ZM50.8253%2046.548C50.959%2048.4279%2050.9976%2050.2129%2050.9381%2051.8748C49.2279%2051.6405%2047.4171%2051.2916%2045.5415%2050.8363C47.3633%2049.4795%2049.1298%2048.052%2050.8253%2046.548ZM42.4809%2050.0166C39.0937%2049.0251%2035.7715%2047.7948%2032.5445%2046.3666C31.6496%2043.0143%2031.0116%2039.6007%2030.6416%2036.165C33.1475%2033.7986%2035.8375%2031.6209%2038.6866%2029.6567C42.0822%2030.636%2045.4089%2031.8643%2048.6246%2033.3303C49.4962%2036.669%2050.1242%2040.0644%2050.5324%2043.4777C48.0113%2045.8367%2045.3104%2048.0168%2042.4809%2050.0166ZM60.7309%2023.4479C63.4277%2026.6047%2059.4203%2032.7969%2057.593%2035.4583C55.518%2034.1164%2053.2008%2032.8322%2050.7156%2031.648C49.9815%2029.026%2049.1242%2026.5718%2048.1674%2024.3682C51.2411%2023.0767%2058.0602%2020.3219%2060.7309%2023.4479Z'%20fill='%2353C1DE'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='clip0_1479_21414'%3e%3crect%20width='62'%20height='62'%20fill='white'%20transform='translate(22.2383)%20rotate(20.2782)'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e",F2e="data:image/svg+xml,%3csvg%20width='51'%20height='50'%20viewBox='0%200%2051%2050'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M34.4442%2033.6812C36.1741%2033.5051%2037.4864%2032.039%2037.4267%2030.2795C37.3672%2028.5202%2035.8758%2027.1127%2034.0863%2027.1127H33.967C32.1177%2027.1713%2030.6863%2028.6962%2030.7459%2030.5142C30.8056%2031.3938%2031.1634%2032.1562%2031.7003%2032.684C29.6722%2036.6134%2026.5703%2039.487%2021.9177%2041.8915C18.7561%2043.5335%2015.4755%2044.1201%2012.1948%2043.7096C9.51044%2043.3577%207.42267%2042.1849%206.11017%2040.2493C4.20147%2037.3757%204.02258%2034.2674%205.63317%2031.1593C6.76659%2028.9307%208.5559%2027.2885%209.68933%2026.4674C9.45075%2025.7051%209.09276%2024.4149%208.91387%2023.4767C0.264523%2029.6345%201.15936%2037.9623%203.784%2041.8915C5.75237%2044.8238%209.74901%2046.642%2014.1631%2046.642C15.3561%2046.642%2016.5491%2046.5245%2017.7422%2046.2315C25.3775%2044.7652%2031.1636%2040.3081%2034.4442%2033.6812ZM44.9428%2026.409C40.4094%2021.1895%2033.7284%2018.3159%2026.0931%2018.3159H25.1389C24.602%2017.2602%2023.4686%2016.5563%2022.2159%2016.5563H22.0966C20.2475%2016.6151%2018.8161%2018.1398%2018.8756%2019.9579C18.9353%2021.7173%2020.4264%2023.1248%2022.2159%2023.1248H22.3352C23.6475%2023.0662%2024.7809%2022.2451%2025.2581%2021.1307H26.3317C30.8653%2021.1307%2035.16%2022.4209%2039.0375%2024.9427C42.0198%2026.8781%2044.1673%2029.3999%2045.3603%2032.4495C46.3744%2034.9126%2046.3147%2037.3171%2045.2409%2039.3698C43.5708%2042.4779%2040.7673%2044.1787%2037.0689%2044.1787C34.6828%2044.1787%2032.4163%2043.4749%2031.2231%2042.9471C30.567%2043.5335%2029.3739%2044.4718%2028.5387%2045.0585C31.1039%2046.2313%2033.7284%2046.8765%2036.2337%2046.8765C41.9602%2046.8765%2046.1955%2043.7681%2047.8061%2040.6599C49.5358%2037.2584%2049.4164%2031.3938%2044.9428%2026.409ZM14.6403%2034.6779C14.7%2036.4373%2016.1912%2037.8446%2017.9808%2037.8446H18.1002C19.9492%2037.7862%2021.3808%2036.2613%2021.3211%2034.4434C21.2616%2032.6838%2019.7702%2031.2765%2017.9808%2031.2765H17.8616C17.7422%2031.2765%2017.5631%2031.2765%2017.4441%2031.3349C14.9983%2027.3471%2013.9842%2023.0074%2014.3422%2018.3157C14.5806%2014.7969%2015.7737%2011.7472%2017.8616%209.2254C19.5912%207.05548%2022.9317%205.99987%2025.1986%205.94137C31.5214%205.824%2034.2055%2013.5652%2034.3845%2016.6735C35.16%2016.8495%2036.4723%2017.2601%2037.3672%2017.5534C36.6512%208.05278%2030.6862%203.12646%2024.96%203.12646C19.5912%203.12646%2014.6403%206.93848%2012.6717%2012.5685C9.92792%2020.0751%2011.7174%2027.2885%2015.0578%2032.9773C14.7597%2033.3877%2014.5806%2034.0327%2014.6403%2034.6779Z'%20fill='%23764ABC'/%3e%3c/svg%3e",N2e="data:image/svg+xml,%3csvg%20width='51'%20height='50'%20viewBox='0%200%2051%2050'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20clip-path='url(%23clip0_1479_21452)'%3e%3cpath%20d='M42.5918%200H7.5918C3.44966%200%200.0917969%203.35786%200.0917969%207.5V42.5C0.0917969%2046.6421%203.44966%2050%207.5918%2050H42.5918C46.7339%2050%2050.0918%2046.6421%2050.0918%2042.5V7.5C50.0918%203.35786%2046.7339%200%2042.5918%200Z'%20fill='%23CC6699'/%3e%3cpath%20d='M25.2871%208.59369C15.9121%2011.8163%209.85742%2018.3593%2010.4434%2022.2656C11.0293%2026.1718%2016.8887%2029.2968%2019.5254%2031.3476C16.1074%2033.1054%2011.8105%2035.7421%2011.9082%2039.1601C12.1035%2043.8476%2017.1816%2042.3827%2019.3301%2041.0156C21.4785%2039.6484%2023.627%2035.8398%2022.2598%2031.8359C25.2871%2031.0546%2027.9238%2032.0312%2028.7051%2032.6171C31.7324%2034.7656%2030.1699%2037.207%2029.0957%2037.5976C28.0215%2037.9882%2028.7051%2038.1835%2029.3887%2037.9882C30.0723%2037.7929%2031.5371%2036.8163%2031.5371%2035.1562C31.5371%2030.957%2027.0449%2029.0038%2021.4785%2030.4687C18.2559%2027.0507%2013.8613%2025.4882%2014.0566%2021.7773C14.1543%2020.4101%2014.6426%2016.8945%2023.334%2012.4999C32.0254%208.1054%2038.1777%209.86322%2037.3965%2013.8671C36.2246%2019.9218%2025.6777%2024.0234%2021.9668%2020.5077C21.7715%2020.1171%2021.0879%2019.8242%2021.4785%2020.8984C23.4316%2025.7812%2039.252%2023.5351%2039.9355%2013.1835C40.1309%207.71478%2032.2207%206.24994%2025.2871%208.59369ZM16.8887%2039.8437C14.4473%2040.6249%2014.5449%2039.0624%2014.6426%2038.4765C14.9355%2036.8163%2016.3027%2034.7656%2020.4043%2032.7148C21.5762%2036.4257%2018.9395%2039.2577%2016.8887%2039.8437Z'%20fill='white'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='clip0_1479_21452'%3e%3crect%20width='50'%20height='50'%20fill='white'%20transform='translate(0.0917969)'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e",z2e="data:image/svg+xml,%3csvg%20width='49'%20height='30'%20viewBox='0%200%2049%2030'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M12.25%2010C13.8833%203.33333%2017.9667%200%2024.5%200C34.3%200%2035.525%207.5%2040.425%208.75C43.6917%209.58333%2046.55%208.33333%2049%205C47.3667%2011.6667%2043.2833%2015%2036.75%2015C26.95%2015%2025.725%207.5%2020.825%206.25C17.5583%205.41667%2014.7%206.66667%2012.25%2010ZM0%2025C1.63333%2018.3333%205.71667%2015%2012.25%2015C22.05%2015%2023.275%2022.5%2028.175%2023.75C31.4417%2024.5833%2034.3%2023.3333%2036.75%2020C35.1167%2026.6667%2031.0333%2030%2024.5%2030C14.7%2030%2013.475%2022.5%208.575%2021.25C5.30833%2020.4167%202.45%2021.6667%200%2025Z'%20fill='%2344A8B3'/%3e%3c/svg%3e",U2e="data:image/svg+xml,%3csvg%20width='51'%20height='50'%20viewBox='0%200%2051%2050'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20clip-path='url(%23clip0_1479_21433)'%3e%3cpath%20d='M43.3789%200H8.37891C4.23677%200%200.878906%203.35786%200.878906%207.5V42.5C0.878906%2046.6421%204.23677%2050%208.37891%2050H43.3789C47.521%2050%2050.8789%2046.6421%2050.8789%2042.5V7.5C50.8789%203.35786%2047.521%200%2043.3789%200Z'%20fill='%233178C6'/%3e%3cpath%20d='M23.6328%2027.7344H29.8828V23.7305H12.4023V27.7344H18.6523V45.6055H23.6328V27.7344ZM31.8359%2044.6289C32.627%2045.0391%2033.5938%2045.3418%2034.668%2045.5469C35.7422%2045.752%2036.9141%2045.8496%2038.0859%2045.8496C39.2578%2045.8496%2040.332%2045.7422%2041.4062%2045.5176C42.4805%2045.293%2043.3594%2044.9219%2044.1406%2044.4434C44.9316%2043.9258%2045.6055%2043.2715%2045.9961%2042.3926C46.3867%2041.5137%2046.6895%2040.5371%2046.6895%2039.2676C46.6895%2038.3789%2046.5527%2037.6074%2046.2891%2036.9238C46.0254%2036.2402%2045.6445%2035.6543%2045.1172%2035.166C44.6191%2034.6484%2044.043%2034.1895%2043.3594%2033.7988C42.6758%2033.4082%2041.8945%2032.998%2041.0156%2032.627C40.3711%2032.3633%2039.8438%2032.1094%2039.2578%2031.8555C38.75%2031.6016%2038.3105%2031.3477%2037.9883%2031.0937C37.627%2030.8301%2037.3535%2030.5566%2037.1582%2030.2734C36.9629%2029.9805%2036.8652%2029.6582%2036.8652%2029.2969C36.8652%2028.9648%2036.9522%2028.6621%2037.1289%2028.3887C37.3057%2028.1152%2037.5488%2027.8906%2037.8613%2027.6953C38.1738%2027.5%2038.5645%2027.3535%2039.0332%2027.2461C39.4922%2027.1387%2040%2027.0898%2040.5957%2027.0898C41.0059%2027.0898%2041.4355%2027.1201%2041.8652%2027.1816C42.3145%2027.2432%2042.7734%2027.3379%2043.2324%2027.4648C43.6914%2027.5918%2044.1406%2027.748%2044.5996%2027.9434C45.0293%2028.1387%2045.4297%2028.3633%2045.7715%2028.6172V24.0273C45.0293%2023.7441%2044.209%2023.5293%2043.3301%2023.3926C42.4512%2023.2559%2041.4746%2023.1875%2040.3027%2023.1875C39.1309%2023.1875%2038.0566%2023.3145%2036.9824%2023.5586C35.9082%2023.8027%2035.0293%2024.1934%2034.248%2024.7305C33.457%2025.2578%2032.8809%2025.9023%2032.3926%2026.7812C31.9336%2027.6016%2031.709%2028.5391%2031.709%2029.7109C31.709%2031.1758%2032.1289%2032.4453%2032.9785%2033.4219C33.8184%2034.4961%2035.127%2035.2773%2036.7871%2036.0586C37.4609%2036.332%2038.0566%2036.6055%2038.6426%2036.8691C39.2285%2037.1328%2039.7168%2037.4062%2040.1074%2037.6895C40.5273%2037.9727%2040.8594%2038.2852%2041.084%2038.6172C41.3281%2038.9492%2041.4551%2039.3398%2041.4551%2039.7891C41.4551%2040.1016%2041.3789%2040.3945%2041.2305%2040.668C41.082%2040.9414%2040.8496%2041.1758%2040.5371%2041.3711C40.2246%2041.5664%2039.8438%2041.7227%2039.3652%2041.8398C38.9062%2041.9473%2038.3887%2042.0059%2037.7051%2042.0059C36.6309%2042.0059%2035.5566%2041.8203%2034.5801%2041.4492C33.5059%2041.0781%2032.5293%2040.5215%2031.8359%2039.9414V44.6289Z'%20fill='white'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='clip0_1479_21433'%3e%3crect%20width='50'%20height='50'%20fill='white'%20transform='translate(0.878906)'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e",kne="data:image/svg+xml,%3csvg%20width='30'%20height='26'%20viewBox='0%200%2030%2026'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M9.43398%200.519531C7.04842%200.519531%204.97388%202.15491%204.41692%204.47454L3.82415%206.94336C3.61485%207.81502%202.8353%208.42956%201.93886%208.42956H1.1432C0.511828%208.42956%200%208.94138%200%209.57276V10.1213C0%2010.4497%200.26624%2010.716%200.594663%2010.716C0.923086%2010.716%201.18933%2010.9822%201.18933%2011.3106V23.7748C1.18933%2024.7176%201.95362%2025.4819%202.89644%2025.4819H3.39499C4.06246%2025.4819%204.60355%2024.9408%204.60355%2024.2734C4.60355%2023.6059%205.14464%2023.0648%205.81211%2023.0648H24.1879C24.8554%2023.0648%2025.3965%2023.6059%2025.3965%2024.2734C25.3965%2024.9408%2025.9375%2025.4819%2026.605%2025.4819H27.1026C28.045%2025.4819%2028.8089%2024.718%2028.8089%2023.7757V11.3115C28.8089%2010.9826%2029.0755%2010.716%2029.4044%2010.716C29.7334%2010.716%2030%2010.4493%2030%2010.1204V9.57276C30%208.94138%2029.4882%208.42956%2028.8568%208.42956H28.0611C27.1647%208.42956%2026.3851%207.81502%2026.1758%206.94336L25.5831%204.47455C25.0261%202.15491%2022.9516%200.519531%2020.566%200.519531H9.43398ZM6.3784%202.05753H21.1095C22.5826%202.05753%2023.8637%203.06746%2024.2075%204.49991C24.6885%206.50344%2023.1699%208.42971%2021.1095%208.42971H8.88978C6.82933%208.42971%205.31075%206.50345%205.7917%204.49992L6.37791%202.05792C6.37796%202.05769%206.37817%202.05753%206.3784%202.05753ZM2.1772%2014.1881C2.1772%2013.4422%202.92028%2012.9244%203.61999%2013.1828L6.23786%2014.1496C6.65872%2014.305%206.9382%2014.7062%206.9382%2015.1548C6.9382%2015.9007%206.19512%2016.4184%205.49542%2016.16L2.87754%2015.1933C2.45668%2015.0378%202.1772%2014.6367%202.1772%2014.1881ZM26.3776%2013.1825C27.0774%2012.9243%2027.8204%2013.4421%2027.8204%2014.188C27.8204%2014.6367%2027.541%2015.0379%2027.1201%2015.1934L24.5052%2016.1594C23.8051%2016.4181%2023.0614%2015.9001%2023.0614%2015.1537C23.0614%2014.7047%2023.3412%2014.3032%2023.7624%2014.1477L26.3776%2013.1825ZM10.3958%2019.7689C10.3958%2019.1381%2010.9073%2018.6266%2011.5381%2018.6266H18.4584C19.0892%2018.6266%2019.6007%2019.1381%2019.6007%2019.7689C19.6007%2020.3998%2019.0892%2020.9112%2018.4584%2020.9112H11.5381C10.9072%2020.9112%2010.3958%2020.3998%2010.3958%2019.7689Z'%20fill='url(%23paint0_linear_1478_17766)'/%3e%3cdefs%3e%3clinearGradient%20id='paint0_linear_1478_17766'%20x1='10.6108'%20y1='3.85718'%20x2='14.2717'%20y2='25.6045'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0.0001'%20stop-color='%23fff'/%3e%3cstop%20offset='1'%20stop-color='%23fff'/%3e%3c/linearGradient%3e%3c/defs%3e%3c/svg%3e",V2e="data:image/svg+xml,%3csvg%20width='30'%20height='27'%20viewBox='0%200%2030%2027'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M23.1209%2012.7698C23.2693%2013.028%2023.3474%2013.3207%2023.3474%2013.6186C23.3474%2013.9165%2023.2693%2014.2092%2023.1209%2014.4675L19.7823%2020.2271C19.6331%2020.4842%2019.4191%2020.6977%2019.1615%2020.8461C18.904%2020.9946%2018.612%2021.0728%2018.3147%2021.073L11.6733%2021.073C11.3781%2021.0707%2011.0886%2020.9915%2010.8333%2020.8432C10.578%2020.6948%2010.3659%2020.4825%2010.2177%2020.2271L6.87911%2014.4675C6.73069%2014.2092%206.65258%2013.9165%206.65258%2013.6186C6.65258%2013.3207%206.73069%2013.028%206.87911%2012.7698L8.72327%209.58956L12.8271%2016.6075C12.8946%2016.7277%2012.9933%2016.8274%2013.1126%2016.8963C13.232%2016.9652%2013.3677%2017.0007%2013.5055%2016.9991L16.4945%2016.9991C16.6323%2017.0007%2016.768%2016.9652%2016.8874%2016.8963C17.0067%2016.8274%2017.1054%2016.7277%2017.1729%2016.6075L18.6674%2013.9982C18.7351%2013.881%2018.7707%2013.748%2018.7707%2013.6126C18.7707%2013.4773%2018.7351%2013.3443%2018.6674%2013.2271L11.9304%201.5703C11.6966%201.16601%2011.3606%200.830295%2010.9562%200.596843C10.5517%200.363393%2010.0929%200.240408%209.62593%200.24023L9.02217%200.24023C8.48786%200.240028%207.96292%200.380525%207.50015%200.647588C7.03738%200.914653%206.65309%201.29887%206.38594%201.76159L0.408109%2012.1003C0.140762%2012.5627%20-6.08137e-07%2013.0874%20-5.84788e-07%2013.6216C-5.61439e-07%2014.1558%200.140762%2014.6805%200.408109%2015.143L6.38594%2025.4816C6.65347%2025.9438%207.03793%2026.3274%207.50067%2026.5939C7.96342%2026.8605%208.48816%2027.0005%209.02217%2027L20.9778%2027C21.5121%2027.0002%2022.0371%2026.8597%2022.4998%2026.5926C22.9626%2026.3256%2023.3469%2025.9414%2023.6141%2025.4786L29.5919%2015.14C29.8592%2014.6775%2030%2014.1528%2030%2013.6186C30%2013.0845%2029.8592%2012.5597%2029.5919%2012.0973L23.6141%201.7586C23.3469%201.29588%2022.9626%200.911664%2022.4998%200.644599C22.0371%200.377534%2021.5121%200.237039%2020.9778%200.237243L15.8967%200.237243L23.1209%2012.7698Z'%20fill='%23fff'/%3e%3c/svg%3e",G2e="data:image/svg+xml,%3csvg%20width='26'%20height='26'%20viewBox='0%200%2026%2026'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20opacity='0.4'%20d='M20.4578%206.19733L18.1703%203.90983C16.2391%201.97858%2015.2741%201.01233%2014.0203%200.653583C12.7666%200.293583%2011.4353%200.601083%208.77406%201.21608L7.23906%201.56983C4.99906%202.08608%203.87906%202.34483%203.11156%203.11108C2.34531%203.87858%202.08656%204.99858%201.57031%207.23858L1.21531%208.77358C0.601557%2011.4361%200.294057%2012.7661%200.652807%2014.0198C1.01281%2015.2736%201.97906%2016.2386%203.91031%2018.1698L6.19781%2020.4573C9.56031%2023.8211%2011.2403%2025.4998%2013.3278%2025.4998C15.4166%2025.4998%2017.0966%2023.8186%2020.4578%2020.4573C23.8216%2017.0961%2025.5003%2015.4161%2025.5003%2013.3273C25.5003%2011.2398%2023.8191%209.55858%2020.4578%206.19733Z'%20fill='%23fff'/%3e%3cpath%20d='M11.9333%2015.9103C11.0921%2015.0703%2011.0996%2013.8628%2011.6021%2012.9066C11.4774%2012.7264%2011.4197%2012.5083%2011.4391%2012.2901C11.4584%2012.0719%2011.5536%2011.8673%2011.7081%2011.7119C11.8625%2011.5566%2012.0666%2011.4602%2012.2847%2011.4396C12.5028%2011.419%2012.7212%2011.4754%2012.9021%2011.5991C13.3271%2011.3741%2013.7933%2011.2541%2014.2583%2011.2591C14.507%2011.2614%2014.7445%2011.3624%2014.9187%2011.5399C15.0929%2011.7173%2015.1894%2011.9567%2015.1871%2012.2053C15.1848%2012.454%2015.0838%2012.6915%2014.9063%2012.8657C14.7289%2013.0399%2014.4895%2013.1364%2014.2408%2013.1341C13.9514%2013.1448%2013.6779%2013.2692%2013.4796%2013.4803C12.9958%2013.9641%2013.1233%2014.4491%2013.2583%2014.5853C13.3958%2014.7216%2013.8796%2014.8478%2014.3633%2014.3641C15.3433%2013.3841%2017.0358%2013.0591%2018.1208%2014.1428C18.9621%2014.9841%2018.9546%2016.1916%2018.4508%2017.1478C18.5748%2017.328%2018.6318%2017.5458%2018.6121%2017.7636C18.5924%2017.9814%2018.4972%2018.1854%2018.3429%2018.3404C18.1887%2018.4954%2017.9851%2018.5916%2017.7674%2018.6124C17.5497%2018.6331%2017.3316%2018.5771%2017.1508%2018.4541C16.5899%2018.7617%2015.9392%2018.8643%2015.3108%2018.7441C15.1902%2018.7193%2015.0756%2018.671%2014.9736%2018.6019C14.8716%2018.5328%2014.7843%2018.4444%2014.7165%2018.3415C14.6487%2018.2387%2014.6018%2018.1235%2014.5785%2018.0025C14.5553%2017.8816%2014.5561%2017.7572%2014.5808%2017.6366C14.6056%2017.5159%2014.6539%2017.4013%2014.723%2017.2994C14.7921%2017.1974%2014.8806%2017.11%2014.9834%2017.0422C15.0862%2016.9744%2015.2014%2016.9276%2015.3224%2016.9043C15.4433%2016.881%2015.5677%2016.8818%2015.6883%2016.9066C15.9096%2016.9528%2016.2671%2016.8803%2016.5733%2016.5741C17.0583%2016.0891%2016.9308%2015.6053%2016.7946%2015.4691C16.6583%2015.3328%2016.1746%2015.2066%2015.6896%2015.6903C14.7096%2016.6703%2013.0171%2016.9953%2011.9333%2015.9103ZM10.5258%2010.8666C10.7646%2010.636%2010.9551%2010.3601%2011.0861%2010.0551C11.2171%209.75008%2011.2861%209.42203%2011.289%209.09008C11.2919%208.75813%2011.2286%208.42894%2011.1029%208.12169C10.9772%207.81445%2010.7916%207.53532%2010.5568%207.30059C10.3221%207.06586%2010.043%206.88023%209.73573%206.75453C9.42849%206.62882%209.09929%206.56557%208.76734%206.56845C8.43539%206.57134%208.10734%206.6403%207.80233%206.77133C7.49732%206.90235%207.22146%207.0928%206.99084%207.33158C6.53545%207.80309%206.28346%208.43459%206.28916%209.09008C6.29485%209.74558%206.55778%2010.3726%207.0213%2010.8361C7.48482%2011.2996%208.11185%2011.5626%208.76734%2011.5683C9.42283%2011.574%2010.0543%2011.322%2010.5258%2010.8666Z'%20fill='%23fff'/%3e%3c/svg%3e",H2e="data:image/svg+xml,%3csvg%20width='30'%20height='30'%20viewBox='0%200%2030%2030'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M27.8333%2015C27.8333%2022.0877%2022.0877%2027.8333%2015%2027.8333C7.91234%2027.8333%202.16666%2022.0877%202.16666%2015C2.16666%207.91234%207.91234%202.16666%2015%202.16666C22.0877%202.16666%2027.8333%207.91234%2027.8333%2015ZM30%2015C30%2023.2843%2023.2843%2030%2015%2030C6.71573%2030%200%2023.2843%200%2015C0%206.71573%206.71573%200%2015%200C23.2843%200%2030%206.71573%2030%2015ZM23.2763%208.27633C23.2763%209.13333%2022.5816%209.82806%2021.7246%209.82806C20.8676%209.82806%2020.1729%209.13333%2020.1729%208.27633C20.1729%207.41934%2020.8676%206.72461%2021.7246%206.72461C22.5816%206.72461%2023.2763%207.41934%2023.2763%208.27633ZM10.4879%2016.2086C11.1556%2018.7005%2013.717%2020.1793%2016.2089%2019.5116C18.7008%2018.8439%2020.1796%2016.2825%2019.5119%2013.7906C18.8442%2011.2987%2016.2828%209.81989%2013.7909%2010.4876C11.299%2011.1553%209.82015%2013.7167%2010.4879%2016.2086ZM8.39503%2016.7694C9.37244%2020.4171%2013.1219%2022.5819%2016.7696%2021.6045C20.4174%2020.627%2022.5821%2016.8776%2021.6047%2013.2298C20.6273%209.58209%2016.8779%207.41735%2013.2301%208.39476C9.58236%209.37218%207.41762%2013.1216%208.39503%2016.7694Z'%20fill='url(%23paint0_linear_1478_19845)'/%3e%3cdefs%3e%3clinearGradient%20id='paint0_linear_1478_19845'%20x1='15'%20y1='0'%20x2='15'%20y2='30'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%23fff'/%3e%3cstop%20offset='0.461458'%20stop-color='%23fff'/%3e%3cstop%20offset='1'%20stop-color='%23fff'/%3e%3c/linearGradient%3e%3c/defs%3e%3c/svg%3e",j2e=""+new URL("summiz-B_i5HBJv.svg",import.meta.url).href,W2e="data:image/svg+xml,%3csvg%20width='30'%20height='30'%20viewBox='0%200%2030%2030'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M27.8333%2015C27.8333%2022.0877%2022.0877%2027.8333%2015%2027.8333C7.91234%2027.8333%202.16666%2022.0877%202.16666%2015C2.16666%207.91234%207.91234%202.16666%2015%202.16666C22.0877%202.16666%2027.8333%207.91234%2027.8333%2015ZM30%2015C30%2023.2843%2023.2843%2030%2015%2030C6.71573%2030%200%2023.2843%200%2015C0%206.71573%206.71573%200%2015%200C23.2843%200%2030%206.71573%2030%2015ZM23.2763%208.27633C23.2763%209.13333%2022.5816%209.82806%2021.7246%209.82806C20.8676%209.82806%2020.1729%209.13333%2020.1729%208.27633C20.1729%207.41934%2020.8676%206.72461%2021.7246%206.72461C22.5816%206.72461%2023.2763%207.41934%2023.2763%208.27633ZM15.164%2012.8405L15.354%2010.3432L15.5183%208.18279C14.78%208.12663%2014.0416%208.19103%2013.3312%208.36978C12.7441%208.5175%2012.1761%208.74331%2011.643%209.0437C10.4647%209.7076%209.50982%2010.706%208.899%2011.9126C8.28818%2013.1192%208.04887%2014.4798%208.21134%2015.8224C8.37381%2017.165%208.93076%2018.4293%209.81176%2019.4553C10.6928%2020.4814%2011.8582%2021.2232%2013.1608%2021.5869C14.4634%2021.9506%2015.8446%2021.9198%2017.1297%2021.4986C18.4148%2021.0773%2019.5461%2020.2844%2020.3806%2019.2201C20.7582%2018.7386%2021.0673%2018.2113%2021.3021%2017.6533C21.5862%2016.9784%2021.7615%2016.2585%2021.8177%2015.5205L21.8178%2015.5196L19.6574%2015.3553L17.1601%2015.1653L14.9997%2015.0009L15.164%2012.8405ZM18.9617%2017.4752L14.8353%2017.1614L12.6749%2016.997L12.8392%2014.8366L13.1531%2010.7102C13.0009%2010.7757%2012.8519%2010.8495%2012.7066%2010.9313C11.9017%2011.3849%2011.2494%2012.0669%2010.8321%2012.8912C10.4148%2013.7154%2010.2513%2014.6449%2010.3623%2015.5621C10.4733%2016.4793%2010.8538%2017.343%2011.4556%2018.0439C12.0575%2018.7449%2012.8536%2019.2516%2013.7435%2019.5C14.6333%2019.7485%2015.5768%2019.7275%2016.4547%2019.4397C17.3327%2019.1519%2018.1055%2018.6103%2018.6756%2017.8832C18.7785%2017.752%2018.8739%2017.6158%2018.9617%2017.4752Z'%20fill='url(%23paint0_linear_1478_16881)'/%3e%3cdefs%3e%3clinearGradient%20id='paint0_linear_1478_16881'%20x1='15'%20y1='0'%20x2='15'%20y2='30'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%23FFF'/%3e%3cstop%20offset='0.461458'%20stop-color='%23FFF'/%3e%3cstop%20offset='1'%20stop-color='%23FFF'/%3e%3c/linearGradient%3e%3c/defs%3e%3c/svg%3e",One="data:image/svg+xml,%3csvg%20width='14'%20height='15'%20viewBox='0%200%2014%2015'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M1.16602%207.49984H12.8327M12.8327%207.49984L6.99935%201.6665M12.8327%207.49984L6.99935%2013.3332'%20stroke='%23406AFF'%20stroke-width='1.66667'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",X2e=""+new URL("soundon-4GJHmOjh.png",import.meta.url).href,$2e=""+new URL("soundoff-B_dVLsfG.png",import.meta.url).href,q2e=""+new URL("shopify-B9vYDfbe.png",import.meta.url).href,Z2e=""+new URL("starbucks-Bj8Yf058.png",import.meta.url).href,zW=""+new URL("tesla-DB40m56Q.png",import.meta.url).href,UW={type:"change"},H5={type:"start"},VW={type:"end"},fE=new hx,GW=new xm,Y2e=Math.cos(70*to.DEG2RAD);class Ev extends pp{constructor(e,t){super(),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new Ze,this.cursor=new Ze,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:ny.ROTATE,MIDDLE:ny.DOLLY,RIGHT:ny.PAN},this.touches={ONE:ry.ROTATE,TWO:ry.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return l.phi},this.getAzimuthalAngle=function(){return l.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(Fe){Fe.addEventListener("keydown",tr),this._domElementKeyEvents=Fe},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",tr),this._domElementKeyEvents=null},this.saveState=function(){r.target0.copy(r.target),r.position0.copy(r.object.position),r.zoom0=r.object.zoom},this.reset=function(){r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),r.dispatchEvent(UW),r.update(),s=i.NONE},this.update=function(){const Fe=new Ze,Lt=new Aa().setFromUnitVectors(e.up,new Ze(0,1,0)),Kt=Lt.clone().invert(),un=new Ze,En=new Aa,Ar=new Ze,Gr=2*Math.PI;return function(Rs=null){const ui=r.object.position;Fe.copy(ui).sub(r.target),Fe.applyQuaternion(Lt),l.setFromVector3(Fe),r.autoRotate&&s===i.NONE&&Se(ae(Rs)),r.enableDamping?(l.theta+=o.theta*r.dampingFactor,l.phi+=o.phi*r.dampingFactor):(l.theta+=o.theta,l.phi+=o.phi);let Tt=r.minAzimuthAngle,xe=r.maxAzimuthAngle;isFinite(Tt)&&isFinite(xe)&&(Tt<-Math.PI?Tt+=Gr:Tt>Math.PI&&(Tt-=Gr),xe<-Math.PI?xe+=Gr:xe>Math.PI&&(xe-=Gr),Tt<=xe?l.theta=Math.max(Tt,Math.min(xe,l.theta)):l.theta=l.theta>(Tt+xe)/2?Math.max(Tt,l.theta):Math.min(xe,l.theta)),l.phi=Math.max(r.minPolarAngle,Math.min(r.maxPolarAngle,l.phi)),l.makeSafe(),r.enableDamping===!0?r.target.addScaledVector(d,r.dampingFactor):r.target.add(d),r.target.sub(r.cursor),r.target.clampLength(r.minTargetRadius,r.maxTargetRadius),r.target.add(r.cursor);let Ce=!1;if(r.zoomToCursor&&Z||r.object.isOrthographicCamera)l.radius=He(l.radius);else{const We=l.radius;l.radius=He(l.radius*h),Ce=We!=l.radius}if(Fe.setFromSpherical(l),Fe.applyQuaternion(Kt),ui.copy(r.target).add(Fe),r.object.lookAt(r.target),r.enableDamping===!0?(o.theta*=1-r.dampingFactor,o.phi*=1-r.dampingFactor,d.multiplyScalar(1-r.dampingFactor)):(o.set(0,0,0),d.set(0,0,0)),r.zoomToCursor&&Z){let We=null;if(r.object.isPerspectiveCamera){const nt=Fe.length();We=He(nt*h);const Je=nt-We;r.object.position.addScaledVector(j,Je),r.object.updateMatrixWorld(),Ce=!!Je}else if(r.object.isOrthographicCamera){const nt=new Ze(q.x,q.y,0);nt.unproject(r.object);const Je=r.object.zoom;r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/h)),r.object.updateProjectionMatrix(),Ce=Je!==r.object.zoom;const pt=new Ze(q.x,q.y,0);pt.unproject(r.object),r.object.position.sub(pt).add(nt),r.object.updateMatrixWorld(),We=Fe.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),r.zoomToCursor=!1;We!==null&&(this.screenSpacePanning?r.target.set(0,0,-1).transformDirection(r.object.matrix).multiplyScalar(We).add(r.object.position):(fE.origin.copy(r.object.position),fE.direction.set(0,0,-1).transformDirection(r.object.matrix),Math.abs(r.object.up.dot(fE.direction))<Y2e?e.lookAt(r.target):(GW.setFromNormalAndCoplanarPoint(r.object.up,r.target),fE.intersectPlane(GW,r.target))))}else if(r.object.isOrthographicCamera){const We=r.object.zoom;r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/h)),We!==r.object.zoom&&(r.object.updateProjectionMatrix(),Ce=!0)}return h=1,Z=!1,Ce||un.distanceToSquared(r.object.position)>a||8*(1-En.dot(r.object.quaternion))>a||Ar.distanceToSquared(r.target)>a?(r.dispatchEvent(UW),un.copy(r.object.position),En.copy(r.object.quaternion),Ar.copy(r.target),!0):!1}}(),this.dispose=function(){r.domElement.removeEventListener("contextmenu",ir),r.domElement.removeEventListener("pointerdown",sn),r.domElement.removeEventListener("pointercancel",Ue),r.domElement.removeEventListener("wheel",Sn),r.domElement.removeEventListener("pointermove",ot),r.domElement.removeEventListener("pointerup",Ue),r.domElement.getRootNode().removeEventListener("keydown",mr,{capture:!0}),r._domElementKeyEvents!==null&&(r._domElementKeyEvents.removeEventListener("keydown",tr),r._domElementKeyEvents=null)};const r=this,i={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let s=i.NONE;const a=1e-6,l=new XA,o=new XA;let h=1;const d=new Ze,m=new nn,_=new nn,y=new nn,T=new nn,I=new nn,C=new nn,M=new nn,B=new nn,k=new nn,j=new Ze,q=new nn;let Z=!1;const te=[],ie={};let se=!1;function ae(Fe){return Fe!==null?2*Math.PI/60*r.autoRotateSpeed*Fe:2*Math.PI/60/60*r.autoRotateSpeed}function fe(Fe){const Lt=Math.abs(Fe*.01);return Math.pow(.95,r.zoomSpeed*Lt)}function Se(Fe){o.theta-=Fe}function Ee(Fe){o.phi-=Fe}const Re=function(){const Fe=new Ze;return function(Kt,un){Fe.setFromMatrixColumn(un,0),Fe.multiplyScalar(-Kt),d.add(Fe)}}(),qe=function(){const Fe=new Ze;return function(Kt,un){r.screenSpacePanning===!0?Fe.setFromMatrixColumn(un,1):(Fe.setFromMatrixColumn(un,0),Fe.crossVectors(r.object.up,Fe)),Fe.multiplyScalar(Kt),d.add(Fe)}}(),Le=function(){const Fe=new Ze;return function(Kt,un){const En=r.domElement;if(r.object.isPerspectiveCamera){const Ar=r.object.position;Fe.copy(Ar).sub(r.target);let Gr=Fe.length();Gr*=Math.tan(r.object.fov/2*Math.PI/180),Re(2*Kt*Gr/En.clientHeight,r.object.matrix),qe(2*un*Gr/En.clientHeight,r.object.matrix)}else r.object.isOrthographicCamera?(Re(Kt*(r.object.right-r.object.left)/r.object.zoom/En.clientWidth,r.object.matrix),qe(un*(r.object.top-r.object.bottom)/r.object.zoom/En.clientHeight,r.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),r.enablePan=!1)}}();function dt(Fe){r.object.isPerspectiveCamera||r.object.isOrthographicCamera?h/=Fe:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function ye(Fe){r.object.isPerspectiveCamera||r.object.isOrthographicCamera?h*=Fe:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function Xe(Fe,Lt){if(!r.zoomToCursor)return;Z=!0;const Kt=r.domElement.getBoundingClientRect(),un=Fe-Kt.left,En=Lt-Kt.top,Ar=Kt.width,Gr=Kt.height;q.x=un/Ar*2-1,q.y=-(En/Gr)*2+1,j.set(q.x,q.y,1).unproject(r.object).sub(r.object.position).normalize()}function He(Fe){return Math.max(r.minDistance,Math.min(r.maxDistance,Fe))}function _t(Fe){m.set(Fe.clientX,Fe.clientY)}function wt(Fe){Xe(Fe.clientX,Fe.clientX),M.set(Fe.clientX,Fe.clientY)}function Gt(Fe){T.set(Fe.clientX,Fe.clientY)}function at(Fe){_.set(Fe.clientX,Fe.clientY),y.subVectors(_,m).multiplyScalar(r.rotateSpeed);const Lt=r.domElement;Se(2*Math.PI*y.x/Lt.clientHeight),Ee(2*Math.PI*y.y/Lt.clientHeight),m.copy(_),r.update()}function Ht(Fe){B.set(Fe.clientX,Fe.clientY),k.subVectors(B,M),k.y>0?dt(fe(k.y)):k.y<0&&ye(fe(k.y)),M.copy(B),r.update()}function Qt(Fe){I.set(Fe.clientX,Fe.clientY),C.subVectors(I,T).multiplyScalar(r.panSpeed),Le(C.x,C.y),T.copy(I),r.update()}function rn(Fe){Xe(Fe.clientX,Fe.clientY),Fe.deltaY<0?ye(fe(Fe.deltaY)):Fe.deltaY>0&&dt(fe(Fe.deltaY)),r.update()}function jn(Fe){let Lt=!1;switch(Fe.code){case r.keys.UP:Fe.ctrlKey||Fe.metaKey||Fe.shiftKey?Ee(2*Math.PI*r.rotateSpeed/r.domElement.clientHeight):Le(0,r.keyPanSpeed),Lt=!0;break;case r.keys.BOTTOM:Fe.ctrlKey||Fe.metaKey||Fe.shiftKey?Ee(-2*Math.PI*r.rotateSpeed/r.domElement.clientHeight):Le(0,-r.keyPanSpeed),Lt=!0;break;case r.keys.LEFT:Fe.ctrlKey||Fe.metaKey||Fe.shiftKey?Se(2*Math.PI*r.rotateSpeed/r.domElement.clientHeight):Le(r.keyPanSpeed,0),Lt=!0;break;case r.keys.RIGHT:Fe.ctrlKey||Fe.metaKey||Fe.shiftKey?Se(-2*Math.PI*r.rotateSpeed/r.domElement.clientHeight):Le(-r.keyPanSpeed,0),Lt=!0;break}Lt&&(Fe.preventDefault(),r.update())}function Bn(Fe){if(te.length===1)m.set(Fe.pageX,Fe.pageY);else{const Lt=Hr(Fe),Kt=.5*(Fe.pageX+Lt.x),un=.5*(Fe.pageY+Lt.y);m.set(Kt,un)}}function Tn(Fe){if(te.length===1)T.set(Fe.pageX,Fe.pageY);else{const Lt=Hr(Fe),Kt=.5*(Fe.pageX+Lt.x),un=.5*(Fe.pageY+Lt.y);T.set(Kt,un)}}function Pe(Fe){const Lt=Hr(Fe),Kt=Fe.pageX-Lt.x,un=Fe.pageY-Lt.y,En=Math.sqrt(Kt*Kt+un*un);M.set(0,En)}function $e(Fe){r.enableZoom&&Pe(Fe),r.enablePan&&Tn(Fe)}function mn(Fe){r.enableZoom&&Pe(Fe),r.enableRotate&&Bn(Fe)}function cn(Fe){if(te.length==1)_.set(Fe.pageX,Fe.pageY);else{const Kt=Hr(Fe),un=.5*(Fe.pageX+Kt.x),En=.5*(Fe.pageY+Kt.y);_.set(un,En)}y.subVectors(_,m).multiplyScalar(r.rotateSpeed);const Lt=r.domElement;Se(2*Math.PI*y.x/Lt.clientHeight),Ee(2*Math.PI*y.y/Lt.clientHeight),m.copy(_)}function St(Fe){if(te.length===1)I.set(Fe.pageX,Fe.pageY);else{const Lt=Hr(Fe),Kt=.5*(Fe.pageX+Lt.x),un=.5*(Fe.pageY+Lt.y);I.set(Kt,un)}C.subVectors(I,T).multiplyScalar(r.panSpeed),Le(C.x,C.y),T.copy(I)}function Jt(Fe){const Lt=Hr(Fe),Kt=Fe.pageX-Lt.x,un=Fe.pageY-Lt.y,En=Math.sqrt(Kt*Kt+un*un);B.set(0,En),k.set(0,Math.pow(B.y/M.y,r.zoomSpeed)),dt(k.y),M.copy(B);const Ar=(Fe.pageX+Lt.x)*.5,Gr=(Fe.pageY+Lt.y)*.5;Xe(Ar,Gr)}function kn(Fe){r.enableZoom&&Jt(Fe),r.enablePan&&St(Fe)}function Vn(Fe){r.enableZoom&&Jt(Fe),r.enableRotate&&cn(Fe)}function sn(Fe){r.enabled!==!1&&(te.length===0&&(r.domElement.setPointerCapture(Fe.pointerId),r.domElement.addEventListener("pointermove",ot),r.domElement.addEventListener("pointerup",Ue)),!or(Fe)&&(ci(Fe),Fe.pointerType==="touch"?Sr(Fe):$t(Fe)))}function ot(Fe){r.enabled!==!1&&(Fe.pointerType==="touch"?Ln(Fe):An(Fe))}function Ue(Fe){switch(Fr(Fe),te.length){case 0:r.domElement.releasePointerCapture(Fe.pointerId),r.domElement.removeEventListener("pointermove",ot),r.domElement.removeEventListener("pointerup",Ue),r.dispatchEvent(VW),s=i.NONE;break;case 1:const Lt=te[0],Kt=ie[Lt];Sr({pointerId:Lt,pageX:Kt.x,pageY:Kt.y});break}}function $t(Fe){let Lt;switch(Fe.button){case 0:Lt=r.mouseButtons.LEFT;break;case 1:Lt=r.mouseButtons.MIDDLE;break;case 2:Lt=r.mouseButtons.RIGHT;break;default:Lt=-1}switch(Lt){case ny.DOLLY:if(r.enableZoom===!1)return;wt(Fe),s=i.DOLLY;break;case ny.ROTATE:if(Fe.ctrlKey||Fe.metaKey||Fe.shiftKey){if(r.enablePan===!1)return;Gt(Fe),s=i.PAN}else{if(r.enableRotate===!1)return;_t(Fe),s=i.ROTATE}break;case ny.PAN:if(Fe.ctrlKey||Fe.metaKey||Fe.shiftKey){if(r.enableRotate===!1)return;_t(Fe),s=i.ROTATE}else{if(r.enablePan===!1)return;Gt(Fe),s=i.PAN}break;default:s=i.NONE}s!==i.NONE&&r.dispatchEvent(H5)}function An(Fe){switch(s){case i.ROTATE:if(r.enableRotate===!1)return;at(Fe);break;case i.DOLLY:if(r.enableZoom===!1)return;Ht(Fe);break;case i.PAN:if(r.enablePan===!1)return;Qt(Fe);break}}function Sn(Fe){r.enabled===!1||r.enableZoom===!1||s!==i.NONE||(Fe.preventDefault(),r.dispatchEvent(H5),rn(jt(Fe)),r.dispatchEvent(VW))}function jt(Fe){const Lt=Fe.deltaMode,Kt={clientX:Fe.clientX,clientY:Fe.clientY,deltaY:Fe.deltaY};switch(Lt){case 1:Kt.deltaY*=16;break;case 2:Kt.deltaY*=100;break}return Fe.ctrlKey&&!se&&(Kt.deltaY*=10),Kt}function mr(Fe){Fe.key==="Control"&&(se=!0,r.domElement.getRootNode().addEventListener("keyup",Un,{passive:!0,capture:!0}))}function Un(Fe){Fe.key==="Control"&&(se=!1,r.domElement.getRootNode().removeEventListener("keyup",Un,{passive:!0,capture:!0}))}function tr(Fe){r.enabled===!1||r.enablePan===!1||jn(Fe)}function Sr(Fe){switch(Nr(Fe),te.length){case 1:switch(r.touches.ONE){case ry.ROTATE:if(r.enableRotate===!1)return;Bn(Fe),s=i.TOUCH_ROTATE;break;case ry.PAN:if(r.enablePan===!1)return;Tn(Fe),s=i.TOUCH_PAN;break;default:s=i.NONE}break;case 2:switch(r.touches.TWO){case ry.DOLLY_PAN:if(r.enableZoom===!1&&r.enablePan===!1)return;$e(Fe),s=i.TOUCH_DOLLY_PAN;break;case ry.DOLLY_ROTATE:if(r.enableZoom===!1&&r.enableRotate===!1)return;mn(Fe),s=i.TOUCH_DOLLY_ROTATE;break;default:s=i.NONE}break;default:s=i.NONE}s!==i.NONE&&r.dispatchEvent(H5)}function Ln(Fe){switch(Nr(Fe),s){case i.TOUCH_ROTATE:if(r.enableRotate===!1)return;cn(Fe),r.update();break;case i.TOUCH_PAN:if(r.enablePan===!1)return;St(Fe),r.update();break;case i.TOUCH_DOLLY_PAN:if(r.enableZoom===!1&&r.enablePan===!1)return;kn(Fe),r.update();break;case i.TOUCH_DOLLY_ROTATE:if(r.enableZoom===!1&&r.enableRotate===!1)return;Vn(Fe),r.update();break;default:s=i.NONE}}function ir(Fe){r.enabled!==!1&&Fe.preventDefault()}function ci(Fe){te.push(Fe.pointerId)}function Fr(Fe){delete ie[Fe.pointerId];for(let Lt=0;Lt<te.length;Lt++)if(te[Lt]==Fe.pointerId){te.splice(Lt,1);return}}function or(Fe){for(let Lt=0;Lt<te.length;Lt++)if(te[Lt]==Fe.pointerId)return!0;return!1}function Nr(Fe){let Lt=ie[Fe.pointerId];Lt===void 0&&(Lt=new nn,ie[Fe.pointerId]=Lt),Lt.set(Fe.pageX,Fe.pageY)}function Hr(Fe){const Lt=Fe.pointerId===te[0]?te[1]:te[0];return ie[Lt]}r.domElement.addEventListener("contextmenu",ir),r.domElement.addEventListener("pointerdown",sn),r.domElement.addEventListener("pointercancel",Ue),r.domElement.addEventListener("wheel",Sn,{passive:!1}),r.domElement.getRootNode().addEventListener("keydown",mr,{passive:!0,capture:!0}),this.update()}}const K2e=""+new URL("clouds-IEtJOhG3.jpeg",import.meta.url).href,J2e=""+new URL("earth_basic-BA2kNn0Z.jpeg",import.meta.url).href,Q2e=""+new URL("earth_normal-BhhqUxiB.jpeg",import.meta.url).href,eSe=""+new URL("earth_rough-BHPkAlB2.jpeg",import.meta.url).href,tSe=""+new URL("moon_basic-B595DPb7.jpeg",import.meta.url).href,nSe=""+new URL("moon_normal-BoJTEBW0.jpeg",import.meta.url).href,rSe=""+new URL("moon_roughness-BDXd91JJ.jpeg",import.meta.url).href;var HS=function(){var n=0,e=document.createElement("div");e.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",e.addEventListener("click",function(d){d.preventDefault(),r(++n%e.children.length)},!1);function t(d){return e.appendChild(d.dom),d}function r(d){for(var m=0;m<e.children.length;m++)e.children[m].style.display=m===d?"block":"none";n=d}var i=(performance||Date).now(),s=i,a=0,l=t(new HS.Panel("FPS","#0ff","#002")),o=t(new HS.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var h=t(new HS.Panel("MB","#f08","#201"));return r(0),{REVISION:16,dom:e,addPanel:t,showPanel:r,begin:function(){i=(performance||Date).now()},end:function(){a++;var d=(performance||Date).now();if(o.update(d-i,200),d>=s+1e3&&(l.update(a*1e3/(d-s),100),s=d,a=0,h)){var m=performance.memory;h.update(m.usedJSHeapSize/1048576,m.jsHeapSizeLimit/1048576)}return d},update:function(){i=this.end()},domElement:e,setMode:r}};HS.Panel=function(n,e,t){var r=1/0,i=0,s=Math.round,a=s(window.devicePixelRatio||1),l=80*a,o=48*a,h=3*a,d=2*a,m=3*a,_=15*a,y=74*a,T=30*a,I=document.createElement("canvas");I.width=l,I.height=o,I.style.cssText="width:80px;height:48px";var C=I.getContext("2d");return C.font="bold "+9*a+"px Helvetica,Arial,sans-serif",C.textBaseline="top",C.fillStyle=t,C.fillRect(0,0,l,o),C.fillStyle=e,C.fillText(n,h,d),C.fillRect(m,_,y,T),C.fillStyle=t,C.globalAlpha=.9,C.fillRect(m,_,y,T),{dom:I,update:function(M,B){r=Math.min(r,M),i=Math.max(i,M),C.fillStyle=t,C.globalAlpha=1,C.fillRect(0,0,l,_),C.fillStyle=e,C.fillText(s(M)+" "+n+" ("+s(r)+"-"+s(i)+")",h,d),C.drawImage(I,m+a,_,y-a,T,m,_,y-a,T),C.fillRect(m+y-a,_,a,T),C.fillStyle=t,C.globalAlpha=.9,C.fillRect(m+y-a,_,a,s((1-M/B)*T))}}};const iSe=()=>{const n=Ae.useRef(null),e=Ae.useRef(null),t=Ae.useRef(null),r=Ae.useRef(null),i=Ae.useRef(null),s=Ae.useRef(null),a=Ae.useRef(null),l=Ae.useRef(null);let o=null,h=null,d=null,m=null,_=new qf;Ae.useEffect(()=>(T(),o=new HS,o.showPanel(0),document.body.appendChild(o.dom),window.addEventListener("resize",y),()=>{document.body.removeChild(o.dom),window.removeEventListener("resize",y)}),[]);const y=()=>{r.current&&e.current&&(r.current.aspect=window.innerWidth/window.innerHeight,r.current.updateProjectionMatrix(),e.current.setSize(window.innerWidth,window.innerHeight))},T=()=>{const j=new Zl({canvas:n.current,antialias:!0});j.setPixelRatio(window.devicePixelRatio),j.setSize(window.innerWidth,window.innerHeight),j.setPixelRatio(Math.min(window.devicePixelRatio,2)),j.shadowMap.enabled=!0,j.toneMapping=AL,e.current=j;const q=new Al;t.current=q;const Z=96,te=window.innerWidth/window.innerHeight,ie=new Kf(-Z*te,Z*te,Z,-Z,1,1e3);ie.position.set(0,20,200),ie.lookAt(new Ze(0,0,0)),r.current=ie;const se=new Ev(ie,j.domElement);se.enableDamping=!0,i.current=se,I(q),C(q),M(q),k()},I=j=>{const q=new Cv(16777215,1.2);q.position.set(-10,10,5),q.castShadow=!0,q.shadow.mapSize.width=512,q.shadow.mapSize.height=512,q.shadow.camera.top=10,q.shadow.camera.bottom=-5,q.shadow.camera.left=-5,q.shadow.camera.right=10,j.add(q);const Z=new mx(16777215,.8);j.add(Z)},C=j=>{h=new Wl;const q=new Ei(new Lm(10,64,64),new cp({map:_.load(J2e),normalMap:_.load(Q2e),roughnessMap:_.load(eSe),normalScale:new nn(10,10),metalness:.1}));q.rotation.y=-Math.PI,m=new Ei(new Lm(10.6,64,64),new VT({alphaMap:_.load(K2e),transparent:!0,opacity:.4,depthTest:!0})),h.add(q),l.current=m,h.add(m),h.scale.set(6,6,6),a.current=h,j.add(h)},M=j=>{d=new Ei(new Lm(2,32,32),new cp({map:_.load(tSe),normalMap:_.load(nSe),roughnessMap:_.load(rSe),normalScale:new nn(10,10),metalness:.1})),d.position.set(-120,0,-120),d.scale.set(6,6,6),s.current=d,j.add(d)},B=new Qm,k=()=>{if(!e.current||!t.current||!r.current)return;const j=B.getElapsedTime();h&&(h.rotation.y+=.002),m&&(m.rotation.y+=.004),m&&(m.rotation.x+=.002),o&&o.update(),i.current&&i.current.update(),d&&(d.position.x=Math.sin(j*.5)*-120),d&&(d.position.z=Math.cos(j*.5)*-120),e.current.render(t.current,r.current),requestAnimationFrame(k)};return me.jsx("div",{className:"earth_page",children:me.jsx("canvas",{ref:n,className:"webgl"})})};function sSe(n){if(!(typeof window>"u")){var e=document.createElement("style");return e.setAttribute("type","text/css"),e.innerHTML=n,document.head.appendChild(e),n}}function hb(n,e){var t=n.__state.conversionName.toString(),r=Math.round(n.r),i=Math.round(n.g),s=Math.round(n.b),a=n.a,l=Math.round(n.h),o=n.s.toFixed(1),h=n.v.toFixed(1);if(e||t==="THREE_CHAR_HEX"||t==="SIX_CHAR_HEX"){for(var d=n.hex.toString(16);d.length<6;)d="0"+d;return"#"+d}else{if(t==="CSS_RGB")return"rgb("+r+","+i+","+s+")";if(t==="CSS_RGBA")return"rgba("+r+","+i+","+s+","+a+")";if(t==="HEX")return"0x"+n.hex.toString(16);if(t==="RGB_ARRAY")return"["+r+","+i+","+s+"]";if(t==="RGBA_ARRAY")return"["+r+","+i+","+s+","+a+"]";if(t==="RGB_OBJ")return"{r:"+r+",g:"+i+",b:"+s+"}";if(t==="RGBA_OBJ")return"{r:"+r+",g:"+i+",b:"+s+",a:"+a+"}";if(t==="HSV_OBJ")return"{h:"+l+",s:"+o+",v:"+h+"}";if(t==="HSVA_OBJ")return"{h:"+l+",s:"+o+",v:"+h+",a:"+a+"}"}return"unknown format"}var HW=Array.prototype.forEach,L2=Array.prototype.slice,Pn={BREAK:{},extend:function(e){return this.each(L2.call(arguments,1),function(t){var r=this.isObject(t)?Object.keys(t):[];r.forEach((function(i){this.isUndefined(t[i])||(e[i]=t[i])}).bind(this))},this),e},defaults:function(e){return this.each(L2.call(arguments,1),function(t){var r=this.isObject(t)?Object.keys(t):[];r.forEach((function(i){this.isUndefined(e[i])&&(e[i]=t[i])}).bind(this))},this),e},compose:function(){var e=L2.call(arguments);return function(){for(var t=L2.call(arguments),r=e.length-1;r>=0;r--)t=[e[r].apply(this,t)];return t[0]}},each:function(e,t,r){if(e){if(HW&&e.forEach&&e.forEach===HW)e.forEach(t,r);else if(e.length===e.length+0){var i=void 0,s=void 0;for(i=0,s=e.length;i<s;i++)if(i in e&&t.call(r,e[i],i)===this.BREAK)return}else for(var a in e)if(t.call(r,e[a],a)===this.BREAK)return}},defer:function(e){setTimeout(e,0)},debounce:function(e,t,r){var i=void 0;return function(){var s=this,a=arguments;function l(){i=null,r||e.apply(s,a)}var o=r||!i;clearTimeout(i),i=setTimeout(l,t),o&&e.apply(s,a)}},toArray:function(e){return e.toArray?e.toArray():L2.call(e)},isUndefined:function(e){return e===void 0},isNull:function(e){return e===null},isNaN:function(n){function e(t){return n.apply(this,arguments)}return e.toString=function(){return n.toString()},e}(function(n){return isNaN(n)}),isArray:Array.isArray||function(n){return n.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return e===!1||e===!0},isFunction:function(e){return e instanceof Function}},oSe=[{litmus:Pn.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return t===null?!1:{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString(),0)}},write:hb},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);return t===null?!1:{space:"HEX",hex:parseInt("0x"+t[1].toString(),0)}},write:hb},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return t===null?!1:{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:hb},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return t===null?!1:{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:hb}}},{litmus:Pn.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:Pn.isArray,conversions:{RGB_ARRAY:{read:function(e){return e.length!==3?!1:{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return e.length!==4?!1:{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:Pn.isObject,conversions:{RGBA_OBJ:{read:function(e){return Pn.isNumber(e.r)&&Pn.isNumber(e.g)&&Pn.isNumber(e.b)&&Pn.isNumber(e.a)?{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}:!1},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return Pn.isNumber(e.r)&&Pn.isNumber(e.g)&&Pn.isNumber(e.b)?{space:"RGB",r:e.r,g:e.g,b:e.b}:!1},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return Pn.isNumber(e.h)&&Pn.isNumber(e.s)&&Pn.isNumber(e.v)&&Pn.isNumber(e.a)?{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}:!1},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return Pn.isNumber(e.h)&&Pn.isNumber(e.s)&&Pn.isNumber(e.v)?{space:"HSV",h:e.h,s:e.s,v:e.v}:!1},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],D2=void 0,dE=void 0,uF=function(){dE=!1;var e=arguments.length>1?Pn.toArray(arguments):arguments[0];return Pn.each(oSe,function(t){if(t.litmus(e))return Pn.each(t.conversions,function(r,i){if(D2=r.read(e),dE===!1&&D2!==!1)return dE=D2,D2.conversionName=i,D2.conversion=r,Pn.BREAK}),Pn.BREAK}),dE},jW=void 0,iP={hsv_to_rgb:function(e,t,r){var i=Math.floor(e/60)%6,s=e/60-Math.floor(e/60),a=r*(1-t),l=r*(1-s*t),o=r*(1-(1-s)*t),h=[[r,o,a],[l,r,a],[a,r,o],[a,l,r],[o,a,r],[r,a,l]][i];return{r:h[0]*255,g:h[1]*255,b:h[2]*255}},rgb_to_hsv:function(e,t,r){var i=Math.min(e,t,r),s=Math.max(e,t,r),a=s-i,l=void 0,o=void 0;if(s!==0)o=a/s;else return{h:NaN,s:0,v:0};return e===s?l=(t-r)/a:t===s?l=2+(r-e)/a:l=4+(e-t)/a,l/=6,l<0&&(l+=1),{h:l*360,s:o,v:s/255}},rgb_to_hex:function(e,t,r){var i=this.hex_with_component(0,2,e);return i=this.hex_with_component(i,1,t),i=this.hex_with_component(i,0,r),i},component_from_hex:function(e,t){return e>>t*8&255},hex_with_component:function(e,t,r){return r<<(jW=t*8)|e&~(255<<jW)}},aSe=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},ed=function(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")},td=function(){function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),uv=function n(e,t,r){e===null&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,t);if(i===void 0){var s=Object.getPrototypeOf(e);return s===null?void 0:n(s,t,r)}else{if("value"in i)return i.value;var a=i.get;return a===void 0?void 0:a.call(r)}},Iv=function(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)},Rv=function(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:n},il=function(){function n(){if(ed(this,n),this.__state=uF.apply(this,arguments),this.__state===!1)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return td(n,[{key:"toString",value:function(){return hb(this)}},{key:"toHexString",value:function(){return hb(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),n}();function j6(n,e,t){Object.defineProperty(n,e,{get:function(){return this.__state.space==="RGB"?this.__state[e]:(il.recalculateRGB(this,e,t),this.__state[e])},set:function(i){this.__state.space!=="RGB"&&(il.recalculateRGB(this,e,t),this.__state.space="RGB"),this.__state[e]=i}})}function W6(n,e){Object.defineProperty(n,e,{get:function(){return this.__state.space==="HSV"?this.__state[e]:(il.recalculateHSV(this),this.__state[e])},set:function(r){this.__state.space!=="HSV"&&(il.recalculateHSV(this),this.__state.space="HSV"),this.__state[e]=r}})}il.recalculateRGB=function(n,e,t){if(n.__state.space==="HEX")n.__state[e]=iP.component_from_hex(n.__state.hex,t);else if(n.__state.space==="HSV")Pn.extend(n.__state,iP.hsv_to_rgb(n.__state.h,n.__state.s,n.__state.v));else throw new Error("Corrupted color state")};il.recalculateHSV=function(n){var e=iP.rgb_to_hsv(n.r,n.g,n.b);Pn.extend(n.__state,{s:e.s,v:e.v}),Pn.isNaN(e.h)?Pn.isUndefined(n.__state.h)&&(n.__state.h=0):n.__state.h=e.h};il.COMPONENTS=["r","g","b","h","s","v","hex","a"];j6(il.prototype,"r",2);j6(il.prototype,"g",1);j6(il.prototype,"b",0);W6(il.prototype,"h");W6(il.prototype,"s");W6(il.prototype,"v");Object.defineProperty(il.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}});Object.defineProperty(il.prototype,"hex",{get:function(){return this.__state.space!=="HEX"&&(this.__state.hex=iP.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var vx=function(){function n(e,t){ed(this,n),this.initialValue=e[t],this.domElement=document.createElement("div"),this.object=e,this.property=t,this.__onChange=void 0,this.__onFinishChange=void 0}return td(n,[{key:"onChange",value:function(t){return this.__onChange=t,this}},{key:"onFinishChange",value:function(t){return this.__onFinishChange=t,this}},{key:"setValue",value:function(t){return this.object[this.property]=t,this.__onChange&&this.__onChange.call(this,t),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),n}(),lSe={HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},Fne={};Pn.each(lSe,function(n,e){Pn.each(n,function(t){Fne[t]=e})});var cSe=/(\d+(\.\d+)?)px/;function zd(n){if(n==="0"||Pn.isUndefined(n))return 0;var e=n.match(cSe);return Pn.isNull(e)?0:parseFloat(e[1])}var an={makeSelectable:function(e,t){e===void 0||e.style===void 0||(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(e,t,r){var i=r,s=t;Pn.isUndefined(s)&&(s=!0),Pn.isUndefined(i)&&(i=!0),e.style.position="absolute",s&&(e.style.left=0,e.style.right=0),i&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,t,r,i){var s=r||{},a=Fne[t];if(!a)throw new Error("Event type "+t+" not supported.");var l=document.createEvent(a);switch(a){case"MouseEvents":{var o=s.x||s.clientX||0,h=s.y||s.clientY||0;l.initMouseEvent(t,s.bubbles||!1,s.cancelable||!0,window,s.clickCount||1,0,0,o,h,!1,!1,!1,!1,0,null);break}case"KeyboardEvents":{var d=l.initKeyboardEvent||l.initKeyEvent;Pn.defaults(s,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),d(t,s.bubbles||!1,s.cancelable,window,s.ctrlKey,s.altKey,s.shiftKey,s.metaKey,s.keyCode,s.charCode);break}default:{l.initEvent(t,s.bubbles||!1,s.cancelable||!0);break}}Pn.defaults(l,i),e.dispatchEvent(l)},bind:function(e,t,r,i){var s=i||!1;return e.addEventListener?e.addEventListener(t,r,s):e.attachEvent&&e.attachEvent("on"+t,r),an},unbind:function(e,t,r,i){var s=i||!1;return e.removeEventListener?e.removeEventListener(t,r,s):e.detachEvent&&e.detachEvent("on"+t,r),an},addClass:function(e,t){if(e.className===void 0)e.className=t;else if(e.className!==t){var r=e.className.split(/ +/);r.indexOf(t)===-1&&(r.push(t),e.className=r.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return an},removeClass:function(e,t){if(t)if(e.className===t)e.removeAttribute("class");else{var r=e.className.split(/ +/),i=r.indexOf(t);i!==-1&&(r.splice(i,1),e.className=r.join(" "))}else e.className=void 0;return an},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){var t=getComputedStyle(e);return zd(t["border-left-width"])+zd(t["border-right-width"])+zd(t["padding-left"])+zd(t["padding-right"])+zd(t.width)},getHeight:function(e){var t=getComputedStyle(e);return zd(t["border-top-width"])+zd(t["border-bottom-width"])+zd(t["padding-top"])+zd(t["padding-bottom"])+zd(t.height)},getOffset:function(e){var t=e,r={left:0,top:0};if(t.offsetParent)do r.left+=t.offsetLeft,r.top+=t.offsetTop,t=t.offsetParent;while(t);return r},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},Nne=function(n){Iv(e,n);function e(t,r){ed(this,e);var i=Rv(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r)),s=i;i.__prev=i.getValue(),i.__checkbox=document.createElement("input"),i.__checkbox.setAttribute("type","checkbox");function a(){s.setValue(!s.__prev)}return an.bind(i.__checkbox,"change",a,!1),i.domElement.appendChild(i.__checkbox),i.updateDisplay(),i}return td(e,[{key:"setValue",value:function(r){var i=uv(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,r);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),i}},{key:"updateDisplay",value:function(){return this.getValue()===!0?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),uv(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(vx),uSe=function(n){Iv(e,n);function e(t,r,i){ed(this,e);var s=Rv(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r)),a=i,l=s;if(s.__select=document.createElement("select"),Pn.isArray(a)){var o={};Pn.each(a,function(h){o[h]=h}),a=o}return Pn.each(a,function(h,d){var m=document.createElement("option");m.innerHTML=d,m.setAttribute("value",h),l.__select.appendChild(m)}),s.updateDisplay(),an.bind(s.__select,"change",function(){var h=this.options[this.selectedIndex].value;l.setValue(h)}),s.domElement.appendChild(s.__select),s}return td(e,[{key:"setValue",value:function(r){var i=uv(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,r);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),i}},{key:"updateDisplay",value:function(){return an.isActive(this.__select)?this:(this.__select.value=this.getValue(),uv(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this))}}]),e}(vx),hSe=function(n){Iv(e,n);function e(t,r){ed(this,e);var i=Rv(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r)),s=i;function a(){s.setValue(s.__input.value)}function l(){s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}return i.__input=document.createElement("input"),i.__input.setAttribute("type","text"),an.bind(i.__input,"keyup",a),an.bind(i.__input,"change",a),an.bind(i.__input,"blur",l),an.bind(i.__input,"keydown",function(o){o.keyCode===13&&this.blur()}),i.updateDisplay(),i.domElement.appendChild(i.__input),i}return td(e,[{key:"updateDisplay",value:function(){return an.isActive(this.__input)||(this.__input.value=this.getValue()),uv(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(vx);function WW(n){var e=n.toString();return e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0}var zne=function(n){Iv(e,n);function e(t,r,i){ed(this,e);var s=Rv(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r)),a=i||{};return s.__min=a.min,s.__max=a.max,s.__step=a.step,Pn.isUndefined(s.__step)?s.initialValue===0?s.__impliedStep=1:s.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(s.initialValue))/Math.LN10))/10:s.__impliedStep=s.__step,s.__precision=WW(s.__impliedStep),s}return td(e,[{key:"setValue",value:function(r){var i=r;return this.__min!==void 0&&i<this.__min?i=this.__min:this.__max!==void 0&&i>this.__max&&(i=this.__max),this.__step!==void 0&&i%this.__step!==0&&(i=Math.round(i/this.__step)*this.__step),uv(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,i)}},{key:"min",value:function(r){return this.__min=r,this}},{key:"max",value:function(r){return this.__max=r,this}},{key:"step",value:function(r){return this.__step=r,this.__impliedStep=r,this.__precision=WW(r),this}}]),e}(vx);function fSe(n,e){var t=Math.pow(10,e);return Math.round(n*t)/t}var sP=function(n){Iv(e,n);function e(t,r,i){ed(this,e);var s=Rv(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r,i));s.__truncationSuspended=!1;var a=s,l=void 0;function o(){var T=parseFloat(a.__input.value);Pn.isNaN(T)||a.setValue(T)}function h(){a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}function d(){h()}function m(T){var I=l-T.clientY;a.setValue(a.getValue()+I*a.__impliedStep),l=T.clientY}function _(){an.unbind(window,"mousemove",m),an.unbind(window,"mouseup",_),h()}function y(T){an.bind(window,"mousemove",m),an.bind(window,"mouseup",_),l=T.clientY}return s.__input=document.createElement("input"),s.__input.setAttribute("type","text"),an.bind(s.__input,"change",o),an.bind(s.__input,"blur",d),an.bind(s.__input,"mousedown",y),an.bind(s.__input,"keydown",function(T){T.keyCode===13&&(a.__truncationSuspended=!0,this.blur(),a.__truncationSuspended=!1,h())}),s.updateDisplay(),s.domElement.appendChild(s.__input),s}return td(e,[{key:"updateDisplay",value:function(){return this.__input.value=this.__truncationSuspended?this.getValue():fSe(this.getValue(),this.__precision),uv(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(zne);function XW(n,e,t,r,i){return r+(i-r)*((n-e)/(t-e))}var hF=function(n){Iv(e,n);function e(t,r,i,s,a){ed(this,e);var l=Rv(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r,{min:i,max:s,step:a})),o=l;l.__background=document.createElement("div"),l.__foreground=document.createElement("div"),an.bind(l.__background,"mousedown",h),an.bind(l.__background,"touchstart",_),an.addClass(l.__background,"slider"),an.addClass(l.__foreground,"slider-fg");function h(I){document.activeElement.blur(),an.bind(window,"mousemove",d),an.bind(window,"mouseup",m),d(I)}function d(I){I.preventDefault();var C=o.__background.getBoundingClientRect();return o.setValue(XW(I.clientX,C.left,C.right,o.__min,o.__max)),!1}function m(){an.unbind(window,"mousemove",d),an.unbind(window,"mouseup",m),o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}function _(I){I.touches.length===1&&(an.bind(window,"touchmove",y),an.bind(window,"touchend",T),y(I))}function y(I){var C=I.touches[0].clientX,M=o.__background.getBoundingClientRect();o.setValue(XW(C,M.left,M.right,o.__min,o.__max))}function T(){an.unbind(window,"touchmove",y),an.unbind(window,"touchend",T),o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}return l.updateDisplay(),l.__background.appendChild(l.__foreground),l.domElement.appendChild(l.__background),l}return td(e,[{key:"updateDisplay",value:function(){var r=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=r*100+"%",uv(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(zne),Une=function(n){Iv(e,n);function e(t,r,i){ed(this,e);var s=Rv(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r)),a=s;return s.__button=document.createElement("div"),s.__button.innerHTML=i===void 0?"Fire":i,an.bind(s.__button,"click",function(l){return l.preventDefault(),a.fire(),!1}),an.addClass(s.__button,"button"),s.domElement.appendChild(s.__button),s}return td(e,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),e}(vx),fF=function(n){Iv(e,n);function e(t,r){ed(this,e);var i=Rv(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r));i.__color=new il(i.getValue()),i.__temp=new il(0);var s=i;i.domElement=document.createElement("div"),an.makeSelectable(i.domElement,!1),i.__selector=document.createElement("div"),i.__selector.className="selector",i.__saturation_field=document.createElement("div"),i.__saturation_field.className="saturation-field",i.__field_knob=document.createElement("div"),i.__field_knob.className="field-knob",i.__field_knob_border="2px solid ",i.__hue_knob=document.createElement("div"),i.__hue_knob.className="hue-knob",i.__hue_field=document.createElement("div"),i.__hue_field.className="hue-field",i.__input=document.createElement("input"),i.__input.type="text",i.__input_textShadow="0 1px 1px ",an.bind(i.__input,"keydown",function(I){I.keyCode===13&&m.call(this)}),an.bind(i.__input,"blur",m),an.bind(i.__selector,"mousedown",function(){an.addClass(this,"drag").bind(window,"mouseup",function(){an.removeClass(s.__selector,"drag")})}),an.bind(i.__selector,"touchstart",function(){an.addClass(this,"drag").bind(window,"touchend",function(){an.removeClass(s.__selector,"drag")})});var a=document.createElement("div");Pn.extend(i.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),Pn.extend(i.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:i.__field_knob_border+(i.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),Pn.extend(i.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),Pn.extend(i.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),Pn.extend(a.style,{width:"100%",height:"100%",background:"none"}),$W(a,"top","rgba(0,0,0,0)","#000"),Pn.extend(i.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),pSe(i.__hue_field),Pn.extend(i.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:i.__input_textShadow+"rgba(0,0,0,0.7)"}),an.bind(i.__saturation_field,"mousedown",l),an.bind(i.__saturation_field,"touchstart",l),an.bind(i.__field_knob,"mousedown",l),an.bind(i.__field_knob,"touchstart",l),an.bind(i.__hue_field,"mousedown",o),an.bind(i.__hue_field,"touchstart",o);function l(I){y(I),an.bind(window,"mousemove",y),an.bind(window,"touchmove",y),an.bind(window,"mouseup",h),an.bind(window,"touchend",h)}function o(I){T(I),an.bind(window,"mousemove",T),an.bind(window,"touchmove",T),an.bind(window,"mouseup",d),an.bind(window,"touchend",d)}function h(){an.unbind(window,"mousemove",y),an.unbind(window,"touchmove",y),an.unbind(window,"mouseup",h),an.unbind(window,"touchend",h),_()}function d(){an.unbind(window,"mousemove",T),an.unbind(window,"touchmove",T),an.unbind(window,"mouseup",d),an.unbind(window,"touchend",d),_()}function m(){var I=uF(this.value);I!==!1?(s.__color.__state=I,s.setValue(s.__color.toOriginal())):this.value=s.__color.toString()}function _(){s.__onFinishChange&&s.__onFinishChange.call(s,s.__color.toOriginal())}i.__saturation_field.appendChild(a),i.__selector.appendChild(i.__field_knob),i.__selector.appendChild(i.__saturation_field),i.__selector.appendChild(i.__hue_field),i.__hue_field.appendChild(i.__hue_knob),i.domElement.appendChild(i.__input),i.domElement.appendChild(i.__selector),i.updateDisplay();function y(I){I.type.indexOf("touch")===-1&&I.preventDefault();var C=s.__saturation_field.getBoundingClientRect(),M=I.touches&&I.touches[0]||I,B=M.clientX,k=M.clientY,j=(B-C.left)/(C.right-C.left),q=1-(k-C.top)/(C.bottom-C.top);return q>1?q=1:q<0&&(q=0),j>1?j=1:j<0&&(j=0),s.__color.v=q,s.__color.s=j,s.setValue(s.__color.toOriginal()),!1}function T(I){I.type.indexOf("touch")===-1&&I.preventDefault();var C=s.__hue_field.getBoundingClientRect(),M=I.touches&&I.touches[0]||I,B=M.clientY,k=1-(B-C.top)/(C.bottom-C.top);return k>1?k=1:k<0&&(k=0),s.__color.h=k*360,s.setValue(s.__color.toOriginal()),!1}return i}return td(e,[{key:"updateDisplay",value:function(){var r=uF(this.getValue());if(r!==!1){var i=!1;Pn.each(il.COMPONENTS,function(l){if(!Pn.isUndefined(r[l])&&!Pn.isUndefined(this.__color.__state[l])&&r[l]!==this.__color.__state[l])return i=!0,{}},this),i&&Pn.extend(this.__color.__state,r)}Pn.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var s=this.__color.v<.5||this.__color.s>.5?255:0,a=255-s;Pn.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+s+","+s+","+s+")"}),this.__hue_knob.style.marginTop=(1-this.__color.h/360)*100+"px",this.__temp.s=1,this.__temp.v=1,$W(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),Pn.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+s+","+s+","+s+")",textShadow:this.__input_textShadow+"rgba("+a+","+a+","+a+",.7)"})}}]),e}(vx),dSe=["-moz-","-o-","-webkit-","-ms-",""];function $W(n,e,t,r){n.style.background="",Pn.each(dSe,function(i){n.style.cssText+="background: "+i+"linear-gradient("+e+", "+t+" 0%, "+r+" 100%); "})}function pSe(n){n.style.background="",n.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",n.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",n.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",n.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",n.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var mSe={load:function(e,t){var r=t||document,i=r.createElement("link");i.type="text/css",i.rel="stylesheet",i.href=e,r.getElementsByTagName("head")[0].appendChild(i)},inject:function(e,t){var r=t||document,i=document.createElement("style");i.type="text/css",i.innerHTML=e;var s=r.getElementsByTagName("head")[0];try{s.appendChild(i)}catch{}}},gSe=`<div id="dg-save" class="dg dialogue">

  Here's the new load parameter for your <code>GUI</code>'s constructor:

  <textarea id="dg-new-constructor"></textarea>

  <div id="dg-save-locally">

    <input id="dg-local-storage" type="checkbox"/> Automatically save
    values to <code>localStorage</code> on exit.

    <div id="dg-local-explain">The values saved to <code>localStorage</code> will
      override those passed to <code>dat.GUI</code>'s constructor. This makes it
      easier to work incrementally, but <code>localStorage</code> is fragile,
      and your friends may not see the same values you do.

    </div>

  </div>

</div>`,vSe=function(e,t){var r=e[t];return Pn.isArray(arguments[2])||Pn.isObject(arguments[2])?new uSe(e,t,arguments[2]):Pn.isNumber(r)?Pn.isNumber(arguments[2])&&Pn.isNumber(arguments[3])?Pn.isNumber(arguments[4])?new hF(e,t,arguments[2],arguments[3],arguments[4]):new hF(e,t,arguments[2],arguments[3]):Pn.isNumber(arguments[4])?new sP(e,t,{min:arguments[2],max:arguments[3],step:arguments[4]}):new sP(e,t,{min:arguments[2],max:arguments[3]}):Pn.isString(r)?new hSe(e,t):Pn.isFunction(r)?new Une(e,t,""):Pn.isBoolean(r)?new Nne(e,t):null};function _Se(n){setTimeout(n,1e3/60)}var ySe=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||_Se,xSe=function(){function n(){ed(this,n),this.backgroundElement=document.createElement("div"),Pn.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),an.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),Pn.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;an.bind(this.backgroundElement,"click",function(){e.hide()})}return td(n,[{key:"show",value:function(){var t=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),Pn.defer(function(){t.backgroundElement.style.opacity=1,t.domElement.style.opacity=1,t.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){var t=this,r=function i(){t.domElement.style.display="none",t.backgroundElement.style.display="none",an.unbind(t.domElement,"webkitTransitionEnd",i),an.unbind(t.domElement,"transitionend",i),an.unbind(t.domElement,"oTransitionEnd",i)};an.bind(this.domElement,"webkitTransitionEnd",r),an.bind(this.domElement,"transitionend",r),an.bind(this.domElement,"oTransitionEnd",r),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-an.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-an.getHeight(this.domElement)/2+"px"}}]),n}(),bSe=sSe(`.dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .cr.function .property-name{width:100%}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}
`);mSe.inject(bSe);var qW="dg",ZW=72,YW=20,$A="Default",fS=function(){try{return!!window.localStorage}catch{return!1}}(),jS=void 0,KW=!0,H1=void 0,j5=!1,Vne=[],ro=function n(e){var t=this,r=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),an.addClass(this.domElement,qW),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],r=Pn.defaults(r,{closeOnTop:!1,autoPlace:!0,width:n.DEFAULT_WIDTH}),r=Pn.defaults(r,{resizable:r.autoPlace,hideable:r.autoPlace}),Pn.isUndefined(r.load)?r.load={preset:$A}:r.preset&&(r.load.preset=r.preset),Pn.isUndefined(r.parent)&&r.hideable&&Vne.push(this),r.resizable=Pn.isUndefined(r.parent)&&r.resizable,r.autoPlace&&Pn.isUndefined(r.scrollable)&&(r.scrollable=!0);var i=fS&&localStorage.getItem(j1(this,"isLocal"))==="true",s=void 0,a=void 0;if(Object.defineProperties(this,{parent:{get:function(){return r.parent}},scrollable:{get:function(){return r.scrollable}},autoPlace:{get:function(){return r.autoPlace}},closeOnTop:{get:function(){return r.closeOnTop}},preset:{get:function(){return t.parent?t.getRoot().preset:r.load.preset},set:function(_){t.parent?t.getRoot().preset=_:r.load.preset=_,TSe(this),t.revert()}},width:{get:function(){return r.width},set:function(_){r.width=_,mF(t,_)}},name:{get:function(){return r.name},set:function(_){r.name=_,a&&(a.innerHTML=r.name)}},closed:{get:function(){return r.closed},set:function(_){r.closed=_,r.closed?an.addClass(t.__ul,n.CLASS_CLOSED):an.removeClass(t.__ul,n.CLASS_CLOSED),this.onResize(),t.__closeButton&&(t.__closeButton.innerHTML=_?n.TEXT_OPEN:n.TEXT_CLOSED)}},load:{get:function(){return r.load}},useLocalStorage:{get:function(){return i},set:function(_){fS&&(i=_,_?an.bind(window,"unload",s):an.unbind(window,"unload",s),localStorage.setItem(j1(t,"isLocal"),_))}}}),Pn.isUndefined(r.parent)){if(this.closed=r.closed||!1,an.addClass(this.domElement,n.CLASS_MAIN),an.makeSelectable(this.domElement,!1),fS&&i){t.useLocalStorage=!0;var l=localStorage.getItem(j1(this,"gui"));l&&(r.load=JSON.parse(l))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=n.TEXT_CLOSED,an.addClass(this.__closeButton,n.CLASS_CLOSE_BUTTON),r.closeOnTop?(an.addClass(this.__closeButton,n.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(an.addClass(this.__closeButton,n.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),an.bind(this.__closeButton,"click",function(){t.closed=!t.closed})}else{r.closed===void 0&&(r.closed=!0);var o=document.createTextNode(r.name);an.addClass(o,"controller-name"),a=X6(t,o);var h=function(_){return _.preventDefault(),t.closed=!t.closed,!1};an.addClass(this.__ul,n.CLASS_CLOSED),an.addClass(a,"title"),an.bind(a,"click",h),r.closed||(this.closed=!1)}r.autoPlace&&(Pn.isUndefined(r.parent)&&(KW&&(H1=document.createElement("div"),an.addClass(H1,qW),an.addClass(H1,n.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(H1),KW=!1),H1.appendChild(this.domElement),an.addClass(this.domElement,n.CLASS_AUTO_PLACE)),this.parent||mF(t,r.width)),this.__resizeHandler=function(){t.onResizeDebounced()},an.bind(window,"resize",this.__resizeHandler),an.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),an.bind(this.__ul,"transitionend",this.__resizeHandler),an.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),r.resizable&&ASe(this),s=function(){fS&&localStorage.getItem(j1(t,"isLocal"))==="true"&&localStorage.setItem(j1(t,"gui"),JSON.stringify(t.getSaveObject()))},this.saveToLocalStorageIfPossible=s;function d(){var m=t.getRoot();m.width+=1,Pn.defer(function(){m.width-=1})}r.parent||d()};ro.toggleHide=function(){j5=!j5,Pn.each(Vne,function(n){n.domElement.style.display=j5?"none":""})};ro.CLASS_AUTO_PLACE="a";ro.CLASS_AUTO_PLACE_CONTAINER="ac";ro.CLASS_MAIN="main";ro.CLASS_CONTROLLER_ROW="cr";ro.CLASS_TOO_TALL="taller-than-window";ro.CLASS_CLOSED="closed";ro.CLASS_CLOSE_BUTTON="close-button";ro.CLASS_CLOSE_TOP="close-top";ro.CLASS_CLOSE_BOTTOM="close-bottom";ro.CLASS_DRAG="drag";ro.DEFAULT_WIDTH=245;ro.TEXT_CLOSED="Close Controls";ro.TEXT_OPEN="Open Controls";ro._keydownHandler=function(n){document.activeElement.type!=="text"&&(n.which===ZW||n.keyCode===ZW)&&ro.toggleHide()};an.bind(window,"keydown",ro._keydownHandler,!1);Pn.extend(ro.prototype,{add:function(e,t){return WS(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return WS(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;Pn.defer(function(){t.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&H1.removeChild(this.domElement);var e=this;Pn.each(this.__folders,function(t){e.removeFolder(t)}),an.unbind(window,"keydown",ro._keydownHandler,!1),JW(this)},addFolder:function(e){if(this.__folders[e]!==void 0)throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);var r=new ro(t);this.__folders[e]=r;var i=X6(this,r.domElement);return an.addClass(i,"folder"),r},removeFolder:function(e){this.__ul.removeChild(e.domElement.parentElement),delete this.__folders[e.name],this.load&&this.load.folders&&this.load.folders[e.name]&&delete this.load.folders[e.name],JW(e);var t=this;Pn.each(e.__folders,function(r){e.removeFolder(r)}),Pn.defer(function(){t.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=an.getOffset(e.__ul).top,r=0;Pn.each(e.__ul.childNodes,function(i){e.autoPlace&&i===e.__save_row||(r+=an.getHeight(i))}),window.innerHeight-t-YW<r?(an.addClass(e.domElement,ro.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-YW+"px"):(an.removeClass(e.domElement,ro.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&Pn.defer(function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"}),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},onResizeDebounced:Pn.debounce(function(){this.onResize()},50),remember:function(){if(Pn.isUndefined(jS)&&(jS=new xSe,jS.domElement.innerHTML=gSe),this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;Pn.each(Array.prototype.slice.call(arguments),function(t){e.__rememberedObjects.length===0&&SSe(e),e.__rememberedObjects.indexOf(t)===-1&&e.__rememberedObjects.push(t)}),this.autoPlace&&mF(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=pE(this)),e.folders={},Pn.each(this.__folders,function(t,r){e.folders[r]=t.getSaveObject()}),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=pE(this),dF(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[$A]=pE(this,!0)),this.load.remembered[e]=pE(this),this.preset=e,pF(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(e){Pn.each(this.__controllers,function(t){this.getRoot().load.remembered?Gne(e||this.getRoot(),t):t.setValue(t.initialValue),t.__onFinishChange&&t.__onFinishChange.call(t,t.getValue())},this),Pn.each(this.__folders,function(t){t.revert(t)}),e||dF(this.getRoot(),!1)},listen:function(e){var t=this.__listening.length===0;this.__listening.push(e),t&&Hne(this.__listening)},updateDisplay:function(){Pn.each(this.__controllers,function(e){e.updateDisplay()}),Pn.each(this.__folders,function(e){e.updateDisplay()})}});function X6(n,e,t){var r=document.createElement("li");return e&&r.appendChild(e),t?n.__ul.insertBefore(r,t):n.__ul.appendChild(r),n.onResize(),r}function JW(n){an.unbind(window,"resize",n.__resizeHandler),n.saveToLocalStorageIfPossible&&an.unbind(window,"unload",n.saveToLocalStorageIfPossible)}function dF(n,e){var t=n.__preset_select[n.__preset_select.selectedIndex];e?t.innerHTML=t.value+"*":t.innerHTML=t.value}function wSe(n,e,t){if(t.__li=e,t.__gui=n,Pn.extend(t,{options:function(a){if(arguments.length>1){var l=t.__li.nextElementSibling;return t.remove(),WS(n,t.object,t.property,{before:l,factoryArgs:[Pn.toArray(arguments)]})}if(Pn.isArray(a)||Pn.isObject(a)){var o=t.__li.nextElementSibling;return t.remove(),WS(n,t.object,t.property,{before:o,factoryArgs:[a]})}},name:function(a){return t.__li.firstElementChild.firstElementChild.innerHTML=a,t},listen:function(){return t.__gui.listen(t),t},remove:function(){return t.__gui.remove(t),t}}),t instanceof hF){var r=new sP(t.object,t.property,{min:t.__min,max:t.__max,step:t.__step});Pn.each(["updateDisplay","onChange","onFinishChange","step","min","max"],function(s){var a=t[s],l=r[s];t[s]=r[s]=function(){var o=Array.prototype.slice.call(arguments);return l.apply(r,o),a.apply(t,o)}}),an.addClass(e,"has-slider"),t.domElement.insertBefore(r.domElement,t.domElement.firstElementChild)}else if(t instanceof sP){var i=function(a){if(Pn.isNumber(t.__min)&&Pn.isNumber(t.__max)){var l=t.__li.firstElementChild.firstElementChild.innerHTML,o=t.__gui.__listening.indexOf(t)>-1;t.remove();var h=WS(n,t.object,t.property,{before:t.__li.nextElementSibling,factoryArgs:[t.__min,t.__max,t.__step]});return h.name(l),o&&h.listen(),h}return a};t.min=Pn.compose(i,t.min),t.max=Pn.compose(i,t.max)}else t instanceof Nne?(an.bind(e,"click",function(){an.fakeEvent(t.__checkbox,"click")}),an.bind(t.__checkbox,"click",function(s){s.stopPropagation()})):t instanceof Une?(an.bind(e,"click",function(){an.fakeEvent(t.__button,"click")}),an.bind(e,"mouseover",function(){an.addClass(t.__button,"hover")}),an.bind(e,"mouseout",function(){an.removeClass(t.__button,"hover")})):t instanceof fF&&(an.addClass(e,"color"),t.updateDisplay=Pn.compose(function(s){return e.style.borderLeftColor=t.__color.toString(),s},t.updateDisplay),t.updateDisplay());t.setValue=Pn.compose(function(s){return n.getRoot().__preset_select&&t.isModified()&&dF(n.getRoot(),!0),s},t.setValue)}function Gne(n,e){var t=n.getRoot(),r=t.__rememberedObjects.indexOf(e.object);if(r!==-1){var i=t.__rememberedObjectIndecesToControllers[r];if(i===void 0&&(i={},t.__rememberedObjectIndecesToControllers[r]=i),i[e.property]=e,t.load&&t.load.remembered){var s=t.load.remembered,a=void 0;if(s[n.preset])a=s[n.preset];else if(s[$A])a=s[$A];else return;if(a[r]&&a[r][e.property]!==void 0){var l=a[r][e.property];e.initialValue=l,e.setValue(l)}}}}function WS(n,e,t,r){if(e[t]===void 0)throw new Error('Object "'+e+'" has no property "'+t+'"');var i=void 0;if(r.color)i=new fF(e,t);else{var s=[e,t].concat(r.factoryArgs);i=vSe.apply(n,s)}r.before instanceof vx&&(r.before=r.before.__li),Gne(n,i),an.addClass(i.domElement,"c");var a=document.createElement("span");an.addClass(a,"property-name"),a.innerHTML=i.property;var l=document.createElement("div");l.appendChild(a),l.appendChild(i.domElement);var o=X6(n,l,r.before);return an.addClass(o,ro.CLASS_CONTROLLER_ROW),i instanceof fF?an.addClass(o,"color"):an.addClass(o,aSe(i.getValue())),wSe(n,o,i),n.__controllers.push(i),i}function j1(n,e){return document.location.href+"."+e}function pF(n,e,t){var r=document.createElement("option");r.innerHTML=e,r.value=e,n.__preset_select.appendChild(r),t&&(n.__preset_select.selectedIndex=n.__preset_select.length-1)}function QW(n,e){e.style.display=n.useLocalStorage?"block":"none"}function SSe(n){var e=n.__save_row=document.createElement("li");an.addClass(n.domElement,"has-save"),n.__ul.insertBefore(e,n.__ul.firstChild),an.addClass(e,"save-row");var t=document.createElement("span");t.innerHTML="&nbsp;",an.addClass(t,"button gears");var r=document.createElement("span");r.innerHTML="Save",an.addClass(r,"button"),an.addClass(r,"save");var i=document.createElement("span");i.innerHTML="New",an.addClass(i,"button"),an.addClass(i,"save-as");var s=document.createElement("span");s.innerHTML="Revert",an.addClass(s,"button"),an.addClass(s,"revert");var a=n.__preset_select=document.createElement("select");if(n.load&&n.load.remembered?Pn.each(n.load.remembered,function(m,_){pF(n,_,_===n.preset)}):pF(n,$A,!1),an.bind(a,"change",function(){for(var m=0;m<n.__preset_select.length;m++)n.__preset_select[m].innerHTML=n.__preset_select[m].value;n.preset=this.value}),e.appendChild(a),e.appendChild(t),e.appendChild(r),e.appendChild(i),e.appendChild(s),fS){var l=document.getElementById("dg-local-explain"),o=document.getElementById("dg-local-storage"),h=document.getElementById("dg-save-locally");h.style.display="block",localStorage.getItem(j1(n,"isLocal"))==="true"&&o.setAttribute("checked","checked"),QW(n,l),an.bind(o,"change",function(){n.useLocalStorage=!n.useLocalStorage,QW(n,l)})}var d=document.getElementById("dg-new-constructor");an.bind(d,"keydown",function(m){m.metaKey&&(m.which===67||m.keyCode===67)&&jS.hide()}),an.bind(t,"click",function(){d.innerHTML=JSON.stringify(n.getSaveObject(),void 0,2),jS.show(),d.focus(),d.select()}),an.bind(r,"click",function(){n.save()}),an.bind(i,"click",function(){var m=prompt("Enter a new preset name.");m&&n.saveAs(m)}),an.bind(s,"click",function(){n.revert()})}function ASe(n){var e=void 0;n.__resize_handle=document.createElement("div"),Pn.extend(n.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});function t(s){return s.preventDefault(),n.width+=e-s.clientX,n.onResize(),e=s.clientX,!1}function r(){an.removeClass(n.__closeButton,ro.CLASS_DRAG),an.unbind(window,"mousemove",t),an.unbind(window,"mouseup",r)}function i(s){return s.preventDefault(),e=s.clientX,an.addClass(n.__closeButton,ro.CLASS_DRAG),an.bind(window,"mousemove",t),an.bind(window,"mouseup",r),!1}an.bind(n.__resize_handle,"mousedown",i),an.bind(n.__closeButton,"mousedown",i),n.domElement.insertBefore(n.__resize_handle,n.domElement.firstElementChild)}function mF(n,e){n.domElement.style.width=e+"px",n.__save_row&&n.autoPlace&&(n.__save_row.style.width=e+"px"),n.__closeButton&&(n.__closeButton.style.width=e+"px")}function pE(n,e){var t={};return Pn.each(n.__rememberedObjects,function(r,i){var s={},a=n.__rememberedObjectIndecesToControllers[i];Pn.each(a,function(l,o){s[o]=e?l.initialValue:l.getValue()}),t[i]=s}),t}function TSe(n){for(var e=0;e<n.__preset_select.length;e++)n.__preset_select[e].value===n.preset&&(n.__preset_select.selectedIndex=e)}function Hne(n){n.length!==0&&ySe.call(window,function(){Hne(n)}),Pn.each(n,function(e){e.updateDisplay()})}var MSe=ro,Kd=Object.freeze({Linear:Object.freeze({None:function(n){return n},In:function(n){return this.None(n)},Out:function(n){return this.None(n)},InOut:function(n){return this.None(n)}}),Quadratic:Object.freeze({In:function(n){return n*n},Out:function(n){return n*(2-n)},InOut:function(n){return(n*=2)<1?.5*n*n:-.5*(--n*(n-2)-1)}}),Cubic:Object.freeze({In:function(n){return n*n*n},Out:function(n){return--n*n*n+1},InOut:function(n){return(n*=2)<1?.5*n*n*n:.5*((n-=2)*n*n+2)}}),Quartic:Object.freeze({In:function(n){return n*n*n*n},Out:function(n){return 1- --n*n*n*n},InOut:function(n){return(n*=2)<1?.5*n*n*n*n:-.5*((n-=2)*n*n*n-2)}}),Quintic:Object.freeze({In:function(n){return n*n*n*n*n},Out:function(n){return--n*n*n*n*n+1},InOut:function(n){return(n*=2)<1?.5*n*n*n*n*n:.5*((n-=2)*n*n*n*n+2)}}),Sinusoidal:Object.freeze({In:function(n){return 1-Math.sin((1-n)*Math.PI/2)},Out:function(n){return Math.sin(n*Math.PI/2)},InOut:function(n){return .5*(1-Math.sin(Math.PI*(.5-n)))}}),Exponential:Object.freeze({In:function(n){return n===0?0:Math.pow(1024,n-1)},Out:function(n){return n===1?1:1-Math.pow(2,-10*n)},InOut:function(n){return n===0?0:n===1?1:(n*=2)<1?.5*Math.pow(1024,n-1):.5*(-Math.pow(2,-10*(n-1))+2)}}),Circular:Object.freeze({In:function(n){return 1-Math.sqrt(1-n*n)},Out:function(n){return Math.sqrt(1- --n*n)},InOut:function(n){return(n*=2)<1?-.5*(Math.sqrt(1-n*n)-1):.5*(Math.sqrt(1-(n-=2)*n)+1)}}),Elastic:Object.freeze({In:function(n){return n===0?0:n===1?1:-Math.pow(2,10*(n-1))*Math.sin((n-1.1)*5*Math.PI)},Out:function(n){return n===0?0:n===1?1:Math.pow(2,-10*n)*Math.sin((n-.1)*5*Math.PI)+1},InOut:function(n){return n===0?0:n===1?1:(n*=2,n<1?-.5*Math.pow(2,10*(n-1))*Math.sin((n-1.1)*5*Math.PI):.5*Math.pow(2,-10*(n-1))*Math.sin((n-1.1)*5*Math.PI)+1)}}),Back:Object.freeze({In:function(n){var e=1.70158;return n===1?1:n*n*((e+1)*n-e)},Out:function(n){var e=1.70158;return n===0?0:--n*n*((e+1)*n+e)+1},InOut:function(n){var e=2.5949095;return(n*=2)<1?.5*(n*n*((e+1)*n-e)):.5*((n-=2)*n*((e+1)*n+e)+2)}}),Bounce:Object.freeze({In:function(n){return 1-Kd.Bounce.Out(1-n)},Out:function(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375},InOut:function(n){return n<.5?Kd.Bounce.In(n*2)*.5:Kd.Bounce.Out(n*2-1)*.5+.5}}),generatePow:function(n){return n===void 0&&(n=4),n=n<Number.EPSILON?Number.EPSILON:n,n=n>1e4?1e4:n,{In:function(e){return Math.pow(e,n)},Out:function(e){return 1-Math.pow(1-e,n)},InOut:function(e){return e<.5?Math.pow(e*2,n)/2:(1-Math.pow(2-e*2,n))/2+.5}}}}),fb=function(){return performance.now()},jne=function(){function n(){this._tweens={},this._tweensAddedDuringUpdate={}}return n.prototype.getAll=function(){var e=this;return Object.keys(this._tweens).map(function(t){return e._tweens[t]})},n.prototype.removeAll=function(){this._tweens={}},n.prototype.add=function(e){this._tweens[e.getId()]=e,this._tweensAddedDuringUpdate[e.getId()]=e},n.prototype.remove=function(e){delete this._tweens[e.getId()],delete this._tweensAddedDuringUpdate[e.getId()]},n.prototype.update=function(e,t){e===void 0&&(e=fb()),t===void 0&&(t=!1);var r=Object.keys(this._tweens);if(r.length===0)return!1;for(;r.length>0;){this._tweensAddedDuringUpdate={};for(var i=0;i<r.length;i++){var s=this._tweens[r[i]],a=!t;s&&s.update(e,a)===!1&&!t&&delete this._tweens[r[i]]}r=Object.keys(this._tweensAddedDuringUpdate)}return!0},n}(),yy={Linear:function(n,e){var t=n.length-1,r=t*e,i=Math.floor(r),s=yy.Utils.Linear;return e<0?s(n[0],n[1],r):e>1?s(n[t],n[t-1],t-r):s(n[i],n[i+1>t?t:i+1],r-i)},Bezier:function(n,e){for(var t=0,r=n.length-1,i=Math.pow,s=yy.Utils.Bernstein,a=0;a<=r;a++)t+=i(1-e,r-a)*i(e,a)*n[a]*s(r,a);return t},CatmullRom:function(n,e){var t=n.length-1,r=t*e,i=Math.floor(r),s=yy.Utils.CatmullRom;return n[0]===n[t]?(e<0&&(i=Math.floor(r=t*(1+e))),s(n[(i-1+t)%t],n[i],n[(i+1)%t],n[(i+2)%t],r-i)):e<0?n[0]-(s(n[0],n[0],n[1],n[1],-r)-n[0]):e>1?n[t]-(s(n[t],n[t],n[t-1],n[t-1],r-t)-n[t]):s(n[i?i-1:0],n[i],n[t<i+1?t:i+1],n[t<i+2?t:i+2],r-i)},Utils:{Linear:function(n,e,t){return(e-n)*t+n},Bernstein:function(n,e){var t=yy.Utils.Factorial;return t(n)/t(e)/t(n-e)},Factorial:function(){var n=[1];return function(e){var t=1;if(n[e])return n[e];for(var r=e;r>1;r--)t*=r;return n[e]=t,t}}(),CatmullRom:function(n,e,t,r,i){var s=(t-n)*.5,a=(r-e)*.5,l=i*i,o=i*l;return(2*e-2*t+s+a)*o+(-3*e+3*t-2*s-a)*l+s*i+e}}},$6=function(){function n(){}return n.nextId=function(){return n._nextId++},n._nextId=0,n}(),gF=new jne,dS=function(){function n(e,t){t===void 0&&(t=gF),this._object=e,this._group=t,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._isDynamic=!1,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=Kd.Linear.None,this._interpolationFunction=yy.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._id=$6.nextId(),this._isChainStopped=!1,this._propertiesAreSetUp=!1,this._goToEnd=!1}return n.prototype.getId=function(){return this._id},n.prototype.isPlaying=function(){return this._isPlaying},n.prototype.isPaused=function(){return this._isPaused},n.prototype.getDuration=function(){return this._duration},n.prototype.to=function(e,t){if(t===void 0&&(t=1e3),this._isPlaying)throw new Error("Can not call Tween.to() while Tween is already started or paused. Stop the Tween first.");return this._valuesEnd=e,this._propertiesAreSetUp=!1,this._duration=t<0?0:t,this},n.prototype.duration=function(e){return e===void 0&&(e=1e3),this._duration=e<0?0:e,this},n.prototype.dynamic=function(e){return e===void 0&&(e=!1),this._isDynamic=e,this},n.prototype.start=function(e,t){if(e===void 0&&(e=fb()),t===void 0&&(t=!1),this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed){this._reversed=!1;for(var r in this._valuesStartRepeat)this._swapEndStartRepeatValues(r),this._valuesStart[r]=this._valuesStartRepeat[r]}if(this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=e,this._startTime+=this._delayTime,!this._propertiesAreSetUp||t){if(this._propertiesAreSetUp=!0,!this._isDynamic){var i={};for(var s in this._valuesEnd)i[s]=this._valuesEnd[s];this._valuesEnd=i}this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,t)}return this},n.prototype.startFromCurrentValues=function(e){return this.start(e,!0)},n.prototype._setupProperties=function(e,t,r,i,s){for(var a in r){var l=e[a],o=Array.isArray(l),h=o?"array":typeof l,d=!o&&Array.isArray(r[a]);if(!(h==="undefined"||h==="function")){if(d){var m=r[a];if(m.length===0)continue;for(var _=[l],y=0,T=m.length;y<T;y+=1){var I=this._handleRelativeValue(l,m[y]);if(isNaN(I)){d=!1,console.warn("Found invalid interpolation list. Skipping.");break}_.push(I)}d&&(r[a]=_)}if((h==="object"||o)&&l&&!d){t[a]=o?[]:{};var C=l;for(var M in C)t[a][M]=C[M];i[a]=o?[]:{};var m=r[a];if(!this._isDynamic){var B={};for(var M in m)B[M]=m[M];r[a]=m=B}this._setupProperties(C,t[a],m,i[a],s)}else(typeof t[a]>"u"||s)&&(t[a]=l),o||(t[a]*=1),d?i[a]=r[a].slice().reverse():i[a]=t[a]||0}}},n.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},n.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},n.prototype.pause=function(e){return e===void 0&&(e=fb()),this._isPaused||!this._isPlaying?this:(this._isPaused=!0,this._pauseStart=e,this._group&&this._group.remove(this),this)},n.prototype.resume=function(e){return e===void 0&&(e=fb()),!this._isPaused||!this._isPlaying?this:(this._isPaused=!1,this._startTime+=e-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this)},n.prototype.stopChainedTweens=function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop();return this},n.prototype.group=function(e){return e===void 0&&(e=gF),this._group=e,this},n.prototype.delay=function(e){return e===void 0&&(e=0),this._delayTime=e,this},n.prototype.repeat=function(e){return e===void 0&&(e=0),this._initialRepeat=e,this._repeat=e,this},n.prototype.repeatDelay=function(e){return this._repeatDelayTime=e,this},n.prototype.yoyo=function(e){return e===void 0&&(e=!1),this._yoyo=e,this},n.prototype.easing=function(e){return e===void 0&&(e=Kd.Linear.None),this._easingFunction=e,this},n.prototype.interpolation=function(e){return e===void 0&&(e=yy.Linear),this._interpolationFunction=e,this},n.prototype.chain=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this._chainedTweens=e,this},n.prototype.onStart=function(e){return this._onStartCallback=e,this},n.prototype.onEveryStart=function(e){return this._onEveryStartCallback=e,this},n.prototype.onUpdate=function(e){return this._onUpdateCallback=e,this},n.prototype.onRepeat=function(e){return this._onRepeatCallback=e,this},n.prototype.onComplete=function(e){return this._onCompleteCallback=e,this},n.prototype.onStop=function(e){return this._onStopCallback=e,this},n.prototype.update=function(e,t){var r=this,i;if(e===void 0&&(e=fb()),t===void 0&&(t=!0),this._isPaused)return!0;var s,a=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(e>a)return!1;t&&this.start(e,!0)}if(this._goToEnd=!1,e<this._startTime)return!0;this._onStartCallbackFired===!1&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),this._onEveryStartCallbackFired===!1&&(this._onEveryStartCallback&&this._onEveryStartCallback(this._object),this._onEveryStartCallbackFired=!0);var l=e-this._startTime,o=this._duration+((i=this._repeatDelayTime)!==null&&i!==void 0?i:this._delayTime),h=this._duration+this._repeat*o,d=function(){if(r._duration===0||l>h)return 1;var C=Math.trunc(l/o),M=l-C*o,B=Math.min(M/r._duration,1);return B===0&&l===r._duration?1:B},m=d(),_=this._easingFunction(m);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,_),this._onUpdateCallback&&this._onUpdateCallback(this._object,m),this._duration===0||l>=this._duration)if(this._repeat>0){var y=Math.min(Math.trunc((l-this._duration)/o)+1,this._repeat);isFinite(this._repeat)&&(this._repeat-=y);for(s in this._valuesStartRepeat)!this._yoyo&&typeof this._valuesEnd[s]=="string"&&(this._valuesStartRepeat[s]=this._valuesStartRepeat[s]+parseFloat(this._valuesEnd[s])),this._yoyo&&this._swapEndStartRepeatValues(s),this._valuesStart[s]=this._valuesStartRepeat[s];return this._yoyo&&(this._reversed=!this._reversed),this._startTime+=o*y,this._onRepeatCallback&&this._onRepeatCallback(this._object),this._onEveryStartCallbackFired=!1,!0}else{this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var T=0,I=this._chainedTweens.length;T<I;T++)this._chainedTweens[T].start(this._startTime+this._duration,!1);return this._isPlaying=!1,!1}return!0},n.prototype._updateProperties=function(e,t,r,i){for(var s in r)if(t[s]!==void 0){var a=t[s]||0,l=r[s],o=Array.isArray(e[s]),h=Array.isArray(l),d=!o&&h;d?e[s]=this._interpolationFunction(l,i):typeof l=="object"&&l?this._updateProperties(e[s],a,l,i):(l=this._handleRelativeValue(a,l),typeof l=="number"&&(e[s]=a+(l-a)*i))}},n.prototype._handleRelativeValue=function(e,t){return typeof t!="string"?t:t.charAt(0)==="+"||t.charAt(0)==="-"?e+parseFloat(t):parseFloat(t)},n.prototype._swapEndStartRepeatValues=function(e){var t=this._valuesStartRepeat[e],r=this._valuesEnd[e];typeof r=="string"?this._valuesStartRepeat[e]=this._valuesStartRepeat[e]+parseFloat(r):this._valuesStartRepeat[e]=this._valuesEnd[e],this._valuesEnd[e]=t},n}(),CSe="23.1.1",ESe=$6.nextId,up=gF,ISe=up.getAll.bind(up),RSe=up.removeAll.bind(up),PSe=up.add.bind(up),pS=up.remove.bind(up),Wne=up.update.bind(up),W5={Easing:Kd,Group:jne,Interpolation:yy,now:fb,Sequence:$6,nextId:ESe,Tween:dS,VERSION:CSe,getAll:ISe,removeAll:RSe,add:PSe,remove:pS,update:Wne};const Xne={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = opacity * texel;


		}`};class Pv{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const LSe=new Kf(-1,1,1,-1,0,1);class DSe extends $r{constructor(){super(),this.setAttribute("position",new ar([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new ar([0,2,0,0,2,0],2))}}const BSe=new DSe;class $T{constructor(e){this._mesh=new Ei(BSe,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,LSe)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class kSe extends Pv{constructor(e,t){super(),this.textureID=t!==void 0?t:"tDiffuse",e instanceof Eo?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=Gm.clone(e.uniforms),this.material=new Eo({name:e.name!==void 0?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new $T(this.material)}render(e,t,r){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class eX extends Pv{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,r){const i=e.getContext(),s=e.state;s.buffers.color.setMask(!1),s.buffers.depth.setMask(!1),s.buffers.color.setLocked(!0),s.buffers.depth.setLocked(!0);let a,l;this.inverse?(a=0,l=1):(a=1,l=0),s.buffers.stencil.setTest(!0),s.buffers.stencil.setOp(i.REPLACE,i.REPLACE,i.REPLACE),s.buffers.stencil.setFunc(i.ALWAYS,a,4294967295),s.buffers.stencil.setClear(l),s.buffers.stencil.setLocked(!0),e.setRenderTarget(r),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),s.buffers.color.setLocked(!1),s.buffers.depth.setLocked(!1),s.buffers.color.setMask(!0),s.buffers.depth.setMask(!0),s.buffers.stencil.setLocked(!1),s.buffers.stencil.setFunc(i.EQUAL,1,4294967295),s.buffers.stencil.setOp(i.KEEP,i.KEEP,i.KEEP),s.buffers.stencil.setLocked(!0)}}class OSe extends Pv{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class rD{constructor(e,t){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),t===void 0){const r=e.getSize(new nn);this._width=r.width,this._height=r.height,t=new bl(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:Ah}),t.texture.name="EffectComposer.rt1"}else this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new kSe(Xne),this.copyPass.material.blending=rp,this.clock=new Qm}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let r=!1;for(let i=0,s=this.passes.length;i<s;i++){const a=this.passes[i];if(a.enabled!==!1){if(a.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(i),a.render(this.renderer,this.writeBuffer,this.readBuffer,e,r),a.needsSwap){if(r){const l=this.renderer.getContext(),o=this.renderer.state.buffers.stencil;o.setFunc(l.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),o.setFunc(l.EQUAL,1,4294967295)}this.swapBuffers()}eX!==void 0&&(a instanceof eX?r=!0:a instanceof OSe&&(r=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new nn);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const r=this._width*this._pixelRatio,i=this._height*this._pixelRatio;this.renderTarget1.setSize(r,i),this.renderTarget2.setSize(r,i);for(let s=0;s<this.passes.length;s++)this.passes[s].setSize(r,i)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}const FSe={uniforms:{tDiffuse:{value:null},tDisp:{value:null},byp:{value:0},amount:{value:.08},angle:{value:.02},seed:{value:.02},seed_x:{value:.02},seed_y:{value:.02},distortion_x:{value:.5},distortion_y:{value:.6},col_s:{value:.05}},vertexShader:`

		varying vec2 vUv;
		void main() {
			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
		}`,fragmentShader:`

		uniform int byp; //should we apply the glitch ?

		uniform sampler2D tDiffuse;
		uniform sampler2D tDisp;

		uniform float amount;
		uniform float angle;
		uniform float seed;
		uniform float seed_x;
		uniform float seed_y;
		uniform float distortion_x;
		uniform float distortion_y;
		uniform float col_s;

		varying vec2 vUv;


		float rand(vec2 co){
			return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
		}

		void main() {
			if(byp<1) {
				vec2 p = vUv;
				float xs = floor(gl_FragCoord.x / 0.5);
				float ys = floor(gl_FragCoord.y / 0.5);
				//based on staffantans glitch shader for unity https://github.com/staffantan/unityglitch
				float disp = texture2D(tDisp, p*seed*seed).r;
				if(p.y<distortion_x+col_s && p.y>distortion_x-col_s*seed) {
					if(seed_x>0.){
						p.y = 1. - (p.y + distortion_y);
					}
					else {
						p.y = distortion_y;
					}
				}
				if(p.x<distortion_y+col_s && p.x>distortion_y-col_s*seed) {
					if(seed_y>0.){
						p.x=distortion_x;
					}
					else {
						p.x = 1. - (p.x + distortion_x);
					}
				}
				p.x+=disp*seed_x*(seed/5.);
				p.y+=disp*seed_y*(seed/5.);
				//base from RGB shift shader
				vec2 offset = amount * vec2( cos(angle), sin(angle));
				vec4 cr = texture2D(tDiffuse, p + offset);
				vec4 cga = texture2D(tDiffuse, p);
				vec4 cb = texture2D(tDiffuse, p - offset);
				gl_FragColor = vec4(cr.r, cga.g, cb.b, cga.a);
				//add noise
				vec4 snow = 200.*amount*vec4(rand(vec2(xs * seed,ys * seed*50.))*0.2);
				gl_FragColor = gl_FragColor+ snow;
			}
			else {
				gl_FragColor=texture2D (tDiffuse, vUv);
			}
		}`};class NSe extends Pv{constructor(e=64){super();const t=FSe;this.uniforms=Gm.clone(t.uniforms),this.heightMap=this.generateHeightmap(e),this.uniforms.tDisp.value=this.heightMap,this.material=new Eo({uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader}),this.fsQuad=new $T(this.material),this.goWild=!1,this.curF=0,this.generateTrigger()}render(e,t,r){this.uniforms.tDiffuse.value=r.texture,this.uniforms.seed.value=Math.random(),this.uniforms.byp.value=0,this.curF%this.randX==0||this.goWild==!0?(this.uniforms.amount.value=Math.random()/30,this.uniforms.angle.value=to.randFloat(-Math.PI,Math.PI),this.uniforms.seed_x.value=to.randFloat(-1,1),this.uniforms.seed_y.value=to.randFloat(-1,1),this.uniforms.distortion_x.value=to.randFloat(0,1),this.uniforms.distortion_y.value=to.randFloat(0,1),this.curF=0,this.generateTrigger()):this.curF%this.randX<this.randX/5?(this.uniforms.amount.value=Math.random()/90,this.uniforms.angle.value=to.randFloat(-Math.PI,Math.PI),this.uniforms.distortion_x.value=to.randFloat(0,1),this.uniforms.distortion_y.value=to.randFloat(0,1),this.uniforms.seed_x.value=to.randFloat(-.3,.3),this.uniforms.seed_y.value=to.randFloat(-.3,.3)):this.goWild==!1&&(this.uniforms.byp.value=1),this.curF++,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(),this.fsQuad.render(e))}generateTrigger(){this.randX=to.randInt(120,240)}generateHeightmap(e){const t=new Float32Array(e*e),r=e*e;for(let s=0;s<r;s++){const a=to.randFloat(0,1);t[s]=a}const i=new jf(t,e,e,ET,Sc);return i.needsUpdate=!0,i}dispose(){this.material.dispose(),this.heightMap.dispose(),this.fsQuad.dispose()}}class iD extends Pv{constructor(e,t,r=null,i=null,s=null){super(),this.scene=e,this.camera=t,this.overrideMaterial=r,this.clearColor=i,this.clearAlpha=s,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new Gn}render(e,t,r){const i=e.autoClear;e.autoClear=!1;let s,a;this.overrideMaterial!==null&&(a=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor!==null&&(e.getClearColor(this._oldClearColor),e.setClearColor(this.clearColor,e.getClearAlpha())),this.clearAlpha!==null&&(s=e.getClearAlpha(),e.setClearAlpha(this.clearAlpha)),this.clearDepth==!0&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:r),this.clear===!0&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor!==null&&e.setClearColor(this._oldClearColor),this.clearAlpha!==null&&e.setClearAlpha(s),this.overrideMaterial!==null&&(this.scene.overrideMaterial=a),e.autoClear=i}}function zSe(n,e=!1){const t=n[0].index!==null,r=new Set(Object.keys(n[0].attributes)),i=new Set(Object.keys(n[0].morphAttributes)),s={},a={},l=n[0].morphTargetsRelative,o=new $r;let h=0;for(let d=0;d<n.length;++d){const m=n[d];let _=0;if(t!==(m.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+d+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const y in m.attributes){if(!r.has(y))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+d+'. All geometries must have compatible attributes; make sure "'+y+'" attribute exists among all geometries, or in none of them.'),null;s[y]===void 0&&(s[y]=[]),s[y].push(m.attributes[y]),_++}if(_!==r.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+d+". Make sure all geometries have the same number of attributes."),null;if(l!==m.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+d+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const y in m.morphAttributes){if(!i.has(y))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+d+".  .morphAttributes must be consistent throughout all geometries."),null;a[y]===void 0&&(a[y]=[]),a[y].push(m.morphAttributes[y])}if(e){let y;if(t)y=m.index.count;else if(m.attributes.position!==void 0)y=m.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+d+". The geometry must have either an index or a position attribute"),null;o.addGroup(h,y,d),h+=y}}if(t){let d=0;const m=[];for(let _=0;_<n.length;++_){const y=n[_].index;for(let T=0;T<y.count;++T)m.push(y.getX(T)+d);d+=n[_].attributes.position.count}o.setIndex(m)}for(const d in s){const m=tX(s[d]);if(!m)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+d+" attribute."),null;o.setAttribute(d,m)}for(const d in a){const m=a[d][0].length;if(m===0)break;o.morphAttributes=o.morphAttributes||{},o.morphAttributes[d]=[];for(let _=0;_<m;++_){const y=[];for(let I=0;I<a[d].length;++I)y.push(a[d][I][_]);const T=tX(y);if(!T)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+d+" morphAttribute."),null;o.morphAttributes[d].push(T)}}return o}function tX(n){let e,t,r,i=-1,s=0;for(let h=0;h<n.length;++h){const d=n[h];if(e===void 0&&(e=d.array.constructor),e!==d.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(t===void 0&&(t=d.itemSize),t!==d.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(r===void 0&&(r=d.normalized),r!==d.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;if(i===-1&&(i=d.gpuType),i!==d.gpuType)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes."),null;s+=d.count*t}const a=new e(s),l=new Di(a,t,r);let o=0;for(let h=0;h<n.length;++h){const d=n[h];if(d.isInterleavedBufferAttribute){const m=o/t;for(let _=0,y=d.count;_<y;_++)for(let T=0;T<t;T++){const I=d.getComponent(_,T);l.setComponent(_+m,T,I)}}else a.set(d.array,o);o+=d.count*t}return i!==void 0&&(l.gpuType=i),l}function nX(n,e){if(e===c6)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),n;if(e===qy||e===RT){let t=n.getIndex();if(t===null){const a=[],l=n.getAttribute("position");if(l!==void 0){for(let o=0;o<l.count;o++)a.push(o);n.setIndex(a),t=n.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),n}const r=t.count-2,i=[];if(e===qy)for(let a=1;a<=r;a++)i.push(t.getX(0)),i.push(t.getX(a)),i.push(t.getX(a+1));else for(let a=0;a<r;a++)a%2===0?(i.push(t.getX(a)),i.push(t.getX(a+1)),i.push(t.getX(a+2))):(i.push(t.getX(a+2)),i.push(t.getX(a+1)),i.push(t.getX(a)));i.length/3!==r&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=n.clone();return s.setIndex(i),s.clearGroups(),s}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),n}const USe={1:"月",2:"火",3:"水",4:"木",5:"金",6:"土",7:"日"},X5=["太空里很暖和，像小主人抱我的温度，37.5℃","不要换台，不要走开，星际直播马上回来","爱，就是组成我的元件","人类对孤独的理解是有限的，对爱的诠释是无限的","我会飞得更高","我的一小步，见证友谊的一大步","释放我热烈的爱","呵，你咋不上天呢","比机器人更爱机器，比宇航员更爱宇航，这是种严肃的自我认知","把你送回太空好吗","用整个灵魂向你比心","再渺小的心愿，银河系都有它的容身之所","Yeah，放飞自我","地球生存，hard模式"],VSe=[{value:5024.33,desc:"Distance"},{value:"0.22245%",desc:"oxygen level"},{value:205.24,desc:"Temperature"}],GSe={backgroundColor:"transparent",color:["#03c03c","#00e6f6","#8ae66e","#ff013c","#f9f002"],textStyle:{color:"#f9f002"},title:{text:"Kepler-90 Planetary System",textStyle:{color:"#f9f002",fontWeight:"normal"}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0,borderColor:"#f9f002",show:!0},xAxis:[{type:"category",boundaryGap:!1,data:["90a","90b","90c","90i","90s","90v","90z"],color:"#f9f002"}],yAxis:[{type:"value",color:"#f9f002"}],series:[{name:"Email",type:"line",stack:"Total",emphasis:{focus:"series"},data:[120,132,101,134,90,230,210],showSymbol:!1},{name:"Union Ads",type:"line",stack:"Total",areaStyle:{},emphasis:{focus:"series"},data:[220,182,191,234,290,330,310]},{name:"Video Ads",type:"line",stack:"Total",areaStyle:{},emphasis:{focus:"series"},data:[150,232,201,154,190,330,410]},{name:"Direct",type:"line",stack:"Total",areaStyle:{},emphasis:{focus:"series"},data:[320,332,301,334,390,330,320]},{name:"Search Engine",type:"line",stack:"Total",label:{show:!0,position:"top"},areaStyle:{},emphasis:{focus:"series"},data:[820,932,901,934,1290,1330,2400]}]},HSe={backgroundColor:"transparent",color:["#000000","#00e6f6","#8ae66e","#ff013c"],textStyle:{color:"#000000"},series:[{name:"Kepler-90 Planetary system",type:"pie",radius:[25,100],center:["50%","50%"],roseType:"area",itemStyle:{borderRadius:4},data:[{value:40,name:"Kepler-90a"},{value:38,name:"Kepler-90b"},{value:32,name:"Kepler-90c"},{value:30,name:"Kepler-90i"},{value:28,name:"Kepler-90m"},{value:26,name:"Kepler-90s"},{value:22,name:"Kepler-90t"},{value:18,name:"Kepler-90z"}],label:{color:"#000000"}}]},jSe={backgroundColor:"transparent",color:["#f9f002","#00e6f6","#8ae66e","#ff013c"],dataset:{source:[["product","2012","2013","2014","2015","2016","2017"],["90a",86.5,92.1,85.7,83.1,73.4,55.1],["90i",41.1,30.4,65.1,53.3,83.8,98.7],["90t",24.1,67.2,79.5,86.4,65.2,82.5],["90z",55.2,67.1,69.2,72.4,53.9,39.1]]},series:[{type:"pie",radius:"20%",center:["25%","30%"],encode:{itemName:"product",value:"2012"},label:{color:"#f9f002"}},{type:"pie",radius:"20%",center:["75%","30%"],encode:{itemName:"product",value:"2013"},label:{color:"#f9f002"}},{type:"pie",radius:"20%",center:["25%","75%"],encode:{itemName:"product",value:"2014"},label:{color:"#f9f002"}},{type:"pie",radius:"20%",center:["75%","75%"],encode:{itemName:"product",value:"2015"},label:{color:"#f9f002"}}]},WSe={backgroundColor:"transparent",color:["#000000","#00e6f6","#8ae66e","#ff013c"],textStyle:{color:"#f9f002"},radiusAxis:{type:"category",data:["v","w","x","y","z"],z:10},angleAxis:{max:2,startAngle:30,splitLine:{show:!1}},polar:{},series:[{type:"bar",data:[4,3,2,1,0],coordinateSystem:"polar",name:"Without Round Cap",itemStyle:{borderColor:"red",opacity:.8,borderWidth:1}},{type:"bar",data:[4,3,2,1,0],coordinateSystem:"polar",name:"With Round Cap",roundCap:!0,itemStyle:{borderColor:"green",opacity:.8,borderWidth:1}}]},XSe={backgroundColor:"transparent",textStyle:{color:"#000000"},title:{text:"Cyberpunk 2077 Fantastic",textStyle:{color:"#000000"}},color:["#80FFA5","#00DDFF","#37A2FF","#FF0087","#FFBF00"],tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:[{type:"category",boundaryGap:!1,data:["90a","90b","90c","90i","90s","90v","90z"]}],yAxis:[{type:"value"}],series:[{name:"Line 1",type:"line",stack:"Total",smooth:!0,lineStyle:{width:0},showSymbol:!1,areaStyle:{opacity:.8,color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgb(128, 255, 165)"},{offset:1,color:"rgb(1, 191, 236)"}]}},emphasis:{focus:"series"},data:[140,232,101,264,90,340,250]},{name:"Line 2",type:"line",stack:"Total",smooth:!0,lineStyle:{width:0},showSymbol:!1,areaStyle:{opacity:.8,color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgb(0, 221, 255)"},{offset:1,color:"rgb(77, 119, 255)"}]}},emphasis:{focus:"series"},data:[120,282,111,234,220,340,310]},{name:"Line 3",type:"line",stack:"Total",smooth:!0,lineStyle:{width:0},showSymbol:!1,areaStyle:{opacity:.8,color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgb(55, 162, 255)"},{offset:1,color:"rgb(116, 21, 219)"}]}},emphasis:{focus:"series"},data:[320,132,201,334,190,130,220]},{name:"Line 4",type:"line",stack:"Total",smooth:!0,lineStyle:{width:0},showSymbol:!1,areaStyle:{opacity:.8,color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgb(255, 0, 135)"},{offset:1,color:"rgb(135, 0, 157)"}]}},emphasis:{focus:"series"},data:[220,402,231,134,190,230,120]},{name:"Line 5",type:"line",stack:"Total",smooth:!0,lineStyle:{width:0},showSymbol:!1,label:{show:!0,position:"top"},areaStyle:{opacity:.8,color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgb(255, 191, 0)"},{offset:1,color:"rgb(224, 62, 76)"}]}},emphasis:{focus:"series"},data:[220,302,181,234,210,290,150]}]},$Se=""+new URL("earth-BrwlGRgR.jpg",import.meta.url).href;var qSe=`precision mediump float;\r
uniform float actionRatio;\r
uniform float lineLength;\r
uniform vec3 diffuse;\r
uniform float opacity;\r
uniform float dashSize;\r
uniform float totalSize;\r
varying float vLineDistance;

#include <clipping_planes_pars_fragment>\r
#include <color_pars_fragment>\r
#include <common>\r
#include <fog_pars_fragment>\r
#include <logdepthbuf_pars_fragment>

vec3 linearTosRGB(vec3 color) { return pow(color, vec3(1.0 / 2.2)); }

vec3 gammaCorrect(vec3 color) {\r
  const float gamma = 2.2;\r
  return pow(color, vec3(1.0 / gamma));\r
}

void main() {\r
#include <clipping_planes_fragment>

  float halfDash = dashSize * 0.5;\r
  float currPos = (lineLength + dashSize) * actionRatio;\r
  float d = (vLineDistance + halfDash) - currPos;\r
  if (abs(d) > halfDash)\r
    discard; 

  float grad = ((vLineDistance + halfDash) - (currPos - halfDash)) / halfDash;\r
  vec3 outgoingLight = vec3(0.0);\r
  vec4 diffuseColor = vec4(diffuse, grad);\r
  
  
  
  gl_FragColor = diffuseColor;

#include <color_fragment>

#include <fog_fragment>\r
#include <logdepthbuf_fragment>

#include <premultiplied_alpha_fragment>\r
#include <tonemapping_fragment>\r
}`;/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var vF=function(n,e){return vF=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])},vF(n,e)};function Hn(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");vF(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var ZSe=function(){function n(){this.firefox=!1,this.ie=!1,this.edge=!1,this.newEdge=!1,this.weChat=!1}return n}(),YSe=function(){function n(){this.browser=new ZSe,this.node=!1,this.wxa=!1,this.worker=!1,this.svgSupported=!1,this.touchEventsSupported=!1,this.pointerEventsSupported=!1,this.domSupported=!1,this.transformSupported=!1,this.transform3dSupported=!1,this.hasGlobalWindow=typeof window<"u"}return n}(),pi=new YSe;typeof wx=="object"&&typeof wx.getSystemInfoSync=="function"?(pi.wxa=!0,pi.touchEventsSupported=!0):typeof document>"u"&&typeof self<"u"?pi.worker=!0:typeof navigator>"u"||navigator.userAgent.indexOf("Node.js")===0?(pi.node=!0,pi.svgSupported=!0):KSe(navigator.userAgent,pi);function KSe(n,e){var t=e.browser,r=n.match(/Firefox\/([\d.]+)/),i=n.match(/MSIE\s([\d.]+)/)||n.match(/Trident\/.+?rv:(([\d.]+))/),s=n.match(/Edge?\/([\d.]+)/),a=/micromessenger/i.test(n);r&&(t.firefox=!0,t.version=r[1]),i&&(t.ie=!0,t.version=i[1]),s&&(t.edge=!0,t.version=s[1],t.newEdge=+s[1].split(".")[0]>18),a&&(t.weChat=!0),e.svgSupported=typeof SVGRect<"u",e.touchEventsSupported="ontouchstart"in window&&!t.ie&&!t.edge,e.pointerEventsSupported="onpointerdown"in window&&(t.edge||t.ie&&+t.version>=11),e.domSupported=typeof document<"u";var l=document.documentElement.style;e.transform3dSupported=(t.ie&&"transition"in l||t.edge||"WebKitCSSMatrix"in window&&"m11"in new WebKitCSSMatrix||"MozPerspective"in l)&&!("OTransition"in l),e.transformSupported=e.transform3dSupported||t.ie&&+t.version>=9}var q6=12,JSe="sans-serif",Jy=q6+"px "+JSe,QSe=20,eAe=100,tAe="007LLmW'55;N0500LLLLLLLLLL00NNNLzWW\\\\WQb\\0FWLg\\bWb\\WQ\\WrWWQ000CL5LLFLL0LL**F*gLLLL5F0LF\\FFF5.5N";function nAe(n){var e={};if(typeof JSON>"u")return e;for(var t=0;t<n.length;t++){var r=String.fromCharCode(t+32),i=(n.charCodeAt(t)-QSe)/eAe;e[r]=i}return e}var rAe=nAe(tAe),gw={createCanvas:function(){return typeof document<"u"&&document.createElement("canvas")},measureText:function(){var n,e;return function(t,r){if(!n){var i=gw.createCanvas();n=i&&i.getContext("2d")}if(n)return e!==r&&(e=n.font=r||Jy),n.measureText(t);t=t||"",r=r||Jy;var s=/((?:\d+)?\.?\d*)px/.exec(r),a=s&&+s[1]||q6,l=0;if(r.indexOf("mono")>=0)l=a*t.length;else for(var o=0;o<t.length;o++){var h=rAe[t[o]];l+=h==null?a:h*a}return{width:l}}}(),loadImage:function(n,e,t){var r=new Image;return r.onload=e,r.onerror=t,r.src=n,r}},$ne=hv(["Function","RegExp","Date","Error","CanvasGradient","CanvasPattern","Image","Canvas"],function(n,e){return n["[object "+e+"]"]=!0,n},{}),qne=hv(["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64"],function(n,e){return n["[object "+e+"Array]"]=!0,n},{}),vw=Object.prototype.toString,sD=Array.prototype,iAe=sD.forEach,sAe=sD.filter,Z6=sD.slice,oAe=sD.map,rX=(function(){}).constructor,mE=rX?rX.prototype:null,Y6="__proto__",aAe=2311;function Zne(){return aAe++}function K6(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];typeof console<"u"&&console.error.apply(console,n)}function vi(n){if(n==null||typeof n!="object")return n;var e=n,t=vw.call(n);if(t==="[object Array]"){if(!$S(n)){e=[];for(var r=0,i=n.length;r<i;r++)e[r]=vi(n[r])}}else if(qne[t]){if(!$S(n)){var s=n.constructor;if(s.from)e=s.from(n);else{e=new s(n.length);for(var r=0,i=n.length;r<i;r++)e[r]=n[r]}}}else if(!$ne[t]&&!$S(n)&&!Yb(n)){e={};for(var a in n)n.hasOwnProperty(a)&&a!==Y6&&(e[a]=vi(n[a]))}return e}function Li(n,e,t){if(!Xr(e)||!Xr(n))return t?vi(e):n;for(var r in e)if(e.hasOwnProperty(r)&&r!==Y6){var i=n[r],s=e[r];Xr(s)&&Xr(i)&&!fr(s)&&!fr(i)&&!Yb(s)&&!Yb(i)&&!iX(s)&&!iX(i)&&!$S(s)&&!$S(i)?Li(i,s,t):(t||!(r in n))&&(n[r]=vi(e[r]))}return n}function Jn(n,e){if(Object.assign)Object.assign(n,e);else for(var t in e)e.hasOwnProperty(t)&&t!==Y6&&(n[t]=e[t]);return n}function ti(n,e,t){for(var r=io(e),i=0;i<r.length;i++){var s=r[i];n[s]==null&&(n[s]=e[s])}return n}function Wi(n,e){if(n){if(n.indexOf)return n.indexOf(e);for(var t=0,r=n.length;t<r;t++)if(n[t]===e)return t}return-1}function lAe(n,e){var t=n.prototype;function r(){}r.prototype=e.prototype,n.prototype=new r;for(var i in t)t.hasOwnProperty(i)&&(n.prototype[i]=t[i]);n.prototype.constructor=n,n.superClass=e}function nd(n,e,t){if(n="prototype"in n?n.prototype:n,e="prototype"in e?e.prototype:e,Object.getOwnPropertyNames)for(var r=Object.getOwnPropertyNames(e),i=0;i<r.length;i++){var s=r[i];s!=="constructor"&&n[s]==null&&(n[s]=e[s])}else ti(n,e)}function Ec(n){return!n||typeof n=="string"?!1:typeof n.length=="number"}function it(n,e,t){if(n&&e)if(n.forEach&&n.forEach===iAe)n.forEach(e,t);else if(n.length===+n.length)for(var r=0,i=n.length;r<i;r++)e.call(t,n[r],r,n);else for(var s in n)n.hasOwnProperty(s)&&e.call(t,n[s],s,n)}function xr(n,e,t){if(!n)return[];if(!e)return J6(n);if(n.map&&n.map===oAe)return n.map(e,t);for(var r=[],i=0,s=n.length;i<s;i++)r.push(e.call(t,n[i],i,n));return r}function hv(n,e,t,r){if(n&&e){for(var i=0,s=n.length;i<s;i++)t=e.call(r,t,n[i],i,n);return t}}function ta(n,e,t){if(!n)return[];if(!e)return J6(n);if(n.filter&&n.filter===sAe)return n.filter(e,t);for(var r=[],i=0,s=n.length;i<s;i++)e.call(t,n[i],i,n)&&r.push(n[i]);return r}function io(n){if(!n)return[];if(Object.keys)return Object.keys(n);var e=[];for(var t in n)n.hasOwnProperty(t)&&e.push(t);return e}function cAe(n,e){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];return function(){return n.apply(e,t.concat(Z6.call(arguments)))}}var Ns=mE&&li(mE.bind)?mE.call.bind(mE.bind):cAe;function ms(n){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];return function(){return n.apply(this,e.concat(Z6.call(arguments)))}}function fr(n){return Array.isArray?Array.isArray(n):vw.call(n)==="[object Array]"}function li(n){return typeof n=="function"}function Dr(n){return typeof n=="string"}function _F(n){return vw.call(n)==="[object String]"}function Is(n){return typeof n=="number"}function Xr(n){var e=typeof n;return e==="function"||!!n&&e==="object"}function iX(n){return!!$ne[vw.call(n)]}function hu(n){return!!qne[vw.call(n)]}function Yb(n){return typeof n=="object"&&typeof n.nodeType=="number"&&typeof n.ownerDocument=="object"}function oD(n){return n.colorStops!=null}function uAe(n){return n.image!=null}function hAe(n){return vw.call(n)==="[object RegExp]"}function oP(n){return n!==n}function qA(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];for(var t=0,r=n.length;t<r;t++)if(n[t]!=null)return n[t]}function Ci(n,e){return n??e}function XS(n,e,t){return n??e??t}function J6(n){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];return Z6.apply(n,e)}function Yne(n){if(typeof n=="number")return[n,n,n,n];var e=n.length;return e===2?[n[0],n[1],n[0],n[1]]:e===3?[n[0],n[1],n[2],n[1]]:n}function hp(n,e){if(!n)throw new Error(e)}function Jd(n){return n==null?null:typeof n.trim=="function"?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}var Kne="__ec_primitive__";function aP(n){n[Kne]=!0}function $S(n){return n[Kne]}var fAe=function(){function n(){this.data={}}return n.prototype.delete=function(e){var t=this.has(e);return t&&delete this.data[e],t},n.prototype.has=function(e){return this.data.hasOwnProperty(e)},n.prototype.get=function(e){return this.data[e]},n.prototype.set=function(e,t){return this.data[e]=t,this},n.prototype.keys=function(){return io(this.data)},n.prototype.forEach=function(e){var t=this.data;for(var r in t)t.hasOwnProperty(r)&&e(t[r],r)},n}(),Jne=typeof Map=="function";function dAe(){return Jne?new Map:new fAe}var pAe=function(){function n(e){var t=fr(e);this.data=dAe();var r=this;e instanceof n?e.each(i):e&&it(e,i);function i(s,a){t?r.set(s,a):r.set(a,s)}}return n.prototype.hasKey=function(e){return this.data.has(e)},n.prototype.get=function(e){return this.data.get(e)},n.prototype.set=function(e,t){return this.data.set(e,t),t},n.prototype.each=function(e,t){this.data.forEach(function(r,i){e.call(t,r,i)})},n.prototype.keys=function(){var e=this.data.keys();return Jne?Array.from(e):e},n.prototype.removeKey=function(e){this.data.delete(e)},n}();function ri(n){return new pAe(n)}function mAe(n,e){for(var t=new n.constructor(n.length+e.length),r=0;r<n.length;r++)t[r]=n[r];for(var i=n.length,r=0;r<e.length;r++)t[r+i]=e[r];return t}function aD(n,e){var t;if(Object.create)t=Object.create(n);else{var r=function(){};r.prototype=n,t=new r}return e&&Jn(t,e),t}function Qne(n){var e=n.style;e.webkitUserSelect="none",e.userSelect="none",e.webkitTapHighlightColor="rgba(0,0,0,0)",e["-webkit-touch-callout"]="none"}function $m(n,e){return n.hasOwnProperty(e)}function Cc(){}var gAe=180/Math.PI;function _w(n,e){return n==null&&(n=0),e==null&&(e=0),[n,e]}function vAe(n){return[n[0],n[1]]}function sX(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n}function _Ae(n,e,t){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n}function yAe(n){return Math.sqrt(xAe(n))}function xAe(n){return n[0]*n[0]+n[1]*n[1]}function $5(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n}function bAe(n,e){var t=yAe(e);return t===0?(n[0]=0,n[1]=0):(n[0]=e[0]/t,n[1]=e[1]/t),n}function yF(n,e){return Math.sqrt((n[0]-e[0])*(n[0]-e[0])+(n[1]-e[1])*(n[1]-e[1]))}var xF=yF;function wAe(n,e){return(n[0]-e[0])*(n[0]-e[0])+(n[1]-e[1])*(n[1]-e[1])}var Cb=wAe;function DI(n,e,t,r){return n[0]=e[0]+r*(t[0]-e[0]),n[1]=e[1]+r*(t[1]-e[1]),n}function Th(n,e,t){var r=e[0],i=e[1];return n[0]=t[0]*r+t[2]*i+t[4],n[1]=t[1]*r+t[3]*i+t[5],n}function db(n,e,t){return n[0]=Math.min(e[0],t[0]),n[1]=Math.min(e[1],t[1]),n}function pb(n,e,t){return n[0]=Math.max(e[0],t[0]),n[1]=Math.max(e[1],t[1]),n}var b1=function(){function n(e,t){this.target=e,this.topTarget=t&&t.topTarget}return n}(),SAe=function(){function n(e){this.handler=e,e.on("mousedown",this._dragStart,this),e.on("mousemove",this._drag,this),e.on("mouseup",this._dragEnd,this)}return n.prototype._dragStart=function(e){for(var t=e.target;t&&!t.draggable;)t=t.parent||t.__hostTarget;t&&(this._draggingTarget=t,t.dragging=!0,this._x=e.offsetX,this._y=e.offsetY,this.handler.dispatchToElement(new b1(t,e),"dragstart",e.event))},n.prototype._drag=function(e){var t=this._draggingTarget;if(t){var r=e.offsetX,i=e.offsetY,s=r-this._x,a=i-this._y;this._x=r,this._y=i,t.drift(s,a,e),this.handler.dispatchToElement(new b1(t,e),"drag",e.event);var l=this.handler.findHover(r,i,t).target,o=this._dropTarget;this._dropTarget=l,t!==l&&(o&&l!==o&&this.handler.dispatchToElement(new b1(o,e),"dragleave",e.event),l&&l!==o&&this.handler.dispatchToElement(new b1(l,e),"dragenter",e.event))}},n.prototype._dragEnd=function(e){var t=this._draggingTarget;t&&(t.dragging=!1),this.handler.dispatchToElement(new b1(t,e),"dragend",e.event),this._dropTarget&&this.handler.dispatchToElement(new b1(this._dropTarget,e),"drop",e.event),this._draggingTarget=null,this._dropTarget=null},n}(),rd=function(){function n(e){e&&(this._$eventProcessor=e)}return n.prototype.on=function(e,t,r,i){this._$handlers||(this._$handlers={});var s=this._$handlers;if(typeof t=="function"&&(i=r,r=t,t=null),!r||!e)return this;var a=this._$eventProcessor;t!=null&&a&&a.normalizeQuery&&(t=a.normalizeQuery(t)),s[e]||(s[e]=[]);for(var l=0;l<s[e].length;l++)if(s[e][l].h===r)return this;var o={h:r,query:t,ctx:i||this,callAtLast:r.zrEventfulCallAtLast},h=s[e].length-1,d=s[e][h];return d&&d.callAtLast?s[e].splice(h,0,o):s[e].push(o),this},n.prototype.isSilent=function(e){var t=this._$handlers;return!t||!t[e]||!t[e].length},n.prototype.off=function(e,t){var r=this._$handlers;if(!r)return this;if(!e)return this._$handlers={},this;if(t){if(r[e]){for(var i=[],s=0,a=r[e].length;s<a;s++)r[e][s].h!==t&&i.push(r[e][s]);r[e]=i}r[e]&&r[e].length===0&&delete r[e]}else delete r[e];return this},n.prototype.trigger=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(!this._$handlers)return this;var i=this._$handlers[e],s=this._$eventProcessor;if(i)for(var a=t.length,l=i.length,o=0;o<l;o++){var h=i[o];if(!(s&&s.filter&&h.query!=null&&!s.filter(e,h.query)))switch(a){case 0:h.h.call(h.ctx);break;case 1:h.h.call(h.ctx,t[0]);break;case 2:h.h.call(h.ctx,t[0],t[1]);break;default:h.h.apply(h.ctx,t);break}}return s&&s.afterTrigger&&s.afterTrigger(e),this},n.prototype.triggerWithContext=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(!this._$handlers)return this;var i=this._$handlers[e],s=this._$eventProcessor;if(i)for(var a=t.length,l=t[a-1],o=i.length,h=0;h<o;h++){var d=i[h];if(!(s&&s.filter&&d.query!=null&&!s.filter(e,d.query)))switch(a){case 0:d.h.call(l);break;case 1:d.h.call(l,t[0]);break;case 2:d.h.call(l,t[0],t[1]);break;default:d.h.apply(l,t.slice(1,a-1));break}}return s&&s.afterTrigger&&s.afterTrigger(e),this},n}(),AAe=Math.log(2);function bF(n,e,t,r,i,s){var a=r+"-"+i,l=n.length;if(s.hasOwnProperty(a))return s[a];if(e===1){var o=Math.round(Math.log((1<<l)-1&~i)/AAe);return n[t][o]}for(var h=r|1<<t,d=t+1;r&1<<d;)d++;for(var m=0,_=0,y=0;_<l;_++){var T=1<<_;T&i||(m+=(y%2?-1:1)*n[t][_]*bF(n,e-1,d,h,i|T,s),y++)}return s[a]=m,m}function oX(n,e){var t=[[n[0],n[1],1,0,0,0,-e[0]*n[0],-e[0]*n[1]],[0,0,0,n[0],n[1],1,-e[1]*n[0],-e[1]*n[1]],[n[2],n[3],1,0,0,0,-e[2]*n[2],-e[2]*n[3]],[0,0,0,n[2],n[3],1,-e[3]*n[2],-e[3]*n[3]],[n[4],n[5],1,0,0,0,-e[4]*n[4],-e[4]*n[5]],[0,0,0,n[4],n[5],1,-e[5]*n[4],-e[5]*n[5]],[n[6],n[7],1,0,0,0,-e[6]*n[6],-e[6]*n[7]],[0,0,0,n[6],n[7],1,-e[7]*n[6],-e[7]*n[7]]],r={},i=bF(t,8,0,0,0,r);if(i!==0){for(var s=[],a=0;a<8;a++)for(var l=0;l<8;l++)s[l]==null&&(s[l]=0),s[l]+=((a+l)%2?-1:1)*bF(t,7,a===0?1:0,1<<a,1<<l,r)/i*e[a];return function(o,h,d){var m=h*s[6]+d*s[7]+1;o[0]=(h*s[0]+d*s[1]+s[2])/m,o[1]=(h*s[3]+d*s[4]+s[5])/m}}}var aX="___zrEVENTSAVED",q5=[];function TAe(n,e,t,r,i){return wF(q5,e,r,i,!0)&&wF(n,t,q5[0],q5[1])}function wF(n,e,t,r,i){if(e.getBoundingClientRect&&pi.domSupported&&!ere(e)){var s=e[aX]||(e[aX]={}),a=MAe(e,s),l=CAe(a,s,i);if(l)return l(n,t,r),!0}return!1}function MAe(n,e){var t=e.markers;if(t)return t;t=e.markers=[];for(var r=["left","right"],i=["top","bottom"],s=0;s<4;s++){var a=document.createElement("div"),l=a.style,o=s%2,h=(s>>1)%2;l.cssText=["position: absolute","visibility: hidden","padding: 0","margin: 0","border-width: 0","user-select: none","width:0","height:0",r[o]+":0",i[h]+":0",r[1-o]+":auto",i[1-h]+":auto",""].join("!important;"),n.appendChild(a),t.push(a)}return t}function CAe(n,e,t){for(var r=t?"invTrans":"trans",i=e[r],s=e.srcCoords,a=[],l=[],o=!0,h=0;h<4;h++){var d=n[h].getBoundingClientRect(),m=2*h,_=d.left,y=d.top;a.push(_,y),o=o&&s&&_===s[m]&&y===s[m+1],l.push(n[h].offsetLeft,n[h].offsetTop)}return o&&i?i:(e.srcCoords=a,e[r]=t?oX(l,a):oX(a,l))}function ere(n){return n.nodeName.toUpperCase()==="CANVAS"}var EAe=/([&<>"'])/g,IAe={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function Eu(n){return n==null?"":(n+"").replace(EAe,function(e,t){return IAe[t]})}var RAe=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,Z5=[],PAe=pi.browser.firefox&&+pi.browser.version.split(".")[0]<39;function SF(n,e,t,r){return t=t||{},r?lX(n,e,t):PAe&&e.layerX!=null&&e.layerX!==e.offsetX?(t.zrX=e.layerX,t.zrY=e.layerY):e.offsetX!=null?(t.zrX=e.offsetX,t.zrY=e.offsetY):lX(n,e,t),t}function lX(n,e,t){if(pi.domSupported&&n.getBoundingClientRect){var r=e.clientX,i=e.clientY;if(ere(n)){var s=n.getBoundingClientRect();t.zrX=r-s.left,t.zrY=i-s.top;return}else if(wF(Z5,n,r,i)){t.zrX=Z5[0],t.zrY=Z5[1];return}}t.zrX=t.zrY=0}function Q6(n){return n||window.event}function hh(n,e,t){if(e=Q6(e),e.zrX!=null)return e;var r=e.type,i=r&&r.indexOf("touch")>=0;if(i){var a=r!=="touchend"?e.targetTouches[0]:e.changedTouches[0];a&&SF(n,a,e,t)}else{SF(n,e,e,t);var s=LAe(e);e.zrDelta=s?s/120:-(e.detail||0)/3}var l=e.button;return e.which==null&&l!==void 0&&RAe.test(e.type)&&(e.which=l&1?1:l&2?3:l&4?2:0),e}function LAe(n){var e=n.wheelDelta;if(e)return e;var t=n.deltaX,r=n.deltaY;if(t==null||r==null)return e;var i=Math.abs(r!==0?r:t),s=r>0?-1:r<0?1:t>0?-1:1;return 3*i*s}function AF(n,e,t,r){n.addEventListener(e,t,r)}function DAe(n,e,t,r){n.removeEventListener(e,t,r)}var tre=function(n){n.preventDefault(),n.stopPropagation(),n.cancelBubble=!0},BAe=function(){function n(){this._track=[]}return n.prototype.recognize=function(e,t,r){return this._doTrack(e,t,r),this._recognize(e)},n.prototype.clear=function(){return this._track.length=0,this},n.prototype._doTrack=function(e,t,r){var i=e.touches;if(i){for(var s={points:[],touches:[],target:t,event:e},a=0,l=i.length;a<l;a++){var o=i[a],h=SF(r,o,{});s.points.push([h.zrX,h.zrY]),s.touches.push(o)}this._track.push(s)}},n.prototype._recognize=function(e){for(var t in Y5)if(Y5.hasOwnProperty(t)){var r=Y5[t](this._track,e);if(r)return r}},n}();function cX(n){var e=n[1][0]-n[0][0],t=n[1][1]-n[0][1];return Math.sqrt(e*e+t*t)}function kAe(n){return[(n[0][0]+n[1][0])/2,(n[0][1]+n[1][1])/2]}var Y5={pinch:function(n,e){var t=n.length;if(t){var r=(n[t-1]||{}).points,i=(n[t-2]||{}).points||r;if(i&&i.length>1&&r&&r.length>1){var s=cX(r)/cX(i);!isFinite(s)&&(s=1),e.pinchScale=s;var a=kAe(r);return e.pinchX=a[0],e.pinchY=a[1],{type:"pinch",target:n[0].target,event:e}}}}};function Dy(){return[1,0,0,1,0,0]}function eU(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=1,n[4]=0,n[5]=0,n}function OAe(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n}function Eb(n,e,t){var r=e[0]*t[0]+e[2]*t[1],i=e[1]*t[0]+e[3]*t[1],s=e[0]*t[2]+e[2]*t[3],a=e[1]*t[2]+e[3]*t[3],l=e[0]*t[4]+e[2]*t[5]+e[4],o=e[1]*t[4]+e[3]*t[5]+e[5];return n[0]=r,n[1]=i,n[2]=s,n[3]=a,n[4]=l,n[5]=o,n}function lP(n,e,t){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4]+t[0],n[5]=e[5]+t[1],n}function lD(n,e,t,r){r===void 0&&(r=[0,0]);var i=e[0],s=e[2],a=e[4],l=e[1],o=e[3],h=e[5],d=Math.sin(t),m=Math.cos(t);return n[0]=i*m+l*d,n[1]=-i*d+l*m,n[2]=s*m+o*d,n[3]=-s*d+m*o,n[4]=m*(a-r[0])+d*(h-r[1])+r[0],n[5]=m*(h-r[1])-d*(a-r[0])+r[1],n}function FAe(n,e,t){var r=t[0],i=t[1];return n[0]=e[0]*r,n[1]=e[1]*i,n[2]=e[2]*r,n[3]=e[3]*i,n[4]=e[4]*r,n[5]=e[5]*i,n}function cD(n,e){var t=e[0],r=e[2],i=e[4],s=e[1],a=e[3],l=e[5],o=t*a-s*r;return o?(o=1/o,n[0]=a*o,n[1]=-s*o,n[2]=-r*o,n[3]=t*o,n[4]=(r*l-a*i)*o,n[5]=(s*i-t*l)*o,n):null}var Jr=function(){function n(e,t){this.x=e||0,this.y=t||0}return n.prototype.copy=function(e){return this.x=e.x,this.y=e.y,this},n.prototype.clone=function(){return new n(this.x,this.y)},n.prototype.set=function(e,t){return this.x=e,this.y=t,this},n.prototype.equal=function(e){return e.x===this.x&&e.y===this.y},n.prototype.add=function(e){return this.x+=e.x,this.y+=e.y,this},n.prototype.scale=function(e){this.x*=e,this.y*=e},n.prototype.scaleAndAdd=function(e,t){this.x+=e.x*t,this.y+=e.y*t},n.prototype.sub=function(e){return this.x-=e.x,this.y-=e.y,this},n.prototype.dot=function(e){return this.x*e.x+this.y*e.y},n.prototype.len=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},n.prototype.lenSquare=function(){return this.x*this.x+this.y*this.y},n.prototype.normalize=function(){var e=this.len();return this.x/=e,this.y/=e,this},n.prototype.distance=function(e){var t=this.x-e.x,r=this.y-e.y;return Math.sqrt(t*t+r*r)},n.prototype.distanceSquare=function(e){var t=this.x-e.x,r=this.y-e.y;return t*t+r*r},n.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},n.prototype.transform=function(e){if(e){var t=this.x,r=this.y;return this.x=e[0]*t+e[2]*r+e[4],this.y=e[1]*t+e[3]*r+e[5],this}},n.prototype.toArray=function(e){return e[0]=this.x,e[1]=this.y,e},n.prototype.fromArray=function(e){this.x=e[0],this.y=e[1]},n.set=function(e,t,r){e.x=t,e.y=r},n.copy=function(e,t){e.x=t.x,e.y=t.y},n.len=function(e){return Math.sqrt(e.x*e.x+e.y*e.y)},n.lenSquare=function(e){return e.x*e.x+e.y*e.y},n.dot=function(e,t){return e.x*t.x+e.y*t.y},n.add=function(e,t,r){e.x=t.x+r.x,e.y=t.y+r.y},n.sub=function(e,t,r){e.x=t.x-r.x,e.y=t.y-r.y},n.scale=function(e,t,r){e.x=t.x*r,e.y=t.y*r},n.scaleAndAdd=function(e,t,r,i){e.x=t.x+r.x*i,e.y=t.y+r.y*i},n.lerp=function(e,t,r,i){var s=1-i;e.x=s*t.x+i*r.x,e.y=s*t.y+i*r.y},n}(),gE=Math.min,vE=Math.max,E_=new Jr,I_=new Jr,R_=new Jr,P_=new Jr,B2=new Jr,k2=new Jr,NAe=function(){function n(e,t,r,i){r<0&&(e=e+r,r=-r),i<0&&(t=t+i,i=-i),this.x=e,this.y=t,this.width=r,this.height=i}return n.prototype.union=function(e){var t=gE(e.x,this.x),r=gE(e.y,this.y);isFinite(this.x)&&isFinite(this.width)?this.width=vE(e.x+e.width,this.x+this.width)-t:this.width=e.width,isFinite(this.y)&&isFinite(this.height)?this.height=vE(e.y+e.height,this.y+this.height)-r:this.height=e.height,this.x=t,this.y=r},n.prototype.applyTransform=function(e){n.applyTransform(this,this,e)},n.prototype.calculateTransform=function(e){var t=this,r=e.width/t.width,i=e.height/t.height,s=Dy();return lP(s,s,[-t.x,-t.y]),FAe(s,s,[r,i]),lP(s,s,[e.x,e.y]),s},n.prototype.intersect=function(e,t){if(!e)return!1;e instanceof n||(e=n.create(e));var r=this,i=r.x,s=r.x+r.width,a=r.y,l=r.y+r.height,o=e.x,h=e.x+e.width,d=e.y,m=e.y+e.height,_=!(s<o||h<i||l<d||m<a);if(t){var y=1/0,T=0,I=Math.abs(s-o),C=Math.abs(h-i),M=Math.abs(l-d),B=Math.abs(m-a),k=Math.min(I,C),j=Math.min(M,B);s<o||h<i?k>T&&(T=k,I<C?Jr.set(k2,-I,0):Jr.set(k2,C,0)):k<y&&(y=k,I<C?Jr.set(B2,I,0):Jr.set(B2,-C,0)),l<d||m<a?j>T&&(T=j,M<B?Jr.set(k2,0,-M):Jr.set(k2,0,B)):k<y&&(y=k,M<B?Jr.set(B2,0,M):Jr.set(B2,0,-B))}return t&&Jr.copy(t,_?B2:k2),_},n.prototype.contain=function(e,t){var r=this;return e>=r.x&&e<=r.x+r.width&&t>=r.y&&t<=r.y+r.height},n.prototype.clone=function(){return new n(this.x,this.y,this.width,this.height)},n.prototype.copy=function(e){n.copy(this,e)},n.prototype.plain=function(){return{x:this.x,y:this.y,width:this.width,height:this.height}},n.prototype.isFinite=function(){return isFinite(this.x)&&isFinite(this.y)&&isFinite(this.width)&&isFinite(this.height)},n.prototype.isZero=function(){return this.width===0||this.height===0},n.create=function(e){return new n(e.x,e.y,e.width,e.height)},n.copy=function(e,t){e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height},n.applyTransform=function(e,t,r){if(!r){e!==t&&n.copy(e,t);return}if(r[1]<1e-5&&r[1]>-1e-5&&r[2]<1e-5&&r[2]>-1e-5){var i=r[0],s=r[3],a=r[4],l=r[5];e.x=t.x*i+a,e.y=t.y*s+l,e.width=t.width*i,e.height=t.height*s,e.width<0&&(e.x+=e.width,e.width=-e.width),e.height<0&&(e.y+=e.height,e.height=-e.height);return}E_.x=R_.x=t.x,E_.y=P_.y=t.y,I_.x=P_.x=t.x+t.width,I_.y=R_.y=t.y+t.height,E_.transform(r),P_.transform(r),I_.transform(r),R_.transform(r),e.x=gE(E_.x,I_.x,R_.x,P_.x),e.y=gE(E_.y,I_.y,R_.y,P_.y);var o=vE(E_.x,I_.x,R_.x,P_.x),h=vE(E_.y,I_.y,R_.y,P_.y);e.width=o-e.x,e.height=h-e.y},n}();const as=NAe;var nre="silent";function zAe(n,e,t){return{type:n,event:t,target:e.target,topTarget:e.topTarget,cancelBubble:!1,offsetX:t.zrX,offsetY:t.zrY,gestureEvent:t.gestureEvent,pinchX:t.pinchX,pinchY:t.pinchY,pinchScale:t.pinchScale,wheelDelta:t.zrDelta,zrByTouch:t.zrByTouch,which:t.which,stop:UAe}}function UAe(){tre(this.event)}var VAe=function(n){Hn(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.handler=null,t}return e.prototype.dispose=function(){},e.prototype.setCursor=function(){},e}(rd),O2=function(){function n(e,t){this.x=e,this.y=t}return n}(),GAe=["click","dblclick","mousewheel","mouseout","mouseup","mousedown","mousemove","contextmenu"],K5=new as(0,0,0,0),rre=function(n){Hn(e,n);function e(t,r,i,s,a){var l=n.call(this)||this;return l._hovered=new O2(0,0),l.storage=t,l.painter=r,l.painterRoot=s,l._pointerSize=a,i=i||new VAe,l.proxy=null,l.setHandlerProxy(i),l._draggingMgr=new SAe(l),l}return e.prototype.setHandlerProxy=function(t){this.proxy&&this.proxy.dispose(),t&&(it(GAe,function(r){t.on&&t.on(r,this[r],this)},this),t.handler=this),this.proxy=t},e.prototype.mousemove=function(t){var r=t.zrX,i=t.zrY,s=ire(this,r,i),a=this._hovered,l=a.target;l&&!l.__zr&&(a=this.findHover(a.x,a.y),l=a.target);var o=this._hovered=s?new O2(r,i):this.findHover(r,i),h=o.target,d=this.proxy;d.setCursor&&d.setCursor(h?h.cursor:"default"),l&&h!==l&&this.dispatchToElement(a,"mouseout",t),this.dispatchToElement(o,"mousemove",t),h&&h!==l&&this.dispatchToElement(o,"mouseover",t)},e.prototype.mouseout=function(t){var r=t.zrEventControl;r!=="only_globalout"&&this.dispatchToElement(this._hovered,"mouseout",t),r!=="no_globalout"&&this.trigger("globalout",{type:"globalout",event:t})},e.prototype.resize=function(){this._hovered=new O2(0,0)},e.prototype.dispatch=function(t,r){var i=this[t];i&&i.call(this,r)},e.prototype.dispose=function(){this.proxy.dispose(),this.storage=null,this.proxy=null,this.painter=null},e.prototype.setCursorStyle=function(t){var r=this.proxy;r.setCursor&&r.setCursor(t)},e.prototype.dispatchToElement=function(t,r,i){t=t||{};var s=t.target;if(!(s&&s.silent)){for(var a="on"+r,l=zAe(r,t,i);s&&(s[a]&&(l.cancelBubble=!!s[a].call(s,l)),s.trigger(r,l),s=s.__hostTarget?s.__hostTarget:s.parent,!l.cancelBubble););l.cancelBubble||(this.trigger(r,l),this.painter&&this.painter.eachOtherLayer&&this.painter.eachOtherLayer(function(o){typeof o[a]=="function"&&o[a].call(o,l),o.trigger&&o.trigger(r,l)}))}},e.prototype.findHover=function(t,r,i){var s=this.storage.getDisplayList(),a=new O2(t,r);if(uX(s,a,t,r,i),this._pointerSize&&!a.target){for(var l=[],o=this._pointerSize,h=o/2,d=new as(t-h,r-h,o,o),m=s.length-1;m>=0;m--){var _=s[m];_!==i&&!_.ignore&&!_.ignoreCoarsePointer&&(!_.parent||!_.parent.ignoreCoarsePointer)&&(K5.copy(_.getBoundingRect()),_.transform&&K5.applyTransform(_.transform),K5.intersect(d)&&l.push(_))}if(l.length)for(var y=4,T=Math.PI/12,I=Math.PI*2,C=0;C<h;C+=y)for(var M=0;M<I;M+=T){var B=t+C*Math.cos(M),k=r+C*Math.sin(M);if(uX(l,a,B,k,i),a.target)return a}}return a},e.prototype.processGesture=function(t,r){this._gestureMgr||(this._gestureMgr=new BAe);var i=this._gestureMgr;r==="start"&&i.clear();var s=i.recognize(t,this.findHover(t.zrX,t.zrY,null).target,this.proxy.dom);if(r==="end"&&i.clear(),s){var a=s.type;t.gestureEvent=a;var l=new O2;l.target=s.target,this.dispatchToElement(l,a,s.event)}},e}(rd);it(["click","mousedown","mouseup","mousewheel","dblclick","contextmenu"],function(n){rre.prototype[n]=function(e){var t=e.zrX,r=e.zrY,i=ire(this,t,r),s,a;if((n!=="mouseup"||!i)&&(s=this.findHover(t,r),a=s.target),n==="mousedown")this._downEl=a,this._downPoint=[e.zrX,e.zrY],this._upEl=a;else if(n==="mouseup")this._upEl=a;else if(n==="click"){if(this._downEl!==this._upEl||!this._downPoint||xF(this._downPoint,[e.zrX,e.zrY])>4)return;this._downPoint=null}this.dispatchToElement(s,n,e)}});function HAe(n,e,t){if(n[n.rectHover?"rectContain":"contain"](e,t)){for(var r=n,i=void 0,s=!1;r;){if(r.ignoreClip&&(s=!0),!s){var a=r.getClipPath();if(a&&!a.contain(e,t))return!1}r.silent&&(i=!0);var l=r.__hostTarget;r=l||r.parent}return i?nre:!0}return!1}function uX(n,e,t,r,i){for(var s=n.length-1;s>=0;s--){var a=n[s],l=void 0;if(a!==i&&!a.ignore&&(l=HAe(a,t,r))&&(!e.topTarget&&(e.topTarget=a),l!==nre)){e.target=a;break}}}function ire(n,e,t){var r=n.painter;return e<0||e>r.getWidth()||t<0||t>r.getHeight()}var sre=32,F2=7;function jAe(n){for(var e=0;n>=sre;)e|=n&1,n>>=1;return n+e}function hX(n,e,t,r){var i=e+1;if(i===t)return 1;if(r(n[i++],n[e])<0){for(;i<t&&r(n[i],n[i-1])<0;)i++;WAe(n,e,i)}else for(;i<t&&r(n[i],n[i-1])>=0;)i++;return i-e}function WAe(n,e,t){for(t--;e<t;){var r=n[e];n[e++]=n[t],n[t--]=r}}function fX(n,e,t,r,i){for(r===e&&r++;r<t;r++){for(var s=n[r],a=e,l=r,o;a<l;)o=a+l>>>1,i(s,n[o])<0?l=o:a=o+1;var h=r-a;switch(h){case 3:n[a+3]=n[a+2];case 2:n[a+2]=n[a+1];case 1:n[a+1]=n[a];break;default:for(;h>0;)n[a+h]=n[a+h-1],h--}n[a]=s}}function J5(n,e,t,r,i,s){var a=0,l=0,o=1;if(s(n,e[t+i])>0){for(l=r-i;o<l&&s(n,e[t+i+o])>0;)a=o,o=(o<<1)+1,o<=0&&(o=l);o>l&&(o=l),a+=i,o+=i}else{for(l=i+1;o<l&&s(n,e[t+i-o])<=0;)a=o,o=(o<<1)+1,o<=0&&(o=l);o>l&&(o=l);var h=a;a=i-o,o=i-h}for(a++;a<o;){var d=a+(o-a>>>1);s(n,e[t+d])>0?a=d+1:o=d}return o}function Q5(n,e,t,r,i,s){var a=0,l=0,o=1;if(s(n,e[t+i])<0){for(l=i+1;o<l&&s(n,e[t+i-o])<0;)a=o,o=(o<<1)+1,o<=0&&(o=l);o>l&&(o=l);var h=a;a=i-o,o=i-h}else{for(l=r-i;o<l&&s(n,e[t+i+o])>=0;)a=o,o=(o<<1)+1,o<=0&&(o=l);o>l&&(o=l),a+=i,o+=i}for(a++;a<o;){var d=a+(o-a>>>1);s(n,e[t+d])<0?o=d:a=d+1}return o}function XAe(n,e){var t=F2,r,i,s=0,a=[];r=[],i=[];function l(y,T){r[s]=y,i[s]=T,s+=1}function o(){for(;s>1;){var y=s-2;if(y>=1&&i[y-1]<=i[y]+i[y+1]||y>=2&&i[y-2]<=i[y]+i[y-1])i[y-1]<i[y+1]&&y--;else if(i[y]>i[y+1])break;d(y)}}function h(){for(;s>1;){var y=s-2;y>0&&i[y-1]<i[y+1]&&y--,d(y)}}function d(y){var T=r[y],I=i[y],C=r[y+1],M=i[y+1];i[y]=I+M,y===s-3&&(r[y+1]=r[y+2],i[y+1]=i[y+2]),s--;var B=Q5(n[C],n,T,I,0,e);T+=B,I-=B,I!==0&&(M=J5(n[T+I-1],n,C,M,M-1,e),M!==0&&(I<=M?m(T,I,C,M):_(T,I,C,M)))}function m(y,T,I,C){var M=0;for(M=0;M<T;M++)a[M]=n[y+M];var B=0,k=I,j=y;if(n[j++]=n[k++],--C===0){for(M=0;M<T;M++)n[j+M]=a[B+M];return}if(T===1){for(M=0;M<C;M++)n[j+M]=n[k+M];n[j+C]=a[B];return}for(var q=t,Z,te,ie;;){Z=0,te=0,ie=!1;do if(e(n[k],a[B])<0){if(n[j++]=n[k++],te++,Z=0,--C===0){ie=!0;break}}else if(n[j++]=a[B++],Z++,te=0,--T===1){ie=!0;break}while((Z|te)<q);if(ie)break;do{if(Z=Q5(n[k],a,B,T,0,e),Z!==0){for(M=0;M<Z;M++)n[j+M]=a[B+M];if(j+=Z,B+=Z,T-=Z,T<=1){ie=!0;break}}if(n[j++]=n[k++],--C===0){ie=!0;break}if(te=J5(a[B],n,k,C,0,e),te!==0){for(M=0;M<te;M++)n[j+M]=n[k+M];if(j+=te,k+=te,C-=te,C===0){ie=!0;break}}if(n[j++]=a[B++],--T===1){ie=!0;break}q--}while(Z>=F2||te>=F2);if(ie)break;q<0&&(q=0),q+=2}if(t=q,t<1&&(t=1),T===1){for(M=0;M<C;M++)n[j+M]=n[k+M];n[j+C]=a[B]}else{if(T===0)throw new Error;for(M=0;M<T;M++)n[j+M]=a[B+M]}}function _(y,T,I,C){var M=0;for(M=0;M<C;M++)a[M]=n[I+M];var B=y+T-1,k=C-1,j=I+C-1,q=0,Z=0;if(n[j--]=n[B--],--T===0){for(q=j-(C-1),M=0;M<C;M++)n[q+M]=a[M];return}if(C===1){for(j-=T,B-=T,Z=j+1,q=B+1,M=T-1;M>=0;M--)n[Z+M]=n[q+M];n[j]=a[k];return}for(var te=t;;){var ie=0,se=0,ae=!1;do if(e(a[k],n[B])<0){if(n[j--]=n[B--],ie++,se=0,--T===0){ae=!0;break}}else if(n[j--]=a[k--],se++,ie=0,--C===1){ae=!0;break}while((ie|se)<te);if(ae)break;do{if(ie=T-Q5(a[k],n,y,T,T-1,e),ie!==0){for(j-=ie,B-=ie,T-=ie,Z=j+1,q=B+1,M=ie-1;M>=0;M--)n[Z+M]=n[q+M];if(T===0){ae=!0;break}}if(n[j--]=a[k--],--C===1){ae=!0;break}if(se=C-J5(n[B],a,0,C,C-1,e),se!==0){for(j-=se,k-=se,C-=se,Z=j+1,q=k+1,M=0;M<se;M++)n[Z+M]=a[q+M];if(C<=1){ae=!0;break}}if(n[j--]=n[B--],--T===0){ae=!0;break}te--}while(ie>=F2||se>=F2);if(ae)break;te<0&&(te=0),te+=2}if(t=te,t<1&&(t=1),C===1){for(j-=T,B-=T,Z=j+1,q=B+1,M=T-1;M>=0;M--)n[Z+M]=n[q+M];n[j]=a[k]}else{if(C===0)throw new Error;for(q=j-(C-1),M=0;M<C;M++)n[q+M]=a[M]}}return{mergeRuns:o,forceMergeRuns:h,pushRun:l}}function BI(n,e,t,r){t||(t=0),r||(r=n.length);var i=r-t;if(!(i<2)){var s=0;if(i<sre){s=hX(n,t,r,e),fX(n,t,r,t+s,e);return}var a=XAe(n,e),l=jAe(i);do{if(s=hX(n,t,r,e),s<l){var o=i;o>l&&(o=l),fX(n,t,t+o,t+s,e),s=o}a.pushRun(t,s),a.mergeRuns(),i-=s,t+=s}while(i!==0);a.forceMergeRuns()}}var Iu=1,mS=2,W1=4,dX=!1;function eB(){dX||(dX=!0,console.warn("z / z2 / zlevel of displayable is invalid, which may cause unexpected errors"))}function pX(n,e){return n.zlevel===e.zlevel?n.z===e.z?n.z2-e.z2:n.z-e.z:n.zlevel-e.zlevel}var $Ae=function(){function n(){this._roots=[],this._displayList=[],this._displayListLen=0,this.displayableSortFunc=pX}return n.prototype.traverse=function(e,t){for(var r=0;r<this._roots.length;r++)this._roots[r].traverse(e,t)},n.prototype.getDisplayList=function(e,t){t=t||!1;var r=this._displayList;return(e||!r.length)&&this.updateDisplayList(t),r},n.prototype.updateDisplayList=function(e){this._displayListLen=0;for(var t=this._roots,r=this._displayList,i=0,s=t.length;i<s;i++)this._updateAndAddDisplayable(t[i],null,e);r.length=this._displayListLen,BI(r,pX)},n.prototype._updateAndAddDisplayable=function(e,t,r){if(!(e.ignore&&!r)){e.beforeUpdate(),e.update(),e.afterUpdate();var i=e.getClipPath();if(e.ignoreClip)t=null;else if(i){t?t=t.slice():t=[];for(var s=i,a=e;s;)s.parent=a,s.updateTransform(),t.push(s),a=s,s=s.getClipPath()}if(e.childrenRef){for(var l=e.childrenRef(),o=0;o<l.length;o++){var h=l[o];e.__dirty&&(h.__dirty|=Iu),this._updateAndAddDisplayable(h,t,r)}e.__dirty=0}else{var d=e;t&&t.length?d.__clipPaths=t:d.__clipPaths&&d.__clipPaths.length>0&&(d.__clipPaths=[]),isNaN(d.z)&&(eB(),d.z=0),isNaN(d.z2)&&(eB(),d.z2=0),isNaN(d.zlevel)&&(eB(),d.zlevel=0),this._displayList[this._displayListLen++]=d}var m=e.getDecalElement&&e.getDecalElement();m&&this._updateAndAddDisplayable(m,t,r);var _=e.getTextGuideLine();_&&this._updateAndAddDisplayable(_,t,r);var y=e.getTextContent();y&&this._updateAndAddDisplayable(y,t,r)}},n.prototype.addRoot=function(e){e.__zr&&e.__zr.storage===this||this._roots.push(e)},n.prototype.delRoot=function(e){if(e instanceof Array){for(var t=0,r=e.length;t<r;t++)this.delRoot(e[t]);return}var i=Wi(this._roots,e);i>=0&&this._roots.splice(i,1)},n.prototype.delAllRoots=function(){this._roots=[],this._displayList=[],this._displayListLen=0},n.prototype.getRoots=function(){return this._roots},n.prototype.dispose=function(){this._displayList=null,this._roots=null},n}(),cP;cP=pi.hasGlobalWindow&&(window.requestAnimationFrame&&window.requestAnimationFrame.bind(window)||window.msRequestAnimationFrame&&window.msRequestAnimationFrame.bind(window)||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame)||function(n){return setTimeout(n,16)};var qS={linear:function(n){return n},quadraticIn:function(n){return n*n},quadraticOut:function(n){return n*(2-n)},quadraticInOut:function(n){return(n*=2)<1?.5*n*n:-.5*(--n*(n-2)-1)},cubicIn:function(n){return n*n*n},cubicOut:function(n){return--n*n*n+1},cubicInOut:function(n){return(n*=2)<1?.5*n*n*n:.5*((n-=2)*n*n+2)},quarticIn:function(n){return n*n*n*n},quarticOut:function(n){return 1- --n*n*n*n},quarticInOut:function(n){return(n*=2)<1?.5*n*n*n*n:-.5*((n-=2)*n*n*n-2)},quinticIn:function(n){return n*n*n*n*n},quinticOut:function(n){return--n*n*n*n*n+1},quinticInOut:function(n){return(n*=2)<1?.5*n*n*n*n*n:.5*((n-=2)*n*n*n*n+2)},sinusoidalIn:function(n){return 1-Math.cos(n*Math.PI/2)},sinusoidalOut:function(n){return Math.sin(n*Math.PI/2)},sinusoidalInOut:function(n){return .5*(1-Math.cos(Math.PI*n))},exponentialIn:function(n){return n===0?0:Math.pow(1024,n-1)},exponentialOut:function(n){return n===1?1:1-Math.pow(2,-10*n)},exponentialInOut:function(n){return n===0?0:n===1?1:(n*=2)<1?.5*Math.pow(1024,n-1):.5*(-Math.pow(2,-10*(n-1))+2)},circularIn:function(n){return 1-Math.sqrt(1-n*n)},circularOut:function(n){return Math.sqrt(1- --n*n)},circularInOut:function(n){return(n*=2)<1?-.5*(Math.sqrt(1-n*n)-1):.5*(Math.sqrt(1-(n-=2)*n)+1)},elasticIn:function(n){var e,t=.1,r=.4;return n===0?0:n===1?1:(!t||t<1?(t=1,e=r/4):e=r*Math.asin(1/t)/(2*Math.PI),-(t*Math.pow(2,10*(n-=1))*Math.sin((n-e)*(2*Math.PI)/r)))},elasticOut:function(n){var e,t=.1,r=.4;return n===0?0:n===1?1:(!t||t<1?(t=1,e=r/4):e=r*Math.asin(1/t)/(2*Math.PI),t*Math.pow(2,-10*n)*Math.sin((n-e)*(2*Math.PI)/r)+1)},elasticInOut:function(n){var e,t=.1,r=.4;return n===0?0:n===1?1:(!t||t<1?(t=1,e=r/4):e=r*Math.asin(1/t)/(2*Math.PI),(n*=2)<1?-.5*(t*Math.pow(2,10*(n-=1))*Math.sin((n-e)*(2*Math.PI)/r)):t*Math.pow(2,-10*(n-=1))*Math.sin((n-e)*(2*Math.PI)/r)*.5+1)},backIn:function(n){var e=1.70158;return n*n*((e+1)*n-e)},backOut:function(n){var e=1.70158;return--n*n*((e+1)*n+e)+1},backInOut:function(n){var e=2.5949095;return(n*=2)<1?.5*(n*n*((e+1)*n-e)):.5*((n-=2)*n*((e+1)*n+e)+2)},bounceIn:function(n){return 1-qS.bounceOut(1-n)},bounceOut:function(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375},bounceInOut:function(n){return n<.5?qS.bounceIn(n*2)*.5:qS.bounceOut(n*2-1)*.5+.5}},_E=Math.pow,tv=Math.sqrt,uP=1e-8,ore=1e-4,mX=tv(3),yE=1/3,qd=_w(),vh=_w(),Ib=_w();function V0(n){return n>-uP&&n<uP}function are(n){return n>uP||n<-uP}function Ua(n,e,t,r,i){var s=1-i;return s*s*(s*n+3*i*e)+i*i*(i*r+3*s*t)}function gX(n,e,t,r,i){var s=1-i;return 3*(((e-n)*s+2*(t-e)*i)*s+(r-t)*i*i)}function hP(n,e,t,r,i,s){var a=r+3*(e-t)-n,l=3*(t-e*2+n),o=3*(e-n),h=n-i,d=l*l-3*a*o,m=l*o-9*a*h,_=o*o-3*l*h,y=0;if(V0(d)&&V0(m))if(V0(l))s[0]=0;else{var T=-o/l;T>=0&&T<=1&&(s[y++]=T)}else{var I=m*m-4*d*_;if(V0(I)){var C=m/d,T=-l/a+C,M=-C/2;T>=0&&T<=1&&(s[y++]=T),M>=0&&M<=1&&(s[y++]=M)}else if(I>0){var B=tv(I),k=d*l+1.5*a*(-m+B),j=d*l+1.5*a*(-m-B);k<0?k=-_E(-k,yE):k=_E(k,yE),j<0?j=-_E(-j,yE):j=_E(j,yE);var T=(-l-(k+j))/(3*a);T>=0&&T<=1&&(s[y++]=T)}else{var q=(2*d*l-3*a*m)/(2*tv(d*d*d)),Z=Math.acos(q)/3,te=tv(d),ie=Math.cos(Z),T=(-l-2*te*ie)/(3*a),M=(-l+te*(ie+mX*Math.sin(Z)))/(3*a),se=(-l+te*(ie-mX*Math.sin(Z)))/(3*a);T>=0&&T<=1&&(s[y++]=T),M>=0&&M<=1&&(s[y++]=M),se>=0&&se<=1&&(s[y++]=se)}}return y}function lre(n,e,t,r,i){var s=6*t-12*e+6*n,a=9*e+3*r-3*n-9*t,l=3*e-3*n,o=0;if(V0(a)){if(are(s)){var h=-l/s;h>=0&&h<=1&&(i[o++]=h)}}else{var d=s*s-4*a*l;if(V0(d))i[0]=-s/(2*a);else if(d>0){var m=tv(d),h=(-s+m)/(2*a),_=(-s-m)/(2*a);h>=0&&h<=1&&(i[o++]=h),_>=0&&_<=1&&(i[o++]=_)}}return o}function fv(n,e,t,r,i,s){var a=(e-n)*i+n,l=(t-e)*i+e,o=(r-t)*i+t,h=(l-a)*i+a,d=(o-l)*i+l,m=(d-h)*i+h;s[0]=n,s[1]=a,s[2]=h,s[3]=m,s[4]=m,s[5]=d,s[6]=o,s[7]=r}function cre(n,e,t,r,i,s,a,l,o,h,d){var m,_=.005,y=1/0,T,I,C,M;qd[0]=o,qd[1]=h;for(var B=0;B<1;B+=.05)vh[0]=Ua(n,t,i,a,B),vh[1]=Ua(e,r,s,l,B),C=Cb(qd,vh),C<y&&(m=B,y=C);y=1/0;for(var k=0;k<32&&!(_<ore);k++)T=m-_,I=m+_,vh[0]=Ua(n,t,i,a,T),vh[1]=Ua(e,r,s,l,T),C=Cb(vh,qd),T>=0&&C<y?(m=T,y=C):(Ib[0]=Ua(n,t,i,a,I),Ib[1]=Ua(e,r,s,l,I),M=Cb(Ib,qd),I<=1&&M<y?(m=I,y=M):_*=.5);return d&&(d[0]=Ua(n,t,i,a,m),d[1]=Ua(e,r,s,l,m)),tv(y)}function qAe(n,e,t,r,i,s,a,l,o){for(var h=n,d=e,m=0,_=1/o,y=1;y<=o;y++){var T=y*_,I=Ua(n,t,i,a,T),C=Ua(e,r,s,l,T),M=I-h,B=C-d;m+=Math.sqrt(M*M+B*B),h=I,d=C}return m}function zl(n,e,t,r){var i=1-r;return i*(i*n+2*r*e)+r*r*t}function vX(n,e,t,r){return 2*((1-r)*(e-n)+r*(t-e))}function ZAe(n,e,t,r,i){var s=n-2*e+t,a=2*(e-n),l=n-r,o=0;if(V0(s)){if(are(a)){var h=-l/a;h>=0&&h<=1&&(i[o++]=h)}}else{var d=a*a-4*s*l;if(V0(d)){var h=-a/(2*s);h>=0&&h<=1&&(i[o++]=h)}else if(d>0){var m=tv(d),h=(-a+m)/(2*s),_=(-a-m)/(2*s);h>=0&&h<=1&&(i[o++]=h),_>=0&&_<=1&&(i[o++]=_)}}return o}function ure(n,e,t){var r=n+t-2*e;return r===0?.5:(n-e)/r}function fP(n,e,t,r,i){var s=(e-n)*r+n,a=(t-e)*r+e,l=(a-s)*r+s;i[0]=n,i[1]=s,i[2]=l,i[3]=l,i[4]=a,i[5]=t}function hre(n,e,t,r,i,s,a,l,o){var h,d=.005,m=1/0;qd[0]=a,qd[1]=l;for(var _=0;_<1;_+=.05){vh[0]=zl(n,t,i,_),vh[1]=zl(e,r,s,_);var y=Cb(qd,vh);y<m&&(h=_,m=y)}m=1/0;for(var T=0;T<32&&!(d<ore);T++){var I=h-d,C=h+d;vh[0]=zl(n,t,i,I),vh[1]=zl(e,r,s,I);var y=Cb(vh,qd);if(I>=0&&y<m)h=I,m=y;else{Ib[0]=zl(n,t,i,C),Ib[1]=zl(e,r,s,C);var M=Cb(Ib,qd);C<=1&&M<m?(h=C,m=M):d*=.5}}return o&&(o[0]=zl(n,t,i,h),o[1]=zl(e,r,s,h)),tv(m)}function YAe(n,e,t,r,i,s,a){for(var l=n,o=e,h=0,d=1/a,m=1;m<=a;m++){var _=m*d,y=zl(n,t,i,_),T=zl(e,r,s,_),I=y-l,C=T-o;h+=Math.sqrt(I*I+C*C),l=y,o=T}return h}var KAe=/cubic-bezier\(([0-9,\.e ]+)\)/;function fre(n){var e=n&&KAe.exec(n);if(e){var t=e[1].split(","),r=+Jd(t[0]),i=+Jd(t[1]),s=+Jd(t[2]),a=+Jd(t[3]);if(isNaN(r+i+s+a))return;var l=[];return function(o){return o<=0?0:o>=1?1:hP(0,r,s,1,o,l)&&Ua(0,i,a,1,l[0])}}}var JAe=function(){function n(e){this._inited=!1,this._startTime=0,this._pausedTime=0,this._paused=!1,this._life=e.life||1e3,this._delay=e.delay||0,this.loop=e.loop||!1,this.onframe=e.onframe||Cc,this.ondestroy=e.ondestroy||Cc,this.onrestart=e.onrestart||Cc,e.easing&&this.setEasing(e.easing)}return n.prototype.step=function(e,t){if(this._inited||(this._startTime=e+this._delay,this._inited=!0),this._paused){this._pausedTime+=t;return}var r=this._life,i=e-this._startTime-this._pausedTime,s=i/r;s<0&&(s=0),s=Math.min(s,1);var a=this.easingFunc,l=a?a(s):s;if(this.onframe(l),s===1)if(this.loop){var o=i%r;this._startTime=e-o,this._pausedTime=0,this.onrestart()}else return!0;return!1},n.prototype.pause=function(){this._paused=!0},n.prototype.resume=function(){this._paused=!1},n.prototype.setEasing=function(e){this.easing=e,this.easingFunc=li(e)?e:qS[e]||fre(e)},n}(),dre=function(){function n(e){this.value=e}return n}(),QAe=function(){function n(){this._len=0}return n.prototype.insert=function(e){var t=new dre(e);return this.insertEntry(t),t},n.prototype.insertEntry=function(e){this.head?(this.tail.next=e,e.prev=this.tail,e.next=null,this.tail=e):this.head=this.tail=e,this._len++},n.prototype.remove=function(e){var t=e.prev,r=e.next;t?t.next=r:this.head=r,r?r.prev=t:this.tail=t,e.next=e.prev=null,this._len--},n.prototype.len=function(){return this._len},n.prototype.clear=function(){this.head=this.tail=null,this._len=0},n}(),qT=function(){function n(e){this._list=new QAe,this._maxSize=10,this._map={},this._maxSize=e}return n.prototype.put=function(e,t){var r=this._list,i=this._map,s=null;if(i[e]==null){var a=r.len(),l=this._lastRemovedEntry;if(a>=this._maxSize&&a>0){var o=r.head;r.remove(o),delete i[o.key],s=o.value,this._lastRemovedEntry=o}l?l.value=t:l=new dre(t),l.key=e,r.insertEntry(l),i[e]=l}return s},n.prototype.get=function(e){var t=this._map[e],r=this._list;if(t!=null)return t!==r.tail&&(r.remove(t),r.insertEntry(t)),t.value},n.prototype.clear=function(){this._list.clear(),this._map={}},n.prototype.len=function(){return this._list.len()},n}(),_X={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function nv(n){return n=Math.round(n),n<0?0:n>255?255:n}function TF(n){return n<0?0:n>1?1:n}function tB(n){var e=n;return e.length&&e.charAt(e.length-1)==="%"?nv(parseFloat(e)/100*255):nv(parseInt(e,10))}function ZS(n){var e=n;return e.length&&e.charAt(e.length-1)==="%"?TF(parseFloat(e)/100):TF(parseFloat(e))}function nB(n,e,t){return t<0?t+=1:t>1&&(t-=1),t*6<1?n+(e-n)*t*6:t*2<1?e:t*3<2?n+(e-n)*(2/3-t)*6:n}function xE(n,e,t){return n+(e-n)*t}function ch(n,e,t,r,i){return n[0]=e,n[1]=t,n[2]=r,n[3]=i,n}function MF(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n}var pre=new qT(20),bE=null;function w1(n,e){bE&&MF(bE,e),bE=pre.put(n,bE||e.slice())}function Bm(n,e){if(n){e=e||[];var t=pre.get(n);if(t)return MF(e,t);n=n+"";var r=n.replace(/ /g,"").toLowerCase();if(r in _X)return MF(e,_X[r]),w1(n,e),e;var i=r.length;if(r.charAt(0)==="#"){if(i===4||i===5){var s=parseInt(r.slice(1,4),16);if(!(s>=0&&s<=4095)){ch(e,0,0,0,1);return}return ch(e,(s&3840)>>4|(s&3840)>>8,s&240|(s&240)>>4,s&15|(s&15)<<4,i===5?parseInt(r.slice(4),16)/15:1),w1(n,e),e}else if(i===7||i===9){var s=parseInt(r.slice(1,7),16);if(!(s>=0&&s<=16777215)){ch(e,0,0,0,1);return}return ch(e,(s&16711680)>>16,(s&65280)>>8,s&255,i===9?parseInt(r.slice(7),16)/255:1),w1(n,e),e}return}var a=r.indexOf("("),l=r.indexOf(")");if(a!==-1&&l+1===i){var o=r.substr(0,a),h=r.substr(a+1,l-(a+1)).split(","),d=1;switch(o){case"rgba":if(h.length!==4)return h.length===3?ch(e,+h[0],+h[1],+h[2],1):ch(e,0,0,0,1);d=ZS(h.pop());case"rgb":if(h.length>=3)return ch(e,tB(h[0]),tB(h[1]),tB(h[2]),h.length===3?d:ZS(h[3])),w1(n,e),e;ch(e,0,0,0,1);return;case"hsla":if(h.length!==4){ch(e,0,0,0,1);return}return h[3]=ZS(h[3]),yX(h,e),w1(n,e),e;case"hsl":if(h.length!==3){ch(e,0,0,0,1);return}return yX(h,e),w1(n,e),e;default:return}}ch(e,0,0,0,1)}}function yX(n,e){var t=(parseFloat(n[0])%360+360)%360/360,r=ZS(n[1]),i=ZS(n[2]),s=i<=.5?i*(r+1):i+r-i*r,a=i*2-s;return e=e||[],ch(e,nv(nB(a,s,t+1/3)*255),nv(nB(a,s,t)*255),nv(nB(a,s,t-1/3)*255),1),n.length===4&&(e[3]=n[3]),e}function xX(n,e){var t=Bm(n);if(t){for(var r=0;r<3;r++)t[r]=t[r]*(1-e)|0,t[r]>255?t[r]=255:t[r]<0&&(t[r]=0);return uD(t,t.length===4?"rgba":"rgb")}}function eTe(n,e,t){if(!(!(e&&e.length)||!(n>=0&&n<=1))){var r=n*(e.length-1),i=Math.floor(r),s=Math.ceil(r),a=Bm(e[i]),l=Bm(e[s]),o=r-i,h=uD([nv(xE(a[0],l[0],o)),nv(xE(a[1],l[1],o)),nv(xE(a[2],l[2],o)),TF(xE(a[3],l[3],o))],"rgba");return t?{color:h,leftIndex:i,rightIndex:s,value:r}:h}}function uD(n,e){if(!(!n||!n.length)){var t=n[0]+","+n[1]+","+n[2];return(e==="rgba"||e==="hsva"||e==="hsla")&&(t+=","+n[3]),e+"("+t+")"}}function dP(n,e){var t=Bm(n);return t?(.299*t[0]+.587*t[1]+.114*t[2])*t[3]/255+(1-t[3])*e:0}var bX=new qT(100);function wX(n){if(Dr(n)){var e=bX.get(n);return e||(e=xX(n,-.1),bX.put(n,e)),e}else if(oD(n)){var t=Jn({},n);return t.colorStops=xr(n.colorStops,function(r){return{offset:r.offset,color:xX(r.color,-.1)}}),t}return n}function tTe(n){return n.type==="linear"}function nTe(n){return n.type==="radial"}(function(){return pi.hasGlobalWindow&&li(window.btoa)?function(n){return window.btoa(unescape(encodeURIComponent(n)))}:typeof Buffer<"u"?function(n){return Buffer.from(n).toString("base64")}:function(n){return null}})();var CF=Array.prototype.slice;function gm(n,e,t){return(e-n)*t+n}function rB(n,e,t,r){for(var i=e.length,s=0;s<i;s++)n[s]=gm(e[s],t[s],r);return n}function rTe(n,e,t,r){for(var i=e.length,s=i&&e[0].length,a=0;a<i;a++){n[a]||(n[a]=[]);for(var l=0;l<s;l++)n[a][l]=gm(e[a][l],t[a][l],r)}return n}function wE(n,e,t,r){for(var i=e.length,s=0;s<i;s++)n[s]=e[s]+t[s]*r;return n}function SX(n,e,t,r){for(var i=e.length,s=i&&e[0].length,a=0;a<i;a++){n[a]||(n[a]=[]);for(var l=0;l<s;l++)n[a][l]=e[a][l]+t[a][l]*r}return n}function iTe(n,e){for(var t=n.length,r=e.length,i=t>r?e:n,s=Math.min(t,r),a=i[s-1]||{color:[0,0,0,0],offset:0},l=s;l<Math.max(t,r);l++)i.push({offset:a.offset,color:a.color.slice()})}function sTe(n,e,t){var r=n,i=e;if(!(!r.push||!i.push)){var s=r.length,a=i.length;if(s!==a){var l=s>a;if(l)r.length=a;else for(var o=s;o<a;o++)r.push(t===1?i[o]:CF.call(i[o]))}for(var h=r[0]&&r[0].length,o=0;o<r.length;o++)if(t===1)isNaN(r[o])&&(r[o]=i[o]);else for(var d=0;d<h;d++)isNaN(r[o][d])&&(r[o][d]=i[o][d])}}function kI(n){if(Ec(n)){var e=n.length;if(Ec(n[0])){for(var t=[],r=0;r<e;r++)t.push(CF.call(n[r]));return t}return CF.call(n)}return n}function OI(n){return n[0]=Math.floor(n[0])||0,n[1]=Math.floor(n[1])||0,n[2]=Math.floor(n[2])||0,n[3]=n[3]==null?1:n[3],"rgba("+n.join(",")+")"}function oTe(n){return Ec(n&&n[0])?2:1}var SE=0,FI=1,mre=2,gS=3,EF=4,IF=5,AX=6;function TX(n){return n===EF||n===IF}function AE(n){return n===FI||n===mre}var N2=[0,0,0,0],aTe=function(){function n(e){this.keyframes=[],this.discrete=!1,this._invalid=!1,this._needsSort=!1,this._lastFr=0,this._lastFrP=0,this.propName=e}return n.prototype.isFinished=function(){return this._finished},n.prototype.setFinished=function(){this._finished=!0,this._additiveTrack&&this._additiveTrack.setFinished()},n.prototype.needsAnimate=function(){return this.keyframes.length>=1},n.prototype.getAdditiveTrack=function(){return this._additiveTrack},n.prototype.addKeyframe=function(e,t,r){this._needsSort=!0;var i=this.keyframes,s=i.length,a=!1,l=AX,o=t;if(Ec(t)){var h=oTe(t);l=h,(h===1&&!Is(t[0])||h===2&&!Is(t[0][0]))&&(a=!0)}else if(Is(t)&&!oP(t))l=SE;else if(Dr(t))if(!isNaN(+t))l=SE;else{var d=Bm(t);d&&(o=d,l=gS)}else if(oD(t)){var m=Jn({},o);m.colorStops=xr(t.colorStops,function(y){return{offset:y.offset,color:Bm(y.color)}}),tTe(t)?l=EF:nTe(t)&&(l=IF),o=m}s===0?this.valType=l:(l!==this.valType||l===AX)&&(a=!0),this.discrete=this.discrete||a;var _={time:e,value:o,rawValue:t,percent:0};return r&&(_.easing=r,_.easingFunc=li(r)?r:qS[r]||fre(r)),i.push(_),_},n.prototype.prepare=function(e,t){var r=this.keyframes;this._needsSort&&r.sort(function(I,C){return I.time-C.time});for(var i=this.valType,s=r.length,a=r[s-1],l=this.discrete,o=AE(i),h=TX(i),d=0;d<s;d++){var m=r[d],_=m.value,y=a.value;m.percent=m.time/e,l||(o&&d!==s-1?sTe(_,y,i):h&&iTe(_.colorStops,y.colorStops))}if(!l&&i!==IF&&t&&this.needsAnimate()&&t.needsAnimate()&&i===t.valType&&!t._finished){this._additiveTrack=t;for(var T=r[0].value,d=0;d<s;d++)i===SE?r[d].additiveValue=r[d].value-T:i===gS?r[d].additiveValue=wE([],r[d].value,T,-1):AE(i)&&(r[d].additiveValue=i===FI?wE([],r[d].value,T,-1):SX([],r[d].value,T,-1))}},n.prototype.step=function(e,t){if(!this._finished){this._additiveTrack&&this._additiveTrack._finished&&(this._additiveTrack=null);var r=this._additiveTrack!=null,i=r?"additiveValue":"value",s=this.valType,a=this.keyframes,l=a.length,o=this.propName,h=s===gS,d,m=this._lastFr,_=Math.min,y,T;if(l===1)y=T=a[0];else{if(t<0)d=0;else if(t<this._lastFrP){var I=_(m+1,l-1);for(d=I;d>=0&&!(a[d].percent<=t);d--);d=_(d,l-2)}else{for(d=m;d<l&&!(a[d].percent>t);d++);d=_(d-1,l-2)}T=a[d+1],y=a[d]}if(y&&T){this._lastFr=d,this._lastFrP=t;var C=T.percent-y.percent,M=C===0?1:_((t-y.percent)/C,1);T.easingFunc&&(M=T.easingFunc(M));var B=r?this._additiveValue:h?N2:e[o];if((AE(s)||h)&&!B&&(B=this._additiveValue=[]),this.discrete)e[o]=M<1?y.rawValue:T.rawValue;else if(AE(s))s===FI?rB(B,y[i],T[i],M):rTe(B,y[i],T[i],M);else if(TX(s)){var k=y[i],j=T[i],q=s===EF;e[o]={type:q?"linear":"radial",x:gm(k.x,j.x,M),y:gm(k.y,j.y,M),colorStops:xr(k.colorStops,function(te,ie){var se=j.colorStops[ie];return{offset:gm(te.offset,se.offset,M),color:OI(rB([],te.color,se.color,M))}}),global:j.global},q?(e[o].x2=gm(k.x2,j.x2,M),e[o].y2=gm(k.y2,j.y2,M)):e[o].r=gm(k.r,j.r,M)}else if(h)rB(B,y[i],T[i],M),r||(e[o]=OI(B));else{var Z=gm(y[i],T[i],M);r?this._additiveValue=Z:e[o]=Z}r&&this._addToTarget(e)}}},n.prototype._addToTarget=function(e){var t=this.valType,r=this.propName,i=this._additiveValue;t===SE?e[r]=e[r]+i:t===gS?(Bm(e[r],N2),wE(N2,N2,i,1),e[r]=OI(N2)):t===FI?wE(e[r],e[r],i,1):t===mre&&SX(e[r],e[r],i,1)},n}(),tU=function(){function n(e,t,r,i){if(this._tracks={},this._trackKeys=[],this._maxTime=0,this._started=0,this._clip=null,this._target=e,this._loop=t,t&&i){K6("Can' use additive animation on looped animation.");return}this._additiveAnimators=i,this._allowDiscrete=r}return n.prototype.getMaxTime=function(){return this._maxTime},n.prototype.getDelay=function(){return this._delay},n.prototype.getLoop=function(){return this._loop},n.prototype.getTarget=function(){return this._target},n.prototype.changeTarget=function(e){this._target=e},n.prototype.when=function(e,t,r){return this.whenWithKeys(e,t,io(t),r)},n.prototype.whenWithKeys=function(e,t,r,i){for(var s=this._tracks,a=0;a<r.length;a++){var l=r[a],o=s[l];if(!o){o=s[l]=new aTe(l);var h=void 0,d=this._getAdditiveTrack(l);if(d){var m=d.keyframes,_=m[m.length-1];h=_&&_.value,d.valType===gS&&h&&(h=OI(h))}else h=this._target[l];if(h==null)continue;e>0&&o.addKeyframe(0,kI(h),i),this._trackKeys.push(l)}o.addKeyframe(e,kI(t[l]),i)}return this._maxTime=Math.max(this._maxTime,e),this},n.prototype.pause=function(){this._clip.pause(),this._paused=!0},n.prototype.resume=function(){this._clip.resume(),this._paused=!1},n.prototype.isPaused=function(){return!!this._paused},n.prototype.duration=function(e){return this._maxTime=e,this._force=!0,this},n.prototype._doneCallback=function(){this._setTracksFinished(),this._clip=null;var e=this._doneCbs;if(e)for(var t=e.length,r=0;r<t;r++)e[r].call(this)},n.prototype._abortedCallback=function(){this._setTracksFinished();var e=this.animation,t=this._abortedCbs;if(e&&e.removeClip(this._clip),this._clip=null,t)for(var r=0;r<t.length;r++)t[r].call(this)},n.prototype._setTracksFinished=function(){for(var e=this._tracks,t=this._trackKeys,r=0;r<t.length;r++)e[t[r]].setFinished()},n.prototype._getAdditiveTrack=function(e){var t,r=this._additiveAnimators;if(r)for(var i=0;i<r.length;i++){var s=r[i].getTrack(e);s&&(t=s)}return t},n.prototype.start=function(e){if(!(this._started>0)){this._started=1;for(var t=this,r=[],i=this._maxTime||0,s=0;s<this._trackKeys.length;s++){var a=this._trackKeys[s],l=this._tracks[a],o=this._getAdditiveTrack(a),h=l.keyframes,d=h.length;if(l.prepare(i,o),l.needsAnimate())if(!this._allowDiscrete&&l.discrete){var m=h[d-1];m&&(t._target[l.propName]=m.rawValue),l.setFinished()}else r.push(l)}if(r.length||this._force){var _=new JAe({life:i,loop:this._loop,delay:this._delay||0,onframe:function(y){t._started=2;var T=t._additiveAnimators;if(T){for(var I=!1,C=0;C<T.length;C++)if(T[C]._clip){I=!0;break}I||(t._additiveAnimators=null)}for(var C=0;C<r.length;C++)r[C].step(t._target,y);var M=t._onframeCbs;if(M)for(var C=0;C<M.length;C++)M[C](t._target,y)},ondestroy:function(){t._doneCallback()}});this._clip=_,this.animation&&this.animation.addClip(_),e&&_.setEasing(e)}else this._doneCallback();return this}},n.prototype.stop=function(e){if(this._clip){var t=this._clip;e&&t.onframe(1),this._abortedCallback()}},n.prototype.delay=function(e){return this._delay=e,this},n.prototype.during=function(e){return e&&(this._onframeCbs||(this._onframeCbs=[]),this._onframeCbs.push(e)),this},n.prototype.done=function(e){return e&&(this._doneCbs||(this._doneCbs=[]),this._doneCbs.push(e)),this},n.prototype.aborted=function(e){return e&&(this._abortedCbs||(this._abortedCbs=[]),this._abortedCbs.push(e)),this},n.prototype.getClip=function(){return this._clip},n.prototype.getTrack=function(e){return this._tracks[e]},n.prototype.getTracks=function(){var e=this;return xr(this._trackKeys,function(t){return e._tracks[t]})},n.prototype.stopTracks=function(e,t){if(!e.length||!this._clip)return!0;for(var r=this._tracks,i=this._trackKeys,s=0;s<e.length;s++){var a=r[e[s]];a&&!a.isFinished()&&(t?a.step(this._target,1):this._started===1&&a.step(this._target,0),a.setFinished())}for(var l=!0,s=0;s<i.length;s++)if(!r[i[s]].isFinished()){l=!1;break}return l&&this._abortedCallback(),l},n.prototype.saveTo=function(e,t,r){if(e){t=t||this._trackKeys;for(var i=0;i<t.length;i++){var s=t[i],a=this._tracks[s];if(!(!a||a.isFinished())){var l=a.keyframes,o=l[r?0:l.length-1];o&&(e[s]=kI(o.rawValue))}}}},n.prototype.__changeFinalValue=function(e,t){t=t||io(e);for(var r=0;r<t.length;r++){var i=t[r],s=this._tracks[i];if(s){var a=s.keyframes;if(a.length>1){var l=a.pop();s.addKeyframe(l.time,e[i]),s.prepare(this._maxTime,s.getAdditiveTrack())}}}},n}();function mb(){return new Date().getTime()}var lTe=function(n){Hn(e,n);function e(t){var r=n.call(this)||this;return r._running=!1,r._time=0,r._pausedTime=0,r._pauseStart=0,r._paused=!1,t=t||{},r.stage=t.stage||{},r}return e.prototype.addClip=function(t){t.animation&&this.removeClip(t),this._head?(this._tail.next=t,t.prev=this._tail,t.next=null,this._tail=t):this._head=this._tail=t,t.animation=this},e.prototype.addAnimator=function(t){t.animation=this;var r=t.getClip();r&&this.addClip(r)},e.prototype.removeClip=function(t){if(t.animation){var r=t.prev,i=t.next;r?r.next=i:this._head=i,i?i.prev=r:this._tail=r,t.next=t.prev=t.animation=null}},e.prototype.removeAnimator=function(t){var r=t.getClip();r&&this.removeClip(r),t.animation=null},e.prototype.update=function(t){for(var r=mb()-this._pausedTime,i=r-this._time,s=this._head;s;){var a=s.next,l=s.step(r,i);l&&(s.ondestroy(),this.removeClip(s)),s=a}this._time=r,t||(this.trigger("frame",i),this.stage.update&&this.stage.update())},e.prototype._startLoop=function(){var t=this;this._running=!0;function r(){t._running&&(cP(r),!t._paused&&t.update())}cP(r)},e.prototype.start=function(){this._running||(this._time=mb(),this._pausedTime=0,this._startLoop())},e.prototype.stop=function(){this._running=!1},e.prototype.pause=function(){this._paused||(this._pauseStart=mb(),this._paused=!0)},e.prototype.resume=function(){this._paused&&(this._pausedTime+=mb()-this._pauseStart,this._paused=!1)},e.prototype.clear=function(){for(var t=this._head;t;){var r=t.next;t.prev=t.next=t.animation=null,t=r}this._head=this._tail=null},e.prototype.isFinished=function(){return this._head==null},e.prototype.animate=function(t,r){r=r||{},this.start();var i=new tU(t,r.loop);return this.addAnimator(i),i},e}(rd),cTe=300,iB=pi.domSupported,sB=function(){var n=["click","dblclick","mousewheel","wheel","mouseout","mouseup","mousedown","mousemove","contextmenu"],e=["touchstart","touchend","touchmove"],t={pointerdown:1,pointerup:1,pointermove:1,pointerout:1},r=xr(n,function(i){var s=i.replace("mouse","pointer");return t.hasOwnProperty(s)?s:i});return{mouse:n,touch:e,pointer:r}}(),MX={mouse:["mousemove","mouseup"],pointer:["pointermove","pointerup"]},CX=!1;function RF(n){var e=n.pointerType;return e==="pen"||e==="touch"}function uTe(n){n.touching=!0,n.touchTimer!=null&&(clearTimeout(n.touchTimer),n.touchTimer=null),n.touchTimer=setTimeout(function(){n.touching=!1,n.touchTimer=null},700)}function oB(n){n&&(n.zrByTouch=!0)}function hTe(n,e){return hh(n.dom,new fTe(n,e),!0)}function gre(n,e){for(var t=e,r=!1;t&&t.nodeType!==9&&!(r=t.domBelongToZr||t!==e&&t===n.painterRoot);)t=t.parentNode;return r}var fTe=function(){function n(e,t){this.stopPropagation=Cc,this.stopImmediatePropagation=Cc,this.preventDefault=Cc,this.type=t.type,this.target=this.currentTarget=e.dom,this.pointerType=t.pointerType,this.clientX=t.clientX,this.clientY=t.clientY}return n}(),Ef={mousedown:function(n){n=hh(this.dom,n),this.__mayPointerCapture=[n.zrX,n.zrY],this.trigger("mousedown",n)},mousemove:function(n){n=hh(this.dom,n);var e=this.__mayPointerCapture;e&&(n.zrX!==e[0]||n.zrY!==e[1])&&this.__togglePointerCapture(!0),this.trigger("mousemove",n)},mouseup:function(n){n=hh(this.dom,n),this.__togglePointerCapture(!1),this.trigger("mouseup",n)},mouseout:function(n){n=hh(this.dom,n);var e=n.toElement||n.relatedTarget;gre(this,e)||(this.__pointerCapturing&&(n.zrEventControl="no_globalout"),this.trigger("mouseout",n))},wheel:function(n){CX=!0,n=hh(this.dom,n),this.trigger("mousewheel",n)},mousewheel:function(n){CX||(n=hh(this.dom,n),this.trigger("mousewheel",n))},touchstart:function(n){n=hh(this.dom,n),oB(n),this.__lastTouchMoment=new Date,this.handler.processGesture(n,"start"),Ef.mousemove.call(this,n),Ef.mousedown.call(this,n)},touchmove:function(n){n=hh(this.dom,n),oB(n),this.handler.processGesture(n,"change"),Ef.mousemove.call(this,n)},touchend:function(n){n=hh(this.dom,n),oB(n),this.handler.processGesture(n,"end"),Ef.mouseup.call(this,n),+new Date-+this.__lastTouchMoment<cTe&&Ef.click.call(this,n)},pointerdown:function(n){Ef.mousedown.call(this,n)},pointermove:function(n){RF(n)||Ef.mousemove.call(this,n)},pointerup:function(n){Ef.mouseup.call(this,n)},pointerout:function(n){RF(n)||Ef.mouseout.call(this,n)}};it(["click","dblclick","contextmenu"],function(n){Ef[n]=function(e){e=hh(this.dom,e),this.trigger(n,e)}});var PF={pointermove:function(n){RF(n)||PF.mousemove.call(this,n)},pointerup:function(n){PF.mouseup.call(this,n)},mousemove:function(n){this.trigger("mousemove",n)},mouseup:function(n){var e=this.__pointerCapturing;this.__togglePointerCapture(!1),this.trigger("mouseup",n),e&&(n.zrEventControl="only_globalout",this.trigger("mouseout",n))}};function dTe(n,e){var t=e.domHandlers;pi.pointerEventsSupported?it(sB.pointer,function(r){NI(e,r,function(i){t[r].call(n,i)})}):(pi.touchEventsSupported&&it(sB.touch,function(r){NI(e,r,function(i){t[r].call(n,i),uTe(e)})}),it(sB.mouse,function(r){NI(e,r,function(i){i=Q6(i),e.touching||t[r].call(n,i)})}))}function pTe(n,e){pi.pointerEventsSupported?it(MX.pointer,t):pi.touchEventsSupported||it(MX.mouse,t);function t(r){function i(s){s=Q6(s),gre(n,s.target)||(s=hTe(n,s),e.domHandlers[r].call(n,s))}NI(e,r,i,{capture:!0})}}function NI(n,e,t,r){n.mounted[e]=t,n.listenerOpts[e]=r,AF(n.domTarget,e,t,r)}function aB(n){var e=n.mounted;for(var t in e)e.hasOwnProperty(t)&&DAe(n.domTarget,t,e[t],n.listenerOpts[t]);n.mounted={}}var EX=function(){function n(e,t){this.mounted={},this.listenerOpts={},this.touching=!1,this.domTarget=e,this.domHandlers=t}return n}(),mTe=function(n){Hn(e,n);function e(t,r){var i=n.call(this)||this;return i.__pointerCapturing=!1,i.dom=t,i.painterRoot=r,i._localHandlerScope=new EX(t,Ef),iB&&(i._globalHandlerScope=new EX(document,PF)),dTe(i,i._localHandlerScope),i}return e.prototype.dispose=function(){aB(this._localHandlerScope),iB&&aB(this._globalHandlerScope)},e.prototype.setCursor=function(t){this.dom.style&&(this.dom.style.cursor=t||"default")},e.prototype.__togglePointerCapture=function(t){if(this.__mayPointerCapture=null,iB&&+this.__pointerCapturing^+t){this.__pointerCapturing=t;var r=this._globalHandlerScope;t?pTe(this,r):aB(r)}},e}(rd),vre=1;pi.hasGlobalWindow&&(vre=Math.max(window.devicePixelRatio||window.screen&&window.screen.deviceXDPI/window.screen.logicalXDPI||1,1));var pP=vre,LF=.4,DF="#333",BF="#ccc",gTe="#eee",IX=eU,RX=5e-5;function L_(n){return n>RX||n<-RX}var D_=[],S1=[],lB=Dy(),cB=Math.abs,ZT=function(){function n(){}return n.prototype.getLocalTransform=function(e){return n.getLocalTransform(this,e)},n.prototype.setPosition=function(e){this.x=e[0],this.y=e[1]},n.prototype.setScale=function(e){this.scaleX=e[0],this.scaleY=e[1]},n.prototype.setSkew=function(e){this.skewX=e[0],this.skewY=e[1]},n.prototype.setOrigin=function(e){this.originX=e[0],this.originY=e[1]},n.prototype.needLocalTransform=function(){return L_(this.rotation)||L_(this.x)||L_(this.y)||L_(this.scaleX-1)||L_(this.scaleY-1)||L_(this.skewX)||L_(this.skewY)},n.prototype.updateTransform=function(){var e=this.parent&&this.parent.transform,t=this.needLocalTransform(),r=this.transform;if(!(t||e)){r&&(IX(r),this.invTransform=null);return}r=r||Dy(),t?this.getLocalTransform(r):IX(r),e&&(t?Eb(r,e,r):OAe(r,e)),this.transform=r,this._resolveGlobalScaleRatio(r)},n.prototype._resolveGlobalScaleRatio=function(e){var t=this.globalScaleRatio;if(t!=null&&t!==1){this.getGlobalScale(D_);var r=D_[0]<0?-1:1,i=D_[1]<0?-1:1,s=((D_[0]-r)*t+r)/D_[0]||0,a=((D_[1]-i)*t+i)/D_[1]||0;e[0]*=s,e[1]*=s,e[2]*=a,e[3]*=a}this.invTransform=this.invTransform||Dy(),cD(this.invTransform,e)},n.prototype.getComputedTransform=function(){for(var e=this,t=[];e;)t.push(e),e=e.parent;for(;e=t.pop();)e.updateTransform();return this.transform},n.prototype.setLocalTransform=function(e){if(e){var t=e[0]*e[0]+e[1]*e[1],r=e[2]*e[2]+e[3]*e[3],i=Math.atan2(e[1],e[0]),s=Math.PI/2+i-Math.atan2(e[3],e[2]);r=Math.sqrt(r)*Math.cos(s),t=Math.sqrt(t),this.skewX=s,this.skewY=0,this.rotation=-i,this.x=+e[4],this.y=+e[5],this.scaleX=t,this.scaleY=r,this.originX=0,this.originY=0}},n.prototype.decomposeTransform=function(){if(this.transform){var e=this.parent,t=this.transform;e&&e.transform&&(e.invTransform=e.invTransform||Dy(),Eb(S1,e.invTransform,t),t=S1);var r=this.originX,i=this.originY;(r||i)&&(lB[4]=r,lB[5]=i,Eb(S1,t,lB),S1[4]-=r,S1[5]-=i,t=S1),this.setLocalTransform(t)}},n.prototype.getGlobalScale=function(e){var t=this.transform;return e=e||[],t?(e[0]=Math.sqrt(t[0]*t[0]+t[1]*t[1]),e[1]=Math.sqrt(t[2]*t[2]+t[3]*t[3]),t[0]<0&&(e[0]=-e[0]),t[3]<0&&(e[1]=-e[1]),e):(e[0]=1,e[1]=1,e)},n.prototype.transformCoordToLocal=function(e,t){var r=[e,t],i=this.invTransform;return i&&Th(r,r,i),r},n.prototype.transformCoordToGlobal=function(e,t){var r=[e,t],i=this.transform;return i&&Th(r,r,i),r},n.prototype.getLineScale=function(){var e=this.transform;return e&&cB(e[0]-1)>1e-10&&cB(e[3]-1)>1e-10?Math.sqrt(cB(e[0]*e[3]-e[2]*e[1])):1},n.prototype.copyTransform=function(e){vTe(this,e)},n.getLocalTransform=function(e,t){t=t||[];var r=e.originX||0,i=e.originY||0,s=e.scaleX,a=e.scaleY,l=e.anchorX,o=e.anchorY,h=e.rotation||0,d=e.x,m=e.y,_=e.skewX?Math.tan(e.skewX):0,y=e.skewY?Math.tan(-e.skewY):0;if(r||i||l||o){var T=r+l,I=i+o;t[4]=-T*s-_*I*a,t[5]=-I*a-y*T*s}else t[4]=t[5]=0;return t[0]=s,t[3]=a,t[1]=y*s,t[2]=_*a,h&&lD(t,t,h),t[4]+=r+d,t[5]+=i+m,t},n.initDefaultProps=function(){var e=n.prototype;e.scaleX=e.scaleY=e.globalScaleRatio=1,e.x=e.y=e.originX=e.originY=e.skewX=e.skewY=e.rotation=e.anchorX=e.anchorY=0}(),n}(),ZA=["x","y","originX","originY","anchorX","anchorY","rotation","scaleX","scaleY","skewX","skewY"];function vTe(n,e){for(var t=0;t<ZA.length;t++){var r=ZA[t];n[r]=e[r]}}var PX={};function Du(n,e){e=e||Jy;var t=PX[e];t||(t=PX[e]=new qT(500));var r=t.get(n);return r==null&&(r=gw.measureText(n,e).width,t.put(n,r)),r}function LX(n,e,t,r){var i=Du(n,e),s=nU(e),a=vS(0,i,t),l=X1(0,s,r),o=new as(a,l,i,s);return o}function YT(n,e,t,r){var i=((n||"")+"").split(`
`),s=i.length;if(s===1)return LX(i[0],e,t,r);for(var a=new as(0,0,0,0),l=0;l<i.length;l++){var o=LX(i[l],e,t,r);l===0?a.copy(o):a.union(o)}return a}function vS(n,e,t){return t==="right"?n-=e:t==="center"&&(n-=e/2),n}function X1(n,e,t){return t==="middle"?n-=e/2:t==="bottom"&&(n-=e),n}function nU(n){return Du("国",n)}function dv(n,e){return typeof n=="string"?n.lastIndexOf("%")>=0?parseFloat(n)/100*e:parseFloat(n):n}function mP(n,e,t){var r=e.position||"inside",i=e.distance!=null?e.distance:5,s=t.height,a=t.width,l=s/2,o=t.x,h=t.y,d="left",m="top";if(r instanceof Array)o+=dv(r[0],t.width),h+=dv(r[1],t.height),d=null,m=null;else switch(r){case"left":o-=i,h+=l,d="right",m="middle";break;case"right":o+=i+a,h+=l,m="middle";break;case"top":o+=a/2,h-=i,d="center",m="bottom";break;case"bottom":o+=a/2,h+=s+i,d="center";break;case"inside":o+=a/2,h+=l,d="center",m="middle";break;case"insideLeft":o+=i,h+=l,m="middle";break;case"insideRight":o+=a-i,h+=l,d="right",m="middle";break;case"insideTop":o+=a/2,h+=i,d="center";break;case"insideBottom":o+=a/2,h+=s-i,d="center",m="bottom";break;case"insideTopLeft":o+=i,h+=i;break;case"insideTopRight":o+=a-i,h+=i,d="right";break;case"insideBottomLeft":o+=i,h+=s-i,m="bottom";break;case"insideBottomRight":o+=a-i,h+=s-i,d="right",m="bottom";break}return n=n||{},n.x=o,n.y=h,n.align=d,n.verticalAlign=m,n}var uB="__zr_normal__",hB=ZA.concat(["ignore"]),_Te=hv(ZA,function(n,e){return n[e]=!0,n},{ignore:!1}),A1={},yTe=new as(0,0,0,0),hD=function(){function n(e){this.id=Zne(),this.animators=[],this.currentStates=[],this.states={},this._init(e)}return n.prototype._init=function(e){this.attr(e)},n.prototype.drift=function(e,t,r){switch(this.draggable){case"horizontal":t=0;break;case"vertical":e=0;break}var i=this.transform;i||(i=this.transform=[1,0,0,1,0,0]),i[4]+=e,i[5]+=t,this.decomposeTransform(),this.markRedraw()},n.prototype.beforeUpdate=function(){},n.prototype.afterUpdate=function(){},n.prototype.update=function(){this.updateTransform(),this.__dirty&&this.updateInnerText()},n.prototype.updateInnerText=function(e){var t=this._textContent;if(t&&(!t.ignore||e)){this.textConfig||(this.textConfig={});var r=this.textConfig,i=r.local,s=t.innerTransformable,a=void 0,l=void 0,o=!1;s.parent=i?this:null;var h=!1;if(s.copyTransform(t),r.position!=null){var d=yTe;r.layoutRect?d.copy(r.layoutRect):d.copy(this.getBoundingRect()),i||d.applyTransform(this.transform),this.calculateTextPosition?this.calculateTextPosition(A1,r,d):mP(A1,r,d),s.x=A1.x,s.y=A1.y,a=A1.align,l=A1.verticalAlign;var m=r.origin;if(m&&r.rotation!=null){var _=void 0,y=void 0;m==="center"?(_=d.width*.5,y=d.height*.5):(_=dv(m[0],d.width),y=dv(m[1],d.height)),h=!0,s.originX=-s.x+_+(i?0:d.x),s.originY=-s.y+y+(i?0:d.y)}}r.rotation!=null&&(s.rotation=r.rotation);var T=r.offset;T&&(s.x+=T[0],s.y+=T[1],h||(s.originX=-T[0],s.originY=-T[1]));var I=r.inside==null?typeof r.position=="string"&&r.position.indexOf("inside")>=0:r.inside,C=this._innerTextDefaultStyle||(this._innerTextDefaultStyle={}),M=void 0,B=void 0,k=void 0;I&&this.canBeInsideText()?(M=r.insideFill,B=r.insideStroke,(M==null||M==="auto")&&(M=this.getInsideTextFill()),(B==null||B==="auto")&&(B=this.getInsideTextStroke(M),k=!0)):(M=r.outsideFill,B=r.outsideStroke,(M==null||M==="auto")&&(M=this.getOutsideFill()),(B==null||B==="auto")&&(B=this.getOutsideStroke(M),k=!0)),M=M||"#000",(M!==C.fill||B!==C.stroke||k!==C.autoStroke||a!==C.align||l!==C.verticalAlign)&&(o=!0,C.fill=M,C.stroke=B,C.autoStroke=k,C.align=a,C.verticalAlign=l,t.setDefaultTextStyle(C)),t.__dirty|=Iu,o&&t.dirtyStyle(!0)}},n.prototype.canBeInsideText=function(){return!0},n.prototype.getInsideTextFill=function(){return"#fff"},n.prototype.getInsideTextStroke=function(e){return"#000"},n.prototype.getOutsideFill=function(){return this.__zr&&this.__zr.isDarkMode()?BF:DF},n.prototype.getOutsideStroke=function(e){var t=this.__zr&&this.__zr.getBackgroundColor(),r=typeof t=="string"&&Bm(t);r||(r=[255,255,255,1]);for(var i=r[3],s=this.__zr.isDarkMode(),a=0;a<3;a++)r[a]=r[a]*i+(s?0:255)*(1-i);return r[3]=1,uD(r,"rgba")},n.prototype.traverse=function(e,t){},n.prototype.attrKV=function(e,t){e==="textConfig"?this.setTextConfig(t):e==="textContent"?this.setTextContent(t):e==="clipPath"?this.setClipPath(t):e==="extra"?(this.extra=this.extra||{},Jn(this.extra,t)):this[e]=t},n.prototype.hide=function(){this.ignore=!0,this.markRedraw()},n.prototype.show=function(){this.ignore=!1,this.markRedraw()},n.prototype.attr=function(e,t){if(typeof e=="string")this.attrKV(e,t);else if(Xr(e))for(var r=e,i=io(r),s=0;s<i.length;s++){var a=i[s];this.attrKV(a,e[a])}return this.markRedraw(),this},n.prototype.saveCurrentToNormalState=function(e){this._innerSaveToNormal(e);for(var t=this._normalState,r=0;r<this.animators.length;r++){var i=this.animators[r],s=i.__fromStateTransition;if(!(i.getLoop()||s&&s!==uB)){var a=i.targetName,l=a?t[a]:t;i.saveTo(l)}}},n.prototype._innerSaveToNormal=function(e){var t=this._normalState;t||(t=this._normalState={}),e.textConfig&&!t.textConfig&&(t.textConfig=this.textConfig),this._savePrimaryToNormal(e,t,hB)},n.prototype._savePrimaryToNormal=function(e,t,r){for(var i=0;i<r.length;i++){var s=r[i];e[s]!=null&&!(s in t)&&(t[s]=this[s])}},n.prototype.hasState=function(){return this.currentStates.length>0},n.prototype.getState=function(e){return this.states[e]},n.prototype.ensureState=function(e){var t=this.states;return t[e]||(t[e]={}),t[e]},n.prototype.clearStates=function(e){this.useState(uB,!1,e)},n.prototype.useState=function(e,t,r,i){var s=e===uB,a=this.hasState();if(!(!a&&s)){var l=this.currentStates,o=this.stateTransition;if(!(Wi(l,e)>=0&&(t||l.length===1))){var h;if(this.stateProxy&&!s&&(h=this.stateProxy(e)),h||(h=this.states&&this.states[e]),!h&&!s){K6("State "+e+" not exists.");return}s||this.saveCurrentToNormalState(h);var d=!!(h&&h.hoverLayer||i);d&&this._toggleHoverLayerFlag(!0),this._applyStateObj(e,h,this._normalState,t,!r&&!this.__inHover&&o&&o.duration>0,o);var m=this._textContent,_=this._textGuide;return m&&m.useState(e,t,r,d),_&&_.useState(e,t,r,d),s?(this.currentStates=[],this._normalState={}):t?this.currentStates.push(e):this.currentStates=[e],this._updateAnimationTargets(),this.markRedraw(),!d&&this.__inHover&&(this._toggleHoverLayerFlag(!1),this.__dirty&=~Iu),h}}},n.prototype.useStates=function(e,t,r){if(!e.length)this.clearStates();else{var i=[],s=this.currentStates,a=e.length,l=a===s.length;if(l){for(var o=0;o<a;o++)if(e[o]!==s[o]){l=!1;break}}if(l)return;for(var o=0;o<a;o++){var h=e[o],d=void 0;this.stateProxy&&(d=this.stateProxy(h,e)),d||(d=this.states[h]),d&&i.push(d)}var m=i[a-1],_=!!(m&&m.hoverLayer||r);_&&this._toggleHoverLayerFlag(!0);var y=this._mergeStates(i),T=this.stateTransition;this.saveCurrentToNormalState(y),this._applyStateObj(e.join(","),y,this._normalState,!1,!t&&!this.__inHover&&T&&T.duration>0,T);var I=this._textContent,C=this._textGuide;I&&I.useStates(e,t,_),C&&C.useStates(e,t,_),this._updateAnimationTargets(),this.currentStates=e.slice(),this.markRedraw(),!_&&this.__inHover&&(this._toggleHoverLayerFlag(!1),this.__dirty&=~Iu)}},n.prototype.isSilent=function(){for(var e=this.silent,t=this.parent;!e&&t;){if(t.silent){e=!0;break}t=t.parent}return e},n.prototype._updateAnimationTargets=function(){for(var e=0;e<this.animators.length;e++){var t=this.animators[e];t.targetName&&t.changeTarget(this[t.targetName])}},n.prototype.removeState=function(e){var t=Wi(this.currentStates,e);if(t>=0){var r=this.currentStates.slice();r.splice(t,1),this.useStates(r)}},n.prototype.replaceState=function(e,t,r){var i=this.currentStates.slice(),s=Wi(i,e),a=Wi(i,t)>=0;s>=0?a?i.splice(s,1):i[s]=t:r&&!a&&i.push(t),this.useStates(i)},n.prototype.toggleState=function(e,t){t?this.useState(e,!0):this.removeState(e)},n.prototype._mergeStates=function(e){for(var t={},r,i=0;i<e.length;i++){var s=e[i];Jn(t,s),s.textConfig&&(r=r||{},Jn(r,s.textConfig))}return r&&(t.textConfig=r),t},n.prototype._applyStateObj=function(e,t,r,i,s,a){var l=!(t&&i);t&&t.textConfig?(this.textConfig=Jn({},i?this.textConfig:r.textConfig),Jn(this.textConfig,t.textConfig)):l&&r.textConfig&&(this.textConfig=r.textConfig);for(var o={},h=!1,d=0;d<hB.length;d++){var m=hB[d],_=s&&_Te[m];t&&t[m]!=null?_?(h=!0,o[m]=t[m]):this[m]=t[m]:l&&r[m]!=null&&(_?(h=!0,o[m]=r[m]):this[m]=r[m])}if(!s)for(var d=0;d<this.animators.length;d++){var y=this.animators[d],T=y.targetName;y.getLoop()||y.__changeFinalValue(T?(t||r)[T]:t||r)}h&&this._transitionState(e,o,a)},n.prototype._attachComponent=function(e){if(!(e.__zr&&!e.__hostTarget)&&e!==this){var t=this.__zr;t&&e.addSelfToZr(t),e.__zr=t,e.__hostTarget=this}},n.prototype._detachComponent=function(e){e.__zr&&e.removeSelfFromZr(e.__zr),e.__zr=null,e.__hostTarget=null},n.prototype.getClipPath=function(){return this._clipPath},n.prototype.setClipPath=function(e){this._clipPath&&this._clipPath!==e&&this.removeClipPath(),this._attachComponent(e),this._clipPath=e,this.markRedraw()},n.prototype.removeClipPath=function(){var e=this._clipPath;e&&(this._detachComponent(e),this._clipPath=null,this.markRedraw())},n.prototype.getTextContent=function(){return this._textContent},n.prototype.setTextContent=function(e){var t=this._textContent;t!==e&&(t&&t!==e&&this.removeTextContent(),e.innerTransformable=new ZT,this._attachComponent(e),this._textContent=e,this.markRedraw())},n.prototype.setTextConfig=function(e){this.textConfig||(this.textConfig={}),Jn(this.textConfig,e),this.markRedraw()},n.prototype.removeTextConfig=function(){this.textConfig=null,this.markRedraw()},n.prototype.removeTextContent=function(){var e=this._textContent;e&&(e.innerTransformable=null,this._detachComponent(e),this._textContent=null,this._innerTextDefaultStyle=null,this.markRedraw())},n.prototype.getTextGuideLine=function(){return this._textGuide},n.prototype.setTextGuideLine=function(e){this._textGuide&&this._textGuide!==e&&this.removeTextGuideLine(),this._attachComponent(e),this._textGuide=e,this.markRedraw()},n.prototype.removeTextGuideLine=function(){var e=this._textGuide;e&&(this._detachComponent(e),this._textGuide=null,this.markRedraw())},n.prototype.markRedraw=function(){this.__dirty|=Iu;var e=this.__zr;e&&(this.__inHover?e.refreshHover():e.refresh()),this.__hostTarget&&this.__hostTarget.markRedraw()},n.prototype.dirty=function(){this.markRedraw()},n.prototype._toggleHoverLayerFlag=function(e){this.__inHover=e;var t=this._textContent,r=this._textGuide;t&&(t.__inHover=e),r&&(r.__inHover=e)},n.prototype.addSelfToZr=function(e){if(this.__zr!==e){this.__zr=e;var t=this.animators;if(t)for(var r=0;r<t.length;r++)e.animation.addAnimator(t[r]);this._clipPath&&this._clipPath.addSelfToZr(e),this._textContent&&this._textContent.addSelfToZr(e),this._textGuide&&this._textGuide.addSelfToZr(e)}},n.prototype.removeSelfFromZr=function(e){if(this.__zr){this.__zr=null;var t=this.animators;if(t)for(var r=0;r<t.length;r++)e.animation.removeAnimator(t[r]);this._clipPath&&this._clipPath.removeSelfFromZr(e),this._textContent&&this._textContent.removeSelfFromZr(e),this._textGuide&&this._textGuide.removeSelfFromZr(e)}},n.prototype.animate=function(e,t,r){var i=e?this[e]:this,s=new tU(i,t,r);return e&&(s.targetName=e),this.addAnimator(s,e),s},n.prototype.addAnimator=function(e,t){var r=this.__zr,i=this;e.during(function(){i.updateDuringAnimation(t)}).done(function(){var s=i.animators,a=Wi(s,e);a>=0&&s.splice(a,1)}),this.animators.push(e),r&&r.animation.addAnimator(e),r&&r.wakeUp()},n.prototype.updateDuringAnimation=function(e){this.markRedraw()},n.prototype.stopAnimation=function(e,t){for(var r=this.animators,i=r.length,s=[],a=0;a<i;a++){var l=r[a];!e||e===l.scope?l.stop(t):s.push(l)}return this.animators=s,this},n.prototype.animateTo=function(e,t,r){fB(this,e,t,r)},n.prototype.animateFrom=function(e,t,r){fB(this,e,t,r,!0)},n.prototype._transitionState=function(e,t,r,i){for(var s=fB(this,t,r,i),a=0;a<s.length;a++)s[a].__fromStateTransition=e},n.prototype.getBoundingRect=function(){return null},n.prototype.getPaintRect=function(){return null},n.initDefaultProps=function(){var e=n.prototype;e.type="element",e.name="",e.ignore=e.silent=e.isGroup=e.draggable=e.dragging=e.ignoreClip=e.__inHover=!1,e.__dirty=Iu;function t(r,i,s,a){Object.defineProperty(e,r,{get:function(){if(!this[i]){var o=this[i]=[];l(this,o)}return this[i]},set:function(o){this[s]=o[0],this[a]=o[1],this[i]=o,l(this,o)}});function l(o,h){Object.defineProperty(h,0,{get:function(){return o[s]},set:function(d){o[s]=d}}),Object.defineProperty(h,1,{get:function(){return o[a]},set:function(d){o[a]=d}})}}Object.defineProperty&&(t("position","_legacyPos","x","y"),t("scale","_legacyScale","scaleX","scaleY"),t("origin","_legacyOrigin","originX","originY"))}(),n}();nd(hD,rd);nd(hD,ZT);function fB(n,e,t,r,i){t=t||{};var s=[];_re(n,"",n,e,t,r,s,i);var a=s.length,l=!1,o=t.done,h=t.aborted,d=function(){l=!0,a--,a<=0&&(l?o&&o():h&&h())},m=function(){a--,a<=0&&(l?o&&o():h&&h())};a||o&&o(),s.length>0&&t.during&&s[0].during(function(T,I){t.during(I)});for(var _=0;_<s.length;_++){var y=s[_];d&&y.done(d),m&&y.aborted(m),t.force&&y.duration(t.duration),y.start(t.easing)}return s}function dB(n,e,t){for(var r=0;r<t;r++)n[r]=e[r]}function xTe(n){return Ec(n[0])}function bTe(n,e,t){if(Ec(e[t]))if(Ec(n[t])||(n[t]=[]),hu(e[t])){var r=e[t].length;n[t].length!==r&&(n[t]=new e[t].constructor(r),dB(n[t],e[t],r))}else{var i=e[t],s=n[t],a=i.length;if(xTe(i))for(var l=i[0].length,o=0;o<a;o++)s[o]?dB(s[o],i[o],l):s[o]=Array.prototype.slice.call(i[o]);else dB(s,i,a);s.length=i.length}else n[t]=e[t]}function wTe(n,e){return n===e||Ec(n)&&Ec(e)&&STe(n,e)}function STe(n,e){var t=n.length;if(t!==e.length)return!1;for(var r=0;r<t;r++)if(n[r]!==e[r])return!1;return!0}function _re(n,e,t,r,i,s,a,l){for(var o=io(r),h=i.duration,d=i.delay,m=i.additive,_=i.setToFinal,y=!Xr(s),T=n.animators,I=[],C=0;C<o.length;C++){var M=o[C],B=r[M];if(B!=null&&t[M]!=null&&(y||s[M]))if(Xr(B)&&!Ec(B)&&!oD(B)){if(e){l||(t[M]=B,n.updateDuringAnimation(e));continue}_re(n,M,t[M],B,i,s&&s[M],a,l)}else I.push(M);else l||(t[M]=B,n.updateDuringAnimation(e),I.push(M))}var k=I.length;if(!m&&k)for(var j=0;j<T.length;j++){var q=T[j];if(q.targetName===e){var Z=q.stopTracks(I);if(Z){var te=Wi(T,q);T.splice(te,1)}}}if(i.force||(I=ta(I,function(fe){return!wTe(r[fe],t[fe])}),k=I.length),k>0||i.force&&!a.length){var ie=void 0,se=void 0,ae=void 0;if(l){se={},_&&(ie={});for(var j=0;j<k;j++){var M=I[j];se[M]=t[M],_?ie[M]=r[M]:t[M]=r[M]}}else if(_){ae={};for(var j=0;j<k;j++){var M=I[j];ae[M]=kI(t[M]),bTe(t,r,M)}}var q=new tU(t,!1,!1,m?ta(T,function(Se){return Se.targetName===e}):null);q.targetName=e,i.scope&&(q.scope=i.scope),_&&ie&&q.whenWithKeys(0,ie,I),ae&&q.whenWithKeys(0,ae,I),q.whenWithKeys(h??500,l?se:r,I).delay(d||0),n.addAnimator(q,e),a.push(q)}}var pa=function(n){Hn(e,n);function e(t){var r=n.call(this)||this;return r.isGroup=!0,r._children=[],r.attr(t),r}return e.prototype.childrenRef=function(){return this._children},e.prototype.children=function(){return this._children.slice()},e.prototype.childAt=function(t){return this._children[t]},e.prototype.childOfName=function(t){for(var r=this._children,i=0;i<r.length;i++)if(r[i].name===t)return r[i]},e.prototype.childCount=function(){return this._children.length},e.prototype.add=function(t){return t&&t!==this&&t.parent!==this&&(this._children.push(t),this._doAdd(t)),this},e.prototype.addBefore=function(t,r){if(t&&t!==this&&t.parent!==this&&r&&r.parent===this){var i=this._children,s=i.indexOf(r);s>=0&&(i.splice(s,0,t),this._doAdd(t))}return this},e.prototype.replace=function(t,r){var i=Wi(this._children,t);return i>=0&&this.replaceAt(r,i),this},e.prototype.replaceAt=function(t,r){var i=this._children,s=i[r];if(t&&t!==this&&t.parent!==this&&t!==s){i[r]=t,s.parent=null;var a=this.__zr;a&&s.removeSelfFromZr(a),this._doAdd(t)}return this},e.prototype._doAdd=function(t){t.parent&&t.parent.remove(t),t.parent=this;var r=this.__zr;r&&r!==t.__zr&&t.addSelfToZr(r),r&&r.refresh()},e.prototype.remove=function(t){var r=this.__zr,i=this._children,s=Wi(i,t);return s<0?this:(i.splice(s,1),t.parent=null,r&&t.removeSelfFromZr(r),r&&r.refresh(),this)},e.prototype.removeAll=function(){for(var t=this._children,r=this.__zr,i=0;i<t.length;i++){var s=t[i];r&&s.removeSelfFromZr(r),s.parent=null}return t.length=0,this},e.prototype.eachChild=function(t,r){for(var i=this._children,s=0;s<i.length;s++){var a=i[s];t.call(r,a,s)}return this},e.prototype.traverse=function(t,r){for(var i=0;i<this._children.length;i++){var s=this._children[i],a=t.call(r,s);s.isGroup&&!a&&s.traverse(t,r)}return this},e.prototype.addSelfToZr=function(t){n.prototype.addSelfToZr.call(this,t);for(var r=0;r<this._children.length;r++){var i=this._children[r];i.addSelfToZr(t)}},e.prototype.removeSelfFromZr=function(t){n.prototype.removeSelfFromZr.call(this,t);for(var r=0;r<this._children.length;r++){var i=this._children[r];i.removeSelfFromZr(t)}},e.prototype.getBoundingRect=function(t){for(var r=new as(0,0,0,0),i=t||this._children,s=[],a=null,l=0;l<i.length;l++){var o=i[l];if(!(o.ignore||o.invisible)){var h=o.getBoundingRect(),d=o.getLocalTransform(s);d?(as.applyTransform(r,h,d),a=a||r.clone(),a.union(r)):(a=a||h.clone(),a.union(h))}}return a||r},e}(hD);pa.prototype.type="group";/*!
* ZRender, a high performance 2d drawing library.
*
* Copyright (c) 2013, Baidu Inc.
* All rights reserved.
*
* LICENSE
* https://github.com/ecomfe/zrender/blob/master/LICENSE.txt
*/var zI={},yre={};function ATe(n){delete yre[n]}function TTe(n){if(!n)return!1;if(typeof n=="string")return dP(n,1)<LF;if(n.colorStops){for(var e=n.colorStops,t=0,r=e.length,i=0;i<r;i++)t+=dP(e[i].color,1);return t/=r,t<LF}return!1}var MTe=function(){function n(e,t,r){var i=this;this._sleepAfterStill=10,this._stillFrameAccum=0,this._needsRefresh=!0,this._needsRefreshHover=!0,this._darkMode=!1,r=r||{},this.dom=t,this.id=e;var s=new $Ae,a=r.renderer||"canvas";zI[a]||(a=io(zI)[0]),r.useDirtyRect=r.useDirtyRect==null?!1:r.useDirtyRect;var l=new zI[a](t,s,r,e),o=r.ssr||l.ssrOnly;this.storage=s,this.painter=l;var h=!pi.node&&!pi.worker&&!o?new mTe(l.getViewportRoot(),l.root):null,d=r.useCoarsePointer,m=d==null||d==="auto"?pi.touchEventsSupported:!!d,_=44,y;m&&(y=Ci(r.pointerSize,_)),this.handler=new rre(s,l,h,l.root,y),this.animation=new lTe({stage:{update:o?null:function(){return i._flush(!0)}}}),o||this.animation.start()}return n.prototype.add=function(e){this._disposed||!e||(this.storage.addRoot(e),e.addSelfToZr(this),this.refresh())},n.prototype.remove=function(e){this._disposed||!e||(this.storage.delRoot(e),e.removeSelfFromZr(this),this.refresh())},n.prototype.configLayer=function(e,t){this._disposed||(this.painter.configLayer&&this.painter.configLayer(e,t),this.refresh())},n.prototype.setBackgroundColor=function(e){this._disposed||(this.painter.setBackgroundColor&&this.painter.setBackgroundColor(e),this.refresh(),this._backgroundColor=e,this._darkMode=TTe(e))},n.prototype.getBackgroundColor=function(){return this._backgroundColor},n.prototype.setDarkMode=function(e){this._darkMode=e},n.prototype.isDarkMode=function(){return this._darkMode},n.prototype.refreshImmediately=function(e){this._disposed||(e||this.animation.update(!0),this._needsRefresh=!1,this.painter.refresh(),this._needsRefresh=!1)},n.prototype.refresh=function(){this._disposed||(this._needsRefresh=!0,this.animation.start())},n.prototype.flush=function(){this._disposed||this._flush(!1)},n.prototype._flush=function(e){var t,r=mb();this._needsRefresh&&(t=!0,this.refreshImmediately(e)),this._needsRefreshHover&&(t=!0,this.refreshHoverImmediately());var i=mb();t?(this._stillFrameAccum=0,this.trigger("rendered",{elapsedTime:i-r})):this._sleepAfterStill>0&&(this._stillFrameAccum++,this._stillFrameAccum>this._sleepAfterStill&&this.animation.stop())},n.prototype.setSleepAfterStill=function(e){this._sleepAfterStill=e},n.prototype.wakeUp=function(){this._disposed||(this.animation.start(),this._stillFrameAccum=0)},n.prototype.refreshHover=function(){this._needsRefreshHover=!0},n.prototype.refreshHoverImmediately=function(){this._disposed||(this._needsRefreshHover=!1,this.painter.refreshHover&&this.painter.getType()==="canvas"&&this.painter.refreshHover())},n.prototype.resize=function(e){this._disposed||(e=e||{},this.painter.resize(e.width,e.height),this.handler.resize())},n.prototype.clearAnimation=function(){this._disposed||this.animation.clear()},n.prototype.getWidth=function(){if(!this._disposed)return this.painter.getWidth()},n.prototype.getHeight=function(){if(!this._disposed)return this.painter.getHeight()},n.prototype.setCursorStyle=function(e){this._disposed||this.handler.setCursorStyle(e)},n.prototype.findHover=function(e,t){if(!this._disposed)return this.handler.findHover(e,t)},n.prototype.on=function(e,t,r){return this._disposed||this.handler.on(e,t,r),this},n.prototype.off=function(e,t){this._disposed||this.handler.off(e,t)},n.prototype.trigger=function(e,t){this._disposed||this.handler.trigger(e,t)},n.prototype.clear=function(){if(!this._disposed){for(var e=this.storage.getRoots(),t=0;t<e.length;t++)e[t]instanceof pa&&e[t].removeSelfFromZr(this);this.storage.delAllRoots(),this.painter.clear()}},n.prototype.dispose=function(){this._disposed||(this.animation.stop(),this.clear(),this.storage.dispose(),this.painter.dispose(),this.handler.dispose(),this.animation=this.storage=this.painter=this.handler=null,this._disposed=!0,ATe(this.id))},n}();function DX(n,e){var t=new MTe(Zne(),n,e);return yre[t.id]=t,t}function CTe(n,e){zI[n]=e}var BX=1e-4,xre=20;function ETe(n){return n.replace(/^\s+|\s+$/g,"")}function B0(n,e,t,r){var i=e[0],s=e[1],a=t[0],l=t[1],o=s-i,h=l-a;if(o===0)return h===0?a:(a+l)/2;if(r)if(o>0){if(n<=i)return a;if(n>=s)return l}else{if(n>=i)return a;if(n<=s)return l}else{if(n===i)return a;if(n===s)return l}return(n-i)/o*h+a}function os(n,e){switch(n){case"center":case"middle":n="50%";break;case"left":case"top":n="0%";break;case"right":case"bottom":n="100%";break}return Dr(n)?ETe(n).match(/%$/)?parseFloat(n)/100*e:parseFloat(n):n==null?NaN:+n}function Sa(n,e,t){return e==null&&(e=10),e=Math.min(Math.max(0,e),xre),n=(+n).toFixed(e),t?n:+n}function ITe(n){return n.sort(function(e,t){return e-t}),n}function Cm(n){if(n=+n,isNaN(n))return 0;if(n>1e-14){for(var e=1,t=0;t<15;t++,e*=10)if(Math.round(n*e)/e===n)return t}return RTe(n)}function RTe(n){var e=n.toString().toLowerCase(),t=e.indexOf("e"),r=t>0?+e.slice(t+1):0,i=t>0?t:e.length,s=e.indexOf("."),a=s<0?0:i-1-s;return Math.max(0,a-r)}function bre(n,e){var t=Math.log,r=Math.LN10,i=Math.floor(t(n[1]-n[0])/r),s=Math.round(t(Math.abs(e[1]-e[0]))/r),a=Math.min(Math.max(-i+s,0),20);return isFinite(a)?a:20}function PTe(n,e){var t=hv(n,function(y,T){return y+(isNaN(T)?0:T)},0);if(t===0)return[];for(var r=Math.pow(10,e),i=xr(n,function(y){return(isNaN(y)?0:y)/t*r*100}),s=r*100,a=xr(i,function(y){return Math.floor(y)}),l=hv(a,function(y,T){return y+T},0),o=xr(i,function(y,T){return y-a[T]});l<s;){for(var h=Number.NEGATIVE_INFINITY,d=null,m=0,_=o.length;m<_;++m)o[m]>h&&(h=o[m],d=m);++a[d],o[d]=0,++l}return xr(a,function(y){return y/r})}function LTe(n,e){var t=Math.max(Cm(n),Cm(e)),r=n+e;return t>xre?r:Sa(r,t)}function wre(n){var e=Math.PI*2;return(n%e+e)%e}function gP(n){return n>-BX&&n<BX}var DTe=/^(?:(\d{4})(?:[-\/](\d{1,2})(?:[-\/](\d{1,2})(?:[T ](\d{1,2})(?::(\d{1,2})(?::(\d{1,2})(?:[.,](\d+))?)?)?(Z|[\+\-]\d\d:?\d\d)?)?)?)?)?$/;function qm(n){if(n instanceof Date)return n;if(Dr(n)){var e=DTe.exec(n);if(!e)return new Date(NaN);if(e[8]){var t=+e[4]||0;return e[8].toUpperCase()!=="Z"&&(t-=+e[8].slice(0,3)),new Date(Date.UTC(+e[1],+(e[2]||1)-1,+e[3]||1,t,+(e[5]||0),+e[6]||0,e[7]?+e[7].substring(0,3):0))}else return new Date(+e[1],+(e[2]||1)-1,+e[3]||1,+e[4]||0,+(e[5]||0),+e[6]||0,e[7]?+e[7].substring(0,3):0)}else if(n==null)return new Date(NaN);return new Date(Math.round(n))}function BTe(n){return Math.pow(10,rU(n))}function rU(n){if(n===0)return 0;var e=Math.floor(Math.log(n)/Math.LN10);return n/Math.pow(10,e)>=10&&e++,e}function Sre(n,e){var t=rU(n),r=Math.pow(10,t),i=n/r,s;return i<1.5?s=1:i<2.5?s=2:i<4?s=3:i<7?s=5:s=10,n=s*r,t>=-20?+n.toFixed(t<0?-t:0):n}function pv(n){var e=parseFloat(n);return e==n&&(e!==0||!Dr(n)||n.indexOf("x")<=0)?e:NaN}function kTe(n){return!isNaN(pv(n))}function Are(){return Math.round(Math.random()*9)}function Tre(n,e){return e===0?n:Tre(e,n%e)}function kX(n,e){return n==null?e:e==null?n:n*e/Tre(n,e)}function ss(n){throw new Error(n)}function OX(n,e,t){return(e-n)*t+n}var Mre="series\0",Cre="\0_ec_\0";function da(n){return n instanceof Array?n:n==null?[]:[n]}function kF(n,e,t){if(n){n[e]=n[e]||{},n.emphasis=n.emphasis||{},n.emphasis[e]=n.emphasis[e]||{};for(var r=0,i=t.length;r<i;r++){var s=t[r];!n.emphasis[e].hasOwnProperty(s)&&n[e].hasOwnProperty(s)&&(n.emphasis[e][s]=n[e][s])}}}var FX=["fontStyle","fontWeight","fontSize","fontFamily","rich","tag","color","textBorderColor","textBorderWidth","width","height","lineHeight","align","verticalAlign","baseline","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","textShadowColor","textShadowBlur","textShadowOffsetX","textShadowOffsetY","backgroundColor","borderColor","borderWidth","borderRadius","padding"];function KT(n){return Xr(n)&&!fr(n)&&!(n instanceof Date)?n.value:n}function OTe(n){return Xr(n)&&!(n instanceof Array)}function FTe(n,e,t){var r=t==="normalMerge",i=t==="replaceMerge",s=t==="replaceAll";n=n||[],e=(e||[]).slice();var a=ri();it(e,function(o,h){if(!Xr(o)){e[h]=null;return}});var l=NTe(n,a,t);return(r||i)&&zTe(l,n,a,e),r&&UTe(l,e),r||i?VTe(l,e,i):s&&GTe(l,e),HTe(l),l}function NTe(n,e,t){var r=[];if(t==="replaceAll")return r;for(var i=0;i<n.length;i++){var s=n[i];s&&s.id!=null&&e.set(s.id,i),r.push({existing:t==="replaceMerge"||YA(s)?null:s,newOption:null,keyInfo:null,brandNew:null})}return r}function zTe(n,e,t,r){it(r,function(i,s){if(!(!i||i.id==null)){var a=YS(i.id),l=t.get(a);if(l!=null){var o=n[l];hp(!o.newOption,'Duplicated option on id "'+a+'".'),o.newOption=i,o.existing=e[l],r[s]=null}}})}function UTe(n,e){it(e,function(t,r){if(!(!t||t.name==null))for(var i=0;i<n.length;i++){var s=n[i].existing;if(!n[i].newOption&&s&&(s.id==null||t.id==null)&&!YA(t)&&!YA(s)&&Ere("name",s,t)){n[i].newOption=t,e[r]=null;return}}})}function VTe(n,e,t){it(e,function(r){if(r){for(var i,s=0;(i=n[s])&&(i.newOption||YA(i.existing)||i.existing&&r.id!=null&&!Ere("id",r,i.existing));)s++;i?(i.newOption=r,i.brandNew=t):n.push({newOption:r,brandNew:t,existing:null,keyInfo:null}),s++}})}function GTe(n,e){it(e,function(t){n.push({newOption:t,brandNew:!0,existing:null,keyInfo:null})})}function HTe(n){var e=ri();it(n,function(t){var r=t.existing;r&&e.set(r.id,t)}),it(n,function(t){var r=t.newOption;hp(!r||r.id==null||!e.get(r.id)||e.get(r.id)===t,"id duplicates: "+(r&&r.id)),r&&r.id!=null&&e.set(r.id,t),!t.keyInfo&&(t.keyInfo={})}),it(n,function(t,r){var i=t.existing,s=t.newOption,a=t.keyInfo;if(Xr(s)){if(a.name=s.name!=null?YS(s.name):i?i.name:Mre+r,i)a.id=YS(i.id);else if(s.id!=null)a.id=YS(s.id);else{var l=0;do a.id="\0"+a.name+"\0"+l++;while(e.get(a.id))}e.set(a.id,t)}})}function Ere(n,e,t){var r=op(e[n],null),i=op(t[n],null);return r!=null&&i!=null&&r===i}function YS(n){return op(n,"")}function op(n,e){return n==null?e:Dr(n)?n:Is(n)||_F(n)?n+"":e}function iU(n){var e=n.name;return!!(e&&e.indexOf(Mre))}function YA(n){return n&&n.id!=null&&YS(n.id).indexOf(Cre)===0}function jTe(n){return Cre+n}function WTe(n,e,t){it(n,function(r){var i=r.newOption;Xr(i)&&(r.keyInfo.mainType=e,r.keyInfo.subType=XTe(e,i,r.existing,t))})}function XTe(n,e,t,r){var i=e.type?e.type:t?t.subType:r.determineSubType(n,e);return i}function Qy(n,e){if(e.dataIndexInside!=null)return e.dataIndexInside;if(e.dataIndex!=null)return fr(e.dataIndex)?xr(e.dataIndex,function(t){return n.indexOfRawIndex(t)}):n.indexOfRawIndex(e.dataIndex);if(e.name!=null)return fr(e.name)?xr(e.name,function(t){return n.indexOfName(t)}):n.indexOfName(e.name)}function Xs(){var n="__ec_inner_"+$Te++;return function(e){return e[n]||(e[n]={})}}var $Te=Are();function KS(n,e,t){var r=sU(e,t),i=r.mainTypeSpecified,s=r.queryOptionMap,a=r.others,l=a,o=t?t.defaultMainType:null;return!i&&o&&s.set(o,{}),s.each(function(h,d){var m=JT(n,d,h,{useDefault:o===d,enableAll:t&&t.enableAll!=null?t.enableAll:!0,enableNone:t&&t.enableNone!=null?t.enableNone:!0});l[d+"Models"]=m.models,l[d+"Model"]=m.models[0]}),l}function sU(n,e){var t;if(Dr(n)){var r={};r[n+"Index"]=0,t=r}else t=n;var i=ri(),s={},a=!1;return it(t,function(l,o){if(o==="dataIndex"||o==="dataIndexInside"){s[o]=l;return}var h=o.match(/^(\w+)(Index|Id|Name)$/)||[],d=h[1],m=(h[2]||"").toLowerCase();if(!(!d||!m||e&&e.includeMainTypes&&Wi(e.includeMainTypes,d)<0)){a=a||!!d;var _=i.get(d)||i.set(d,{});_[m]=l}}),{mainTypeSpecified:a,queryOptionMap:i,others:s}}var yl={useDefault:!0,enableAll:!1,enableNone:!1},qTe={useDefault:!1,enableAll:!0,enableNone:!0};function JT(n,e,t,r){r=r||yl;var i=t.index,s=t.id,a=t.name,l={models:null,specified:i!=null||s!=null||a!=null};if(!l.specified){var o=void 0;return l.models=r.useDefault&&(o=n.getComponent(e))?[o]:[],l}return i==="none"||i===!1?(hp(r.enableNone,'`"none"` or `false` is not a valid value on index option.'),l.models=[],l):(i==="all"&&(hp(r.enableAll,'`"all"` is not a valid value on index option.'),i=s=a=null),l.models=n.queryComponents({mainType:e,index:i,id:s,name:a}),l)}function Ire(n,e,t){n.setAttribute?n.setAttribute(e,t):n[e]=t}function ZTe(n,e){return n.getAttribute?n.getAttribute(e):n[e]}function YTe(n){return n==="auto"?pi.domSupported?"html":"richText":n||"html"}function Rre(n,e,t,r,i){var s=e==null||e==="auto";if(r==null)return r;if(Is(r)){var a=OX(t||0,r,i);return Sa(a,s?Math.max(Cm(t||0),Cm(r)):e)}else{if(Dr(r))return i<1?t:r;for(var l=[],o=t,h=r,d=Math.max(o?o.length:0,h.length),m=0;m<d;++m){var _=n.getDimensionInfo(m);if(_&&_.type==="ordinal")l[m]=(i<1&&o?o:h)[m];else{var y=o&&o[m]?o[m]:0,T=h[m],a=OX(y,T,i);l[m]=Sa(a,s?Math.max(Cm(y),Cm(T)):e)}}return l}}var KTe=".",B_="___EC__COMPONENT__CONTAINER___",Pre="___EC__EXTENDED_CLASS___";function Qd(n){var e={main:"",sub:""};if(n){var t=n.split(KTe);e.main=t[0]||"",e.sub=t[1]||""}return e}function JTe(n){hp(/^[a-zA-Z0-9_]+([.][a-zA-Z0-9_]+)?$/.test(n),'componentType "'+n+'" illegal')}function QTe(n){return!!(n&&n[Pre])}function oU(n,e){n.$constructor=n,n.extend=function(t){var r=this,i;return eMe(r)?i=function(s){Hn(a,s);function a(){return s.apply(this,arguments)||this}return a}(r):(i=function(){(t.$constructor||r).apply(this,arguments)},lAe(i,this)),Jn(i.prototype,t),i[Pre]=!0,i.extend=this.extend,i.superCall=rMe,i.superApply=iMe,i.superClass=r,i}}function eMe(n){return li(n)&&/^class\s/.test(Function.prototype.toString.call(n))}function Lre(n,e){n.extend=e.extend}var tMe=Math.round(Math.random()*10);function nMe(n){var e=["__\0is_clz",tMe++].join("_");n.prototype[e]=!0,n.isInstance=function(t){return!!(t&&t[e])}}function rMe(n,e){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];return this.superClass.prototype[e].apply(n,t)}function iMe(n,e,t){return this.superClass.prototype[e].apply(n,t)}function fD(n){var e={};n.registerClass=function(r){var i=r.type||r.prototype.type;if(i){JTe(i),r.prototype.type=i;var s=Qd(i);if(!s.sub)e[s.main]=r;else if(s.sub!==B_){var a=t(s);a[s.sub]=r}}return r},n.getClass=function(r,i,s){var a=e[r];if(a&&a[B_]&&(a=i?a[i]:null),s&&!a)throw new Error(i?"Component "+r+"."+(i||"")+" is used but not imported.":r+".type should be specified.");return a},n.getClassesByMainType=function(r){var i=Qd(r),s=[],a=e[i.main];return a&&a[B_]?it(a,function(l,o){o!==B_&&s.push(l)}):s.push(a),s},n.hasClass=function(r){var i=Qd(r);return!!e[i.main]},n.getAllClassMainTypes=function(){var r=[];return it(e,function(i,s){r.push(s)}),r},n.hasSubTypes=function(r){var i=Qd(r),s=e[i.main];return s&&s[B_]};function t(r){var i=e[r.main];return(!i||!i[B_])&&(i=e[r.main]={},i[B_]=!0),i}}function KA(n,e){for(var t=0;t<n.length;t++)n[t][1]||(n[t][1]=n[t][0]);return e=e||!1,function(r,i,s){for(var a={},l=0;l<n.length;l++){var o=n[l][1];if(!(i&&Wi(i,o)>=0||s&&Wi(s,o)<0)){var h=r.getShallow(o,e);h!=null&&(a[n[l][0]]=h)}}return a}}var sMe=[["fill","color"],["shadowBlur"],["shadowOffsetX"],["shadowOffsetY"],["opacity"],["shadowColor"]],oMe=KA(sMe),aMe=function(){function n(){}return n.prototype.getAreaStyle=function(e,t){return oMe(this,e,t)},n}(),OF=new qT(50);function lMe(n){if(typeof n=="string"){var e=OF.get(n);return e&&e.image}else return n}function Dre(n,e,t,r,i){if(n)if(typeof n=="string"){if(e&&e.__zrImageSrc===n||!t)return e;var s=OF.get(n),a={hostEl:t,cb:r,cbPayload:i};return s?(e=s.image,!dD(e)&&s.pending.push(a)):(e=gw.loadImage(n,NX,NX),e.__zrImageSrc=n,OF.put(n,e.__cachedImgObj={image:e,pending:[a]})),e}else return n;else return e}function NX(){var n=this.__cachedImgObj;this.onload=this.onerror=this.__cachedImgObj=null;for(var e=0;e<n.pending.length;e++){var t=n.pending[e],r=t.cb;r&&r(this,t.cbPayload),t.hostEl.dirty()}n.pending.length=0}function dD(n){return n&&n.width&&n.height}var pB=/\{([a-zA-Z0-9_]+)\|([^}]*)\}/g;function cMe(n,e,t,r,i){if(!e)return"";var s=(n+"").split(`
`);i=Bre(e,t,r,i);for(var a=0,l=s.length;a<l;a++)s[a]=kre(s[a],i);return s.join(`
`)}function Bre(n,e,t,r){r=r||{};var i=Jn({},r);i.font=e,t=Ci(t,"..."),i.maxIterations=Ci(r.maxIterations,2);var s=i.minChar=Ci(r.minChar,0);i.cnCharWidth=Du("国",e);var a=i.ascCharWidth=Du("a",e);i.placeholder=Ci(r.placeholder,"");for(var l=n=Math.max(0,n-1),o=0;o<s&&l>=a;o++)l-=a;var h=Du(t,e);return h>l&&(t="",h=0),l=n-h,i.ellipsis=t,i.ellipsisWidth=h,i.contentWidth=l,i.containerWidth=n,i}function kre(n,e){var t=e.containerWidth,r=e.font,i=e.contentWidth;if(!t)return"";var s=Du(n,r);if(s<=t)return n;for(var a=0;;a++){if(s<=i||a>=e.maxIterations){n+=e.ellipsis;break}var l=a===0?uMe(n,i,e.ascCharWidth,e.cnCharWidth):s>0?Math.floor(n.length*i/s):0;n=n.substr(0,l),s=Du(n,r)}return n===""&&(n=e.placeholder),n}function uMe(n,e,t,r){for(var i=0,s=0,a=n.length;s<a&&i<e;s++){var l=n.charCodeAt(s);i+=0<=l&&l<=127?t:r}return s}function hMe(n,e){n!=null&&(n+="");var t=e.overflow,r=e.padding,i=e.font,s=t==="truncate",a=nU(i),l=Ci(e.lineHeight,a),o=!!e.backgroundColor,h=e.lineOverflow==="truncate",d=e.width,m;d!=null&&(t==="break"||t==="breakAll")?m=n?Ore(n,e.font,d,t==="breakAll",0).lines:[]:m=n?n.split(`
`):[];var _=m.length*l,y=Ci(e.height,_);if(_>y&&h){var T=Math.floor(y/l);m=m.slice(0,T)}if(n&&s&&d!=null)for(var I=Bre(d,i,e.ellipsis,{minChar:e.truncateMinChar,placeholder:e.placeholder}),C=0;C<m.length;C++)m[C]=kre(m[C],I);for(var M=y,B=0,C=0;C<m.length;C++)B=Math.max(Du(m[C],i),B);d==null&&(d=B);var k=B;return r&&(M+=r[0]+r[2],k+=r[1]+r[3],d+=r[1]+r[3]),o&&(k=d),{lines:m,height:y,outerWidth:k,outerHeight:M,lineHeight:l,calculatedLineHeight:a,contentWidth:B,contentHeight:_,width:d}}var fMe=function(){function n(){}return n}(),zX=function(){function n(e){this.tokens=[],e&&(this.tokens=e)}return n}(),dMe=function(){function n(){this.width=0,this.height=0,this.contentWidth=0,this.contentHeight=0,this.outerWidth=0,this.outerHeight=0,this.lines=[]}return n}();function pMe(n,e){var t=new dMe;if(n!=null&&(n+=""),!n)return t;for(var r=e.width,i=e.height,s=e.overflow,a=(s==="break"||s==="breakAll")&&r!=null?{width:r,accumWidth:0,breakAll:s==="breakAll"}:null,l=pB.lastIndex=0,o;(o=pB.exec(n))!=null;){var h=o.index;h>l&&mB(t,n.substring(l,h),e,a),mB(t,o[2],e,a,o[1]),l=pB.lastIndex}l<n.length&&mB(t,n.substring(l,n.length),e,a);var d=[],m=0,_=0,y=e.padding,T=s==="truncate",I=e.lineOverflow==="truncate";function C(ye,Xe,He){ye.width=Xe,ye.lineHeight=He,m+=He,_=Math.max(_,Xe)}e:for(var M=0;M<t.lines.length;M++){for(var B=t.lines[M],k=0,j=0,q=0;q<B.tokens.length;q++){var Z=B.tokens[q],te=Z.styleName&&e.rich[Z.styleName]||{},ie=Z.textPadding=te.padding,se=ie?ie[1]+ie[3]:0,ae=Z.font=te.font||e.font;Z.contentHeight=nU(ae);var fe=Ci(te.height,Z.contentHeight);if(Z.innerHeight=fe,ie&&(fe+=ie[0]+ie[2]),Z.height=fe,Z.lineHeight=XS(te.lineHeight,e.lineHeight,fe),Z.align=te&&te.align||e.align,Z.verticalAlign=te&&te.verticalAlign||"middle",I&&i!=null&&m+Z.lineHeight>i){q>0?(B.tokens=B.tokens.slice(0,q),C(B,j,k),t.lines=t.lines.slice(0,M+1)):t.lines=t.lines.slice(0,M);break e}var Se=te.width,Ee=Se==null||Se==="auto";if(typeof Se=="string"&&Se.charAt(Se.length-1)==="%")Z.percentWidth=Se,d.push(Z),Z.contentWidth=Du(Z.text,ae);else{if(Ee){var Re=te.backgroundColor,qe=Re&&Re.image;qe&&(qe=lMe(qe),dD(qe)&&(Z.width=Math.max(Z.width,qe.width*fe/qe.height)))}var Le=T&&r!=null?r-j:null;Le!=null&&Le<Z.width?!Ee||Le<se?(Z.text="",Z.width=Z.contentWidth=0):(Z.text=cMe(Z.text,Le-se,ae,e.ellipsis,{minChar:e.truncateMinChar}),Z.width=Z.contentWidth=Du(Z.text,ae)):Z.contentWidth=Du(Z.text,ae)}Z.width+=se,j+=Z.width,te&&(k=Math.max(k,Z.lineHeight))}C(B,j,k)}t.outerWidth=t.width=Ci(r,_),t.outerHeight=t.height=Ci(i,m),t.contentHeight=m,t.contentWidth=_,y&&(t.outerWidth+=y[1]+y[3],t.outerHeight+=y[0]+y[2]);for(var M=0;M<d.length;M++){var Z=d[M],dt=Z.percentWidth;Z.width=parseInt(dt,10)/100*t.width}return t}function mB(n,e,t,r,i){var s=e==="",a=i&&t.rich[i]||{},l=n.lines,o=a.font||t.font,h=!1,d,m;if(r){var _=a.padding,y=_?_[1]+_[3]:0;if(a.width!=null&&a.width!=="auto"){var T=dv(a.width,r.width)+y;l.length>0&&T+r.accumWidth>r.width&&(d=e.split(`
`),h=!0),r.accumWidth=T}else{var I=Ore(e,o,r.width,r.breakAll,r.accumWidth);r.accumWidth=I.accumWidth+y,m=I.linesWidths,d=I.lines}}else d=e.split(`
`);for(var C=0;C<d.length;C++){var M=d[C],B=new fMe;if(B.styleName=i,B.text=M,B.isLineHolder=!M&&!s,typeof a.width=="number"?B.width=a.width:B.width=m?m[C]:Du(M,o),!C&&!h){var k=(l[l.length-1]||(l[0]=new zX)).tokens,j=k.length;j===1&&k[0].isLineHolder?k[0]=B:(M||!j||s)&&k.push(B)}else l.push(new zX([B]))}}function mMe(n){var e=n.charCodeAt(0);return e>=32&&e<=591||e>=880&&e<=4351||e>=4608&&e<=5119||e>=7680&&e<=8303}var gMe=hv(",&?/;] ".split(""),function(n,e){return n[e]=!0,n},{});function vMe(n){return mMe(n)?!!gMe[n]:!0}function Ore(n,e,t,r,i){for(var s=[],a=[],l="",o="",h=0,d=0,m=0;m<n.length;m++){var _=n.charAt(m);if(_===`
`){o&&(l+=o,d+=h),s.push(l),a.push(d),l="",o="",h=0,d=0;continue}var y=Du(_,e),T=r?!1:!vMe(_);if(s.length?d+y>t:i+d+y>t){d?(l||o)&&(T?(l||(l=o,o="",h=0,d=h),s.push(l),a.push(d-h),o+=_,h+=y,l="",d=h):(o&&(l+=o,o="",h=0),s.push(l),a.push(d),l=_,d=y)):T?(s.push(o),a.push(h),o=_,h=y):(s.push(_),a.push(y));continue}d+=y,T?(o+=_,h+=y):(o&&(l+=o,o="",h=0),l+=_)}return!s.length&&!l&&(l=n,o="",h=0),o&&(l+=o),l&&(s.push(l),a.push(d)),s.length===1&&(d+=i),{accumWidth:d,lines:s,linesWidths:a}}var FF="__zr_style_"+Math.round(Math.random()*10),By={shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"#000",opacity:1,blend:"source-over"},pD={style:{shadowBlur:!0,shadowOffsetX:!0,shadowOffsetY:!0,shadowColor:!0,opacity:!0}};By[FF]=!0;var UX=["z","z2","invisible"],_Me=["invisible"],yMe=function(n){Hn(e,n);function e(t){return n.call(this,t)||this}return e.prototype._init=function(t){for(var r=io(t),i=0;i<r.length;i++){var s=r[i];s==="style"?this.useStyle(t[s]):n.prototype.attrKV.call(this,s,t[s])}this.style||this.useStyle({})},e.prototype.beforeBrush=function(){},e.prototype.afterBrush=function(){},e.prototype.innerBeforeBrush=function(){},e.prototype.innerAfterBrush=function(){},e.prototype.shouldBePainted=function(t,r,i,s){var a=this.transform;if(this.ignore||this.invisible||this.style.opacity===0||this.culling&&xMe(this,t,r)||a&&!a[0]&&!a[3])return!1;if(i&&this.__clipPaths){for(var l=0;l<this.__clipPaths.length;++l)if(this.__clipPaths[l].isZeroArea())return!1}if(s&&this.parent)for(var o=this.parent;o;){if(o.ignore)return!1;o=o.parent}return!0},e.prototype.contain=function(t,r){return this.rectContain(t,r)},e.prototype.traverse=function(t,r){t.call(r,this)},e.prototype.rectContain=function(t,r){var i=this.transformCoordToLocal(t,r),s=this.getBoundingRect();return s.contain(i[0],i[1])},e.prototype.getPaintRect=function(){var t=this._paintRect;if(!this._paintRect||this.__dirty){var r=this.transform,i=this.getBoundingRect(),s=this.style,a=s.shadowBlur||0,l=s.shadowOffsetX||0,o=s.shadowOffsetY||0;t=this._paintRect||(this._paintRect=new as(0,0,0,0)),r?as.applyTransform(t,i,r):t.copy(i),(a||l||o)&&(t.width+=a*2+Math.abs(l),t.height+=a*2+Math.abs(o),t.x=Math.min(t.x,t.x+l-a),t.y=Math.min(t.y,t.y+o-a));var h=this.dirtyRectTolerance;t.isZero()||(t.x=Math.floor(t.x-h),t.y=Math.floor(t.y-h),t.width=Math.ceil(t.width+1+h*2),t.height=Math.ceil(t.height+1+h*2))}return t},e.prototype.setPrevPaintRect=function(t){t?(this._prevPaintRect=this._prevPaintRect||new as(0,0,0,0),this._prevPaintRect.copy(t)):this._prevPaintRect=null},e.prototype.getPrevPaintRect=function(){return this._prevPaintRect},e.prototype.animateStyle=function(t){return this.animate("style",t)},e.prototype.updateDuringAnimation=function(t){t==="style"?this.dirtyStyle():this.markRedraw()},e.prototype.attrKV=function(t,r){t!=="style"?n.prototype.attrKV.call(this,t,r):this.style?this.setStyle(r):this.useStyle(r)},e.prototype.setStyle=function(t,r){return typeof t=="string"?this.style[t]=r:Jn(this.style,t),this.dirtyStyle(),this},e.prototype.dirtyStyle=function(t){t||this.markRedraw(),this.__dirty|=mS,this._rect&&(this._rect=null)},e.prototype.dirty=function(){this.dirtyStyle()},e.prototype.styleChanged=function(){return!!(this.__dirty&mS)},e.prototype.styleUpdated=function(){this.__dirty&=~mS},e.prototype.createStyle=function(t){return aD(By,t)},e.prototype.useStyle=function(t){t[FF]||(t=this.createStyle(t)),this.__inHover?this.__hoverStyle=t:this.style=t,this.dirtyStyle()},e.prototype.isStyleObject=function(t){return t[FF]},e.prototype._innerSaveToNormal=function(t){n.prototype._innerSaveToNormal.call(this,t);var r=this._normalState;t.style&&!r.style&&(r.style=this._mergeStyle(this.createStyle(),this.style)),this._savePrimaryToNormal(t,r,UX)},e.prototype._applyStateObj=function(t,r,i,s,a,l){n.prototype._applyStateObj.call(this,t,r,i,s,a,l);var o=!(r&&s),h;if(r&&r.style?a?s?h=r.style:(h=this._mergeStyle(this.createStyle(),i.style),this._mergeStyle(h,r.style)):(h=this._mergeStyle(this.createStyle(),s?this.style:i.style),this._mergeStyle(h,r.style)):o&&(h=i.style),h)if(a){var d=this.style;if(this.style=this.createStyle(o?{}:d),o)for(var m=io(d),_=0;_<m.length;_++){var y=m[_];y in h&&(h[y]=h[y],this.style[y]=d[y])}for(var T=io(h),_=0;_<T.length;_++){var y=T[_];this.style[y]=this.style[y]}this._transitionState(t,{style:h},l,this.getAnimationStyleProps())}else this.useStyle(h);for(var I=this.__inHover?_Me:UX,_=0;_<I.length;_++){var y=I[_];r&&r[y]!=null?this[y]=r[y]:o&&i[y]!=null&&(this[y]=i[y])}},e.prototype._mergeStates=function(t){for(var r=n.prototype._mergeStates.call(this,t),i,s=0;s<t.length;s++){var a=t[s];a.style&&(i=i||{},this._mergeStyle(i,a.style))}return i&&(r.style=i),r},e.prototype._mergeStyle=function(t,r){return Jn(t,r),t},e.prototype.getAnimationStyleProps=function(){return pD},e.initDefaultProps=function(){var t=e.prototype;t.type="displayable",t.invisible=!1,t.z=0,t.z2=0,t.zlevel=0,t.culling=!1,t.cursor="pointer",t.rectHover=!1,t.incremental=!1,t._rect=null,t.dirtyRectTolerance=0,t.__dirty=Iu|mS}(),e}(hD),gB=new as(0,0,0,0),vB=new as(0,0,0,0);function xMe(n,e,t){return gB.copy(n.getBoundingRect()),n.transform&&gB.applyTransform(n.transform),vB.width=e,vB.height=t,!gB.intersect(vB)}const yw=yMe;var Qc=Math.min,eu=Math.max,_B=Math.sin,yB=Math.cos,k_=Math.PI*2,TE=_w(),ME=_w(),CE=_w();function Fre(n,e,t){if(n.length!==0){for(var r=n[0],i=r[0],s=r[0],a=r[1],l=r[1],o=1;o<n.length;o++)r=n[o],i=Qc(i,r[0]),s=eu(s,r[0]),a=Qc(a,r[1]),l=eu(l,r[1]);e[0]=i,e[1]=a,t[0]=s,t[1]=l}}function VX(n,e,t,r,i,s){i[0]=Qc(n,t),i[1]=Qc(e,r),s[0]=eu(n,t),s[1]=eu(e,r)}var GX=[],HX=[];function bMe(n,e,t,r,i,s,a,l,o,h){var d=lre,m=Ua,_=d(n,t,i,a,GX);o[0]=1/0,o[1]=1/0,h[0]=-1/0,h[1]=-1/0;for(var y=0;y<_;y++){var T=m(n,t,i,a,GX[y]);o[0]=Qc(T,o[0]),h[0]=eu(T,h[0])}_=d(e,r,s,l,HX);for(var y=0;y<_;y++){var I=m(e,r,s,l,HX[y]);o[1]=Qc(I,o[1]),h[1]=eu(I,h[1])}o[0]=Qc(n,o[0]),h[0]=eu(n,h[0]),o[0]=Qc(a,o[0]),h[0]=eu(a,h[0]),o[1]=Qc(e,o[1]),h[1]=eu(e,h[1]),o[1]=Qc(l,o[1]),h[1]=eu(l,h[1])}function wMe(n,e,t,r,i,s,a,l){var o=ure,h=zl,d=eu(Qc(o(n,t,i),1),0),m=eu(Qc(o(e,r,s),1),0),_=h(n,t,i,d),y=h(e,r,s,m);a[0]=Qc(n,i,_),a[1]=Qc(e,s,y),l[0]=eu(n,i,_),l[1]=eu(e,s,y)}function SMe(n,e,t,r,i,s,a,l,o){var h=db,d=pb,m=Math.abs(i-s);if(m%k_<1e-4&&m>1e-4){l[0]=n-t,l[1]=e-r,o[0]=n+t,o[1]=e+r;return}if(TE[0]=yB(i)*t+n,TE[1]=_B(i)*r+e,ME[0]=yB(s)*t+n,ME[1]=_B(s)*r+e,h(l,TE,ME),d(o,TE,ME),i=i%k_,i<0&&(i=i+k_),s=s%k_,s<0&&(s=s+k_),i>s&&!a?s+=k_:i<s&&a&&(i+=k_),a){var _=s;s=i,i=_}for(var y=0;y<s;y+=Math.PI/2)y>i&&(CE[0]=yB(y)*t+n,CE[1]=_B(y)*r+e,h(l,CE,l),d(o,CE,o))}var Cs={M:1,L:2,C:3,Q:4,A:5,Z:6,R:7},O_=[],F_=[],Ud=[],d0=[],Vd=[],Gd=[],xB=Math.min,bB=Math.max,N_=Math.cos,z_=Math.sin,hm=Math.abs,NF=Math.PI,T0=NF*2,wB=typeof Float32Array<"u",z2=[];function SB(n){var e=Math.round(n/NF*1e8)/1e8;return e%2*NF}function Nre(n,e){var t=SB(n[0]);t<0&&(t+=T0);var r=t-n[0],i=n[1];i+=r,!e&&i-t>=T0?i=t+T0:e&&t-i>=T0?i=t-T0:!e&&t>i?i=t+(T0-SB(t-i)):e&&t<i&&(i=t-(T0-SB(i-t))),n[0]=t,n[1]=i}var Zm=function(){function n(e){this.dpr=1,this._xi=0,this._yi=0,this._x0=0,this._y0=0,this._len=0,e&&(this._saveData=!1),this._saveData&&(this.data=[])}return n.prototype.increaseVersion=function(){this._version++},n.prototype.getVersion=function(){return this._version},n.prototype.setScale=function(e,t,r){r=r||0,r>0&&(this._ux=hm(r/pP/e)||0,this._uy=hm(r/pP/t)||0)},n.prototype.setDPR=function(e){this.dpr=e},n.prototype.setContext=function(e){this._ctx=e},n.prototype.getContext=function(){return this._ctx},n.prototype.beginPath=function(){return this._ctx&&this._ctx.beginPath(),this.reset(),this},n.prototype.reset=function(){this._saveData&&(this._len=0),this._pathSegLen&&(this._pathSegLen=null,this._pathLen=0),this._version++},n.prototype.moveTo=function(e,t){return this._drawPendingPt(),this.addData(Cs.M,e,t),this._ctx&&this._ctx.moveTo(e,t),this._x0=e,this._y0=t,this._xi=e,this._yi=t,this},n.prototype.lineTo=function(e,t){var r=hm(e-this._xi),i=hm(t-this._yi),s=r>this._ux||i>this._uy;if(this.addData(Cs.L,e,t),this._ctx&&s&&this._ctx.lineTo(e,t),s)this._xi=e,this._yi=t,this._pendingPtDist=0;else{var a=r*r+i*i;a>this._pendingPtDist&&(this._pendingPtX=e,this._pendingPtY=t,this._pendingPtDist=a)}return this},n.prototype.bezierCurveTo=function(e,t,r,i,s,a){return this._drawPendingPt(),this.addData(Cs.C,e,t,r,i,s,a),this._ctx&&this._ctx.bezierCurveTo(e,t,r,i,s,a),this._xi=s,this._yi=a,this},n.prototype.quadraticCurveTo=function(e,t,r,i){return this._drawPendingPt(),this.addData(Cs.Q,e,t,r,i),this._ctx&&this._ctx.quadraticCurveTo(e,t,r,i),this._xi=r,this._yi=i,this},n.prototype.arc=function(e,t,r,i,s,a){this._drawPendingPt(),z2[0]=i,z2[1]=s,Nre(z2,a),i=z2[0],s=z2[1];var l=s-i;return this.addData(Cs.A,e,t,r,r,i,l,0,a?0:1),this._ctx&&this._ctx.arc(e,t,r,i,s,a),this._xi=N_(s)*r+e,this._yi=z_(s)*r+t,this},n.prototype.arcTo=function(e,t,r,i,s){return this._drawPendingPt(),this._ctx&&this._ctx.arcTo(e,t,r,i,s),this},n.prototype.rect=function(e,t,r,i){return this._drawPendingPt(),this._ctx&&this._ctx.rect(e,t,r,i),this.addData(Cs.R,e,t,r,i),this},n.prototype.closePath=function(){this._drawPendingPt(),this.addData(Cs.Z);var e=this._ctx,t=this._x0,r=this._y0;return e&&e.closePath(),this._xi=t,this._yi=r,this},n.prototype.fill=function(e){e&&e.fill(),this.toStatic()},n.prototype.stroke=function(e){e&&e.stroke(),this.toStatic()},n.prototype.len=function(){return this._len},n.prototype.setData=function(e){var t=e.length;!(this.data&&this.data.length===t)&&wB&&(this.data=new Float32Array(t));for(var r=0;r<t;r++)this.data[r]=e[r];this._len=t},n.prototype.appendPath=function(e){e instanceof Array||(e=[e]);for(var t=e.length,r=0,i=this._len,s=0;s<t;s++)r+=e[s].len();wB&&this.data instanceof Float32Array&&(this.data=new Float32Array(i+r));for(var s=0;s<t;s++)for(var a=e[s].data,l=0;l<a.length;l++)this.data[i++]=a[l];this._len=i},n.prototype.addData=function(e,t,r,i,s,a,l,o,h){if(this._saveData){var d=this.data;this._len+arguments.length>d.length&&(this._expandData(),d=this.data);for(var m=0;m<arguments.length;m++)d[this._len++]=arguments[m]}},n.prototype._drawPendingPt=function(){this._pendingPtDist>0&&(this._ctx&&this._ctx.lineTo(this._pendingPtX,this._pendingPtY),this._pendingPtDist=0)},n.prototype._expandData=function(){if(!(this.data instanceof Array)){for(var e=[],t=0;t<this._len;t++)e[t]=this.data[t];this.data=e}},n.prototype.toStatic=function(){if(this._saveData){this._drawPendingPt();var e=this.data;e instanceof Array&&(e.length=this._len,wB&&this._len>11&&(this.data=new Float32Array(e)))}},n.prototype.getBoundingRect=function(){Ud[0]=Ud[1]=Vd[0]=Vd[1]=Number.MAX_VALUE,d0[0]=d0[1]=Gd[0]=Gd[1]=-Number.MAX_VALUE;var e=this.data,t=0,r=0,i=0,s=0,a;for(a=0;a<this._len;){var l=e[a++],o=a===1;switch(o&&(t=e[a],r=e[a+1],i=t,s=r),l){case Cs.M:t=i=e[a++],r=s=e[a++],Vd[0]=i,Vd[1]=s,Gd[0]=i,Gd[1]=s;break;case Cs.L:VX(t,r,e[a],e[a+1],Vd,Gd),t=e[a++],r=e[a++];break;case Cs.C:bMe(t,r,e[a++],e[a++],e[a++],e[a++],e[a],e[a+1],Vd,Gd),t=e[a++],r=e[a++];break;case Cs.Q:wMe(t,r,e[a++],e[a++],e[a],e[a+1],Vd,Gd),t=e[a++],r=e[a++];break;case Cs.A:var h=e[a++],d=e[a++],m=e[a++],_=e[a++],y=e[a++],T=e[a++]+y;a+=1;var I=!e[a++];o&&(i=N_(y)*m+h,s=z_(y)*_+d),SMe(h,d,m,_,y,T,I,Vd,Gd),t=N_(T)*m+h,r=z_(T)*_+d;break;case Cs.R:i=t=e[a++],s=r=e[a++];var C=e[a++],M=e[a++];VX(i,s,i+C,s+M,Vd,Gd);break;case Cs.Z:t=i,r=s;break}db(Ud,Ud,Vd),pb(d0,d0,Gd)}return a===0&&(Ud[0]=Ud[1]=d0[0]=d0[1]=0),new as(Ud[0],Ud[1],d0[0]-Ud[0],d0[1]-Ud[1])},n.prototype._calculateLength=function(){var e=this.data,t=this._len,r=this._ux,i=this._uy,s=0,a=0,l=0,o=0;this._pathSegLen||(this._pathSegLen=[]);for(var h=this._pathSegLen,d=0,m=0,_=0;_<t;){var y=e[_++],T=_===1;T&&(s=e[_],a=e[_+1],l=s,o=a);var I=-1;switch(y){case Cs.M:s=l=e[_++],a=o=e[_++];break;case Cs.L:{var C=e[_++],M=e[_++],B=C-s,k=M-a;(hm(B)>r||hm(k)>i||_===t-1)&&(I=Math.sqrt(B*B+k*k),s=C,a=M);break}case Cs.C:{var j=e[_++],q=e[_++],C=e[_++],M=e[_++],Z=e[_++],te=e[_++];I=qAe(s,a,j,q,C,M,Z,te,10),s=Z,a=te;break}case Cs.Q:{var j=e[_++],q=e[_++],C=e[_++],M=e[_++];I=YAe(s,a,j,q,C,M,10),s=C,a=M;break}case Cs.A:var ie=e[_++],se=e[_++],ae=e[_++],fe=e[_++],Se=e[_++],Ee=e[_++],Re=Ee+Se;_+=1,T&&(l=N_(Se)*ae+ie,o=z_(Se)*fe+se),I=bB(ae,fe)*xB(T0,Math.abs(Ee)),s=N_(Re)*ae+ie,a=z_(Re)*fe+se;break;case Cs.R:{l=s=e[_++],o=a=e[_++];var qe=e[_++],Le=e[_++];I=qe*2+Le*2;break}case Cs.Z:{var B=l-s,k=o-a;I=Math.sqrt(B*B+k*k),s=l,a=o;break}}I>=0&&(h[m++]=I,d+=I)}return this._pathLen=d,d},n.prototype.rebuildPath=function(e,t){var r=this.data,i=this._ux,s=this._uy,a=this._len,l,o,h,d,m,_,y=t<1,T,I,C=0,M=0,B,k=0,j,q;if(!(y&&(this._pathSegLen||this._calculateLength(),T=this._pathSegLen,I=this._pathLen,B=t*I,!B)))e:for(var Z=0;Z<a;){var te=r[Z++],ie=Z===1;switch(ie&&(h=r[Z],d=r[Z+1],l=h,o=d),te!==Cs.L&&k>0&&(e.lineTo(j,q),k=0),te){case Cs.M:l=h=r[Z++],o=d=r[Z++],e.moveTo(h,d);break;case Cs.L:{m=r[Z++],_=r[Z++];var se=hm(m-h),ae=hm(_-d);if(se>i||ae>s){if(y){var fe=T[M++];if(C+fe>B){var Se=(B-C)/fe;e.lineTo(h*(1-Se)+m*Se,d*(1-Se)+_*Se);break e}C+=fe}e.lineTo(m,_),h=m,d=_,k=0}else{var Ee=se*se+ae*ae;Ee>k&&(j=m,q=_,k=Ee)}break}case Cs.C:{var Re=r[Z++],qe=r[Z++],Le=r[Z++],dt=r[Z++],ye=r[Z++],Xe=r[Z++];if(y){var fe=T[M++];if(C+fe>B){var Se=(B-C)/fe;fv(h,Re,Le,ye,Se,O_),fv(d,qe,dt,Xe,Se,F_),e.bezierCurveTo(O_[1],F_[1],O_[2],F_[2],O_[3],F_[3]);break e}C+=fe}e.bezierCurveTo(Re,qe,Le,dt,ye,Xe),h=ye,d=Xe;break}case Cs.Q:{var Re=r[Z++],qe=r[Z++],Le=r[Z++],dt=r[Z++];if(y){var fe=T[M++];if(C+fe>B){var Se=(B-C)/fe;fP(h,Re,Le,Se,O_),fP(d,qe,dt,Se,F_),e.quadraticCurveTo(O_[1],F_[1],O_[2],F_[2]);break e}C+=fe}e.quadraticCurveTo(Re,qe,Le,dt),h=Le,d=dt;break}case Cs.A:var He=r[Z++],_t=r[Z++],wt=r[Z++],Gt=r[Z++],at=r[Z++],Ht=r[Z++],Qt=r[Z++],rn=!r[Z++],jn=wt>Gt?wt:Gt,Bn=hm(wt-Gt)>.001,Tn=at+Ht,Pe=!1;if(y){var fe=T[M++];C+fe>B&&(Tn=at+Ht*(B-C)/fe,Pe=!0),C+=fe}if(Bn&&e.ellipse?e.ellipse(He,_t,wt,Gt,Qt,at,Tn,rn):e.arc(He,_t,jn,at,Tn,rn),Pe)break e;ie&&(l=N_(at)*wt+He,o=z_(at)*Gt+_t),h=N_(Tn)*wt+He,d=z_(Tn)*Gt+_t;break;case Cs.R:l=h=r[Z],o=d=r[Z+1],m=r[Z++],_=r[Z++];var $e=r[Z++],mn=r[Z++];if(y){var fe=T[M++];if(C+fe>B){var cn=B-C;e.moveTo(m,_),e.lineTo(m+xB(cn,$e),_),cn-=$e,cn>0&&e.lineTo(m+$e,_+xB(cn,mn)),cn-=mn,cn>0&&e.lineTo(m+bB($e-cn,0),_+mn),cn-=$e,cn>0&&e.lineTo(m,_+bB(mn-cn,0));break e}C+=fe}e.rect(m,_,$e,mn);break;case Cs.Z:if(y){var fe=T[M++];if(C+fe>B){var Se=(B-C)/fe;e.lineTo(h*(1-Se)+l*Se,d*(1-Se)+o*Se);break e}C+=fe}e.closePath(),h=l,d=o}}},n.prototype.clone=function(){var e=new n,t=this.data;return e.data=t.slice?t.slice():Array.prototype.slice.call(t),e._len=this._len,e},n.CMD=Cs,n.initDefaultProps=function(){var e=n.prototype;e._saveData=!0,e._ux=0,e._uy=0,e._pendingPtDist=0,e._version=0}(),n}();function T1(n,e,t,r,i,s,a){if(i===0)return!1;var l=i,o=0,h=n;if(a>e+l&&a>r+l||a<e-l&&a<r-l||s>n+l&&s>t+l||s<n-l&&s<t-l)return!1;if(n!==t)o=(e-r)/(n-t),h=(n*r-t*e)/(n-t);else return Math.abs(s-n)<=l/2;var d=o*s-a+h,m=d*d/(o*o+1);return m<=l/2*l/2}function AMe(n,e,t,r,i,s,a,l,o,h,d){if(o===0)return!1;var m=o;if(d>e+m&&d>r+m&&d>s+m&&d>l+m||d<e-m&&d<r-m&&d<s-m&&d<l-m||h>n+m&&h>t+m&&h>i+m&&h>a+m||h<n-m&&h<t-m&&h<i-m&&h<a-m)return!1;var _=cre(n,e,t,r,i,s,a,l,h,d,null);return _<=m/2}function TMe(n,e,t,r,i,s,a,l,o){if(a===0)return!1;var h=a;if(o>e+h&&o>r+h&&o>s+h||o<e-h&&o<r-h&&o<s-h||l>n+h&&l>t+h&&l>i+h||l<n-h&&l<t-h&&l<i-h)return!1;var d=hre(n,e,t,r,i,s,l,o,null);return d<=h/2}var jX=Math.PI*2;function Em(n){return n%=jX,n<0&&(n+=jX),n}var U2=Math.PI*2;function MMe(n,e,t,r,i,s,a,l,o){if(a===0)return!1;var h=a;l-=n,o-=e;var d=Math.sqrt(l*l+o*o);if(d-h>t||d+h<t)return!1;if(Math.abs(r-i)%U2<1e-4)return!0;if(s){var m=r;r=Em(i),i=Em(m)}else r=Em(r),i=Em(i);r>i&&(i+=U2);var _=Math.atan2(o,l);return _<0&&(_+=U2),_>=r&&_<=i||_+U2>=r&&_+U2<=i}function U_(n,e,t,r,i,s){if(s>e&&s>r||s<e&&s<r||r===e)return 0;var a=(s-e)/(r-e),l=r<e?1:-1;(a===1||a===0)&&(l=r<e?.5:-.5);var o=a*(t-n)+n;return o===i?1/0:o>i?l:0}var p0=Zm.CMD,V_=Math.PI*2,CMe=1e-4;function EMe(n,e){return Math.abs(n-e)<CMe}var yc=[-1,-1,-1],ph=[-1,-1];function IMe(){var n=ph[0];ph[0]=ph[1],ph[1]=n}function RMe(n,e,t,r,i,s,a,l,o,h){if(h>e&&h>r&&h>s&&h>l||h<e&&h<r&&h<s&&h<l)return 0;var d=hP(e,r,s,l,h,yc);if(d===0)return 0;for(var m=0,_=-1,y=void 0,T=void 0,I=0;I<d;I++){var C=yc[I],M=C===0||C===1?.5:1,B=Ua(n,t,i,a,C);B<o||(_<0&&(_=lre(e,r,s,l,ph),ph[1]<ph[0]&&_>1&&IMe(),y=Ua(e,r,s,l,ph[0]),_>1&&(T=Ua(e,r,s,l,ph[1]))),_===2?C<ph[0]?m+=y<e?M:-M:C<ph[1]?m+=T<y?M:-M:m+=l<T?M:-M:C<ph[0]?m+=y<e?M:-M:m+=l<y?M:-M)}return m}function PMe(n,e,t,r,i,s,a,l){if(l>e&&l>r&&l>s||l<e&&l<r&&l<s)return 0;var o=ZAe(e,r,s,l,yc);if(o===0)return 0;var h=ure(e,r,s);if(h>=0&&h<=1){for(var d=0,m=zl(e,r,s,h),_=0;_<o;_++){var y=yc[_]===0||yc[_]===1?.5:1,T=zl(n,t,i,yc[_]);T<a||(yc[_]<h?d+=m<e?y:-y:d+=s<m?y:-y)}return d}else{var y=yc[0]===0||yc[0]===1?.5:1,T=zl(n,t,i,yc[0]);return T<a?0:s<e?y:-y}}function LMe(n,e,t,r,i,s,a,l){if(l-=e,l>t||l<-t)return 0;var o=Math.sqrt(t*t-l*l);yc[0]=-o,yc[1]=o;var h=Math.abs(r-i);if(h<1e-4)return 0;if(h>=V_-1e-4){r=0,i=V_;var d=s?1:-1;return a>=yc[0]+n&&a<=yc[1]+n?d:0}if(r>i){var m=r;r=i,i=m}r<0&&(r+=V_,i+=V_);for(var _=0,y=0;y<2;y++){var T=yc[y];if(T+n>a){var I=Math.atan2(l,T),d=s?1:-1;I<0&&(I=V_+I),(I>=r&&I<=i||I+V_>=r&&I+V_<=i)&&(I>Math.PI/2&&I<Math.PI*1.5&&(d=-d),_+=d)}}return _}function zre(n,e,t,r,i){for(var s=n.data,a=n.len(),l=0,o=0,h=0,d=0,m=0,_,y,T=0;T<a;){var I=s[T++],C=T===1;switch(I===p0.M&&T>1&&(t||(l+=U_(o,h,d,m,r,i))),C&&(o=s[T],h=s[T+1],d=o,m=h),I){case p0.M:d=s[T++],m=s[T++],o=d,h=m;break;case p0.L:if(t){if(T1(o,h,s[T],s[T+1],e,r,i))return!0}else l+=U_(o,h,s[T],s[T+1],r,i)||0;o=s[T++],h=s[T++];break;case p0.C:if(t){if(AMe(o,h,s[T++],s[T++],s[T++],s[T++],s[T],s[T+1],e,r,i))return!0}else l+=RMe(o,h,s[T++],s[T++],s[T++],s[T++],s[T],s[T+1],r,i)||0;o=s[T++],h=s[T++];break;case p0.Q:if(t){if(TMe(o,h,s[T++],s[T++],s[T],s[T+1],e,r,i))return!0}else l+=PMe(o,h,s[T++],s[T++],s[T],s[T+1],r,i)||0;o=s[T++],h=s[T++];break;case p0.A:var M=s[T++],B=s[T++],k=s[T++],j=s[T++],q=s[T++],Z=s[T++];T+=1;var te=!!(1-s[T++]);_=Math.cos(q)*k+M,y=Math.sin(q)*j+B,C?(d=_,m=y):l+=U_(o,h,_,y,r,i);var ie=(r-M)*j/k+M;if(t){if(MMe(M,B,j,q,q+Z,te,e,ie,i))return!0}else l+=LMe(M,B,j,q,q+Z,te,ie,i);o=Math.cos(q+Z)*k+M,h=Math.sin(q+Z)*j+B;break;case p0.R:d=o=s[T++],m=h=s[T++];var se=s[T++],ae=s[T++];if(_=d+se,y=m+ae,t){if(T1(d,m,_,m,e,r,i)||T1(_,m,_,y,e,r,i)||T1(_,y,d,y,e,r,i)||T1(d,y,d,m,e,r,i))return!0}else l+=U_(_,m,_,y,r,i),l+=U_(d,y,d,m,r,i);break;case p0.Z:if(t){if(T1(o,h,d,m,e,r,i))return!0}else l+=U_(o,h,d,m,r,i);o=d,h=m;break}}return!t&&!EMe(h,m)&&(l+=U_(o,h,d,m,r,i)||0),l!==0}function DMe(n,e,t){return zre(n,0,!1,e,t)}function BMe(n,e,t,r){return zre(n,e,!0,t,r)}var Ure=ti({fill:"#000",stroke:null,strokePercent:1,fillOpacity:1,strokeOpacity:1,lineDashOffset:0,lineWidth:1,lineCap:"butt",miterLimit:10,strokeNoScale:!1,strokeFirst:!1},By),kMe={style:ti({fill:!0,stroke:!0,strokePercent:!0,fillOpacity:!0,strokeOpacity:!0,lineDashOffset:!0,lineWidth:!0,miterLimit:!0},pD.style)},AB=ZA.concat(["invisible","culling","z","z2","zlevel","parent"]),Xi=function(n){Hn(e,n);function e(t){return n.call(this,t)||this}return e.prototype.update=function(){var t=this;n.prototype.update.call(this);var r=this.style;if(r.decal){var i=this._decalEl=this._decalEl||new e;i.buildPath===e.prototype.buildPath&&(i.buildPath=function(o){t.buildPath(o,t.shape)}),i.silent=!0;var s=i.style;for(var a in r)s[a]!==r[a]&&(s[a]=r[a]);s.fill=r.fill?r.decal:null,s.decal=null,s.shadowColor=null,r.strokeFirst&&(s.stroke=null);for(var l=0;l<AB.length;++l)i[AB[l]]=this[AB[l]];i.__dirty|=Iu}else this._decalEl&&(this._decalEl=null)},e.prototype.getDecalElement=function(){return this._decalEl},e.prototype._init=function(t){var r=io(t);this.shape=this.getDefaultShape();var i=this.getDefaultStyle();i&&this.useStyle(i);for(var s=0;s<r.length;s++){var a=r[s],l=t[a];a==="style"?this.style?Jn(this.style,l):this.useStyle(l):a==="shape"?Jn(this.shape,l):n.prototype.attrKV.call(this,a,l)}this.style||this.useStyle({})},e.prototype.getDefaultStyle=function(){return null},e.prototype.getDefaultShape=function(){return{}},e.prototype.canBeInsideText=function(){return this.hasFill()},e.prototype.getInsideTextFill=function(){var t=this.style.fill;if(t!=="none"){if(Dr(t)){var r=dP(t,0);return r>.5?DF:r>.2?gTe:BF}else if(t)return BF}return DF},e.prototype.getInsideTextStroke=function(t){var r=this.style.fill;if(Dr(r)){var i=this.__zr,s=!!(i&&i.isDarkMode()),a=dP(t,0)<LF;if(s===a)return r}},e.prototype.buildPath=function(t,r,i){},e.prototype.pathUpdated=function(){this.__dirty&=~W1},e.prototype.getUpdatedPathProxy=function(t){return!this.path&&this.createPathProxy(),this.path.beginPath(),this.buildPath(this.path,this.shape,t),this.path},e.prototype.createPathProxy=function(){this.path=new Zm(!1)},e.prototype.hasStroke=function(){var t=this.style,r=t.stroke;return!(r==null||r==="none"||!(t.lineWidth>0))},e.prototype.hasFill=function(){var t=this.style,r=t.fill;return r!=null&&r!=="none"},e.prototype.getBoundingRect=function(){var t=this._rect,r=this.style,i=!t;if(i){var s=!1;this.path||(s=!0,this.createPathProxy());var a=this.path;(s||this.__dirty&W1)&&(a.beginPath(),this.buildPath(a,this.shape,!1),this.pathUpdated()),t=a.getBoundingRect()}if(this._rect=t,this.hasStroke()&&this.path&&this.path.len()>0){var l=this._rectStroke||(this._rectStroke=t.clone());if(this.__dirty||i){l.copy(t);var o=r.strokeNoScale?this.getLineScale():1,h=r.lineWidth;if(!this.hasFill()){var d=this.strokeContainThreshold;h=Math.max(h,d??4)}o>1e-10&&(l.width+=h/o,l.height+=h/o,l.x-=h/o/2,l.y-=h/o/2)}return l}return t},e.prototype.contain=function(t,r){var i=this.transformCoordToLocal(t,r),s=this.getBoundingRect(),a=this.style;if(t=i[0],r=i[1],s.contain(t,r)){var l=this.path;if(this.hasStroke()){var o=a.lineWidth,h=a.strokeNoScale?this.getLineScale():1;if(h>1e-10&&(this.hasFill()||(o=Math.max(o,this.strokeContainThreshold)),BMe(l,o/h,t,r)))return!0}if(this.hasFill())return DMe(l,t,r)}return!1},e.prototype.dirtyShape=function(){this.__dirty|=W1,this._rect&&(this._rect=null),this._decalEl&&this._decalEl.dirtyShape(),this.markRedraw()},e.prototype.dirty=function(){this.dirtyStyle(),this.dirtyShape()},e.prototype.animateShape=function(t){return this.animate("shape",t)},e.prototype.updateDuringAnimation=function(t){t==="style"?this.dirtyStyle():t==="shape"?this.dirtyShape():this.markRedraw()},e.prototype.attrKV=function(t,r){t==="shape"?this.setShape(r):n.prototype.attrKV.call(this,t,r)},e.prototype.setShape=function(t,r){var i=this.shape;return i||(i=this.shape={}),typeof t=="string"?i[t]=r:Jn(i,t),this.dirtyShape(),this},e.prototype.shapeChanged=function(){return!!(this.__dirty&W1)},e.prototype.createStyle=function(t){return aD(Ure,t)},e.prototype._innerSaveToNormal=function(t){n.prototype._innerSaveToNormal.call(this,t);var r=this._normalState;t.shape&&!r.shape&&(r.shape=Jn({},this.shape))},e.prototype._applyStateObj=function(t,r,i,s,a,l){n.prototype._applyStateObj.call(this,t,r,i,s,a,l);var o=!(r&&s),h;if(r&&r.shape?a?s?h=r.shape:(h=Jn({},i.shape),Jn(h,r.shape)):(h=Jn({},s?this.shape:i.shape),Jn(h,r.shape)):o&&(h=i.shape),h)if(a){this.shape=Jn({},this.shape);for(var d={},m=io(h),_=0;_<m.length;_++){var y=m[_];typeof h[y]=="object"?this.shape[y]=h[y]:d[y]=h[y]}this._transitionState(t,{shape:d},l)}else this.shape=h,this.dirtyShape()},e.prototype._mergeStates=function(t){for(var r=n.prototype._mergeStates.call(this,t),i,s=0;s<t.length;s++){var a=t[s];a.shape&&(i=i||{},this._mergeStyle(i,a.shape))}return i&&(r.shape=i),r},e.prototype.getAnimationStyleProps=function(){return kMe},e.prototype.isZeroArea=function(){return!1},e.extend=function(t){var r=function(s){Hn(a,s);function a(l){var o=s.call(this,l)||this;return t.init&&t.init.call(o,l),o}return a.prototype.getDefaultStyle=function(){return vi(t.style)},a.prototype.getDefaultShape=function(){return vi(t.shape)},a}(e);for(var i in t)typeof t[i]=="function"&&(r.prototype[i]=t[i]);return r},e.initDefaultProps=function(){var t=e.prototype;t.type="path",t.strokeContainThreshold=5,t.segmentIgnoreThreshold=0,t.subPixelOptimize=!1,t.autoBatch=!1,t.__dirty=Iu|mS|W1}(),e}(yw),OMe=ti({strokeFirst:!0,font:Jy,x:0,y:0,textAlign:"left",textBaseline:"top",miterLimit:2},Ure),vP=function(n){Hn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.hasStroke=function(){var t=this.style,r=t.stroke;return r!=null&&r!=="none"&&t.lineWidth>0},e.prototype.hasFill=function(){var t=this.style,r=t.fill;return r!=null&&r!=="none"},e.prototype.createStyle=function(t){return aD(OMe,t)},e.prototype.setBoundingRect=function(t){this._rect=t},e.prototype.getBoundingRect=function(){var t=this.style;if(!this._rect){var r=t.text;r!=null?r+="":r="";var i=YT(r,t.font,t.textAlign,t.textBaseline);if(i.x+=t.x||0,i.y+=t.y||0,this.hasStroke()){var s=t.lineWidth;i.x-=s/2,i.y-=s/2,i.width+=s,i.height+=s}this._rect=i}return this._rect},e.initDefaultProps=function(){var t=e.prototype;t.dirtyRectTolerance=10}(),e}(yw);vP.prototype.type="tspan";var FMe=ti({x:0,y:0},By),NMe={style:ti({x:!0,y:!0,width:!0,height:!0,sx:!0,sy:!0,sWidth:!0,sHeight:!0},pD.style)};function zMe(n){return!!(n&&typeof n!="string"&&n.width&&n.height)}var Lv=function(n){Hn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.createStyle=function(t){return aD(FMe,t)},e.prototype._getSize=function(t){var r=this.style,i=r[t];if(i!=null)return i;var s=zMe(r.image)?r.image:this.__image;if(!s)return 0;var a=t==="width"?"height":"width",l=r[a];return l==null?s[t]:s[t]/s[a]*l},e.prototype.getWidth=function(){return this._getSize("width")},e.prototype.getHeight=function(){return this._getSize("height")},e.prototype.getAnimationStyleProps=function(){return NMe},e.prototype.getBoundingRect=function(){var t=this.style;return this._rect||(this._rect=new as(t.x||0,t.y||0,this.getWidth(),this.getHeight())),this._rect},e}(yw);Lv.prototype.type="image";function UMe(n,e){var t=e.x,r=e.y,i=e.width,s=e.height,a=e.r,l,o,h,d;i<0&&(t=t+i,i=-i),s<0&&(r=r+s,s=-s),typeof a=="number"?l=o=h=d=a:a instanceof Array?a.length===1?l=o=h=d=a[0]:a.length===2?(l=h=a[0],o=d=a[1]):a.length===3?(l=a[0],o=d=a[1],h=a[2]):(l=a[0],o=a[1],h=a[2],d=a[3]):l=o=h=d=0;var m;l+o>i&&(m=l+o,l*=i/m,o*=i/m),h+d>i&&(m=h+d,h*=i/m,d*=i/m),o+h>s&&(m=o+h,o*=s/m,h*=s/m),l+d>s&&(m=l+d,l*=s/m,d*=s/m),n.moveTo(t+l,r),n.lineTo(t+i-o,r),o!==0&&n.arc(t+i-o,r+o,o,-Math.PI/2,0),n.lineTo(t+i,r+s-h),h!==0&&n.arc(t+i-h,r+s-h,h,0,Math.PI/2),n.lineTo(t+d,r+s),d!==0&&n.arc(t+d,r+s-d,d,Math.PI/2,Math.PI),n.lineTo(t,r+l),l!==0&&n.arc(t+l,r+l,l,Math.PI,Math.PI*1.5)}var gb=Math.round;function Vre(n,e,t){if(e){var r=e.x1,i=e.x2,s=e.y1,a=e.y2;n.x1=r,n.x2=i,n.y1=s,n.y2=a;var l=t&&t.lineWidth;return l&&(gb(r*2)===gb(i*2)&&(n.x1=n.x2=xy(r,l,!0)),gb(s*2)===gb(a*2)&&(n.y1=n.y2=xy(s,l,!0))),n}}function Gre(n,e,t){if(e){var r=e.x,i=e.y,s=e.width,a=e.height;n.x=r,n.y=i,n.width=s,n.height=a;var l=t&&t.lineWidth;return l&&(n.x=xy(r,l,!0),n.y=xy(i,l,!0),n.width=Math.max(xy(r+s,l,!1)-n.x,s===0?0:1),n.height=Math.max(xy(i+a,l,!1)-n.y,a===0?0:1)),n}}function xy(n,e,t){if(!e)return n;var r=gb(n*2);return(r+gb(e))%2===0?r/2:(r+(t?1:-1))/2}var VMe=function(){function n(){this.x=0,this.y=0,this.width=0,this.height=0}return n}(),GMe={},Go=function(n){Hn(e,n);function e(t){return n.call(this,t)||this}return e.prototype.getDefaultShape=function(){return new VMe},e.prototype.buildPath=function(t,r){var i,s,a,l;if(this.subPixelOptimize){var o=Gre(GMe,r,this.style);i=o.x,s=o.y,a=o.width,l=o.height,o.r=r.r,r=o}else i=r.x,s=r.y,a=r.width,l=r.height;r.r?UMe(t,r):t.rect(i,s,a,l)},e.prototype.isZeroArea=function(){return!this.shape.width||!this.shape.height},e}(Xi);Go.prototype.type="rect";var WX={fill:"#000"},XX=2,HMe={style:ti({fill:!0,stroke:!0,fillOpacity:!0,strokeOpacity:!0,lineWidth:!0,fontSize:!0,lineHeight:!0,width:!0,height:!0,textShadowColor:!0,textShadowBlur:!0,textShadowOffsetX:!0,textShadowOffsetY:!0,backgroundColor:!0,padding:!0,borderColor:!0,borderWidth:!0,borderRadius:!0},pD.style)},Ca=function(n){Hn(e,n);function e(t){var r=n.call(this)||this;return r.type="text",r._children=[],r._defaultStyle=WX,r.attr(t),r}return e.prototype.childrenRef=function(){return this._children},e.prototype.update=function(){n.prototype.update.call(this),this.styleChanged()&&this._updateSubTexts();for(var t=0;t<this._children.length;t++){var r=this._children[t];r.zlevel=this.zlevel,r.z=this.z,r.z2=this.z2,r.culling=this.culling,r.cursor=this.cursor,r.invisible=this.invisible}},e.prototype.updateTransform=function(){var t=this.innerTransformable;t?(t.updateTransform(),t.transform&&(this.transform=t.transform)):n.prototype.updateTransform.call(this)},e.prototype.getLocalTransform=function(t){var r=this.innerTransformable;return r?r.getLocalTransform(t):n.prototype.getLocalTransform.call(this,t)},e.prototype.getComputedTransform=function(){return this.__hostTarget&&(this.__hostTarget.getComputedTransform(),this.__hostTarget.updateInnerText(!0)),n.prototype.getComputedTransform.call(this)},e.prototype._updateSubTexts=function(){this._childCursor=0,qMe(this.style),this.style.rich?this._updateRichTexts():this._updatePlainTexts(),this._children.length=this._childCursor,this.styleUpdated()},e.prototype.addSelfToZr=function(t){n.prototype.addSelfToZr.call(this,t);for(var r=0;r<this._children.length;r++)this._children[r].__zr=t},e.prototype.removeSelfFromZr=function(t){n.prototype.removeSelfFromZr.call(this,t);for(var r=0;r<this._children.length;r++)this._children[r].__zr=null},e.prototype.getBoundingRect=function(){if(this.styleChanged()&&this._updateSubTexts(),!this._rect){for(var t=new as(0,0,0,0),r=this._children,i=[],s=null,a=0;a<r.length;a++){var l=r[a],o=l.getBoundingRect(),h=l.getLocalTransform(i);h?(t.copy(o),t.applyTransform(h),s=s||t.clone(),s.union(t)):(s=s||o.clone(),s.union(o))}this._rect=s||t}return this._rect},e.prototype.setDefaultTextStyle=function(t){this._defaultStyle=t||WX},e.prototype.setTextContent=function(t){},e.prototype._mergeStyle=function(t,r){if(!r)return t;var i=r.rich,s=t.rich||i&&{};return Jn(t,r),i&&s?(this._mergeRich(s,i),t.rich=s):s&&(t.rich=s),t},e.prototype._mergeRich=function(t,r){for(var i=io(r),s=0;s<i.length;s++){var a=i[s];t[a]=t[a]||{},Jn(t[a],r[a])}},e.prototype.getAnimationStyleProps=function(){return HMe},e.prototype._getOrCreateChild=function(t){var r=this._children[this._childCursor];return(!r||!(r instanceof t))&&(r=new t),this._children[this._childCursor++]=r,r.__zr=this.__zr,r.parent=this,r},e.prototype._updatePlainTexts=function(){var t=this.style,r=t.font||Jy,i=t.padding,s=QX(t),a=hMe(s,t),l=TB(t),o=!!t.backgroundColor,h=a.outerHeight,d=a.outerWidth,m=a.contentWidth,_=a.lines,y=a.lineHeight,T=this._defaultStyle,I=t.x||0,C=t.y||0,M=t.align||T.align||"left",B=t.verticalAlign||T.verticalAlign||"top",k=I,j=X1(C,a.contentHeight,B);if(l||i){var q=vS(I,d,M),Z=X1(C,h,B);l&&this._renderBackground(t,t,q,Z,d,h)}j+=y/2,i&&(k=JX(I,M,i),B==="top"?j+=i[0]:B==="bottom"&&(j-=i[2]));for(var te=0,ie=!1,se=KX("fill"in t?t.fill:(ie=!0,T.fill)),ae=YX("stroke"in t?t.stroke:!o&&(!T.autoStroke||ie)?(te=XX,T.stroke):null),fe=t.textShadowBlur>0,Se=t.width!=null&&(t.overflow==="truncate"||t.overflow==="break"||t.overflow==="breakAll"),Ee=a.calculatedLineHeight,Re=0;Re<_.length;Re++){var qe=this._getOrCreateChild(vP),Le=qe.createStyle();qe.useStyle(Le),Le.text=_[Re],Le.x=k,Le.y=j,M&&(Le.textAlign=M),Le.textBaseline="middle",Le.opacity=t.opacity,Le.strokeFirst=!0,fe&&(Le.shadowBlur=t.textShadowBlur||0,Le.shadowColor=t.textShadowColor||"transparent",Le.shadowOffsetX=t.textShadowOffsetX||0,Le.shadowOffsetY=t.textShadowOffsetY||0),Le.stroke=ae,Le.fill=se,ae&&(Le.lineWidth=t.lineWidth||te,Le.lineDash=t.lineDash,Le.lineDashOffset=t.lineDashOffset||0),Le.font=r,qX(Le,t),j+=y,Se&&qe.setBoundingRect(new as(vS(Le.x,t.width,Le.textAlign),X1(Le.y,Ee,Le.textBaseline),m,Ee))}},e.prototype._updateRichTexts=function(){var t=this.style,r=QX(t),i=pMe(r,t),s=i.width,a=i.outerWidth,l=i.outerHeight,o=t.padding,h=t.x||0,d=t.y||0,m=this._defaultStyle,_=t.align||m.align,y=t.verticalAlign||m.verticalAlign,T=vS(h,a,_),I=X1(d,l,y),C=T,M=I;o&&(C+=o[3],M+=o[0]);var B=C+s;TB(t)&&this._renderBackground(t,t,T,I,a,l);for(var k=!!t.backgroundColor,j=0;j<i.lines.length;j++){for(var q=i.lines[j],Z=q.tokens,te=Z.length,ie=q.lineHeight,se=q.width,ae=0,fe=C,Se=B,Ee=te-1,Re=void 0;ae<te&&(Re=Z[ae],!Re.align||Re.align==="left");)this._placeToken(Re,t,ie,M,fe,"left",k),se-=Re.width,fe+=Re.width,ae++;for(;Ee>=0&&(Re=Z[Ee],Re.align==="right");)this._placeToken(Re,t,ie,M,Se,"right",k),se-=Re.width,Se-=Re.width,Ee--;for(fe+=(s-(fe-C)-(B-Se)-se)/2;ae<=Ee;)Re=Z[ae],this._placeToken(Re,t,ie,M,fe+Re.width/2,"center",k),fe+=Re.width,ae++;M+=ie}},e.prototype._placeToken=function(t,r,i,s,a,l,o){var h=r.rich[t.styleName]||{};h.text=t.text;var d=t.verticalAlign,m=s+i/2;d==="top"?m=s+t.height/2:d==="bottom"&&(m=s+i-t.height/2);var _=!t.isLineHolder&&TB(h);_&&this._renderBackground(h,r,l==="right"?a-t.width:l==="center"?a-t.width/2:a,m-t.height/2,t.width,t.height);var y=!!h.backgroundColor,T=t.textPadding;T&&(a=JX(a,l,T),m-=t.height/2-T[0]-t.innerHeight/2);var I=this._getOrCreateChild(vP),C=I.createStyle();I.useStyle(C);var M=this._defaultStyle,B=!1,k=0,j=KX("fill"in h?h.fill:"fill"in r?r.fill:(B=!0,M.fill)),q=YX("stroke"in h?h.stroke:"stroke"in r?r.stroke:!y&&!o&&(!M.autoStroke||B)?(k=XX,M.stroke):null),Z=h.textShadowBlur>0||r.textShadowBlur>0;C.text=t.text,C.x=a,C.y=m,Z&&(C.shadowBlur=h.textShadowBlur||r.textShadowBlur||0,C.shadowColor=h.textShadowColor||r.textShadowColor||"transparent",C.shadowOffsetX=h.textShadowOffsetX||r.textShadowOffsetX||0,C.shadowOffsetY=h.textShadowOffsetY||r.textShadowOffsetY||0),C.textAlign=l,C.textBaseline="middle",C.font=t.font||Jy,C.opacity=XS(h.opacity,r.opacity,1),qX(C,h),q&&(C.lineWidth=XS(h.lineWidth,r.lineWidth,k),C.lineDash=Ci(h.lineDash,r.lineDash),C.lineDashOffset=r.lineDashOffset||0,C.stroke=q),j&&(C.fill=j);var te=t.contentWidth,ie=t.contentHeight;I.setBoundingRect(new as(vS(C.x,te,C.textAlign),X1(C.y,ie,C.textBaseline),te,ie))},e.prototype._renderBackground=function(t,r,i,s,a,l){var o=t.backgroundColor,h=t.borderWidth,d=t.borderColor,m=o&&o.image,_=o&&!m,y=t.borderRadius,T=this,I,C;if(_||t.lineHeight||h&&d){I=this._getOrCreateChild(Go),I.useStyle(I.createStyle()),I.style.fill=null;var M=I.shape;M.x=i,M.y=s,M.width=a,M.height=l,M.r=y,I.dirtyShape()}if(_){var B=I.style;B.fill=o||null,B.fillOpacity=Ci(t.fillOpacity,1)}else if(m){C=this._getOrCreateChild(Lv),C.onload=function(){T.dirtyStyle()};var k=C.style;k.image=o.image,k.x=i,k.y=s,k.width=a,k.height=l}if(h&&d){var B=I.style;B.lineWidth=h,B.stroke=d,B.strokeOpacity=Ci(t.strokeOpacity,1),B.lineDash=t.borderDash,B.lineDashOffset=t.borderDashOffset||0,I.strokeContainThreshold=0,I.hasFill()&&I.hasStroke()&&(B.strokeFirst=!0,B.lineWidth*=2)}var j=(I||C).style;j.shadowBlur=t.shadowBlur||0,j.shadowColor=t.shadowColor||"transparent",j.shadowOffsetX=t.shadowOffsetX||0,j.shadowOffsetY=t.shadowOffsetY||0,j.opacity=XS(t.opacity,r.opacity,1)},e.makeFont=function(t){var r="";return $Me(t)&&(r=[t.fontStyle,t.fontWeight,XMe(t.fontSize),t.fontFamily||"sans-serif"].join(" ")),r&&Jd(r)||t.textFont||t.font},e}(yw),jMe={left:!0,right:1,center:1},WMe={top:1,bottom:1,middle:1},$X=["fontStyle","fontWeight","fontSize","fontFamily"];function XMe(n){return typeof n=="string"&&(n.indexOf("px")!==-1||n.indexOf("rem")!==-1||n.indexOf("em")!==-1)?n:isNaN(+n)?q6+"px":n+"px"}function qX(n,e){for(var t=0;t<$X.length;t++){var r=$X[t],i=e[r];i!=null&&(n[r]=i)}}function $Me(n){return n.fontSize!=null||n.fontFamily||n.fontWeight}function qMe(n){return ZX(n),it(n.rich,ZX),n}function ZX(n){if(n){n.font=Ca.makeFont(n);var e=n.align;e==="middle"&&(e="center"),n.align=e==null||jMe[e]?e:"left";var t=n.verticalAlign;t==="center"&&(t="middle"),n.verticalAlign=t==null||WMe[t]?t:"top";var r=n.padding;r&&(n.padding=Yne(n.padding))}}function YX(n,e){return n==null||e<=0||n==="transparent"||n==="none"?null:n.image||n.colorStops?"#000":n}function KX(n){return n==null||n==="none"?null:n.image||n.colorStops?"#000":n}function JX(n,e,t){return e==="right"?n-t[1]:e==="center"?n+t[3]/2-t[1]/2:n+t[3]}function QX(n){var e=n.text;return e!=null&&(e+=""),e}function TB(n){return!!(n.backgroundColor||n.lineHeight||n.borderWidth&&n.borderColor)}var ji=Xs(),ZMe=function(n,e,t,r){if(r){var i=ji(r);i.dataIndex=t,i.dataType=e,i.seriesIndex=n,i.ssrType="chart",r.type==="group"&&r.traverse(function(s){var a=ji(s);a.seriesIndex=n,a.dataIndex=t,a.dataType=e,a.ssrType="chart"})}},e$=1,t$={},Hre=Xs(),aU=Xs(),lU=0,mD=1,gD=2,Lh=["emphasis","blur","select"],_P=["normal","emphasis","blur","select"],YMe=10,KMe=9,ky="highlight",UI="downplay",JS="select",VI="unselect",QS="toggleSelect";function M1(n){return n!=null&&n!=="none"}function vD(n,e,t){n.onHoverStateChange&&(n.hoverState||0)!==t&&n.onHoverStateChange(e),n.hoverState=t}function jre(n){vD(n,"emphasis",gD)}function Wre(n){n.hoverState===gD&&vD(n,"normal",lU)}function cU(n){vD(n,"blur",mD)}function Xre(n){n.hoverState===mD&&vD(n,"normal",lU)}function JMe(n){n.selected=!0}function QMe(n){n.selected=!1}function n$(n,e,t){e(n,t)}function tg(n,e,t){n$(n,e,t),n.isGroup&&n.traverse(function(r){n$(r,e,t)})}function r$(n,e){switch(e){case"emphasis":n.hoverState=gD;break;case"normal":n.hoverState=lU;break;case"blur":n.hoverState=mD;break;case"select":n.selected=!0}}function eCe(n,e,t,r){for(var i=n.style,s={},a=0;a<e.length;a++){var l=e[a],o=i[l];s[l]=o??(r&&r[l])}for(var a=0;a<n.animators.length;a++){var h=n.animators[a];h.__fromStateTransition&&h.__fromStateTransition.indexOf(t)<0&&h.targetName==="style"&&h.saveTo(s,e)}return s}function tCe(n,e,t,r){var i=t&&Wi(t,"select")>=0,s=!1;if(n instanceof Xi){var a=Hre(n),l=i&&a.selectFill||a.normalFill,o=i&&a.selectStroke||a.normalStroke;if(M1(l)||M1(o)){r=r||{};var h=r.style||{};h.fill==="inherit"?(s=!0,r=Jn({},r),h=Jn({},h),h.fill=l):!M1(h.fill)&&M1(l)?(s=!0,r=Jn({},r),h=Jn({},h),h.fill=wX(l)):!M1(h.stroke)&&M1(o)&&(s||(r=Jn({},r),h=Jn({},h)),h.stroke=wX(o)),r.style=h}}if(r&&r.z2==null){s||(r=Jn({},r));var d=n.z2EmphasisLift;r.z2=n.z2+(d??YMe)}return r}function nCe(n,e,t){if(t&&t.z2==null){t=Jn({},t);var r=n.z2SelectLift;t.z2=n.z2+(r??KMe)}return t}function rCe(n,e,t){var r=Wi(n.currentStates,e)>=0,i=n.style.opacity,s=r?null:eCe(n,["opacity"],e,{opacity:1});t=t||{};var a=t.style||{};return a.opacity==null&&(t=Jn({},t),a=Jn({opacity:r?i:s.opacity*.1},a),t.style=a),t}function MB(n,e){var t=this.states[n];if(this.style){if(n==="emphasis")return tCe(this,n,e,t);if(n==="blur")return rCe(this,n,t);if(n==="select")return nCe(this,n,t)}return t}function iCe(n){n.stateProxy=MB;var e=n.getTextContent(),t=n.getTextGuideLine();e&&(e.stateProxy=MB),t&&(t.stateProxy=MB)}function i$(n,e){!Yre(n,e)&&!n.__highByOuter&&tg(n,jre)}function s$(n,e){!Yre(n,e)&&!n.__highByOuter&&tg(n,Wre)}function Kb(n,e){n.__highByOuter|=1<<(e||0),tg(n,jre)}function Jb(n,e){!(n.__highByOuter&=~(1<<(e||0)))&&tg(n,Wre)}function sCe(n){tg(n,cU)}function $re(n){tg(n,Xre)}function qre(n){tg(n,JMe)}function Zre(n){tg(n,QMe)}function Yre(n,e){return n.__highDownSilentOnTouch&&e.zrByTouch}function Kre(n){var e=n.getModel(),t=[],r=[];e.eachComponent(function(i,s){var a=aU(s),l=i==="series",o=l?n.getViewOfSeriesModel(s):n.getViewOfComponentModel(s);!l&&r.push(o),a.isBlured&&(o.group.traverse(function(h){Xre(h)}),l&&t.push(s)),a.isBlured=!1}),it(r,function(i){i&&i.toggleBlurSeries&&i.toggleBlurSeries(t,!1,e)})}function zF(n,e,t,r){var i=r.getModel();t=t||"coordinateSystem";function s(h,d){for(var m=0;m<d.length;m++){var _=h.getItemGraphicEl(d[m]);_&&$re(_)}}if(n!=null&&!(!e||e==="none")){var a=i.getSeriesByIndex(n),l=a.coordinateSystem;l&&l.master&&(l=l.master);var o=[];i.eachSeries(function(h){var d=a===h,m=h.coordinateSystem;m&&m.master&&(m=m.master);var _=m&&l?m===l:d;if(!(t==="series"&&!d||t==="coordinateSystem"&&!_||e==="series"&&d)){var y=r.getViewOfSeriesModel(h);if(y.group.traverse(function(C){C.__highByOuter&&d&&e==="self"||cU(C)}),Ec(e))s(h.getData(),e);else if(Xr(e))for(var T=io(e),I=0;I<T.length;I++)s(h.getData(T[I]),e[T[I]]);o.push(h),aU(h).isBlured=!0}}),i.eachComponent(function(h,d){if(h!=="series"){var m=r.getViewOfComponentModel(d);m&&m.toggleBlurSeries&&m.toggleBlurSeries(o,!0,i)}})}}function UF(n,e,t){if(!(n==null||e==null)){var r=t.getModel().getComponent(n,e);if(r){aU(r).isBlured=!0;var i=t.getViewOfComponentModel(r);!i||!i.focusBlurEnabled||i.group.traverse(function(s){cU(s)})}}}function oCe(n,e,t){var r=n.seriesIndex,i=n.getData(e.dataType);if(i){var s=Qy(i,e);s=(fr(s)?s[0]:s)||0;var a=i.getItemGraphicEl(s);if(!a)for(var l=i.count(),o=0;!a&&o<l;)a=i.getItemGraphicEl(o++);if(a){var h=ji(a);zF(r,h.focus,h.blurScope,t)}else{var d=n.get(["emphasis","focus"]),m=n.get(["emphasis","blurScope"]);d!=null&&zF(r,d,m,t)}}}function uU(n,e,t,r){var i={focusSelf:!1,dispatchers:null};if(n==null||n==="series"||e==null||t==null)return i;var s=r.getModel().getComponent(n,e);if(!s)return i;var a=r.getViewOfComponentModel(s);if(!a||!a.findHighDownDispatchers)return i;for(var l=a.findHighDownDispatchers(t),o,h=0;h<l.length;h++)if(ji(l[h]).focus==="self"){o=!0;break}return{focusSelf:o,dispatchers:l}}function aCe(n,e,t){var r=ji(n),i=uU(r.componentMainType,r.componentIndex,r.componentHighDownName,t),s=i.dispatchers,a=i.focusSelf;s?(a&&UF(r.componentMainType,r.componentIndex,t),it(s,function(l){return i$(l,e)})):(zF(r.seriesIndex,r.focus,r.blurScope,t),r.focus==="self"&&UF(r.componentMainType,r.componentIndex,t),i$(n,e))}function lCe(n,e,t){Kre(t);var r=ji(n),i=uU(r.componentMainType,r.componentIndex,r.componentHighDownName,t).dispatchers;i?it(i,function(s){return s$(s,e)}):s$(n,e)}function cCe(n,e,t){if(HF(e)){var r=e.dataType,i=n.getData(r),s=Qy(i,e);fr(s)||(s=[s]),n[e.type===QS?"toggleSelect":e.type===JS?"select":"unselect"](s,r)}}function o$(n){var e=n.getAllData();it(e,function(t){var r=t.data,i=t.type;r.eachItemGraphicEl(function(s,a){n.isSelected(a,i)?qre(s):Zre(s)})})}function uCe(n){var e=[];return n.eachSeries(function(t){var r=t.getAllData();it(r,function(i){i.data;var s=i.type,a=t.getSelectedDataIndices();if(a.length>0){var l={dataIndex:a,seriesIndex:t.seriesIndex};s!=null&&(l.dataType=s),e.push(l)}})}),e}function VF(n,e,t){Jre(n,!0),tg(n,iCe),fCe(n,e,t)}function hCe(n){Jre(n,!1)}function JA(n,e,t,r){r?hCe(n):VF(n,e,t)}function fCe(n,e,t){var r=ji(n);e!=null?(r.focus=e,r.blurScope=t):r.focus&&(r.focus=null)}var a$=["emphasis","blur","select"],dCe={itemStyle:"getItemStyle",lineStyle:"getLineStyle",areaStyle:"getAreaStyle"};function yP(n,e,t,r){t=t||"itemStyle";for(var i=0;i<a$.length;i++){var s=a$[i],a=e.getModel([s,t]),l=n.ensureState(s);l.style=a[dCe[t]]()}}function Jre(n,e){var t=e===!1,r=n;n.highDownSilentOnTouch&&(r.__highDownSilentOnTouch=n.highDownSilentOnTouch),(!t||r.__highDownDispatcher)&&(r.__highByOuter=r.__highByOuter||0,r.__highDownDispatcher=!t)}function GF(n){return!!(n&&n.__highDownDispatcher)}function pCe(n){var e=t$[n];return e==null&&e$<=32&&(e=t$[n]=e$++),e}function HF(n){var e=n.type;return e===JS||e===VI||e===QS}function l$(n){var e=n.type;return e===ky||e===UI}function mCe(n){var e=Hre(n);e.normalFill=n.style.fill,e.normalStroke=n.style.stroke;var t=n.states.select||{};e.selectFill=t.style&&t.style.fill||null,e.selectStroke=t.style&&t.style.stroke||null}var C1=Zm.CMD,gCe=[[],[],[]],c$=Math.sqrt,vCe=Math.atan2;function Qre(n,e){if(e){var t=n.data,r=n.len(),i,s,a,l,o,h,d=C1.M,m=C1.C,_=C1.L,y=C1.R,T=C1.A,I=C1.Q;for(a=0,l=0;a<r;){switch(i=t[a++],l=a,s=0,i){case d:s=1;break;case _:s=1;break;case m:s=3;break;case I:s=2;break;case T:var C=e[4],M=e[5],B=c$(e[0]*e[0]+e[1]*e[1]),k=c$(e[2]*e[2]+e[3]*e[3]),j=vCe(-e[1]/k,e[0]/B);t[a]*=B,t[a++]+=C,t[a]*=k,t[a++]+=M,t[a++]*=B,t[a++]*=k,t[a++]+=j,t[a++]+=j,a+=2,l=a;break;case y:h[0]=t[a++],h[1]=t[a++],Th(h,h,e),t[l++]=h[0],t[l++]=h[1],h[0]+=t[a++],h[1]+=t[a++],Th(h,h,e),t[l++]=h[0],t[l++]=h[1]}for(o=0;o<s;o++){var q=gCe[o];q[0]=t[a++],q[1]=t[a++],Th(q,q,e),t[l++]=q[0],t[l++]=q[1]}}n.increaseVersion()}}var CB=Math.sqrt,EE=Math.sin,IE=Math.cos,V2=Math.PI;function u$(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function jF(n,e){return(n[0]*e[0]+n[1]*e[1])/(u$(n)*u$(e))}function h$(n,e){return(n[0]*e[1]<n[1]*e[0]?-1:1)*Math.acos(jF(n,e))}function f$(n,e,t,r,i,s,a,l,o,h,d){var m=o*(V2/180),_=IE(m)*(n-t)/2+EE(m)*(e-r)/2,y=-1*EE(m)*(n-t)/2+IE(m)*(e-r)/2,T=_*_/(a*a)+y*y/(l*l);T>1&&(a*=CB(T),l*=CB(T));var I=(i===s?-1:1)*CB((a*a*(l*l)-a*a*(y*y)-l*l*(_*_))/(a*a*(y*y)+l*l*(_*_)))||0,C=I*a*y/l,M=I*-l*_/a,B=(n+t)/2+IE(m)*C-EE(m)*M,k=(e+r)/2+EE(m)*C+IE(m)*M,j=h$([1,0],[(_-C)/a,(y-M)/l]),q=[(_-C)/a,(y-M)/l],Z=[(-1*_-C)/a,(-1*y-M)/l],te=h$(q,Z);if(jF(q,Z)<=-1&&(te=V2),jF(q,Z)>=1&&(te=0),te<0){var ie=Math.round(te/V2*1e6)/1e6;te=V2*2+ie%2*V2}d.addData(h,B,k,a,l,j,te,m,s)}var _Ce=/([mlvhzcqtsa])([^mlvhzcqtsa]*)/ig,yCe=/-?([0-9]*\.)?[0-9]+([eE]-?[0-9]+)?/g;function xCe(n){var e=new Zm;if(!n)return e;var t=0,r=0,i=t,s=r,a,l=Zm.CMD,o=n.match(_Ce);if(!o)return e;for(var h=0;h<o.length;h++){for(var d=o[h],m=d.charAt(0),_=void 0,y=d.match(yCe)||[],T=y.length,I=0;I<T;I++)y[I]=parseFloat(y[I]);for(var C=0;C<T;){var M=void 0,B=void 0,k=void 0,j=void 0,q=void 0,Z=void 0,te=void 0,ie=t,se=r,ae=void 0,fe=void 0;switch(m){case"l":t+=y[C++],r+=y[C++],_=l.L,e.addData(_,t,r);break;case"L":t=y[C++],r=y[C++],_=l.L,e.addData(_,t,r);break;case"m":t+=y[C++],r+=y[C++],_=l.M,e.addData(_,t,r),i=t,s=r,m="l";break;case"M":t=y[C++],r=y[C++],_=l.M,e.addData(_,t,r),i=t,s=r,m="L";break;case"h":t+=y[C++],_=l.L,e.addData(_,t,r);break;case"H":t=y[C++],_=l.L,e.addData(_,t,r);break;case"v":r+=y[C++],_=l.L,e.addData(_,t,r);break;case"V":r=y[C++],_=l.L,e.addData(_,t,r);break;case"C":_=l.C,e.addData(_,y[C++],y[C++],y[C++],y[C++],y[C++],y[C++]),t=y[C-2],r=y[C-1];break;case"c":_=l.C,e.addData(_,y[C++]+t,y[C++]+r,y[C++]+t,y[C++]+r,y[C++]+t,y[C++]+r),t+=y[C-2],r+=y[C-1];break;case"S":M=t,B=r,ae=e.len(),fe=e.data,a===l.C&&(M+=t-fe[ae-4],B+=r-fe[ae-3]),_=l.C,ie=y[C++],se=y[C++],t=y[C++],r=y[C++],e.addData(_,M,B,ie,se,t,r);break;case"s":M=t,B=r,ae=e.len(),fe=e.data,a===l.C&&(M+=t-fe[ae-4],B+=r-fe[ae-3]),_=l.C,ie=t+y[C++],se=r+y[C++],t+=y[C++],r+=y[C++],e.addData(_,M,B,ie,se,t,r);break;case"Q":ie=y[C++],se=y[C++],t=y[C++],r=y[C++],_=l.Q,e.addData(_,ie,se,t,r);break;case"q":ie=y[C++]+t,se=y[C++]+r,t+=y[C++],r+=y[C++],_=l.Q,e.addData(_,ie,se,t,r);break;case"T":M=t,B=r,ae=e.len(),fe=e.data,a===l.Q&&(M+=t-fe[ae-4],B+=r-fe[ae-3]),t=y[C++],r=y[C++],_=l.Q,e.addData(_,M,B,t,r);break;case"t":M=t,B=r,ae=e.len(),fe=e.data,a===l.Q&&(M+=t-fe[ae-4],B+=r-fe[ae-3]),t+=y[C++],r+=y[C++],_=l.Q,e.addData(_,M,B,t,r);break;case"A":k=y[C++],j=y[C++],q=y[C++],Z=y[C++],te=y[C++],ie=t,se=r,t=y[C++],r=y[C++],_=l.A,f$(ie,se,t,r,Z,te,k,j,q,_,e);break;case"a":k=y[C++],j=y[C++],q=y[C++],Z=y[C++],te=y[C++],ie=t,se=r,t+=y[C++],r+=y[C++],_=l.A,f$(ie,se,t,r,Z,te,k,j,q,_,e);break}}(m==="z"||m==="Z")&&(_=l.Z,e.addData(_),t=i,r=s),a=_}return e.toStatic(),e}var eie=function(n){Hn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.applyTransform=function(t){},e}(Xi);function tie(n){return n.setData!=null}function nie(n,e){var t=xCe(n),r=Jn({},e);return r.buildPath=function(i){if(tie(i)){i.setData(t.data);var s=i.getContext();s&&i.rebuildPath(s,1)}else{var s=i;t.rebuildPath(s,1)}},r.applyTransform=function(i){Qre(t,i),this.dirtyShape()},r}function bCe(n,e){return new eie(nie(n,e))}function wCe(n,e){var t=nie(n,e),r=function(i){Hn(s,i);function s(a){var l=i.call(this,a)||this;return l.applyTransform=t.applyTransform,l.buildPath=t.buildPath,l}return s}(eie);return r}function SCe(n,e){for(var t=[],r=n.length,i=0;i<r;i++){var s=n[i];t.push(s.getUpdatedPathProxy(!0))}var a=new Xi(e);return a.createPathProxy(),a.buildPath=function(l){if(tie(l)){l.appendPath(t);var o=l.getContext();o&&l.rebuildPath(o,1)}},a}function hU(n,e){e=e||{};var t=new Xi;return n.shape&&t.setShape(n.shape),t.setStyle(n.style),e.bakeTransform?Qre(t.path,n.getComputedTransform()):e.toLocal?t.setLocalTransform(n.getComputedTransform()):t.copyTransform(n),t.buildPath=n.buildPath,t.applyTransform=t.applyTransform,t.z=n.z,t.z2=n.z2,t.zlevel=n.zlevel,t}var ACe=function(){function n(){this.cx=0,this.cy=0,this.r=0}return n}(),rie=function(n){Hn(e,n);function e(t){return n.call(this,t)||this}return e.prototype.getDefaultShape=function(){return new ACe},e.prototype.buildPath=function(t,r){t.moveTo(r.cx+r.r,r.cy),t.arc(r.cx,r.cy,r.r,0,Math.PI*2)},e}(Xi);rie.prototype.type="circle";const _D=rie;var TCe=function(){function n(){this.cx=0,this.cy=0,this.rx=0,this.ry=0}return n}(),iie=function(n){Hn(e,n);function e(t){return n.call(this,t)||this}return e.prototype.getDefaultShape=function(){return new TCe},e.prototype.buildPath=function(t,r){var i=.5522848,s=r.cx,a=r.cy,l=r.rx,o=r.ry,h=l*i,d=o*i;t.moveTo(s-l,a),t.bezierCurveTo(s-l,a-d,s-h,a-o,s,a-o),t.bezierCurveTo(s+h,a-o,s+l,a-d,s+l,a),t.bezierCurveTo(s+l,a+d,s+h,a+o,s,a+o),t.bezierCurveTo(s-h,a+o,s-l,a+d,s-l,a),t.closePath()},e}(Xi);iie.prototype.type="ellipse";const sie=iie;var oie=Math.PI,EB=oie*2,G_=Math.sin,E1=Math.cos,MCe=Math.acos,Ol=Math.atan2,d$=Math.abs,eA=Math.sqrt,_S=Math.max,Hd=Math.min,Cf=1e-4;function CCe(n,e,t,r,i,s,a,l){var o=t-n,h=r-e,d=a-i,m=l-s,_=m*o-d*h;if(!(_*_<Cf))return _=(d*(e-s)-m*(n-i))/_,[n+_*o,e+_*h]}function RE(n,e,t,r,i,s,a){var l=n-t,o=e-r,h=(a?s:-s)/eA(l*l+o*o),d=h*o,m=-h*l,_=n+d,y=e+m,T=t+d,I=r+m,C=(_+T)/2,M=(y+I)/2,B=T-_,k=I-y,j=B*B+k*k,q=i-s,Z=_*I-T*y,te=(k<0?-1:1)*eA(_S(0,q*q*j-Z*Z)),ie=(Z*k-B*te)/j,se=(-Z*B-k*te)/j,ae=(Z*k+B*te)/j,fe=(-Z*B+k*te)/j,Se=ie-C,Ee=se-M,Re=ae-C,qe=fe-M;return Se*Se+Ee*Ee>Re*Re+qe*qe&&(ie=ae,se=fe),{cx:ie,cy:se,x0:-d,y0:-m,x1:ie*(i/q-1),y1:se*(i/q-1)}}function ECe(n){var e;if(fr(n)){var t=n.length;if(!t)return n;t===1?e=[n[0],n[0],0,0]:t===2?e=[n[0],n[0],n[1],n[1]]:t===3?e=n.concat(n[2]):e=n}else e=[n,n,n,n];return e}function ICe(n,e){var t,r=_S(e.r,0),i=_S(e.r0||0,0),s=r>0,a=i>0;if(!(!s&&!a)){if(s||(r=i,i=0),i>r){var l=r;r=i,i=l}var o=e.startAngle,h=e.endAngle;if(!(isNaN(o)||isNaN(h))){var d=e.cx,m=e.cy,_=!!e.clockwise,y=d$(h-o),T=y>EB&&y%EB;if(T>Cf&&(y=T),!(r>Cf))n.moveTo(d,m);else if(y>EB-Cf)n.moveTo(d+r*E1(o),m+r*G_(o)),n.arc(d,m,r,o,h,!_),i>Cf&&(n.moveTo(d+i*E1(h),m+i*G_(h)),n.arc(d,m,i,h,o,_));else{var I=void 0,C=void 0,M=void 0,B=void 0,k=void 0,j=void 0,q=void 0,Z=void 0,te=void 0,ie=void 0,se=void 0,ae=void 0,fe=void 0,Se=void 0,Ee=void 0,Re=void 0,qe=r*E1(o),Le=r*G_(o),dt=i*E1(h),ye=i*G_(h),Xe=y>Cf;if(Xe){var He=e.cornerRadius;He&&(t=ECe(He),I=t[0],C=t[1],M=t[2],B=t[3]);var _t=d$(r-i)/2;if(k=Hd(_t,M),j=Hd(_t,B),q=Hd(_t,I),Z=Hd(_t,C),se=te=_S(k,j),ae=ie=_S(q,Z),(te>Cf||ie>Cf)&&(fe=r*E1(h),Se=r*G_(h),Ee=i*E1(o),Re=i*G_(o),y<oie)){var wt=CCe(qe,Le,Ee,Re,fe,Se,dt,ye);if(wt){var Gt=qe-wt[0],at=Le-wt[1],Ht=fe-wt[0],Qt=Se-wt[1],rn=1/G_(MCe((Gt*Ht+at*Qt)/(eA(Gt*Gt+at*at)*eA(Ht*Ht+Qt*Qt)))/2),jn=eA(wt[0]*wt[0]+wt[1]*wt[1]);se=Hd(te,(r-jn)/(rn+1)),ae=Hd(ie,(i-jn)/(rn-1))}}}if(!Xe)n.moveTo(d+qe,m+Le);else if(se>Cf){var Bn=Hd(M,se),Tn=Hd(B,se),Pe=RE(Ee,Re,qe,Le,r,Bn,_),$e=RE(fe,Se,dt,ye,r,Tn,_);n.moveTo(d+Pe.cx+Pe.x0,m+Pe.cy+Pe.y0),se<te&&Bn===Tn?n.arc(d+Pe.cx,m+Pe.cy,se,Ol(Pe.y0,Pe.x0),Ol($e.y0,$e.x0),!_):(Bn>0&&n.arc(d+Pe.cx,m+Pe.cy,Bn,Ol(Pe.y0,Pe.x0),Ol(Pe.y1,Pe.x1),!_),n.arc(d,m,r,Ol(Pe.cy+Pe.y1,Pe.cx+Pe.x1),Ol($e.cy+$e.y1,$e.cx+$e.x1),!_),Tn>0&&n.arc(d+$e.cx,m+$e.cy,Tn,Ol($e.y1,$e.x1),Ol($e.y0,$e.x0),!_))}else n.moveTo(d+qe,m+Le),n.arc(d,m,r,o,h,!_);if(!(i>Cf)||!Xe)n.lineTo(d+dt,m+ye);else if(ae>Cf){var Bn=Hd(I,ae),Tn=Hd(C,ae),Pe=RE(dt,ye,fe,Se,i,-Tn,_),$e=RE(qe,Le,Ee,Re,i,-Bn,_);n.lineTo(d+Pe.cx+Pe.x0,m+Pe.cy+Pe.y0),ae<ie&&Bn===Tn?n.arc(d+Pe.cx,m+Pe.cy,ae,Ol(Pe.y0,Pe.x0),Ol($e.y0,$e.x0),!_):(Tn>0&&n.arc(d+Pe.cx,m+Pe.cy,Tn,Ol(Pe.y0,Pe.x0),Ol(Pe.y1,Pe.x1),!_),n.arc(d,m,i,Ol(Pe.cy+Pe.y1,Pe.cx+Pe.x1),Ol($e.cy+$e.y1,$e.cx+$e.x1),_),Bn>0&&n.arc(d+$e.cx,m+$e.cy,Bn,Ol($e.y1,$e.x1),Ol($e.y0,$e.x0),!_))}else n.lineTo(d+dt,m+ye),n.arc(d,m,i,h,o,_)}n.closePath()}}}var RCe=function(){function n(){this.cx=0,this.cy=0,this.r0=0,this.r=0,this.startAngle=0,this.endAngle=Math.PI*2,this.clockwise=!0,this.cornerRadius=0}return n}(),Dh=function(n){Hn(e,n);function e(t){return n.call(this,t)||this}return e.prototype.getDefaultShape=function(){return new RCe},e.prototype.buildPath=function(t,r){ICe(t,r)},e.prototype.isZeroArea=function(){return this.shape.startAngle===this.shape.endAngle||this.shape.r===this.shape.r0},e}(Xi);Dh.prototype.type="sector";var PCe=function(){function n(){this.cx=0,this.cy=0,this.r=0,this.r0=0}return n}(),aie=function(n){Hn(e,n);function e(t){return n.call(this,t)||this}return e.prototype.getDefaultShape=function(){return new PCe},e.prototype.buildPath=function(t,r){var i=r.cx,s=r.cy,a=Math.PI*2;t.moveTo(i+r.r,s),t.arc(i,s,r.r,0,a,!1),t.moveTo(i+r.r0,s),t.arc(i,s,r.r0,0,a,!0)},e}(Xi);aie.prototype.type="ring";const fU=aie;function LCe(n,e,t,r){var i=[],s=[],a=[],l=[],o,h,d,m;if(r){d=[1/0,1/0],m=[-1/0,-1/0];for(var _=0,y=n.length;_<y;_++)db(d,d,n[_]),pb(m,m,n[_]);db(d,d,r[0]),pb(m,m,r[1])}for(var _=0,y=n.length;_<y;_++){var T=n[_];if(t)o=n[_?_-1:y-1],h=n[(_+1)%y];else if(_===0||_===y-1){i.push(vAe(n[_]));continue}else o=n[_-1],h=n[_+1];_Ae(s,h,o),$5(s,s,e);var I=yF(T,o),C=yF(T,h),M=I+C;M!==0&&(I/=M,C/=M),$5(a,s,-I),$5(l,s,C);var B=sX([],T,a),k=sX([],T,l);r&&(pb(B,B,d),db(B,B,m),pb(k,k,d),db(k,k,m)),i.push(B),i.push(k)}return t&&i.push(i.shift()),i}function lie(n,e,t){var r=e.smooth,i=e.points;if(i&&i.length>=2){if(r){var s=LCe(i,r,t,e.smoothConstraint);n.moveTo(i[0][0],i[0][1]);for(var a=i.length,l=0;l<(t?a:a-1);l++){var o=s[l*2],h=s[l*2+1],d=i[(l+1)%a];n.bezierCurveTo(o[0],o[1],h[0],h[1],d[0],d[1])}}else{n.moveTo(i[0][0],i[0][1]);for(var l=1,m=i.length;l<m;l++)n.lineTo(i[l][0],i[l][1])}t&&n.closePath()}}var DCe=function(){function n(){this.points=null,this.smooth=0,this.smoothConstraint=null}return n}(),cie=function(n){Hn(e,n);function e(t){return n.call(this,t)||this}return e.prototype.getDefaultShape=function(){return new DCe},e.prototype.buildPath=function(t,r){lie(t,r,!0)},e}(Xi);cie.prototype.type="polygon";const yD=cie;var BCe=function(){function n(){this.points=null,this.percent=1,this.smooth=0,this.smoothConstraint=null}return n}(),xw=function(n){Hn(e,n);function e(t){return n.call(this,t)||this}return e.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},e.prototype.getDefaultShape=function(){return new BCe},e.prototype.buildPath=function(t,r){lie(t,r,!1)},e}(Xi);xw.prototype.type="polyline";var kCe={},OCe=function(){function n(){this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.percent=1}return n}(),uie=function(n){Hn(e,n);function e(t){return n.call(this,t)||this}return e.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},e.prototype.getDefaultShape=function(){return new OCe},e.prototype.buildPath=function(t,r){var i,s,a,l;if(this.subPixelOptimize){var o=Vre(kCe,r,this.style);i=o.x1,s=o.y1,a=o.x2,l=o.y2}else i=r.x1,s=r.y1,a=r.x2,l=r.y2;var h=r.percent;h!==0&&(t.moveTo(i,s),h<1&&(a=i*(1-h)+a*h,l=s*(1-h)+l*h),t.lineTo(a,l))},e.prototype.pointAt=function(t){var r=this.shape;return[r.x1*(1-t)+r.x2*t,r.y1*(1-t)+r.y2*t]},e}(Xi);uie.prototype.type="line";const Nf=uie;var Zc=[],FCe=function(){function n(){this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.cpx1=0,this.cpy1=0,this.percent=1}return n}();function p$(n,e,t){var r=n.cpx2,i=n.cpy2;return r!=null||i!=null?[(t?gX:Ua)(n.x1,n.cpx1,n.cpx2,n.x2,e),(t?gX:Ua)(n.y1,n.cpy1,n.cpy2,n.y2,e)]:[(t?vX:zl)(n.x1,n.cpx1,n.x2,e),(t?vX:zl)(n.y1,n.cpy1,n.y2,e)]}var hie=function(n){Hn(e,n);function e(t){return n.call(this,t)||this}return e.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},e.prototype.getDefaultShape=function(){return new FCe},e.prototype.buildPath=function(t,r){var i=r.x1,s=r.y1,a=r.x2,l=r.y2,o=r.cpx1,h=r.cpy1,d=r.cpx2,m=r.cpy2,_=r.percent;_!==0&&(t.moveTo(i,s),d==null||m==null?(_<1&&(fP(i,o,a,_,Zc),o=Zc[1],a=Zc[2],fP(s,h,l,_,Zc),h=Zc[1],l=Zc[2]),t.quadraticCurveTo(o,h,a,l)):(_<1&&(fv(i,o,d,a,_,Zc),o=Zc[1],d=Zc[2],a=Zc[3],fv(s,h,m,l,_,Zc),h=Zc[1],m=Zc[2],l=Zc[3]),t.bezierCurveTo(o,h,d,m,a,l)))},e.prototype.pointAt=function(t){return p$(this.shape,t,!1)},e.prototype.tangentAt=function(t){var r=p$(this.shape,t,!0);return bAe(r,r)},e}(Xi);hie.prototype.type="bezier-curve";const fie=hie;var NCe=function(){function n(){this.cx=0,this.cy=0,this.r=0,this.startAngle=0,this.endAngle=Math.PI*2,this.clockwise=!0}return n}(),xD=function(n){Hn(e,n);function e(t){return n.call(this,t)||this}return e.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},e.prototype.getDefaultShape=function(){return new NCe},e.prototype.buildPath=function(t,r){var i=r.cx,s=r.cy,a=Math.max(r.r,0),l=r.startAngle,o=r.endAngle,h=r.clockwise,d=Math.cos(l),m=Math.sin(l);t.moveTo(d*a+i,m*a+s),t.arc(i,s,a,l,o,!h)},e}(Xi);xD.prototype.type="arc";var zCe=function(n){Hn(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.type="compound",t}return e.prototype._updatePathDirty=function(){for(var t=this.shape.paths,r=this.shapeChanged(),i=0;i<t.length;i++)r=r||t[i].shapeChanged();r&&this.dirtyShape()},e.prototype.beforeBrush=function(){this._updatePathDirty();for(var t=this.shape.paths||[],r=this.getGlobalScale(),i=0;i<t.length;i++)t[i].path||t[i].createPathProxy(),t[i].path.setScale(r[0],r[1],t[i].segmentIgnoreThreshold)},e.prototype.buildPath=function(t,r){for(var i=r.paths||[],s=0;s<i.length;s++)i[s].buildPath(t,i[s].shape,!0)},e.prototype.afterBrush=function(){for(var t=this.shape.paths||[],r=0;r<t.length;r++)t[r].pathUpdated()},e.prototype.getBoundingRect=function(){return this._updatePathDirty.call(this),Xi.prototype.getBoundingRect.call(this)},e}(Xi);const UCe=zCe;var die=function(){function n(e){this.colorStops=e||[]}return n.prototype.addColorStop=function(e,t){this.colorStops.push({offset:e,color:t})},n}(),VCe=function(n){Hn(e,n);function e(t,r,i,s,a,l){var o=n.call(this,a)||this;return o.x=t??0,o.y=r??0,o.x2=i??1,o.y2=s??0,o.type="linear",o.global=l||!1,o}return e}(die);const pie=VCe;var GCe=function(n){Hn(e,n);function e(t,r,i,s,a){var l=n.call(this,s)||this;return l.x=t??.5,l.y=r??.5,l.r=i??.5,l.type="radial",l.global=a||!1,l}return e}(die);const HCe=GCe;var H_=[0,0],j_=[0,0],PE=new Jr,LE=new Jr,jCe=function(){function n(e,t){this._corners=[],this._axes=[],this._origin=[0,0];for(var r=0;r<4;r++)this._corners[r]=new Jr;for(var r=0;r<2;r++)this._axes[r]=new Jr;e&&this.fromBoundingRect(e,t)}return n.prototype.fromBoundingRect=function(e,t){var r=this._corners,i=this._axes,s=e.x,a=e.y,l=s+e.width,o=a+e.height;if(r[0].set(s,a),r[1].set(l,a),r[2].set(l,o),r[3].set(s,o),t)for(var h=0;h<4;h++)r[h].transform(t);Jr.sub(i[0],r[1],r[0]),Jr.sub(i[1],r[3],r[0]),i[0].normalize(),i[1].normalize();for(var h=0;h<2;h++)this._origin[h]=i[h].dot(r[0])},n.prototype.intersect=function(e,t){var r=!0,i=!t;return PE.set(1/0,1/0),LE.set(0,0),!this._intersectCheckOneSide(this,e,PE,LE,i,1)&&(r=!1,i)||!this._intersectCheckOneSide(e,this,PE,LE,i,-1)&&(r=!1,i)||i||Jr.copy(t,r?PE:LE),r},n.prototype._intersectCheckOneSide=function(e,t,r,i,s,a){for(var l=!0,o=0;o<2;o++){var h=this._axes[o];if(this._getProjMinMaxOnAxis(o,e._corners,H_),this._getProjMinMaxOnAxis(o,t._corners,j_),H_[1]<j_[0]||H_[0]>j_[1]){if(l=!1,s)return l;var d=Math.abs(j_[0]-H_[1]),m=Math.abs(H_[0]-j_[1]);Math.min(d,m)>i.len()&&(d<m?Jr.scale(i,h,-d*a):Jr.scale(i,h,m*a))}else if(r){var d=Math.abs(j_[0]-H_[1]),m=Math.abs(H_[0]-j_[1]);Math.min(d,m)<r.len()&&(d<m?Jr.scale(r,h,d*a):Jr.scale(r,h,-m*a))}}return l},n.prototype._getProjMinMaxOnAxis=function(e,t,r){for(var i=this._axes[e],s=this._origin,a=t[0].dot(i)+s[e],l=a,o=a,h=1;h<t.length;h++){var d=t[h].dot(i)+s[e];l=Math.min(d,l),o=Math.max(d,o)}r[0]=l,r[1]=o},n}();const xP=jCe;var WCe=[],XCe=function(n){Hn(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.notClear=!0,t.incremental=!0,t._displayables=[],t._temporaryDisplayables=[],t._cursor=0,t}return e.prototype.traverse=function(t,r){t.call(r,this)},e.prototype.useStyle=function(){this.style={}},e.prototype.getCursor=function(){return this._cursor},e.prototype.innerAfterBrush=function(){this._cursor=this._displayables.length},e.prototype.clearDisplaybles=function(){this._displayables=[],this._temporaryDisplayables=[],this._cursor=0,this.markRedraw(),this.notClear=!1},e.prototype.clearTemporalDisplayables=function(){this._temporaryDisplayables=[]},e.prototype.addDisplayable=function(t,r){r?this._temporaryDisplayables.push(t):this._displayables.push(t),this.markRedraw()},e.prototype.addDisplayables=function(t,r){r=r||!1;for(var i=0;i<t.length;i++)this.addDisplayable(t[i],r)},e.prototype.getDisplayables=function(){return this._displayables},e.prototype.getTemporalDisplayables=function(){return this._temporaryDisplayables},e.prototype.eachPendingDisplayable=function(t){for(var r=this._cursor;r<this._displayables.length;r++)t&&t(this._displayables[r]);for(var r=0;r<this._temporaryDisplayables.length;r++)t&&t(this._temporaryDisplayables[r])},e.prototype.update=function(){this.updateTransform();for(var t=this._cursor;t<this._displayables.length;t++){var r=this._displayables[t];r.parent=this,r.update(),r.parent=null}for(var t=0;t<this._temporaryDisplayables.length;t++){var r=this._temporaryDisplayables[t];r.parent=this,r.update(),r.parent=null}},e.prototype.getBoundingRect=function(){if(!this._rect){for(var t=new as(1/0,1/0,-1/0,-1/0),r=0;r<this._displayables.length;r++){var i=this._displayables[r],s=i.getBoundingRect().clone();i.needLocalTransform()&&s.applyTransform(i.getLocalTransform(WCe)),t.union(s)}this._rect=t}return this._rect},e.prototype.contain=function(t,r){var i=this.transformCoordToLocal(t,r),s=this.getBoundingRect();if(s.contain(i[0],i[1]))for(var a=0;a<this._displayables.length;a++){var l=this._displayables[a];if(l.contain(t,r))return!0}return!1},e}(yw);const $Ce=XCe;var mie=Xs();function bD(n,e,t,r,i){var s;if(e&&e.ecModel){var a=e.ecModel.getUpdatePayload();s=a&&a.animation}var l=e&&e.isAnimationEnabled(),o=n==="update";if(l){var h=void 0,d=void 0,m=void 0;r?(h=Ci(r.duration,200),d=Ci(r.easing,"cubicOut"),m=0):(h=e.getShallow(o?"animationDurationUpdate":"animationDuration"),d=e.getShallow(o?"animationEasingUpdate":"animationEasing"),m=e.getShallow(o?"animationDelayUpdate":"animationDelay")),s&&(s.duration!=null&&(h=s.duration),s.easing!=null&&(d=s.easing),s.delay!=null&&(m=s.delay)),li(m)&&(m=m(t,i)),li(h)&&(h=h(t));var _={duration:h||0,delay:m,easing:d};return _}else return null}function dU(n,e,t,r,i,s,a){var l=!1,o;li(i)?(a=s,s=i,i=null):Xr(i)&&(s=i.cb,a=i.during,l=i.isFrom,o=i.removeOpt,i=i.dataIndex);var h=n==="leave";h||e.stopAnimation("leave");var d=bD(n,r,i,h?o||{}:null,r&&r.getAnimationDelayParams?r.getAnimationDelayParams(e,i):null);if(d&&d.duration>0){var m=d.duration,_=d.delay,y=d.easing,T={duration:m,delay:_||0,easing:y,done:s,force:!!s||!!a,setToFinal:!h,scope:n,during:a};l?e.animateFrom(t,T):e.animateTo(t,T)}else e.stopAnimation(),!l&&e.attr(t),a&&a(1),s&&s()}function sl(n,e,t,r,i,s){dU("update",n,e,t,r,i,s)}function $l(n,e,t,r,i,s){dU("enter",n,e,t,r,i,s)}function Rb(n){if(!n.__zr)return!0;for(var e=0;e<n.animators.length;e++){var t=n.animators[e];if(t.scope==="leave")return!0}return!1}function bP(n,e,t,r,i,s){Rb(n)||dU("leave",n,e,t,r,i,s)}function m$(n,e,t,r){n.removeTextContent(),n.removeTextGuideLine(),bP(n,{style:{opacity:0}},e,t,r)}function wP(n,e,t){function r(){n.parent&&n.parent.remove(n)}n.isGroup?n.traverse(function(i){i.isGroup||m$(i,e,t,r)}):m$(n,e,t,r)}function pU(n){mie(n).oldStyle=n.style}function qCe(n){return mie(n).oldStyle}var SP=Math.max,AP=Math.min,WF={};function ZCe(n){return Xi.extend(n)}var YCe=wCe;function KCe(n,e){return YCe(n,e)}function id(n,e){WF[n]=e}function JCe(n){if(WF.hasOwnProperty(n))return WF[n]}function mU(n,e,t,r){var i=bCe(n,e);return t&&(r==="center"&&(t=vie(t,i.getBoundingRect())),_ie(i,t)),i}function gie(n,e,t){var r=new Lv({style:{image:n,x:e.x,y:e.y,width:e.width,height:e.height},onload:function(i){if(t==="center"){var s={width:i.width,height:i.height};r.setStyle(vie(e,s))}}});return r}function vie(n,e){var t=e.width/e.height,r=n.height*t,i;r<=n.width?i=n.height:(r=n.width,i=r/t);var s=n.x+n.width/2,a=n.y+n.height/2;return{x:s-r/2,y:a-i/2,width:r,height:i}}var Sm=SCe;function _ie(n,e){if(n.applyTransform){var t=n.getBoundingRect(),r=t.calculateTransform(e);n.applyTransform(r)}}function QA(n,e){return Vre(n,n,{lineWidth:e}),n}function QCe(n){return Gre(n.shape,n.shape,n.style),n}var eEe=xy;function gU(n,e){for(var t=eU([]);n&&n!==e;)Eb(t,n.getLocalTransform(),t),n=n.parent;return t}function wD(n,e,t){return e&&!Ec(e)&&(e=ZT.getLocalTransform(e)),t&&(e=cD([],e)),Th([],n,e)}function yie(n,e,t){var r=e[4]===0||e[5]===0||e[0]===0?1:Math.abs(2*e[4]/e[0]),i=e[4]===0||e[5]===0||e[2]===0?1:Math.abs(2*e[4]/e[2]),s=[n==="left"?-r:n==="right"?r:0,n==="top"?-i:n==="bottom"?i:0];return s=wD(s,e,t),Math.abs(s[0])>Math.abs(s[1])?s[0]>0?"right":"left":s[1]>0?"bottom":"top"}function g$(n){return!n.isGroup}function tEe(n){return n.shape!=null}function vU(n,e,t){if(!n||!e)return;function r(a){var l={};return a.traverse(function(o){g$(o)&&o.anid&&(l[o.anid]=o)}),l}function i(a){var l={x:a.x,y:a.y,rotation:a.rotation};return tEe(a)&&(l.shape=Jn({},a.shape)),l}var s=r(n);e.traverse(function(a){if(g$(a)&&a.anid){var l=s[a.anid];if(l){var o=i(a);a.attr(i(l)),sl(a,o,t,ji(a).dataIndex)}}})}function xie(n,e){return xr(n,function(t){var r=t[0];r=SP(r,e.x),r=AP(r,e.x+e.width);var i=t[1];return i=SP(i,e.y),i=AP(i,e.y+e.height),[r,i]})}function nEe(n,e){var t=SP(n.x,e.x),r=AP(n.x+n.width,e.x+e.width),i=SP(n.y,e.y),s=AP(n.y+n.height,e.y+e.height);if(r>=t&&s>=i)return{x:t,y:i,width:r-t,height:s-i}}function SD(n,e,t){var r=Jn({rectHover:!0},e),i=r.style={strokeNoScale:!0};if(t=t||{x:-1,y:-1,width:2,height:2},n)return n.indexOf("image://")===0?(i.image=n.slice(8),ti(i,t),new Lv(r)):mU(n.replace("path://",""),r,t,"center")}function rEe(n,e,t,r,i){for(var s=0,a=i[i.length-1];s<i.length;s++){var l=i[s];if(bie(n,e,t,r,l[0],l[1],a[0],a[1]))return!0;a=l}}function bie(n,e,t,r,i,s,a,l){var o=t-n,h=r-e,d=a-i,m=l-s,_=IB(d,m,o,h);if(iEe(_))return!1;var y=n-i,T=e-s,I=IB(y,T,o,h)/_;if(I<0||I>1)return!1;var C=IB(y,T,d,m)/_;return!(C<0||C>1)}function IB(n,e,t,r){return n*r-t*e}function iEe(n){return n<=1e-6&&n>=-1e-6}function AD(n){var e=n.itemTooltipOption,t=n.componentModel,r=n.itemName,i=Dr(e)?{formatter:e}:e,s=t.mainType,a=t.componentIndex,l={componentType:s,name:r,$vars:["name"]};l[s+"Index"]=a;var o=n.formatterParamsExtra;o&&it(io(o),function(d){$m(l,d)||(l[d]=o[d],l.$vars.push(d))});var h=ji(n.el);h.componentMainType=s,h.componentIndex=a,h.tooltipConfig={name:r,option:ti({content:r,encodeHTMLContent:!0,formatterParams:l},i)}}function v$(n,e){var t;n.isGroup&&(t=e(n)),t||n.traverse(e)}function TD(n,e){if(n)if(fr(n))for(var t=0;t<n.length;t++)v$(n[t],e);else v$(n,e)}id("circle",_D);id("ellipse",sie);id("sector",Dh);id("ring",fU);id("polygon",yD);id("polyline",xw);id("rect",Go);id("line",Nf);id("bezierCurve",fie);id("arc",xD);const _U=Object.freeze(Object.defineProperty({__proto__:null,Arc:xD,BezierCurve:fie,BoundingRect:as,Circle:_D,CompoundPath:UCe,Ellipse:sie,Group:pa,Image:Lv,IncrementalDisplayable:$Ce,Line:Nf,LinearGradient:pie,OrientedBoundingRect:xP,Path:Xi,Point:Jr,Polygon:yD,Polyline:xw,RadialGradient:HCe,Rect:Go,Ring:fU,Sector:Dh,Text:Ca,applyTransform:wD,clipPointsByRect:xie,clipRectByRect:nEe,createIcon:SD,extendPath:KCe,extendShape:ZCe,getShapeClass:JCe,getTransform:gU,groupTransition:vU,initProps:$l,isElementRemoved:Rb,lineLineIntersect:bie,linePolygonIntersect:rEe,makeImage:gie,makePath:mU,mergePath:Sm,registerShape:id,removeElement:bP,removeElementWithFadeOut:wP,resizePath:_ie,setTooltipConfig:AD,subPixelOptimize:eEe,subPixelOptimizeLine:QA,subPixelOptimizeRect:QCe,transformDirection:yie,traverseElements:TD,updateProps:sl},Symbol.toStringTag,{value:"Module"}));var MD={};function wie(n,e){for(var t=0;t<Lh.length;t++){var r=Lh[t],i=e[r],s=n.ensureState(r);s.style=s.style||{},s.style.text=i}var a=n.currentStates.slice();n.clearStates(!0),n.setStyle({text:e.normal}),n.useStates(a,!0)}function XF(n,e,t){var r=n.labelFetcher,i=n.labelDataIndex,s=n.labelDimIndex,a=e.normal,l;r&&(l=r.getFormattedLabel(i,"normal",null,s,a&&a.get("formatter"),t!=null?{interpolatedValue:t}:null)),l==null&&(l=li(n.defaultText)?n.defaultText(i,n,t):n.defaultText);for(var o={normal:l},h=0;h<Lh.length;h++){var d=Lh[h],m=e[d];o[d]=Ci(r?r.getFormattedLabel(i,d,null,s,m&&m.get("formatter")):null,l)}return o}function QT(n,e,t,r){t=t||MD;for(var i=n instanceof Ca,s=!1,a=0;a<_P.length;a++){var l=e[_P[a]];if(l&&l.getShallow("show")){s=!0;break}}var o=i?n:n.getTextContent();if(s){i||(o||(o=new Ca,n.setTextContent(o)),n.stateProxy&&(o.stateProxy=n.stateProxy));var h=XF(t,e),d=e.normal,m=!!d.getShallow("show"),_=Ym(d,r&&r.normal,t,!1,!i);_.text=h.normal,i||n.setTextConfig(_$(d,t,!1));for(var a=0;a<Lh.length;a++){var y=Lh[a],l=e[y];if(l){var T=o.ensureState(y),I=!!Ci(l.getShallow("show"),m);if(I!==m&&(T.ignore=!I),T.style=Ym(l,r&&r[y],t,!0,!i),T.style.text=h[y],!i){var C=n.ensureState(y);C.textConfig=_$(l,t,!0)}}}o.silent=!!d.getShallow("silent"),o.style.x!=null&&(_.x=o.style.x),o.style.y!=null&&(_.y=o.style.y),o.ignore=!m,o.useStyle(_),o.dirty(),t.enableTextSetter&&(bw(o).setLabelText=function(M){var B=XF(t,e,M);wie(o,B)})}else o&&(o.ignore=!0);n.dirty()}function eM(n,e){e=e||"label";for(var t={normal:n.getModel(e)},r=0;r<Lh.length;r++){var i=Lh[r];t[i]=n.getModel([i,e])}return t}function Ym(n,e,t,r,i){var s={};return sEe(s,n,t,r,i),e&&Jn(s,e),s}function _$(n,e,t){e=e||{};var r={},i,s=n.getShallow("rotate"),a=Ci(n.getShallow("distance"),t?null:5),l=n.getShallow("offset");return i=n.getShallow("position")||(t?null:"inside"),i==="outside"&&(i=e.defaultOutsidePosition||"top"),i!=null&&(r.position=i),l!=null&&(r.offset=l),s!=null&&(s*=Math.PI/180,r.rotation=s),a!=null&&(r.distance=a),r.outsideFill=n.get("color")==="inherit"?e.inheritColor||null:"auto",r}function sEe(n,e,t,r,i){t=t||MD;var s=e.ecModel,a=s&&s.option.textStyle,l=oEe(e),o;if(l){o={};for(var h in l)if(l.hasOwnProperty(h)){var d=e.getModel(["rich",h]);w$(o[h]={},d,a,t,r,i,!1,!0)}}o&&(n.rich=o);var m=e.get("overflow");m&&(n.overflow=m);var _=e.get("minMargin");_!=null&&(n.margin=_),w$(n,e,a,t,r,i,!0,!1)}function oEe(n){for(var e;n&&n!==n.ecModel;){var t=(n.option||MD).rich;if(t){e=e||{};for(var r=io(t),i=0;i<r.length;i++){var s=r[i];e[s]=1}}n=n.parentModel}return e}var y$=["fontStyle","fontWeight","fontSize","fontFamily","textShadowColor","textShadowBlur","textShadowOffsetX","textShadowOffsetY"],x$=["align","lineHeight","width","height","tag","verticalAlign","ellipsis"],b$=["padding","borderWidth","borderRadius","borderDashOffset","backgroundColor","borderColor","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY"];function w$(n,e,t,r,i,s,a,l){t=!i&&t||MD;var o=r&&r.inheritColor,h=e.getShallow("color"),d=e.getShallow("textBorderColor"),m=Ci(e.getShallow("opacity"),t.opacity);(h==="inherit"||h==="auto")&&(o?h=o:h=null),(d==="inherit"||d==="auto")&&(o?d=o:d=null),s||(h=h||t.color,d=d||t.textBorderColor),h!=null&&(n.fill=h),d!=null&&(n.stroke=d);var _=Ci(e.getShallow("textBorderWidth"),t.textBorderWidth);_!=null&&(n.lineWidth=_);var y=Ci(e.getShallow("textBorderType"),t.textBorderType);y!=null&&(n.lineDash=y);var T=Ci(e.getShallow("textBorderDashOffset"),t.textBorderDashOffset);T!=null&&(n.lineDashOffset=T),!i&&m==null&&!l&&(m=r&&r.defaultOpacity),m!=null&&(n.opacity=m),!i&&!s&&n.fill==null&&r.inheritColor&&(n.fill=r.inheritColor);for(var I=0;I<y$.length;I++){var C=y$[I],M=Ci(e.getShallow(C),t[C]);M!=null&&(n[C]=M)}for(var I=0;I<x$.length;I++){var C=x$[I],M=e.getShallow(C);M!=null&&(n[C]=M)}if(n.verticalAlign==null){var B=e.getShallow("baseline");B!=null&&(n.verticalAlign=B)}if(!a||!r.disableBox){for(var I=0;I<b$.length;I++){var C=b$[I],M=e.getShallow(C);M!=null&&(n[C]=M)}var k=e.getShallow("borderType");k!=null&&(n.borderDash=k),(n.backgroundColor==="auto"||n.backgroundColor==="inherit")&&o&&(n.backgroundColor=o),(n.borderColor==="auto"||n.borderColor==="inherit")&&o&&(n.borderColor=o)}}function Sie(n,e){var t=e&&e.getModel("textStyle");return Jd([n.fontStyle||t&&t.getShallow("fontStyle")||"",n.fontWeight||t&&t.getShallow("fontWeight")||"",(n.fontSize||t&&t.getShallow("fontSize")||12)+"px",n.fontFamily||t&&t.getShallow("fontFamily")||"sans-serif"].join(" "))}var bw=Xs();function aEe(n,e,t,r){if(n){var i=bw(n);i.prevValue=i.value,i.value=t;var s=e.normal;i.valueAnimation=s.get("valueAnimation"),i.valueAnimation&&(i.precision=s.get("precision"),i.defaultInterpolatedText=r,i.statesModels=e)}}function lEe(n,e,t,r,i){var s=bw(n);if(!s.valueAnimation||s.prevValue===s.value)return;var a=s.defaultInterpolatedText,l=Ci(s.interpolatedValue,s.prevValue),o=s.value;function h(d){var m=Rre(t,s.precision,l,o,d);s.interpolatedValue=d===1?null:m;var _=XF({labelDataIndex:e,labelFetcher:i,defaultText:a?a(m):m+""},s.statesModels,m);wie(n,_)}n.percent=0,(s.prevValue==null?$l:sl)(n,{percent:1},r,e,null,h)}var cEe=["textStyle","color"],RB=["fontStyle","fontWeight","fontSize","fontFamily","padding","lineHeight","rich","width","height","overflow"],PB=new Ca,uEe=function(){function n(){}return n.prototype.getTextColor=function(e){var t=this.ecModel;return this.getShallow("color")||(!e&&t?t.get(cEe):null)},n.prototype.getFont=function(){return Sie({fontStyle:this.getShallow("fontStyle"),fontWeight:this.getShallow("fontWeight"),fontSize:this.getShallow("fontSize"),fontFamily:this.getShallow("fontFamily")},this.ecModel)},n.prototype.getTextRect=function(e){for(var t={text:e,verticalAlign:this.getShallow("verticalAlign")||this.getShallow("baseline")},r=0;r<RB.length;r++)t[RB[r]]=this.getShallow(RB[r]);return PB.useStyle(t),PB.update(),PB.getBoundingRect()},n}(),Aie=[["lineWidth","width"],["stroke","color"],["opacity"],["shadowBlur"],["shadowOffsetX"],["shadowOffsetY"],["shadowColor"],["lineDash","type"],["lineDashOffset","dashOffset"],["lineCap","cap"],["lineJoin","join"],["miterLimit"]],hEe=KA(Aie),fEe=function(){function n(){}return n.prototype.getLineStyle=function(e){return hEe(this,e)},n}(),Tie=[["fill","color"],["stroke","borderColor"],["lineWidth","borderWidth"],["opacity"],["shadowBlur"],["shadowOffsetX"],["shadowOffsetY"],["shadowColor"],["lineDash","borderType"],["lineDashOffset","borderDashOffset"],["lineCap","borderCap"],["lineJoin","borderJoin"],["miterLimit","borderMiterLimit"]],dEe=KA(Tie),pEe=function(){function n(){}return n.prototype.getItemStyle=function(e,t){return dEe(this,e,t)},n}(),Io=function(){function n(e,t,r){this.parentModel=t,this.ecModel=r,this.option=e}return n.prototype.init=function(e,t,r){},n.prototype.mergeOption=function(e,t){Li(this.option,e,!0)},n.prototype.get=function(e,t){return e==null?this.option:this._doGet(this.parsePath(e),!t&&this.parentModel)},n.prototype.getShallow=function(e,t){var r=this.option,i=r==null?r:r[e];if(i==null&&!t){var s=this.parentModel;s&&(i=s.getShallow(e))}return i},n.prototype.getModel=function(e,t){var r=e!=null,i=r?this.parsePath(e):null,s=r?this._doGet(i):this.option;return t=t||this.parentModel&&this.parentModel.getModel(this.resolveParentPath(i)),new n(s,t,this.ecModel)},n.prototype.isEmpty=function(){return this.option==null},n.prototype.restoreData=function(){},n.prototype.clone=function(){var e=this.constructor;return new e(vi(this.option))},n.prototype.parsePath=function(e){return typeof e=="string"?e.split("."):e},n.prototype.resolveParentPath=function(e){return e},n.prototype.isAnimationEnabled=function(){if(!pi.node&&this.option){if(this.option.animation!=null)return!!this.option.animation;if(this.parentModel)return this.parentModel.isAnimationEnabled()}},n.prototype._doGet=function(e,t){var r=this.option;if(!e)return r;for(var i=0;i<e.length&&!(e[i]&&(r=r&&typeof r=="object"?r[e[i]]:null,r==null));i++);return r==null&&t&&(r=t._doGet(this.resolveParentPath(e),t.parentModel)),r},n}();oU(Io);nMe(Io);nd(Io,fEe);nd(Io,pEe);nd(Io,aMe);nd(Io,uEe);var mEe=Math.round(Math.random()*10);function tM(n){return[n||"",mEe++].join("_")}function gEe(n){var e={};n.registerSubTypeDefaulter=function(t,r){var i=Qd(t);e[i.main]=r},n.determineSubType=function(t,r){var i=r.type;if(!i){var s=Qd(t).main;n.hasSubTypes(t)&&e[s]&&(i=e[s](r))}return i}}function vEe(n,e){n.topologicalTravel=function(s,a,l,o){if(!s.length)return;var h=t(a),d=h.graph,m=h.noEntryList,_={};for(it(s,function(B){_[B]=!0});m.length;){var y=m.pop(),T=d[y],I=!!_[y];I&&(l.call(o,y,T.originalDeps.slice()),delete _[y]),it(T.successor,I?M:C)}it(_,function(){var B="";throw new Error(B)});function C(B){d[B].entryCount--,d[B].entryCount===0&&m.push(B)}function M(B){_[B]=!0,C(B)}};function t(s){var a={},l=[];return it(s,function(o){var h=r(a,o),d=h.originalDeps=e(o),m=i(d,s);h.entryCount=m.length,h.entryCount===0&&l.push(o),it(m,function(_){Wi(h.predecessor,_)<0&&h.predecessor.push(_);var y=r(a,_);Wi(y.successor,_)<0&&y.successor.push(o)})}),{graph:a,noEntryList:l}}function r(s,a){return s[a]||(s[a]={predecessor:[],successor:[]}),s[a]}function i(s,a){var l=[];return it(s,function(o){Wi(a,o)>=0&&l.push(o)}),l}}function Mie(n,e){return Li(Li({},n,!0),e,!0)}const _Ee={time:{month:["January","February","March","April","May","June","July","August","September","October","November","December"],monthAbbr:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayOfWeek:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayOfWeekAbbr:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},legend:{selector:{all:"All",inverse:"Inv"}},toolbox:{brush:{title:{rect:"Box Select",polygon:"Lasso Select",lineX:"Horizontally Select",lineY:"Vertically Select",keep:"Keep Selections",clear:"Clear Selections"}},dataView:{title:"Data View",lang:["Data View","Close","Refresh"]},dataZoom:{title:{zoom:"Zoom",back:"Zoom Reset"}},magicType:{title:{line:"Switch to Line Chart",bar:"Switch to Bar Chart",stack:"Stack",tiled:"Tile"}},restore:{title:"Restore"},saveAsImage:{title:"Save as Image",lang:["Right Click to Save Image"]}},series:{typeNames:{pie:"Pie chart",bar:"Bar chart",line:"Line chart",scatter:"Scatter plot",effectScatter:"Ripple scatter plot",radar:"Radar chart",tree:"Tree",treemap:"Treemap",boxplot:"Boxplot",candlestick:"Candlestick",k:"K line chart",heatmap:"Heat map",map:"Map",parallel:"Parallel coordinate map",lines:"Line graph",graph:"Relationship graph",sankey:"Sankey diagram",funnel:"Funnel chart",gauge:"Gauge",pictorialBar:"Pictorial bar",themeRiver:"Theme River Map",sunburst:"Sunburst",custom:"Custom chart",chart:"Chart"}},aria:{general:{withTitle:'This is a chart about "{title}"',withoutTitle:"This is a chart"},series:{single:{prefix:"",withName:" with type {seriesType} named {seriesName}.",withoutName:" with type {seriesType}."},multiple:{prefix:". It consists of {seriesCount} series count.",withName:" The {seriesId} series is a {seriesType} representing {seriesName}.",withoutName:" The {seriesId} series is a {seriesType}.",separator:{middle:"",end:""}}},data:{allData:"The data is as follows: ",partialData:"The first {displayCnt} items are: ",withName:"the data for {name} is {value}",withoutName:"{value}",separator:{middle:", ",end:". "}}}},yEe={time:{month:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],monthAbbr:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],dayOfWeek:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],dayOfWeekAbbr:["日","一","二","三","四","五","六"]},legend:{selector:{all:"全选",inverse:"反选"}},toolbox:{brush:{title:{rect:"矩形选择",polygon:"圈选",lineX:"横向选择",lineY:"纵向选择",keep:"保持选择",clear:"清除选择"}},dataView:{title:"数据视图",lang:["数据视图","关闭","刷新"]},dataZoom:{title:{zoom:"区域缩放",back:"区域缩放还原"}},magicType:{title:{line:"切换为折线图",bar:"切换为柱状图",stack:"切换为堆叠",tiled:"切换为平铺"}},restore:{title:"还原"},saveAsImage:{title:"保存为图片",lang:["右键另存为图片"]}},series:{typeNames:{pie:"饼图",bar:"柱状图",line:"折线图",scatter:"散点图",effectScatter:"涟漪散点图",radar:"雷达图",tree:"树图",treemap:"矩形树图",boxplot:"箱型图",candlestick:"K线图",k:"K线图",heatmap:"热力图",map:"地图",parallel:"平行坐标图",lines:"线图",graph:"关系图",sankey:"桑基图",funnel:"漏斗图",gauge:"仪表盘图",pictorialBar:"象形柱图",themeRiver:"主题河流图",sunburst:"旭日图",custom:"自定义图表",chart:"图表"}},aria:{general:{withTitle:"这是一个关于“{title}”的图表。",withoutTitle:"这是一个图表，"},series:{single:{prefix:"",withName:"图表类型是{seriesType}，表示{seriesName}。",withoutName:"图表类型是{seriesType}。"},multiple:{prefix:"它由{seriesCount}个图表系列组成。",withName:"第{seriesId}个系列是一个表示{seriesName}的{seriesType}，",withoutName:"第{seriesId}个系列是一个{seriesType}，",separator:{middle:"；",end:"。"}}},data:{allData:"其数据是——",partialData:"其中，前{displayCnt}项是——",withName:"{name}的数据是{value}",withoutName:"{value}",separator:{middle:"，",end:""}}}};var TP="ZH",yU="EN",Pb=yU,GI={},xU={},Cie=pi.domSupported?function(){var n=(document.documentElement.lang||navigator.language||navigator.browserLanguage||Pb).toUpperCase();return n.indexOf(TP)>-1?TP:Pb}():Pb;function Eie(n,e){n=n.toUpperCase(),xU[n]=new Io(e),GI[n]=e}function xEe(n){if(Dr(n)){var e=GI[n.toUpperCase()]||{};return n===TP||n===yU?vi(e):Li(vi(e),vi(GI[Pb]),!1)}else return Li(vi(n),vi(GI[Pb]),!1)}function bEe(n){return xU[n]}function wEe(){return xU[Pb]}Eie(yU,_Ee);Eie(TP,yEe);var bU=1e3,wU=bU*60,tA=wU*60,yh=tA*24,S$=yh*365,yS={year:"{yyyy}",month:"{MMM}",day:"{d}",hour:"{HH}:{mm}",minute:"{HH}:{mm}",second:"{HH}:{mm}:{ss}",millisecond:"{HH}:{mm}:{ss} {SSS}",none:"{yyyy}-{MM}-{dd} {HH}:{mm}:{ss} {SSS}"},DE="{yyyy}-{MM}-{dd}",A$={year:"{yyyy}",month:"{yyyy}-{MM}",day:DE,hour:DE+" "+yS.hour,minute:DE+" "+yS.minute,second:DE+" "+yS.second,millisecond:yS.none},LB=["year","month","day","hour","minute","second","millisecond"],Iie=["year","half-year","quarter","month","week","half-week","day","half-day","quarter-day","hour","minute","second","millisecond"];function m0(n,e){return n+="","0000".substr(0,e-n.length)+n}function Lb(n){switch(n){case"half-year":case"quarter":return"month";case"week":case"half-week":return"day";case"half-day":case"quarter-day":return"hour";default:return n}}function SEe(n){return n===Lb(n)}function AEe(n){switch(n){case"year":case"month":return"day";case"millisecond":return"millisecond";default:return"second"}}function CD(n,e,t,r){var i=qm(n),s=i[SU(t)](),a=i[Db(t)]()+1,l=Math.floor((a-1)/3)+1,o=i[ED(t)](),h=i["get"+(t?"UTC":"")+"Day"](),d=i[eT(t)](),m=(d-1)%12+1,_=i[ID(t)](),y=i[RD(t)](),T=i[PD(t)](),I=d>=12?"pm":"am",C=I.toUpperCase(),M=r instanceof Io?r:bEe(r||Cie)||wEe(),B=M.getModel("time"),k=B.get("month"),j=B.get("monthAbbr"),q=B.get("dayOfWeek"),Z=B.get("dayOfWeekAbbr");return(e||"").replace(/{a}/g,I+"").replace(/{A}/g,C+"").replace(/{yyyy}/g,s+"").replace(/{yy}/g,m0(s%100+"",2)).replace(/{Q}/g,l+"").replace(/{MMMM}/g,k[a-1]).replace(/{MMM}/g,j[a-1]).replace(/{MM}/g,m0(a,2)).replace(/{M}/g,a+"").replace(/{dd}/g,m0(o,2)).replace(/{d}/g,o+"").replace(/{eeee}/g,q[h]).replace(/{ee}/g,Z[h]).replace(/{e}/g,h+"").replace(/{HH}/g,m0(d,2)).replace(/{H}/g,d+"").replace(/{hh}/g,m0(m+"",2)).replace(/{h}/g,m+"").replace(/{mm}/g,m0(_,2)).replace(/{m}/g,_+"").replace(/{ss}/g,m0(y,2)).replace(/{s}/g,y+"").replace(/{SSS}/g,m0(T,3)).replace(/{S}/g,T+"")}function TEe(n,e,t,r,i){var s=null;if(Dr(t))s=t;else if(li(t))s=t(n.value,e,{level:n.level});else{var a=Jn({},yS);if(n.level>0)for(var l=0;l<LB.length;++l)a[LB[l]]="{primary|"+a[LB[l]]+"}";var o=t?t.inherit===!1?t:ti(t,a):a,h=Rie(n.value,i);if(o[h])s=o[h];else if(o.inherit){for(var d=Iie.indexOf(h),l=d-1;l>=0;--l)if(o[h]){s=o[h];break}s=s||a.none}if(fr(s)){var m=n.level==null?0:n.level>=0?n.level:s.length+n.level;m=Math.min(m,s.length-1),s=s[m]}}return CD(new Date(n.value),s,i,r)}function Rie(n,e){var t=qm(n),r=t[Db(e)]()+1,i=t[ED(e)](),s=t[eT(e)](),a=t[ID(e)](),l=t[RD(e)](),o=t[PD(e)](),h=o===0,d=h&&l===0,m=d&&a===0,_=m&&s===0,y=_&&i===1,T=y&&r===1;return T?"year":y?"month":_?"day":m?"hour":d?"minute":h?"second":"millisecond"}function T$(n,e,t){var r=Is(n)?qm(n):n;switch(e=e||Rie(n,t),e){case"year":return r[SU(t)]();case"half-year":return r[Db(t)]()>=6?1:0;case"quarter":return Math.floor((r[Db(t)]()+1)/4);case"month":return r[Db(t)]();case"day":return r[ED(t)]();case"half-day":return r[eT(t)]()/24;case"hour":return r[eT(t)]();case"minute":return r[ID(t)]();case"second":return r[RD(t)]();case"millisecond":return r[PD(t)]()}}function SU(n){return n?"getUTCFullYear":"getFullYear"}function Db(n){return n?"getUTCMonth":"getMonth"}function ED(n){return n?"getUTCDate":"getDate"}function eT(n){return n?"getUTCHours":"getHours"}function ID(n){return n?"getUTCMinutes":"getMinutes"}function RD(n){return n?"getUTCSeconds":"getSeconds"}function PD(n){return n?"getUTCMilliseconds":"getMilliseconds"}function MEe(n){return n?"setUTCFullYear":"setFullYear"}function Pie(n){return n?"setUTCMonth":"setMonth"}function Lie(n){return n?"setUTCDate":"setDate"}function Die(n){return n?"setUTCHours":"setHours"}function Bie(n){return n?"setUTCMinutes":"setMinutes"}function kie(n){return n?"setUTCSeconds":"setSeconds"}function Oie(n){return n?"setUTCMilliseconds":"setMilliseconds"}function Fie(n){if(!kTe(n))return Dr(n)?n:"-";var e=(n+"").split(".");return e[0].replace(/(\d{1,3})(?=(?:\d{3})+(?!\d))/g,"$1,")+(e.length>1?"."+e[1]:"")}function Nie(n,e){return n=(n||"").toLowerCase().replace(/-(.)/g,function(t,r){return r.toUpperCase()}),e&&n&&(n=n.charAt(0).toUpperCase()+n.slice(1)),n}var LD=Yne;function $F(n,e,t){var r="{yyyy}-{MM}-{dd} {HH}:{mm}:{ss}";function i(d){return d&&Jd(d)?d:"-"}function s(d){return!!(d!=null&&!isNaN(d)&&isFinite(d))}var a=e==="time",l=n instanceof Date;if(a||l){var o=a?qm(n):n;if(isNaN(+o)){if(l)return"-"}else return CD(o,r,t)}if(e==="ordinal")return _F(n)?i(n):Is(n)&&s(n)?n+"":"-";var h=pv(n);return s(h)?Fie(h):_F(n)?i(n):typeof n=="boolean"?n+"":"-"}var M$=["a","b","c","d","e","f","g"],DB=function(n,e){return"{"+n+(e??"")+"}"};function zie(n,e,t){fr(e)||(e=[e]);var r=e.length;if(!r)return"";for(var i=e[0].$vars||[],s=0;s<i.length;s++){var a=M$[s];n=n.replace(DB(a),DB(a,0))}for(var l=0;l<r;l++)for(var o=0;o<i.length;o++){var h=e[l][i[o]];n=n.replace(DB(M$[o],l),t?Eu(h):h)}return n}function CEe(n,e){var t=Dr(n)?{color:n,extraCssText:e}:n||{},r=t.color,i=t.type;e=t.extraCssText;var s=t.renderMode||"html";if(!r)return"";if(s==="html")return i==="subItem"?'<span style="display:inline-block;vertical-align:middle;margin-right:8px;margin-left:3px;border-radius:4px;width:4px;height:4px;background-color:'+Eu(r)+";"+(e||"")+'"></span>':'<span style="display:inline-block;margin-right:4px;border-radius:10px;width:10px;height:10px;background-color:'+Eu(r)+";"+(e||"")+'"></span>';var a=t.markerId||"markerX";return{renderMode:s,content:"{"+a+"|}  ",style:i==="subItem"?{width:4,height:4,borderRadius:2,backgroundColor:r}:{width:10,height:10,borderRadius:5,backgroundColor:r}}}function ex(n,e){return e=e||"transparent",Dr(n)?n:Xr(n)&&n.colorStops&&(n.colorStops[0]||{}).color||e}function C$(n,e){if(e==="_blank"||e==="blank"){var t=window.open();t.opener=null,t.location.href=n}else window.open(n,e)}var HI=it,EEe=["left","right","top","bottom","width","height"],BE=[["width","left","right"],["height","top","bottom"]];function AU(n,e,t,r,i){var s=0,a=0;r==null&&(r=1/0),i==null&&(i=1/0);var l=0;e.eachChild(function(o,h){var d=o.getBoundingRect(),m=e.childAt(h+1),_=m&&m.getBoundingRect(),y,T;if(n==="horizontal"){var I=d.width+(_?-_.x+d.x:0);y=s+I,y>r||o.newline?(s=0,y=I,a+=l+t,l=d.height):l=Math.max(l,d.height)}else{var C=d.height+(_?-_.y+d.y:0);T=a+C,T>i||o.newline?(s+=l+t,a=0,T=C,l=d.width):l=Math.max(l,d.width)}o.newline||(o.x=s,o.y=a,o.markRedraw(),n==="horizontal"?s=y+t:a=T+t)})}var Bb=AU;ms(AU,"vertical");ms(AU,"horizontal");function mv(n,e,t){t=LD(t||0);var r=e.width,i=e.height,s=os(n.left,r),a=os(n.top,i),l=os(n.right,r),o=os(n.bottom,i),h=os(n.width,r),d=os(n.height,i),m=t[2]+t[0],_=t[1]+t[3],y=n.aspect;switch(isNaN(h)&&(h=r-l-_-s),isNaN(d)&&(d=i-o-m-a),y!=null&&(isNaN(h)&&isNaN(d)&&(y>r/i?h=r*.8:d=i*.8),isNaN(h)&&(h=y*d),isNaN(d)&&(d=h/y)),isNaN(s)&&(s=r-l-h-_),isNaN(a)&&(a=i-o-d-m),n.left||n.right){case"center":s=r/2-h/2-t[3];break;case"right":s=r-h-_;break}switch(n.top||n.bottom){case"middle":case"center":a=i/2-d/2-t[0];break;case"bottom":a=i-d-m;break}s=s||0,a=a||0,isNaN(h)&&(h=r-_-s-(l||0)),isNaN(d)&&(d=i-m-a-(o||0));var T=new as(s+t[3],a+t[0],h,d);return T.margin=t,T}function IEe(n,e,t,r,i,s){s=s||n,s.x=n.x,s.y=n.y;var a;if(a=n.getBoundingRect(),n.needLocalTransform()){var l=n.getLocalTransform();a=a.clone(),a.applyTransform(l)}var o=mv(ti({width:a.width,height:a.height},e),t,r),h=o.x-a.x,d=o.y-a.y;return s.x+=h,s.y+=d,s===n&&n.markRedraw(),!0}function tT(n){var e=n.layoutMode||n.constructor.layoutMode;return Xr(e)?e:e?{type:e}:null}function Qb(n,e,t){var r=t&&t.ignoreSize;!fr(r)&&(r=[r,r]);var i=a(BE[0],0),s=a(BE[1],1);h(BE[0],n,i),h(BE[1],n,s);function a(d,m){var _={},y=0,T={},I=0,C=2;if(HI(d,function(k){T[k]=n[k]}),HI(d,function(k){l(e,k)&&(_[k]=T[k]=e[k]),o(_,k)&&y++,o(T,k)&&I++}),r[m])return o(e,d[1])?T[d[2]]=null:o(e,d[2])&&(T[d[1]]=null),T;if(I===C||!y)return T;if(y>=C)return _;for(var M=0;M<d.length;M++){var B=d[M];if(!l(_,B)&&l(n,B)){_[B]=n[B];break}}return _}function l(d,m){return d.hasOwnProperty(m)}function o(d,m){return d[m]!=null&&d[m]!=="auto"}function h(d,m,_){HI(d,function(y){m[y]=_[y]})}}function DD(n){return REe({},n)}function REe(n,e){return e&&n&&HI(EEe,function(t){e.hasOwnProperty(t)&&(n[t]=e[t])}),n}var PEe=Xs(),is=function(n){Hn(e,n);function e(t,r,i){var s=n.call(this,t,r,i)||this;return s.uid=tM("ec_cpt_model"),s}return e.prototype.init=function(t,r,i){this.mergeDefaultAndTheme(t,i)},e.prototype.mergeDefaultAndTheme=function(t,r){var i=tT(this),s=i?DD(t):{},a=r.getTheme();Li(t,a.get(this.mainType)),Li(t,this.getDefaultOption()),i&&Qb(t,s,i)},e.prototype.mergeOption=function(t,r){Li(this.option,t,!0);var i=tT(this);i&&Qb(this.option,t,i)},e.prototype.optionUpdated=function(t,r){},e.prototype.getDefaultOption=function(){var t=this.constructor;if(!QTe(t))return t.defaultOption;var r=PEe(this);if(!r.defaultOption){for(var i=[],s=t;s;){var a=s.prototype.defaultOption;a&&i.push(a),s=s.superClass}for(var l={},o=i.length-1;o>=0;o--)l=Li(l,i[o],!0);r.defaultOption=l}return r.defaultOption},e.prototype.getReferringComponents=function(t,r){var i=t+"Index",s=t+"Id";return JT(this.ecModel,t,{index:this.get(i,!0),id:this.get(s,!0)},r)},e.prototype.getBoxLayoutParams=function(){var t=this;return{left:t.get("left"),top:t.get("top"),right:t.get("right"),bottom:t.get("bottom"),width:t.get("width"),height:t.get("height")}},e.prototype.getZLevelKey=function(){return""},e.prototype.setZLevel=function(t){this.option.zlevel=t},e.protoInitialize=function(){var t=e.prototype;t.type="component",t.id="",t.name="",t.mainType="",t.subType="",t.componentIndex=0}(),e}(Io);Lre(is,Io);fD(is);gEe(is);vEe(is,LEe);function LEe(n){var e=[];return it(is.getClassesByMainType(n),function(t){e=e.concat(t.dependencies||t.prototype.dependencies||[])}),e=xr(e,function(t){return Qd(t).main}),n!=="dataset"&&Wi(e,"dataset")<=0&&e.unshift("dataset"),e}var Uie="";typeof navigator<"u"&&(Uie=navigator.platform||"");var I1="rgba(0, 0, 0, 0.2)";const DEe={darkMode:"auto",colorBy:"series",color:["#5470c6","#91cc75","#fac858","#ee6666","#73c0de","#3ba272","#fc8452","#9a60b4","#ea7ccc"],gradientColor:["#f6efa6","#d88273","#bf444c"],aria:{decal:{decals:[{color:I1,dashArrayX:[1,0],dashArrayY:[2,5],symbolSize:1,rotation:Math.PI/6},{color:I1,symbol:"circle",dashArrayX:[[8,8],[0,8,8,0]],dashArrayY:[6,0],symbolSize:.8},{color:I1,dashArrayX:[1,0],dashArrayY:[4,3],rotation:-Math.PI/4},{color:I1,dashArrayX:[[6,6],[0,6,6,0]],dashArrayY:[6,0]},{color:I1,dashArrayX:[[1,0],[1,6]],dashArrayY:[1,0,6,0],rotation:Math.PI/4},{color:I1,symbol:"triangle",dashArrayX:[[9,9],[0,9,9,0]],dashArrayY:[7,2],symbolSize:.75}]}},textStyle:{fontFamily:Uie.match(/^Win/)?"Microsoft YaHei":"sans-serif",fontSize:12,fontStyle:"normal",fontWeight:"normal"},blendMode:null,stateAnimation:{duration:300,easing:"cubicOut"},animation:"auto",animationDuration:1e3,animationDurationUpdate:500,animationEasing:"cubicInOut",animationEasingUpdate:"cubicInOut",animationThreshold:2e3,progressiveThreshold:3e3,progressive:400,hoverLayerThreshold:3e3,useUTC:!1};var Vie=ri(["tooltip","label","itemName","itemId","itemGroupId","itemChildGroupId","seriesName"]),Bh="original",Ic="arrayRows",kh="objectRows",gp="keyedColumns",rv="typedArray",Gie="unknown",ap="column",ww="row",vl={Must:1,Might:2,Not:3},Hie=Xs();function BEe(n){Hie(n).datasetMap=ri()}function kEe(n,e,t){var r={},i=TU(e);if(!i||!n)return r;var s=[],a=[],l=e.ecModel,o=Hie(l).datasetMap,h=i.uid+"_"+t.seriesLayoutBy,d,m;n=n.slice(),it(n,function(I,C){var M=Xr(I)?I:n[C]={name:I};M.type==="ordinal"&&d==null&&(d=C,m=T(M)),r[M.name]=[]});var _=o.get(h)||o.set(h,{categoryWayDim:m,valueWayDim:0});it(n,function(I,C){var M=I.name,B=T(I);if(d==null){var k=_.valueWayDim;y(r[M],k,B),y(a,k,B),_.valueWayDim+=B}else if(d===C)y(r[M],0,B),y(s,0,B);else{var k=_.categoryWayDim;y(r[M],k,B),y(a,k,B),_.categoryWayDim+=B}});function y(I,C,M){for(var B=0;B<M;B++)I.push(C+B)}function T(I){var C=I.dimsDef;return C?C.length:1}return s.length&&(r.itemName=s),a.length&&(r.seriesName=a),r}function OEe(n,e,t){var r={},i=TU(n);if(!i)return r;var s=e.sourceFormat,a=e.dimensionsDefine,l;(s===kh||s===gp)&&it(a,function(d,m){(Xr(d)?d.name:d)==="name"&&(l=m)});var o=function(){for(var d={},m={},_=[],y=0,T=Math.min(5,t);y<T;y++){var I=Wie(e.data,s,e.seriesLayoutBy,a,e.startIndex,y);_.push(I);var C=I===vl.Not;if(C&&d.v==null&&y!==l&&(d.v=y),(d.n==null||d.n===d.v||!C&&_[d.n]===vl.Not)&&(d.n=y),M(d)&&_[d.n]!==vl.Not)return d;C||(I===vl.Might&&m.v==null&&y!==l&&(m.v=y),(m.n==null||m.n===m.v)&&(m.n=y))}function M(B){return B.v!=null&&B.n!=null}return M(d)?d:M(m)?m:null}();if(o){r.value=[o.v];var h=l??o.n;r.itemName=[h],r.seriesName=[h]}return r}function TU(n){var e=n.get("data",!0);if(!e)return JT(n.ecModel,"dataset",{index:n.get("datasetIndex",!0),id:n.get("datasetId",!0)},yl).models[0]}function FEe(n){return!n.get("transform",!0)&&!n.get("fromTransformResult",!0)?[]:JT(n.ecModel,"dataset",{index:n.get("fromDatasetIndex",!0),id:n.get("fromDatasetId",!0)},yl).models}function jie(n,e){return Wie(n.data,n.sourceFormat,n.seriesLayoutBy,n.dimensionsDefine,n.startIndex,e)}function Wie(n,e,t,r,i,s){var a,l=5;if(hu(n))return vl.Not;var o,h;if(r){var d=r[s];Xr(d)?(o=d.name,h=d.type):Dr(d)&&(o=d)}if(h!=null)return h==="ordinal"?vl.Must:vl.Not;if(e===Ic){var m=n;if(t===ww){for(var _=m[s],y=0;y<(_||[]).length&&y<l;y++)if((a=j(_[i+y]))!=null)return a}else for(var y=0;y<m.length&&y<l;y++){var T=m[i+y];if(T&&(a=j(T[s]))!=null)return a}}else if(e===kh){var I=n;if(!o)return vl.Not;for(var y=0;y<I.length&&y<l;y++){var C=I[y];if(C&&(a=j(C[o]))!=null)return a}}else if(e===gp){var M=n;if(!o)return vl.Not;var _=M[o];if(!_||hu(_))return vl.Not;for(var y=0;y<_.length&&y<l;y++)if((a=j(_[y]))!=null)return a}else if(e===Bh)for(var B=n,y=0;y<B.length&&y<l;y++){var C=B[y],k=KT(C);if(!fr(k))return vl.Not;if((a=j(k[s]))!=null)return a}function j(q){var Z=Dr(q);if(q!=null&&Number.isFinite(Number(q))&&q!=="")return Z?vl.Might:vl.Not;if(Z&&q!=="-")return vl.Must}return vl.Not}var qF=ri();function NEe(n,e){hp(qF.get(n)==null&&e),qF.set(n,e)}function zEe(n,e,t){var r=qF.get(e);if(!r)return t;var i=r(n);return i?t.concat(i):t}var E$=Xs();Xs();var MU=function(){function n(){}return n.prototype.getColorFromPalette=function(e,t,r){var i=da(this.get("color",!0)),s=this.get("colorLayer",!0);return VEe(this,E$,i,s,e,t,r)},n.prototype.clearColorPalette=function(){GEe(this,E$)},n}();function UEe(n,e){for(var t=n.length,r=0;r<t;r++)if(n[r].length>e)return n[r];return n[t-1]}function VEe(n,e,t,r,i,s,a){s=s||n;var l=e(s),o=l.paletteIdx||0,h=l.paletteNameMap=l.paletteNameMap||{};if(h.hasOwnProperty(i))return h[i];var d=a==null||!r?t:UEe(r,a);if(d=d||t,!(!d||!d.length)){var m=d[o];return i&&(h[i]=m),l.paletteIdx=(o+1)%d.length,m}}function GEe(n,e){e(n).paletteIdx=0,e(n).paletteNameMap={}}var kE,G2,I$,R$="\0_ec_inner",HEe=1,CU=function(n){Hn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.init=function(t,r,i,s,a,l){s=s||{},this.option=null,this._theme=new Io(s),this._locale=new Io(a),this._optionManager=l},e.prototype.setOption=function(t,r,i){var s=D$(r);this._optionManager.setOption(t,i,s),this._resetOption(null,s)},e.prototype.resetOption=function(t,r){return this._resetOption(t,D$(r))},e.prototype._resetOption=function(t,r){var i=!1,s=this._optionManager;if(!t||t==="recreate"){var a=s.mountOption(t==="recreate");!this.option||t==="recreate"?I$(this,a):(this.restoreData(),this._mergeOption(a,r)),i=!0}if((t==="timeline"||t==="media")&&this.restoreData(),!t||t==="recreate"||t==="timeline"){var l=s.getTimelineOption(this);l&&(i=!0,this._mergeOption(l,r))}if(!t||t==="recreate"||t==="media"){var o=s.getMediaOption(this);o.length&&it(o,function(h){i=!0,this._mergeOption(h,r)},this)}return i},e.prototype.mergeOption=function(t){this._mergeOption(t,null)},e.prototype._mergeOption=function(t,r){var i=this.option,s=this._componentsMap,a=this._componentsCount,l=[],o=ri(),h=r&&r.replaceMergeMainTypeMap;BEe(this),it(t,function(m,_){m!=null&&(is.hasClass(_)?_&&(l.push(_),o.set(_,!0)):i[_]=i[_]==null?vi(m):Li(i[_],m,!0))}),h&&h.each(function(m,_){is.hasClass(_)&&!o.get(_)&&(l.push(_),o.set(_,!0))}),is.topologicalTravel(l,is.getAllClassMainTypes(),d,this);function d(m){var _=zEe(this,m,da(t[m])),y=s.get(m),T=y?h&&h.get(m)?"replaceMerge":"normalMerge":"replaceAll",I=FTe(y,_,T);WTe(I,m,is),i[m]=null,s.set(m,null),a.set(m,0);var C=[],M=[],B=0,k;it(I,function(j,q){var Z=j.existing,te=j.newOption;if(!te)Z&&(Z.mergeOption({},this),Z.optionUpdated({},!1));else{var ie=m==="series",se=is.getClass(m,j.keyInfo.subType,!ie);if(!se)return;if(m==="tooltip"){if(k)return;k=!0}if(Z&&Z.constructor===se)Z.name=j.keyInfo.name,Z.mergeOption(te,this),Z.optionUpdated(te,!1);else{var ae=Jn({componentIndex:q},j.keyInfo);Z=new se(te,this,this,ae),Jn(Z,ae),j.brandNew&&(Z.__requireNewView=!0),Z.init(te,this,this),Z.optionUpdated(null,!0)}}Z?(C.push(Z.option),M.push(Z),B++):(C.push(void 0),M.push(void 0))},this),i[m]=C,s.set(m,M),a.set(m,B),m==="series"&&kE(this)}this._seriesIndices||kE(this)},e.prototype.getOption=function(){var t=vi(this.option);return it(t,function(r,i){if(is.hasClass(i)){for(var s=da(r),a=s.length,l=!1,o=a-1;o>=0;o--)s[o]&&!YA(s[o])?l=!0:(s[o]=null,!l&&a--);s.length=a,t[i]=s}}),delete t[R$],t},e.prototype.getTheme=function(){return this._theme},e.prototype.getLocaleModel=function(){return this._locale},e.prototype.setUpdatePayload=function(t){this._payload=t},e.prototype.getUpdatePayload=function(){return this._payload},e.prototype.getComponent=function(t,r){var i=this._componentsMap.get(t);if(i){var s=i[r||0];if(s)return s;if(r==null){for(var a=0;a<i.length;a++)if(i[a])return i[a]}}},e.prototype.queryComponents=function(t){var r=t.mainType;if(!r)return[];var i=t.index,s=t.id,a=t.name,l=this._componentsMap.get(r);if(!l||!l.length)return[];var o;return i!=null?(o=[],it(da(i),function(h){l[h]&&o.push(l[h])})):s!=null?o=P$("id",s,l):a!=null?o=P$("name",a,l):o=ta(l,function(h){return!!h}),L$(o,t)},e.prototype.findComponents=function(t){var r=t.query,i=t.mainType,s=l(r),a=s?this.queryComponents(s):ta(this._componentsMap.get(i),function(h){return!!h});return o(L$(a,t));function l(h){var d=i+"Index",m=i+"Id",_=i+"Name";return h&&(h[d]!=null||h[m]!=null||h[_]!=null)?{mainType:i,index:h[d],id:h[m],name:h[_]}:null}function o(h){return t.filter?ta(h,t.filter):h}},e.prototype.eachComponent=function(t,r,i){var s=this._componentsMap;if(li(t)){var a=r,l=t;s.each(function(m,_){for(var y=0;m&&y<m.length;y++){var T=m[y];T&&l.call(a,_,T,T.componentIndex)}})}else for(var o=Dr(t)?s.get(t):Xr(t)?this.findComponents(t):null,h=0;o&&h<o.length;h++){var d=o[h];d&&r.call(i,d,d.componentIndex)}},e.prototype.getSeriesByName=function(t){var r=op(t,null);return ta(this._componentsMap.get("series"),function(i){return!!i&&r!=null&&i.name===r})},e.prototype.getSeriesByIndex=function(t){return this._componentsMap.get("series")[t]},e.prototype.getSeriesByType=function(t){return ta(this._componentsMap.get("series"),function(r){return!!r&&r.subType===t})},e.prototype.getSeries=function(){return ta(this._componentsMap.get("series"),function(t){return!!t})},e.prototype.getSeriesCount=function(){return this._componentsCount.get("series")},e.prototype.eachSeries=function(t,r){G2(this),it(this._seriesIndices,function(i){var s=this._componentsMap.get("series")[i];t.call(r,s,i)},this)},e.prototype.eachRawSeries=function(t,r){it(this._componentsMap.get("series"),function(i){i&&t.call(r,i,i.componentIndex)})},e.prototype.eachSeriesByType=function(t,r,i){G2(this),it(this._seriesIndices,function(s){var a=this._componentsMap.get("series")[s];a.subType===t&&r.call(i,a,s)},this)},e.prototype.eachRawSeriesByType=function(t,r,i){return it(this.getSeriesByType(t),r,i)},e.prototype.isSeriesFiltered=function(t){return G2(this),this._seriesIndicesMap.get(t.componentIndex)==null},e.prototype.getCurrentSeriesIndices=function(){return(this._seriesIndices||[]).slice()},e.prototype.filterSeries=function(t,r){G2(this);var i=[];it(this._seriesIndices,function(s){var a=this._componentsMap.get("series")[s];t.call(r,a,s)&&i.push(s)},this),this._seriesIndices=i,this._seriesIndicesMap=ri(i)},e.prototype.restoreData=function(t){kE(this);var r=this._componentsMap,i=[];r.each(function(s,a){is.hasClass(a)&&i.push(a)}),is.topologicalTravel(i,is.getAllClassMainTypes(),function(s){it(r.get(s),function(a){a&&(s!=="series"||!jEe(a,t))&&a.restoreData()})})},e.internalField=function(){kE=function(t){var r=t._seriesIndices=[];it(t._componentsMap.get("series"),function(i){i&&r.push(i.componentIndex)}),t._seriesIndicesMap=ri(r)},G2=function(t){},I$=function(t,r){t.option={},t.option[R$]=HEe,t._componentsMap=ri({series:[]}),t._componentsCount=ri();var i=r.aria;Xr(i)&&i.enabled==null&&(i.enabled=!0),WEe(r,t._theme.option),Li(r,DEe,!1),t._mergeOption(r,null)}}(),e}(Io);function jEe(n,e){if(e){var t=e.seriesIndex,r=e.seriesId,i=e.seriesName;return t!=null&&n.componentIndex!==t||r!=null&&n.id!==r||i!=null&&n.name!==i}}function WEe(n,e){var t=n.color&&!n.colorLayer;it(e,function(r,i){i==="colorLayer"&&t||is.hasClass(i)||(typeof r=="object"?n[i]=n[i]?Li(n[i],r,!1):vi(r):n[i]==null&&(n[i]=r))})}function P$(n,e,t){if(fr(e)){var r=ri();return it(e,function(s){if(s!=null){var a=op(s,null);a!=null&&r.set(s,!0)}}),ta(t,function(s){return s&&r.get(s[n])})}else{var i=op(e,null);return ta(t,function(s){return s&&i!=null&&s[n]===i})}}function L$(n,e){return e.hasOwnProperty("subType")?ta(n,function(t){return t&&t.subType===e.subType}):n}function D$(n){var e=ri();return n&&it(da(n.replaceMerge),function(t){e.set(t,!0)}),{replaceMergeMainTypeMap:e}}nd(CU,MU);var XEe=["getDom","getZr","getWidth","getHeight","getDevicePixelRatio","dispatchAction","isSSR","isDisposed","on","off","getDataURL","getConnectedDataURL","getOption","getId","updateLabelLayout"],Xie=function(){function n(e){it(XEe,function(t){this[t]=Ns(e[t],e)},this)}return n}(),BB={},EU=function(){function n(){this._coordinateSystems=[]}return n.prototype.create=function(e,t){var r=[];it(BB,function(i,s){var a=i.create(e,t);r=r.concat(a||[])}),this._coordinateSystems=r},n.prototype.update=function(e,t){it(this._coordinateSystems,function(r){r.update&&r.update(e,t)})},n.prototype.getCoordinateSystems=function(){return this._coordinateSystems.slice()},n.register=function(e,t){BB[e]=t},n.get=function(e){return BB[e]},n}(),$Ee=/^(min|max)?(.+)$/,qEe=function(){function n(e){this._timelineOptions=[],this._mediaList=[],this._currentMediaIndices=[],this._api=e}return n.prototype.setOption=function(e,t,r){e&&(it(da(e.series),function(a){a&&a.data&&hu(a.data)&&aP(a.data)}),it(da(e.dataset),function(a){a&&a.source&&hu(a.source)&&aP(a.source)})),e=vi(e);var i=this._optionBackup,s=ZEe(e,t,!i);this._newBaseOption=s.baseOption,i?(s.timelineOptions.length&&(i.timelineOptions=s.timelineOptions),s.mediaList.length&&(i.mediaList=s.mediaList),s.mediaDefault&&(i.mediaDefault=s.mediaDefault)):this._optionBackup=s},n.prototype.mountOption=function(e){var t=this._optionBackup;return this._timelineOptions=t.timelineOptions,this._mediaList=t.mediaList,this._mediaDefault=t.mediaDefault,this._currentMediaIndices=[],vi(e?t.baseOption:this._newBaseOption)},n.prototype.getTimelineOption=function(e){var t,r=this._timelineOptions;if(r.length){var i=e.getComponent("timeline");i&&(t=vi(r[i.getCurrentIndex()]))}return t},n.prototype.getMediaOption=function(e){var t=this._api.getWidth(),r=this._api.getHeight(),i=this._mediaList,s=this._mediaDefault,a=[],l=[];if(!i.length&&!s)return l;for(var o=0,h=i.length;o<h;o++)YEe(i[o].query,t,r)&&a.push(o);return!a.length&&s&&(a=[-1]),a.length&&!JEe(a,this._currentMediaIndices)&&(l=xr(a,function(d){return vi(d===-1?s.option:i[d].option)})),this._currentMediaIndices=a,l},n}();function ZEe(n,e,t){var r=[],i,s,a=n.baseOption,l=n.timeline,o=n.options,h=n.media,d=!!n.media,m=!!(o||l||a&&a.timeline);a?(s=a,s.timeline||(s.timeline=l)):((m||d)&&(n.options=n.media=null),s=n),d&&fr(h)&&it(h,function(y){y&&y.option&&(y.query?r.push(y):i||(i=y))}),_(s),it(o,function(y){return _(y)}),it(r,function(y){return _(y.option)});function _(y){it(e,function(T){T(y,t)})}return{baseOption:s,timelineOptions:o||[],mediaDefault:i,mediaList:r}}function YEe(n,e,t){var r={width:e,height:t,aspectratio:e/t},i=!0;return it(n,function(s,a){var l=a.match($Ee);if(!(!l||!l[1]||!l[2])){var o=l[1],h=l[2].toLowerCase();KEe(r[h],s,o)||(i=!1)}}),i}function KEe(n,e,t){return t==="min"?n>=e:t==="max"?n<=e:n===e}function JEe(n,e){return n.join(",")===e.join(",")}var Tf=it,nT=Xr,B$=["areaStyle","lineStyle","nodeStyle","linkStyle","chordStyle","label","labelLine"];function kB(n){var e=n&&n.itemStyle;if(e)for(var t=0,r=B$.length;t<r;t++){var i=B$[t],s=e.normal,a=e.emphasis;s&&s[i]&&(n[i]=n[i]||{},n[i].normal?Li(n[i].normal,s[i]):n[i].normal=s[i],s[i]=null),a&&a[i]&&(n[i]=n[i]||{},n[i].emphasis?Li(n[i].emphasis,a[i]):n[i].emphasis=a[i],a[i]=null)}}function Ul(n,e,t){if(n&&n[e]&&(n[e].normal||n[e].emphasis)){var r=n[e].normal,i=n[e].emphasis;r&&(t?(n[e].normal=n[e].emphasis=null,ti(n[e],r)):n[e]=r),i&&(n.emphasis=n.emphasis||{},n.emphasis[e]=i,i.focus&&(n.emphasis.focus=i.focus),i.blurScope&&(n.emphasis.blurScope=i.blurScope))}}function xS(n){Ul(n,"itemStyle"),Ul(n,"lineStyle"),Ul(n,"areaStyle"),Ul(n,"label"),Ul(n,"labelLine"),Ul(n,"upperLabel"),Ul(n,"edgeLabel")}function ha(n,e){var t=nT(n)&&n[e],r=nT(t)&&t.textStyle;if(r)for(var i=0,s=FX.length;i<s;i++){var a=FX[i];r.hasOwnProperty(a)&&(t[a]=r[a])}}function fh(n){n&&(xS(n),ha(n,"label"),n.emphasis&&ha(n.emphasis,"label"))}function QEe(n){if(nT(n)){kB(n),xS(n),ha(n,"label"),ha(n,"upperLabel"),ha(n,"edgeLabel"),n.emphasis&&(ha(n.emphasis,"label"),ha(n.emphasis,"upperLabel"),ha(n.emphasis,"edgeLabel"));var e=n.markPoint;e&&(kB(e),fh(e));var t=n.markLine;t&&(kB(t),fh(t));var r=n.markArea;r&&fh(r);var i=n.data;if(n.type==="graph"){i=i||n.nodes;var s=n.links||n.edges;if(s&&!hu(s))for(var a=0;a<s.length;a++)fh(s[a]);it(n.categories,function(h){xS(h)})}if(i&&!hu(i))for(var a=0;a<i.length;a++)fh(i[a]);if(e=n.markPoint,e&&e.data)for(var l=e.data,a=0;a<l.length;a++)fh(l[a]);if(t=n.markLine,t&&t.data)for(var o=t.data,a=0;a<o.length;a++)fr(o[a])?(fh(o[a][0]),fh(o[a][1])):fh(o[a]);n.type==="gauge"?(ha(n,"axisLabel"),ha(n,"title"),ha(n,"detail")):n.type==="treemap"?(Ul(n.breadcrumb,"itemStyle"),it(n.levels,function(h){xS(h)})):n.type==="tree"&&xS(n.leaves)}}function fm(n){return fr(n)?n:n?[n]:[]}function k$(n){return(fr(n)?n[0]:n)||{}}function eIe(n,e){Tf(fm(n.series),function(r){nT(r)&&QEe(r)});var t=["xAxis","yAxis","radiusAxis","angleAxis","singleAxis","parallelAxis","radar"];e&&t.push("valueAxis","categoryAxis","logAxis","timeAxis"),Tf(t,function(r){Tf(fm(n[r]),function(i){i&&(ha(i,"axisLabel"),ha(i.axisPointer,"label"))})}),Tf(fm(n.parallel),function(r){var i=r&&r.parallelAxisDefault;ha(i,"axisLabel"),ha(i&&i.axisPointer,"label")}),Tf(fm(n.calendar),function(r){Ul(r,"itemStyle"),ha(r,"dayLabel"),ha(r,"monthLabel"),ha(r,"yearLabel")}),Tf(fm(n.radar),function(r){ha(r,"name"),r.name&&r.axisName==null&&(r.axisName=r.name,delete r.name),r.nameGap!=null&&r.axisNameGap==null&&(r.axisNameGap=r.nameGap,delete r.nameGap)}),Tf(fm(n.geo),function(r){nT(r)&&(fh(r),Tf(fm(r.regions),function(i){fh(i)}))}),Tf(fm(n.timeline),function(r){fh(r),Ul(r,"label"),Ul(r,"itemStyle"),Ul(r,"controlStyle",!0);var i=r.data;fr(i)&&it(i,function(s){Xr(s)&&(Ul(s,"label"),Ul(s,"itemStyle"))})}),Tf(fm(n.toolbox),function(r){Ul(r,"iconStyle"),Tf(r.feature,function(i){Ul(i,"iconStyle")})}),ha(k$(n.axisPointer),"label"),ha(k$(n.tooltip).axisPointer,"label")}function tIe(n,e){for(var t=e.split(","),r=n,i=0;i<t.length&&(r=r&&r[t[i]],r!=null);i++);return r}function nIe(n,e,t,r){for(var i=e.split(","),s=n,a,l=0;l<i.length-1;l++)a=i[l],s[a]==null&&(s[a]={}),s=s[a];s[i[l]]==null&&(s[i[l]]=t)}function O$(n){n&&it(rIe,function(e){e[0]in n&&!(e[1]in n)&&(n[e[1]]=n[e[0]])})}var rIe=[["x","left"],["y","top"],["x2","right"],["y2","bottom"]],iIe=["grid","geo","parallel","legend","toolbox","title","visualMap","dataZoom","timeline"],OB=[["borderRadius","barBorderRadius"],["borderColor","barBorderColor"],["borderWidth","barBorderWidth"]];function H2(n){var e=n&&n.itemStyle;if(e)for(var t=0;t<OB.length;t++){var r=OB[t][1],i=OB[t][0];e[r]!=null&&(e[i]=e[r])}}function F$(n){n&&n.alignTo==="edge"&&n.margin!=null&&n.edgeDistance==null&&(n.edgeDistance=n.margin)}function N$(n){n&&n.downplay&&!n.blur&&(n.blur=n.downplay)}function sIe(n){n&&n.focusNodeAdjacency!=null&&(n.emphasis=n.emphasis||{},n.emphasis.focus==null&&(n.emphasis.focus="adjacency"))}function $ie(n,e){if(n)for(var t=0;t<n.length;t++)e(n[t]),n[t]&&$ie(n[t].children,e)}function qie(n,e){eIe(n,e),n.series=da(n.series),it(n.series,function(t){if(Xr(t)){var r=t.type;if(r==="line")t.clipOverflow!=null&&(t.clip=t.clipOverflow);else if(r==="pie"||r==="gauge"){t.clockWise!=null&&(t.clockwise=t.clockWise),F$(t.label);var i=t.data;if(i&&!hu(i))for(var s=0;s<i.length;s++)F$(i[s]);t.hoverOffset!=null&&(t.emphasis=t.emphasis||{},(t.emphasis.scaleSize=null)&&(t.emphasis.scaleSize=t.hoverOffset))}else if(r==="gauge"){var a=tIe(t,"pointer.color");a!=null&&nIe(t,"itemStyle.color",a)}else if(r==="bar"){H2(t),H2(t.backgroundStyle),H2(t.emphasis);var i=t.data;if(i&&!hu(i))for(var s=0;s<i.length;s++)typeof i[s]=="object"&&(H2(i[s]),H2(i[s]&&i[s].emphasis))}else if(r==="sunburst"){var l=t.highlightPolicy;l&&(t.emphasis=t.emphasis||{},t.emphasis.focus||(t.emphasis.focus=l)),N$(t),$ie(t.data,N$)}else r==="graph"||r==="sankey"?sIe(t):r==="map"&&(t.mapType&&!t.map&&(t.map=t.mapType),t.mapLocation&&ti(t,t.mapLocation));t.hoverAnimation!=null&&(t.emphasis=t.emphasis||{},t.emphasis&&t.emphasis.scale==null&&(t.emphasis.scale=t.hoverAnimation)),O$(t)}}),n.dataRange&&(n.visualMap=n.dataRange),it(iIe,function(t){var r=n[t];r&&(fr(r)||(r=[r]),it(r,function(i){O$(i)}))})}function oIe(n){var e=ri();n.eachSeries(function(t){var r=t.get("stack");if(r){var i=e.get(r)||e.set(r,[]),s=t.getData(),a={stackResultDimension:s.getCalculationInfo("stackResultDimension"),stackedOverDimension:s.getCalculationInfo("stackedOverDimension"),stackedDimension:s.getCalculationInfo("stackedDimension"),stackedByDimension:s.getCalculationInfo("stackedByDimension"),isStackedByIndex:s.getCalculationInfo("isStackedByIndex"),data:s,seriesModel:t};if(!a.stackedDimension||!(a.isStackedByIndex||a.stackedByDimension))return;i.length&&s.setCalculationInfo("stackedOnSeries",i[i.length-1].seriesModel),i.push(a)}}),e.each(aIe)}function aIe(n){it(n,function(e,t){var r=[],i=[NaN,NaN],s=[e.stackResultDimension,e.stackedOverDimension],a=e.data,l=e.isStackedByIndex,o=e.seriesModel.get("stackStrategy")||"samesign";a.modify(s,function(h,d,m){var _=a.get(e.stackedDimension,m);if(isNaN(_))return i;var y,T;l?T=a.getRawIndex(m):y=a.get(e.stackedByDimension,m);for(var I=NaN,C=t-1;C>=0;C--){var M=n[C];if(l||(T=M.data.rawIndexOf(M.stackedByDimension,y)),T>=0){var B=M.data.getByRawIndex(M.stackResultDimension,T);if(o==="all"||o==="positive"&&B>0||o==="negative"&&B<0||o==="samesign"&&_>=0&&B>0||o==="samesign"&&_<=0&&B<0){_=LTe(_,B),I=B;break}}}return r[0]=_,r[1]=I,r})})}var BD=function(){function n(e){this.data=e.data||(e.sourceFormat===gp?{}:[]),this.sourceFormat=e.sourceFormat||Gie,this.seriesLayoutBy=e.seriesLayoutBy||ap,this.startIndex=e.startIndex||0,this.dimensionsDetectedCount=e.dimensionsDetectedCount,this.metaRawOption=e.metaRawOption;var t=this.dimensionsDefine=e.dimensionsDefine;if(t)for(var r=0;r<t.length;r++){var i=t[r];i.type==null&&jie(this,r)===vl.Must&&(i.type="ordinal")}}return n}();function IU(n){return n instanceof BD}function ZF(n,e,t){t=t||Yie(n);var r=e.seriesLayoutBy,i=cIe(n,t,r,e.sourceHeader,e.dimensions),s=new BD({data:n,sourceFormat:t,seriesLayoutBy:r,dimensionsDefine:i.dimensionsDefine,startIndex:i.startIndex,dimensionsDetectedCount:i.dimensionsDetectedCount,metaRawOption:vi(e)});return s}function Zie(n){return new BD({data:n,sourceFormat:hu(n)?rv:Bh})}function lIe(n){return new BD({data:n.data,sourceFormat:n.sourceFormat,seriesLayoutBy:n.seriesLayoutBy,dimensionsDefine:vi(n.dimensionsDefine),startIndex:n.startIndex,dimensionsDetectedCount:n.dimensionsDetectedCount})}function Yie(n){var e=Gie;if(hu(n))e=rv;else if(fr(n)){n.length===0&&(e=Ic);for(var t=0,r=n.length;t<r;t++){var i=n[t];if(i!=null){if(fr(i)||hu(i)){e=Ic;break}else if(Xr(i)){e=kh;break}}}}else if(Xr(n)){for(var s in n)if($m(n,s)&&Ec(n[s])){e=gp;break}}return e}function cIe(n,e,t,r,i){var s,a;if(!n)return{dimensionsDefine:z$(i),startIndex:a,dimensionsDetectedCount:s};if(e===Ic){var l=n;r==="auto"||r==null?U$(function(h){h!=null&&h!=="-"&&(Dr(h)?a==null&&(a=1):a=0)},t,l,10):a=Is(r)?r:r?1:0,!i&&a===1&&(i=[],U$(function(h,d){i[d]=h!=null?h+"":""},t,l,1/0)),s=i?i.length:t===ww?l.length:l[0]?l[0].length:null}else if(e===kh)i||(i=uIe(n));else if(e===gp)i||(i=[],it(n,function(h,d){i.push(d)}));else if(e===Bh){var o=KT(n[0]);s=fr(o)&&o.length||1}return{startIndex:a,dimensionsDefine:z$(i),dimensionsDetectedCount:s}}function uIe(n){for(var e=0,t;e<n.length&&!(t=n[e++]););if(t)return io(t)}function z$(n){if(n){var e=ri();return xr(n,function(t,r){t=Xr(t)?t:{name:t};var i={name:t.name,displayName:t.displayName,type:t.type};if(i.name==null)return i;i.name+="",i.displayName==null&&(i.displayName=i.name);var s=e.get(i.name);return s?i.name+="-"+s.count++:e.set(i.name,{count:1}),i})}}function U$(n,e,t,r){if(e===ww)for(var i=0;i<t.length&&i<r;i++)n(t[i]?t[i][0]:null,i);else for(var s=t[0]||[],i=0;i<s.length&&i<r;i++)n(s[i],i)}function Kie(n){var e=n.sourceFormat;return e===kh||e===gp}var W_,X_,$_,V$,G$,Jie=function(){function n(e,t){var r=IU(e)?e:Zie(e);this._source=r;var i=this._data=r.data;r.sourceFormat===rv&&(this._offset=0,this._dimSize=t,this._data=i),G$(this,i,r)}return n.prototype.getSource=function(){return this._source},n.prototype.count=function(){return 0},n.prototype.getItem=function(e,t){},n.prototype.appendData=function(e){},n.prototype.clean=function(){},n.protoInitialize=function(){var e=n.prototype;e.pure=!1,e.persistent=!0}(),n.internalField=function(){var e;G$=function(a,l,o){var h=o.sourceFormat,d=o.seriesLayoutBy,m=o.startIndex,_=o.dimensionsDefine,y=V$[RU(h,d)];if(Jn(a,y),h===rv)a.getItem=t,a.count=i,a.fillStorage=r;else{var T=Qie(h,d);a.getItem=Ns(T,null,l,m,_);var I=ese(h,d);a.count=Ns(I,null,l,m,_)}};var t=function(a,l){a=a-this._offset,l=l||[];for(var o=this._data,h=this._dimSize,d=h*a,m=0;m<h;m++)l[m]=o[d+m];return l},r=function(a,l,o,h){for(var d=this._data,m=this._dimSize,_=0;_<m;_++){for(var y=h[_],T=y[0]==null?1/0:y[0],I=y[1]==null?-1/0:y[1],C=l-a,M=o[_],B=0;B<C;B++){var k=d[B*m+_];M[a+B]=k,k<T&&(T=k),k>I&&(I=k)}y[0]=T,y[1]=I}},i=function(){return this._data?this._data.length/this._dimSize:0};V$=(e={},e[Ic+"_"+ap]={pure:!0,appendData:s},e[Ic+"_"+ww]={pure:!0,appendData:function(){throw new Error('Do not support appendData when set seriesLayoutBy: "row".')}},e[kh]={pure:!0,appendData:s},e[gp]={pure:!0,appendData:function(a){var l=this._data;it(a,function(o,h){for(var d=l[h]||(l[h]=[]),m=0;m<(o||[]).length;m++)d.push(o[m])})}},e[Bh]={appendData:s},e[rv]={persistent:!1,pure:!0,appendData:function(a){this._data=a},clean:function(){this._offset+=this.count(),this._data=null}},e);function s(a){for(var l=0;l<a.length;l++)this._data.push(a[l])}}(),n}(),H$=function(n,e,t,r){return n[r]},hIe=(W_={},W_[Ic+"_"+ap]=function(n,e,t,r){return n[r+e]},W_[Ic+"_"+ww]=function(n,e,t,r,i){r+=e;for(var s=i||[],a=n,l=0;l<a.length;l++){var o=a[l];s[l]=o?o[r]:null}return s},W_[kh]=H$,W_[gp]=function(n,e,t,r,i){for(var s=i||[],a=0;a<t.length;a++){var l=t[a].name,o=n[l];s[a]=o?o[r]:null}return s},W_[Bh]=H$,W_);function Qie(n,e){var t=hIe[RU(n,e)];return t}var j$=function(n,e,t){return n.length},fIe=(X_={},X_[Ic+"_"+ap]=function(n,e,t){return Math.max(0,n.length-e)},X_[Ic+"_"+ww]=function(n,e,t){var r=n[0];return r?Math.max(0,r.length-e):0},X_[kh]=j$,X_[gp]=function(n,e,t){var r=t[0].name,i=n[r];return i?i.length:0},X_[Bh]=j$,X_);function ese(n,e){var t=fIe[RU(n,e)];return t}var FB=function(n,e,t){return n[e]},dIe=($_={},$_[Ic]=FB,$_[kh]=function(n,e,t){return n[t]},$_[gp]=FB,$_[Bh]=function(n,e,t){var r=KT(n);return r instanceof Array?r[e]:r},$_[rv]=FB,$_);function tse(n){var e=dIe[n];return e}function RU(n,e){return n===Ic?n+"_"+e:n}function ew(n,e,t){if(n){var r=n.getRawDataItem(e);if(r!=null){var i=n.getStore(),s=i.getSource().sourceFormat;if(t!=null){var a=n.getDimensionIndex(t),l=i.getDimensionProperty(a);return tse(s)(r,a,l)}else{var o=r;return s===Bh&&(o=KT(r)),o}}}}var pIe=/\{@(.+?)\}/g,mIe=function(){function n(){}return n.prototype.getDataParams=function(e,t){var r=this.getData(t),i=this.getRawValue(e,t),s=r.getRawIndex(e),a=r.getName(e),l=r.getRawDataItem(e),o=r.getItemVisual(e,"style"),h=o&&o[r.getItemVisual(e,"drawType")||"fill"],d=o&&o.stroke,m=this.mainType,_=m==="series",y=r.userOutput&&r.userOutput.get();return{componentType:m,componentSubType:this.subType,componentIndex:this.componentIndex,seriesType:_?this.subType:null,seriesIndex:this.seriesIndex,seriesId:_?this.id:null,seriesName:_?this.name:null,name:a,dataIndex:s,data:l,dataType:t,value:i,color:h,borderColor:d,dimensionNames:y?y.fullDimensions:null,encode:y?y.encode:null,$vars:["seriesName","name","value"]}},n.prototype.getFormattedLabel=function(e,t,r,i,s,a){t=t||"normal";var l=this.getData(r),o=this.getDataParams(e,r);if(a&&(o.value=a.interpolatedValue),i!=null&&fr(o.value)&&(o.value=o.value[i]),!s){var h=l.getItemModel(e);s=h.get(t==="normal"?["label","formatter"]:[t,"label","formatter"])}if(li(s))return o.status=t,o.dimensionIndex=i,s(o);if(Dr(s)){var d=zie(s,o);return d.replace(pIe,function(m,_){var y=_.length,T=_;T.charAt(0)==="["&&T.charAt(y-1)==="]"&&(T=+T.slice(1,y-1));var I=ew(l,e,T);if(a&&fr(a.interpolatedValue)){var C=l.getDimensionIndex(T);C>=0&&(I=a.interpolatedValue[C])}return I!=null?I+"":""})}},n.prototype.getRawValue=function(e,t){return ew(this.getData(t),e)},n.prototype.formatTooltip=function(e,t,r){},n}();function W$(n){var e,t;return Xr(n)?n.type&&(t=n):e=n,{text:e,frag:t}}function nA(n){return new gIe(n)}var gIe=function(){function n(e){e=e||{},this._reset=e.reset,this._plan=e.plan,this._count=e.count,this._onDirty=e.onDirty,this._dirty=!0}return n.prototype.perform=function(e){var t=this._upstream,r=e&&e.skip;if(this._dirty&&t){var i=this.context;i.data=i.outputData=t.context.outputData}this.__pipeline&&(this.__pipeline.currentTask=this);var s;this._plan&&!r&&(s=this._plan(this.context));var a=d(this._modBy),l=this._modDataCount||0,o=d(e&&e.modBy),h=e&&e.modDataCount||0;(a!==o||l!==h)&&(s="reset");function d(B){return!(B>=1)&&(B=1),B}var m;(this._dirty||s==="reset")&&(this._dirty=!1,m=this._doReset(r)),this._modBy=o,this._modDataCount=h;var _=e&&e.step;if(t?this._dueEnd=t._outputDueEnd:this._dueEnd=this._count?this._count(this.context):1/0,this._progress){var y=this._dueIndex,T=Math.min(_!=null?this._dueIndex+_:1/0,this._dueEnd);if(!r&&(m||y<T)){var I=this._progress;if(fr(I))for(var C=0;C<I.length;C++)this._doProgress(I[C],y,T,o,h);else this._doProgress(I,y,T,o,h)}this._dueIndex=T;var M=this._settedOutputEnd!=null?this._settedOutputEnd:T;this._outputDueEnd=M}else this._dueIndex=this._outputDueEnd=this._settedOutputEnd!=null?this._settedOutputEnd:this._dueEnd;return this.unfinished()},n.prototype.dirty=function(){this._dirty=!0,this._onDirty&&this._onDirty(this.context)},n.prototype._doProgress=function(e,t,r,i,s){X$.reset(t,r,i,s),this._callingProgress=e,this._callingProgress({start:t,end:r,count:r-t,next:X$.next},this.context)},n.prototype._doReset=function(e){this._dueIndex=this._outputDueEnd=this._dueEnd=0,this._settedOutputEnd=null;var t,r;!e&&this._reset&&(t=this._reset(this.context),t&&t.progress&&(r=t.forceFirstProgress,t=t.progress),fr(t)&&!t.length&&(t=null)),this._progress=t,this._modBy=this._modDataCount=null;var i=this._downstream;return i&&i.dirty(),r},n.prototype.unfinished=function(){return this._progress&&this._dueIndex<this._dueEnd},n.prototype.pipe=function(e){(this._downstream!==e||this._dirty)&&(this._downstream=e,e._upstream=this,e.dirty())},n.prototype.dispose=function(){this._disposed||(this._upstream&&(this._upstream._downstream=null),this._downstream&&(this._downstream._upstream=null),this._dirty=!1,this._disposed=!0)},n.prototype.getUpstream=function(){return this._upstream},n.prototype.getDownstream=function(){return this._downstream},n.prototype.setOutputEnd=function(e){this._outputDueEnd=this._settedOutputEnd=e},n}(),X$=function(){var n,e,t,r,i,s={reset:function(o,h,d,m){e=o,n=h,t=d,r=m,i=Math.ceil(r/t),s.next=t>1&&r>0?l:a}};return s;function a(){return e<n?e++:null}function l(){var o=e%i*t+Math.ceil(e/i),h=e>=n?null:o<r?o:e;return e++,h}}();function jI(n,e){var t=e&&e.type;return t==="ordinal"?n:(t==="time"&&!Is(n)&&n!=null&&n!=="-"&&(n=+qm(n)),n==null||n===""?NaN:Number(n))}var vIe=ri({number:function(n){return parseFloat(n)},time:function(n){return+qm(n)},trim:function(n){return Dr(n)?Jd(n):n}});function nse(n){return vIe.get(n)}var rse={lt:function(n,e){return n<e},lte:function(n,e){return n<=e},gt:function(n,e){return n>e},gte:function(n,e){return n>=e}},_Ie=function(){function n(e,t){if(!Is(t)){var r="";ss(r)}this._opFn=rse[e],this._rvalFloat=pv(t)}return n.prototype.evaluate=function(e){return Is(e)?this._opFn(e,this._rvalFloat):this._opFn(pv(e),this._rvalFloat)},n}(),ise=function(){function n(e,t){var r=e==="desc";this._resultLT=r?1:-1,t==null&&(t=r?"min":"max"),this._incomparable=t==="min"?-1/0:1/0}return n.prototype.evaluate=function(e,t){var r=Is(e)?e:pv(e),i=Is(t)?t:pv(t),s=isNaN(r),a=isNaN(i);if(s&&(r=this._incomparable),a&&(i=this._incomparable),s&&a){var l=Dr(e),o=Dr(t);l&&(r=o?e:0),o&&(i=l?t:0)}return r<i?this._resultLT:r>i?-this._resultLT:0},n}(),yIe=function(){function n(e,t){this._rval=t,this._isEQ=e,this._rvalTypeof=typeof t,this._rvalFloat=pv(t)}return n.prototype.evaluate=function(e){var t=e===this._rval;if(!t){var r=typeof e;r!==this._rvalTypeof&&(r==="number"||this._rvalTypeof==="number")&&(t=pv(e)===this._rvalFloat)}return this._isEQ?t:!t},n}();function xIe(n,e){return n==="eq"||n==="ne"?new yIe(n==="eq",e):$m(rse,n)?new _Ie(n,e):null}var bIe=function(){function n(){}return n.prototype.getRawData=function(){throw new Error("not supported")},n.prototype.getRawDataItem=function(e){throw new Error("not supported")},n.prototype.cloneRawData=function(){},n.prototype.getDimensionInfo=function(e){},n.prototype.cloneAllDimensionInfo=function(){},n.prototype.count=function(){},n.prototype.retrieveValue=function(e,t){},n.prototype.retrieveValueFromItem=function(e,t){},n.prototype.convertValue=function(e,t){return jI(e,t)},n}();function wIe(n,e){var t=new bIe,r=n.data,i=t.sourceFormat=n.sourceFormat,s=n.startIndex,a="";n.seriesLayoutBy!==ap&&ss(a);var l=[],o={},h=n.dimensionsDefine;if(h)it(h,function(I,C){var M=I.name,B={index:C,name:M,displayName:I.displayName};if(l.push(B),M!=null){var k="";$m(o,M)&&ss(k),o[M]=B}});else for(var d=0;d<n.dimensionsDetectedCount;d++)l.push({index:d});var m=Qie(i,ap);e.__isBuiltIn&&(t.getRawDataItem=function(I){return m(r,s,l,I)},t.getRawData=Ns(SIe,null,n)),t.cloneRawData=Ns(AIe,null,n);var _=ese(i,ap);t.count=Ns(_,null,r,s,l);var y=tse(i);t.retrieveValue=function(I,C){var M=m(r,s,l,I);return T(M,C)};var T=t.retrieveValueFromItem=function(I,C){if(I!=null){var M=l[C];if(M)return y(I,C,M.name)}};return t.getDimensionInfo=Ns(TIe,null,l,o),t.cloneAllDimensionInfo=Ns(MIe,null,l),t}function SIe(n){var e=n.sourceFormat;if(!PU(e)){var t="";ss(t)}return n.data}function AIe(n){var e=n.sourceFormat,t=n.data;if(!PU(e)){var r="";ss(r)}if(e===Ic){for(var i=[],s=0,a=t.length;s<a;s++)i.push(t[s].slice());return i}else if(e===kh){for(var i=[],s=0,a=t.length;s<a;s++)i.push(Jn({},t[s]));return i}}function TIe(n,e,t){if(t!=null){if(Is(t)||!isNaN(t)&&!$m(e,t))return n[t];if($m(e,t))return e[t]}}function MIe(n){return vi(n)}var sse=ri();function CIe(n){n=vi(n);var e=n.type,t="";e||ss(t);var r=e.split(":");r.length!==2&&ss(t);var i=!1;r[0]==="echarts"&&(e=r[1],i=!0),n.__isBuiltIn=i,sse.set(e,n)}function EIe(n,e,t){var r=da(n),i=r.length,s="";i||ss(s);for(var a=0,l=i;a<l;a++){var o=r[a];e=IIe(o,e),a!==l-1&&(e.length=Math.max(e.length,1))}return e}function IIe(n,e,t,r){var i="";e.length||ss(i),Xr(n)||ss(i);var s=n.type,a=sse.get(s);a||ss(i);var l=xr(e,function(h){return wIe(h,a)}),o=da(a.transform({upstream:l[0],upstreamList:l,config:vi(n.config)}));return xr(o,function(h,d){var m="";Xr(h)||ss(m),h.data||ss(m);var _=Yie(h.data);PU(_)||ss(m);var y,T=e[0];if(T&&d===0&&!h.dimensions){var I=T.startIndex;I&&(h.data=T.data.slice(0,I).concat(h.data)),y={seriesLayoutBy:ap,sourceHeader:I,dimensions:T.metaRawOption.dimensions}}else y={seriesLayoutBy:ap,sourceHeader:0,dimensions:h.dimensions};return ZF(h.data,y,null)})}function PU(n){return n===Ic||n===kh}var kD="undefined",RIe=typeof Uint32Array===kD?Array:Uint32Array,PIe=typeof Uint16Array===kD?Array:Uint16Array,ose=typeof Int32Array===kD?Array:Int32Array,$$=typeof Float64Array===kD?Array:Float64Array,ase={float:$$,int:ose,ordinal:Array,number:Array,time:$$},NB;function j2(n){return n>65535?RIe:PIe}function R1(){return[1/0,-1/0]}function LIe(n){var e=n.constructor;return e===Array?n.slice():new e(n)}function q$(n,e,t,r,i){var s=ase[t||"float"];if(i){var a=n[e],l=a&&a.length;if(l!==r){for(var o=new s(r),h=0;h<l;h++)o[h]=a[h];n[e]=o}}else n[e]=new s(r)}var YF=function(){function n(){this._chunks=[],this._rawExtent=[],this._extent=[],this._count=0,this._rawCount=0,this._calcDimNameToIdx=ri()}return n.prototype.initData=function(e,t,r){this._provider=e,this._chunks=[],this._indices=null,this.getRawIndex=this._getRawIdxIdentity;var i=e.getSource(),s=this.defaultDimValueGetter=NB[i.sourceFormat];this._dimValueGetter=r||s,this._rawExtent=[],Kie(i),this._dimensions=xr(t,function(a){return{type:a.type,property:a.property}}),this._initDataFromProvider(0,e.count())},n.prototype.getProvider=function(){return this._provider},n.prototype.getSource=function(){return this._provider.getSource()},n.prototype.ensureCalculationDimension=function(e,t){var r=this._calcDimNameToIdx,i=this._dimensions,s=r.get(e);if(s!=null){if(i[s].type===t)return s}else s=i.length;return i[s]={type:t},r.set(e,s),this._chunks[s]=new ase[t||"float"](this._rawCount),this._rawExtent[s]=R1(),s},n.prototype.collectOrdinalMeta=function(e,t){var r=this._chunks[e],i=this._dimensions[e],s=this._rawExtent,a=i.ordinalOffset||0,l=r.length;a===0&&(s[e]=R1());for(var o=s[e],h=a;h<l;h++){var d=r[h]=t.parseAndCollect(r[h]);isNaN(d)||(o[0]=Math.min(d,o[0]),o[1]=Math.max(d,o[1]))}i.ordinalMeta=t,i.ordinalOffset=l,i.type="ordinal"},n.prototype.getOrdinalMeta=function(e){var t=this._dimensions[e],r=t.ordinalMeta;return r},n.prototype.getDimensionProperty=function(e){var t=this._dimensions[e];return t&&t.property},n.prototype.appendData=function(e){var t=this._provider,r=this.count();t.appendData(e);var i=t.count();return t.persistent||(i+=r),r<i&&this._initDataFromProvider(r,i,!0),[r,i]},n.prototype.appendValues=function(e,t){for(var r=this._chunks,i=this._dimensions,s=i.length,a=this._rawExtent,l=this.count(),o=l+Math.max(e.length,t||0),h=0;h<s;h++){var d=i[h];q$(r,h,d.type,o,!0)}for(var m=[],_=l;_<o;_++)for(var y=_-l,T=0;T<s;T++){var d=i[T],I=NB.arrayRows.call(this,e[y]||m,d.property,y,T);r[T][_]=I;var C=a[T];I<C[0]&&(C[0]=I),I>C[1]&&(C[1]=I)}return this._rawCount=this._count=o,{start:l,end:o}},n.prototype._initDataFromProvider=function(e,t,r){for(var i=this._provider,s=this._chunks,a=this._dimensions,l=a.length,o=this._rawExtent,h=xr(a,function(B){return B.property}),d=0;d<l;d++){var m=a[d];o[d]||(o[d]=R1()),q$(s,d,m.type,t,r)}if(i.fillStorage)i.fillStorage(e,t,s,o);else for(var _=[],y=e;y<t;y++){_=i.getItem(y,_);for(var T=0;T<l;T++){var I=s[T],C=this._dimValueGetter(_,h[T],y,T);I[y]=C;var M=o[T];C<M[0]&&(M[0]=C),C>M[1]&&(M[1]=C)}}!i.persistent&&i.clean&&i.clean(),this._rawCount=this._count=t,this._extent=[]},n.prototype.count=function(){return this._count},n.prototype.get=function(e,t){if(!(t>=0&&t<this._count))return NaN;var r=this._chunks[e];return r?r[this.getRawIndex(t)]:NaN},n.prototype.getValues=function(e,t){var r=[],i=[];if(t==null){t=e,e=[];for(var s=0;s<this._dimensions.length;s++)i.push(s)}else i=e;for(var s=0,a=i.length;s<a;s++)r.push(this.get(i[s],t));return r},n.prototype.getByRawIndex=function(e,t){if(!(t>=0&&t<this._rawCount))return NaN;var r=this._chunks[e];return r?r[t]:NaN},n.prototype.getSum=function(e){var t=this._chunks[e],r=0;if(t)for(var i=0,s=this.count();i<s;i++){var a=this.get(e,i);isNaN(a)||(r+=a)}return r},n.prototype.getMedian=function(e){var t=[];this.each([e],function(s){isNaN(s)||t.push(s)});var r=t.sort(function(s,a){return s-a}),i=this.count();return i===0?0:i%2===1?r[(i-1)/2]:(r[i/2]+r[i/2-1])/2},n.prototype.indexOfRawIndex=function(e){if(e>=this._rawCount||e<0)return-1;if(!this._indices)return e;var t=this._indices,r=t[e];if(r!=null&&r<this._count&&r===e)return e;for(var i=0,s=this._count-1;i<=s;){var a=(i+s)/2|0;if(t[a]<e)i=a+1;else if(t[a]>e)s=a-1;else return a}return-1},n.prototype.indicesOfNearest=function(e,t,r){var i=this._chunks,s=i[e],a=[];if(!s)return a;r==null&&(r=1/0);for(var l=1/0,o=-1,h=0,d=0,m=this.count();d<m;d++){var _=this.getRawIndex(d),y=t-s[_],T=Math.abs(y);T<=r&&((T<l||T===l&&y>=0&&o<0)&&(l=T,o=y,h=0),y===o&&(a[h++]=d))}return a.length=h,a},n.prototype.getIndices=function(){var e,t=this._indices;if(t){var r=t.constructor,i=this._count;if(r===Array){e=new r(i);for(var s=0;s<i;s++)e[s]=t[s]}else e=new r(t.buffer,0,i)}else{var r=j2(this._rawCount);e=new r(this.count());for(var s=0;s<e.length;s++)e[s]=s}return e},n.prototype.filter=function(e,t){if(!this._count)return this;for(var r=this.clone(),i=r.count(),s=j2(r._rawCount),a=new s(i),l=[],o=e.length,h=0,d=e[0],m=r._chunks,_=0;_<i;_++){var y=void 0,T=r.getRawIndex(_);if(o===0)y=t(_);else if(o===1){var I=m[d][T];y=t(I,_)}else{for(var C=0;C<o;C++)l[C]=m[e[C]][T];l[C]=_,y=t.apply(null,l)}y&&(a[h++]=T)}return h<i&&(r._indices=a),r._count=h,r._extent=[],r._updateGetRawIdx(),r},n.prototype.selectRange=function(e){var t=this.clone(),r=t._count;if(!r)return this;var i=io(e),s=i.length;if(!s)return this;var a=t.count(),l=j2(t._rawCount),o=new l(a),h=0,d=i[0],m=e[d][0],_=e[d][1],y=t._chunks,T=!1;if(!t._indices){var I=0;if(s===1){for(var C=y[i[0]],M=0;M<r;M++){var B=C[M];(B>=m&&B<=_||isNaN(B))&&(o[h++]=I),I++}T=!0}else if(s===2){for(var C=y[i[0]],k=y[i[1]],j=e[i[1]][0],q=e[i[1]][1],M=0;M<r;M++){var B=C[M],Z=k[M];(B>=m&&B<=_||isNaN(B))&&(Z>=j&&Z<=q||isNaN(Z))&&(o[h++]=I),I++}T=!0}}if(!T)if(s===1)for(var M=0;M<a;M++){var te=t.getRawIndex(M),B=y[i[0]][te];(B>=m&&B<=_||isNaN(B))&&(o[h++]=te)}else for(var M=0;M<a;M++){for(var ie=!0,te=t.getRawIndex(M),se=0;se<s;se++){var ae=i[se],B=y[ae][te];(B<e[ae][0]||B>e[ae][1])&&(ie=!1)}ie&&(o[h++]=t.getRawIndex(M))}return h<a&&(t._indices=o),t._count=h,t._extent=[],t._updateGetRawIdx(),t},n.prototype.map=function(e,t){var r=this.clone(e);return this._updateDims(r,e,t),r},n.prototype.modify=function(e,t){this._updateDims(this,e,t)},n.prototype._updateDims=function(e,t,r){for(var i=e._chunks,s=[],a=t.length,l=e.count(),o=[],h=e._rawExtent,d=0;d<t.length;d++)h[t[d]]=R1();for(var m=0;m<l;m++){for(var _=e.getRawIndex(m),y=0;y<a;y++)o[y]=i[t[y]][_];o[a]=m;var T=r&&r.apply(null,o);if(T!=null){typeof T!="object"&&(s[0]=T,T=s);for(var d=0;d<T.length;d++){var I=t[d],C=T[d],M=h[I],B=i[I];B&&(B[_]=C),C<M[0]&&(M[0]=C),C>M[1]&&(M[1]=C)}}}},n.prototype.lttbDownSample=function(e,t){var r=this.clone([e],!0),i=r._chunks,s=i[e],a=this.count(),l=0,o=Math.floor(1/t),h=this.getRawIndex(0),d,m,_,y=new(j2(this._rawCount))(Math.min((Math.ceil(a/o)+2)*2,a));y[l++]=h;for(var T=1;T<a-1;T+=o){for(var I=Math.min(T+o,a-1),C=Math.min(T+o*2,a),M=(C+I)/2,B=0,k=I;k<C;k++){var j=this.getRawIndex(k),q=s[j];isNaN(q)||(B+=q)}B/=C-I;var Z=T,te=Math.min(T+o,a),ie=T-1,se=s[h];d=-1,_=Z;for(var ae=-1,fe=0,k=Z;k<te;k++){var j=this.getRawIndex(k),q=s[j];if(isNaN(q)){fe++,ae<0&&(ae=j);continue}m=Math.abs((ie-M)*(q-se)-(ie-k)*(B-se)),m>d&&(d=m,_=j)}fe>0&&fe<te-Z&&(y[l++]=Math.min(ae,_),_=Math.max(ae,_)),y[l++]=_,h=_}return y[l++]=this.getRawIndex(a-1),r._count=l,r._indices=y,r.getRawIndex=this._getRawIdx,r},n.prototype.downSample=function(e,t,r,i){for(var s=this.clone([e],!0),a=s._chunks,l=[],o=Math.floor(1/t),h=a[e],d=this.count(),m=s._rawExtent[e]=R1(),_=new(j2(this._rawCount))(Math.ceil(d/o)),y=0,T=0;T<d;T+=o){o>d-T&&(o=d-T,l.length=o);for(var I=0;I<o;I++){var C=this.getRawIndex(T+I);l[I]=h[C]}var M=r(l),B=this.getRawIndex(Math.min(T+i(l,M)||0,d-1));h[B]=M,M<m[0]&&(m[0]=M),M>m[1]&&(m[1]=M),_[y++]=B}return s._count=y,s._indices=_,s._updateGetRawIdx(),s},n.prototype.each=function(e,t){if(this._count)for(var r=e.length,i=this._chunks,s=0,a=this.count();s<a;s++){var l=this.getRawIndex(s);switch(r){case 0:t(s);break;case 1:t(i[e[0]][l],s);break;case 2:t(i[e[0]][l],i[e[1]][l],s);break;default:for(var o=0,h=[];o<r;o++)h[o]=i[e[o]][l];h[o]=s,t.apply(null,h)}}},n.prototype.getDataExtent=function(e){var t=this._chunks[e],r=R1();if(!t)return r;var i=this.count(),s=!this._indices,a;if(s)return this._rawExtent[e].slice();if(a=this._extent[e],a)return a.slice();a=r;for(var l=a[0],o=a[1],h=0;h<i;h++){var d=this.getRawIndex(h),m=t[d];m<l&&(l=m),m>o&&(o=m)}return a=[l,o],this._extent[e]=a,a},n.prototype.getRawDataItem=function(e){var t=this.getRawIndex(e);if(this._provider.persistent)return this._provider.getItem(t);for(var r=[],i=this._chunks,s=0;s<i.length;s++)r.push(i[s][t]);return r},n.prototype.clone=function(e,t){var r=new n,i=this._chunks,s=e&&hv(e,function(l,o){return l[o]=!0,l},{});if(s)for(var a=0;a<i.length;a++)r._chunks[a]=s[a]?LIe(i[a]):i[a];else r._chunks=i;return this._copyCommonProps(r),t||(r._indices=this._cloneIndices()),r._updateGetRawIdx(),r},n.prototype._copyCommonProps=function(e){e._count=this._count,e._rawCount=this._rawCount,e._provider=this._provider,e._dimensions=this._dimensions,e._extent=vi(this._extent),e._rawExtent=vi(this._rawExtent)},n.prototype._cloneIndices=function(){if(this._indices){var e=this._indices.constructor,t=void 0;if(e===Array){var r=this._indices.length;t=new e(r);for(var i=0;i<r;i++)t[i]=this._indices[i]}else t=new e(this._indices);return t}return null},n.prototype._getRawIdxIdentity=function(e){return e},n.prototype._getRawIdx=function(e){return e<this._count&&e>=0?this._indices[e]:-1},n.prototype._updateGetRawIdx=function(){this.getRawIndex=this._indices?this._getRawIdx:this._getRawIdxIdentity},n.internalField=function(){function e(t,r,i,s){return jI(t[s],this._dimensions[s])}NB={arrayRows:e,objectRows:function(t,r,i,s){return jI(t[r],this._dimensions[s])},keyedColumns:e,original:function(t,r,i,s){var a=t&&(t.value==null?t:t.value);return jI(a instanceof Array?a[s]:a,this._dimensions[s])},typedArray:function(t,r,i,s){return t[s]}}}(),n}(),lse=function(){function n(e){this._sourceList=[],this._storeList=[],this._upstreamSignList=[],this._versionSignBase=0,this._dirty=!0,this._sourceHost=e}return n.prototype.dirty=function(){this._setLocalSource([],[]),this._storeList=[],this._dirty=!0},n.prototype._setLocalSource=function(e,t){this._sourceList=e,this._upstreamSignList=t,this._versionSignBase++,this._versionSignBase>9e10&&(this._versionSignBase=0)},n.prototype._getVersionSign=function(){return this._sourceHost.uid+"_"+this._versionSignBase},n.prototype.prepareSource=function(){this._isDirty()&&(this._createSource(),this._dirty=!1)},n.prototype._createSource=function(){this._setLocalSource([],[]);var e=this._sourceHost,t=this._getUpstreamSourceManagers(),r=!!t.length,i,s;if(OE(e)){var a=e,l=void 0,o=void 0,h=void 0;if(r){var d=t[0];d.prepareSource(),h=d.getSource(),l=h.data,o=h.sourceFormat,s=[d._getVersionSign()]}else l=a.get("data",!0),o=hu(l)?rv:Bh,s=[];var m=this._getSourceMetaRawOption()||{},_=h&&h.metaRawOption||{},y=Ci(m.seriesLayoutBy,_.seriesLayoutBy)||null,T=Ci(m.sourceHeader,_.sourceHeader),I=Ci(m.dimensions,_.dimensions),C=y!==_.seriesLayoutBy||!!T!=!!_.sourceHeader||I;i=C?[ZF(l,{seriesLayoutBy:y,sourceHeader:T,dimensions:I},o)]:[]}else{var M=e;if(r){var B=this._applyTransform(t);i=B.sourceList,s=B.upstreamSignList}else{var k=M.get("source",!0);i=[ZF(k,this._getSourceMetaRawOption(),null)],s=[]}}this._setLocalSource(i,s)},n.prototype._applyTransform=function(e){var t=this._sourceHost,r=t.get("transform",!0),i=t.get("fromTransformResult",!0);if(i!=null){var s="";e.length!==1&&Y$(s)}var a,l=[],o=[];return it(e,function(h){h.prepareSource();var d=h.getSource(i||0),m="";i!=null&&!d&&Y$(m),l.push(d),o.push(h._getVersionSign())}),r?a=EIe(r,l,{datasetIndex:t.componentIndex}):i!=null&&(a=[lIe(l[0])]),{sourceList:a,upstreamSignList:o}},n.prototype._isDirty=function(){if(this._dirty)return!0;for(var e=this._getUpstreamSourceManagers(),t=0;t<e.length;t++){var r=e[t];if(r._isDirty()||this._upstreamSignList[t]!==r._getVersionSign())return!0}},n.prototype.getSource=function(e){e=e||0;var t=this._sourceList[e];if(!t){var r=this._getUpstreamSourceManagers();return r[0]&&r[0].getSource(e)}return t},n.prototype.getSharedDataStore=function(e){var t=e.makeStoreSchema();return this._innerGetDataStore(t.dimensions,e.source,t.hash)},n.prototype._innerGetDataStore=function(e,t,r){var i=0,s=this._storeList,a=s[i];a||(a=s[i]={});var l=a[r];if(!l){var o=this._getUpstreamSourceManagers()[0];OE(this._sourceHost)&&o?l=o._innerGetDataStore(e,t,r):(l=new YF,l.initData(new Jie(t,e.length),e)),a[r]=l}return l},n.prototype._getUpstreamSourceManagers=function(){var e=this._sourceHost;if(OE(e)){var t=TU(e);return t?[t.getSourceManager()]:[]}else return xr(FEe(e),function(r){return r.getSourceManager()})},n.prototype._getSourceMetaRawOption=function(){var e=this._sourceHost,t,r,i;if(OE(e))t=e.get("seriesLayoutBy",!0),r=e.get("sourceHeader",!0),i=e.get("dimensions",!0);else if(!this._getUpstreamSourceManagers().length){var s=e;t=s.get("seriesLayoutBy",!0),r=s.get("sourceHeader",!0),i=s.get("dimensions",!0)}return{seriesLayoutBy:t,sourceHeader:r,dimensions:i}},n}();function Z$(n){var e=n.option.transform;e&&aP(n.option.transform)}function OE(n){return n.mainType==="series"}function Y$(n){throw new Error(n)}var cse="line-height:1";function use(n,e){var t=n.color||"#6e7079",r=n.fontSize||12,i=n.fontWeight||"400",s=n.color||"#464646",a=n.fontSize||14,l=n.fontWeight||"900";return e==="html"?{nameStyle:"font-size:"+Eu(r+"")+"px;color:"+Eu(t)+";font-weight:"+Eu(i+""),valueStyle:"font-size:"+Eu(a+"")+"px;color:"+Eu(s)+";font-weight:"+Eu(l+"")}:{nameStyle:{fontSize:r,fill:t,fontWeight:i},valueStyle:{fontSize:a,fill:s,fontWeight:l}}}var DIe=[0,10,20,30],BIe=["",`
`,`

`,`


`];function rT(n,e){return e.type=n,e}function KF(n){return n.type==="section"}function hse(n){return KF(n)?kIe:OIe}function fse(n){if(KF(n)){var e=0,t=n.blocks.length,r=t>1||t>0&&!n.noHeader;return it(n.blocks,function(i){var s=fse(i);s>=e&&(e=s+ +(r&&(!s||KF(i)&&!i.noHeader)))}),e}return 0}function kIe(n,e,t,r){var i=e.noHeader,s=FIe(fse(e)),a=[],l=e.blocks||[];hp(!l||fr(l)),l=l||[];var o=n.orderMode;if(e.sortBlocks&&o){l=l.slice();var h={valueAsc:"asc",valueDesc:"desc"};if($m(h,o)){var d=new ise(h[o],null);l.sort(function(T,I){return d.evaluate(T.sortParam,I.sortParam)})}else o==="seriesDesc"&&l.reverse()}it(l,function(T,I){var C=e.valueFormatter,M=hse(T)(C?Jn(Jn({},n),{valueFormatter:C}):n,T,I>0?s.html:0,r);M!=null&&a.push(M)});var m=n.renderMode==="richText"?a.join(s.richText):JF(a.join(""),i?t:s.html);if(i)return m;var _=$F(e.header,"ordinal",n.useUTC),y=use(r,n.renderMode).nameStyle;return n.renderMode==="richText"?dse(n,_,y)+s.richText+m:JF('<div style="'+y+";"+cse+';">'+Eu(_)+"</div>"+m,t)}function OIe(n,e,t,r){var i=n.renderMode,s=e.noName,a=e.noValue,l=!e.markerType,o=e.name,h=n.useUTC,d=e.valueFormatter||n.valueFormatter||function(j){return j=fr(j)?j:[j],xr(j,function(q,Z){return $F(q,fr(y)?y[Z]:y,h)})};if(!(s&&a)){var m=l?"":n.markupStyleCreator.makeTooltipMarker(e.markerType,e.markerColor||"#333",i),_=s?"":$F(o,"ordinal",h),y=e.valueType,T=a?[]:d(e.value,e.dataIndex),I=!l||!s,C=!l&&s,M=use(r,i),B=M.nameStyle,k=M.valueStyle;return i==="richText"?(l?"":m)+(s?"":dse(n,_,B))+(a?"":UIe(n,T,I,C,k)):JF((l?"":m)+(s?"":NIe(_,!l,B))+(a?"":zIe(T,I,C,k)),t)}}function K$(n,e,t,r,i,s){if(n){var a=hse(n),l={useUTC:i,renderMode:t,orderMode:r,markupStyleCreator:e,valueFormatter:n.valueFormatter};return a(l,n,0,s)}}function FIe(n){return{html:DIe[n],richText:BIe[n]}}function JF(n,e){var t='<div style="clear:both"></div>',r="margin: "+e+"px 0 0";return'<div style="'+r+";"+cse+';">'+n+t+"</div>"}function NIe(n,e,t){var r=e?"margin-left:2px":"";return'<span style="'+t+";"+r+'">'+Eu(n)+"</span>"}function zIe(n,e,t,r){var i=t?"10px":"20px",s=e?"float:right;margin-left:"+i:"";return n=fr(n)?n:[n],'<span style="'+s+";"+r+'">'+xr(n,function(a){return Eu(a)}).join("&nbsp;&nbsp;")+"</span>"}function dse(n,e,t){return n.markupStyleCreator.wrapRichTextStyle(e,t)}function UIe(n,e,t,r,i){var s=[i],a=r?10:20;return t&&s.push({padding:[0,0,0,a],align:"right"}),n.markupStyleCreator.wrapRichTextStyle(fr(e)?e.join("  "):e,s)}function VIe(n,e){var t=n.getData().getItemVisual(e,"style"),r=t[n.visualDrawType];return ex(r)}function pse(n,e){var t=n.get("padding");return t??(e==="richText"?[8,10]:10)}var zB=function(){function n(){this.richTextStyles={},this._nextStyleNameId=Are()}return n.prototype._generateStyleName=function(){return"__EC_aUTo_"+this._nextStyleNameId++},n.prototype.makeTooltipMarker=function(e,t,r){var i=r==="richText"?this._generateStyleName():null,s=CEe({color:t,type:e,renderMode:r,markerId:i});return Dr(s)?s:(this.richTextStyles[i]=s.style,s.content)},n.prototype.wrapRichTextStyle=function(e,t){var r={};fr(t)?it(t,function(s){return Jn(r,s)}):Jn(r,t);var i=this._generateStyleName();return this.richTextStyles[i]=r,"{"+i+"|"+e+"}"},n}();function GIe(n){var e=n.series,t=n.dataIndex,r=n.multipleSeries,i=e.getData(),s=i.mapDimensionsAll("defaultedTooltip"),a=s.length,l=e.getRawValue(t),o=fr(l),h=VIe(e,t),d,m,_,y;if(a>1||o&&!a){var T=HIe(l,e,t,s,h);d=T.inlineValues,m=T.inlineValueTypes,_=T.blocks,y=T.inlineValues[0]}else if(a){var I=i.getDimensionInfo(s[0]);y=d=ew(i,t,s[0]),m=I.type}else y=d=o?l[0]:l;var C=iU(e),M=C&&e.name||"",B=i.getName(t),k=r?M:B;return rT("section",{header:M,noHeader:r||!C,sortParam:y,blocks:[rT("nameValue",{markerType:"item",markerColor:h,name:k,noName:!Jd(k),value:d,valueType:m,dataIndex:t})].concat(_||[])})}function HIe(n,e,t,r,i){var s=e.getData(),a=hv(n,function(m,_,y){var T=s.getDimensionInfo(y);return m=m||T&&T.tooltip!==!1&&T.displayName!=null},!1),l=[],o=[],h=[];r.length?it(r,function(m){d(ew(s,t,m),m)}):it(n,d);function d(m,_){var y=s.getDimensionInfo(_);!y||y.otherDims.tooltip===!1||(a?h.push(rT("nameValue",{markerType:"subItem",markerColor:i,name:y.displayName,value:m,valueType:y.type})):(l.push(m),o.push(y.type)))}return{inlineValues:l,inlineValueTypes:o,blocks:h}}var g0=Xs();function FE(n,e){return n.getName(e)||n.getId(e)}var WI="__universalTransitionEnabled",Zf=function(n){Hn(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t._selectedDataIndicesMap={},t}return e.prototype.init=function(t,r,i){this.seriesIndex=this.componentIndex,this.dataTask=nA({count:WIe,reset:XIe}),this.dataTask.context={model:this},this.mergeDefaultAndTheme(t,i);var s=g0(this).sourceManager=new lse(this);s.prepareSource();var a=this.getInitialData(t,i);Q$(a,this),this.dataTask.context.data=a,g0(this).dataBeforeProcessed=a,J$(this),this._initSelectedMapFromData(a)},e.prototype.mergeDefaultAndTheme=function(t,r){var i=tT(this),s=i?DD(t):{},a=this.subType;is.hasClass(a)&&(a+="Series"),Li(t,r.getTheme().get(this.subType)),Li(t,this.getDefaultOption()),kF(t,"label",["show"]),this.fillDataTextStyle(t.data),i&&Qb(t,s,i)},e.prototype.mergeOption=function(t,r){t=Li(this.option,t,!0),this.fillDataTextStyle(t.data);var i=tT(this);i&&Qb(this.option,t,i);var s=g0(this).sourceManager;s.dirty(),s.prepareSource();var a=this.getInitialData(t,r);Q$(a,this),this.dataTask.dirty(),this.dataTask.context.data=a,g0(this).dataBeforeProcessed=a,J$(this),this._initSelectedMapFromData(a)},e.prototype.fillDataTextStyle=function(t){if(t&&!hu(t))for(var r=["show"],i=0;i<t.length;i++)t[i]&&t[i].label&&kF(t[i],"label",r)},e.prototype.getInitialData=function(t,r){},e.prototype.appendData=function(t){var r=this.getRawData();r.appendData(t.data)},e.prototype.getData=function(t){var r=QF(this);if(r){var i=r.context.data;return t==null||!i.getLinkedData?i:i.getLinkedData(t)}else return g0(this).data},e.prototype.getAllData=function(){var t=this.getData();return t&&t.getLinkedDataAll?t.getLinkedDataAll():[{data:t}]},e.prototype.setData=function(t){var r=QF(this);if(r){var i=r.context;i.outputData=t,r!==this.dataTask&&(i.data=t)}g0(this).data=t},e.prototype.getEncode=function(){var t=this.get("encode",!0);if(t)return ri(t)},e.prototype.getSourceManager=function(){return g0(this).sourceManager},e.prototype.getSource=function(){return this.getSourceManager().getSource()},e.prototype.getRawData=function(){return g0(this).dataBeforeProcessed},e.prototype.getColorBy=function(){var t=this.get("colorBy");return t||"series"},e.prototype.isColorBySeries=function(){return this.getColorBy()==="series"},e.prototype.getBaseAxis=function(){var t=this.coordinateSystem;return t&&t.getBaseAxis&&t.getBaseAxis()},e.prototype.formatTooltip=function(t,r,i){return GIe({series:this,dataIndex:t,multipleSeries:r})},e.prototype.isAnimationEnabled=function(){var t=this.ecModel;if(pi.node&&!(t&&t.ssr))return!1;var r=this.getShallow("animation");return r&&this.getData().count()>this.getShallow("animationThreshold")&&(r=!1),!!r},e.prototype.restoreData=function(){this.dataTask.dirty()},e.prototype.getColorFromPalette=function(t,r,i){var s=this.ecModel,a=MU.prototype.getColorFromPalette.call(this,t,r,i);return a||(a=s.getColorFromPalette(t,r,i)),a},e.prototype.coordDimToDataDim=function(t){return this.getRawData().mapDimensionsAll(t)},e.prototype.getProgressive=function(){return this.get("progressive")},e.prototype.getProgressiveThreshold=function(){return this.get("progressiveThreshold")},e.prototype.select=function(t,r){this._innerSelect(this.getData(r),t)},e.prototype.unselect=function(t,r){var i=this.option.selectedMap;if(i){var s=this.option.selectedMode,a=this.getData(r);if(s==="series"||i==="all"){this.option.selectedMap={},this._selectedDataIndicesMap={};return}for(var l=0;l<t.length;l++){var o=t[l],h=FE(a,o);i[h]=!1,this._selectedDataIndicesMap[h]=-1}}},e.prototype.toggleSelect=function(t,r){for(var i=[],s=0;s<t.length;s++)i[0]=t[s],this.isSelected(t[s],r)?this.unselect(i,r):this.select(i,r)},e.prototype.getSelectedDataIndices=function(){if(this.option.selectedMap==="all")return[].slice.call(this.getData().getIndices());for(var t=this._selectedDataIndicesMap,r=io(t),i=[],s=0;s<r.length;s++){var a=t[r[s]];a>=0&&i.push(a)}return i},e.prototype.isSelected=function(t,r){var i=this.option.selectedMap;if(!i)return!1;var s=this.getData(r);return(i==="all"||i[FE(s,t)])&&!s.getItemModel(t).get(["select","disabled"])},e.prototype.isUniversalTransitionEnabled=function(){if(this[WI])return!0;var t=this.option.universalTransition;return t?t===!0?!0:t&&t.enabled:!1},e.prototype._innerSelect=function(t,r){var i,s,a=this.option,l=a.selectedMode,o=r.length;if(!(!l||!o)){if(l==="series")a.selectedMap="all";else if(l==="multiple"){Xr(a.selectedMap)||(a.selectedMap={});for(var h=a.selectedMap,d=0;d<o;d++){var m=r[d],_=FE(t,m);h[_]=!0,this._selectedDataIndicesMap[_]=t.getRawIndex(m)}}else if(l==="single"||l===!0){var y=r[o-1],_=FE(t,y);a.selectedMap=(i={},i[_]=!0,i),this._selectedDataIndicesMap=(s={},s[_]=t.getRawIndex(y),s)}}},e.prototype._initSelectedMapFromData=function(t){if(!this.option.selectedMap){var r=[];t.hasItemOption&&t.each(function(i){var s=t.getRawDataItem(i);s&&s.selected&&r.push(i)}),r.length>0&&this._innerSelect(t,r)}},e.registerClass=function(t){return is.registerClass(t)},e.protoInitialize=function(){var t=e.prototype;t.type="series.__base__",t.seriesIndex=0,t.ignoreStyleOnData=!1,t.hasSymbolVisual=!1,t.defaultSymbol="circle",t.visualStyleAccessPath="itemStyle",t.visualDrawType="fill"}(),e}(is);nd(Zf,mIe);nd(Zf,MU);Lre(Zf,is);function J$(n){var e=n.name;iU(n)||(n.name=jIe(n)||e)}function jIe(n){var e=n.getRawData(),t=e.mapDimensionsAll("seriesName"),r=[];return it(t,function(i){var s=e.getDimensionInfo(i);s.displayName&&r.push(s.displayName)}),r.join(" ")}function WIe(n){return n.model.getRawData().count()}function XIe(n){var e=n.model;return e.setData(e.getRawData().cloneShallow()),$Ie}function $Ie(n,e){e.outputData&&n.end>e.outputData.count()&&e.model.getRawData().cloneShallow(e.outputData)}function Q$(n,e){it(mAe(n.CHANGABLE_METHODS,n.DOWNSAMPLE_METHODS),function(t){n.wrapMethod(t,ms(qIe,e))})}function qIe(n,e){var t=QF(n);return t&&t.setOutputEnd((e||this).count()),e}function QF(n){var e=(n.ecModel||{}).scheduler,t=e&&e.getPipeline(n.uid);if(t){var r=t.currentTask;if(r){var i=r.agentStubMap;i&&(r=i.get(n.uid))}return r}}var Rc=function(){function n(){this.group=new pa,this.uid=tM("viewComponent")}return n.prototype.init=function(e,t){},n.prototype.render=function(e,t,r,i){},n.prototype.dispose=function(e,t){},n.prototype.updateView=function(e,t,r,i){},n.prototype.updateLayout=function(e,t,r,i){},n.prototype.updateVisual=function(e,t,r,i){},n.prototype.toggleBlurSeries=function(e,t,r){},n.prototype.eachRendered=function(e){var t=this.group;t&&t.traverse(e)},n}();oU(Rc);fD(Rc);function LU(){var n=Xs();return function(e){var t=n(e),r=e.pipelineContext,i=!!t.large,s=!!t.progressiveRender,a=t.large=!!(r&&r.large),l=t.progressiveRender=!!(r&&r.progressiveRender);return(i!==a||s!==l)&&"reset"}}var mse=Xs(),ZIe=LU(),Mh=function(){function n(){this.group=new pa,this.uid=tM("viewChart"),this.renderTask=nA({plan:YIe,reset:KIe}),this.renderTask.context={view:this}}return n.prototype.init=function(e,t){},n.prototype.render=function(e,t,r,i){},n.prototype.highlight=function(e,t,r,i){var s=e.getData(i&&i.dataType);s&&tq(s,i,"emphasis")},n.prototype.downplay=function(e,t,r,i){var s=e.getData(i&&i.dataType);s&&tq(s,i,"normal")},n.prototype.remove=function(e,t){this.group.removeAll()},n.prototype.dispose=function(e,t){},n.prototype.updateView=function(e,t,r,i){this.render(e,t,r,i)},n.prototype.updateLayout=function(e,t,r,i){this.render(e,t,r,i)},n.prototype.updateVisual=function(e,t,r,i){this.render(e,t,r,i)},n.prototype.eachRendered=function(e){TD(this.group,e)},n.markUpdateMethod=function(e,t){mse(e).updateMethod=t},n.protoInitialize=function(){var e=n.prototype;e.type="chart"}(),n}();function eq(n,e,t){n&&GF(n)&&(e==="emphasis"?Kb:Jb)(n,t)}function tq(n,e,t){var r=Qy(n,e),i=e&&e.highlightKey!=null?pCe(e.highlightKey):null;r!=null?it(da(r),function(s){eq(n.getItemGraphicEl(s),t,i)}):n.eachItemGraphicEl(function(s){eq(s,t,i)})}oU(Mh);fD(Mh);function YIe(n){return ZIe(n.model)}function KIe(n){var e=n.model,t=n.ecModel,r=n.api,i=n.payload,s=e.pipelineContext.progressiveRender,a=n.view,l=i&&mse(i).updateMethod,o=s?"incrementalPrepareRender":l&&a[l]?l:"render";return o!=="render"&&a[o](e,t,r,i),JIe[o]}var JIe={incrementalPrepareRender:{progress:function(n,e){e.view.incrementalRender(n,e.model,e.ecModel,e.api,e.payload)}},render:{forceFirstProgress:!0,progress:function(n,e){e.view.render(e.model,e.ecModel,e.api,e.payload)}}},MP="\0__throttleOriginMethod",nq="\0__throttleRate",rq="\0__throttleType";function DU(n,e,t){var r,i=0,s=0,a=null,l,o,h,d;e=e||0;function m(){s=new Date().getTime(),a=null,n.apply(o,h||[])}var _=function(){for(var y=[],T=0;T<arguments.length;T++)y[T]=arguments[T];r=new Date().getTime(),o=this,h=y;var I=d||e,C=d||t;d=null,l=r-(C?i:s)-I,clearTimeout(a),C?a=setTimeout(m,I):l>=0?m():a=setTimeout(m,-l),i=r};return _.clear=function(){a&&(clearTimeout(a),a=null)},_.debounceNextCall=function(y){d=y},_}function gse(n,e,t,r){var i=n[e];if(i){var s=i[MP]||i,a=i[rq],l=i[nq];if(l!==t||a!==r){if(t==null||!r)return n[e]=s;i=n[e]=DU(s,t,r==="debounce"),i[MP]=s,i[rq]=r,i[nq]=t}return i}}function eN(n,e){var t=n[e];t&&t[MP]&&(t.clear&&t.clear(),n[e]=t[MP])}var iq=Xs(),sq={itemStyle:KA(Tie,!0),lineStyle:KA(Aie,!0)},QIe={lineStyle:"stroke",itemStyle:"fill"};function vse(n,e){var t=n.visualStyleMapper||sq[e];return t||(console.warn("Unknown style type '"+e+"'."),sq.itemStyle)}function _se(n,e){var t=n.visualDrawType||QIe[e];return t||(console.warn("Unknown style type '"+e+"'."),"fill")}var eRe={createOnAllSeries:!0,performRawSeries:!0,reset:function(n,e){var t=n.getData(),r=n.visualStyleAccessPath||"itemStyle",i=n.getModel(r),s=vse(n,r),a=s(i),l=i.getShallow("decal");l&&(t.setVisual("decal",l),l.dirty=!0);var o=_se(n,r),h=a[o],d=li(h)?h:null,m=a.fill==="auto"||a.stroke==="auto";if(!a[o]||d||m){var _=n.getColorFromPalette(n.name,null,e.getSeriesCount());a[o]||(a[o]=_,t.setVisual("colorFromPalette",!0)),a.fill=a.fill==="auto"||li(a.fill)?_:a.fill,a.stroke=a.stroke==="auto"||li(a.stroke)?_:a.stroke}if(t.setVisual("style",a),t.setVisual("drawType",o),!e.isSeriesFiltered(n)&&d)return t.setVisual("colorFromPalette",!1),{dataEach:function(y,T){var I=n.getDataParams(T),C=Jn({},a);C[o]=d(I),y.setItemVisual(T,"style",C)}}}},W2=new Io,tRe={createOnAllSeries:!0,performRawSeries:!0,reset:function(n,e){if(!(n.ignoreStyleOnData||e.isSeriesFiltered(n))){var t=n.getData(),r=n.visualStyleAccessPath||"itemStyle",i=vse(n,r),s=t.getVisual("drawType");return{dataEach:t.hasItemOption?function(a,l){var o=a.getRawDataItem(l);if(o&&o[r]){W2.option=o[r];var h=i(W2),d=a.ensureUniqueItemVisual(l,"style");Jn(d,h),W2.option.decal&&(a.setItemVisual(l,"decal",W2.option.decal),W2.option.decal.dirty=!0),s in h&&a.setItemVisual(l,"colorFromPalette",!1)}}:null}}}},nRe={performRawSeries:!0,overallReset:function(n){var e=ri();n.eachSeries(function(t){var r=t.getColorBy();if(!t.isColorBySeries()){var i=t.type+"-"+r,s=e.get(i);s||(s={},e.set(i,s)),iq(t).scope=s}}),n.eachSeries(function(t){if(!(t.isColorBySeries()||n.isSeriesFiltered(t))){var r=t.getRawData(),i={},s=t.getData(),a=iq(t).scope,l=t.visualStyleAccessPath||"itemStyle",o=_se(t,l);s.each(function(h){var d=s.getRawIndex(h);i[d]=h}),r.each(function(h){var d=i[h],m=s.getItemVisual(d,"colorFromPalette");if(m){var _=s.ensureUniqueItemVisual(d,"style"),y=r.getName(h)||h+"",T=r.count();_[o]=t.getColorFromPalette(y,a,T)}})}})}},NE=Math.PI;function rRe(n,e){e=e||{},ti(e,{text:"loading",textColor:"#000",fontSize:12,fontWeight:"normal",fontStyle:"normal",fontFamily:"sans-serif",maskColor:"rgba(255, 255, 255, 0.8)",showSpinner:!0,color:"#5470c6",spinnerRadius:10,lineWidth:5,zlevel:0});var t=new pa,r=new Go({style:{fill:e.maskColor},zlevel:e.zlevel,z:1e4});t.add(r);var i=new Ca({style:{text:e.text,fill:e.textColor,fontSize:e.fontSize,fontWeight:e.fontWeight,fontStyle:e.fontStyle,fontFamily:e.fontFamily},zlevel:e.zlevel,z:10001}),s=new Go({style:{fill:"none"},textContent:i,textConfig:{position:"right",distance:10},zlevel:e.zlevel,z:10001});t.add(s);var a;return e.showSpinner&&(a=new xD({shape:{startAngle:-NE/2,endAngle:-NE/2+.1,r:e.spinnerRadius},style:{stroke:e.color,lineCap:"round",lineWidth:e.lineWidth},zlevel:e.zlevel,z:10001}),a.animateShape(!0).when(1e3,{endAngle:NE*3/2}).start("circularInOut"),a.animateShape(!0).when(1e3,{startAngle:NE*3/2}).delay(300).start("circularInOut"),t.add(a)),t.resize=function(){var l=i.getBoundingRect().width,o=e.showSpinner?e.spinnerRadius:0,h=(n.getWidth()-o*2-(e.showSpinner&&l?10:0)-l)/2-(e.showSpinner&&l?0:5+l/2)+(e.showSpinner?0:l/2)+(l?0:o),d=n.getHeight()/2;e.showSpinner&&a.setShape({cx:h,cy:d}),s.setShape({x:h-o,y:d-o,width:o*2,height:o*2}),r.setShape({x:0,y:0,width:n.getWidth(),height:n.getHeight()})},t.resize(),t}var yse=function(){function n(e,t,r,i){this._stageTaskMap=ri(),this.ecInstance=e,this.api=t,r=this._dataProcessorHandlers=r.slice(),i=this._visualHandlers=i.slice(),this._allHandlers=r.concat(i)}return n.prototype.restoreData=function(e,t){e.restoreData(t),this._stageTaskMap.each(function(r){var i=r.overallTask;i&&i.dirty()})},n.prototype.getPerformArgs=function(e,t){if(e.__pipeline){var r=this._pipelineMap.get(e.__pipeline.id),i=r.context,s=!t&&r.progressiveEnabled&&(!i||i.progressiveRender)&&e.__idxInPipeline>r.blockIndex,a=s?r.step:null,l=i&&i.modDataCount,o=l!=null?Math.ceil(l/a):null;return{step:a,modBy:o,modDataCount:l}}},n.prototype.getPipeline=function(e){return this._pipelineMap.get(e)},n.prototype.updateStreamModes=function(e,t){var r=this._pipelineMap.get(e.uid),i=e.getData(),s=i.count(),a=r.progressiveEnabled&&t.incrementalPrepareRender&&s>=r.threshold,l=e.get("large")&&s>=e.get("largeThreshold"),o=e.get("progressiveChunkMode")==="mod"?s:null;e.pipelineContext=r.context={progressiveRender:a,modDataCount:o,large:l}},n.prototype.restorePipelines=function(e){var t=this,r=t._pipelineMap=ri();e.eachSeries(function(i){var s=i.getProgressive(),a=i.uid;r.set(a,{id:a,head:null,tail:null,threshold:i.getProgressiveThreshold(),progressiveEnabled:s&&!(i.preventIncremental&&i.preventIncremental()),blockIndex:-1,step:Math.round(s||700),count:0}),t._pipe(i,i.dataTask)})},n.prototype.prepareStageTasks=function(){var e=this._stageTaskMap,t=this.api.getModel(),r=this.api;it(this._allHandlers,function(i){var s=e.get(i.uid)||e.set(i.uid,{}),a="";hp(!(i.reset&&i.overallReset),a),i.reset&&this._createSeriesStageTask(i,s,t,r),i.overallReset&&this._createOverallStageTask(i,s,t,r)},this)},n.prototype.prepareView=function(e,t,r,i){var s=e.renderTask,a=s.context;a.model=t,a.ecModel=r,a.api=i,s.__block=!e.incrementalPrepareRender,this._pipe(t,s)},n.prototype.performDataProcessorTasks=function(e,t){this._performStageTasks(this._dataProcessorHandlers,e,t,{block:!0})},n.prototype.performVisualTasks=function(e,t,r){this._performStageTasks(this._visualHandlers,e,t,r)},n.prototype._performStageTasks=function(e,t,r,i){i=i||{};var s=!1,a=this;it(e,function(o,h){if(!(i.visualType&&i.visualType!==o.visualType)){var d=a._stageTaskMap.get(o.uid),m=d.seriesTaskMap,_=d.overallTask;if(_){var y,T=_.agentStubMap;T.each(function(C){l(i,C)&&(C.dirty(),y=!0)}),y&&_.dirty(),a.updatePayload(_,r);var I=a.getPerformArgs(_,i.block);T.each(function(C){C.perform(I)}),_.perform(I)&&(s=!0)}else m&&m.each(function(C,M){l(i,C)&&C.dirty();var B=a.getPerformArgs(C,i.block);B.skip=!o.performRawSeries&&t.isSeriesFiltered(C.context.model),a.updatePayload(C,r),C.perform(B)&&(s=!0)})}});function l(o,h){return o.setDirty&&(!o.dirtyMap||o.dirtyMap.get(h.__pipeline.id))}this.unfinished=s||this.unfinished},n.prototype.performSeriesTasks=function(e){var t;e.eachSeries(function(r){t=r.dataTask.perform()||t}),this.unfinished=t||this.unfinished},n.prototype.plan=function(){this._pipelineMap.each(function(e){var t=e.tail;do{if(t.__block){e.blockIndex=t.__idxInPipeline;break}t=t.getUpstream()}while(t)})},n.prototype.updatePayload=function(e,t){t!=="remain"&&(e.context.payload=t)},n.prototype._createSeriesStageTask=function(e,t,r,i){var s=this,a=t.seriesTaskMap,l=t.seriesTaskMap=ri(),o=e.seriesType,h=e.getTargetSeries;e.createOnAllSeries?r.eachRawSeries(d):o?r.eachRawSeriesByType(o,d):h&&h(r,i).each(d);function d(m){var _=m.uid,y=l.set(_,a&&a.get(_)||nA({plan:lRe,reset:cRe,count:hRe}));y.context={model:m,ecModel:r,api:i,useClearVisual:e.isVisual&&!e.isLayout,plan:e.plan,reset:e.reset,scheduler:s},s._pipe(m,y)}},n.prototype._createOverallStageTask=function(e,t,r,i){var s=this,a=t.overallTask=t.overallTask||nA({reset:iRe});a.context={ecModel:r,api:i,overallReset:e.overallReset,scheduler:s};var l=a.agentStubMap,o=a.agentStubMap=ri(),h=e.seriesType,d=e.getTargetSeries,m=!0,_=!1,y="";hp(!e.createOnAllSeries,y),h?r.eachRawSeriesByType(h,T):d?d(r,i).each(T):(m=!1,it(r.getSeries(),T));function T(I){var C=I.uid,M=o.set(C,l&&l.get(C)||(_=!0,nA({reset:sRe,onDirty:aRe})));M.context={model:I,overallProgress:m},M.agent=a,M.__block=m,s._pipe(I,M)}_&&a.dirty()},n.prototype._pipe=function(e,t){var r=e.uid,i=this._pipelineMap.get(r);!i.head&&(i.head=t),i.tail&&i.tail.pipe(t),i.tail=t,t.__idxInPipeline=i.count++,t.__pipeline=i},n.wrapStageHandler=function(e,t){return li(e)&&(e={overallReset:e,seriesType:fRe(e)}),e.uid=tM("stageHandler"),t&&(e.visualType=t),e},n}();function iRe(n){n.overallReset(n.ecModel,n.api,n.payload)}function sRe(n){return n.overallProgress&&oRe}function oRe(){this.agent.dirty(),this.getDownstream().dirty()}function aRe(){this.agent&&this.agent.dirty()}function lRe(n){return n.plan?n.plan(n.model,n.ecModel,n.api,n.payload):null}function cRe(n){n.useClearVisual&&n.data.clearAllVisual();var e=n.resetDefines=da(n.reset(n.model,n.ecModel,n.api,n.payload));return e.length>1?xr(e,function(t,r){return xse(r)}):uRe}var uRe=xse(0);function xse(n){return function(e,t){var r=t.data,i=t.resetDefines[n];if(i&&i.dataEach)for(var s=e.start;s<e.end;s++)i.dataEach(r,s);else i&&i.progress&&i.progress(e,r)}}function hRe(n){return n.data.count()}function fRe(n){CP=null;try{n(iT,bse)}catch{}return CP}var iT={},bse={},CP;wse(iT,CU);wse(bse,Xie);iT.eachSeriesByType=iT.eachRawSeriesByType=function(n){CP=n};iT.eachComponent=function(n){n.mainType==="series"&&n.subType&&(CP=n.subType)};function wse(n,e){for(var t in e.prototype)n[t]=Cc}var oq=["#37A2DA","#32C5E9","#67E0E3","#9FE6B8","#FFDB5C","#ff9f7f","#fb7293","#E062AE","#E690D1","#e7bcf3","#9d96f5","#8378EA","#96BFFF"];const dRe={color:oq,colorLayer:[["#37A2DA","#ffd85c","#fd7b5f"],["#37A2DA","#67E0E3","#FFDB5C","#ff9f7f","#E062AE","#9d96f5"],["#37A2DA","#32C5E9","#9FE6B8","#FFDB5C","#ff9f7f","#fb7293","#e7bcf3","#8378EA","#96BFFF"],oq]};var gc="#B9B8CE",aq="#100C2A",zE=function(){return{axisLine:{lineStyle:{color:gc}},splitLine:{lineStyle:{color:"#484753"}},splitArea:{areaStyle:{color:["rgba(255,255,255,0.02)","rgba(255,255,255,0.05)"]}},minorSplitLine:{lineStyle:{color:"#20203B"}}}},lq=["#4992ff","#7cffb2","#fddd60","#ff6e76","#58d9f9","#05c091","#ff8a45","#8d48e3","#dd79ff"],Sse={darkMode:!0,color:lq,backgroundColor:aq,axisPointer:{lineStyle:{color:"#817f91"},crossStyle:{color:"#817f91"},label:{color:"#fff"}},legend:{textStyle:{color:gc}},textStyle:{color:gc},title:{textStyle:{color:"#EEF1FA"},subtextStyle:{color:"#B9B8CE"}},toolbox:{iconStyle:{borderColor:gc}},dataZoom:{borderColor:"#71708A",textStyle:{color:gc},brushStyle:{color:"rgba(135,163,206,0.3)"},handleStyle:{color:"#353450",borderColor:"#C5CBE3"},moveHandleStyle:{color:"#B0B6C3",opacity:.3},fillerColor:"rgba(135,163,206,0.2)",emphasis:{handleStyle:{borderColor:"#91B7F2",color:"#4D587D"},moveHandleStyle:{color:"#636D9A",opacity:.7}},dataBackground:{lineStyle:{color:"#71708A",width:1},areaStyle:{color:"#71708A"}},selectedDataBackground:{lineStyle:{color:"#87A3CE"},areaStyle:{color:"#87A3CE"}}},visualMap:{textStyle:{color:gc}},timeline:{lineStyle:{color:gc},label:{color:gc},controlStyle:{color:gc,borderColor:gc}},calendar:{itemStyle:{color:aq},dayLabel:{color:gc},monthLabel:{color:gc},yearLabel:{color:gc}},timeAxis:zE(),logAxis:zE(),valueAxis:zE(),categoryAxis:zE(),line:{symbol:"circle"},graph:{color:lq},gauge:{title:{color:gc},axisLine:{lineStyle:{color:[[1,"rgba(207,212,219,0.2)"]]}},axisLabel:{color:gc},detail:{color:"#EEF1FA"}},candlestick:{itemStyle:{color:"#f64e56",color0:"#54ea92",borderColor:"#f64e56",borderColor0:"#54ea92"}}};Sse.categoryAxis.splitLine.show=!1;var pRe=function(){function n(){}return n.prototype.normalizeQuery=function(e){var t={},r={},i={};if(Dr(e)){var s=Qd(e);t.mainType=s.main||null,t.subType=s.sub||null}else{var a=["Index","Name","Id"],l={name:1,dataIndex:1,dataType:1};it(e,function(o,h){for(var d=!1,m=0;m<a.length;m++){var _=a[m],y=h.lastIndexOf(_);if(y>0&&y===h.length-_.length){var T=h.slice(0,y);T!=="data"&&(t.mainType=T,t[_.toLowerCase()]=o,d=!0)}}l.hasOwnProperty(h)&&(r[h]=o,d=!0),d||(i[h]=o)})}return{cptQuery:t,dataQuery:r,otherQuery:i}},n.prototype.filter=function(e,t){var r=this.eventInfo;if(!r)return!0;var i=r.targetEl,s=r.packedEvent,a=r.model,l=r.view;if(!a||!l)return!0;var o=t.cptQuery,h=t.dataQuery;return d(o,a,"mainType")&&d(o,a,"subType")&&d(o,a,"index","componentIndex")&&d(o,a,"name")&&d(o,a,"id")&&d(h,s,"name")&&d(h,s,"dataIndex")&&d(h,s,"dataType")&&(!l.filterForExposedEvent||l.filterForExposedEvent(e,t.otherQuery,i,s));function d(m,_,y,T){return m[y]==null||_[T||y]===m[y]}},n.prototype.afterTrigger=function(){this.eventInfo=null},n}(),tN=["symbol","symbolSize","symbolRotate","symbolOffset"],cq=tN.concat(["symbolKeepAspect"]),mRe={createOnAllSeries:!0,performRawSeries:!0,reset:function(n,e){var t=n.getData();if(n.legendIcon&&t.setVisual("legendIcon",n.legendIcon),!n.hasSymbolVisual)return;for(var r={},i={},s=!1,a=0;a<tN.length;a++){var l=tN[a],o=n.get(l);li(o)?(s=!0,i[l]=o):r[l]=o}if(r.symbol=r.symbol||n.defaultSymbol,t.setVisual(Jn({legendIcon:n.legendIcon||r.symbol,symbolKeepAspect:n.get("symbolKeepAspect")},r)),e.isSeriesFiltered(n))return;var h=io(i);function d(m,_){for(var y=n.getRawValue(_),T=n.getDataParams(_),I=0;I<h.length;I++){var C=h[I];m.setItemVisual(_,C,i[C](y,T))}}return{dataEach:s?d:null}}},gRe={createOnAllSeries:!0,performRawSeries:!0,reset:function(n,e){if(!n.hasSymbolVisual||e.isSeriesFiltered(n))return;var t=n.getData();function r(i,s){for(var a=i.getItemModel(s),l=0;l<cq.length;l++){var o=cq[l],h=a.getShallow(o,!0);h!=null&&i.setItemVisual(s,o,h)}}return{dataEach:t.hasItemOption?r:null}}};function vRe(n,e,t){switch(t){case"color":var r=n.getItemVisual(e,"style");return r[n.getVisual("drawType")];case"opacity":return n.getItemVisual(e,"style").opacity;case"symbol":case"symbolSize":case"liftZ":return n.getItemVisual(e,t)}}function _Re(n,e){switch(e){case"color":var t=n.getVisual("style");return t[n.getVisual("drawType")];case"opacity":return n.getVisual("style").opacity;case"symbol":case"symbolSize":case"liftZ":return n.getVisual(e)}}function yRe(n,e){function t(r,i){var s=[];return r.eachComponent({mainType:"series",subType:n,query:i},function(a){s.push(a.seriesIndex)}),s}it([[n+"ToggleSelect","toggleSelect"],[n+"Select","select"],[n+"UnSelect","unselect"]],function(r){e(r[0],function(i,s,a){i=Jn({},i),a.dispatchAction(Jn(i,{type:r[1],seriesIndex:t(s,i)}))})})}function P1(n,e,t,r,i){var s=n+e;t.isSilent(s)||r.eachComponent({mainType:"series",subType:"pie"},function(a){for(var l=a.seriesIndex,o=a.option.selectedMap,h=i.selected,d=0;d<h.length;d++)if(h[d].seriesIndex===l){var m=a.getData(),_=Qy(m,i.fromActionPayload);t.trigger(s,{type:s,seriesId:a.id,name:fr(_)?m.getName(_[0]):m.getName(_),selected:Dr(o)?o:Jn({},o)})}})}function xRe(n,e,t){n.on("selectchanged",function(r){var i=t.getModel();r.isFromClick?(P1("map","selectchanged",e,i,r),P1("pie","selectchanged",e,i,r)):r.fromAction==="select"?(P1("map","selected",e,i,r),P1("pie","selected",e,i,r)):r.fromAction==="unselect"&&(P1("map","unselected",e,i,r),P1("pie","unselected",e,i,r))})}function bS(n,e,t){for(var r;n&&!(e(n)&&(r=n,t));)n=n.__hostTarget||n.parent;return r}var bRe=Math.round(Math.random()*9),wRe=typeof Object.defineProperty=="function",SRe=function(){function n(){this._id="__ec_inner_"+bRe++}return n.prototype.get=function(e){return this._guard(e)[this._id]},n.prototype.set=function(e,t){var r=this._guard(e);return wRe?Object.defineProperty(r,this._id,{value:t,enumerable:!1,configurable:!0}):r[this._id]=t,this},n.prototype.delete=function(e){return this.has(e)?(delete this._guard(e)[this._id],!0):!1},n.prototype.has=function(e){return!!this._guard(e)[this._id]},n.prototype._guard=function(e){if(e!==Object(e))throw TypeError("Value of WeakMap is not a non-null object.");return e},n}(),ARe=Xi.extend({type:"triangle",shape:{cx:0,cy:0,width:0,height:0},buildPath:function(n,e){var t=e.cx,r=e.cy,i=e.width/2,s=e.height/2;n.moveTo(t,r-s),n.lineTo(t+i,r+s),n.lineTo(t-i,r+s),n.closePath()}}),TRe=Xi.extend({type:"diamond",shape:{cx:0,cy:0,width:0,height:0},buildPath:function(n,e){var t=e.cx,r=e.cy,i=e.width/2,s=e.height/2;n.moveTo(t,r-s),n.lineTo(t+i,r),n.lineTo(t,r+s),n.lineTo(t-i,r),n.closePath()}}),MRe=Xi.extend({type:"pin",shape:{x:0,y:0,width:0,height:0},buildPath:function(n,e){var t=e.x,r=e.y,i=e.width/5*3,s=Math.max(i,e.height),a=i/2,l=a*a/(s-a),o=r-s+a+l,h=Math.asin(l/a),d=Math.cos(h)*a,m=Math.sin(h),_=Math.cos(h),y=a*.6,T=a*.7;n.moveTo(t-d,o+l),n.arc(t,o,a,Math.PI-h,Math.PI*2+h),n.bezierCurveTo(t+d-m*y,o+l+_*y,t,r-T,t,r),n.bezierCurveTo(t,r-T,t-d+m*y,o+l+_*y,t-d,o+l),n.closePath()}}),CRe=Xi.extend({type:"arrow",shape:{x:0,y:0,width:0,height:0},buildPath:function(n,e){var t=e.height,r=e.width,i=e.x,s=e.y,a=r/3*2;n.moveTo(i,s),n.lineTo(i+a,s+t),n.lineTo(i,s+t/4*3),n.lineTo(i-a,s+t),n.lineTo(i,s),n.closePath()}}),ERe={line:Nf,rect:Go,roundRect:Go,square:Go,circle:_D,diamond:TRe,pin:MRe,arrow:CRe,triangle:ARe},IRe={line:function(n,e,t,r,i){i.x1=n,i.y1=e+r/2,i.x2=n+t,i.y2=e+r/2},rect:function(n,e,t,r,i){i.x=n,i.y=e,i.width=t,i.height=r},roundRect:function(n,e,t,r,i){i.x=n,i.y=e,i.width=t,i.height=r,i.r=Math.min(t,r)/4},square:function(n,e,t,r,i){var s=Math.min(t,r);i.x=n,i.y=e,i.width=s,i.height=s},circle:function(n,e,t,r,i){i.cx=n+t/2,i.cy=e+r/2,i.r=Math.min(t,r)/2},diamond:function(n,e,t,r,i){i.cx=n+t/2,i.cy=e+r/2,i.width=t,i.height=r},pin:function(n,e,t,r,i){i.x=n+t/2,i.y=e+r/2,i.width=t,i.height=r},arrow:function(n,e,t,r,i){i.x=n+t/2,i.y=e+r/2,i.width=t,i.height=r},triangle:function(n,e,t,r,i){i.cx=n+t/2,i.cy=e+r/2,i.width=t,i.height=r}},nN={};it(ERe,function(n,e){nN[e]=new n});var RRe=Xi.extend({type:"symbol",shape:{symbolType:"",x:0,y:0,width:0,height:0},calculateTextPosition:function(n,e,t){var r=mP(n,e,t),i=this.shape;return i&&i.symbolType==="pin"&&e.position==="inside"&&(r.y=t.y+t.height*.4),r},buildPath:function(n,e,t){var r=e.symbolType;if(r!=="none"){var i=nN[r];i||(r="rect",i=nN[r]),IRe[r](e.x,e.y,e.width,e.height,i.shape),i.buildPath(n,i.shape,t)}}});function PRe(n,e){if(this.type!=="image"){var t=this.style;this.__isEmptyBrush?(t.stroke=n,t.fill=e||"#fff",t.lineWidth=2):this.shape.symbolType==="line"?t.stroke=n:t.fill=n,this.markRedraw()}}function tw(n,e,t,r,i,s,a){var l=n.indexOf("empty")===0;l&&(n=n.substr(5,1).toLowerCase()+n.substr(6));var o;return n.indexOf("image://")===0?o=gie(n.slice(8),new as(e,t,r,i),a?"center":"cover"):n.indexOf("path://")===0?o=mU(n.slice(7),{},new as(e,t,r,i),a?"center":"cover"):o=new RRe({shape:{symbolType:n,x:e,y:t,width:r,height:i}}),o.__isEmptyBrush=l,o.setColor=PRe,s&&o.setColor(s),o}function LRe(n){return fr(n)||(n=[+n,+n]),[n[0]||0,n[1]||0]}function Ase(n,e){if(n!=null)return fr(n)||(n=[n,n]),[os(n[0],e[0])||0,os(Ci(n[1],n[0]),e[1])||0]}function by(n){return isFinite(n)}function DRe(n,e,t){var r=e.x==null?0:e.x,i=e.x2==null?1:e.x2,s=e.y==null?0:e.y,a=e.y2==null?0:e.y2;e.global||(r=r*t.width+t.x,i=i*t.width+t.x,s=s*t.height+t.y,a=a*t.height+t.y),r=by(r)?r:0,i=by(i)?i:1,s=by(s)?s:0,a=by(a)?a:0;var l=n.createLinearGradient(r,s,i,a);return l}function BRe(n,e,t){var r=t.width,i=t.height,s=Math.min(r,i),a=e.x==null?.5:e.x,l=e.y==null?.5:e.y,o=e.r==null?.5:e.r;e.global||(a=a*r+t.x,l=l*i+t.y,o=o*s),a=by(a)?a:.5,l=by(l)?l:.5,o=o>=0&&by(o)?o:.5;var h=n.createRadialGradient(a,l,0,a,l,o);return h}function rN(n,e,t){for(var r=e.type==="radial"?BRe(n,e,t):DRe(n,e,t),i=e.colorStops,s=0;s<i.length;s++)r.addColorStop(i[s].offset,i[s].color);return r}function kRe(n,e){if(n===e||!n&&!e)return!1;if(!n||!e||n.length!==e.length)return!0;for(var t=0;t<n.length;t++)if(n[t]!==e[t])return!0;return!1}function UE(n){return parseInt(n,10)}function VE(n,e,t){var r=["width","height"][e],i=["clientWidth","clientHeight"][e],s=["paddingLeft","paddingTop"][e],a=["paddingRight","paddingBottom"][e];if(t[r]!=null&&t[r]!=="auto")return parseFloat(t[r]);var l=document.defaultView.getComputedStyle(n);return(n[i]||UE(l[r])||UE(n.style[r]))-(UE(l[s])||0)-(UE(l[a])||0)|0}function ORe(n,e){return!n||n==="solid"||!(e>0)?null:n==="dashed"?[4*e,2*e]:n==="dotted"?[e]:Is(n)?[n]:fr(n)?n:null}function Tse(n){var e=n.style,t=e.lineDash&&e.lineWidth>0&&ORe(e.lineDash,e.lineWidth),r=e.lineDashOffset;if(t){var i=e.strokeNoScale&&n.getLineScale?n.getLineScale():1;i&&i!==1&&(t=xr(t,function(s){return s/i}),r/=i)}return[t,r]}var FRe=new Zm(!0);function EP(n){var e=n.stroke;return!(e==null||e==="none"||!(n.lineWidth>0))}function uq(n){return typeof n=="string"&&n!=="none"}function IP(n){var e=n.fill;return e!=null&&e!=="none"}function hq(n,e){if(e.fillOpacity!=null&&e.fillOpacity!==1){var t=n.globalAlpha;n.globalAlpha=e.fillOpacity*e.opacity,n.fill(),n.globalAlpha=t}else n.fill()}function fq(n,e){if(e.strokeOpacity!=null&&e.strokeOpacity!==1){var t=n.globalAlpha;n.globalAlpha=e.strokeOpacity*e.opacity,n.stroke(),n.globalAlpha=t}else n.stroke()}function iN(n,e,t){var r=Dre(e.image,e.__image,t);if(dD(r)){var i=n.createPattern(r,e.repeat||"repeat");if(typeof DOMMatrix=="function"&&i&&i.setTransform){var s=new DOMMatrix;s.translateSelf(e.x||0,e.y||0),s.rotateSelf(0,0,(e.rotation||0)*gAe),s.scaleSelf(e.scaleX||1,e.scaleY||1),i.setTransform(s)}return i}}function NRe(n,e,t,r){var i,s=EP(t),a=IP(t),l=t.strokePercent,o=l<1,h=!e.path;(!e.silent||o)&&h&&e.createPathProxy();var d=e.path||FRe,m=e.__dirty;if(!r){var _=t.fill,y=t.stroke,T=a&&!!_.colorStops,I=s&&!!y.colorStops,C=a&&!!_.image,M=s&&!!y.image,B=void 0,k=void 0,j=void 0,q=void 0,Z=void 0;(T||I)&&(Z=e.getBoundingRect()),T&&(B=m?rN(n,_,Z):e.__canvasFillGradient,e.__canvasFillGradient=B),I&&(k=m?rN(n,y,Z):e.__canvasStrokeGradient,e.__canvasStrokeGradient=k),C&&(j=m||!e.__canvasFillPattern?iN(n,_,e):e.__canvasFillPattern,e.__canvasFillPattern=j),M&&(q=m||!e.__canvasStrokePattern?iN(n,y,e):e.__canvasStrokePattern,e.__canvasStrokePattern=j),T?n.fillStyle=B:C&&(j?n.fillStyle=j:a=!1),I?n.strokeStyle=k:M&&(q?n.strokeStyle=q:s=!1)}var te=e.getGlobalScale();d.setScale(te[0],te[1],e.segmentIgnoreThreshold);var ie,se;n.setLineDash&&t.lineDash&&(i=Tse(e),ie=i[0],se=i[1]);var ae=!0;(h||m&W1)&&(d.setDPR(n.dpr),o?d.setContext(null):(d.setContext(n),ae=!1),d.reset(),e.buildPath(d,e.shape,r),d.toStatic(),e.pathUpdated()),ae&&d.rebuildPath(n,o?l:1),ie&&(n.setLineDash(ie),n.lineDashOffset=se),r||(t.strokeFirst?(s&&fq(n,t),a&&hq(n,t)):(a&&hq(n,t),s&&fq(n,t))),ie&&n.setLineDash([])}function zRe(n,e,t){var r=e.__image=Dre(t.image,e.__image,e,e.onload);if(!(!r||!dD(r))){var i=t.x||0,s=t.y||0,a=e.getWidth(),l=e.getHeight(),o=r.width/r.height;if(a==null&&l!=null?a=l*o:l==null&&a!=null?l=a/o:a==null&&l==null&&(a=r.width,l=r.height),t.sWidth&&t.sHeight){var h=t.sx||0,d=t.sy||0;n.drawImage(r,h,d,t.sWidth,t.sHeight,i,s,a,l)}else if(t.sx&&t.sy){var h=t.sx,d=t.sy,m=a-h,_=l-d;n.drawImage(r,h,d,m,_,i,s,a,l)}else n.drawImage(r,i,s,a,l)}}function URe(n,e,t){var r,i=t.text;if(i!=null&&(i+=""),i){n.font=t.font||Jy,n.textAlign=t.textAlign,n.textBaseline=t.textBaseline;var s=void 0,a=void 0;n.setLineDash&&t.lineDash&&(r=Tse(e),s=r[0],a=r[1]),s&&(n.setLineDash(s),n.lineDashOffset=a),t.strokeFirst?(EP(t)&&n.strokeText(i,t.x,t.y),IP(t)&&n.fillText(i,t.x,t.y)):(IP(t)&&n.fillText(i,t.x,t.y),EP(t)&&n.strokeText(i,t.x,t.y)),s&&n.setLineDash([])}}var dq=["shadowBlur","shadowOffsetX","shadowOffsetY"],pq=[["lineCap","butt"],["lineJoin","miter"],["miterLimit",10]];function Mse(n,e,t,r,i){var s=!1;if(!r&&(t=t||{},e===t))return!1;if(r||e.opacity!==t.opacity){tu(n,i),s=!0;var a=Math.max(Math.min(e.opacity,1),0);n.globalAlpha=isNaN(a)?By.opacity:a}(r||e.blend!==t.blend)&&(s||(tu(n,i),s=!0),n.globalCompositeOperation=e.blend||By.blend);for(var l=0;l<dq.length;l++){var o=dq[l];(r||e[o]!==t[o])&&(s||(tu(n,i),s=!0),n[o]=n.dpr*(e[o]||0))}return(r||e.shadowColor!==t.shadowColor)&&(s||(tu(n,i),s=!0),n.shadowColor=e.shadowColor||By.shadowColor),s}function mq(n,e,t,r,i){var s=sT(e,i.inHover),a=r?null:t&&sT(t,i.inHover)||{};if(s===a)return!1;var l=Mse(n,s,a,r,i);if((r||s.fill!==a.fill)&&(l||(tu(n,i),l=!0),uq(s.fill)&&(n.fillStyle=s.fill)),(r||s.stroke!==a.stroke)&&(l||(tu(n,i),l=!0),uq(s.stroke)&&(n.strokeStyle=s.stroke)),(r||s.opacity!==a.opacity)&&(l||(tu(n,i),l=!0),n.globalAlpha=s.opacity==null?1:s.opacity),e.hasStroke()){var o=s.lineWidth,h=o/(s.strokeNoScale&&e.getLineScale?e.getLineScale():1);n.lineWidth!==h&&(l||(tu(n,i),l=!0),n.lineWidth=h)}for(var d=0;d<pq.length;d++){var m=pq[d],_=m[0];(r||s[_]!==a[_])&&(l||(tu(n,i),l=!0),n[_]=s[_]||m[1])}return l}function VRe(n,e,t,r,i){return Mse(n,sT(e,i.inHover),t&&sT(t,i.inHover),r,i)}function Cse(n,e){var t=e.transform,r=n.dpr||1;t?n.setTransform(r*t[0],r*t[1],r*t[2],r*t[3],r*t[4],r*t[5]):n.setTransform(r,0,0,r,0,0)}function GRe(n,e,t){for(var r=!1,i=0;i<n.length;i++){var s=n[i];r=r||s.isZeroArea(),Cse(e,s),e.beginPath(),s.buildPath(e,s.shape),e.clip()}t.allClipped=r}function HRe(n,e){return n&&e?n[0]!==e[0]||n[1]!==e[1]||n[2]!==e[2]||n[3]!==e[3]||n[4]!==e[4]||n[5]!==e[5]:!(!n&&!e)}var gq=1,vq=2,_q=3,yq=4;function jRe(n){var e=IP(n),t=EP(n);return!(n.lineDash||!(+e^+t)||e&&typeof n.fill!="string"||t&&typeof n.stroke!="string"||n.strokePercent<1||n.strokeOpacity<1||n.fillOpacity<1)}function tu(n,e){e.batchFill&&n.fill(),e.batchStroke&&n.stroke(),e.batchFill="",e.batchStroke=""}function sT(n,e){return e&&n.__hoverStyle||n.style}function Ese(n,e){wy(n,e,{inHover:!1,viewWidth:0,viewHeight:0},!0)}function wy(n,e,t,r){var i=e.transform;if(!e.shouldBePainted(t.viewWidth,t.viewHeight,!1,!1)){e.__dirty&=~Iu,e.__isRendered=!1;return}var s=e.__clipPaths,a=t.prevElClipPaths,l=!1,o=!1;if((!a||kRe(s,a))&&(a&&a.length&&(tu(n,t),n.restore(),o=l=!0,t.prevElClipPaths=null,t.allClipped=!1,t.prevEl=null),s&&s.length&&(tu(n,t),n.save(),GRe(s,n,t),l=!0),t.prevElClipPaths=s),t.allClipped){e.__isRendered=!1;return}e.beforeBrush&&e.beforeBrush(),e.innerBeforeBrush();var h=t.prevEl;h||(o=l=!0);var d=e instanceof Xi&&e.autoBatch&&jRe(e.style);l||HRe(i,h.transform)?(tu(n,t),Cse(n,e)):d||tu(n,t);var m=sT(e,t.inHover);e instanceof Xi?(t.lastDrawType!==gq&&(o=!0,t.lastDrawType=gq),mq(n,e,h,o,t),(!d||!t.batchFill&&!t.batchStroke)&&n.beginPath(),NRe(n,e,m,d),d&&(t.batchFill=m.fill||"",t.batchStroke=m.stroke||"")):e instanceof vP?(t.lastDrawType!==_q&&(o=!0,t.lastDrawType=_q),mq(n,e,h,o,t),URe(n,e,m)):e instanceof Lv?(t.lastDrawType!==vq&&(o=!0,t.lastDrawType=vq),VRe(n,e,h,o,t),zRe(n,e,m)):e.getTemporalDisplayables&&(t.lastDrawType!==yq&&(o=!0,t.lastDrawType=yq),WRe(n,e,t)),d&&r&&tu(n,t),e.innerAfterBrush(),e.afterBrush&&e.afterBrush(),t.prevEl=e,e.__dirty=0,e.__isRendered=!0}function WRe(n,e,t){var r=e.getDisplayables(),i=e.getTemporalDisplayables();n.save();var s={prevElClipPaths:null,prevEl:null,allClipped:!1,viewWidth:t.viewWidth,viewHeight:t.viewHeight,inHover:t.inHover},a,l;for(a=e.getCursor(),l=r.length;a<l;a++){var o=r[a];o.beforeBrush&&o.beforeBrush(),o.innerBeforeBrush(),wy(n,o,s,a===l-1),o.innerAfterBrush(),o.afterBrush&&o.afterBrush(),s.prevEl=o}for(var h=0,d=i.length;h<d;h++){var o=i[h];o.beforeBrush&&o.beforeBrush(),o.innerBeforeBrush(),wy(n,o,s,h===d-1),o.innerAfterBrush(),o.afterBrush&&o.afterBrush(),s.prevEl=o}e.clearTemporalDisplayables(),e.notClear=!0,n.restore()}var UB=new SRe,xq=new qT(100),bq=["symbol","symbolSize","symbolKeepAspect","color","backgroundColor","dashArrayX","dashArrayY","maxTileWidth","maxTileHeight"];function sN(n,e){if(n==="none")return null;var t=e.getDevicePixelRatio(),r=e.getZr(),i=r.painter.type==="svg";n.dirty&&UB.delete(n);var s=UB.get(n);if(s)return s;var a=ti(n,{symbol:"rect",symbolSize:1,symbolKeepAspect:!0,color:"rgba(0, 0, 0, 0.2)",backgroundColor:null,dashArrayX:5,dashArrayY:5,rotation:0,maxTileWidth:512,maxTileHeight:512});a.backgroundColor==="none"&&(a.backgroundColor=null);var l={repeat:"repeat"};return o(l),l.rotation=a.rotation,l.scaleX=l.scaleY=i?1:1/t,UB.set(n,l),n.dirty=!1,l;function o(h){for(var d=[t],m=!0,_=0;_<bq.length;++_){var y=a[bq[_]];if(y!=null&&!fr(y)&&!Dr(y)&&!Is(y)&&typeof y!="boolean"){m=!1;break}d.push(y)}var T;if(m){T=d.join(",")+(i?"-svg":"");var I=xq.get(T);I&&(i?h.svgElement=I:h.image=I)}var C=Rse(a.dashArrayX),M=XRe(a.dashArrayY),B=Ise(a.symbol),k=$Re(C),j=Pse(M),q=!i&&gw.createCanvas(),Z=i&&{tag:"g",attrs:{},key:"dcl",children:[]},te=se(),ie;q&&(q.width=te.width*t,q.height=te.height*t,ie=q.getContext("2d")),ae(),m&&xq.put(T,q||Z),h.image=q,h.svgElement=Z,h.svgWidth=te.width,h.svgHeight=te.height;function se(){for(var fe=1,Se=0,Ee=k.length;Se<Ee;++Se)fe=kX(fe,k[Se]);for(var Re=1,Se=0,Ee=B.length;Se<Ee;++Se)Re=kX(Re,B[Se].length);fe*=Re;var qe=j*k.length*B.length;return{width:Math.max(1,Math.min(fe,a.maxTileWidth)),height:Math.max(1,Math.min(qe,a.maxTileHeight))}}function ae(){ie&&(ie.clearRect(0,0,q.width,q.height),a.backgroundColor&&(ie.fillStyle=a.backgroundColor,ie.fillRect(0,0,q.width,q.height)));for(var fe=0,Se=0;Se<M.length;++Se)fe+=M[Se];if(fe<=0)return;for(var Ee=-j,Re=0,qe=0,Le=0;Ee<te.height;){if(Re%2===0){for(var dt=qe/2%B.length,ye=0,Xe=0,He=0;ye<te.width*2;){for(var _t=0,Se=0;Se<C[Le].length;++Se)_t+=C[Le][Se];if(_t<=0)break;if(Xe%2===0){var wt=(1-a.symbolSize)*.5,Gt=ye+C[Le][Xe]*wt,at=Ee+M[Re]*wt,Ht=C[Le][Xe]*a.symbolSize,Qt=M[Re]*a.symbolSize,rn=He/2%B[dt].length;jn(Gt,at,Ht,Qt,B[dt][rn])}ye+=C[Le][Xe],++He,++Xe,Xe===C[Le].length&&(Xe=0)}++Le,Le===C.length&&(Le=0)}Ee+=M[Re],++qe,++Re,Re===M.length&&(Re=0)}function jn(Bn,Tn,Pe,$e,mn){var cn=i?1:t,St=tw(mn,Bn*cn,Tn*cn,Pe*cn,$e*cn,a.color,a.symbolKeepAspect);if(i){var Jt=r.painter.renderOneToVNode(St);Jt&&Z.children.push(Jt)}else Ese(ie,St)}}}}function Ise(n){if(!n||n.length===0)return[["rect"]];if(Dr(n))return[[n]];for(var e=!0,t=0;t<n.length;++t)if(!Dr(n[t])){e=!1;break}if(e)return Ise([n]);for(var r=[],t=0;t<n.length;++t)Dr(n[t])?r.push([n[t]]):r.push(n[t]);return r}function Rse(n){if(!n||n.length===0)return[[0,0]];if(Is(n)){var e=Math.ceil(n);return[[e,e]]}for(var t=!0,r=0;r<n.length;++r)if(!Is(n[r])){t=!1;break}if(t)return Rse([n]);for(var i=[],r=0;r<n.length;++r)if(Is(n[r])){var e=Math.ceil(n[r]);i.push([e,e])}else{var e=xr(n[r],function(l){return Math.ceil(l)});e.length%2===1?i.push(e.concat(e)):i.push(e)}return i}function XRe(n){if(!n||typeof n=="object"&&n.length===0)return[0,0];if(Is(n)){var e=Math.ceil(n);return[e,e]}var t=xr(n,function(r){return Math.ceil(r)});return n.length%2?t.concat(t):t}function $Re(n){return xr(n,function(e){return Pse(e)})}function Pse(n){for(var e=0,t=0;t<n.length;++t)e+=n[t];return n.length%2===1?e*2:e}function qRe(n,e){n.eachRawSeries(function(t){if(!n.isSeriesFiltered(t)){var r=t.getData();r.hasItemVisual()&&r.each(function(a){var l=r.getItemVisual(a,"decal");if(l){var o=r.ensureUniqueItemVisual(a,"style");o.decal=sN(l,e)}});var i=r.getVisual("decal");if(i){var s=r.getVisual("style");s.decal=sN(i,e)}}})}var If=new rd,Lse={};function ZRe(n,e){Lse[n]=e}function YRe(n){return Lse[n]}var KRe=1,JRe=800,QRe=900,ePe=1e3,tPe=2e3,nPe=5e3,Dse=1e3,rPe=1100,BU=2e3,Bse=3e3,iPe=4e3,OD=4500,sPe=4600,oPe=5e3,aPe=6e3,kse=7e3,lPe={PROCESSOR:{FILTER:ePe,SERIES_FILTER:JRe,STATISTIC:nPe},VISUAL:{LAYOUT:Dse,PROGRESSIVE_LAYOUT:rPe,GLOBAL:BU,CHART:Bse,POST_CHART_LAYOUT:sPe,COMPONENT:iPe,BRUSH:oPe,CHART_ITEM:OD,ARIA:aPe,DECAL:kse}},Fl="__flagInMainProcess",Yc="__pendingUpdate",VB="__needsUpdateStatus",wq=/^[a-zA-Z0-9_]+$/,GB="__connectUpdateStatus",Sq=0,cPe=1,uPe=2;function Ose(n){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(this.isDisposed()){this.id;return}return Nse(this,n,e)}}function Fse(n){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Nse(this,n,e)}}function Nse(n,e,t){return t[0]=t[0]&&t[0].toLowerCase(),rd.prototype[e].apply(n,t)}var zse=function(n){Hn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e}(rd),Use=zse.prototype;Use.on=Fse("on");Use.off=Fse("off");var L1,HB,GE,v0,jB,WB,XB,X2,$2,Aq,Tq,$B,Mq,HE,Cq,Vse,oh,Eq,Gse=function(n){Hn(e,n);function e(t,r,i){var s=n.call(this,new pRe)||this;s._chartsViews=[],s._chartsMap={},s._componentsViews=[],s._componentsMap={},s._pendingActions=[],i=i||{},Dr(r)&&(r=Hse[r]),s._dom=t;var a="canvas",l="auto",o=!1;i.ssr;var h=s._zr=DX(t,{renderer:i.renderer||a,devicePixelRatio:i.devicePixelRatio,width:i.width,height:i.height,ssr:i.ssr,useDirtyRect:Ci(i.useDirtyRect,o),useCoarsePointer:Ci(i.useCoarsePointer,l),pointerSize:i.pointerSize});s._ssr=i.ssr,s._throttledZrFlush=DU(Ns(h.flush,h),17),r=vi(r),r&&qie(r,!0),s._theme=r,s._locale=xEe(i.locale||Cie),s._coordSysMgr=new EU;var d=s._api=Cq(s);function m(_,y){return _.__prio-y.__prio}return BI(PP,m),BI(oN,m),s._scheduler=new yse(s,d,oN,PP),s._messageCenter=new zse,s._initEvents(),s.resize=Ns(s.resize,s),h.animation.on("frame",s._onframe,s),Aq(h,s),Tq(h,s),aP(s),s}return e.prototype._onframe=function(){if(!this._disposed){Eq(this);var t=this._scheduler;if(this[Yc]){var r=this[Yc].silent;this[Fl]=!0;try{L1(this),v0.update.call(this,null,this[Yc].updateParams)}catch(o){throw this[Fl]=!1,this[Yc]=null,o}this._zr.flush(),this[Fl]=!1,this[Yc]=null,X2.call(this,r),$2.call(this,r)}else if(t.unfinished){var i=KRe,s=this._model,a=this._api;t.unfinished=!1;do{var l=+new Date;t.performSeriesTasks(s),t.performDataProcessorTasks(s),WB(this,s),t.performVisualTasks(s),HE(this,this._model,a,"remain",{}),i-=+new Date-l}while(i>0&&t.unfinished);t.unfinished||this._zr.flush()}}},e.prototype.getDom=function(){return this._dom},e.prototype.getId=function(){return this.id},e.prototype.getZr=function(){return this._zr},e.prototype.isSSR=function(){return this._ssr},e.prototype.setOption=function(t,r,i){if(!this[Fl]){if(this._disposed){this.id;return}var s,a,l;if(Xr(r)&&(i=r.lazyUpdate,s=r.silent,a=r.replaceMerge,l=r.transition,r=r.notMerge),this[Fl]=!0,!this._model||r){var o=new qEe(this._api),h=this._theme,d=this._model=new CU;d.scheduler=this._scheduler,d.ssr=this._ssr,d.init(null,null,null,h,this._locale,o)}this._model.setOption(t,{replaceMerge:a},aN);var m={seriesTransition:l,optionChanged:!0};if(i)this[Yc]={silent:s,updateParams:m},this[Fl]=!1,this.getZr().wakeUp();else{try{L1(this),v0.update.call(this,null,m)}catch(_){throw this[Yc]=null,this[Fl]=!1,_}this._ssr||this._zr.flush(),this[Yc]=null,this[Fl]=!1,X2.call(this,s),$2.call(this,s)}}},e.prototype.setTheme=function(){},e.prototype.getModel=function(){return this._model},e.prototype.getOption=function(){return this._model&&this._model.getOption()},e.prototype.getWidth=function(){return this._zr.getWidth()},e.prototype.getHeight=function(){return this._zr.getHeight()},e.prototype.getDevicePixelRatio=function(){return this._zr.painter.dpr||pi.hasGlobalWindow&&window.devicePixelRatio||1},e.prototype.getRenderedCanvas=function(t){return this.renderToCanvas(t)},e.prototype.renderToCanvas=function(t){t=t||{};var r=this._zr.painter;return r.getRenderedCanvas({backgroundColor:t.backgroundColor||this._model.get("backgroundColor"),pixelRatio:t.pixelRatio||this.getDevicePixelRatio()})},e.prototype.renderToSVGString=function(t){t=t||{};var r=this._zr.painter;return r.renderToString({useViewBox:t.useViewBox})},e.prototype.getSvgDataURL=function(){if(pi.svgSupported){var t=this._zr,r=t.storage.getDisplayList();return it(r,function(i){i.stopAnimation(null,!0)}),t.painter.toDataURL()}},e.prototype.getDataURL=function(t){if(this._disposed){this.id;return}t=t||{};var r=t.excludeComponents,i=this._model,s=[],a=this;it(r,function(o){i.eachComponent({mainType:o},function(h){var d=a._componentsMap[h.__viewId];d.group.ignore||(s.push(d),d.group.ignore=!0)})});var l=this._zr.painter.getType()==="svg"?this.getSvgDataURL():this.renderToCanvas(t).toDataURL("image/"+(t&&t.type||"png"));return it(s,function(o){o.group.ignore=!1}),l},e.prototype.getConnectedDataURL=function(t){if(this._disposed){this.id;return}var r=t.type==="svg",i=this.group,s=Math.min,a=Math.max,l=1/0;if(Iq[i]){var o=l,h=l,d=-l,m=-l,_=[],y=t&&t.pixelRatio||this.getDevicePixelRatio();it(iA,function(k,j){if(k.group===i){var q=r?k.getZr().painter.getSvgDom().innerHTML:k.renderToCanvas(vi(t)),Z=k.getDom().getBoundingClientRect();o=s(Z.left,o),h=s(Z.top,h),d=a(Z.right,d),m=a(Z.bottom,m),_.push({dom:q,left:Z.left,top:Z.top})}}),o*=y,h*=y,d*=y,m*=y;var T=d-o,I=m-h,C=gw.createCanvas(),M=DX(C,{renderer:r?"svg":"canvas"});if(M.resize({width:T,height:I}),r){var B="";return it(_,function(k){var j=k.left-o,q=k.top-h;B+='<g transform="translate('+j+","+q+')">'+k.dom+"</g>"}),M.painter.getSvgRoot().innerHTML=B,t.connectedBackgroundColor&&M.painter.setBackgroundColor(t.connectedBackgroundColor),M.refreshImmediately(),M.painter.toDataURL()}else return t.connectedBackgroundColor&&M.add(new Go({shape:{x:0,y:0,width:T,height:I},style:{fill:t.connectedBackgroundColor}})),it(_,function(k){var j=new Lv({style:{x:k.left*y-o,y:k.top*y-h,image:k.dom}});M.add(j)}),M.refreshImmediately(),C.toDataURL("image/"+(t&&t.type||"png"))}else return this.getDataURL(t)},e.prototype.convertToPixel=function(t,r){return jB(this,"convertToPixel",t,r)},e.prototype.convertFromPixel=function(t,r){return jB(this,"convertFromPixel",t,r)},e.prototype.containPixel=function(t,r){if(this._disposed){this.id;return}var i=this._model,s,a=KS(i,t);return it(a,function(l,o){o.indexOf("Models")>=0&&it(l,function(h){var d=h.coordinateSystem;if(d&&d.containPoint)s=s||!!d.containPoint(r);else if(o==="seriesModels"){var m=this._chartsMap[h.__viewId];m&&m.containPoint&&(s=s||m.containPoint(r,h))}},this)},this),!!s},e.prototype.getVisual=function(t,r){var i=this._model,s=KS(i,t,{defaultMainType:"series"}),a=s.seriesModel,l=a.getData(),o=s.hasOwnProperty("dataIndexInside")?s.dataIndexInside:s.hasOwnProperty("dataIndex")?l.indexOfRawIndex(s.dataIndex):null;return o!=null?vRe(l,o,r):_Re(l,r)},e.prototype.getViewOfComponentModel=function(t){return this._componentsMap[t.__viewId]},e.prototype.getViewOfSeriesModel=function(t){return this._chartsMap[t.__viewId]},e.prototype._initEvents=function(){var t=this;it(hPe,function(r){var i=function(s){var a=t.getModel(),l=s.target,o,h=r==="globalout";if(h?o={}:l&&bS(l,function(T){var I=ji(T);if(I&&I.dataIndex!=null){var C=I.dataModel||a.getSeriesByIndex(I.seriesIndex);return o=C&&C.getDataParams(I.dataIndex,I.dataType,l)||{},!0}else if(I.eventData)return o=Jn({},I.eventData),!0},!0),o){var d=o.componentType,m=o.componentIndex;(d==="markLine"||d==="markPoint"||d==="markArea")&&(d="series",m=o.seriesIndex);var _=d&&m!=null&&a.getComponent(d,m),y=_&&t[_.mainType==="series"?"_chartsMap":"_componentsMap"][_.__viewId];o.event=s,o.type=r,t._$eventProcessor.eventInfo={targetEl:l,packedEvent:o,model:_,view:y},t.trigger(r,o)}};i.zrEventfulCallAtLast=!0,t._zr.on(r,i,t)}),it(rA,function(r,i){t._messageCenter.on(i,function(s){this.trigger(i,s)},t)}),it(["selectchanged"],function(r){t._messageCenter.on(r,function(i){this.trigger(r,i)},t)}),xRe(this._messageCenter,this,this._api)},e.prototype.isDisposed=function(){return this._disposed},e.prototype.clear=function(){if(this._disposed){this.id;return}this.setOption({series:[]},!0)},e.prototype.dispose=function(){if(this._disposed){this.id;return}this._disposed=!0;var t=this.getDom();t&&Ire(this.getDom(),OU,"");var r=this,i=r._api,s=r._model;it(r._componentsViews,function(a){a.dispose(s,i)}),it(r._chartsViews,function(a){a.dispose(s,i)}),r._zr.dispose(),r._dom=r._model=r._chartsMap=r._componentsMap=r._chartsViews=r._componentsViews=r._scheduler=r._api=r._zr=r._throttledZrFlush=r._theme=r._coordSysMgr=r._messageCenter=null,delete iA[r.id]},e.prototype.resize=function(t){if(!this[Fl]){if(this._disposed){this.id;return}this._zr.resize(t);var r=this._model;if(this._loadingFX&&this._loadingFX.resize(),!!r){var i=r.resetOption("media"),s=t&&t.silent;this[Yc]&&(s==null&&(s=this[Yc].silent),i=!0,this[Yc]=null),this[Fl]=!0;try{i&&L1(this),v0.update.call(this,{type:"resize",animation:Jn({duration:0},t&&t.animation)})}catch(a){throw this[Fl]=!1,a}this[Fl]=!1,X2.call(this,s),$2.call(this,s)}}},e.prototype.showLoading=function(t,r){if(this._disposed){this.id;return}if(Xr(t)&&(r=t,t=""),t=t||"default",this.hideLoading(),!!lN[t]){var i=lN[t](this._api,r),s=this._zr;this._loadingFX=i,s.add(i)}},e.prototype.hideLoading=function(){if(this._disposed){this.id;return}this._loadingFX&&this._zr.remove(this._loadingFX),this._loadingFX=null},e.prototype.makeActionFromEvent=function(t){var r=Jn({},t);return r.type=rA[t.type],r},e.prototype.dispatchAction=function(t,r){if(this._disposed){this.id;return}if(Xr(r)||(r={silent:!!r}),!!RP[t.type]&&this._model){if(this[Fl]){this._pendingActions.push(t);return}var i=r.silent;XB.call(this,t,i);var s=r.flush;s?this._zr.flush():s!==!1&&pi.browser.weChat&&this._throttledZrFlush(),X2.call(this,i),$2.call(this,i)}},e.prototype.updateLabelLayout=function(){If.trigger("series:layoutlabels",this._model,this._api,{updatedSeries:[]})},e.prototype.appendData=function(t){if(this._disposed){this.id;return}var r=t.seriesIndex,i=this.getModel(),s=i.getSeriesByIndex(r);s.appendData(t),this._scheduler.unfinished=!0,this.getZr().wakeUp()},e.internalField=function(){L1=function(m){var _=m._scheduler;_.restorePipelines(m._model),_.prepareStageTasks(),HB(m,!0),HB(m,!1),_.plan()},HB=function(m,_){for(var y=m._model,T=m._scheduler,I=_?m._componentsViews:m._chartsViews,C=_?m._componentsMap:m._chartsMap,M=m._zr,B=m._api,k=0;k<I.length;k++)I[k].__alive=!1;_?y.eachComponent(function(Z,te){Z!=="series"&&j(te)}):y.eachSeries(j);function j(Z){var te=Z.__requireNewView;Z.__requireNewView=!1;var ie="_ec_"+Z.id+"_"+Z.type,se=!te&&C[ie];if(!se){var ae=Qd(Z.type),fe=_?Rc.getClass(ae.main,ae.sub):Mh.getClass(ae.sub);se=new fe,se.init(y,B),C[ie]=se,I.push(se),M.add(se.group)}Z.__viewId=se.__id=ie,se.__alive=!0,se.__model=Z,se.group.__ecComponentInfo={mainType:Z.mainType,index:Z.componentIndex},!_&&T.prepareView(se,Z,y,B)}for(var k=0;k<I.length;){var q=I[k];q.__alive?k++:(!_&&q.renderTask.dispose(),M.remove(q.group),q.dispose(y,B),I.splice(k,1),C[q.__id]===q&&delete C[q.__id],q.__id=q.group.__ecComponentInfo=null)}},GE=function(m,_,y,T,I){var C=m._model;if(C.setUpdatePayload(y),!T){it([].concat(m._componentsViews).concat(m._chartsViews),q);return}var M={};M[T+"Id"]=y[T+"Id"],M[T+"Index"]=y[T+"Index"],M[T+"Name"]=y[T+"Name"];var B={mainType:T,query:M};I&&(B.subType=I);var k=y.excludeSeriesId,j;k!=null&&(j=ri(),it(da(k),function(Z){var te=op(Z,null);te!=null&&j.set(te,!0)})),C&&C.eachComponent(B,function(Z){var te=j&&j.get(Z.id)!=null;if(!te)if(l$(y))if(Z instanceof Zf)y.type===ky&&!y.notBlur&&!Z.get(["emphasis","disabled"])&&oCe(Z,y,m._api);else{var ie=uU(Z.mainType,Z.componentIndex,y.name,m._api),se=ie.focusSelf,ae=ie.dispatchers;y.type===ky&&se&&!y.notBlur&&UF(Z.mainType,Z.componentIndex,m._api),ae&&it(ae,function(fe){y.type===ky?Kb(fe):Jb(fe)})}else HF(y)&&Z instanceof Zf&&(cCe(Z,y,m._api),o$(Z),oh(m))},m),C&&C.eachComponent(B,function(Z){var te=j&&j.get(Z.id)!=null;te||q(m[T==="series"?"_chartsMap":"_componentsMap"][Z.__viewId])},m);function q(Z){Z&&Z.__alive&&Z[_]&&Z[_](Z.__model,C,m._api,y)}},v0={prepareAndUpdate:function(m){L1(this),v0.update.call(this,m,{optionChanged:m.newOption!=null})},update:function(m,_){var y=this._model,T=this._api,I=this._zr,C=this._coordSysMgr,M=this._scheduler;if(y){y.setUpdatePayload(m),M.restoreData(y,m),M.performSeriesTasks(y),C.create(y,T),M.performDataProcessorTasks(y,m),WB(this,y),C.update(y,T),t(y),M.performVisualTasks(y,m),$B(this,y,T,m,_);var B=y.get("backgroundColor")||"transparent",k=y.get("darkMode");I.setBackgroundColor(B),k!=null&&k!=="auto"&&I.setDarkMode(k),If.trigger("afterupdate",y,T)}},updateTransform:function(m){var _=this,y=this._model,T=this._api;if(y){y.setUpdatePayload(m);var I=[];y.eachComponent(function(M,B){if(M!=="series"){var k=_.getViewOfComponentModel(B);if(k&&k.__alive)if(k.updateTransform){var j=k.updateTransform(B,y,T,m);j&&j.update&&I.push(k)}else I.push(k)}});var C=ri();y.eachSeries(function(M){var B=_._chartsMap[M.__viewId];if(B.updateTransform){var k=B.updateTransform(M,y,T,m);k&&k.update&&C.set(M.uid,1)}else C.set(M.uid,1)}),t(y),this._scheduler.performVisualTasks(y,m,{setDirty:!0,dirtyMap:C}),HE(this,y,T,m,{},C),If.trigger("afterupdate",y,T)}},updateView:function(m){var _=this._model;_&&(_.setUpdatePayload(m),Mh.markUpdateMethod(m,"updateView"),t(_),this._scheduler.performVisualTasks(_,m,{setDirty:!0}),$B(this,_,this._api,m,{}),If.trigger("afterupdate",_,this._api))},updateVisual:function(m){var _=this,y=this._model;y&&(y.setUpdatePayload(m),y.eachSeries(function(T){T.getData().clearAllVisual()}),Mh.markUpdateMethod(m,"updateVisual"),t(y),this._scheduler.performVisualTasks(y,m,{visualType:"visual",setDirty:!0}),y.eachComponent(function(T,I){if(T!=="series"){var C=_.getViewOfComponentModel(I);C&&C.__alive&&C.updateVisual(I,y,_._api,m)}}),y.eachSeries(function(T){var I=_._chartsMap[T.__viewId];I.updateVisual(T,y,_._api,m)}),If.trigger("afterupdate",y,this._api))},updateLayout:function(m){v0.update.call(this,m)}},jB=function(m,_,y,T){if(m._disposed){m.id;return}for(var I=m._model,C=m._coordSysMgr.getCoordinateSystems(),M,B=KS(I,y),k=0;k<C.length;k++){var j=C[k];if(j[_]&&(M=j[_](I,B,T))!=null)return M}},WB=function(m,_){var y=m._chartsMap,T=m._scheduler;_.eachSeries(function(I){T.updateStreamModes(I,y[I.__viewId])})},XB=function(m,_){var y=this,T=this.getModel(),I=m.type,C=m.escapeConnect,M=RP[I],B=M.actionInfo,k=(B.update||"update").split(":"),j=k.pop(),q=k[0]!=null&&Qd(k[0]);this[Fl]=!0;var Z=[m],te=!1;m.batch&&(te=!0,Z=xr(m.batch,function(Re){return Re=ti(Jn({},Re),m),Re.batch=null,Re}));var ie=[],se,ae=HF(m),fe=l$(m);if(fe&&Kre(this._api),it(Z,function(Re){if(se=M.action(Re,y._model,y._api),se=se||Jn({},Re),se.type=B.event||se.type,ie.push(se),fe){var qe=sU(m),Le=qe.queryOptionMap,dt=qe.mainTypeSpecified,ye=dt?Le.keys()[0]:"series";GE(y,j,Re,ye),oh(y)}else ae?(GE(y,j,Re,"series"),oh(y)):q&&GE(y,j,Re,q.main,q.sub)}),j!=="none"&&!fe&&!ae&&!q)try{this[Yc]?(L1(this),v0.update.call(this,m),this[Yc]=null):v0[j].call(this,m)}catch(Re){throw this[Fl]=!1,Re}if(te?se={type:B.event||I,escapeConnect:C,batch:ie}:se=ie[0],this[Fl]=!1,!_){var Se=this._messageCenter;if(Se.trigger(se.type,se),ae){var Ee={type:"selectchanged",escapeConnect:C,selected:uCe(T),isFromClick:m.isFromClick||!1,fromAction:m.type,fromActionPayload:m};Se.trigger(Ee.type,Ee)}}},X2=function(m){for(var _=this._pendingActions;_.length;){var y=_.shift();XB.call(this,y,m)}},$2=function(m){!m&&this.trigger("updated")},Aq=function(m,_){m.on("rendered",function(y){_.trigger("rendered",y),m.animation.isFinished()&&!_[Yc]&&!_._scheduler.unfinished&&!_._pendingActions.length&&_.trigger("finished")})},Tq=function(m,_){m.on("mouseover",function(y){var T=y.target,I=bS(T,GF);I&&(aCe(I,y,_._api),oh(_))}).on("mouseout",function(y){var T=y.target,I=bS(T,GF);I&&(lCe(I,y,_._api),oh(_))}).on("click",function(y){var T=y.target,I=bS(T,function(B){return ji(B).dataIndex!=null},!0);if(I){var C=I.selected?"unselect":"select",M=ji(I);_._api.dispatchAction({type:C,dataType:M.dataType,dataIndexInside:M.dataIndex,seriesIndex:M.seriesIndex,isFromClick:!0})}})};function t(m){m.clearColorPalette(),m.eachSeries(function(_){_.clearColorPalette()})}function r(m){var _=[],y=[],T=!1;if(m.eachComponent(function(B,k){var j=k.get("zlevel")||0,q=k.get("z")||0,Z=k.getZLevelKey();T=T||!!Z,(B==="series"?y:_).push({zlevel:j,z:q,idx:k.componentIndex,type:B,key:Z})}),T){var I=_.concat(y),C,M;BI(I,function(B,k){return B.zlevel===k.zlevel?B.z-k.z:B.zlevel-k.zlevel}),it(I,function(B){var k=m.getComponent(B.type,B.idx),j=B.zlevel,q=B.key;C!=null&&(j=Math.max(C,j)),q?(j===C&&q!==M&&j++,M=q):M&&(j===C&&j++,M=""),C=j,k.setZLevel(j)})}}$B=function(m,_,y,T,I){r(_),Mq(m,_,y,T,I),it(m._chartsViews,function(C){C.__alive=!1}),HE(m,_,y,T,I),it(m._chartsViews,function(C){C.__alive||C.remove(_,y)})},Mq=function(m,_,y,T,I,C){it(C||m._componentsViews,function(M){var B=M.__model;h(B,M),M.render(B,_,y,T),l(B,M),d(B,M)})},HE=function(m,_,y,T,I,C){var M=m._scheduler;I=Jn(I||{},{updatedSeries:_.getSeries()}),If.trigger("series:beforeupdate",_,y,I);var B=!1;_.eachSeries(function(k){var j=m._chartsMap[k.__viewId];j.__alive=!0;var q=j.renderTask;M.updatePayload(q,T),h(k,j),C&&C.get(k.uid)&&q.dirty(),q.perform(M.getPerformArgs(q))&&(B=!0),j.group.silent=!!k.get("silent"),a(k,j),o$(k)}),M.unfinished=B||M.unfinished,If.trigger("series:layoutlabels",_,y,I),If.trigger("series:transition",_,y,I),_.eachSeries(function(k){var j=m._chartsMap[k.__viewId];l(k,j),d(k,j)}),s(m,_),If.trigger("series:afterupdate",_,y,I)},oh=function(m){m[VB]=!0,m.getZr().wakeUp()},Eq=function(m){m[VB]&&(m.getZr().storage.traverse(function(_){Rb(_)||i(_)}),m[VB]=!1)};function i(m){for(var _=[],y=m.currentStates,T=0;T<y.length;T++){var I=y[T];I==="emphasis"||I==="blur"||I==="select"||_.push(I)}m.selected&&m.states.select&&_.push("select"),m.hoverState===gD&&m.states.emphasis?_.push("emphasis"):m.hoverState===mD&&m.states.blur&&_.push("blur"),m.useStates(_)}function s(m,_){var y=m._zr,T=y.storage,I=0;T.traverse(function(C){C.isGroup||I++}),I>_.get("hoverLayerThreshold")&&!pi.node&&!pi.worker&&_.eachSeries(function(C){if(!C.preventUsingHoverLayer){var M=m._chartsMap[C.__viewId];M.__alive&&M.eachRendered(function(B){B.states.emphasis&&(B.states.emphasis.hoverLayer=!0)})}})}function a(m,_){var y=m.get("blendMode")||null;_.eachRendered(function(T){T.isGroup||(T.style.blend=y)})}function l(m,_){if(!m.preventAutoZ){var y=m.get("z")||0,T=m.get("zlevel")||0;_.eachRendered(function(I){return o(I,y,T,-1/0),!0})}}function o(m,_,y,T){var I=m.getTextContent(),C=m.getTextGuideLine(),M=m.isGroup;if(M)for(var B=m.childrenRef(),k=0;k<B.length;k++)T=Math.max(o(B[k],_,y,T),T);else m.z=_,m.zlevel=y,T=Math.max(m.z2,T);if(I&&(I.z=_,I.zlevel=y,isFinite(T)&&(I.z2=T+2)),C){var j=m.textGuideLineConfig;C.z=_,C.zlevel=y,isFinite(T)&&(C.z2=T+(j&&j.showAbove?1:-1))}return T}function h(m,_){_.eachRendered(function(y){if(!Rb(y)){var T=y.getTextContent(),I=y.getTextGuideLine();y.stateTransition&&(y.stateTransition=null),T&&T.stateTransition&&(T.stateTransition=null),I&&I.stateTransition&&(I.stateTransition=null),y.hasState()?(y.prevStates=y.currentStates,y.clearStates()):y.prevStates&&(y.prevStates=null)}})}function d(m,_){var y=m.getModel("stateAnimation"),T=m.isAnimationEnabled(),I=y.get("duration"),C=I>0?{duration:I,delay:y.get("delay"),easing:y.get("easing")}:null;_.eachRendered(function(M){if(M.states&&M.states.emphasis){if(Rb(M))return;if(M instanceof Xi&&mCe(M),M.__dirty){var B=M.prevStates;B&&M.useStates(B)}if(T){M.stateTransition=C;var k=M.getTextContent(),j=M.getTextGuideLine();k&&(k.stateTransition=C),j&&(j.stateTransition=C)}M.__dirty&&i(M)}})}Cq=function(m){return new(function(_){Hn(y,_);function y(){return _!==null&&_.apply(this,arguments)||this}return y.prototype.getCoordinateSystems=function(){return m._coordSysMgr.getCoordinateSystems()},y.prototype.getComponentByElement=function(T){for(;T;){var I=T.__ecComponentInfo;if(I!=null)return m._model.getComponent(I.mainType,I.index);T=T.parent}},y.prototype.enterEmphasis=function(T,I){Kb(T,I),oh(m)},y.prototype.leaveEmphasis=function(T,I){Jb(T,I),oh(m)},y.prototype.enterBlur=function(T){sCe(T),oh(m)},y.prototype.leaveBlur=function(T){$re(T),oh(m)},y.prototype.enterSelect=function(T){qre(T),oh(m)},y.prototype.leaveSelect=function(T){Zre(T),oh(m)},y.prototype.getModel=function(){return m.getModel()},y.prototype.getViewOfComponentModel=function(T){return m.getViewOfComponentModel(T)},y.prototype.getViewOfSeriesModel=function(T){return m.getViewOfSeriesModel(T)},y}(Xie))(m)},Vse=function(m){function _(y,T){for(var I=0;I<y.length;I++){var C=y[I];C[GB]=T}}it(rA,function(y,T){m._messageCenter.on(T,function(I){if(Iq[m.group]&&m[GB]!==Sq){if(I&&I.escapeConnect)return;var C=m.makeActionFromEvent(I),M=[];it(iA,function(B){B!==m&&B.group===m.group&&M.push(B)}),_(M,Sq),it(M,function(B){B[GB]!==cPe&&B.dispatchAction(C)}),_(M,uPe)}})})}}(),e}(rd),kU=Gse.prototype;kU.on=Ose("on");kU.off=Ose("off");kU.one=function(n,e,t){var r=this;function i(){for(var s=[],a=0;a<arguments.length;a++)s[a]=arguments[a];e&&e.apply&&e.apply(this,s),r.off(n,i)}this.on.call(this,n,i,t)};var hPe=["click","dblclick","mouseover","mouseout","mousemove","mousedown","mouseup","globalout","contextmenu"];var RP={},rA={},oN=[],aN=[],PP=[],Hse={},lN={},iA={},Iq={},fPe=+new Date-0,OU="_echarts_instance_";function dPe(n,e,t){{var r=pPe(n);if(r)return r}var i=new Gse(n,e,t);return i.id="ec_"+fPe++,iA[i.id]=i,Ire(n,OU,i.id),Vse(i),If.trigger("afterinit",i),i}function pPe(n){return iA[ZTe(n,OU)]}function jse(n,e){Hse[n]=e}function Wse(n){Wi(aN,n)<0&&aN.push(n)}function Xse(n,e){NU(oN,n,e,tPe)}function mPe(n){FU("afterinit",n)}function gPe(n){FU("afterupdate",n)}function FU(n,e){If.on(n,e)}function vp(n,e,t){li(e)&&(t=e,e="");var r=Xr(n)?n.type:[n,n={event:e}][0];n.event=(n.event||r).toLowerCase(),e=n.event,!rA[e]&&(hp(wq.test(r)&&wq.test(e)),RP[r]||(RP[r]={action:t,actionInfo:n}),rA[e]=r)}function vPe(n,e){EU.register(n,e)}function _Pe(n,e){NU(PP,n,e,Dse,"layout")}function _x(n,e){NU(PP,n,e,Bse,"visual")}var Rq=[];function NU(n,e,t,r,i){if((li(e)||Xr(e))&&(t=e,e=r),!(Wi(Rq,t)>=0)){Rq.push(t);var s=yse.wrapStageHandler(t,i);s.__prio=e,s.__raw=t,n.push(s)}}function $se(n,e){lN[n]=e}function yPe(n,e,t){var r=YRe("registerMap");r&&r(n,e,t)}var xPe=CIe;_x(BU,eRe);_x(OD,tRe);_x(OD,nRe);_x(BU,mRe);_x(OD,gRe);_x(kse,qRe);Wse(qie);Xse(QRe,oIe);$se("default",rRe);vp({type:ky,event:ky,update:ky},Cc);vp({type:UI,event:UI,update:UI},Cc);vp({type:JS,event:JS,update:JS},Cc);vp({type:VI,event:VI,update:VI},Cc);vp({type:QS,event:QS,update:QS},Cc);jse("light",dRe);jse("dark",Sse);function q2(n){return n==null?0:n.length||1}function Pq(n){return n}var oT=function(){function n(e,t,r,i,s,a){this._old=e,this._new=t,this._oldKeyGetter=r||Pq,this._newKeyGetter=i||Pq,this.context=s,this._diffModeMultiple=a==="multiple"}return n.prototype.add=function(e){return this._add=e,this},n.prototype.update=function(e){return this._update=e,this},n.prototype.updateManyToOne=function(e){return this._updateManyToOne=e,this},n.prototype.updateOneToMany=function(e){return this._updateOneToMany=e,this},n.prototype.updateManyToMany=function(e){return this._updateManyToMany=e,this},n.prototype.remove=function(e){return this._remove=e,this},n.prototype.execute=function(){this[this._diffModeMultiple?"_executeMultiple":"_executeOneToOne"]()},n.prototype._executeOneToOne=function(){var e=this._old,t=this._new,r={},i=new Array(e.length),s=new Array(t.length);this._initIndexMap(e,null,i,"_oldKeyGetter"),this._initIndexMap(t,r,s,"_newKeyGetter");for(var a=0;a<e.length;a++){var l=i[a],o=r[l],h=q2(o);if(h>1){var d=o.shift();o.length===1&&(r[l]=o[0]),this._update&&this._update(d,a)}else h===1?(r[l]=null,this._update&&this._update(o,a)):this._remove&&this._remove(a)}this._performRestAdd(s,r)},n.prototype._executeMultiple=function(){var e=this._old,t=this._new,r={},i={},s=[],a=[];this._initIndexMap(e,r,s,"_oldKeyGetter"),this._initIndexMap(t,i,a,"_newKeyGetter");for(var l=0;l<s.length;l++){var o=s[l],h=r[o],d=i[o],m=q2(h),_=q2(d);if(m>1&&_===1)this._updateManyToOne&&this._updateManyToOne(d,h),i[o]=null;else if(m===1&&_>1)this._updateOneToMany&&this._updateOneToMany(d,h),i[o]=null;else if(m===1&&_===1)this._update&&this._update(d,h),i[o]=null;else if(m>1&&_>1)this._updateManyToMany&&this._updateManyToMany(d,h),i[o]=null;else if(m>1)for(var y=0;y<m;y++)this._remove&&this._remove(h[y]);else this._remove&&this._remove(h)}this._performRestAdd(a,i)},n.prototype._performRestAdd=function(e,t){for(var r=0;r<e.length;r++){var i=e[r],s=t[i],a=q2(s);if(a>1)for(var l=0;l<a;l++)this._add&&this._add(s[l]);else a===1&&this._add&&this._add(s);t[i]=null}},n.prototype._initIndexMap=function(e,t,r,i){for(var s=this._diffModeMultiple,a=0;a<e.length;a++){var l="_ec_"+this[i](e[a],a);if(s||(r[a]=l),!!t){var o=t[l],h=q2(o);h===0?(t[l]=a,s&&r.push(l)):h===1?t[l]=[o,a]:o.push(a)}}},n}(),bPe=function(){function n(e,t){this._encode=e,this._schema=t}return n.prototype.get=function(){return{fullDimensions:this._getFullDimensionNames(),encode:this._encode}},n.prototype._getFullDimensionNames=function(){return this._cachedDimNames||(this._cachedDimNames=this._schema?this._schema.makeOutputDimensionNames():[]),this._cachedDimNames},n}();function wPe(n,e){var t={},r=t.encode={},i=ri(),s=[],a=[],l={};it(n.dimensions,function(_){var y=n.getDimensionInfo(_),T=y.coordDim;if(T){var I=y.coordDimIndex;qB(r,T)[I]=_,y.isExtraCoord||(i.set(T,1),APe(y.type)&&(s[0]=_),qB(l,T)[I]=n.getDimensionIndex(y.name)),y.defaultTooltip&&a.push(_)}Vie.each(function(C,M){var B=qB(r,M),k=y.otherDims[M];k!=null&&k!==!1&&(B[k]=y.name)})});var o=[],h={};i.each(function(_,y){var T=r[y];h[y]=T[0],o=o.concat(T)}),t.dataDimsOnCoord=o,t.dataDimIndicesOnCoord=xr(o,function(_){return n.getDimensionInfo(_).storeDimIndex}),t.encodeFirstDimNotExtra=h;var d=r.label;d&&d.length&&(s=d.slice());var m=r.tooltip;return m&&m.length?a=m.slice():a.length||(a=s.slice()),r.defaultedLabel=s,r.defaultedTooltip=a,t.userOutput=new bPe(l,e),t}function qB(n,e){return n.hasOwnProperty(e)||(n[e]=[]),n[e]}function SPe(n){return n==="category"?"ordinal":n==="time"?"time":"float"}function APe(n){return!(n==="ordinal"||n==="time")}var XI=function(){function n(e){this.otherDims={},e!=null&&Jn(this,e)}return n}(),TPe=Xs(),MPe={float:"f",int:"i",ordinal:"o",number:"n",time:"t"},qse=function(){function n(e){this.dimensions=e.dimensions,this._dimOmitted=e.dimensionOmitted,this.source=e.source,this._fullDimCount=e.fullDimensionCount,this._updateDimOmitted(e.dimensionOmitted)}return n.prototype.isDimensionOmitted=function(){return this._dimOmitted},n.prototype._updateDimOmitted=function(e){this._dimOmitted=e,e&&(this._dimNameMap||(this._dimNameMap=Kse(this.source)))},n.prototype.getSourceDimensionIndex=function(e){return Ci(this._dimNameMap.get(e),-1)},n.prototype.getSourceDimension=function(e){var t=this.source.dimensionsDefine;if(t)return t[e]},n.prototype.makeStoreSchema=function(){for(var e=this._fullDimCount,t=Kie(this.source),r=!Jse(e),i="",s=[],a=0,l=0;a<e;a++){var o=void 0,h=void 0,d=void 0,m=this.dimensions[l];if(m&&m.storeDimIndex===a)o=t?m.name:null,h=m.type,d=m.ordinalMeta,l++;else{var _=this.getSourceDimension(a);_&&(o=t?_.name:null,h=_.type)}s.push({property:o,type:h,ordinalMeta:d}),t&&o!=null&&(!m||!m.isCalculationCoord)&&(i+=r?o.replace(/\`/g,"`1").replace(/\$/g,"`2"):o),i+="$",i+=MPe[h]||"f",d&&(i+=d.uid),i+="$"}var y=this.source,T=[y.seriesLayoutBy,y.startIndex,i].join("$$");return{dimensions:s,hash:T}},n.prototype.makeOutputDimensionNames=function(){for(var e=[],t=0,r=0;t<this._fullDimCount;t++){var i=void 0,s=this.dimensions[r];if(s&&s.storeDimIndex===t)s.isCalculationCoord||(i=s.name),r++;else{var a=this.getSourceDimension(t);a&&(i=a.name)}e.push(i)}return e},n.prototype.appendCalculationDimension=function(e){this.dimensions.push(e),e.isCalculationCoord=!0,this._fullDimCount++,this._updateDimOmitted(!0)},n}();function Zse(n){return n instanceof qse}function Yse(n){for(var e=ri(),t=0;t<(n||[]).length;t++){var r=n[t],i=Xr(r)?r.name:r;i!=null&&e.get(i)==null&&e.set(i,t)}return e}function Kse(n){var e=TPe(n);return e.dimNameMap||(e.dimNameMap=Yse(n.dimensionsDefine))}function Jse(n){return n>30}var Z2=Xr,_0=xr,CPe=typeof Int32Array>"u"?Array:Int32Array,EPe="e\0\0",Lq=-1,IPe=["hasItemOption","_nameList","_idList","_invertedIndicesMap","_dimSummary","userOutput","_rawData","_dimValueGetter","_nameDimIdx","_idDimIdx","_nameRepeatCount"],RPe=["_approximateExtent"],Dq,jE,Y2,K2,ZB,WE,YB,Qse=function(){function n(e,t){this.type="list",this._dimOmitted=!1,this._nameList=[],this._idList=[],this._visual={},this._layout={},this._itemVisuals=[],this._itemLayouts=[],this._graphicEls=[],this._approximateExtent={},this._calculationInfo={},this.hasItemOption=!1,this.TRANSFERABLE_METHODS=["cloneShallow","downSample","lttbDownSample","map"],this.CHANGABLE_METHODS=["filterSelf","selectRange"],this.DOWNSAMPLE_METHODS=["downSample","lttbDownSample"];var r,i=!1;Zse(e)?(r=e.dimensions,this._dimOmitted=e.isDimensionOmitted(),this._schema=e):(i=!0,r=e),r=r||["x","y"];for(var s={},a=[],l={},o=!1,h={},d=0;d<r.length;d++){var m=r[d],_=Dr(m)?new XI({name:m}):m instanceof XI?m:new XI(m),y=_.name;_.type=_.type||"float",_.coordDim||(_.coordDim=y,_.coordDimIndex=0);var T=_.otherDims=_.otherDims||{};a.push(y),s[y]=_,h[y]!=null&&(o=!0),_.createInvertedIndices&&(l[y]=[]),T.itemName===0&&(this._nameDimIdx=d),T.itemId===0&&(this._idDimIdx=d),i&&(_.storeDimIndex=d)}if(this.dimensions=a,this._dimInfos=s,this._initGetDimensionInfo(o),this.hostModel=t,this._invertedIndicesMap=l,this._dimOmitted){var I=this._dimIdxToName=ri();it(a,function(C){I.set(s[C].storeDimIndex,C)})}}return n.prototype.getDimension=function(e){var t=this._recognizeDimIndex(e);if(t==null)return e;if(t=e,!this._dimOmitted)return this.dimensions[t];var r=this._dimIdxToName.get(t);if(r!=null)return r;var i=this._schema.getSourceDimension(t);if(i)return i.name},n.prototype.getDimensionIndex=function(e){var t=this._recognizeDimIndex(e);if(t!=null)return t;if(e==null)return-1;var r=this._getDimInfo(e);return r?r.storeDimIndex:this._dimOmitted?this._schema.getSourceDimensionIndex(e):-1},n.prototype._recognizeDimIndex=function(e){if(Is(e)||e!=null&&!isNaN(e)&&!this._getDimInfo(e)&&(!this._dimOmitted||this._schema.getSourceDimensionIndex(e)<0))return+e},n.prototype._getStoreDimIndex=function(e){var t=this.getDimensionIndex(e);return t},n.prototype.getDimensionInfo=function(e){return this._getDimInfo(this.getDimension(e))},n.prototype._initGetDimensionInfo=function(e){var t=this._dimInfos;this._getDimInfo=e?function(r){return t.hasOwnProperty(r)?t[r]:void 0}:function(r){return t[r]}},n.prototype.getDimensionsOnCoord=function(){return this._dimSummary.dataDimsOnCoord.slice()},n.prototype.mapDimension=function(e,t){var r=this._dimSummary;if(t==null)return r.encodeFirstDimNotExtra[e];var i=r.encode[e];return i?i[t]:null},n.prototype.mapDimensionsAll=function(e){var t=this._dimSummary,r=t.encode[e];return(r||[]).slice()},n.prototype.getStore=function(){return this._store},n.prototype.initData=function(e,t,r){var i=this,s;if(e instanceof YF&&(s=e),!s){var a=this.dimensions,l=IU(e)||Ec(e)?new Jie(e,a.length):e;s=new YF;var o=_0(a,function(h){return{type:i._dimInfos[h].type,property:h}});s.initData(l,o,r)}this._store=s,this._nameList=(t||[]).slice(),this._idList=[],this._nameRepeatCount={},this._doInit(0,s.count()),this._dimSummary=wPe(this,this._schema),this.userOutput=this._dimSummary.userOutput},n.prototype.appendData=function(e){var t=this._store.appendData(e);this._doInit(t[0],t[1])},n.prototype.appendValues=function(e,t){var r=this._store.appendValues(e,t.length),i=r.start,s=r.end,a=this._shouldMakeIdFromName();if(this._updateOrdinalMeta(),t)for(var l=i;l<s;l++){var o=l-i;this._nameList[l]=t[o],a&&YB(this,l)}},n.prototype._updateOrdinalMeta=function(){for(var e=this._store,t=this.dimensions,r=0;r<t.length;r++){var i=this._dimInfos[t[r]];i.ordinalMeta&&e.collectOrdinalMeta(i.storeDimIndex,i.ordinalMeta)}},n.prototype._shouldMakeIdFromName=function(){var e=this._store.getProvider();return this._idDimIdx==null&&e.getSource().sourceFormat!==rv&&!e.fillStorage},n.prototype._doInit=function(e,t){if(!(e>=t)){var r=this._store,i=r.getProvider();this._updateOrdinalMeta();var s=this._nameList,a=this._idList,l=i.getSource().sourceFormat,o=l===Bh;if(o&&!i.pure)for(var h=[],d=e;d<t;d++){var m=i.getItem(d,h);if(!this.hasItemOption&&OTe(m)&&(this.hasItemOption=!0),m){var _=m.name;s[d]==null&&_!=null&&(s[d]=op(_,null));var y=m.id;a[d]==null&&y!=null&&(a[d]=op(y,null))}}if(this._shouldMakeIdFromName())for(var d=e;d<t;d++)YB(this,d);Dq(this)}},n.prototype.getApproximateExtent=function(e){return this._approximateExtent[e]||this._store.getDataExtent(this._getStoreDimIndex(e))},n.prototype.setApproximateExtent=function(e,t){t=this.getDimension(t),this._approximateExtent[t]=e.slice()},n.prototype.getCalculationInfo=function(e){return this._calculationInfo[e]},n.prototype.setCalculationInfo=function(e,t){Z2(e)?Jn(this._calculationInfo,e):this._calculationInfo[e]=t},n.prototype.getName=function(e){var t=this.getRawIndex(e),r=this._nameList[t];return r==null&&this._nameDimIdx!=null&&(r=Y2(this,this._nameDimIdx,t)),r==null&&(r=""),r},n.prototype._getCategory=function(e,t){var r=this._store.get(e,t),i=this._store.getOrdinalMeta(e);return i?i.categories[r]:r},n.prototype.getId=function(e){return jE(this,this.getRawIndex(e))},n.prototype.count=function(){return this._store.count()},n.prototype.get=function(e,t){var r=this._store,i=this._dimInfos[e];if(i)return r.get(i.storeDimIndex,t)},n.prototype.getByRawIndex=function(e,t){var r=this._store,i=this._dimInfos[e];if(i)return r.getByRawIndex(i.storeDimIndex,t)},n.prototype.getIndices=function(){return this._store.getIndices()},n.prototype.getDataExtent=function(e){return this._store.getDataExtent(this._getStoreDimIndex(e))},n.prototype.getSum=function(e){return this._store.getSum(this._getStoreDimIndex(e))},n.prototype.getMedian=function(e){return this._store.getMedian(this._getStoreDimIndex(e))},n.prototype.getValues=function(e,t){var r=this,i=this._store;return fr(e)?i.getValues(_0(e,function(s){return r._getStoreDimIndex(s)}),t):i.getValues(e)},n.prototype.hasValue=function(e){for(var t=this._dimSummary.dataDimIndicesOnCoord,r=0,i=t.length;r<i;r++)if(isNaN(this._store.get(t[r],e)))return!1;return!0},n.prototype.indexOfName=function(e){for(var t=0,r=this._store.count();t<r;t++)if(this.getName(t)===e)return t;return-1},n.prototype.getRawIndex=function(e){return this._store.getRawIndex(e)},n.prototype.indexOfRawIndex=function(e){return this._store.indexOfRawIndex(e)},n.prototype.rawIndexOf=function(e,t){var r=e&&this._invertedIndicesMap[e],i=r[t];return i==null||isNaN(i)?Lq:i},n.prototype.indicesOfNearest=function(e,t,r){return this._store.indicesOfNearest(this._getStoreDimIndex(e),t,r)},n.prototype.each=function(e,t,r){li(e)&&(r=t,t=e,e=[]);var i=r||this,s=_0(K2(e),this._getStoreDimIndex,this);this._store.each(s,i?Ns(t,i):t)},n.prototype.filterSelf=function(e,t,r){li(e)&&(r=t,t=e,e=[]);var i=r||this,s=_0(K2(e),this._getStoreDimIndex,this);return this._store=this._store.filter(s,i?Ns(t,i):t),this},n.prototype.selectRange=function(e){var t=this,r={},i=io(e);return it(i,function(s){var a=t._getStoreDimIndex(s);r[a]=e[s]}),this._store=this._store.selectRange(r),this},n.prototype.mapArray=function(e,t,r){li(e)&&(r=t,t=e,e=[]),r=r||this;var i=[];return this.each(e,function(){i.push(t&&t.apply(this,arguments))},r),i},n.prototype.map=function(e,t,r,i){var s=r||i||this,a=_0(K2(e),this._getStoreDimIndex,this),l=WE(this);return l._store=this._store.map(a,s?Ns(t,s):t),l},n.prototype.modify=function(e,t,r,i){var s=r||i||this,a=_0(K2(e),this._getStoreDimIndex,this);this._store.modify(a,s?Ns(t,s):t)},n.prototype.downSample=function(e,t,r,i){var s=WE(this);return s._store=this._store.downSample(this._getStoreDimIndex(e),t,r,i),s},n.prototype.lttbDownSample=function(e,t){var r=WE(this);return r._store=this._store.lttbDownSample(this._getStoreDimIndex(e),t),r},n.prototype.getRawDataItem=function(e){return this._store.getRawDataItem(e)},n.prototype.getItemModel=function(e){var t=this.hostModel,r=this.getRawDataItem(e);return new Io(r,t,t&&t.ecModel)},n.prototype.diff=function(e){var t=this;return new oT(e?e.getStore().getIndices():[],this.getStore().getIndices(),function(r){return jE(e,r)},function(r){return jE(t,r)})},n.prototype.getVisual=function(e){var t=this._visual;return t&&t[e]},n.prototype.setVisual=function(e,t){this._visual=this._visual||{},Z2(e)?Jn(this._visual,e):this._visual[e]=t},n.prototype.getItemVisual=function(e,t){var r=this._itemVisuals[e],i=r&&r[t];return i??this.getVisual(t)},n.prototype.hasItemVisual=function(){return this._itemVisuals.length>0},n.prototype.ensureUniqueItemVisual=function(e,t){var r=this._itemVisuals,i=r[e];i||(i=r[e]={});var s=i[t];return s==null&&(s=this.getVisual(t),fr(s)?s=s.slice():Z2(s)&&(s=Jn({},s)),i[t]=s),s},n.prototype.setItemVisual=function(e,t,r){var i=this._itemVisuals[e]||{};this._itemVisuals[e]=i,Z2(t)?Jn(i,t):i[t]=r},n.prototype.clearAllVisual=function(){this._visual={},this._itemVisuals=[]},n.prototype.setLayout=function(e,t){Z2(e)?Jn(this._layout,e):this._layout[e]=t},n.prototype.getLayout=function(e){return this._layout[e]},n.prototype.getItemLayout=function(e){return this._itemLayouts[e]},n.prototype.setItemLayout=function(e,t,r){this._itemLayouts[e]=r?Jn(this._itemLayouts[e]||{},t):t},n.prototype.clearItemLayouts=function(){this._itemLayouts.length=0},n.prototype.setItemGraphicEl=function(e,t){var r=this.hostModel&&this.hostModel.seriesIndex;ZMe(r,this.dataType,e,t),this._graphicEls[e]=t},n.prototype.getItemGraphicEl=function(e){return this._graphicEls[e]},n.prototype.eachItemGraphicEl=function(e,t){it(this._graphicEls,function(r,i){r&&e&&e.call(t,r,i)})},n.prototype.cloneShallow=function(e){return e||(e=new n(this._schema?this._schema:_0(this.dimensions,this._getDimInfo,this),this.hostModel)),ZB(e,this),e._store=this._store,e},n.prototype.wrapMethod=function(e,t){var r=this[e];li(r)&&(this.__wrappedMethods=this.__wrappedMethods||[],this.__wrappedMethods.push(e),this[e]=function(){var i=r.apply(this,arguments);return t.apply(this,[i].concat(J6(arguments)))})},n.internalField=function(){Dq=function(e){var t=e._invertedIndicesMap;it(t,function(r,i){var s=e._dimInfos[i],a=s.ordinalMeta,l=e._store;if(a){r=t[i]=new CPe(a.categories.length);for(var o=0;o<r.length;o++)r[o]=Lq;for(var o=0;o<l.count();o++)r[l.get(s.storeDimIndex,o)]=o}})},Y2=function(e,t,r){return op(e._getCategory(t,r),null)},jE=function(e,t){var r=e._idList[t];return r==null&&e._idDimIdx!=null&&(r=Y2(e,e._idDimIdx,t)),r==null&&(r=EPe+t),r},K2=function(e){return fr(e)||(e=e!=null?[e]:[]),e},WE=function(e){var t=new n(e._schema?e._schema:_0(e.dimensions,e._getDimInfo,e),e.hostModel);return ZB(t,e),t},ZB=function(e,t){it(IPe.concat(t.__wrappedMethods||[]),function(r){t.hasOwnProperty(r)&&(e[r]=t[r])}),e.__wrappedMethods=t.__wrappedMethods,it(RPe,function(r){e[r]=vi(t[r])}),e._calculationInfo=Jn({},t._calculationInfo)},YB=function(e,t){var r=e._nameList,i=e._idList,s=e._nameDimIdx,a=e._idDimIdx,l=r[t],o=i[t];if(l==null&&s!=null&&(r[t]=l=Y2(e,s,t)),o==null&&a!=null&&(i[t]=o=Y2(e,a,t)),o==null&&l!=null){var h=e._nameRepeatCount,d=h[l]=(h[l]||0)+1;o=l,d>1&&(o+="__ec__"+d),i[t]=o}}}(),n}();function eoe(n,e){IU(n)||(n=Zie(n)),e=e||{};var t=e.coordDimensions||[],r=e.dimensionsDefine||n.dimensionsDefine||[],i=ri(),s=[],a=LPe(n,t,r,e.dimensionsCount),l=e.canOmitUnusedDimensions&&Jse(a),o=r===n.dimensionsDefine,h=o?Kse(n):Yse(r),d=e.encodeDefine;!d&&e.encodeDefaulter&&(d=e.encodeDefaulter(n,a));for(var m=ri(d),_=new ose(a),y=0;y<_.length;y++)_[y]=-1;function T(se){var ae=_[se];if(ae<0){var fe=r[se],Se=Xr(fe)?fe:{name:fe},Ee=new XI,Re=Se.name;Re!=null&&h.get(Re)!=null&&(Ee.name=Ee.displayName=Re),Se.type!=null&&(Ee.type=Se.type),Se.displayName!=null&&(Ee.displayName=Se.displayName);var qe=s.length;return _[se]=qe,Ee.storeDimIndex=se,s.push(Ee),Ee}return s[ae]}if(!l)for(var y=0;y<a;y++)T(y);m.each(function(se,ae){var fe=da(se).slice();if(fe.length===1&&!Dr(fe[0])&&fe[0]<0){m.set(ae,!1);return}var Se=m.set(ae,[]);it(fe,function(Ee,Re){var qe=Dr(Ee)?h.get(Ee):Ee;qe!=null&&qe<a&&(Se[Re]=qe,C(T(qe),ae,Re))})});var I=0;it(t,function(se){var ae,fe,Se,Ee;if(Dr(se))ae=se,Ee={};else{Ee=se,ae=Ee.name;var Re=Ee.ordinalMeta;Ee.ordinalMeta=null,Ee=Jn({},Ee),Ee.ordinalMeta=Re,fe=Ee.dimsDef,Se=Ee.otherDims,Ee.name=Ee.coordDim=Ee.coordDimIndex=Ee.dimsDef=Ee.otherDims=null}var qe=m.get(ae);if(qe!==!1){if(qe=da(qe),!qe.length)for(var Le=0;Le<(fe&&fe.length||1);Le++){for(;I<a&&T(I).coordDim!=null;)I++;I<a&&qe.push(I++)}it(qe,function(dt,ye){var Xe=T(dt);if(o&&Ee.type!=null&&(Xe.type=Ee.type),C(ti(Xe,Ee),ae,ye),Xe.name==null&&fe){var He=fe[ye];!Xr(He)&&(He={name:He}),Xe.name=Xe.displayName=He.name,Xe.defaultTooltip=He.defaultTooltip}Se&&ti(Xe.otherDims,Se)})}});function C(se,ae,fe){Vie.get(ae)!=null?se.otherDims[ae]=fe:(se.coordDim=ae,se.coordDimIndex=fe,i.set(ae,!0))}var M=e.generateCoord,B=e.generateCoordCount,k=B!=null;B=M?B||1:0;var j=M||"value";function q(se){se.name==null&&(se.name=se.coordDim)}if(l)it(s,function(se){q(se)}),s.sort(function(se,ae){return se.storeDimIndex-ae.storeDimIndex});else for(var Z=0;Z<a;Z++){var te=T(Z),ie=te.coordDim;ie==null&&(te.coordDim=DPe(j,i,k),te.coordDimIndex=0,(!M||B<=0)&&(te.isExtraCoord=!0),B--),q(te),te.type==null&&(jie(n,Z)===vl.Must||te.isExtraCoord&&(te.otherDims.itemName!=null||te.otherDims.seriesName!=null))&&(te.type="ordinal")}return PPe(s),new qse({source:n,dimensions:s,fullDimensionCount:a,dimensionOmitted:l})}function PPe(n){for(var e=ri(),t=0;t<n.length;t++){var r=n[t],i=r.name,s=e.get(i)||0;s>0&&(r.name=i+(s-1)),s++,e.set(i,s)}}function LPe(n,e,t,r){var i=Math.max(n.dimensionsDetectedCount||1,e.length,t.length,r||0);return it(e,function(s){var a;Xr(s)&&(a=s.dimsDef)&&(i=Math.max(i,a.length))}),i}function DPe(n,e,t){if(t||e.hasKey(n)){for(var r=0;e.hasKey(n+r);)r++;n+=r}return e.set(n,!0),n}var BPe=function(){function n(e){this.coordSysDims=[],this.axisMap=ri(),this.categoryAxisMap=ri(),this.coordSysName=e}return n}();function kPe(n){var e=n.get("coordinateSystem"),t=new BPe(e),r=OPe[e];if(r)return r(n,t,t.axisMap,t.categoryAxisMap),t}var OPe={cartesian2d:function(n,e,t,r){var i=n.getReferringComponents("xAxis",yl).models[0],s=n.getReferringComponents("yAxis",yl).models[0];e.coordSysDims=["x","y"],t.set("x",i),t.set("y",s),D1(i)&&(r.set("x",i),e.firstCategoryDimIndex=0),D1(s)&&(r.set("y",s),e.firstCategoryDimIndex==null&&(e.firstCategoryDimIndex=1))},singleAxis:function(n,e,t,r){var i=n.getReferringComponents("singleAxis",yl).models[0];e.coordSysDims=["single"],t.set("single",i),D1(i)&&(r.set("single",i),e.firstCategoryDimIndex=0)},polar:function(n,e,t,r){var i=n.getReferringComponents("polar",yl).models[0],s=i.findAxisModel("radiusAxis"),a=i.findAxisModel("angleAxis");e.coordSysDims=["radius","angle"],t.set("radius",s),t.set("angle",a),D1(s)&&(r.set("radius",s),e.firstCategoryDimIndex=0),D1(a)&&(r.set("angle",a),e.firstCategoryDimIndex==null&&(e.firstCategoryDimIndex=1))},geo:function(n,e,t,r){e.coordSysDims=["lng","lat"]},parallel:function(n,e,t,r){var i=n.ecModel,s=i.getComponent("parallel",n.get("parallelIndex")),a=e.coordSysDims=s.dimensions.slice();it(s.parallelAxisIndex,function(l,o){var h=i.getComponent("parallelAxis",l),d=a[o];t.set(d,h),D1(h)&&(r.set(d,h),e.firstCategoryDimIndex==null&&(e.firstCategoryDimIndex=o))})}};function D1(n){return n.get("type")==="category"}function FPe(n,e,t){t=t||{};var r=t.byIndex,i=t.stackedCoordDimension,s,a,l;NPe(e)?s=e:(a=e.schema,s=a.dimensions,l=e.store);var o=!!(n&&n.get("stack")),h,d,m,_;if(it(s,function(B,k){Dr(B)&&(s[k]=B={name:B}),o&&!B.isExtraCoord&&(!r&&!h&&B.ordinalMeta&&(h=B),!d&&B.type!=="ordinal"&&B.type!=="time"&&(!i||i===B.coordDim)&&(d=B))}),d&&!r&&!h&&(r=!0),d){m="__\0ecstackresult_"+n.id,_="__\0ecstackedover_"+n.id,h&&(h.createInvertedIndices=!0);var y=d.coordDim,T=d.type,I=0;it(s,function(B){B.coordDim===y&&I++});var C={name:m,coordDim:y,coordDimIndex:I,type:T,isExtraCoord:!0,isCalculationCoord:!0,storeDimIndex:s.length},M={name:_,coordDim:_,coordDimIndex:I+1,type:T,isExtraCoord:!0,isCalculationCoord:!0,storeDimIndex:s.length+1};a?(l&&(C.storeDimIndex=l.ensureCalculationDimension(_,T),M.storeDimIndex=l.ensureCalculationDimension(m,T)),a.appendCalculationDimension(C),a.appendCalculationDimension(M)):(s.push(C),s.push(M))}return{stackedDimension:d&&d.name,stackedByDimension:h&&h.name,isStackedByIndex:r,stackedOverDimension:_,stackResultDimension:m}}function NPe(n){return!Zse(n.schema)}function tx(n,e){return!!e&&e===n.getCalculationInfo("stackedDimension")}function zPe(n,e){return tx(n,e)?n.getCalculationInfo("stackResultDimension"):e}function UPe(n,e){var t=n.get("coordinateSystem"),r=EU.get(t),i;return e&&e.coordSysDims&&(i=xr(e.coordSysDims,function(s){var a={name:s},l=e.axisMap.get(s);if(l){var o=l.get("type");a.type=SPe(o)}return a})),i||(i=r&&(r.getDimensionsInfo?r.getDimensionsInfo():r.dimensions.slice())||["x","y"]),i}function VPe(n,e,t){var r,i;return t&&it(n,function(s,a){var l=s.coordDim,o=t.categoryAxisMap.get(l);o&&(r==null&&(r=a),s.ordinalMeta=o.getOrdinalMeta(),e&&(s.createInvertedIndices=!0)),s.otherDims.itemName!=null&&(i=!0)}),!i&&r!=null&&(n[r].otherDims.itemName=0),r}function zU(n,e,t){t=t||{};var r=e.getSourceManager(),i,s=!1;i=r.getSource(),s=i.sourceFormat===Bh;var a=kPe(e),l=UPe(e,a),o=t.useEncodeDefaulter,h=li(o)?o:o?ms(kEe,l,e):null,d={coordDimensions:l,generateCoord:t.generateCoord,encodeDefine:e.getEncode(),encodeDefaulter:h,canOmitUnusedDimensions:!s},m=eoe(i,d),_=VPe(m.dimensions,t.createInvertedIndices,a),y=s?null:r.getSharedDataStore(m),T=FPe(e,{schema:m,store:y}),I=new Qse(m,e);I.setCalculationInfo(T);var C=_!=null&&GPe(i)?function(M,B,k,j){return j===_?k:this.defaultDimValueGetter(M,B,k,j)}:null;return I.hasItemOption=!1,I.initData(s?i:y,null,C),I}function GPe(n){if(n.sourceFormat===Bh){var e=HPe(n.data||[]);return!fr(KT(e))}}function HPe(n){for(var e=0;e<n.length&&n[e]==null;)e++;return n[e]}var _p=function(){function n(e){this._setting=e||{},this._extent=[1/0,-1/0]}return n.prototype.getSetting=function(e){return this._setting[e]},n.prototype.unionExtent=function(e){var t=this._extent;e[0]<t[0]&&(t[0]=e[0]),e[1]>t[1]&&(t[1]=e[1])},n.prototype.unionExtentFromData=function(e,t){this.unionExtent(e.getApproximateExtent(t))},n.prototype.getExtent=function(){return this._extent.slice()},n.prototype.setExtent=function(e,t){var r=this._extent;isNaN(e)||(r[0]=e),isNaN(t)||(r[1]=t)},n.prototype.isInExtentRange=function(e){return this._extent[0]<=e&&this._extent[1]>=e},n.prototype.isBlank=function(){return this._isBlank},n.prototype.setBlank=function(e){this._isBlank=e},n}();fD(_p);var jPe=0,cN=function(){function n(e){this.categories=e.categories||[],this._needCollect=e.needCollect,this._deduplication=e.deduplication,this.uid=++jPe}return n.createByAxisModel=function(e){var t=e.option,r=t.data,i=r&&xr(r,WPe);return new n({categories:i,needCollect:!i,deduplication:t.dedplication!==!1})},n.prototype.getOrdinal=function(e){return this._getOrCreateMap().get(e)},n.prototype.parseAndCollect=function(e){var t,r=this._needCollect;if(!Dr(e)&&!r)return e;if(r&&!this._deduplication)return t=this.categories.length,this.categories[t]=e,t;var i=this._getOrCreateMap();return t=i.get(e),t==null&&(r?(t=this.categories.length,this.categories[t]=e,i.set(e,t)):t=NaN),t},n.prototype._getOrCreateMap=function(){return this._map||(this._map=ri(this.categories))},n}();function WPe(n){return Xr(n)&&n.value!=null?n.value:n+""}function uN(n){return n.type==="interval"||n.type==="log"}function XPe(n,e,t,r){var i={},s=n[1]-n[0],a=i.interval=Sre(s/e);t!=null&&a<t&&(a=i.interval=t),r!=null&&a>r&&(a=i.interval=r);var l=i.intervalPrecision=toe(a),o=i.niceTickExtent=[Sa(Math.ceil(n[0]/a)*a,l),Sa(Math.floor(n[1]/a)*a,l)];return $Pe(o,n),i}function KB(n){var e=Math.pow(10,rU(n)),t=n/e;return t?t===2?t=3:t===3?t=5:t*=2:t=1,Sa(t*e)}function toe(n){return Cm(n)+2}function Bq(n,e,t){n[e]=Math.max(Math.min(n[e],t[1]),t[0])}function $Pe(n,e){!isFinite(n[0])&&(n[0]=e[0]),!isFinite(n[1])&&(n[1]=e[1]),Bq(n,0,e),Bq(n,1,e),n[0]>n[1]&&(n[0]=n[1])}function FD(n,e){return n>=e[0]&&n<=e[1]}function ND(n,e){return e[1]===e[0]?.5:(n-e[0])/(e[1]-e[0])}function zD(n,e){return n*(e[1]-e[0])+e[0]}var UU=function(n){Hn(e,n);function e(t){var r=n.call(this,t)||this;r.type="ordinal";var i=r.getSetting("ordinalMeta");return i||(i=new cN({})),fr(i)&&(i=new cN({categories:xr(i,function(s){return Xr(s)?s.value:s})})),r._ordinalMeta=i,r._extent=r.getSetting("extent")||[0,i.categories.length-1],r}return e.prototype.parse=function(t){return t==null?NaN:Dr(t)?this._ordinalMeta.getOrdinal(t):Math.round(t)},e.prototype.contain=function(t){return t=this.parse(t),FD(t,this._extent)&&this._ordinalMeta.categories[t]!=null},e.prototype.normalize=function(t){return t=this._getTickNumber(this.parse(t)),ND(t,this._extent)},e.prototype.scale=function(t){return t=Math.round(zD(t,this._extent)),this.getRawOrdinalNumber(t)},e.prototype.getTicks=function(){for(var t=[],r=this._extent,i=r[0];i<=r[1];)t.push({value:i}),i++;return t},e.prototype.getMinorTicks=function(t){},e.prototype.setSortInfo=function(t){if(t==null){this._ordinalNumbersByTick=this._ticksByOrdinalNumber=null;return}for(var r=t.ordinalNumbers,i=this._ordinalNumbersByTick=[],s=this._ticksByOrdinalNumber=[],a=0,l=this._ordinalMeta.categories.length,o=Math.min(l,r.length);a<o;++a){var h=r[a];i[a]=h,s[h]=a}for(var d=0;a<l;++a){for(;s[d]!=null;)d++;i.push(d),s[d]=a}},e.prototype._getTickNumber=function(t){var r=this._ticksByOrdinalNumber;return r&&t>=0&&t<r.length?r[t]:t},e.prototype.getRawOrdinalNumber=function(t){var r=this._ordinalNumbersByTick;return r&&t>=0&&t<r.length?r[t]:t},e.prototype.getLabel=function(t){if(!this.isBlank()){var r=this.getRawOrdinalNumber(t.value),i=this._ordinalMeta.categories[r];return i==null?"":i+""}},e.prototype.count=function(){return this._extent[1]-this._extent[0]+1},e.prototype.unionExtentFromData=function(t,r){this.unionExtent(t.getApproximateExtent(r))},e.prototype.isInExtentRange=function(t){return t=this._getTickNumber(t),this._extent[0]<=t&&this._extent[1]>=t},e.prototype.getOrdinalMeta=function(){return this._ordinalMeta},e.prototype.calcNiceTicks=function(){},e.prototype.calcNiceExtent=function(){},e.type="ordinal",e}(_p);_p.registerClass(UU);var q_=Sa,Sw=function(n){Hn(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.type="interval",t._interval=0,t._intervalPrecision=2,t}return e.prototype.parse=function(t){return t},e.prototype.contain=function(t){return FD(t,this._extent)},e.prototype.normalize=function(t){return ND(t,this._extent)},e.prototype.scale=function(t){return zD(t,this._extent)},e.prototype.setExtent=function(t,r){var i=this._extent;isNaN(t)||(i[0]=parseFloat(t)),isNaN(r)||(i[1]=parseFloat(r))},e.prototype.unionExtent=function(t){var r=this._extent;t[0]<r[0]&&(r[0]=t[0]),t[1]>r[1]&&(r[1]=t[1]),this.setExtent(r[0],r[1])},e.prototype.getInterval=function(){return this._interval},e.prototype.setInterval=function(t){this._interval=t,this._niceExtent=this._extent.slice(),this._intervalPrecision=toe(t)},e.prototype.getTicks=function(t){var r=this._interval,i=this._extent,s=this._niceExtent,a=this._intervalPrecision,l=[];if(!r)return l;var o=1e4;i[0]<s[0]&&(t?l.push({value:q_(s[0]-r,a)}):l.push({value:i[0]}));for(var h=s[0];h<=s[1]&&(l.push({value:h}),h=q_(h+r,a),h!==l[l.length-1].value);)if(l.length>o)return[];var d=l.length?l[l.length-1].value:s[1];return i[1]>d&&(t?l.push({value:q_(d+r,a)}):l.push({value:i[1]})),l},e.prototype.getMinorTicks=function(t){for(var r=this.getTicks(!0),i=[],s=this.getExtent(),a=1;a<r.length;a++){for(var l=r[a],o=r[a-1],h=0,d=[],m=l.value-o.value,_=m/t;h<t-1;){var y=q_(o.value+(h+1)*_);y>s[0]&&y<s[1]&&d.push(y),h++}i.push(d)}return i},e.prototype.getLabel=function(t,r){if(t==null)return"";var i=r&&r.precision;i==null?i=Cm(t.value)||0:i==="auto"&&(i=this._intervalPrecision);var s=q_(t.value,i,!0);return Fie(s)},e.prototype.calcNiceTicks=function(t,r,i){t=t||5;var s=this._extent,a=s[1]-s[0];if(isFinite(a)){a<0&&(a=-a,s.reverse());var l=XPe(s,t,r,i);this._intervalPrecision=l.intervalPrecision,this._interval=l.interval,this._niceExtent=l.niceTickExtent}},e.prototype.calcNiceExtent=function(t){var r=this._extent;if(r[0]===r[1])if(r[0]!==0){var i=Math.abs(r[0]);t.fixMax||(r[1]+=i/2),r[0]-=i/2}else r[1]=1;var s=r[1]-r[0];isFinite(s)||(r[0]=0,r[1]=1),this.calcNiceTicks(t.splitNumber,t.minInterval,t.maxInterval);var a=this._interval;t.fixMin||(r[0]=q_(Math.floor(r[0]/a)*a)),t.fixMax||(r[1]=q_(Math.ceil(r[1]/a)*a))},e.prototype.setNiceExtent=function(t,r){this._niceExtent=[t,r]},e.type="interval",e}(_p);_p.registerClass(Sw);var noe=typeof Float32Array<"u",qPe=noe?Float32Array:Array;function Im(n){return fr(n)?noe?new Float32Array(n):n:new qPe(n)}var ZPe="__ec_stack_";function VU(n){return n.get("stack")||ZPe+n.seriesIndex}function GU(n){return n.dim+n.index}function roe(n,e){var t=[];return e.eachSeriesByType(n,function(r){soe(r)&&t.push(r)}),t}function YPe(n){var e={};it(n,function(o){var h=o.coordinateSystem,d=h.getBaseAxis();if(!(d.type!=="time"&&d.type!=="value"))for(var m=o.getData(),_=d.dim+"_"+d.index,y=m.getDimensionIndex(m.mapDimension(d.dim)),T=m.getStore(),I=0,C=T.count();I<C;++I){var M=T.get(y,I);e[_]?e[_].push(M):e[_]=[M]}});var t={};for(var r in e)if(e.hasOwnProperty(r)){var i=e[r];if(i){i.sort(function(o,h){return o-h});for(var s=null,a=1;a<i.length;++a){var l=i[a]-i[a-1];l>0&&(s=s===null?l:Math.min(s,l))}t[r]=s}}return t}function ioe(n){var e=YPe(n),t=[];return it(n,function(r){var i=r.coordinateSystem,s=i.getBaseAxis(),a=s.getExtent(),l;if(s.type==="category")l=s.getBandWidth();else if(s.type==="value"||s.type==="time"){var o=s.dim+"_"+s.index,h=e[o],d=Math.abs(a[1]-a[0]),m=s.scale.getExtent(),_=Math.abs(m[1]-m[0]);l=h?d/_*h:d}else{var y=r.getData();l=Math.abs(a[1]-a[0])/y.count()}var T=os(r.get("barWidth"),l),I=os(r.get("barMaxWidth"),l),C=os(r.get("barMinWidth")||(ooe(r)?.5:1),l),M=r.get("barGap"),B=r.get("barCategoryGap");t.push({bandWidth:l,barWidth:T,barMaxWidth:I,barMinWidth:C,barGap:M,barCategoryGap:B,axisKey:GU(s),stackId:VU(r)})}),KPe(t)}function KPe(n){var e={};it(n,function(r,i){var s=r.axisKey,a=r.bandWidth,l=e[s]||{bandWidth:a,remainedWidth:a,autoWidthCount:0,categoryGap:null,gap:"20%",stacks:{}},o=l.stacks;e[s]=l;var h=r.stackId;o[h]||l.autoWidthCount++,o[h]=o[h]||{width:0,maxWidth:0};var d=r.barWidth;d&&!o[h].width&&(o[h].width=d,d=Math.min(l.remainedWidth,d),l.remainedWidth-=d);var m=r.barMaxWidth;m&&(o[h].maxWidth=m);var _=r.barMinWidth;_&&(o[h].minWidth=_);var y=r.barGap;y!=null&&(l.gap=y);var T=r.barCategoryGap;T!=null&&(l.categoryGap=T)});var t={};return it(e,function(r,i){t[i]={};var s=r.stacks,a=r.bandWidth,l=r.categoryGap;if(l==null){var o=io(s).length;l=Math.max(35-o*4,15)+"%"}var h=os(l,a),d=os(r.gap,1),m=r.remainedWidth,_=r.autoWidthCount,y=(m-h)/(_+(_-1)*d);y=Math.max(y,0),it(s,function(M){var B=M.maxWidth,k=M.minWidth;if(M.width){var j=M.width;B&&(j=Math.min(j,B)),k&&(j=Math.max(j,k)),M.width=j,m-=j+d*j,_--}else{var j=y;B&&B<j&&(j=Math.min(B,m)),k&&k>j&&(j=k),j!==y&&(M.width=j,m-=j+d*j,_--)}}),y=(m-h)/(_+(_-1)*d),y=Math.max(y,0);var T=0,I;it(s,function(M,B){M.width||(M.width=y),I=M,T+=M.width*(1+d)}),I&&(T-=I.width*d);var C=-T/2;it(s,function(M,B){t[i][B]=t[i][B]||{bandWidth:a,offset:C,width:M.width},C+=M.width*(1+d)})}),t}function JPe(n,e,t){if(n&&e){var r=n[GU(e)];return r!=null&&t!=null?r[VU(t)]:r}}function QPe(n,e){var t=roe(n,e),r=ioe(t);it(t,function(i){var s=i.getData(),a=i.coordinateSystem,l=a.getBaseAxis(),o=VU(i),h=r[GU(l)][o],d=h.offset,m=h.width;s.setLayout({bandWidth:h.bandWidth,offset:d,size:m})})}function eLe(n){return{seriesType:n,plan:LU(),reset:function(e){if(soe(e)){var t=e.getData(),r=e.coordinateSystem,i=r.getBaseAxis(),s=r.getOtherAxis(i),a=t.getDimensionIndex(t.mapDimension(s.dim)),l=t.getDimensionIndex(t.mapDimension(i.dim)),o=e.get("showBackground",!0),h=t.mapDimension(s.dim),d=t.getCalculationInfo("stackResultDimension"),m=tx(t,h)&&!!t.getCalculationInfo("stackedOnSeries"),_=s.isHorizontal(),y=tLe(i,s),T=ooe(e),I=e.get("barMinHeight")||0,C=d&&t.getDimensionIndex(d),M=t.getLayout("size"),B=t.getLayout("offset");return{progress:function(k,j){for(var q=k.count,Z=T&&Im(q*3),te=T&&o&&Im(q*3),ie=T&&Im(q),se=r.master.getRect(),ae=_?se.width:se.height,fe,Se=j.getStore(),Ee=0;(fe=k.next())!=null;){var Re=Se.get(m?C:a,fe),qe=Se.get(l,fe),Le=y,dt=void 0;m&&(dt=+Re-Se.get(a,fe));var ye=void 0,Xe=void 0,He=void 0,_t=void 0;if(_){var wt=r.dataToPoint([Re,qe]);if(m){var Gt=r.dataToPoint([dt,qe]);Le=Gt[0]}ye=Le,Xe=wt[1]+B,He=wt[0]-Le,_t=M,Math.abs(He)<I&&(He=(He<0?-1:1)*I)}else{var wt=r.dataToPoint([qe,Re]);if(m){var Gt=r.dataToPoint([qe,dt]);Le=Gt[1]}ye=wt[0]+B,Xe=Le,He=M,_t=wt[1]-Le,Math.abs(_t)<I&&(_t=(_t<=0?-1:1)*I)}T?(Z[Ee]=ye,Z[Ee+1]=Xe,Z[Ee+2]=_?He:_t,te&&(te[Ee]=_?se.x:ye,te[Ee+1]=_?Xe:se.y,te[Ee+2]=ae),ie[fe]=fe):j.setItemLayout(fe,{x:ye,y:Xe,width:He,height:_t}),Ee+=3}T&&j.setLayout({largePoints:Z,largeDataIndices:ie,largeBackgroundPoints:te,valueAxisHorizontal:_})}}}}}}function soe(n){return n.coordinateSystem&&n.coordinateSystem.type==="cartesian2d"}function ooe(n){return n.pipelineContext&&n.pipelineContext.large}function tLe(n,e){var t=e.model.get("startValue");return t||(t=0),e.toGlobalCoord(e.dataToCoord(e.type==="log"?t>0?t:1:t))}var nLe=function(n,e,t,r){for(;t<r;){var i=t+r>>>1;n[i][1]<e?t=i+1:r=i}return t},aoe=function(n){Hn(e,n);function e(t){var r=n.call(this,t)||this;return r.type="time",r}return e.prototype.getLabel=function(t){var r=this.getSetting("useUTC");return CD(t.value,A$[AEe(Lb(this._minLevelUnit))]||A$.second,r,this.getSetting("locale"))},e.prototype.getFormattedLabel=function(t,r,i){var s=this.getSetting("useUTC"),a=this.getSetting("locale");return TEe(t,r,i,a,s)},e.prototype.getTicks=function(){var t=this._interval,r=this._extent,i=[];if(!t)return i;i.push({value:r[0],level:0});var s=this.getSetting("useUTC"),a=cLe(this._minLevelUnit,this._approxInterval,s,r);return i=i.concat(a),i.push({value:r[1],level:0}),i},e.prototype.calcNiceExtent=function(t){var r=this._extent;if(r[0]===r[1]&&(r[0]-=yh,r[1]+=yh),r[1]===-1/0&&r[0]===1/0){var i=new Date;r[1]=+new Date(i.getFullYear(),i.getMonth(),i.getDate()),r[0]=r[1]-yh}this.calcNiceTicks(t.splitNumber,t.minInterval,t.maxInterval)},e.prototype.calcNiceTicks=function(t,r,i){t=t||10;var s=this._extent,a=s[1]-s[0];this._approxInterval=a/t,r!=null&&this._approxInterval<r&&(this._approxInterval=r),i!=null&&this._approxInterval>i&&(this._approxInterval=i);var l=XE.length,o=Math.min(nLe(XE,this._approxInterval,0,l),l-1);this._interval=XE[o][1],this._minLevelUnit=XE[Math.max(o-1,0)][0]},e.prototype.parse=function(t){return Is(t)?t:+qm(t)},e.prototype.contain=function(t){return FD(this.parse(t),this._extent)},e.prototype.normalize=function(t){return ND(this.parse(t),this._extent)},e.prototype.scale=function(t){return zD(t,this._extent)},e.type="time",e}(Sw),XE=[["second",bU],["minute",wU],["hour",tA],["quarter-day",tA*6],["half-day",tA*12],["day",yh*1.2],["half-week",yh*3.5],["week",yh*7],["month",yh*31],["quarter",yh*95],["half-year",S$/2],["year",S$]];function rLe(n,e,t,r){var i=qm(e),s=qm(t),a=function(T){return T$(i,T,r)===T$(s,T,r)},l=function(){return a("year")},o=function(){return l()&&a("month")},h=function(){return o()&&a("day")},d=function(){return h()&&a("hour")},m=function(){return d()&&a("minute")},_=function(){return m()&&a("second")},y=function(){return _()&&a("millisecond")};switch(n){case"year":return l();case"month":return o();case"day":return h();case"hour":return d();case"minute":return m();case"second":return _();case"millisecond":return y()}}function iLe(n,e){return n/=yh,n>16?16:n>7.5?7:n>3.5?4:n>1.5?2:1}function sLe(n){var e=30*yh;return n/=e,n>6?6:n>3?3:n>2?2:1}function oLe(n){return n/=tA,n>12?12:n>6?6:n>3.5?4:n>2?2:1}function kq(n,e){return n/=e?wU:bU,n>30?30:n>20?20:n>15?15:n>10?10:n>5?5:n>2?2:1}function aLe(n){return Sre(n)}function lLe(n,e,t){var r=new Date(n);switch(Lb(e)){case"year":case"month":r[Pie(t)](0);case"day":r[Lie(t)](1);case"hour":r[Die(t)](0);case"minute":r[Bie(t)](0);case"second":r[kie(t)](0),r[Oie(t)](0)}return r.getTime()}function cLe(n,e,t,r){var i=1e4,s=Iie,a=0;function l(ae,fe,Se,Ee,Re,qe,Le){for(var dt=new Date(fe),ye=fe,Xe=dt[Ee]();ye<Se&&ye<=r[1];)Le.push({value:ye}),Xe+=ae,dt[Re](Xe),ye=dt.getTime();Le.push({value:ye,notAdd:!0})}function o(ae,fe,Se){var Ee=[],Re=!fe.length;if(!rLe(Lb(ae),r[0],r[1],t)){Re&&(fe=[{value:lLe(new Date(r[0]),ae,t)},{value:r[1]}]);for(var qe=0;qe<fe.length-1;qe++){var Le=fe[qe].value,dt=fe[qe+1].value;if(Le!==dt){var ye=void 0,Xe=void 0,He=void 0,_t=!1;switch(ae){case"year":ye=Math.max(1,Math.round(e/yh/365)),Xe=SU(t),He=MEe(t);break;case"half-year":case"quarter":case"month":ye=sLe(e),Xe=Db(t),He=Pie(t);break;case"week":case"half-week":case"day":ye=iLe(e),Xe=ED(t),He=Lie(t),_t=!0;break;case"half-day":case"quarter-day":case"hour":ye=oLe(e),Xe=eT(t),He=Die(t);break;case"minute":ye=kq(e,!0),Xe=ID(t),He=Bie(t);break;case"second":ye=kq(e,!1),Xe=RD(t),He=kie(t);break;case"millisecond":ye=aLe(e),Xe=PD(t),He=Oie(t);break}l(ye,Le,dt,Xe,He,_t,Ee),ae==="year"&&Se.length>1&&qe===0&&Se.unshift({value:Se[0].value-ye})}}for(var qe=0;qe<Ee.length;qe++)Se.push(Ee[qe]);return Ee}}for(var h=[],d=[],m=0,_=0,y=0;y<s.length&&a++<i;++y){var T=Lb(s[y]);if(SEe(s[y])){o(s[y],h[h.length-1]||[],d);var I=s[y+1]?Lb(s[y+1]):null;if(T!==I){if(d.length){_=m,d.sort(function(ae,fe){return ae.value-fe.value});for(var C=[],M=0;M<d.length;++M){var B=d[M].value;(M===0||d[M-1].value!==B)&&(C.push(d[M]),B>=r[0]&&B<=r[1]&&m++)}var k=(r[1]-r[0])/e;if(m>k*1.5&&_>k/1.5||(h.push(C),m>k||n===s[y]))break}d=[]}}}for(var j=ta(xr(h,function(ae){return ta(ae,function(fe){return fe.value>=r[0]&&fe.value<=r[1]&&!fe.notAdd})}),function(ae){return ae.length>0}),q=[],Z=j.length-1,y=0;y<j.length;++y)for(var te=j[y],ie=0;ie<te.length;++ie)q.push({value:te[ie].value,level:Z-y});q.sort(function(ae,fe){return ae.value-fe.value});for(var se=[],y=0;y<q.length;++y)(y===0||q[y].value!==q[y-1].value)&&se.push(q[y]);return se}_p.registerClass(aoe);var Oq=_p.prototype,sA=Sw.prototype,uLe=Sa,hLe=Math.floor,fLe=Math.ceil,$E=Math.pow,Mf=Math.log,HU=function(n){Hn(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.type="log",t.base=10,t._originalScale=new Sw,t._interval=0,t}return e.prototype.getTicks=function(t){var r=this._originalScale,i=this._extent,s=r.getExtent(),a=sA.getTicks.call(this,t);return xr(a,function(l){var o=l.value,h=Sa($E(this.base,o));return h=o===i[0]&&this._fixMin?qE(h,s[0]):h,h=o===i[1]&&this._fixMax?qE(h,s[1]):h,{value:h}},this)},e.prototype.setExtent=function(t,r){var i=Mf(this.base);t=Mf(Math.max(0,t))/i,r=Mf(Math.max(0,r))/i,sA.setExtent.call(this,t,r)},e.prototype.getExtent=function(){var t=this.base,r=Oq.getExtent.call(this);r[0]=$E(t,r[0]),r[1]=$E(t,r[1]);var i=this._originalScale,s=i.getExtent();return this._fixMin&&(r[0]=qE(r[0],s[0])),this._fixMax&&(r[1]=qE(r[1],s[1])),r},e.prototype.unionExtent=function(t){this._originalScale.unionExtent(t);var r=this.base;t[0]=Mf(t[0])/Mf(r),t[1]=Mf(t[1])/Mf(r),Oq.unionExtent.call(this,t)},e.prototype.unionExtentFromData=function(t,r){this.unionExtent(t.getApproximateExtent(r))},e.prototype.calcNiceTicks=function(t){t=t||10;var r=this._extent,i=r[1]-r[0];if(!(i===1/0||i<=0)){var s=BTe(i),a=t/i*s;for(a<=.5&&(s*=10);!isNaN(s)&&Math.abs(s)<1&&Math.abs(s)>0;)s*=10;var l=[Sa(fLe(r[0]/s)*s),Sa(hLe(r[1]/s)*s)];this._interval=s,this._niceExtent=l}},e.prototype.calcNiceExtent=function(t){sA.calcNiceExtent.call(this,t),this._fixMin=t.fixMin,this._fixMax=t.fixMax},e.prototype.parse=function(t){return t},e.prototype.contain=function(t){return t=Mf(t)/Mf(this.base),FD(t,this._extent)},e.prototype.normalize=function(t){return t=Mf(t)/Mf(this.base),ND(t,this._extent)},e.prototype.scale=function(t){return t=zD(t,this._extent),$E(this.base,t)},e.type="log",e}(_p),loe=HU.prototype;loe.getMinorTicks=sA.getMinorTicks;loe.getLabel=sA.getLabel;function qE(n,e){return uLe(n,Cm(e))}_p.registerClass(HU);var dLe=function(){function n(e,t,r){this._prepareParams(e,t,r)}return n.prototype._prepareParams=function(e,t,r){r[1]<r[0]&&(r=[NaN,NaN]),this._dataMin=r[0],this._dataMax=r[1];var i=this._isOrdinal=e.type==="ordinal";this._needCrossZero=e.type==="interval"&&t.getNeedCrossZero&&t.getNeedCrossZero();var s=t.get("min",!0);s==null&&(s=t.get("startValue",!0));var a=this._modelMinRaw=s;li(a)?this._modelMinNum=ZE(e,a({min:r[0],max:r[1]})):a!=="dataMin"&&(this._modelMinNum=ZE(e,a));var l=this._modelMaxRaw=t.get("max",!0);if(li(l)?this._modelMaxNum=ZE(e,l({min:r[0],max:r[1]})):l!=="dataMax"&&(this._modelMaxNum=ZE(e,l)),i)this._axisDataLen=t.getCategories().length;else{var o=t.get("boundaryGap"),h=fr(o)?o:[o||0,o||0];typeof h[0]=="boolean"||typeof h[1]=="boolean"?this._boundaryGapInner=[0,0]:this._boundaryGapInner=[dv(h[0],1),dv(h[1],1)]}},n.prototype.calculate=function(){var e=this._isOrdinal,t=this._dataMin,r=this._dataMax,i=this._axisDataLen,s=this._boundaryGapInner,a=e?null:r-t||Math.abs(t),l=this._modelMinRaw==="dataMin"?t:this._modelMinNum,o=this._modelMaxRaw==="dataMax"?r:this._modelMaxNum,h=l!=null,d=o!=null;l==null&&(l=e?i?0:NaN:t-s[0]*a),o==null&&(o=e?i?i-1:NaN:r+s[1]*a),(l==null||!isFinite(l))&&(l=NaN),(o==null||!isFinite(o))&&(o=NaN);var m=oP(l)||oP(o)||e&&!i;this._needCrossZero&&(l>0&&o>0&&!h&&(l=0),l<0&&o<0&&!d&&(o=0));var _=this._determinedMin,y=this._determinedMax;return _!=null&&(l=_,h=!0),y!=null&&(o=y,d=!0),{min:l,max:o,minFixed:h,maxFixed:d,isBlank:m}},n.prototype.modifyDataMinMax=function(e,t){this[mLe[e]]=t},n.prototype.setDeterminedMinMax=function(e,t){var r=pLe[e];this[r]=t},n.prototype.freeze=function(){this.frozen=!0},n}(),pLe={min:"_determinedMin",max:"_determinedMax"},mLe={min:"_dataMin",max:"_dataMax"};function coe(n,e,t){var r=n.rawExtentInfo;return r||(r=new dLe(n,e,t),n.rawExtentInfo=r,r)}function ZE(n,e){return e==null?null:oP(e)?NaN:n.parse(e)}function uoe(n,e){var t=n.type,r=coe(n,e,n.getExtent()).calculate();n.setBlank(r.isBlank);var i=r.min,s=r.max,a=e.ecModel;if(a&&t==="time"){var l=roe("bar",a),o=!1;if(it(l,function(m){o=o||m.getBaseAxis()===e.axis}),o){var h=ioe(l),d=gLe(i,s,e,h);i=d.min,s=d.max}}return{extent:[i,s],fixMin:r.minFixed,fixMax:r.maxFixed}}function gLe(n,e,t,r){var i=t.axis.getExtent(),s=i[1]-i[0],a=JPe(r,t.axis);if(a===void 0)return{min:n,max:e};var l=1/0;it(a,function(y){l=Math.min(y.offset,l)});var o=-1/0;it(a,function(y){o=Math.max(y.offset+y.width,o)}),l=Math.abs(l),o=Math.abs(o);var h=l+o,d=e-n,m=1-(l+o)/s,_=d/m-d;return e+=_*(o/h),n-=_*(l/h),{min:n,max:e}}function LP(n,e){var t=e,r=uoe(n,t),i=r.extent,s=t.get("splitNumber");n instanceof HU&&(n.base=t.get("logBase"));var a=n.type,l=t.get("interval"),o=a==="interval"||a==="time";n.setExtent(i[0],i[1]),n.calcNiceExtent({splitNumber:s,fixMin:r.fixMin,fixMax:r.fixMax,minInterval:o?t.get("minInterval"):null,maxInterval:o?t.get("maxInterval"):null}),l!=null&&n.setInterval&&n.setInterval(l)}function hoe(n,e){if(e=e||n.get("type"),e)switch(e){case"category":return new UU({ordinalMeta:n.getOrdinalMeta?n.getOrdinalMeta():n.getCategories(),extent:[1/0,-1/0]});case"time":return new aoe({locale:n.ecModel.getLocaleModel(),useUTC:n.ecModel.get("useUTC")});default:return new(_p.getClass(e)||Sw)}}function vLe(n){var e=n.scale.getExtent(),t=e[0],r=e[1];return!(t>0&&r>0||t<0&&r<0)}function Aw(n){var e=n.getLabelModel().get("formatter"),t=n.type==="category"?n.scale.getExtent()[0]:null;return n.scale.type==="time"?function(r){return function(i,s){return n.scale.getFormattedLabel(i,s,r)}}(e):Dr(e)?function(r){return function(i){var s=n.scale.getLabel(i),a=r.replace("{value}",s??"");return a}}(e):li(e)?function(r){return function(i,s){return t!=null&&(s=i.value-t),r(jU(n,i),s,i.level!=null?{level:i.level}:null)}}(e):function(r){return n.scale.getLabel(r)}}function jU(n,e){return n.type==="category"?n.scale.getLabel(e):e.value}function _Le(n){var e=n.model,t=n.scale;if(!(!e.get(["axisLabel","show"])||t.isBlank())){var r,i,s=t.getExtent();t instanceof UU?i=t.count():(r=t.getTicks(),i=r.length);var a=n.getLabelModel(),l=Aw(n),o,h=1;i>40&&(h=Math.ceil(i/40));for(var d=0;d<i;d+=h){var m=r?r[d]:{value:s[0]+d},_=l(m,d),y=a.getTextRect(_),T=yLe(y,a.get("rotate")||0);o?o.union(T):o=T}return o}}function yLe(n,e){var t=e*Math.PI/180,r=n.width,i=n.height,s=r*Math.abs(Math.cos(t))+Math.abs(i*Math.sin(t)),a=r*Math.abs(Math.sin(t))+Math.abs(i*Math.cos(t)),l=new as(n.x,n.y,s,a);return l}function WU(n){var e=n.get("interval");return e??"auto"}function foe(n){return n.type==="category"&&WU(n.getLabelModel())===0}function DP(n,e){var t={};return it(n.mapDimensionsAll(e),function(r){t[zPe(n,r)]=!0}),io(t)}function xLe(n,e,t){e&&it(DP(e,t),function(r){var i=e.getApproximateExtent(r);i[0]<n[0]&&(n[0]=i[0]),i[1]>n[1]&&(n[1]=i[1])})}var doe=function(){function n(){}return n.prototype.getNeedCrossZero=function(){var e=this.option;return!e.scale},n.prototype.getCoordSysModel=function(){},n}(),Fq=[],bLe={registerPreprocessor:Wse,registerProcessor:Xse,registerPostInit:mPe,registerPostUpdate:gPe,registerUpdateLifecycle:FU,registerAction:vp,registerCoordinateSystem:vPe,registerLayout:_Pe,registerVisual:_x,registerTransform:xPe,registerLoading:$se,registerMap:yPe,registerImpl:ZRe,PRIORITY:lPe,ComponentModel:is,ComponentView:Rc,SeriesModel:Zf,ChartView:Mh,registerComponentModel:function(n){is.registerClass(n)},registerComponentView:function(n){Rc.registerClass(n)},registerSeriesModel:function(n){Zf.registerClass(n)},registerChartView:function(n){Mh.registerClass(n)},registerSubTypeDefaulter:function(n,e){is.registerSubTypeDefaulter(n,e)},registerPainter:function(n,e){CTe(n,e)}};function fp(n){if(fr(n)){it(n,function(e){fp(e)});return}Wi(Fq,n)>=0||(Fq.push(n),li(n)&&(n={install:n}),n.install(bLe))}var aT=Xs();function poe(n,e){var t=xr(e,function(r){return n.scale.parse(r)});return n.type==="time"&&t.length>0&&(t.sort(),t.unshift(t[0]),t.push(t[t.length-1])),t}function wLe(n){var e=n.getLabelModel().get("customValues");if(e){var t=Aw(n);return{labels:poe(n,e).map(function(r){var i={value:r};return{formattedLabel:t(i),rawLabel:n.scale.getLabel(i),tickValue:r}})}}return n.type==="category"?ALe(n):MLe(n)}function SLe(n,e){var t=n.getTickModel().get("customValues");return t?{ticks:poe(n,t)}:n.type==="category"?TLe(n,e):{ticks:xr(n.scale.getTicks(),function(r){return r.value})}}function ALe(n){var e=n.getLabelModel(),t=moe(n,e);return!e.get("show")||n.scale.isBlank()?{labels:[],labelCategoryInterval:t.labelCategoryInterval}:t}function moe(n,e){var t=goe(n,"labels"),r=WU(e),i=voe(t,r);if(i)return i;var s,a;return li(r)?s=xoe(n,r):(a=r==="auto"?CLe(n):r,s=yoe(n,a)),_oe(t,r,{labels:s,labelCategoryInterval:a})}function TLe(n,e){var t=goe(n,"ticks"),r=WU(e),i=voe(t,r);if(i)return i;var s,a;if((!e.get("show")||n.scale.isBlank())&&(s=[]),li(r))s=xoe(n,r,!0);else if(r==="auto"){var l=moe(n,n.getLabelModel());a=l.labelCategoryInterval,s=xr(l.labels,function(o){return o.tickValue})}else a=r,s=yoe(n,a,!0);return _oe(t,r,{ticks:s,tickCategoryInterval:a})}function MLe(n){var e=n.scale.getTicks(),t=Aw(n);return{labels:xr(e,function(r,i){return{level:r.level,formattedLabel:t(r,i),rawLabel:n.scale.getLabel(r),tickValue:r.value}})}}function goe(n,e){return aT(n)[e]||(aT(n)[e]=[])}function voe(n,e){for(var t=0;t<n.length;t++)if(n[t].key===e)return n[t].value}function _oe(n,e,t){return n.push({key:e,value:t}),t}function CLe(n){var e=aT(n).autoInterval;return e??(aT(n).autoInterval=n.calculateCategoryInterval())}function ELe(n){var e=ILe(n),t=Aw(n),r=(e.axisRotate-e.labelRotate)/180*Math.PI,i=n.scale,s=i.getExtent(),a=i.count();if(s[1]-s[0]<1)return 0;var l=1;a>40&&(l=Math.max(1,Math.floor(a/40)));for(var o=s[0],h=n.dataToCoord(o+1)-n.dataToCoord(o),d=Math.abs(h*Math.cos(r)),m=Math.abs(h*Math.sin(r)),_=0,y=0;o<=s[1];o+=l){var T=0,I=0,C=YT(t({value:o}),e.font,"center","top");T=C.width*1.3,I=C.height*1.3,_=Math.max(_,T,7),y=Math.max(y,I,7)}var M=_/d,B=y/m;isNaN(M)&&(M=1/0),isNaN(B)&&(B=1/0);var k=Math.max(0,Math.floor(Math.min(M,B))),j=aT(n.model),q=n.getExtent(),Z=j.lastAutoInterval,te=j.lastTickCount;return Z!=null&&te!=null&&Math.abs(Z-k)<=1&&Math.abs(te-a)<=1&&Z>k&&j.axisExtent0===q[0]&&j.axisExtent1===q[1]?k=Z:(j.lastTickCount=a,j.lastAutoInterval=k,j.axisExtent0=q[0],j.axisExtent1=q[1]),k}function ILe(n){var e=n.getLabelModel();return{axisRotate:n.getRotate?n.getRotate():n.isHorizontal&&!n.isHorizontal()?90:0,labelRotate:e.get("rotate")||0,font:e.getFont()}}function yoe(n,e,t){var r=Aw(n),i=n.scale,s=i.getExtent(),a=n.getLabelModel(),l=[],o=Math.max((e||0)+1,1),h=s[0],d=i.count();h!==0&&o>1&&d/o>2&&(h=Math.round(Math.ceil(h/o)*o));var m=foe(n),_=a.get("showMinLabel")||m,y=a.get("showMaxLabel")||m;_&&h!==s[0]&&I(s[0]);for(var T=h;T<=s[1];T+=o)I(T);y&&T-o!==s[1]&&I(s[1]);function I(C){var M={value:C};l.push(t?C:{formattedLabel:r(M),rawLabel:i.getLabel(M),tickValue:C})}return l}function xoe(n,e,t){var r=n.scale,i=Aw(n),s=[];return it(r.getTicks(),function(a){var l=r.getLabel(a),o=a.value;e(a.value,l)&&s.push(t?o:{formattedLabel:i(a),rawLabel:l,tickValue:o})}),s}var Nq=[0,1],yx=function(){function n(e,t,r){this.onBand=!1,this.inverse=!1,this.dim=e,this.scale=t,this._extent=r||[0,0]}return n.prototype.contain=function(e){var t=this._extent,r=Math.min(t[0],t[1]),i=Math.max(t[0],t[1]);return e>=r&&e<=i},n.prototype.containData=function(e){return this.scale.contain(e)},n.prototype.getExtent=function(){return this._extent.slice()},n.prototype.getPixelPrecision=function(e){return bre(e||this.scale.getExtent(),this._extent)},n.prototype.setExtent=function(e,t){var r=this._extent;r[0]=e,r[1]=t},n.prototype.dataToCoord=function(e,t){var r=this._extent,i=this.scale;return e=i.normalize(e),this.onBand&&i.type==="ordinal"&&(r=r.slice(),zq(r,i.count())),B0(e,Nq,r,t)},n.prototype.coordToData=function(e,t){var r=this._extent,i=this.scale;this.onBand&&i.type==="ordinal"&&(r=r.slice(),zq(r,i.count()));var s=B0(e,r,Nq,t);return this.scale.scale(s)},n.prototype.pointToData=function(e,t){},n.prototype.getTicksCoords=function(e){e=e||{};var t=e.tickModel||this.getTickModel(),r=SLe(this,t),i=r.ticks,s=xr(i,function(l){return{coord:this.dataToCoord(this.scale.type==="ordinal"?this.scale.getRawOrdinalNumber(l):l),tickValue:l}},this),a=t.get("alignWithLabel");return RLe(this,s,a,e.clamp),s},n.prototype.getMinorTicksCoords=function(){if(this.scale.type==="ordinal")return[];var e=this.model.getModel("minorTick"),t=e.get("splitNumber");t>0&&t<100||(t=5);var r=this.scale.getMinorTicks(t),i=xr(r,function(s){return xr(s,function(a){return{coord:this.dataToCoord(a),tickValue:a}},this)},this);return i},n.prototype.getViewLabels=function(){return wLe(this).labels},n.prototype.getLabelModel=function(){return this.model.getModel("axisLabel")},n.prototype.getTickModel=function(){return this.model.getModel("axisTick")},n.prototype.getBandWidth=function(){var e=this._extent,t=this.scale.getExtent(),r=t[1]-t[0]+(this.onBand?1:0);r===0&&(r=1);var i=Math.abs(e[1]-e[0]);return Math.abs(i)/r},n.prototype.calculateCategoryInterval=function(){return ELe(this)},n}();function zq(n,e){var t=n[1]-n[0],r=e,i=t/r/2;n[0]+=i,n[1]-=i}function RLe(n,e,t,r){var i=e.length;if(!n.onBand||t||!i)return;var s=n.getExtent(),a,l;if(i===1)e[0].coord=s[0],a=e[1]={coord:s[1]};else{var o=e[i-1].tickValue-e[0].tickValue,h=(e[i-1].coord-e[0].coord)/o;it(e,function(y){y.coord-=h/2});var d=n.scale.getExtent();l=1+d[1]-e[i-1].tickValue,a={coord:e[i-1].coord+h*l},e.push(a)}var m=s[0]>s[1];_(e[0].coord,s[0])&&(r?e[0].coord=s[0]:e.shift()),r&&_(s[0],e[0].coord)&&e.unshift({coord:s[0]}),_(s[1],a.coord)&&(r?a.coord=s[1]:e.pop()),r&&_(a.coord,s[1])&&e.push({coord:s[1]});function _(y,T){return y=Sa(y),T=Sa(T),m?y>T:y<T}}var J2=Math.PI*2,Z_=Zm.CMD,PLe=["top","right","bottom","left"];function LLe(n,e,t,r,i){var s=t.width,a=t.height;switch(n){case"top":r.set(t.x+s/2,t.y-e),i.set(0,-1);break;case"bottom":r.set(t.x+s/2,t.y+a+e),i.set(0,1);break;case"left":r.set(t.x-e,t.y+a/2),i.set(-1,0);break;case"right":r.set(t.x+s+e,t.y+a/2),i.set(1,0);break}}function DLe(n,e,t,r,i,s,a,l,o){a-=n,l-=e;var h=Math.sqrt(a*a+l*l);a/=h,l/=h;var d=a*t+n,m=l*t+e;if(Math.abs(r-i)%J2<1e-4)return o[0]=d,o[1]=m,h-t;if(s){var _=r;r=Em(i),i=Em(_)}else r=Em(r),i=Em(i);r>i&&(i+=J2);var y=Math.atan2(l,a);if(y<0&&(y+=J2),y>=r&&y<=i||y+J2>=r&&y+J2<=i)return o[0]=d,o[1]=m,h-t;var T=t*Math.cos(r)+n,I=t*Math.sin(r)+e,C=t*Math.cos(i)+n,M=t*Math.sin(i)+e,B=(T-a)*(T-a)+(I-l)*(I-l),k=(C-a)*(C-a)+(M-l)*(M-l);return B<k?(o[0]=T,o[1]=I,Math.sqrt(B)):(o[0]=C,o[1]=M,Math.sqrt(k))}function BP(n,e,t,r,i,s,a,l){var o=i-n,h=s-e,d=t-n,m=r-e,_=Math.sqrt(d*d+m*m);d/=_,m/=_;var y=o*d+h*m,T=y/_;l&&(T=Math.min(Math.max(T,0),1)),T*=_;var I=a[0]=n+T*d,C=a[1]=e+T*m;return Math.sqrt((I-i)*(I-i)+(C-s)*(C-s))}function boe(n,e,t,r,i,s,a){t<0&&(n=n+t,t=-t),r<0&&(e=e+r,r=-r);var l=n+t,o=e+r,h=a[0]=Math.min(Math.max(i,n),l),d=a[1]=Math.min(Math.max(s,e),o);return Math.sqrt((h-i)*(h-i)+(d-s)*(d-s))}var Lf=[];function BLe(n,e,t){var r=boe(e.x,e.y,e.width,e.height,n.x,n.y,Lf);return t.set(Lf[0],Lf[1]),r}function kLe(n,e,t){for(var r=0,i=0,s=0,a=0,l,o,h=1/0,d=e.data,m=n.x,_=n.y,y=0;y<d.length;){var T=d[y++];y===1&&(r=d[y],i=d[y+1],s=r,a=i);var I=h;switch(T){case Z_.M:s=d[y++],a=d[y++],r=s,i=a;break;case Z_.L:I=BP(r,i,d[y],d[y+1],m,_,Lf,!0),r=d[y++],i=d[y++];break;case Z_.C:I=cre(r,i,d[y++],d[y++],d[y++],d[y++],d[y],d[y+1],m,_,Lf),r=d[y++],i=d[y++];break;case Z_.Q:I=hre(r,i,d[y++],d[y++],d[y],d[y+1],m,_,Lf),r=d[y++],i=d[y++];break;case Z_.A:var C=d[y++],M=d[y++],B=d[y++],k=d[y++],j=d[y++],q=d[y++];y+=1;var Z=!!(1-d[y++]);l=Math.cos(j)*B+C,o=Math.sin(j)*k+M,y<=1&&(s=l,a=o);var te=(m-C)*k/B+C;I=DLe(C,M,k,j,j+q,Z,te,_,Lf),r=Math.cos(j+q)*B+C,i=Math.sin(j+q)*k+M;break;case Z_.R:s=r=d[y++],a=i=d[y++];var ie=d[y++],se=d[y++];I=boe(s,a,ie,se,m,_,Lf);break;case Z_.Z:I=BP(r,i,s,a,m,_,Lf,!0),r=s,i=a;break}I<h&&(h=I,t.set(Lf[0],Lf[1]))}return h}var zf=new Jr,ks=new Jr,Qo=new Jr,ep=new Jr,Zd=new Jr;function Uq(n,e){if(n){var t=n.getTextGuideLine(),r=n.getTextContent();if(r&&t){var i=n.textGuideLineConfig||{},s=[[0,0],[0,0],[0,0]],a=i.candidates||PLe,l=r.getBoundingRect().clone();l.applyTransform(r.getComputedTransform());var o=1/0,h=i.anchor,d=n.getComputedTransform(),m=d&&cD([],d),_=e.get("length2")||0;h&&Qo.copy(h);for(var y=0;y<a.length;y++){var T=a[y];LLe(T,0,l,zf,ep),Jr.scaleAndAdd(ks,zf,ep,_),ks.transform(m);var I=n.getBoundingRect(),C=h?h.distance(ks):n instanceof Xi?kLe(ks,n.path,Qo):BLe(ks,I,Qo);C<o&&(o=C,ks.transform(d),Qo.transform(d),Qo.toArray(s[0]),ks.toArray(s[1]),zf.toArray(s[2]))}woe(s,e.get("minTurnAngle")),t.setShape({points:s})}}}var kP=[],xc=new Jr;function woe(n,e){if(e<=180&&e>0){e=e/180*Math.PI,zf.fromArray(n[0]),ks.fromArray(n[1]),Qo.fromArray(n[2]),Jr.sub(ep,zf,ks),Jr.sub(Zd,Qo,ks);var t=ep.len(),r=Zd.len();if(!(t<.001||r<.001)){ep.scale(1/t),Zd.scale(1/r);var i=ep.dot(Zd),s=Math.cos(e);if(s<i){var a=BP(ks.x,ks.y,Qo.x,Qo.y,zf.x,zf.y,kP,!1);xc.fromArray(kP),xc.scaleAndAdd(Zd,a/Math.tan(Math.PI-e));var l=Qo.x!==ks.x?(xc.x-ks.x)/(Qo.x-ks.x):(xc.y-ks.y)/(Qo.y-ks.y);if(isNaN(l))return;l<0?Jr.copy(xc,ks):l>1&&Jr.copy(xc,Qo),xc.toArray(n[1])}}}}function OLe(n,e,t){if(t<=180&&t>0){t=t/180*Math.PI,zf.fromArray(n[0]),ks.fromArray(n[1]),Qo.fromArray(n[2]),Jr.sub(ep,ks,zf),Jr.sub(Zd,Qo,ks);var r=ep.len(),i=Zd.len();if(!(r<.001||i<.001)){ep.scale(1/r),Zd.scale(1/i);var s=ep.dot(e),a=Math.cos(t);if(s<a){var l=BP(ks.x,ks.y,Qo.x,Qo.y,zf.x,zf.y,kP,!1);xc.fromArray(kP);var o=Math.PI/2,h=Math.acos(Zd.dot(e)),d=o+h-t;if(d>=o)Jr.copy(xc,Qo);else{xc.scaleAndAdd(Zd,l/Math.tan(Math.PI/2-d));var m=Qo.x!==ks.x?(xc.x-ks.x)/(Qo.x-ks.x):(xc.y-ks.y)/(Qo.y-ks.y);if(isNaN(m))return;m<0?Jr.copy(xc,ks):m>1&&Jr.copy(xc,Qo)}xc.toArray(n[1])}}}}function JB(n,e,t,r){var i=t==="normal",s=i?n:n.ensureState(t);s.ignore=e;var a=r.get("smooth");a&&a===!0&&(a=.3),s.shape=s.shape||{},a>0&&(s.shape.smooth=a);var l=r.getModel("lineStyle").getLineStyle();i?n.useStyle(l):s.style=l}function FLe(n,e){var t=e.smooth,r=e.points;if(r)if(n.moveTo(r[0][0],r[0][1]),t>0&&r.length>=3){var i=xF(r[0],r[1]),s=xF(r[1],r[2]);if(!i||!s){n.lineTo(r[1][0],r[1][1]),n.lineTo(r[2][0],r[2][1]);return}var a=Math.min(i,s)*t,l=DI([],r[1],r[0],a/i),o=DI([],r[1],r[2],a/s),h=DI([],l,o,.5);n.bezierCurveTo(l[0],l[1],l[0],l[1],h[0],h[1]),n.bezierCurveTo(o[0],o[1],o[0],o[1],r[2][0],r[2][1])}else for(var d=1;d<r.length;d++)n.lineTo(r[d][0],r[d][1])}function Soe(n,e,t){var r=n.getTextGuideLine(),i=n.getTextContent();if(!i){r&&n.removeTextGuideLine();return}for(var s=e.normal,a=s.get("show"),l=i.ignore,o=0;o<_P.length;o++){var h=_P[o],d=e[h],m=h==="normal";if(d){var _=d.get("show"),y=m?l:Ci(i.states[h]&&i.states[h].ignore,l);if(y||!Ci(_,a)){var T=m?r:r&&r.states[h];T&&(T.ignore=!0),r&&JB(r,!0,h,d);continue}r||(r=new xw,n.setTextGuideLine(r),!m&&(l||!a)&&JB(r,!0,"normal",e.normal),n.stateProxy&&(r.stateProxy=n.stateProxy)),JB(r,!1,h,d)}}if(r){ti(r.style,t),r.style.fill=null;var I=s.get("showAbove"),C=n.textGuideLineConfig=n.textGuideLineConfig||{};C.showAbove=I||!1,r.buildPath=FLe}}function Aoe(n,e){e=e||"labelLine";for(var t={normal:n.getModel(e)},r=0;r<Lh.length;r++){var i=Lh[r];t[i]=n.getModel([i,e])}return t}function Toe(n){for(var e=[],t=0;t<n.length;t++){var r=n[t];if(!r.defaultAttr.ignore){var i=r.label,s=i.getComputedTransform(),a=i.getBoundingRect(),l=!s||s[1]<1e-5&&s[2]<1e-5,o=i.style.margin||0,h=a.clone();h.applyTransform(s),h.x-=o/2,h.y-=o/2,h.width+=o,h.height+=o;var d=l?new xP(a,s):null;e.push({label:i,labelLine:r.labelLine,rect:h,localRect:a,obb:d,priority:r.priority,defaultAttr:r.defaultAttr,layoutOption:r.computedLayoutOption,axisAligned:l,transform:s})}}return e}function Moe(n,e,t,r,i,s){var a=n.length;if(a<2)return;n.sort(function(ie,se){return ie.rect[e]-se.rect[e]});for(var l=0,o,h=!1,d=0,m=0;m<a;m++){var _=n[m],y=_.rect;o=y[e]-l,o<0&&(y[e]-=o,_.label[e]-=o,h=!0);var T=Math.max(-o,0);d+=T,l=y[e]+y[t]}d>0&&s&&q(-d/a,0,a);var I=n[0],C=n[a-1],M,B;k(),M<0&&Z(-M,.8),B<0&&Z(B,.8),k(),j(M,B,1),j(B,M,-1),k(),M<0&&te(-M),B<0&&te(B);function k(){M=I.rect[e]-r,B=i-C.rect[e]-C.rect[t]}function j(ie,se,ae){if(ie<0){var fe=Math.min(se,-ie);if(fe>0){q(fe*ae,0,a);var Se=fe+ie;Se<0&&Z(-Se*ae,1)}else Z(-ie*ae,1)}}function q(ie,se,ae){ie!==0&&(h=!0);for(var fe=se;fe<ae;fe++){var Se=n[fe],Ee=Se.rect;Ee[e]+=ie,Se.label[e]+=ie}}function Z(ie,se){for(var ae=[],fe=0,Se=1;Se<a;Se++){var Ee=n[Se-1].rect,Re=Math.max(n[Se].rect[e]-Ee[e]-Ee[t],0);ae.push(Re),fe+=Re}if(fe){var qe=Math.min(Math.abs(ie)/fe,se);if(ie>0)for(var Se=0;Se<a-1;Se++){var Le=ae[Se]*qe;q(Le,0,Se+1)}else for(var Se=a-1;Se>0;Se--){var Le=ae[Se-1]*qe;q(-Le,Se,a)}}}function te(ie){var se=ie<0?-1:1;ie=Math.abs(ie);for(var ae=Math.ceil(ie/(a-1)),fe=0;fe<a-1;fe++)if(se>0?q(ae,0,fe+1):q(-ae,a-fe-1,a),ie-=ae,ie<=0)return}return h}function NLe(n,e,t,r){return Moe(n,"x","width",e,t,r)}function Coe(n,e,t,r){return Moe(n,"y","height",e,t,r)}function Eoe(n){var e=[];n.sort(function(I,C){return C.priority-I.priority});var t=new as(0,0,0,0);function r(I){if(!I.ignore){var C=I.ensureState("emphasis");C.ignore==null&&(C.ignore=!1)}I.ignore=!0}for(var i=0;i<n.length;i++){var s=n[i],a=s.axisAligned,l=s.localRect,o=s.transform,h=s.label,d=s.labelLine;t.copy(s.rect),t.width-=.1,t.height-=.1,t.x+=.05,t.y+=.05;for(var m=s.obb,_=!1,y=0;y<e.length;y++){var T=e[y];if(t.intersect(T.rect)){if(a&&T.axisAligned){_=!0;break}if(T.obb||(T.obb=new xP(T.localRect,T.transform)),m||(m=new xP(l,o)),m.intersect(T.obb)){_=!0;break}}}_?(r(h),d&&r(d)):(h.attr("ignore",s.defaultAttr.ignore),d&&d.attr("ignore",s.defaultAttr.labelGuideIgnore),e.push(s))}}function zLe(n){if(n){for(var e=[],t=0;t<n.length;t++)e.push(n[t].slice());return e}}function ULe(n,e){var t=n.label,r=e&&e.getTextGuideLine();return{dataIndex:n.dataIndex,dataType:n.dataType,seriesIndex:n.seriesModel.seriesIndex,text:n.label.style.text,rect:n.hostRect,labelRect:n.rect,align:t.style.align,verticalAlign:t.style.verticalAlign,labelLinePoints:zLe(r&&r.shape.points)}}var Vq=["align","verticalAlign","width","height","fontSize"],mc=new ZT,QB=Xs(),VLe=Xs();function YE(n,e,t){for(var r=0;r<t.length;r++){var i=t[r];e[i]!=null&&(n[i]=e[i])}}var KE=["x","y","rotation"],GLe=function(){function n(){this._labelList=[],this._chartViewList=[]}return n.prototype.clearLabels=function(){this._labelList=[],this._chartViewList=[]},n.prototype._addLabel=function(e,t,r,i,s){var a=i.style,l=i.__hostTarget,o=l.textConfig||{},h=i.getComputedTransform(),d=i.getBoundingRect().plain();as.applyTransform(d,d,h),h?mc.setLocalTransform(h):(mc.x=mc.y=mc.rotation=mc.originX=mc.originY=0,mc.scaleX=mc.scaleY=1),mc.rotation=Em(mc.rotation);var m=i.__hostTarget,_;if(m){_=m.getBoundingRect().plain();var y=m.getComputedTransform();as.applyTransform(_,_,y)}var T=_&&m.getTextGuideLine();this._labelList.push({label:i,labelLine:T,seriesModel:r,dataIndex:e,dataType:t,layoutOption:s,computedLayoutOption:null,rect:d,hostRect:_,priority:_?_.width*_.height:0,defaultAttr:{ignore:i.ignore,labelGuideIgnore:T&&T.ignore,x:mc.x,y:mc.y,scaleX:mc.scaleX,scaleY:mc.scaleY,rotation:mc.rotation,style:{x:a.x,y:a.y,align:a.align,verticalAlign:a.verticalAlign,width:a.width,height:a.height,fontSize:a.fontSize},cursor:i.cursor,attachedPos:o.position,attachedRot:o.rotation}})},n.prototype.addLabelsOfSeries=function(e){var t=this;this._chartViewList.push(e);var r=e.__model,i=r.get("labelLayout");(li(i)||io(i).length)&&e.group.traverse(function(s){if(s.ignore)return!0;var a=s.getTextContent(),l=ji(s);a&&!a.disableLabelLayout&&t._addLabel(l.dataIndex,l.dataType,r,a,i)})},n.prototype.updateLayoutConfig=function(e){var t=e.getWidth(),r=e.getHeight();function i(k,j){return function(){Uq(k,j)}}for(var s=0;s<this._labelList.length;s++){var a=this._labelList[s],l=a.label,o=l.__hostTarget,h=a.defaultAttr,d=void 0;li(a.layoutOption)?d=a.layoutOption(ULe(a,o)):d=a.layoutOption,d=d||{},a.computedLayoutOption=d;var m=Math.PI/180;o&&o.setTextConfig({local:!1,position:d.x!=null||d.y!=null?null:h.attachedPos,rotation:d.rotate!=null?d.rotate*m:h.attachedRot,offset:[d.dx||0,d.dy||0]});var _=!1;if(d.x!=null?(l.x=os(d.x,t),l.setStyle("x",0),_=!0):(l.x=h.x,l.setStyle("x",h.style.x)),d.y!=null?(l.y=os(d.y,r),l.setStyle("y",0),_=!0):(l.y=h.y,l.setStyle("y",h.style.y)),d.labelLinePoints){var y=o.getTextGuideLine();y&&(y.setShape({points:d.labelLinePoints}),_=!1)}var T=QB(l);T.needsUpdateLabelLine=_,l.rotation=d.rotate!=null?d.rotate*m:h.rotation,l.scaleX=h.scaleX,l.scaleY=h.scaleY;for(var I=0;I<Vq.length;I++){var C=Vq[I];l.setStyle(C,d[C]!=null?d[C]:h.style[C])}if(d.draggable){if(l.draggable=!0,l.cursor="move",o){var M=a.seriesModel;if(a.dataIndex!=null){var B=a.seriesModel.getData(a.dataType);M=B.getItemModel(a.dataIndex)}l.on("drag",i(o,M.getModel("labelLine")))}}else l.off("drag"),l.cursor=h.cursor}},n.prototype.layout=function(e){var t=e.getWidth(),r=e.getHeight(),i=Toe(this._labelList),s=ta(i,function(o){return o.layoutOption.moveOverlap==="shiftX"}),a=ta(i,function(o){return o.layoutOption.moveOverlap==="shiftY"});NLe(s,0,t),Coe(a,0,r);var l=ta(i,function(o){return o.layoutOption.hideOverlap});Eoe(l)},n.prototype.processLabelsOverall=function(){var e=this;it(this._chartViewList,function(t){var r=t.__model,i=t.ignoreLabelLineUpdate,s=r.isAnimationEnabled();t.group.traverse(function(a){if(a.ignore&&!a.forceLabelAnimation)return!0;var l=!i,o=a.getTextContent();!l&&o&&(l=QB(o).needsUpdateLabelLine),l&&e._updateLabelLine(a,r),s&&e._animateLabels(a,r)})})},n.prototype._updateLabelLine=function(e,t){var r=e.getTextContent(),i=ji(e),s=i.dataIndex;if(r&&s!=null){var a=t.getData(i.dataType),l=a.getItemModel(s),o={},h=a.getItemVisual(s,"style");if(h){var d=a.getVisual("drawType");o.stroke=h[d]}var m=l.getModel("labelLine");Soe(e,Aoe(l),o),Uq(e,m)}},n.prototype._animateLabels=function(e,t){var r=e.getTextContent(),i=e.getTextGuideLine();if(r&&(e.forceLabelAnimation||!r.ignore&&!r.invisible&&!e.disableLabelAnimation&&!Rb(e))){var s=QB(r),a=s.oldLayout,l=ji(e),o=l.dataIndex,h={x:r.x,y:r.y,rotation:r.rotation},d=t.getData(l.dataType);if(a){r.attr(a);var _=e.prevStates;_&&(Wi(_,"select")>=0&&r.attr(s.oldLayoutSelect),Wi(_,"emphasis")>=0&&r.attr(s.oldLayoutEmphasis)),sl(r,h,t,o)}else if(r.attr(h),!bw(r).valueAnimation){var m=Ci(r.style.opacity,1);r.style.opacity=0,$l(r,{style:{opacity:m}},t,o)}if(s.oldLayout=h,r.states.select){var y=s.oldLayoutSelect={};YE(y,h,KE),YE(y,r.states.select,KE)}if(r.states.emphasis){var T=s.oldLayoutEmphasis={};YE(T,h,KE),YE(T,r.states.emphasis,KE)}lEe(r,o,d,t,t)}if(i&&!i.ignore&&!i.invisible){var s=VLe(i),a=s.oldLayout,I={points:i.shape.points};a?(i.attr({shape:a}),sl(i,{shape:I},t)):(i.setShape(I),i.style.strokePercent=0,$l(i,{style:{strokePercent:1}},t)),s.oldLayout=I}},n}(),ek=Xs();function HLe(n){n.registerUpdateLifecycle("series:beforeupdate",function(e,t,r){var i=ek(t).labelManager;i||(i=ek(t).labelManager=new GLe),i.clearLabels()}),n.registerUpdateLifecycle("series:layoutlabels",function(e,t,r){var i=ek(t).labelManager;r.updatedSeries.forEach(function(s){i.addLabelsOfSeries(t.getViewOfSeriesModel(s))}),i.updateLayoutConfig(t),i.layout(t),i.processLabelsOverall()})}var jLe=function(n){Hn(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.type=e.type,t.hasSymbolVisual=!0,t}return e.prototype.getInitialData=function(t){return zU(null,this,{useEncodeDefaulter:!0})},e.prototype.getLegendIcon=function(t){var r=new pa,i=tw("line",0,t.itemHeight/2,t.itemWidth,0,t.lineStyle.stroke,!1);r.add(i),i.setStyle(t.lineStyle);var s=this.getData().getVisual("symbol"),a=this.getData().getVisual("symbolRotate"),l=s==="none"?"circle":s,o=t.itemHeight*.8,h=tw(l,(t.itemWidth-o)/2,(t.itemHeight-o)/2,o,o,t.itemStyle.fill);r.add(h),h.setStyle(t.itemStyle);var d=t.iconRotate==="inherit"?a:t.iconRotate||0;return h.rotation=d*Math.PI/180,h.setOrigin([t.itemWidth/2,t.itemHeight/2]),l.indexOf("empty")>-1&&(h.style.stroke=h.style.fill,h.style.fill="#fff",h.style.lineWidth=2),r},e.type="series.line",e.dependencies=["grid","polar"],e.defaultOption={z:3,coordinateSystem:"cartesian2d",legendHoverLink:!0,clip:!0,label:{position:"top"},endLabel:{show:!1,valueAnimation:!0,distance:8},lineStyle:{width:2,type:"solid"},emphasis:{scale:!0},step:!1,smooth:!1,smoothMonotone:null,symbol:"emptyCircle",symbolSize:4,symbolRotate:null,showSymbol:!0,showAllSymbol:"auto",connectNulls:!1,sampling:"none",animationEasing:"linear",progressive:0,hoverLayerThreshold:1/0,universalTransition:{divideShape:"clone"},triggerLineEvent:!1},e}(Zf);function XU(n,e){var t=n.mapDimensionsAll("defaultedLabel"),r=t.length;if(r===1){var i=ew(n,e,t[0]);return i!=null?i+"":null}else if(r){for(var s=[],a=0;a<t.length;a++)s.push(ew(n,e,t[a]));return s.join(" ")}}function Ioe(n,e){var t=n.mapDimensionsAll("defaultedLabel");if(!fr(e))return e+"";for(var r=[],i=0;i<t.length;i++){var s=n.getDimensionIndex(t[i]);s>=0&&r.push(e[s])}return r.join(" ")}var $U=function(n){Hn(e,n);function e(t,r,i,s){var a=n.call(this)||this;return a.updateData(t,r,i,s),a}return e.prototype._createSymbol=function(t,r,i,s,a){this.removeAll();var l=tw(t,-1,-1,2,2,null,a);l.attr({z2:100,culling:!0,scaleX:s[0]/2,scaleY:s[1]/2}),l.drift=WLe,this._symbolType=t,this.add(l)},e.prototype.stopSymbolAnimation=function(t){this.childAt(0).stopAnimation(null,t)},e.prototype.getSymbolType=function(){return this._symbolType},e.prototype.getSymbolPath=function(){return this.childAt(0)},e.prototype.highlight=function(){Kb(this.childAt(0))},e.prototype.downplay=function(){Jb(this.childAt(0))},e.prototype.setZ=function(t,r){var i=this.childAt(0);i.zlevel=t,i.z=r},e.prototype.setDraggable=function(t,r){var i=this.childAt(0);i.draggable=t,i.cursor=!r&&t?"move":i.cursor},e.prototype.updateData=function(t,r,i,s){this.silent=!1;var a=t.getItemVisual(r,"symbol")||"circle",l=t.hostModel,o=e.getSymbolSize(t,r),h=a!==this._symbolType,d=s&&s.disableAnimation;if(h){var m=t.getItemVisual(r,"symbolKeepAspect");this._createSymbol(a,t,r,o,m)}else{var _=this.childAt(0);_.silent=!1;var y={scaleX:o[0]/2,scaleY:o[1]/2};d?_.attr(y):sl(_,y,l,r),pU(_)}if(this._updateCommon(t,r,o,i,s),h){var _=this.childAt(0);if(!d){var y={scaleX:this._sizeX,scaleY:this._sizeY,style:{opacity:_.style.opacity}};_.scaleX=_.scaleY=0,_.style.opacity=0,$l(_,y,l,r)}}d&&this.childAt(0).stopAnimation("leave")},e.prototype._updateCommon=function(t,r,i,s,a){var l=this.childAt(0),o=t.hostModel,h,d,m,_,y,T,I,C,M;if(s&&(h=s.emphasisItemStyle,d=s.blurItemStyle,m=s.selectItemStyle,_=s.focus,y=s.blurScope,I=s.labelStatesModels,C=s.hoverScale,M=s.cursorStyle,T=s.emphasisDisabled),!s||t.hasItemOption){var B=s&&s.itemModel?s.itemModel:t.getItemModel(r),k=B.getModel("emphasis");h=k.getModel("itemStyle").getItemStyle(),m=B.getModel(["select","itemStyle"]).getItemStyle(),d=B.getModel(["blur","itemStyle"]).getItemStyle(),_=k.get("focus"),y=k.get("blurScope"),T=k.get("disabled"),I=eM(B),C=k.getShallow("scale"),M=B.getShallow("cursor")}var j=t.getItemVisual(r,"symbolRotate");l.attr("rotation",(j||0)*Math.PI/180||0);var q=Ase(t.getItemVisual(r,"symbolOffset"),i);q&&(l.x=q[0],l.y=q[1]),M&&l.attr("cursor",M);var Z=t.getItemVisual(r,"style"),te=Z.fill;if(l instanceof Lv){var ie=l.style;l.useStyle(Jn({image:ie.image,x:ie.x,y:ie.y,width:ie.width,height:ie.height},Z))}else l.__isEmptyBrush?l.useStyle(Jn({},Z)):l.useStyle(Z),l.style.decal=null,l.setColor(te,a&&a.symbolInnerColor),l.style.strokeNoScale=!0;var se=t.getItemVisual(r,"liftZ"),ae=this._z2;se!=null?ae==null&&(this._z2=l.z2,l.z2+=se):ae!=null&&(l.z2=ae,this._z2=null);var fe=a&&a.useNameLabel;QT(l,I,{labelFetcher:o,labelDataIndex:r,defaultText:Se,inheritColor:te,defaultOpacity:Z.opacity});function Se(qe){return fe?t.getName(qe):XU(t,qe)}this._sizeX=i[0]/2,this._sizeY=i[1]/2;var Ee=l.ensureState("emphasis");Ee.style=h,l.ensureState("select").style=m,l.ensureState("blur").style=d;var Re=C==null||C===!0?Math.max(1.1,3/this._sizeY):isFinite(C)&&C>0?+C:1;Ee.scaleX=this._sizeX*Re,Ee.scaleY=this._sizeY*Re,this.setSymbolScale(1),JA(this,_,y,T)},e.prototype.setSymbolScale=function(t){this.scaleX=this.scaleY=t},e.prototype.fadeOut=function(t,r,i){var s=this.childAt(0),a=ji(this).dataIndex,l=i&&i.animation;if(this.silent=s.silent=!0,i&&i.fadeLabel){var o=s.getTextContent();o&&bP(o,{style:{opacity:0}},r,{dataIndex:a,removeOpt:l,cb:function(){s.removeTextContent()}})}else s.removeTextContent();bP(s,{style:{opacity:0},scaleX:0,scaleY:0},r,{dataIndex:a,cb:t,removeOpt:l})},e.getSymbolSize=function(t,r){return LRe(t.getItemVisual(r,"symbolSize"))},e}(pa);function WLe(n,e){this.parent.drift(n,e)}function tk(n,e,t,r){return e&&!isNaN(e[0])&&!isNaN(e[1])&&!(r.isIgnore&&r.isIgnore(t))&&!(r.clipShape&&!r.clipShape.contain(e[0],e[1]))&&n.getItemVisual(t,"symbol")!=="none"}function Gq(n){return n!=null&&!Xr(n)&&(n={isIgnore:n}),n||{}}function Hq(n){var e=n.hostModel,t=e.getModel("emphasis");return{emphasisItemStyle:t.getModel("itemStyle").getItemStyle(),blurItemStyle:e.getModel(["blur","itemStyle"]).getItemStyle(),selectItemStyle:e.getModel(["select","itemStyle"]).getItemStyle(),focus:t.get("focus"),blurScope:t.get("blurScope"),emphasisDisabled:t.get("disabled"),hoverScale:t.get("scale"),labelStatesModels:eM(e),cursorStyle:e.get("cursor")}}var XLe=function(){function n(e){this.group=new pa,this._SymbolCtor=e||$U}return n.prototype.updateData=function(e,t){this._progressiveEls=null,t=Gq(t);var r=this.group,i=e.hostModel,s=this._data,a=this._SymbolCtor,l=t.disableAnimation,o=Hq(e),h={disableAnimation:l},d=t.getSymbolPoint||function(m){return e.getItemLayout(m)};s||r.removeAll(),e.diff(s).add(function(m){var _=d(m);if(tk(e,_,m,t)){var y=new a(e,m,o,h);y.setPosition(_),e.setItemGraphicEl(m,y),r.add(y)}}).update(function(m,_){var y=s.getItemGraphicEl(_),T=d(m);if(!tk(e,T,m,t)){r.remove(y);return}var I=e.getItemVisual(m,"symbol")||"circle",C=y&&y.getSymbolType&&y.getSymbolType();if(!y||C&&C!==I)r.remove(y),y=new a(e,m,o,h),y.setPosition(T);else{y.updateData(e,m,o,h);var M={x:T[0],y:T[1]};l?y.attr(M):sl(y,M,i)}r.add(y),e.setItemGraphicEl(m,y)}).remove(function(m){var _=s.getItemGraphicEl(m);_&&_.fadeOut(function(){r.remove(_)},i)}).execute(),this._getSymbolPoint=d,this._data=e},n.prototype.updateLayout=function(){var e=this,t=this._data;t&&t.eachItemGraphicEl(function(r,i){var s=e._getSymbolPoint(i);r.setPosition(s),r.markRedraw()})},n.prototype.incrementalPrepareUpdate=function(e){this._seriesScope=Hq(e),this._data=null,this.group.removeAll()},n.prototype.incrementalUpdate=function(e,t,r){this._progressiveEls=[],r=Gq(r);function i(o){o.isGroup||(o.incremental=!0,o.ensureState("emphasis").hoverLayer=!0)}for(var s=e.start;s<e.end;s++){var a=t.getItemLayout(s);if(tk(t,a,s,r)){var l=new this._SymbolCtor(t,s,this._seriesScope);l.traverse(i),l.setPosition(a),this.group.add(l),t.setItemGraphicEl(s,l),this._progressiveEls.push(l)}}},n.prototype.eachRendered=function(e){TD(this._progressiveEls||this.group,e)},n.prototype.remove=function(e){var t=this.group,r=this._data;r&&e?r.eachItemGraphicEl(function(i){i.fadeOut(function(){t.remove(i)},r.hostModel)}):t.removeAll()},n}();function Roe(n,e,t){var r=n.getBaseAxis(),i=n.getOtherAxis(r),s=$Le(i,t),a=r.dim,l=i.dim,o=e.mapDimension(l),h=e.mapDimension(a),d=l==="x"||l==="radius"?1:0,m=xr(n.dimensions,function(T){return e.mapDimension(T)}),_=!1,y=e.getCalculationInfo("stackResultDimension");return tx(e,m[0])&&(_=!0,m[0]=y),tx(e,m[1])&&(_=!0,m[1]=y),{dataDimsForPoint:m,valueStart:s,valueAxisDim:l,baseAxisDim:a,stacked:!!_,valueDim:o,baseDim:h,baseDataOffset:d,stackedOverDimension:e.getCalculationInfo("stackedOverDimension")}}function $Le(n,e){var t=0,r=n.scale.getExtent();return e==="start"?t=r[0]:e==="end"?t=r[1]:Is(e)&&!isNaN(e)?t=e:r[0]>0?t=r[0]:r[1]<0&&(t=r[1]),t}function Poe(n,e,t,r){var i=NaN;n.stacked&&(i=t.get(t.getCalculationInfo("stackedOverDimension"),r)),isNaN(i)&&(i=n.valueStart);var s=n.baseDataOffset,a=[];return a[s]=t.get(n.baseDim,r),a[1-s]=i,e.dataToPoint(a)}function qLe(n,e){var t=[];return e.diff(n).add(function(r){t.push({cmd:"+",idx:r})}).update(function(r,i){t.push({cmd:"=",idx:i,idx1:r})}).remove(function(r){t.push({cmd:"-",idx:r})}).execute(),t}function ZLe(n,e,t,r,i,s,a,l){for(var o=qLe(n,e),h=[],d=[],m=[],_=[],y=[],T=[],I=[],C=Roe(i,e,a),M=n.getLayout("points")||[],B=e.getLayout("points")||[],k=0;k<o.length;k++){var j=o[k],q=!0,Z=void 0,te=void 0;switch(j.cmd){case"=":Z=j.idx*2,te=j.idx1*2;var ie=M[Z],se=M[Z+1],ae=B[te],fe=B[te+1];(isNaN(ie)||isNaN(se))&&(ie=ae,se=fe),h.push(ie,se),d.push(ae,fe),m.push(t[Z],t[Z+1]),_.push(r[te],r[te+1]),I.push(e.getRawIndex(j.idx1));break;case"+":var Se=j.idx,Ee=C.dataDimsForPoint,Re=i.dataToPoint([e.get(Ee[0],Se),e.get(Ee[1],Se)]);te=Se*2,h.push(Re[0],Re[1]),d.push(B[te],B[te+1]);var qe=Poe(C,i,e,Se);m.push(qe[0],qe[1]),_.push(r[te],r[te+1]),I.push(e.getRawIndex(Se));break;case"-":q=!1}q&&(y.push(j),T.push(T.length))}T.sort(function(Ht,Qt){return I[Ht]-I[Qt]});for(var Le=h.length,dt=Im(Le),ye=Im(Le),Xe=Im(Le),He=Im(Le),_t=[],k=0;k<T.length;k++){var wt=T[k],Gt=k*2,at=wt*2;dt[Gt]=h[at],dt[Gt+1]=h[at+1],ye[Gt]=d[at],ye[Gt+1]=d[at+1],Xe[Gt]=m[at],Xe[Gt+1]=m[at+1],He[Gt]=_[at],He[Gt+1]=_[at+1],_t[k]=y[wt]}return{current:dt,next:ye,stackedOnCurrent:Xe,stackedOnNext:He,status:_t}}var y0=Math.min,x0=Math.max;function Oy(n,e){return isNaN(n)||isNaN(e)}function hN(n,e,t,r,i,s,a,l,o){for(var h,d,m,_,y,T,I=t,C=0;C<r;C++){var M=e[I*2],B=e[I*2+1];if(I>=i||I<0)break;if(Oy(M,B)){if(o){I+=s;continue}break}if(I===t)n[s>0?"moveTo":"lineTo"](M,B),m=M,_=B;else{var k=M-h,j=B-d;if(k*k+j*j<.5){I+=s;continue}if(a>0){for(var q=I+s,Z=e[q*2],te=e[q*2+1];Z===M&&te===B&&C<r;)C++,q+=s,I+=s,Z=e[q*2],te=e[q*2+1],M=e[I*2],B=e[I*2+1],k=M-h,j=B-d;var ie=C+1;if(o)for(;Oy(Z,te)&&ie<r;)ie++,q+=s,Z=e[q*2],te=e[q*2+1];var se=.5,ae=0,fe=0,Se=void 0,Ee=void 0;if(ie>=r||Oy(Z,te))y=M,T=B;else{ae=Z-h,fe=te-d;var Re=M-h,qe=Z-M,Le=B-d,dt=te-B,ye=void 0,Xe=void 0;if(l==="x"){ye=Math.abs(Re),Xe=Math.abs(qe);var He=ae>0?1:-1;y=M-He*ye*a,T=B,Se=M+He*Xe*a,Ee=B}else if(l==="y"){ye=Math.abs(Le),Xe=Math.abs(dt);var _t=fe>0?1:-1;y=M,T=B-_t*ye*a,Se=M,Ee=B+_t*Xe*a}else ye=Math.sqrt(Re*Re+Le*Le),Xe=Math.sqrt(qe*qe+dt*dt),se=Xe/(Xe+ye),y=M-ae*a*(1-se),T=B-fe*a*(1-se),Se=M+ae*a*se,Ee=B+fe*a*se,Se=y0(Se,x0(Z,M)),Ee=y0(Ee,x0(te,B)),Se=x0(Se,y0(Z,M)),Ee=x0(Ee,y0(te,B)),ae=Se-M,fe=Ee-B,y=M-ae*ye/Xe,T=B-fe*ye/Xe,y=y0(y,x0(h,M)),T=y0(T,x0(d,B)),y=x0(y,y0(h,M)),T=x0(T,y0(d,B)),ae=M-y,fe=B-T,Se=M+ae*Xe/ye,Ee=B+fe*Xe/ye}n.bezierCurveTo(m,_,y,T,M,B),m=Se,_=Ee}else n.lineTo(M,B)}h=M,d=B,I+=s}return C}var Loe=function(){function n(){this.smooth=0,this.smoothConstraint=!0}return n}(),YLe=function(n){Hn(e,n);function e(t){var r=n.call(this,t)||this;return r.type="ec-polyline",r}return e.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},e.prototype.getDefaultShape=function(){return new Loe},e.prototype.buildPath=function(t,r){var i=r.points,s=0,a=i.length/2;if(r.connectNulls){for(;a>0&&Oy(i[a*2-2],i[a*2-1]);a--);for(;s<a&&Oy(i[s*2],i[s*2+1]);s++);}for(;s<a;)s+=hN(t,i,s,a,a,1,r.smooth,r.smoothMonotone,r.connectNulls)+1},e.prototype.getPointOn=function(t,r){this.path||(this.createPathProxy(),this.buildPath(this.path,this.shape));for(var i=this.path,s=i.data,a=Zm.CMD,l,o,h=r==="x",d=[],m=0;m<s.length;){var _=s[m++],y=void 0,T=void 0,I=void 0,C=void 0,M=void 0,B=void 0,k=void 0;switch(_){case a.M:l=s[m++],o=s[m++];break;case a.L:if(y=s[m++],T=s[m++],k=h?(t-l)/(y-l):(t-o)/(T-o),k<=1&&k>=0){var j=h?(T-o)*k+o:(y-l)*k+l;return h?[t,j]:[j,t]}l=y,o=T;break;case a.C:y=s[m++],T=s[m++],I=s[m++],C=s[m++],M=s[m++],B=s[m++];var q=h?hP(l,y,I,M,t,d):hP(o,T,C,B,t,d);if(q>0)for(var Z=0;Z<q;Z++){var te=d[Z];if(te<=1&&te>=0){var j=h?Ua(o,T,C,B,te):Ua(l,y,I,M,te);return h?[t,j]:[j,t]}}l=M,o=B;break}}},e}(Xi),KLe=function(n){Hn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e}(Loe),JLe=function(n){Hn(e,n);function e(t){var r=n.call(this,t)||this;return r.type="ec-polygon",r}return e.prototype.getDefaultShape=function(){return new KLe},e.prototype.buildPath=function(t,r){var i=r.points,s=r.stackedOnPoints,a=0,l=i.length/2,o=r.smoothMonotone;if(r.connectNulls){for(;l>0&&Oy(i[l*2-2],i[l*2-1]);l--);for(;a<l&&Oy(i[a*2],i[a*2+1]);a++);}for(;a<l;){var h=hN(t,i,a,l,l,1,r.smooth,o,r.connectNulls);hN(t,s,a+h-1,h,l,-1,r.stackedOnSmooth,o,r.connectNulls),a+=h+1,t.closePath()}},e}(Xi);function Doe(n,e,t,r,i){var s=n.getArea(),a=s.x,l=s.y,o=s.width,h=s.height,d=t.get(["lineStyle","width"])||2;a-=d/2,l-=d/2,o+=d,h+=d,o=Math.ceil(o),a!==Math.floor(a)&&(a=Math.floor(a),o++);var m=new Go({shape:{x:a,y:l,width:o,height:h}});if(e){var _=n.getBaseAxis(),y=_.isHorizontal(),T=_.inverse;y?(T&&(m.shape.x+=o),m.shape.width=0):(T||(m.shape.y+=h),m.shape.height=0);var I=li(i)?function(C){i(C,m)}:null;$l(m,{shape:{width:o,height:h,x:a,y:l}},t,null,r,I)}return m}function Boe(n,e,t){var r=n.getArea(),i=Sa(r.r0,1),s=Sa(r.r,1),a=new Dh({shape:{cx:Sa(n.cx,1),cy:Sa(n.cy,1),r0:i,r:s,startAngle:r.startAngle,endAngle:r.endAngle,clockwise:r.clockwise}});if(e){var l=n.getBaseAxis().dim==="angle";l?a.shape.endAngle=r.startAngle:a.shape.r=i,$l(a,{shape:{endAngle:r.endAngle,r:s}},t)}return a}function QLe(n,e,t,r,i){if(n){if(n.type==="polar")return Boe(n,e,t);if(n.type==="cartesian2d")return Doe(n,e,t,r,i)}else return null;return null}function qU(n,e){return n.type===e}function jq(n,e){if(n.length===e.length){for(var t=0;t<n.length;t++)if(n[t]!==e[t])return;return!0}}function Wq(n){for(var e=1/0,t=1/0,r=-1/0,i=-1/0,s=0;s<n.length;){var a=n[s++],l=n[s++];isNaN(a)||(e=Math.min(a,e),r=Math.max(a,r)),isNaN(l)||(t=Math.min(l,t),i=Math.max(l,i))}return[[e,t],[r,i]]}function Xq(n,e){var t=Wq(n),r=t[0],i=t[1],s=Wq(e),a=s[0],l=s[1];return Math.max(Math.abs(r[0]-a[0]),Math.abs(r[1]-a[1]),Math.abs(i[0]-l[0]),Math.abs(i[1]-l[1]))}function $q(n){return Is(n)?n:n?.5:0}function eDe(n,e,t){if(!t.valueDim)return[];for(var r=e.count(),i=Im(r*2),s=0;s<r;s++){var a=Poe(t,n,e,s);i[s*2]=a[0],i[s*2+1]=a[1]}return i}function b0(n,e,t,r){var i=e.getBaseAxis(),s=i.dim==="x"||i.dim==="radius"?0:1,a=[],l=0,o=[],h=[],d=[],m=[];if(r){for(l=0;l<n.length;l+=2)!isNaN(n[l])&&!isNaN(n[l+1])&&m.push(n[l],n[l+1]);n=m}for(l=0;l<n.length-2;l+=2)switch(d[0]=n[l+2],d[1]=n[l+3],h[0]=n[l],h[1]=n[l+1],a.push(h[0],h[1]),t){case"end":o[s]=d[s],o[1-s]=h[1-s],a.push(o[0],o[1]);break;case"middle":var _=(h[s]+d[s])/2,y=[];o[s]=y[s]=_,o[1-s]=h[1-s],y[1-s]=d[1-s],a.push(o[0],o[1]),a.push(y[0],y[1]);break;default:o[s]=h[s],o[1-s]=d[1-s],a.push(o[0],o[1])}return a.push(n[l++],n[l++]),a}function tDe(n,e){var t=[],r=n.length,i,s;function a(d,m,_){var y=d.coord,T=(_-y)/(m.coord-y),I=eTe(T,[d.color,m.color]);return{coord:_,color:I}}for(var l=0;l<r;l++){var o=n[l],h=o.coord;if(h<0)i=o;else if(h>e){s?t.push(a(s,o,e)):i&&t.push(a(i,o,0),a(i,o,e));break}else i&&(t.push(a(i,o,0)),i=null),t.push(o),s=o}return t}function nDe(n,e,t){var r=n.getVisual("visualMeta");if(!(!r||!r.length||!n.count())&&e.type==="cartesian2d"){for(var i,s,a=r.length-1;a>=0;a--){var l=n.getDimensionInfo(r[a].dimension);if(i=l&&l.coordDim,i==="x"||i==="y"){s=r[a];break}}if(s){var o=e.getAxis(i),h=xr(s.stops,function(k){return{coord:o.toGlobalCoord(o.dataToCoord(k.value)),color:k.color}}),d=h.length,m=s.outerColors.slice();d&&h[0].coord>h[d-1].coord&&(h.reverse(),m.reverse());var _=tDe(h,i==="x"?t.getWidth():t.getHeight()),y=_.length;if(!y&&d)return h[0].coord<0?m[1]?m[1]:h[d-1].color:m[0]?m[0]:h[0].color;var T=10,I=_[0].coord-T,C=_[y-1].coord+T,M=C-I;if(M<.001)return"transparent";it(_,function(k){k.offset=(k.coord-I)/M}),_.push({offset:y?_[y-1].offset:.5,color:m[1]||"transparent"}),_.unshift({offset:y?_[0].offset:.5,color:m[0]||"transparent"});var B=new pie(0,0,0,0,_,!0);return B[i]=I,B[i+"2"]=C,B}}}function rDe(n,e,t){var r=n.get("showAllSymbol"),i=r==="auto";if(!(r&&!i)){var s=t.getAxesByScale("ordinal")[0];if(s&&!(i&&iDe(s,e))){var a=e.mapDimension(s.dim),l={};return it(s.getViewLabels(),function(o){var h=s.scale.getRawOrdinalNumber(o.tickValue);l[h]=1}),function(o){return!l.hasOwnProperty(e.get(a,o))}}}}function iDe(n,e){var t=n.getExtent(),r=Math.abs(t[1]-t[0])/n.scale.count();isNaN(r)&&(r=0);for(var i=e.count(),s=Math.max(1,Math.round(i/5)),a=0;a<i;a+=s)if($U.getSymbolSize(e,a)[n.isHorizontal()?1:0]*1.5>r)return!1;return!0}function sDe(n,e){return isNaN(n)||isNaN(e)}function oDe(n){for(var e=n.length/2;e>0&&sDe(n[e*2-2],n[e*2-1]);e--);return e-1}function qq(n,e){return[n[e*2],n[e*2+1]]}function aDe(n,e,t){for(var r=n.length/2,i=t==="x"?0:1,s,a,l=0,o=-1,h=0;h<r;h++)if(a=n[h*2+i],!(isNaN(a)||isNaN(n[h*2+1-i]))){if(h===0){s=a;continue}if(s<=e&&a>=e||s>=e&&a<=e){o=h;break}l=h,s=a}return{range:[l,o],t:(e-s)/(a-s)}}function koe(n){if(n.get(["endLabel","show"]))return!0;for(var e=0;e<Lh.length;e++)if(n.get([Lh[e],"endLabel","show"]))return!0;return!1}function nk(n,e,t,r){if(qU(e,"cartesian2d")){var i=r.getModel("endLabel"),s=i.get("valueAnimation"),a=r.getData(),l={lastFrameIndex:0},o=koe(r)?function(y,T){n._endLabelOnDuring(y,T,a,l,s,i,e)}:null,h=e.getBaseAxis().isHorizontal(),d=Doe(e,t,r,function(){var y=n._endLabel;y&&t&&l.originalX!=null&&y.attr({x:l.originalX,y:l.originalY})},o);if(!r.get("clip",!0)){var m=d.shape,_=Math.max(m.width,m.height);h?(m.y-=_,m.height+=_*2):(m.x-=_,m.width+=_*2)}return o&&o(1,d),d}else return Boe(e,t,r)}function lDe(n,e){var t=e.getBaseAxis(),r=t.isHorizontal(),i=t.inverse,s=r?i?"right":"left":"center",a=r?"middle":i?"top":"bottom";return{normal:{align:n.get("align")||s,verticalAlign:n.get("verticalAlign")||a}}}var cDe=function(n){Hn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.init=function(){var t=new pa,r=new XLe;this.group.add(r.group),this._symbolDraw=r,this._lineGroup=t},e.prototype.render=function(t,r,i){var s=this,a=t.coordinateSystem,l=this.group,o=t.getData(),h=t.getModel("lineStyle"),d=t.getModel("areaStyle"),m=o.getLayout("points")||[],_=a.type==="polar",y=this._coordSys,T=this._symbolDraw,I=this._polyline,C=this._polygon,M=this._lineGroup,B=!r.ssr&&t.get("animation"),k=!d.isEmpty(),j=d.get("origin"),q=Roe(a,o,j),Z=k&&eDe(a,o,q),te=t.get("showSymbol"),ie=t.get("connectNulls"),se=te&&!_&&rDe(t,o,a),ae=this._data;ae&&ae.eachItemGraphicEl(function(Qt,rn){Qt.__temp&&(l.remove(Qt),ae.setItemGraphicEl(rn,null))}),te||T.remove(),l.add(M);var fe=_?!1:t.get("step"),Se;a&&a.getArea&&t.get("clip",!0)&&(Se=a.getArea(),Se.width!=null?(Se.x-=.1,Se.y-=.1,Se.width+=.2,Se.height+=.2):Se.r0&&(Se.r0-=.5,Se.r+=.5)),this._clipShapeForSymbol=Se;var Ee=nDe(o,a,i)||o.getVisual("style")[o.getVisual("drawType")];if(!(I&&y.type===a.type&&fe===this._step))te&&T.updateData(o,{isIgnore:se,clipShape:Se,disableAnimation:!0,getSymbolPoint:function(Qt){return[m[Qt*2],m[Qt*2+1]]}}),B&&this._initSymbolLabelAnimation(o,a,Se),fe&&(m=b0(m,a,fe,ie),Z&&(Z=b0(Z,a,fe,ie))),I=this._newPolyline(m),k?C=this._newPolygon(m,Z):C&&(M.remove(C),C=this._polygon=null),_||this._initOrUpdateEndLabel(t,a,ex(Ee)),M.setClipPath(nk(this,a,!0,t));else{k&&!C?C=this._newPolygon(m,Z):C&&!k&&(M.remove(C),C=this._polygon=null),_||this._initOrUpdateEndLabel(t,a,ex(Ee));var Re=M.getClipPath();if(Re){var qe=nk(this,a,!1,t);$l(Re,{shape:qe.shape},t)}else M.setClipPath(nk(this,a,!0,t));te&&T.updateData(o,{isIgnore:se,clipShape:Se,disableAnimation:!0,getSymbolPoint:function(Qt){return[m[Qt*2],m[Qt*2+1]]}}),(!jq(this._stackedOnPoints,Z)||!jq(this._points,m))&&(B?this._doUpdateAnimation(o,Z,a,i,fe,j,ie):(fe&&(m=b0(m,a,fe,ie),Z&&(Z=b0(Z,a,fe,ie))),I.setShape({points:m}),C&&C.setShape({points:m,stackedOnPoints:Z})))}var Le=t.getModel("emphasis"),dt=Le.get("focus"),ye=Le.get("blurScope"),Xe=Le.get("disabled");if(I.useStyle(ti(h.getLineStyle(),{fill:"none",stroke:Ee,lineJoin:"bevel"})),yP(I,t,"lineStyle"),I.style.lineWidth>0&&t.get(["emphasis","lineStyle","width"])==="bolder"){var He=I.getState("emphasis").style;He.lineWidth=+I.style.lineWidth+1}ji(I).seriesIndex=t.seriesIndex,JA(I,dt,ye,Xe);var _t=$q(t.get("smooth")),wt=t.get("smoothMonotone");if(I.setShape({smooth:_t,smoothMonotone:wt,connectNulls:ie}),C){var Gt=o.getCalculationInfo("stackedOnSeries"),at=0;C.useStyle(ti(d.getAreaStyle(),{fill:Ee,opacity:.7,lineJoin:"bevel",decal:o.getVisual("style").decal})),Gt&&(at=$q(Gt.get("smooth"))),C.setShape({smooth:_t,stackedOnSmooth:at,smoothMonotone:wt,connectNulls:ie}),yP(C,t,"areaStyle"),ji(C).seriesIndex=t.seriesIndex,JA(C,dt,ye,Xe)}var Ht=function(Qt){s._changePolyState(Qt)};o.eachItemGraphicEl(function(Qt){Qt&&(Qt.onHoverStateChange=Ht)}),this._polyline.onHoverStateChange=Ht,this._data=o,this._coordSys=a,this._stackedOnPoints=Z,this._points=m,this._step=fe,this._valueOrigin=j,t.get("triggerLineEvent")&&(this.packEventData(t,I),C&&this.packEventData(t,C))},e.prototype.packEventData=function(t,r){ji(r).eventData={componentType:"series",componentSubType:"line",componentIndex:t.componentIndex,seriesIndex:t.seriesIndex,seriesName:t.name,seriesType:"line"}},e.prototype.highlight=function(t,r,i,s){var a=t.getData(),l=Qy(a,s);if(this._changePolyState("emphasis"),!(l instanceof Array)&&l!=null&&l>=0){var o=a.getLayout("points"),h=a.getItemGraphicEl(l);if(!h){var d=o[l*2],m=o[l*2+1];if(isNaN(d)||isNaN(m)||this._clipShapeForSymbol&&!this._clipShapeForSymbol.contain(d,m))return;var _=t.get("zlevel")||0,y=t.get("z")||0;h=new $U(a,l),h.x=d,h.y=m,h.setZ(_,y);var T=h.getSymbolPath().getTextContent();T&&(T.zlevel=_,T.z=y,T.z2=this._polyline.z2+1),h.__temp=!0,a.setItemGraphicEl(l,h),h.stopSymbolAnimation(!0),this.group.add(h)}h.highlight()}else Mh.prototype.highlight.call(this,t,r,i,s)},e.prototype.downplay=function(t,r,i,s){var a=t.getData(),l=Qy(a,s);if(this._changePolyState("normal"),l!=null&&l>=0){var o=a.getItemGraphicEl(l);o&&(o.__temp?(a.setItemGraphicEl(l,null),this.group.remove(o)):o.downplay())}else Mh.prototype.downplay.call(this,t,r,i,s)},e.prototype._changePolyState=function(t){var r=this._polygon;r$(this._polyline,t),r&&r$(r,t)},e.prototype._newPolyline=function(t){var r=this._polyline;return r&&this._lineGroup.remove(r),r=new YLe({shape:{points:t},segmentIgnoreThreshold:2,z2:10}),this._lineGroup.add(r),this._polyline=r,r},e.prototype._newPolygon=function(t,r){var i=this._polygon;return i&&this._lineGroup.remove(i),i=new JLe({shape:{points:t,stackedOnPoints:r},segmentIgnoreThreshold:2}),this._lineGroup.add(i),this._polygon=i,i},e.prototype._initSymbolLabelAnimation=function(t,r,i){var s,a,l=r.getBaseAxis(),o=l.inverse;r.type==="cartesian2d"?(s=l.isHorizontal(),a=!1):r.type==="polar"&&(s=l.dim==="angle",a=!0);var h=t.hostModel,d=h.get("animationDuration");li(d)&&(d=d(null));var m=h.get("animationDelay")||0,_=li(m)?m(null):m;t.eachItemGraphicEl(function(y,T){var I=y;if(I){var C=[y.x,y.y],M=void 0,B=void 0,k=void 0;if(i)if(a){var j=i,q=r.pointToCoord(C);s?(M=j.startAngle,B=j.endAngle,k=-q[1]/180*Math.PI):(M=j.r0,B=j.r,k=q[0])}else{var Z=i;s?(M=Z.x,B=Z.x+Z.width,k=y.x):(M=Z.y+Z.height,B=Z.y,k=y.y)}var te=B===M?0:(k-M)/(B-M);o&&(te=1-te);var ie=li(m)?m(T):d*te+_,se=I.getSymbolPath(),ae=se.getTextContent();I.attr({scaleX:0,scaleY:0}),I.animateTo({scaleX:1,scaleY:1},{duration:200,setToFinal:!0,delay:ie}),ae&&ae.animateFrom({style:{opacity:0}},{duration:300,delay:ie}),se.disableLabelAnimation=!0}})},e.prototype._initOrUpdateEndLabel=function(t,r,i){var s=t.getModel("endLabel");if(koe(t)){var a=t.getData(),l=this._polyline,o=a.getLayout("points");if(!o){l.removeTextContent(),this._endLabel=null;return}var h=this._endLabel;h||(h=this._endLabel=new Ca({z2:200}),h.ignoreClip=!0,l.setTextContent(this._endLabel),l.disableLabelAnimation=!0);var d=oDe(o);d>=0&&(QT(l,eM(t,"endLabel"),{inheritColor:i,labelFetcher:t,labelDataIndex:d,defaultText:function(m,_,y){return y!=null?Ioe(a,y):XU(a,m)},enableTextSetter:!0},lDe(s,r)),l.textConfig.position=null)}else this._endLabel&&(this._polyline.removeTextContent(),this._endLabel=null)},e.prototype._endLabelOnDuring=function(t,r,i,s,a,l,o){var h=this._endLabel,d=this._polyline;if(h){t<1&&s.originalX==null&&(s.originalX=h.x,s.originalY=h.y);var m=i.getLayout("points"),_=i.hostModel,y=_.get("connectNulls"),T=l.get("precision"),I=l.get("distance")||0,C=o.getBaseAxis(),M=C.isHorizontal(),B=C.inverse,k=r.shape,j=B?M?k.x:k.y+k.height:M?k.x+k.width:k.y,q=(M?I:0)*(B?-1:1),Z=(M?0:-I)*(B?-1:1),te=M?"x":"y",ie=aDe(m,j,te),se=ie.range,ae=se[1]-se[0],fe=void 0;if(ae>=1){if(ae>1&&!y){var Se=qq(m,se[0]);h.attr({x:Se[0]+q,y:Se[1]+Z}),a&&(fe=_.getRawValue(se[0]))}else{var Se=d.getPointOn(j,te);Se&&h.attr({x:Se[0]+q,y:Se[1]+Z});var Ee=_.getRawValue(se[0]),Re=_.getRawValue(se[1]);a&&(fe=Rre(i,T,Ee,Re,ie.t))}s.lastFrameIndex=se[0]}else{var qe=t===1||s.lastFrameIndex>0?se[0]:0,Se=qq(m,qe);a&&(fe=_.getRawValue(qe)),h.attr({x:Se[0]+q,y:Se[1]+Z})}if(a){var Le=bw(h);typeof Le.setLabelText=="function"&&Le.setLabelText(fe)}}},e.prototype._doUpdateAnimation=function(t,r,i,s,a,l,o){var h=this._polyline,d=this._polygon,m=t.hostModel,_=ZLe(this._data,t,this._stackedOnPoints,r,this._coordSys,i,this._valueOrigin),y=_.current,T=_.stackedOnCurrent,I=_.next,C=_.stackedOnNext;if(a&&(y=b0(_.current,i,a,o),T=b0(_.stackedOnCurrent,i,a,o),I=b0(_.next,i,a,o),C=b0(_.stackedOnNext,i,a,o)),Xq(y,I)>3e3||d&&Xq(T,C)>3e3){h.stopAnimation(),h.setShape({points:I}),d&&(d.stopAnimation(),d.setShape({points:I,stackedOnPoints:C}));return}h.shape.__points=_.current,h.shape.points=y;var M={shape:{points:I}};_.current!==y&&(M.shape.__points=_.next),h.stopAnimation(),sl(h,M,m),d&&(d.setShape({points:y,stackedOnPoints:T}),d.stopAnimation(),sl(d,{shape:{stackedOnPoints:C}},m),h.shape.points!==d.shape.points&&(d.shape.points=h.shape.points));for(var B=[],k=_.status,j=0;j<k.length;j++){var q=k[j].cmd;if(q==="="){var Z=t.getItemGraphicEl(k[j].idx1);Z&&B.push({el:Z,ptIdx:j})}}h.animators&&h.animators.length&&h.animators[0].during(function(){d&&d.dirtyShape();for(var te=h.shape.__points,ie=0;ie<B.length;ie++){var se=B[ie].el,ae=B[ie].ptIdx*2;se.x=te[ae],se.y=te[ae+1],se.markRedraw()}})},e.prototype.remove=function(t){var r=this.group,i=this._data;this._lineGroup.removeAll(),this._symbolDraw.remove(!0),i&&i.eachItemGraphicEl(function(s,a){s.__temp&&(r.remove(s),i.setItemGraphicEl(a,null))}),this._polyline=this._polygon=this._coordSys=this._points=this._stackedOnPoints=this._endLabel=this._data=null},e.type="line",e}(Mh);function uDe(n,e){return{seriesType:n,plan:LU(),reset:function(t){var r=t.getData(),i=t.coordinateSystem;if(t.pipelineContext,!!i){var s=xr(i.dimensions,function(m){return r.mapDimension(m)}).slice(0,2),a=s.length,l=r.getCalculationInfo("stackResultDimension");tx(r,s[0])&&(s[0]=l),tx(r,s[1])&&(s[1]=l);var o=r.getStore(),h=r.getDimensionIndex(s[0]),d=r.getDimensionIndex(s[1]);return a&&{progress:function(m,_){for(var y=m.end-m.start,T=Im(y*a),I=[],C=[],M=m.start,B=0;M<m.end;M++){var k=void 0;if(a===1){var j=o.get(h,M);k=i.dataToPoint(j,null,C)}else I[0]=o.get(h,M),I[1]=o.get(d,M),k=i.dataToPoint(I,null,C);T[B++]=k[0],T[B++]=k[1]}_.setLayout("points",T)}}}}}}var hDe={average:function(n){for(var e=0,t=0,r=0;r<n.length;r++)isNaN(n[r])||(e+=n[r],t++);return t===0?NaN:e/t},sum:function(n){for(var e=0,t=0;t<n.length;t++)e+=n[t]||0;return e},max:function(n){for(var e=-1/0,t=0;t<n.length;t++)n[t]>e&&(e=n[t]);return isFinite(e)?e:NaN},min:function(n){for(var e=1/0,t=0;t<n.length;t++)n[t]<e&&(e=n[t]);return isFinite(e)?e:NaN},minmax:function(n){for(var e=-1/0,t=-1/0,r=0;r<n.length;r++){var i=n[r],s=Math.abs(i);s>e&&(e=s,t=i)}return isFinite(t)?t:NaN},nearest:function(n){return n[0]}},fDe=function(n){return Math.round(n.length/2)};function Ooe(n){return{seriesType:n,reset:function(e,t,r){var i=e.getData(),s=e.get("sampling"),a=e.coordinateSystem,l=i.count();if(l>10&&a.type==="cartesian2d"&&s){var o=a.getBaseAxis(),h=a.getOtherAxis(o),d=o.getExtent(),m=r.getDevicePixelRatio(),_=Math.abs(d[1]-d[0])*(m||1),y=Math.round(l/_);if(isFinite(y)&&y>1){s==="lttb"&&e.setData(i.lttbDownSample(i.mapDimension(h.dim),1/y));var T=void 0;Dr(s)?T=hDe[s]:li(s)&&(T=s),T&&e.setData(i.downSample(i.mapDimension(h.dim),1/y,T,fDe))}}}}}function dDe(n){n.registerChartView(cDe),n.registerSeriesModel(jLe),n.registerLayout(uDe("line")),n.registerVisual({seriesType:"line",reset:function(e){var t=e.getData(),r=e.getModel("lineStyle").getLineStyle();r&&!r.stroke&&(r.stroke=t.getVisual("style").fill),t.setVisual("legendLineStyle",r)}}),n.registerProcessor(n.PRIORITY.PROCESSOR.STATISTIC,Ooe("line"))}var fN=function(n){Hn(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.getInitialData=function(t,r){return zU(null,this,{useEncodeDefaulter:!0})},e.prototype.getMarkerPosition=function(t,r,i){var s=this.coordinateSystem;if(s&&s.clampData){var a=s.clampData(t),l=s.dataToPoint(a);if(i)it(s.getAxes(),function(_,y){if(_.type==="category"&&r!=null){var T=_.getTicksCoords(),I=_.getTickModel().get("alignWithLabel"),C=a[y],M=r[y]==="x1"||r[y]==="y1";if(M&&!I&&(C+=1),T.length<2)return;if(T.length===2){l[y]=_.toGlobalCoord(_.getExtent()[M?1:0]);return}for(var B=void 0,k=void 0,j=1,q=0;q<T.length;q++){var Z=T[q].coord,te=q===T.length-1?T[q-1].tickValue+j:T[q].tickValue;if(te===C){k=Z;break}else if(te<C)B=Z;else if(B!=null&&te>C){k=(Z+B)/2;break}q===1&&(j=te-T[0].tickValue)}k==null&&(B?B&&(k=T[T.length-1].coord):k=T[0].coord),l[y]=_.toGlobalCoord(k)}});else{var o=this.getData(),h=o.getLayout("offset"),d=o.getLayout("size"),m=s.getBaseAxis().isHorizontal()?0:1;l[m]+=h+d/2}return l}return[NaN,NaN]},e.type="series.__base_bar__",e.defaultOption={z:2,coordinateSystem:"cartesian2d",legendHoverLink:!0,barMinHeight:0,barMinAngle:0,large:!1,largeThreshold:400,progressive:3e3,progressiveChunkMode:"mod"},e}(Zf);Zf.registerClass(fN);var pDe=function(n){Hn(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.getInitialData=function(){return zU(null,this,{useEncodeDefaulter:!0,createInvertedIndices:!!this.get("realtimeSort",!0)||null})},e.prototype.getProgressive=function(){return this.get("large")?this.get("progressive"):!1},e.prototype.getProgressiveThreshold=function(){var t=this.get("progressiveThreshold"),r=this.get("largeThreshold");return r>t&&(t=r),t},e.prototype.brushSelector=function(t,r,i){return i.rect(r.getItemLayout(t))},e.type="series.bar",e.dependencies=["grid","polar"],e.defaultOption=Mie(fN.defaultOption,{clip:!0,roundCap:!1,showBackground:!1,backgroundStyle:{color:"rgba(180, 180, 180, 0.2)",borderColor:null,borderWidth:0,borderType:"solid",borderRadius:0,shadowBlur:0,shadowColor:null,shadowOffsetX:0,shadowOffsetY:0,opacity:1},select:{itemStyle:{borderColor:"#212121"}},realtimeSort:!1}),e}(fN),mDe=function(){function n(){this.cx=0,this.cy=0,this.r0=0,this.r=0,this.startAngle=0,this.endAngle=Math.PI*2,this.clockwise=!0}return n}(),Zq=function(n){Hn(e,n);function e(t){var r=n.call(this,t)||this;return r.type="sausage",r}return e.prototype.getDefaultShape=function(){return new mDe},e.prototype.buildPath=function(t,r){var i=r.cx,s=r.cy,a=Math.max(r.r0||0,0),l=Math.max(r.r,0),o=(l-a)*.5,h=a+o,d=r.startAngle,m=r.endAngle,_=r.clockwise,y=Math.PI*2,T=_?m-d<y:d-m<y;T||(d=m-(_?y:-y));var I=Math.cos(d),C=Math.sin(d),M=Math.cos(m),B=Math.sin(m);T?(t.moveTo(I*a+i,C*a+s),t.arc(I*h+i,C*h+s,o,-Math.PI+d,d,!_)):t.moveTo(I*l+i,C*l+s),t.arc(i,s,l,d,m,!_),t.arc(M*h+i,B*h+s,o,m-Math.PI*2,m-Math.PI,!_),a!==0&&t.arc(i,s,a,m,d,_)},e}(Xi);function gDe(n,e){e=e||{};var t=e.isRoundCap;return function(r,i,s){var a=i.position;if(!a||a instanceof Array)return mP(r,i,s);var l=n(a),o=i.distance!=null?i.distance:5,h=this.shape,d=h.cx,m=h.cy,_=h.r,y=h.r0,T=(_+y)/2,I=h.startAngle,C=h.endAngle,M=(I+C)/2,B=t?Math.abs(_-y)/2:0,k=Math.cos,j=Math.sin,q=d+_*k(I),Z=m+_*j(I),te="left",ie="top";switch(l){case"startArc":q=d+(y-o)*k(M),Z=m+(y-o)*j(M),te="center",ie="top";break;case"insideStartArc":q=d+(y+o)*k(M),Z=m+(y+o)*j(M),te="center",ie="bottom";break;case"startAngle":q=d+T*k(I)+JE(I,o+B,!1),Z=m+T*j(I)+QE(I,o+B,!1),te="right",ie="middle";break;case"insideStartAngle":q=d+T*k(I)+JE(I,-o+B,!1),Z=m+T*j(I)+QE(I,-o+B,!1),te="left",ie="middle";break;case"middle":q=d+T*k(M),Z=m+T*j(M),te="center",ie="middle";break;case"endArc":q=d+(_+o)*k(M),Z=m+(_+o)*j(M),te="center",ie="bottom";break;case"insideEndArc":q=d+(_-o)*k(M),Z=m+(_-o)*j(M),te="center",ie="top";break;case"endAngle":q=d+T*k(C)+JE(C,o+B,!0),Z=m+T*j(C)+QE(C,o+B,!0),te="left",ie="middle";break;case"insideEndAngle":q=d+T*k(C)+JE(C,-o+B,!0),Z=m+T*j(C)+QE(C,-o+B,!0),te="right",ie="middle";break;default:return mP(r,i,s)}return r=r||{},r.x=q,r.y=Z,r.align=te,r.verticalAlign=ie,r}}function vDe(n,e,t,r){if(Is(r)){n.setTextConfig({rotation:r});return}else if(fr(e)){n.setTextConfig({rotation:0});return}var i=n.shape,s=i.clockwise?i.startAngle:i.endAngle,a=i.clockwise?i.endAngle:i.startAngle,l=(s+a)/2,o,h=t(e);switch(h){case"startArc":case"insideStartArc":case"middle":case"insideEndArc":case"endArc":o=l;break;case"startAngle":case"insideStartAngle":o=s;break;case"endAngle":case"insideEndAngle":o=a;break;default:n.setTextConfig({rotation:0});return}var d=Math.PI*1.5-o;h==="middle"&&d>Math.PI/2&&d<Math.PI*1.5&&(d-=Math.PI),n.setTextConfig({rotation:d})}function JE(n,e,t){return e*Math.sin(n)*(t?-1:1)}function QE(n,e,t){return e*Math.cos(n)*(t?1:-1)}function wS(n,e,t){var r=n.get("borderRadius");if(r==null)return t?{cornerRadius:0}:null;fr(r)||(r=[r,r,r,r]);var i=Math.abs(e.r||0-e.r0||0);return{cornerRadius:xr(r,function(s){return dv(s,i)})}}var rk=Math.max,ik=Math.min;function _De(n,e){var t=n.getArea&&n.getArea();if(qU(n,"cartesian2d")){var r=n.getBaseAxis();if(r.type!=="category"||!r.onBand){var i=e.getLayout("bandWidth");r.isHorizontal()?(t.x-=i,t.width+=i*2):(t.y-=i,t.height+=i*2)}}return t}var yDe=function(n){Hn(e,n);function e(){var t=n.call(this)||this;return t.type=e.type,t._isFirstFrame=!0,t}return e.prototype.render=function(t,r,i,s){this._model=t,this._removeOnRenderedListener(i),this._updateDrawMode(t);var a=t.get("coordinateSystem");(a==="cartesian2d"||a==="polar")&&(this._progressiveEls=null,this._isLargeDraw?this._renderLarge(t,r,i):this._renderNormal(t,r,i,s))},e.prototype.incrementalPrepareRender=function(t){this._clear(),this._updateDrawMode(t),this._updateLargeClip(t)},e.prototype.incrementalRender=function(t,r){this._progressiveEls=[],this._incrementalRenderLarge(t,r)},e.prototype.eachRendered=function(t){TD(this._progressiveEls||this.group,t)},e.prototype._updateDrawMode=function(t){var r=t.pipelineContext.large;(this._isLargeDraw==null||r!==this._isLargeDraw)&&(this._isLargeDraw=r,this._clear())},e.prototype._renderNormal=function(t,r,i,s){var a=this.group,l=t.getData(),o=this._data,h=t.coordinateSystem,d=h.getBaseAxis(),m;h.type==="cartesian2d"?m=d.isHorizontal():h.type==="polar"&&(m=d.dim==="angle");var _=t.isAnimationEnabled()?t:null,y=xDe(t,h);y&&this._enableRealtimeSort(y,l,i);var T=t.get("clip",!0)||y,I=_De(h,l);a.removeClipPath();var C=t.get("roundCap",!0),M=t.get("showBackground",!0),B=t.getModel("backgroundStyle"),k=B.get("borderRadius")||0,j=[],q=this._backgroundEls,Z=s&&s.isInitSort,te=s&&s.type==="changeAxisOrder";function ie(fe){var Se=eI[h.type](l,fe),Ee=CDe(h,m,Se);return Ee.useStyle(B.getItemStyle()),h.type==="cartesian2d"?Ee.setShape("r",k):Ee.setShape("cornerRadius",k),j[fe]=Ee,Ee}l.diff(o).add(function(fe){var Se=l.getItemModel(fe),Ee=eI[h.type](l,fe,Se);if(M&&ie(fe),!(!l.hasValue(fe)||!eZ[h.type](Ee))){var Re=!1;T&&(Re=Yq[h.type](I,Ee));var qe=Kq[h.type](t,l,fe,Ee,m,_,d.model,!1,C);y&&(qe.forceLabelAnimation=!0),tZ(qe,l,fe,Se,Ee,t,m,h.type==="polar"),Z?qe.attr({shape:Ee}):y?Jq(y,_,qe,Ee,fe,m,!1,!1):$l(qe,{shape:Ee},t,fe),l.setItemGraphicEl(fe,qe),a.add(qe),qe.ignore=Re}}).update(function(fe,Se){var Ee=l.getItemModel(fe),Re=eI[h.type](l,fe,Ee);if(M){var qe=void 0;q.length===0?qe=ie(Se):(qe=q[Se],qe.useStyle(B.getItemStyle()),h.type==="cartesian2d"?qe.setShape("r",k):qe.setShape("cornerRadius",k),j[fe]=qe);var Le=eI[h.type](l,fe),dt=Noe(m,Le,h);sl(qe,{shape:dt},_,fe)}var ye=o.getItemGraphicEl(Se);if(!l.hasValue(fe)||!eZ[h.type](Re)){a.remove(ye);return}var Xe=!1;if(T&&(Xe=Yq[h.type](I,Re),Xe&&a.remove(ye)),ye?pU(ye):ye=Kq[h.type](t,l,fe,Re,m,_,d.model,!!ye,C),y&&(ye.forceLabelAnimation=!0),te){var He=ye.getTextContent();if(He){var _t=bw(He);_t.prevValue!=null&&(_t.prevValue=_t.value)}}else tZ(ye,l,fe,Ee,Re,t,m,h.type==="polar");Z?ye.attr({shape:Re}):y?Jq(y,_,ye,Re,fe,m,!0,te):sl(ye,{shape:Re},t,fe,null),l.setItemGraphicEl(fe,ye),ye.ignore=Xe,a.add(ye)}).remove(function(fe){var Se=o.getItemGraphicEl(fe);Se&&wP(Se,t,fe)}).execute();var se=this._backgroundGroup||(this._backgroundGroup=new pa);se.removeAll();for(var ae=0;ae<j.length;++ae)se.add(j[ae]);a.add(se),this._backgroundEls=j,this._data=l},e.prototype._renderLarge=function(t,r,i){this._clear(),rZ(t,this.group),this._updateLargeClip(t)},e.prototype._incrementalRenderLarge=function(t,r){this._removeBackground(),rZ(r,this.group,this._progressiveEls,!0)},e.prototype._updateLargeClip=function(t){var r=t.get("clip",!0)&&QLe(t.coordinateSystem,!1,t),i=this.group;r?i.setClipPath(r):i.removeClipPath()},e.prototype._enableRealtimeSort=function(t,r,i){var s=this;if(r.count()){var a=t.baseAxis;if(this._isFirstFrame)this._dispatchInitSort(r,t,i),this._isFirstFrame=!1;else{var l=function(o){var h=r.getItemGraphicEl(o),d=h&&h.shape;return d&&Math.abs(a.isHorizontal()?d.height:d.width)||0};this._onRendered=function(){s._updateSortWithinSameData(r,l,a,i)},i.getZr().on("rendered",this._onRendered)}}},e.prototype._dataSort=function(t,r,i){var s=[];return t.each(t.mapDimension(r.dim),function(a,l){var o=i(l);o=o??NaN,s.push({dataIndex:l,mappedValue:o,ordinalNumber:a})}),s.sort(function(a,l){return l.mappedValue-a.mappedValue}),{ordinalNumbers:xr(s,function(a){return a.ordinalNumber})}},e.prototype._isOrderChangedWithinSameData=function(t,r,i){for(var s=i.scale,a=t.mapDimension(i.dim),l=Number.MAX_VALUE,o=0,h=s.getOrdinalMeta().categories.length;o<h;++o){var d=t.rawIndexOf(a,s.getRawOrdinalNumber(o)),m=d<0?Number.MIN_VALUE:r(t.indexOfRawIndex(d));if(m>l)return!0;l=m}return!1},e.prototype._isOrderDifferentInView=function(t,r){for(var i=r.scale,s=i.getExtent(),a=Math.max(0,s[0]),l=Math.min(s[1],i.getOrdinalMeta().categories.length-1);a<=l;++a)if(t.ordinalNumbers[a]!==i.getRawOrdinalNumber(a))return!0},e.prototype._updateSortWithinSameData=function(t,r,i,s){if(this._isOrderChangedWithinSameData(t,r,i)){var a=this._dataSort(t,i,r);this._isOrderDifferentInView(a,i)&&(this._removeOnRenderedListener(s),s.dispatchAction({type:"changeAxisOrder",componentType:i.dim+"Axis",axisId:i.index,sortInfo:a}))}},e.prototype._dispatchInitSort=function(t,r,i){var s=r.baseAxis,a=this._dataSort(t,s,function(l){return t.get(t.mapDimension(r.otherAxis.dim),l)});i.dispatchAction({type:"changeAxisOrder",componentType:s.dim+"Axis",isInitSort:!0,axisId:s.index,sortInfo:a})},e.prototype.remove=function(t,r){this._clear(this._model),this._removeOnRenderedListener(r)},e.prototype.dispose=function(t,r){this._removeOnRenderedListener(r)},e.prototype._removeOnRenderedListener=function(t){this._onRendered&&(t.getZr().off("rendered",this._onRendered),this._onRendered=null)},e.prototype._clear=function(t){var r=this.group,i=this._data;t&&t.isAnimationEnabled()&&i&&!this._isLargeDraw?(this._removeBackground(),this._backgroundEls=[],i.eachItemGraphicEl(function(s){wP(s,t,ji(s).dataIndex)})):r.removeAll(),this._data=null,this._isFirstFrame=!0},e.prototype._removeBackground=function(){this.group.remove(this._backgroundGroup),this._backgroundGroup=null},e.type="bar",e}(Mh),Yq={cartesian2d:function(n,e){var t=e.width<0?-1:1,r=e.height<0?-1:1;t<0&&(e.x+=e.width,e.width=-e.width),r<0&&(e.y+=e.height,e.height=-e.height);var i=n.x+n.width,s=n.y+n.height,a=rk(e.x,n.x),l=ik(e.x+e.width,i),o=rk(e.y,n.y),h=ik(e.y+e.height,s),d=l<a,m=h<o;return e.x=d&&a>i?l:a,e.y=m&&o>s?h:o,e.width=d?0:l-a,e.height=m?0:h-o,t<0&&(e.x+=e.width,e.width=-e.width),r<0&&(e.y+=e.height,e.height=-e.height),d||m},polar:function(n,e){var t=e.r0<=e.r?1:-1;if(t<0){var r=e.r;e.r=e.r0,e.r0=r}var i=ik(e.r,n.r),s=rk(e.r0,n.r0);e.r=i,e.r0=s;var a=i-s<0;if(t<0){var r=e.r;e.r=e.r0,e.r0=r}return a}},Kq={cartesian2d:function(n,e,t,r,i,s,a,l,o){var h=new Go({shape:Jn({},r),z2:1});if(h.__dataIndex=t,h.name="item",s){var d=h.shape,m=i?"height":"width";d[m]=0}return h},polar:function(n,e,t,r,i,s,a,l,o){var h=!i&&o?Zq:Dh,d=new h({shape:r,z2:1});d.name="item";var m=Foe(i);if(d.calculateTextPosition=gDe(m,{isRoundCap:h===Zq}),s){var _=d.shape,y=i?"r":"endAngle",T={};_[y]=i?r.r0:r.startAngle,T[y]=r[y],(l?sl:$l)(d,{shape:T},s)}return d}};function xDe(n,e){var t=n.get("realtimeSort",!0),r=e.getBaseAxis();if(t&&r.type==="category"&&e.type==="cartesian2d")return{baseAxis:r,otherAxis:e.getOtherAxis(r)}}function Jq(n,e,t,r,i,s,a,l){var o,h;s?(h={x:r.x,width:r.width},o={y:r.y,height:r.height}):(h={y:r.y,height:r.height},o={x:r.x,width:r.width}),l||(a?sl:$l)(t,{shape:o},e,i,null);var d=e?n.baseAxis.model:null;(a?sl:$l)(t,{shape:h},d,i)}function Qq(n,e){for(var t=0;t<e.length;t++)if(!isFinite(n[e[t]]))return!0;return!1}var bDe=["x","y","width","height"],wDe=["cx","cy","r","startAngle","endAngle"],eZ={cartesian2d:function(n){return!Qq(n,bDe)},polar:function(n){return!Qq(n,wDe)}},eI={cartesian2d:function(n,e,t){var r=n.getItemLayout(e),i=t?ADe(t,r):0,s=r.width>0?1:-1,a=r.height>0?1:-1;return{x:r.x+s*i/2,y:r.y+a*i/2,width:r.width-s*i,height:r.height-a*i}},polar:function(n,e,t){var r=n.getItemLayout(e);return{cx:r.cx,cy:r.cy,r0:r.r0,r:r.r,startAngle:r.startAngle,endAngle:r.endAngle,clockwise:r.clockwise}}};function SDe(n){return n.startAngle!=null&&n.endAngle!=null&&n.startAngle===n.endAngle}function Foe(n){return function(e){var t=e?"Arc":"Angle";return function(r){switch(r){case"start":case"insideStart":case"end":case"insideEnd":return r+t;default:return r}}}(n)}function tZ(n,e,t,r,i,s,a,l){var o=e.getItemVisual(t,"style");if(l){if(!s.get("roundCap")){var d=n.shape,m=wS(r.getModel("itemStyle"),d,!0);Jn(d,m),n.setShape(d)}}else{var h=r.get(["itemStyle","borderRadius"])||0;n.setShape("r",h)}n.useStyle(o);var _=r.getShallow("cursor");_&&n.attr("cursor",_);var y=l?a?i.r>=i.r0?"endArc":"startArc":i.endAngle>=i.startAngle?"endAngle":"startAngle":a?i.height>=0?"bottom":"top":i.width>=0?"right":"left",T=eM(r);QT(n,T,{labelFetcher:s,labelDataIndex:t,defaultText:XU(s.getData(),t),inheritColor:o.fill,defaultOpacity:o.opacity,defaultOutsidePosition:y});var I=n.getTextContent();if(l&&I){var C=r.get(["label","position"]);n.textConfig.inside=C==="middle"?!0:null,vDe(n,C==="outside"?y:C,Foe(a),r.get(["label","rotate"]))}aEe(I,T,s.getRawValue(t),function(B){return Ioe(e,B)});var M=r.getModel(["emphasis"]);JA(n,M.get("focus"),M.get("blurScope"),M.get("disabled")),yP(n,r),SDe(i)&&(n.style.fill="none",n.style.stroke="none",it(n.states,function(B){B.style&&(B.style.fill=B.style.stroke="none")}))}function ADe(n,e){var t=n.get(["itemStyle","borderColor"]);if(!t||t==="none")return 0;var r=n.get(["itemStyle","borderWidth"])||0,i=isNaN(e.width)?Number.MAX_VALUE:Math.abs(e.width),s=isNaN(e.height)?Number.MAX_VALUE:Math.abs(e.height);return Math.min(r,i,s)}var TDe=function(){function n(){}return n}(),nZ=function(n){Hn(e,n);function e(t){var r=n.call(this,t)||this;return r.type="largeBar",r}return e.prototype.getDefaultShape=function(){return new TDe},e.prototype.buildPath=function(t,r){for(var i=r.points,s=this.baseDimIdx,a=1-this.baseDimIdx,l=[],o=[],h=this.barWidth,d=0;d<i.length;d+=3)o[s]=h,o[a]=i[d+2],l[s]=i[d+s],l[a]=i[d+a],t.rect(l[0],l[1],o[0],o[1])},e}(Xi);function rZ(n,e,t,r){var i=n.getData(),s=i.getLayout("valueAxisHorizontal")?1:0,a=i.getLayout("largeDataIndices"),l=i.getLayout("size"),o=n.getModel("backgroundStyle"),h=i.getLayout("largeBackgroundPoints");if(h){var d=new nZ({shape:{points:h},incremental:!!r,silent:!0,z2:0});d.baseDimIdx=s,d.largeDataIndices=a,d.barWidth=l,d.useStyle(o.getItemStyle()),e.add(d),t&&t.push(d)}var m=new nZ({shape:{points:i.getLayout("largePoints")},incremental:!!r,ignoreCoarsePointer:!0,z2:1});m.baseDimIdx=s,m.largeDataIndices=a,m.barWidth=l,e.add(m),m.useStyle(i.getVisual("style")),ji(m).seriesIndex=n.seriesIndex,n.get("silent")||(m.on("mousedown",iZ),m.on("mousemove",iZ)),t&&t.push(m)}var iZ=DU(function(n){var e=this,t=MDe(e,n.offsetX,n.offsetY);ji(e).dataIndex=t>=0?t:null},30,!1);function MDe(n,e,t){for(var r=n.baseDimIdx,i=1-r,s=n.shape.points,a=n.largeDataIndices,l=[],o=[],h=n.barWidth,d=0,m=s.length/3;d<m;d++){var _=d*3;if(o[r]=h,o[i]=s[_+2],l[r]=s[_+r],l[i]=s[_+i],o[i]<0&&(l[i]+=o[i],o[i]=-o[i]),e>=l[0]&&e<=l[0]+o[0]&&t>=l[1]&&t<=l[1]+o[1])return a[d]}return-1}function Noe(n,e,t){if(qU(t,"cartesian2d")){var r=e,i=t.getArea();return{x:n?r.x:i.x,y:n?i.y:r.y,width:n?r.width:i.width,height:n?i.height:r.height}}else{var i=t.getArea(),s=e;return{cx:i.cx,cy:i.cy,r0:n?i.r0:s.r0,r:n?i.r:s.r,startAngle:n?s.startAngle:0,endAngle:n?s.endAngle:Math.PI*2}}}function CDe(n,e,t){var r=n.type==="polar"?Dh:Go;return new r({shape:Noe(e,t,n),silent:!0,z2:0})}function EDe(n){n.registerChartView(yDe),n.registerSeriesModel(pDe),n.registerLayout(n.PRIORITY.VISUAL.LAYOUT,ms(QPe,"bar")),n.registerLayout(n.PRIORITY.VISUAL.PROGRESSIVE_LAYOUT,eLe("bar")),n.registerProcessor(n.PRIORITY.PROCESSOR.STATISTIC,Ooe("bar")),n.registerAction({type:"changeAxisOrder",event:"changeAxisOrder",update:"update"},function(e,t){var r=e.componentType||"series";t.eachComponent({mainType:r,query:e},function(i){e.sortInfo&&i.axis.setCategorySortInfo(e.sortInfo)})})}var sZ=Math.PI*2,tI=Math.PI/180;function zoe(n,e){return mv(n.getBoxLayoutParams(),{width:e.getWidth(),height:e.getHeight()})}function Uoe(n,e){var t=zoe(n,e),r=n.get("center"),i=n.get("radius");fr(i)||(i=[0,i]);var s=os(t.width,e.getWidth()),a=os(t.height,e.getHeight()),l=Math.min(s,a),o=os(i[0],l/2),h=os(i[1],l/2),d,m,_=n.coordinateSystem;if(_){var y=_.dataToPoint(r);d=y[0]||0,m=y[1]||0}else fr(r)||(r=[r,r]),d=os(r[0],s)+t.x,m=os(r[1],a)+t.y;return{cx:d,cy:m,r0:o,r:h}}function IDe(n,e,t){e.eachSeriesByType(n,function(r){var i=r.getData(),s=i.mapDimension("value"),a=zoe(r,t),l=Uoe(r,t),o=l.cx,h=l.cy,d=l.r,m=l.r0,_=-r.get("startAngle")*tI,y=r.get("endAngle"),T=r.get("padAngle")*tI;y=y==="auto"?_-sZ:-y*tI;var I=r.get("minAngle")*tI,C=I+T,M=0;i.each(s,function(dt){!isNaN(dt)&&M++});var B=i.getSum(s),k=Math.PI/(B||M)*2,j=r.get("clockwise"),q=r.get("roseType"),Z=r.get("stillShowZeroSum"),te=i.getDataExtent(s);te[0]=0;var ie=j?1:-1,se=[_,y],ae=ie*T/2;Nre(se,!j),_=se[0],y=se[1];var fe=Voe(r);fe.startAngle=_,fe.endAngle=y,fe.clockwise=j;var Se=Math.abs(y-_),Ee=Se,Re=0,qe=_;if(i.setLayout({viewRect:a,r:d}),i.each(s,function(dt,ye){var Xe;if(isNaN(dt)){i.setItemLayout(ye,{angle:NaN,startAngle:NaN,endAngle:NaN,clockwise:j,cx:o,cy:h,r0:m,r:q?NaN:d});return}q!=="area"?Xe=B===0&&Z?k:dt*k:Xe=Se/M,Xe<C?(Xe=C,Ee-=C):Re+=dt;var He=qe+ie*Xe,_t=0,wt=0;T>Xe?(_t=qe+ie*Xe/2,wt=_t):(_t=qe+ae,wt=He-ae),i.setItemLayout(ye,{angle:Xe,startAngle:_t,endAngle:wt,clockwise:j,cx:o,cy:h,r0:m,r:q?B0(dt,te,[m,d]):d}),qe=He}),Ee<sZ&&M)if(Ee<=.001){var Le=Se/M;i.each(s,function(dt,ye){if(!isNaN(dt)){var Xe=i.getItemLayout(ye);Xe.angle=Le;var He=0,_t=0;Le<T?(He=_+ie*(ye+1/2)*Le,_t=He):(He=_+ie*ye*Le+ae,_t=_+ie*(ye+1)*Le-ae),Xe.startAngle=He,Xe.endAngle=_t}})}else k=Ee/Re,qe=_,i.each(s,function(dt,ye){if(!isNaN(dt)){var Xe=i.getItemLayout(ye),He=Xe.angle===C?C:dt*k,_t=0,wt=0;He<T?(_t=qe+ie*He/2,wt=_t):(_t=qe+ae,wt=qe+ie*He-ae),Xe.startAngle=_t,Xe.endAngle=wt,qe+=ie*He}})})}var Voe=Xs();function RDe(n){return{seriesType:n,reset:function(e,t){var r=t.findComponents({mainType:"legend"});if(!(!r||!r.length)){var i=e.getData();i.filterSelf(function(s){for(var a=i.getName(s),l=0;l<r.length;l++)if(!r[l].isSelected(a))return!1;return!0})}}}}var PDe=Math.PI/180;function oZ(n,e,t,r,i,s,a,l,o,h){if(n.length<2)return;function d(I){for(var C=I.rB,M=C*C,B=0;B<I.list.length;B++){var k=I.list[B],j=Math.abs(k.label.y-t),q=r+k.len,Z=q*q,te=Math.sqrt((1-Math.abs(j*j/M))*Z),ie=e+(te+k.len2)*i,se=ie-k.label.x,ae=k.targetTextWidth-se*i;Goe(k,ae,!0),k.label.x=ie}}function m(I){for(var C={list:[],maxY:0},M={list:[],maxY:0},B=0;B<I.length;B++)if(I[B].labelAlignTo==="none"){var k=I[B],j=k.label.y>t?M:C,q=Math.abs(k.label.y-t);if(q>=j.maxY){var Z=k.label.x-e-k.len2*i,te=r+k.len,ie=Math.abs(Z)<te?Math.sqrt(q*q/(1-Z*Z/te/te)):te;j.rB=ie,j.maxY=q}j.list.push(k)}d(C),d(M)}for(var _=n.length,y=0;y<_;y++)if(n[y].position==="outer"&&n[y].labelAlignTo==="labelLine"){var T=n[y].label.x-h;n[y].linePoints[1][0]+=T,n[y].label.x=h}Coe(n,o,o+a)&&m(n)}function LDe(n,e,t,r,i,s,a,l){for(var o=[],h=[],d=Number.MAX_VALUE,m=-Number.MAX_VALUE,_=0;_<n.length;_++){var y=n[_].label;sk(n[_])||(y.x<e?(d=Math.min(d,y.x),o.push(n[_])):(m=Math.max(m,y.x),h.push(n[_])))}for(var _=0;_<n.length;_++){var T=n[_];if(!sk(T)&&T.linePoints){if(T.labelStyleWidth!=null)continue;var y=T.label,I=T.linePoints,C=void 0;T.labelAlignTo==="edge"?y.x<e?C=I[2][0]-T.labelDistance-a-T.edgeDistance:C=a+i-T.edgeDistance-I[2][0]-T.labelDistance:T.labelAlignTo==="labelLine"?y.x<e?C=d-a-T.bleedMargin:C=a+i-m-T.bleedMargin:y.x<e?C=y.x-a-T.bleedMargin:C=a+i-y.x-T.bleedMargin,T.targetTextWidth=C,Goe(T,C)}}oZ(h,e,t,r,1,i,s,a,l,m),oZ(o,e,t,r,-1,i,s,a,l,d);for(var _=0;_<n.length;_++){var T=n[_];if(!sk(T)&&T.linePoints){var y=T.label,I=T.linePoints,M=T.labelAlignTo==="edge",B=y.style.padding,k=B?B[1]+B[3]:0,j=y.style.backgroundColor?0:k,q=T.rect.width+j,Z=I[1][0]-I[2][0];M?y.x<e?I[2][0]=a+T.edgeDistance+q+T.labelDistance:I[2][0]=a+i-T.edgeDistance-q-T.labelDistance:(y.x<e?I[2][0]=y.x+T.labelDistance:I[2][0]=y.x-T.labelDistance,I[1][0]=I[2][0]+Z),I[1][1]=I[2][1]=y.y}}}function Goe(n,e,t){if(t===void 0&&(t=!1),n.labelStyleWidth==null){var r=n.label,i=r.style,s=n.rect,a=i.backgroundColor,l=i.padding,o=l?l[1]+l[3]:0,h=i.overflow,d=s.width+(a?0:o);if(e<d||t){var m=s.height;if(h&&h.match("break")){r.setStyle("backgroundColor",null),r.setStyle("width",e-o);var _=r.getBoundingRect();r.setStyle("width",Math.ceil(_.width)),r.setStyle("backgroundColor",a)}else{var y=e-o,T=e<d?y:t?y>n.unconstrainedWidth?null:y:null;r.setStyle("width",T)}var I=r.getBoundingRect();s.width=I.width;var C=(r.style.margin||0)+2.1;s.height=I.height+C,s.y-=(s.height-m)/2}}}function sk(n){return n.position==="center"}function DDe(n){var e=n.getData(),t=[],r,i,s=!1,a=(n.get("minShowLabelAngle")||0)*PDe,l=e.getLayout("viewRect"),o=e.getLayout("r"),h=l.width,d=l.x,m=l.y,_=l.height;function y(Z){Z.ignore=!0}function T(Z){if(!Z.ignore)return!0;for(var te in Z.states)if(Z.states[te].ignore===!1)return!0;return!1}e.each(function(Z){var te=e.getItemGraphicEl(Z),ie=te.shape,se=te.getTextContent(),ae=te.getTextGuideLine(),fe=e.getItemModel(Z),Se=fe.getModel("label"),Ee=Se.get("position")||fe.get(["emphasis","label","position"]),Re=Se.get("distanceToLabelLine"),qe=Se.get("alignTo"),Le=os(Se.get("edgeDistance"),h),dt=Se.get("bleedMargin"),ye=fe.getModel("labelLine"),Xe=ye.get("length");Xe=os(Xe,h);var He=ye.get("length2");if(He=os(He,h),Math.abs(ie.endAngle-ie.startAngle)<a){it(se.states,y),se.ignore=!0,ae&&(it(ae.states,y),ae.ignore=!0);return}if(T(se)){var _t=(ie.startAngle+ie.endAngle)/2,wt=Math.cos(_t),Gt=Math.sin(_t),at,Ht,Qt,rn;r=ie.cx,i=ie.cy;var jn=Ee==="inside"||Ee==="inner";if(Ee==="center")at=ie.cx,Ht=ie.cy,rn="center";else{var Bn=(jn?(ie.r+ie.r0)/2*wt:ie.r*wt)+r,Tn=(jn?(ie.r+ie.r0)/2*Gt:ie.r*Gt)+i;if(at=Bn+wt*3,Ht=Tn+Gt*3,!jn){var Pe=Bn+wt*(Xe+o-ie.r),$e=Tn+Gt*(Xe+o-ie.r),mn=Pe+(wt<0?-1:1)*He,cn=$e;qe==="edge"?at=wt<0?d+Le:d+h-Le:at=mn+(wt<0?-Re:Re),Ht=cn,Qt=[[Bn,Tn],[Pe,$e],[mn,cn]]}rn=jn?"center":qe==="edge"?wt>0?"right":"left":wt>0?"left":"right"}var St=Math.PI,Jt=0,kn=Se.get("rotate");if(Is(kn))Jt=kn*(St/180);else if(Ee==="center")Jt=0;else if(kn==="radial"||kn===!0){var Vn=wt<0?-_t+St:-_t;Jt=Vn}else if(kn==="tangential"&&Ee!=="outside"&&Ee!=="outer"){var sn=Math.atan2(wt,Gt);sn<0&&(sn=St*2+sn);var ot=Gt>0;ot&&(sn=St+sn),Jt=sn-St}if(s=!!Jt,se.x=at,se.y=Ht,se.rotation=Jt,se.setStyle({verticalAlign:"middle"}),jn){se.setStyle({align:rn});var An=se.states.select;An&&(An.x+=se.x,An.y+=se.y)}else{var Ue=se.getBoundingRect().clone();Ue.applyTransform(se.getComputedTransform());var $t=(se.style.margin||0)+2.1;Ue.y-=$t/2,Ue.height+=$t,t.push({label:se,labelLine:ae,position:Ee,len:Xe,len2:He,minTurnAngle:ye.get("minTurnAngle"),maxSurfaceAngle:ye.get("maxSurfaceAngle"),surfaceNormal:new Jr(wt,Gt),linePoints:Qt,textAlign:rn,labelDistance:Re,labelAlignTo:qe,edgeDistance:Le,bleedMargin:dt,rect:Ue,unconstrainedWidth:Ue.width,labelStyleWidth:se.style.width})}te.setTextConfig({inside:jn})}}),!s&&n.get("avoidLabelOverlap")&&LDe(t,r,i,o,h,_,d,m);for(var I=0;I<t.length;I++){var C=t[I],M=C.label,B=C.labelLine,k=isNaN(M.x)||isNaN(M.y);if(M){M.setStyle({align:C.textAlign}),k&&(it(M.states,y),M.ignore=!0);var j=M.states.select;j&&(j.x+=M.x,j.y+=M.y)}if(B){var q=C.linePoints;k||!q?(it(B.states,y),B.ignore=!0):(woe(q,C.minTurnAngle),OLe(q,C.surfaceNormal,C.maxSurfaceAngle),B.setShape({points:q}),M.__hostTarget.textGuideLineConfig={anchor:new Jr(q[0][0],q[0][1])})}}}var BDe=function(n){Hn(e,n);function e(t,r,i){var s=n.call(this)||this;s.z2=2;var a=new Ca;return s.setTextContent(a),s.updateData(t,r,i,!0),s}return e.prototype.updateData=function(t,r,i,s){var a=this,l=t.hostModel,o=t.getItemModel(r),h=o.getModel("emphasis"),d=t.getItemLayout(r),m=Jn(wS(o.getModel("itemStyle"),d,!0),d);if(isNaN(m.startAngle)){a.setShape(m);return}if(s){a.setShape(m);var _=l.getShallow("animationType");l.ecModel.ssr?($l(a,{scaleX:0,scaleY:0},l,{dataIndex:r,isFrom:!0}),a.originX=m.cx,a.originY=m.cy):_==="scale"?(a.shape.r=d.r0,$l(a,{shape:{r:d.r}},l,r)):i!=null?(a.setShape({startAngle:i,endAngle:i}),$l(a,{shape:{startAngle:d.startAngle,endAngle:d.endAngle}},l,r)):(a.shape.endAngle=d.startAngle,sl(a,{shape:{endAngle:d.endAngle}},l,r))}else pU(a),sl(a,{shape:m},l,r);a.useStyle(t.getItemVisual(r,"style")),yP(a,o);var y=(d.startAngle+d.endAngle)/2,T=l.get("selectedOffset"),I=Math.cos(y)*T,C=Math.sin(y)*T,M=o.getShallow("cursor");M&&a.attr("cursor",M),this._updateLabel(l,t,r),a.ensureState("emphasis").shape=Jn({r:d.r+(h.get("scale")&&h.get("scaleSize")||0)},wS(h.getModel("itemStyle"),d)),Jn(a.ensureState("select"),{x:I,y:C,shape:wS(o.getModel(["select","itemStyle"]),d)}),Jn(a.ensureState("blur"),{shape:wS(o.getModel(["blur","itemStyle"]),d)});var B=a.getTextGuideLine(),k=a.getTextContent();B&&Jn(B.ensureState("select"),{x:I,y:C}),Jn(k.ensureState("select"),{x:I,y:C}),JA(this,h.get("focus"),h.get("blurScope"),h.get("disabled"))},e.prototype._updateLabel=function(t,r,i){var s=this,a=r.getItemModel(i),l=a.getModel("labelLine"),o=r.getItemVisual(i,"style"),h=o&&o.fill,d=o&&o.opacity;QT(s,eM(a),{labelFetcher:r.hostModel,labelDataIndex:i,inheritColor:h,defaultOpacity:d,defaultText:t.getFormattedLabel(i,"normal")||r.getName(i)});var m=s.getTextContent();s.setTextConfig({position:null,rotation:null}),m.attr({z2:10});var _=t.get(["label","position"]);if(_!=="outside"&&_!=="outer")s.removeTextGuideLine();else{var y=this.getTextGuideLine();y||(y=new xw,this.setTextGuideLine(y)),Soe(this,Aoe(a),{stroke:h,opacity:XS(l.get(["lineStyle","opacity"]),d,1)})}},e}(Dh),kDe=function(n){Hn(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.ignoreLabelLineUpdate=!0,t}return e.prototype.render=function(t,r,i,s){var a=t.getData(),l=this._data,o=this.group,h;if(!l&&a.count()>0){for(var d=a.getItemLayout(0),m=1;isNaN(d&&d.startAngle)&&m<a.count();++m)d=a.getItemLayout(m);d&&(h=d.startAngle)}if(this._emptyCircleSector&&o.remove(this._emptyCircleSector),a.count()===0&&t.get("showEmptyCircle")){var _=Voe(t),y=new Dh({shape:Jn(Uoe(t,i),_)});y.useStyle(t.getModel("emptyCircleStyle").getItemStyle()),this._emptyCircleSector=y,o.add(y)}a.diff(l).add(function(T){var I=new BDe(a,T,h);a.setItemGraphicEl(T,I),o.add(I)}).update(function(T,I){var C=l.getItemGraphicEl(I);C.updateData(a,T,h),C.off("click"),o.add(C),a.setItemGraphicEl(T,C)}).remove(function(T){var I=l.getItemGraphicEl(T);wP(I,t,T)}).execute(),DDe(t),t.get("animationTypeUpdate")!=="expansion"&&(this._data=a)},e.prototype.dispose=function(){},e.prototype.containPoint=function(t,r){var i=r.getData(),s=i.getItemLayout(0);if(s){var a=t[0]-s.cx,l=t[1]-s.cy,o=Math.sqrt(a*a+l*l);return o<=s.r&&o>=s.r0}},e.type="pie",e}(Mh);function ODe(n,e,t){e=fr(e)&&{coordDimensions:e}||Jn({encodeDefine:n.getEncode()},e);var r=n.getSource(),i=eoe(r,e).dimensions,s=new Qse(i,n);return s.initData(r,t),s}var FDe=function(){function n(e,t){this._getDataWithEncodedVisual=e,this._getRawData=t}return n.prototype.getAllNames=function(){var e=this._getRawData();return e.mapArray(e.getName)},n.prototype.containName=function(e){var t=this._getRawData();return t.indexOfName(e)>=0},n.prototype.indexOfName=function(e){var t=this._getDataWithEncodedVisual();return t.indexOfName(e)},n.prototype.getItemVisual=function(e,t){var r=this._getDataWithEncodedVisual();return r.getItemVisual(e,t)},n}(),NDe=Xs(),zDe=function(n){Hn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.init=function(t){n.prototype.init.apply(this,arguments),this.legendVisualProvider=new FDe(Ns(this.getData,this),Ns(this.getRawData,this)),this._defaultLabelLine(t)},e.prototype.mergeOption=function(){n.prototype.mergeOption.apply(this,arguments)},e.prototype.getInitialData=function(){return ODe(this,{coordDimensions:["value"],encodeDefaulter:ms(OEe,this)})},e.prototype.getDataParams=function(t){var r=this.getData(),i=NDe(r),s=i.seats;if(!s){var a=[];r.each(r.mapDimension("value"),function(o){a.push(o)}),s=i.seats=PTe(a,r.hostModel.get("percentPrecision"))}var l=n.prototype.getDataParams.call(this,t);return l.percent=s[t]||0,l.$vars.push("percent"),l},e.prototype._defaultLabelLine=function(t){kF(t,"labelLine",["show"]);var r=t.labelLine,i=t.emphasis.labelLine;r.show=r.show&&t.label.show,i.show=i.show&&t.emphasis.label.show},e.type="series.pie",e.defaultOption={z:2,legendHoverLink:!0,colorBy:"data",center:["50%","50%"],radius:[0,"75%"],clockwise:!0,startAngle:90,endAngle:"auto",padAngle:0,minAngle:0,minShowLabelAngle:0,selectedOffset:10,percentPrecision:2,stillShowZeroSum:!0,left:0,top:0,right:0,bottom:0,width:null,height:null,label:{rotate:0,show:!0,overflow:"truncate",position:"outer",alignTo:"none",edgeDistance:"25%",bleedMargin:10,distanceToLabelLine:5},labelLine:{show:!0,length:15,length2:15,smooth:!1,minTurnAngle:90,maxSurfaceAngle:90,lineStyle:{width:1,type:"solid"}},itemStyle:{borderWidth:1,borderJoin:"round"},showEmptyCircle:!0,emptyCircleStyle:{color:"lightgray",opacity:1},labelLayout:{hideOverlap:!0},emphasis:{scale:!0,scaleSize:5},avoidLabelOverlap:!0,animationType:"expansion",animationDuration:1e3,animationTypeUpdate:"transition",animationEasingUpdate:"cubicInOut",animationDurationUpdate:500,animationEasing:"cubicInOut"},e}(Zf);function UDe(n){return{seriesType:n,reset:function(e,t){var r=e.getData();r.filterSelf(function(i){var s=r.mapDimension("value"),a=r.get(s,i);return!(Is(a)&&!isNaN(a)&&a<0)})}}}function VDe(n){n.registerChartView(kDe),n.registerSeriesModel(zDe),yRe("pie",n.registerAction),n.registerLayout(ms(IDe,"pie")),n.registerProcessor(RDe("pie")),n.registerProcessor(UDe("pie"))}var GDe=function(n){Hn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.type="grid",e.dependencies=["xAxis","yAxis"],e.layoutMode="box",e.defaultOption={show:!1,z:0,left:"10%",top:60,right:"10%",bottom:70,containLabel:!1,backgroundColor:"rgba(0,0,0,0)",borderWidth:1,borderColor:"#ccc"},e}(is),dN=function(n){Hn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getCoordSysModel=function(){return this.getReferringComponents("grid",yl).models[0]},e.type="cartesian2dAxis",e}(is);nd(dN,doe);var Hoe={show:!0,z:0,inverse:!1,name:"",nameLocation:"end",nameRotate:null,nameTruncate:{maxWidth:null,ellipsis:"...",placeholder:"."},nameTextStyle:{},nameGap:15,silent:!1,triggerEvent:!1,tooltip:{show:!1},axisPointer:{},axisLine:{show:!0,onZero:!0,onZeroAxisIndex:null,lineStyle:{color:"#6E7079",width:1,type:"solid"},symbol:["none","none"],symbolSize:[10,15]},axisTick:{show:!0,inside:!1,length:5,lineStyle:{width:1}},axisLabel:{show:!0,inside:!1,rotate:0,showMinLabel:null,showMaxLabel:null,margin:8,fontSize:12},splitLine:{show:!0,lineStyle:{color:["#E0E6F1"],width:1,type:"solid"}},splitArea:{show:!1,areaStyle:{color:["rgba(250,250,250,0.2)","rgba(210,219,238,0.2)"]}}},HDe=Li({boundaryGap:!0,deduplication:null,splitLine:{show:!1},axisTick:{alignWithLabel:!1,interval:"auto"},axisLabel:{interval:"auto"}},Hoe),ZU=Li({boundaryGap:[0,0],axisLine:{show:"auto"},axisTick:{show:"auto"},splitNumber:5,minorTick:{show:!1,splitNumber:5,length:3,lineStyle:{}},minorSplitLine:{show:!1,lineStyle:{color:"#F4F7FD",width:1}}},Hoe),jDe=Li({splitNumber:6,axisLabel:{showMinLabel:!1,showMaxLabel:!1,rich:{primary:{fontWeight:"bold"}}},splitLine:{show:!1}},ZU),WDe=ti({logBase:10},ZU);const XDe={category:HDe,value:ZU,time:jDe,log:WDe};var $De={value:1,category:1,time:1,log:1};function OP(n,e,t,r){it($De,function(i,s){var a=Li(Li({},XDe[s],!0),r,!0),l=function(o){Hn(h,o);function h(){var d=o!==null&&o.apply(this,arguments)||this;return d.type=e+"Axis."+s,d}return h.prototype.mergeDefaultAndTheme=function(d,m){var _=tT(this),y=_?DD(d):{},T=m.getTheme();Li(d,T.get(s+"Axis")),Li(d,this.getDefaultOption()),d.type=aZ(d),_&&Qb(d,y,_)},h.prototype.optionUpdated=function(){var d=this.option;d.type==="category"&&(this.__ordinalMeta=cN.createByAxisModel(this))},h.prototype.getCategories=function(d){var m=this.option;if(m.type==="category")return d?m.data:this.__ordinalMeta.categories},h.prototype.getOrdinalMeta=function(){return this.__ordinalMeta},h.type=e+"Axis."+s,h.defaultOption=a,h}(t);n.registerComponentModel(l)}),n.registerSubTypeDefaulter(e+"Axis",aZ)}function aZ(n){return n.type||(n.data?"category":"value")}var qDe=function(){function n(e){this.type="cartesian",this._dimList=[],this._axes={},this.name=e||""}return n.prototype.getAxis=function(e){return this._axes[e]},n.prototype.getAxes=function(){return xr(this._dimList,function(e){return this._axes[e]},this)},n.prototype.getAxesByScale=function(e){return e=e.toLowerCase(),ta(this.getAxes(),function(t){return t.scale.type===e})},n.prototype.addAxis=function(e){var t=e.dim;this._axes[t]=e,this._dimList.push(t)},n}(),pN=["x","y"];function lZ(n){return n.type==="interval"||n.type==="time"}var ZDe=function(n){Hn(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.type="cartesian2d",t.dimensions=pN,t}return e.prototype.calcAffineTransform=function(){this._transform=this._invTransform=null;var t=this.getAxis("x").scale,r=this.getAxis("y").scale;if(!(!lZ(t)||!lZ(r))){var i=t.getExtent(),s=r.getExtent(),a=this.dataToPoint([i[0],s[0]]),l=this.dataToPoint([i[1],s[1]]),o=i[1]-i[0],h=s[1]-s[0];if(!(!o||!h)){var d=(l[0]-a[0])/o,m=(l[1]-a[1])/h,_=a[0]-i[0]*d,y=a[1]-s[0]*m,T=this._transform=[d,0,0,m,_,y];this._invTransform=cD([],T)}}},e.prototype.getBaseAxis=function(){return this.getAxesByScale("ordinal")[0]||this.getAxesByScale("time")[0]||this.getAxis("x")},e.prototype.containPoint=function(t){var r=this.getAxis("x"),i=this.getAxis("y");return r.contain(r.toLocalCoord(t[0]))&&i.contain(i.toLocalCoord(t[1]))},e.prototype.containData=function(t){return this.getAxis("x").containData(t[0])&&this.getAxis("y").containData(t[1])},e.prototype.containZone=function(t,r){var i=this.dataToPoint(t),s=this.dataToPoint(r),a=this.getArea(),l=new as(i[0],i[1],s[0]-i[0],s[1]-i[1]);return a.intersect(l)},e.prototype.dataToPoint=function(t,r,i){i=i||[];var s=t[0],a=t[1];if(this._transform&&s!=null&&isFinite(s)&&a!=null&&isFinite(a))return Th(i,t,this._transform);var l=this.getAxis("x"),o=this.getAxis("y");return i[0]=l.toGlobalCoord(l.dataToCoord(s,r)),i[1]=o.toGlobalCoord(o.dataToCoord(a,r)),i},e.prototype.clampData=function(t,r){var i=this.getAxis("x").scale,s=this.getAxis("y").scale,a=i.getExtent(),l=s.getExtent(),o=i.parse(t[0]),h=s.parse(t[1]);return r=r||[],r[0]=Math.min(Math.max(Math.min(a[0],a[1]),o),Math.max(a[0],a[1])),r[1]=Math.min(Math.max(Math.min(l[0],l[1]),h),Math.max(l[0],l[1])),r},e.prototype.pointToData=function(t,r){var i=[];if(this._invTransform)return Th(i,t,this._invTransform);var s=this.getAxis("x"),a=this.getAxis("y");return i[0]=s.coordToData(s.toLocalCoord(t[0]),r),i[1]=a.coordToData(a.toLocalCoord(t[1]),r),i},e.prototype.getOtherAxis=function(t){return this.getAxis(t.dim==="x"?"y":"x")},e.prototype.getArea=function(t){t=t||0;var r=this.getAxis("x").getGlobalExtent(),i=this.getAxis("y").getGlobalExtent(),s=Math.min(r[0],r[1])-t,a=Math.min(i[0],i[1])-t,l=Math.max(r[0],r[1])-s+t,o=Math.max(i[0],i[1])-a+t;return new as(s,a,l,o)},e}(qDe),YDe=function(n){Hn(e,n);function e(t,r,i,s,a){var l=n.call(this,t,r,i)||this;return l.index=0,l.type=s||"value",l.position=a||"bottom",l}return e.prototype.isHorizontal=function(){var t=this.position;return t==="top"||t==="bottom"},e.prototype.getGlobalExtent=function(t){var r=this.getExtent();return r[0]=this.toGlobalCoord(r[0]),r[1]=this.toGlobalCoord(r[1]),t&&r[0]>r[1]&&r.reverse(),r},e.prototype.pointToData=function(t,r){return this.coordToData(this.toLocalCoord(t[this.dim==="x"?0:1]),r)},e.prototype.setCategorySortInfo=function(t){if(this.type!=="category")return!1;this.model.option.categorySortInfo=t,this.scale.setSortInfo(t)},e}(yx);function mN(n,e,t){t=t||{};var r=n.coordinateSystem,i=e.axis,s={},a=i.getAxesOnZeroOf()[0],l=i.position,o=a?"onZero":l,h=i.dim,d=r.getRect(),m=[d.x,d.x+d.width,d.y,d.y+d.height],_={left:0,right:1,top:0,bottom:1,onZero:2},y=e.get("offset")||0,T=h==="x"?[m[2]-y,m[3]+y]:[m[0]-y,m[1]+y];if(a){var I=a.toGlobalCoord(a.dataToCoord(0));T[_.onZero]=Math.max(Math.min(I,T[1]),T[0])}s.position=[h==="y"?T[_[o]]:m[0],h==="x"?T[_[o]]:m[3]],s.rotation=Math.PI/2*(h==="x"?0:1);var C={top:-1,bottom:1,left:-1,right:1};s.labelDirection=s.tickDirection=s.nameDirection=C[l],s.labelOffset=a?T[_[l]]-T[_.onZero]:0,e.get(["axisTick","inside"])&&(s.tickDirection=-s.tickDirection),qA(t.labelInside,e.get(["axisLabel","inside"]))&&(s.labelDirection=-s.labelDirection);var M=e.get(["axisLabel","rotate"]);return s.labelRotate=o==="top"?-M:M,s.z2=1,s}function cZ(n){return n.get("coordinateSystem")==="cartesian2d"}function uZ(n){var e={xAxisModel:null,yAxisModel:null};return it(e,function(t,r){var i=r.replace(/Model$/,""),s=n.getReferringComponents(i,yl).models[0];e[r]=s}),e}var ok=Math.log;function KDe(n,e,t){var r=Sw.prototype,i=r.getTicks.call(t),s=r.getTicks.call(t,!0),a=i.length-1,l=r.getInterval.call(t),o=uoe(n,e),h=o.extent,d=o.fixMin,m=o.fixMax;if(n.type==="log"){var _=ok(n.base);h=[ok(h[0])/_,ok(h[1])/_]}n.setExtent(h[0],h[1]),n.calcNiceExtent({splitNumber:a,fixMin:d,fixMax:m});var y=r.getExtent.call(n);d&&(h[0]=y[0]),m&&(h[1]=y[1]);var T=r.getInterval.call(n),I=h[0],C=h[1];if(d&&m)T=(C-I)/a;else if(d)for(C=h[0]+T*a;C<h[1]&&isFinite(C)&&isFinite(h[1]);)T=KB(T),C=h[0]+T*a;else if(m)for(I=h[1]-T*a;I>h[0]&&isFinite(I)&&isFinite(h[0]);)T=KB(T),I=h[1]-T*a;else{var M=n.getTicks().length-1;M>a&&(T=KB(T));var B=T*a;C=Math.ceil(h[1]/T)*T,I=Sa(C-B),I<0&&h[0]>=0?(I=0,C=Sa(B)):C>0&&h[1]<=0&&(C=0,I=-Sa(B))}var k=(i[0].value-s[0].value)/l,j=(i[a].value-s[a].value)/l;r.setExtent.call(n,I+T*k,C+T*j),r.setInterval.call(n,T),(k||j)&&r.setNiceExtent.call(n,I+T,C-T)}var JDe=function(){function n(e,t,r){this.type="grid",this._coordsMap={},this._coordsList=[],this._axesMap={},this._axesList=[],this.axisPointerEnabled=!0,this.dimensions=pN,this._initCartesian(e,t,r),this.model=e}return n.prototype.getRect=function(){return this._rect},n.prototype.update=function(e,t){var r=this._axesMap;this._updateScale(e,this.model);function i(a){var l,o=io(a),h=o.length;if(h){for(var d=[],m=h-1;m>=0;m--){var _=+o[m],y=a[_],T=y.model,I=y.scale;uN(I)&&T.get("alignTicks")&&T.get("interval")==null?d.push(y):(LP(I,T),uN(I)&&(l=y))}d.length&&(l||(l=d.pop(),LP(l.scale,l.model)),it(d,function(C){KDe(C.scale,C.model,l.scale)}))}}i(r.x),i(r.y);var s={};it(r.x,function(a){hZ(r,"y",a,s)}),it(r.y,function(a){hZ(r,"x",a,s)}),this.resize(this.model,t)},n.prototype.resize=function(e,t,r){var i=e.getBoxLayoutParams(),s=!r&&e.get("containLabel"),a=mv(i,{width:t.getWidth(),height:t.getHeight()});this._rect=a;var l=this._axesList;o(),s&&(it(l,function(h){if(!h.model.get(["axisLabel","inside"])){var d=_Le(h);if(d){var m=h.isHorizontal()?"height":"width",_=h.model.get(["axisLabel","margin"]);a[m]-=d[m]+_,h.position==="top"?a.y+=d.height+_:h.position==="left"&&(a.x+=d.width+_)}}}),o()),it(this._coordsList,function(h){h.calcAffineTransform()});function o(){it(l,function(h){var d=h.isHorizontal(),m=d?[0,a.width]:[0,a.height],_=h.inverse?1:0;h.setExtent(m[_],m[1-_]),QDe(h,d?a.x:a.y)})}},n.prototype.getAxis=function(e,t){var r=this._axesMap[e];if(r!=null)return r[t||0]},n.prototype.getAxes=function(){return this._axesList.slice()},n.prototype.getCartesian=function(e,t){if(e!=null&&t!=null){var r="x"+e+"y"+t;return this._coordsMap[r]}Xr(e)&&(t=e.yAxisIndex,e=e.xAxisIndex);for(var i=0,s=this._coordsList;i<s.length;i++)if(s[i].getAxis("x").index===e||s[i].getAxis("y").index===t)return s[i]},n.prototype.getCartesians=function(){return this._coordsList.slice()},n.prototype.convertToPixel=function(e,t,r){var i=this._findConvertTarget(t);return i.cartesian?i.cartesian.dataToPoint(r):i.axis?i.axis.toGlobalCoord(i.axis.dataToCoord(r)):null},n.prototype.convertFromPixel=function(e,t,r){var i=this._findConvertTarget(t);return i.cartesian?i.cartesian.pointToData(r):i.axis?i.axis.coordToData(i.axis.toLocalCoord(r)):null},n.prototype._findConvertTarget=function(e){var t=e.seriesModel,r=e.xAxisModel||t&&t.getReferringComponents("xAxis",yl).models[0],i=e.yAxisModel||t&&t.getReferringComponents("yAxis",yl).models[0],s=e.gridModel,a=this._coordsList,l,o;if(t)l=t.coordinateSystem,Wi(a,l)<0&&(l=null);else if(r&&i)l=this.getCartesian(r.componentIndex,i.componentIndex);else if(r)o=this.getAxis("x",r.componentIndex);else if(i)o=this.getAxis("y",i.componentIndex);else if(s){var h=s.coordinateSystem;h===this&&(l=this._coordsList[0])}return{cartesian:l,axis:o}},n.prototype.containPoint=function(e){var t=this._coordsList[0];if(t)return t.containPoint(e)},n.prototype._initCartesian=function(e,t,r){var i=this,s=this,a={left:!1,right:!1,top:!1,bottom:!1},l={x:{},y:{}},o={x:0,y:0};if(t.eachComponent("xAxis",h("x"),this),t.eachComponent("yAxis",h("y"),this),!o.x||!o.y){this._axesMap={},this._axesList=[];return}this._axesMap=l,it(l.x,function(d,m){it(l.y,function(_,y){var T="x"+m+"y"+y,I=new ZDe(T);I.master=i,I.model=e,i._coordsMap[T]=I,i._coordsList.push(I),I.addAxis(d),I.addAxis(_)})});function h(d){return function(m,_){if(ak(m,e)){var y=m.get("position");d==="x"?y!=="top"&&y!=="bottom"&&(y=a.bottom?"top":"bottom"):y!=="left"&&y!=="right"&&(y=a.left?"right":"left"),a[y]=!0;var T=new YDe(d,hoe(m),[0,0],m.get("type"),y),I=T.type==="category";T.onBand=I&&m.get("boundaryGap"),T.inverse=m.get("inverse"),m.axis=T,T.model=m,T.grid=s,T.index=_,s._axesList.push(T),l[d][_]=T,o[d]++}}}},n.prototype._updateScale=function(e,t){it(this._axesList,function(i){if(i.scale.setExtent(1/0,-1/0),i.type==="category"){var s=i.model.get("categorySortInfo");i.scale.setSortInfo(s)}}),e.eachSeries(function(i){if(cZ(i)){var s=uZ(i),a=s.xAxisModel,l=s.yAxisModel;if(!ak(a,t)||!ak(l,t))return;var o=this.getCartesian(a.componentIndex,l.componentIndex),h=i.getData(),d=o.getAxis("x"),m=o.getAxis("y");r(h,d),r(h,m)}},this);function r(i,s){it(DP(i,s.dim),function(a){s.scale.unionExtentFromData(i,a)})}},n.prototype.getTooltipAxes=function(e){var t=[],r=[];return it(this.getCartesians(),function(i){var s=e!=null&&e!=="auto"?i.getAxis(e):i.getBaseAxis(),a=i.getOtherAxis(s);Wi(t,s)<0&&t.push(s),Wi(r,a)<0&&r.push(a)}),{baseAxes:t,otherAxes:r}},n.create=function(e,t){var r=[];return e.eachComponent("grid",function(i,s){var a=new n(i,e,t);a.name="grid_"+s,a.resize(i,t,!0),i.coordinateSystem=a,r.push(a)}),e.eachSeries(function(i){if(cZ(i)){var s=uZ(i),a=s.xAxisModel,l=s.yAxisModel,o=a.getCoordSysModel(),h=o.coordinateSystem;i.coordinateSystem=h.getCartesian(a.componentIndex,l.componentIndex)}}),r},n.dimensions=pN,n}();function ak(n,e){return n.getCoordSysModel()===e}function hZ(n,e,t,r){t.getAxesOnZeroOf=function(){return s?[s]:[]};var i=n[e],s,a=t.model,l=a.get(["axisLine","onZero"]),o=a.get(["axisLine","onZeroAxisIndex"]);if(!l)return;if(o!=null)fZ(i[o])&&(s=i[o]);else for(var h in i)if(i.hasOwnProperty(h)&&fZ(i[h])&&!r[d(i[h])]){s=i[h];break}s&&(r[d(s)]=!0);function d(m){return m.dim+"_"+m.index}}function fZ(n){return n&&n.type!=="category"&&n.type!=="time"&&vLe(n)}function QDe(n,e){var t=n.getExtent(),r=t[0]+t[1];n.toGlobalCoord=n.dim==="x"?function(i){return i+e}:function(i){return r-i+e},n.toLocalCoord=n.dim==="x"?function(i){return i-e}:function(i){return r-i+e}}var G0=Math.PI,Ch=function(){function n(e,t){this.group=new pa,this.opt=t,this.axisModel=e,ti(t,{labelOffset:0,nameDirection:1,tickDirection:1,labelDirection:1,silent:!0,handleAutoShown:function(){return!0}});var r=new pa({x:t.position[0],y:t.position[1],rotation:t.rotation});r.updateTransform(),this._transformGroup=r}return n.prototype.hasBuilder=function(e){return!!dZ[e]},n.prototype.add=function(e){dZ[e](this.opt,this.axisModel,this.group,this._transformGroup)},n.prototype.getGroup=function(){return this.group},n.innerTextLayout=function(e,t,r){var i=wre(t-e),s,a;return gP(i)?(a=r>0?"top":"bottom",s="center"):gP(i-G0)?(a=r>0?"bottom":"top",s="center"):(a="middle",i>0&&i<G0?s=r>0?"right":"left":s=r>0?"left":"right"),{rotation:i,textAlign:s,textVerticalAlign:a}},n.makeAxisEventDataBase=function(e){var t={componentType:e.mainType,componentIndex:e.componentIndex};return t[e.mainType+"Index"]=e.componentIndex,t},n.isLabelSilent=function(e){var t=e.get("tooltip");return e.get("silent")||!(e.get("triggerEvent")||t&&t.show)},n}(),dZ={axisLine:function(n,e,t,r){var i=e.get(["axisLine","show"]);if(i==="auto"&&n.handleAutoShown&&(i=n.handleAutoShown("axisLine")),!!i){var s=e.axis.getExtent(),a=r.transform,l=[s[0],0],o=[s[1],0],h=l[0]>o[0];a&&(Th(l,l,a),Th(o,o,a));var d=Jn({lineCap:"round"},e.getModel(["axisLine","lineStyle"]).getLineStyle()),m=new Nf({shape:{x1:l[0],y1:l[1],x2:o[0],y2:o[1]},style:d,strokeContainThreshold:n.strokeContainThreshold||5,silent:!0,z2:1});QA(m.shape,m.style.lineWidth),m.anid="line",t.add(m);var _=e.get(["axisLine","symbol"]);if(_!=null){var y=e.get(["axisLine","symbolSize"]);Dr(_)&&(_=[_,_]),(Dr(y)||Is(y))&&(y=[y,y]);var T=Ase(e.get(["axisLine","symbolOffset"])||0,y),I=y[0],C=y[1];it([{rotate:n.rotation+Math.PI/2,offset:T[0],r:0},{rotate:n.rotation-Math.PI/2,offset:T[1],r:Math.sqrt((l[0]-o[0])*(l[0]-o[0])+(l[1]-o[1])*(l[1]-o[1]))}],function(M,B){if(_[B]!=="none"&&_[B]!=null){var k=tw(_[B],-I/2,-C/2,I,C,d.stroke,!0),j=M.r+M.offset,q=h?o:l;k.attr({rotation:M.rotate,x:q[0]+j*Math.cos(n.rotation),y:q[1]-j*Math.sin(n.rotation),silent:!0,z2:11}),t.add(k)}})}}},axisTickLabel:function(n,e,t,r){var i=n3e(t,r,e,n),s=i3e(t,r,e,n);if(t3e(e,s,i),r3e(t,r,e,n.tickDirection),e.get(["axisLabel","hideOverlap"])){var a=Toe(xr(s,function(l){return{label:l,priority:l.z2,defaultAttr:{ignore:l.ignore}}}));Eoe(a)}},axisName:function(n,e,t,r){var i=qA(n.axisName,e.get("name"));if(i){var s=e.get("nameLocation"),a=n.nameDirection,l=e.getModel("nameTextStyle"),o=e.get("nameGap")||0,h=e.axis.getExtent(),d=h[0]>h[1]?-1:1,m=[s==="start"?h[0]-d*o:s==="end"?h[1]+d*o:(h[0]+h[1])/2,mZ(s)?n.labelOffset+a*o:0],_,y=e.get("nameRotate");y!=null&&(y=y*G0/180);var T;mZ(s)?_=Ch.innerTextLayout(n.rotation,y??n.rotation,a):(_=e3e(n.rotation,s,y||0,h),T=n.axisNameAvailableWidth,T!=null&&(T=Math.abs(T/Math.sin(_.rotation)),!isFinite(T)&&(T=null)));var I=l.getFont(),C=e.get("nameTruncate",!0)||{},M=C.ellipsis,B=qA(n.nameTruncateMaxWidth,C.maxWidth,T),k=new Ca({x:m[0],y:m[1],rotation:_.rotation,silent:Ch.isLabelSilent(e),style:Ym(l,{text:i,font:I,overflow:"truncate",width:B,ellipsis:M,fill:l.getTextColor()||e.get(["axisLine","lineStyle","color"]),align:l.get("align")||_.textAlign,verticalAlign:l.get("verticalAlign")||_.textVerticalAlign}),z2:1});if(AD({el:k,componentModel:e,itemName:i}),k.__fullText=i,k.anid="name",e.get("triggerEvent")){var j=Ch.makeAxisEventDataBase(e);j.targetType="axisName",j.name=i,ji(k).eventData=j}r.add(k),k.updateTransform(),t.add(k),k.decomposeTransform()}}};function e3e(n,e,t,r){var i=wre(t-n),s,a,l=r[0]>r[1],o=e==="start"&&!l||e!=="start"&&l;return gP(i-G0/2)?(a=o?"bottom":"top",s="center"):gP(i-G0*1.5)?(a=o?"top":"bottom",s="center"):(a="middle",i<G0*1.5&&i>G0/2?s=o?"left":"right":s=o?"right":"left"),{rotation:i,textAlign:s,textVerticalAlign:a}}function t3e(n,e,t){if(!foe(n.axis)){var r=n.get(["axisLabel","showMinLabel"]),i=n.get(["axisLabel","showMaxLabel"]);e=e||[],t=t||[];var s=e[0],a=e[1],l=e[e.length-1],o=e[e.length-2],h=t[0],d=t[1],m=t[t.length-1],_=t[t.length-2];r===!1?(ah(s),ah(h)):pZ(s,a)&&(r?(ah(a),ah(d)):(ah(s),ah(h))),i===!1?(ah(l),ah(m)):pZ(o,l)&&(i?(ah(o),ah(_)):(ah(l),ah(m)))}}function ah(n){n&&(n.ignore=!0)}function pZ(n,e){var t=n&&n.getBoundingRect().clone(),r=e&&e.getBoundingRect().clone();if(!(!t||!r)){var i=eU([]);return lD(i,i,-n.rotation),t.applyTransform(Eb([],i,n.getLocalTransform())),r.applyTransform(Eb([],i,e.getLocalTransform())),t.intersect(r)}}function mZ(n){return n==="middle"||n==="center"}function joe(n,e,t,r,i){for(var s=[],a=[],l=[],o=0;o<n.length;o++){var h=n[o].coord;a[0]=h,a[1]=0,l[0]=h,l[1]=t,e&&(Th(a,a,e),Th(l,l,e));var d=new Nf({shape:{x1:a[0],y1:a[1],x2:l[0],y2:l[1]},style:r,z2:2,autoBatch:!0,silent:!0});QA(d.shape,d.style.lineWidth),d.anid=i+"_"+n[o].tickValue,s.push(d)}return s}function n3e(n,e,t,r){var i=t.axis,s=t.getModel("axisTick"),a=s.get("show");if(a==="auto"&&r.handleAutoShown&&(a=r.handleAutoShown("axisTick")),!(!a||i.scale.isBlank())){for(var l=s.getModel("lineStyle"),o=r.tickDirection*s.get("length"),h=i.getTicksCoords(),d=joe(h,e.transform,o,ti(l.getLineStyle(),{stroke:t.get(["axisLine","lineStyle","color"])}),"ticks"),m=0;m<d.length;m++)n.add(d[m]);return d}}function r3e(n,e,t,r){var i=t.axis,s=t.getModel("minorTick");if(!(!s.get("show")||i.scale.isBlank())){var a=i.getMinorTicksCoords();if(a.length)for(var l=s.getModel("lineStyle"),o=r*s.get("length"),h=ti(l.getLineStyle(),ti(t.getModel("axisTick").getLineStyle(),{stroke:t.get(["axisLine","lineStyle","color"])})),d=0;d<a.length;d++)for(var m=joe(a[d],e.transform,o,h,"minorticks_"+d),_=0;_<m.length;_++)n.add(m[_])}}function i3e(n,e,t,r){var i=t.axis,s=qA(r.axisLabelShow,t.get(["axisLabel","show"]));if(!(!s||i.scale.isBlank())){var a=t.getModel("axisLabel"),l=a.get("margin"),o=i.getViewLabels(),h=(qA(r.labelRotate,a.get("rotate"))||0)*G0/180,d=Ch.innerTextLayout(r.rotation,h,r.labelDirection),m=t.getCategories&&t.getCategories(!0),_=[],y=Ch.isLabelSilent(t),T=t.get("triggerEvent");return it(o,function(I,C){var M=i.scale.type==="ordinal"?i.scale.getRawOrdinalNumber(I.tickValue):I.tickValue,B=I.formattedLabel,k=I.rawLabel,j=a;if(m&&m[M]){var q=m[M];Xr(q)&&q.textStyle&&(j=new Io(q.textStyle,a,t.ecModel))}var Z=j.getTextColor()||t.get(["axisLine","lineStyle","color"]),te=i.dataToCoord(M),ie=j.getShallow("align",!0)||d.textAlign,se=Ci(j.getShallow("alignMinLabel",!0),ie),ae=Ci(j.getShallow("alignMaxLabel",!0),ie),fe=j.getShallow("verticalAlign",!0)||j.getShallow("baseline",!0)||d.textVerticalAlign,Se=Ci(j.getShallow("verticalAlignMinLabel",!0),fe),Ee=Ci(j.getShallow("verticalAlignMaxLabel",!0),fe),Re=new Ca({x:te,y:r.labelOffset+r.labelDirection*l,rotation:d.rotation,silent:y,z2:10+(I.level||0),style:Ym(j,{text:B,align:C===0?se:C===o.length-1?ae:ie,verticalAlign:C===0?Se:C===o.length-1?Ee:fe,fill:li(Z)?Z(i.type==="category"?k:i.type==="value"?M+"":M,C):Z})});if(Re.anid="label_"+M,T){var qe=Ch.makeAxisEventDataBase(t);qe.targetType="axisLabel",qe.value=k,qe.tickIndex=C,i.type==="category"&&(qe.dataIndex=M),ji(Re).eventData=qe}e.add(Re),Re.updateTransform(),_.push(Re),n.add(Re),Re.decomposeTransform()}),_}}function s3e(n,e){var t={axesInfo:{},seriesInvolved:!1,coordSysAxesInfo:{},coordSysMap:{}};return o3e(t,n,e),t.seriesInvolved&&l3e(t,n),t}function o3e(n,e,t){var r=e.getComponent("tooltip"),i=e.getComponent("axisPointer"),s=i.get("link",!0)||[],a=[];it(t.getCoordinateSystems(),function(l){if(!l.axisPointerEnabled)return;var o=lT(l.model),h=n.coordSysAxesInfo[o]={};n.coordSysMap[o]=l;var d=l.model,m=d.getModel("tooltip",r);if(it(l.getAxes(),ms(I,!1,null)),l.getTooltipAxes&&r&&m.get("show")){var _=m.get("trigger")==="axis",y=m.get(["axisPointer","type"])==="cross",T=l.getTooltipAxes(m.get(["axisPointer","axis"]));(_||y)&&it(T.baseAxes,ms(I,y?"cross":!0,_)),y&&it(T.otherAxes,ms(I,"cross",!1))}function I(C,M,B){var k=B.model.getModel("axisPointer",i),j=k.get("show");if(!(!j||j==="auto"&&!C&&!gN(k))){M==null&&(M=k.get("triggerTooltip")),k=C?a3e(B,m,i,e,C,M):k;var q=k.get("snap"),Z=k.get("triggerEmphasis"),te=lT(B.model),ie=M||q||B.type==="category",se=n.axesInfo[te]={key:te,axis:B,coordSys:l,axisPointerModel:k,triggerTooltip:M,triggerEmphasis:Z,involveSeries:ie,snap:q,useHandle:gN(k),seriesModels:[],linkGroup:null};h[te]=se,n.seriesInvolved=n.seriesInvolved||ie;var ae=c3e(s,B);if(ae!=null){var fe=a[ae]||(a[ae]={axesInfo:{}});fe.axesInfo[te]=se,fe.mapper=s[ae].mapper,se.linkGroup=fe}}}})}function a3e(n,e,t,r,i,s){var a=e.getModel("axisPointer"),l=["type","snap","lineStyle","shadowStyle","label","animation","animationDurationUpdate","animationEasingUpdate","z"],o={};it(l,function(_){o[_]=vi(a.get(_))}),o.snap=n.type!=="category"&&!!s,a.get("type")==="cross"&&(o.type="line");var h=o.label||(o.label={});if(h.show==null&&(h.show=!1),i==="cross"){var d=a.get(["label","show"]);if(h.show=d??!0,!s){var m=o.lineStyle=a.get("crossStyle");m&&ti(h,m.textStyle)}}return n.model.getModel("axisPointer",new Io(o,t,r))}function l3e(n,e){e.eachSeries(function(t){var r=t.coordinateSystem,i=t.get(["tooltip","trigger"],!0),s=t.get(["tooltip","show"],!0);!r||i==="none"||i===!1||i==="item"||s===!1||t.get(["axisPointer","show"],!0)===!1||it(n.coordSysAxesInfo[lT(r.model)],function(a){var l=a.axis;r.getAxis(l.dim)===l&&(a.seriesModels.push(t),a.seriesDataCount==null&&(a.seriesDataCount=0),a.seriesDataCount+=t.getData().count())})})}function c3e(n,e){for(var t=e.model,r=e.dim,i=0;i<n.length;i++){var s=n[i]||{};if(lk(s[r+"AxisId"],t.id)||lk(s[r+"AxisIndex"],t.componentIndex)||lk(s[r+"AxisName"],t.name))return i}}function lk(n,e){return n==="all"||fr(n)&&Wi(n,e)>=0||n===e}function u3e(n){var e=YU(n);if(e){var t=e.axisPointerModel,r=e.axis.scale,i=t.option,s=t.get("status"),a=t.get("value");a!=null&&(a=r.parse(a));var l=gN(t);s==null&&(i.status=l?"show":"hide");var o=r.getExtent().slice();o[0]>o[1]&&o.reverse(),(a==null||a>o[1])&&(a=o[1]),a<o[0]&&(a=o[0]),i.value=a,l&&(i.status=e.axis.scale.isBlank()?"hide":"show")}}function YU(n){var e=(n.ecModel.getComponent("axisPointer")||{}).coordSysAxesInfo;return e&&e.axesInfo[lT(n)]}function h3e(n){var e=YU(n);return e&&e.axisPointerModel}function gN(n){return!!n.get(["handle","show"])}function lT(n){return n.type+"||"+n.id}var gZ={},nM=function(n){Hn(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.render=function(t,r,i,s){this.axisPointerClass&&u3e(t),n.prototype.render.apply(this,arguments),this._doUpdateAxisPointerClass(t,i,!0)},e.prototype.updateAxisPointer=function(t,r,i,s){this._doUpdateAxisPointerClass(t,i,!1)},e.prototype.remove=function(t,r){var i=this._axisPointer;i&&i.remove(r)},e.prototype.dispose=function(t,r){this._disposeAxisPointer(r),n.prototype.dispose.apply(this,arguments)},e.prototype._doUpdateAxisPointerClass=function(t,r,i){var s=e.getAxisPointerClass(this.axisPointerClass);if(s){var a=h3e(t);a?(this._axisPointer||(this._axisPointer=new s)).render(t,a,r,i):this._disposeAxisPointer(r)}},e.prototype._disposeAxisPointer=function(t){this._axisPointer&&this._axisPointer.dispose(t),this._axisPointer=null},e.registerAxisPointerClass=function(t,r){gZ[t]=r},e.getAxisPointerClass=function(t){return t&&gZ[t]},e.type="axis",e}(Rc),vN=Xs();function f3e(n,e,t,r){var i=t.axis;if(!i.scale.isBlank()){var s=t.getModel("splitArea"),a=s.getModel("areaStyle"),l=a.get("color"),o=r.coordinateSystem.getRect(),h=i.getTicksCoords({tickModel:s,clamp:!0});if(h.length){var d=l.length,m=vN(n).splitAreaColors,_=ri(),y=0;if(m)for(var T=0;T<h.length;T++){var I=m.get(h[T].tickValue);if(I!=null){y=(I+(d-1)*T)%d;break}}var C=i.toGlobalCoord(h[0].coord),M=a.getAreaStyle();l=fr(l)?l:[l];for(var T=1;T<h.length;T++){var B=i.toGlobalCoord(h[T].coord),k=void 0,j=void 0,q=void 0,Z=void 0;i.isHorizontal()?(k=C,j=o.y,q=B-k,Z=o.height,C=k+q):(k=o.x,j=C,q=o.width,Z=B-j,C=j+Z);var te=h[T-1].tickValue;te!=null&&_.set(te,y),e.add(new Go({anid:te!=null?"area_"+te:null,shape:{x:k,y:j,width:q,height:Z},style:ti({fill:l[y]},M),autoBatch:!0,silent:!0})),y=(y+1)%d}vN(n).splitAreaColors=_}}}function d3e(n){vN(n).splitAreaColors=null}var p3e=["axisLine","axisTickLabel","axisName"],m3e=["splitArea","splitLine","minorSplitLine"],Woe=function(n){Hn(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.type=e.type,t.axisPointerClass="CartesianAxisPointer",t}return e.prototype.render=function(t,r,i,s){this.group.removeAll();var a=this._axisGroup;if(this._axisGroup=new pa,this.group.add(this._axisGroup),!!t.get("show")){var l=t.getCoordSysModel(),o=mN(l,t),h=new Ch(t,Jn({handleAutoShown:function(m){for(var _=l.coordinateSystem.getCartesians(),y=0;y<_.length;y++)if(uN(_[y].getOtherAxis(t.axis).scale))return!0;return!1}},o));it(p3e,h.add,h),this._axisGroup.add(h.getGroup()),it(m3e,function(m){t.get([m,"show"])&&g3e[m](this,this._axisGroup,t,l)},this);var d=s&&s.type==="changeAxisOrder"&&s.isInitSort;d||vU(a,this._axisGroup,t),n.prototype.render.call(this,t,r,i,s)}},e.prototype.remove=function(){d3e(this)},e.type="cartesianAxis",e}(nM),g3e={splitLine:function(n,e,t,r){var i=t.axis;if(!i.scale.isBlank()){var s=t.getModel("splitLine"),a=s.getModel("lineStyle"),l=a.get("color");l=fr(l)?l:[l];for(var o=r.coordinateSystem.getRect(),h=i.isHorizontal(),d=0,m=i.getTicksCoords({tickModel:s}),_=[],y=[],T=a.getLineStyle(),I=0;I<m.length;I++){var C=i.toGlobalCoord(m[I].coord);h?(_[0]=C,_[1]=o.y,y[0]=C,y[1]=o.y+o.height):(_[0]=o.x,_[1]=C,y[0]=o.x+o.width,y[1]=C);var M=d++%l.length,B=m[I].tickValue,k=new Nf({anid:B!=null?"line_"+m[I].tickValue:null,autoBatch:!0,shape:{x1:_[0],y1:_[1],x2:y[0],y2:y[1]},style:ti({stroke:l[M]},T),silent:!0});QA(k.shape,T.lineWidth),e.add(k)}}},minorSplitLine:function(n,e,t,r){var i=t.axis,s=t.getModel("minorSplitLine"),a=s.getModel("lineStyle"),l=r.coordinateSystem.getRect(),o=i.isHorizontal(),h=i.getMinorTicksCoords();if(h.length)for(var d=[],m=[],_=a.getLineStyle(),y=0;y<h.length;y++)for(var T=0;T<h[y].length;T++){var I=i.toGlobalCoord(h[y][T].coord);o?(d[0]=I,d[1]=l.y,m[0]=I,m[1]=l.y+l.height):(d[0]=l.x,d[1]=I,m[0]=l.x+l.width,m[1]=I);var C=new Nf({anid:"minor_line_"+h[y][T].tickValue,autoBatch:!0,shape:{x1:d[0],y1:d[1],x2:m[0],y2:m[1]},style:_,silent:!0});QA(C.shape,_.lineWidth),e.add(C)}},splitArea:function(n,e,t,r){f3e(n,e,t,r)}},Xoe=function(n){Hn(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.type=e.type,t}return e.type="xAxis",e}(Woe),v3e=function(n){Hn(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.type=Xoe.type,t}return e.type="yAxis",e}(Woe),_3e=function(n){Hn(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.type="grid",t}return e.prototype.render=function(t,r){this.group.removeAll(),t.get("show")&&this.group.add(new Go({shape:t.coordinateSystem.getRect(),style:ti({fill:t.get("backgroundColor")},t.getItemStyle()),silent:!0,z2:-1}))},e.type="grid",e}(Rc),vZ={offset:0};function y3e(n){n.registerComponentView(_3e),n.registerComponentModel(GDe),n.registerCoordinateSystem("cartesian2d",JDe),OP(n,"x",dN,vZ),OP(n,"y",dN,vZ),n.registerComponentView(Xoe),n.registerComponentView(v3e),n.registerPreprocessor(function(e){e.xAxis&&e.yAxis&&!e.grid&&(e.grid={})})}var _Z="\0_ec_interaction_mutex";function x3e(n,e,t){var r=$oe(n);r[e]=t}function b3e(n,e,t){var r=$oe(n),i=r[e];i===t&&(r[e]=null)}function $oe(n){return n[_Z]||(n[_Z]={})}vp({type:"takeGlobalCursor",event:"globalCursorTaken",update:"update"},Cc);var w3e={axisPointer:1,tooltip:1,brush:1};function S3e(n,e,t){var r=e.getComponentByElement(n.topTarget),i=r&&r.coordinateSystem;return r&&r!==t&&!w3e.hasOwnProperty(r.mainType)&&i&&i.model!==t}function qoe(n,e,t,r,i,s){n=n||0;var a=t[1]-t[0];if(i!=null&&(i=B1(i,[0,a])),s!=null&&(s=Math.max(s,i??0)),r==="all"){var l=Math.abs(e[1]-e[0]);l=B1(l,[0,a]),i=s=B1(l,[i,s]),r=0}e[0]=B1(e[0],t),e[1]=B1(e[1],t);var o=ck(e,r);e[r]+=n;var h=i||0,d=t.slice();o.sign<0?d[0]+=h:d[1]-=h,e[r]=B1(e[r],d);var m;return m=ck(e,r),i!=null&&(m.sign!==o.sign||m.span<i)&&(e[1-r]=e[r]+o.sign*i),m=ck(e,r),s!=null&&m.span>s&&(e[1-r]=e[r]+m.sign*s),e}function ck(n,e){var t=n[e]-n[1-e];return{span:Math.abs(t),sign:t>0?-1:t<0?1:e?-1:1}}function B1(n,e){return Math.min(e[1]!=null?e[1]:1/0,Math.max(e[0]!=null?e[0]:-1/0,n))}var nx=!0,cT=Math.min,nw=Math.max,A3e=Math.pow,T3e=1e4,M3e=6,C3e=6,yZ="globalPan",E3e={w:[0,0],e:[0,1],n:[1,0],s:[1,1]},I3e={w:"ew",e:"ew",n:"ns",s:"ns",ne:"nesw",sw:"nesw",nw:"nwse",se:"nwse"},xZ={brushStyle:{lineWidth:2,stroke:"rgba(210,219,238,0.3)",fill:"#D2DBEE"},transformable:!0,brushMode:"single",removeOnClick:!1},R3e=0,P3e=function(n){Hn(e,n);function e(t){var r=n.call(this)||this;return r._track=[],r._covers=[],r._handlers={},r._zr=t,r.group=new pa,r._uid="brushController_"+R3e++,it(N3e,function(i,s){this._handlers[s]=Ns(i,this)},r),r}return e.prototype.enableBrush=function(t){return this._brushType&&this._doDisableBrush(),t.brushType&&this._doEnableBrush(t),this},e.prototype._doEnableBrush=function(t){var r=this._zr;this._enableGlobalPan||x3e(r,yZ,this._uid),it(this._handlers,function(i,s){r.on(s,i)}),this._brushType=t.brushType,this._brushOption=Li(vi(xZ),t,!0)},e.prototype._doDisableBrush=function(){var t=this._zr;b3e(t,yZ,this._uid),it(this._handlers,function(r,i){t.off(i,r)}),this._brushType=this._brushOption=null},e.prototype.setPanels=function(t){if(t&&t.length){var r=this._panels={};it(t,function(i){r[i.panelId]=vi(i)})}else this._panels=null;return this},e.prototype.mount=function(t){t=t||{},this._enableGlobalPan=t.enableGlobalPan;var r=this.group;return this._zr.add(r),r.attr({x:t.x||0,y:t.y||0,rotation:t.rotation||0,scaleX:t.scaleX||1,scaleY:t.scaleY||1}),this._transform=r.getLocalTransform(),this},e.prototype.updateCovers=function(t){t=xr(t,function(_){return Li(vi(xZ),_,!0)});var r="\0-brush-index-",i=this._covers,s=this._covers=[],a=this,l=this._creatingCover;return new oT(i,t,h,o).add(d).update(d).remove(m).execute(),this;function o(_,y){return(_.id!=null?_.id:r+y)+"-"+_.brushType}function h(_,y){return o(_.__brushOption,y)}function d(_,y){var T=t[_];if(y!=null&&i[y]===l)s[_]=i[y];else{var I=s[_]=y!=null?(i[y].__brushOption=T,i[y]):Yoe(a,Zoe(a,T));KU(a,I)}}function m(_){i[_]!==l&&a.group.remove(i[_])}},e.prototype.unmount=function(){return this.enableBrush(!1),_N(this),this._zr.remove(this.group),this},e.prototype.dispose=function(){this.unmount(),this.off()},e}(rd);function Zoe(n,e){var t=UD[e.brushType].createCover(n,e);return t.__brushOption=e,Joe(t,e),n.group.add(t),t}function Yoe(n,e){var t=JU(e);return t.endCreating&&(t.endCreating(n,e),Joe(e,e.__brushOption)),e}function Koe(n,e){var t=e.__brushOption;JU(e).updateCoverShape(n,e,t.range,t)}function Joe(n,e){var t=e.z;t==null&&(t=T3e),n.traverse(function(r){r.z=t,r.z2=t})}function KU(n,e){JU(e).updateCommon(n,e),Koe(n,e)}function JU(n){return UD[n.__brushOption.brushType]}function QU(n,e,t){var r=n._panels;if(!r)return nx;var i,s=n._transform;return it(r,function(a){a.isTargetByCursor(e,t,s)&&(i=a)}),i}function Qoe(n,e){var t=n._panels;if(!t)return nx;var r=e.__brushOption.panelId;return r!=null?t[r]:nx}function _N(n){var e=n._covers,t=e.length;return it(e,function(r){n.group.remove(r)},n),e.length=0,!!t}function rx(n,e){var t=xr(n._covers,function(r){var i=r.__brushOption,s=vi(i.range);return{brushType:i.brushType,panelId:i.panelId,range:s}});n.trigger("brush",{areas:t,isEnd:!!e.isEnd,removeOnClick:!!e.removeOnClick})}function L3e(n){var e=n._track;if(!e.length)return!1;var t=e[e.length-1],r=e[0],i=t[0]-r[0],s=t[1]-r[1],a=A3e(i*i+s*s,.5);return a>M3e}function eae(n){var e=n.length-1;return e<0&&(e=0),[n[0],n[e]]}function tae(n,e,t,r){var i=new pa;return i.add(new Go({name:"main",style:e8(t),silent:!0,draggable:!0,cursor:"move",drift:ms(bZ,n,e,i,["n","s","w","e"]),ondragend:ms(rx,e,{isEnd:!0})})),it(r,function(s){i.add(new Go({name:s.join(""),style:{opacity:0},draggable:!0,silent:!0,invisible:!0,drift:ms(bZ,n,e,i,s),ondragend:ms(rx,e,{isEnd:!0})}))}),i}function nae(n,e,t,r){var i=r.brushStyle.lineWidth||0,s=nw(i,C3e),a=t[0][0],l=t[1][0],o=a-i/2,h=l-i/2,d=t[0][1],m=t[1][1],_=d-s+i/2,y=m-s+i/2,T=d-a,I=m-l,C=T+i,M=I+i;dm(n,e,"main",a,l,T,I),r.transformable&&(dm(n,e,"w",o,h,s,M),dm(n,e,"e",_,h,s,M),dm(n,e,"n",o,h,C,s),dm(n,e,"s",o,y,C,s),dm(n,e,"nw",o,h,s,s),dm(n,e,"ne",_,h,s,s),dm(n,e,"sw",o,y,s,s),dm(n,e,"se",_,y,s,s))}function yN(n,e){var t=e.__brushOption,r=t.transformable,i=e.childAt(0);i.useStyle(e8(t)),i.attr({silent:!r,cursor:r?"move":"default"}),it([["w"],["e"],["n"],["s"],["s","e"],["s","w"],["n","e"],["n","w"]],function(s){var a=e.childOfName(s.join("")),l=s.length===1?xN(n,s[0]):B3e(n,s);a&&a.attr({silent:!r,invisible:!r,cursor:r?I3e[l]+"-resize":null})})}function dm(n,e,t,r,i,s,a){var l=e.childOfName(t);l&&l.setShape(O3e(t8(n,e,[[r,i],[r+s,i+a]])))}function e8(n){return ti({strokeNoScale:!0},n.brushStyle)}function rae(n,e,t,r){var i=[cT(n,t),cT(e,r)],s=[nw(n,t),nw(e,r)];return[[i[0],s[0]],[i[1],s[1]]]}function D3e(n){return gU(n.group)}function xN(n,e){var t={w:"left",e:"right",n:"top",s:"bottom"},r={left:"w",right:"e",top:"n",bottom:"s"},i=yie(t[e],D3e(n));return r[i]}function B3e(n,e){var t=[xN(n,e[0]),xN(n,e[1])];return(t[0]==="e"||t[0]==="w")&&t.reverse(),t.join("")}function bZ(n,e,t,r,i,s){var a=t.__brushOption,l=n.toRectRange(a.range),o=iae(e,i,s);it(r,function(h){var d=E3e[h];l[d[0]][d[1]]+=o[d[0]]}),a.range=n.fromRectRange(rae(l[0][0],l[1][0],l[0][1],l[1][1])),KU(e,t),rx(e,{isEnd:!1})}function k3e(n,e,t,r){var i=e.__brushOption.range,s=iae(n,t,r);it(i,function(a){a[0]+=s[0],a[1]+=s[1]}),KU(n,e),rx(n,{isEnd:!1})}function iae(n,e,t){var r=n.group,i=r.transformCoordToLocal(e,t),s=r.transformCoordToLocal(0,0);return[i[0]-s[0],i[1]-s[1]]}function t8(n,e,t){var r=Qoe(n,e);return r&&r!==nx?r.clipPath(t,n._transform):vi(t)}function O3e(n){var e=cT(n[0][0],n[1][0]),t=cT(n[0][1],n[1][1]),r=nw(n[0][0],n[1][0]),i=nw(n[0][1],n[1][1]);return{x:e,y:t,width:r-e,height:i-t}}function F3e(n,e,t){if(!(!n._brushType||z3e(n,e.offsetX,e.offsetY))){var r=n._zr,i=n._covers,s=QU(n,e,t);if(!n._dragging)for(var a=0;a<i.length;a++){var l=i[a].__brushOption;if(s&&(s===nx||l.panelId===s.panelId)&&UD[l.brushType].contain(i[a],t[0],t[1]))return}s&&r.setCursorStyle("crosshair")}}function bN(n){var e=n.event;e.preventDefault&&e.preventDefault()}function wN(n,e,t){return n.childOfName("main").contain(e,t)}function sae(n,e,t,r){var i=n._creatingCover,s=n._creatingPanel,a=n._brushOption,l;if(n._track.push(t.slice()),L3e(n)||i){if(s&&!i){a.brushMode==="single"&&_N(n);var o=vi(a);o.brushType=wZ(o.brushType,s),o.panelId=s===nx?null:s.panelId,i=n._creatingCover=Zoe(n,o),n._covers.push(i)}if(i){var h=UD[wZ(n._brushType,s)],d=i.__brushOption;d.range=h.getCreatingRange(t8(n,i,n._track)),r&&(Yoe(n,i),h.updateCommon(n,i)),Koe(n,i),l={isEnd:r}}}else r&&a.brushMode==="single"&&a.removeOnClick&&QU(n,e,t)&&_N(n)&&(l={isEnd:r,removeOnClick:!0});return l}function wZ(n,e){return n==="auto"?e.defaultBrushType:n}var N3e={mousedown:function(n){if(this._dragging)SZ(this,n);else if(!n.target||!n.target.draggable){bN(n);var e=this.group.transformCoordToLocal(n.offsetX,n.offsetY);this._creatingCover=null;var t=this._creatingPanel=QU(this,n,e);t&&(this._dragging=!0,this._track=[e.slice()])}},mousemove:function(n){var e=n.offsetX,t=n.offsetY,r=this.group.transformCoordToLocal(e,t);if(F3e(this,n,r),this._dragging){bN(n);var i=sae(this,n,r,!1);i&&rx(this,i)}},mouseup:function(n){SZ(this,n)}};function SZ(n,e){if(n._dragging){bN(e);var t=e.offsetX,r=e.offsetY,i=n.group.transformCoordToLocal(t,r),s=sae(n,e,i,!0);n._dragging=!1,n._track=[],n._creatingCover=null,s&&rx(n,s)}}function z3e(n,e,t){var r=n._zr;return e<0||e>r.getWidth()||t<0||t>r.getHeight()}var UD={lineX:AZ(0),lineY:AZ(1),rect:{createCover:function(n,e){function t(r){return r}return tae({toRectRange:t,fromRectRange:t},n,e,[["w"],["e"],["n"],["s"],["s","e"],["s","w"],["n","e"],["n","w"]])},getCreatingRange:function(n){var e=eae(n);return rae(e[1][0],e[1][1],e[0][0],e[0][1])},updateCoverShape:function(n,e,t,r){nae(n,e,t,r)},updateCommon:yN,contain:wN},polygon:{createCover:function(n,e){var t=new pa;return t.add(new xw({name:"main",style:e8(e),silent:!0})),t},getCreatingRange:function(n){return n},endCreating:function(n,e){e.remove(e.childAt(0)),e.add(new yD({name:"main",draggable:!0,drift:ms(k3e,n,e),ondragend:ms(rx,n,{isEnd:!0})}))},updateCoverShape:function(n,e,t,r){e.childAt(0).setShape({points:t8(n,e,t)})},updateCommon:yN,contain:wN}};function AZ(n){return{createCover:function(e,t){return tae({toRectRange:function(r){var i=[r,[0,100]];return n&&i.reverse(),i},fromRectRange:function(r){return r[n]}},e,t,[[["w"],["e"]],[["n"],["s"]]][n])},getCreatingRange:function(e){var t=eae(e),r=cT(t[0][n],t[1][n]),i=nw(t[0][n],t[1][n]);return[r,i]},updateCoverShape:function(e,t,r,i){var s,a=Qoe(e,t);if(a!==nx&&a.getLinearBrushOtherExtent)s=a.getLinearBrushOtherExtent(n);else{var l=e._zr;s=[0,[l.getWidth(),l.getHeight()][1-n]]}var o=[r,s];n&&o.reverse(),nae(e,t,o,i)},updateCommon:yN,contain:wN}}function U3e(n){return n=n8(n),function(e){return xie(e,n)}}function V3e(n,e){return n=n8(n),function(t){var r=e??t,i=r?n.width:n.height,s=r?n.x:n.y;return[s,s+(i||0)]}}function G3e(n,e,t){var r=n8(n);return function(i,s){return r.contain(s[0],s[1])&&!S3e(i,e,t)}}function n8(n){return as.create(n)}var cy=Xs(),TZ=vi,uk=Ns,oae=function(){function n(){this._dragging=!1,this.animationThreshold=15}return n.prototype.render=function(e,t,r,i){var s=t.get("value"),a=t.get("status");if(this._axisModel=e,this._axisPointerModel=t,this._api=r,!(!i&&this._lastValue===s&&this._lastStatus===a)){this._lastValue=s,this._lastStatus=a;var l=this._group,o=this._handle;if(!a||a==="hide"){l&&l.hide(),o&&o.hide();return}l&&l.show(),o&&o.show();var h={};this.makeElOption(h,s,e,t,r);var d=h.graphicKey;d!==this._lastGraphicKey&&this.clear(r),this._lastGraphicKey=d;var m=this._moveAnimation=this.determineAnimation(e,t);if(!l)l=this._group=new pa,this.createPointerEl(l,h,e,t),this.createLabelEl(l,h,e,t),r.getZr().add(l);else{var _=ms(MZ,t,m);this.updatePointerEl(l,h,_),this.updateLabelEl(l,h,_,t)}EZ(l,t,!0),this._renderHandle(s)}},n.prototype.remove=function(e){this.clear(e)},n.prototype.dispose=function(e){this.clear(e)},n.prototype.determineAnimation=function(e,t){var r=t.get("animation"),i=e.axis,s=i.type==="category",a=t.get("snap");if(!a&&!s)return!1;if(r==="auto"||r==null){var l=this.animationThreshold;if(s&&i.getBandWidth()>l)return!0;if(a){var o=YU(e).seriesDataCount,h=i.getExtent();return Math.abs(h[0]-h[1])/o>l}return!1}return r===!0},n.prototype.makeElOption=function(e,t,r,i,s){},n.prototype.createPointerEl=function(e,t,r,i){var s=t.pointer;if(s){var a=cy(e).pointerEl=new _U[s.type](TZ(t.pointer));e.add(a)}},n.prototype.createLabelEl=function(e,t,r,i){if(t.label){var s=cy(e).labelEl=new Ca(TZ(t.label));e.add(s),CZ(s,i)}},n.prototype.updatePointerEl=function(e,t,r){var i=cy(e).pointerEl;i&&t.pointer&&(i.setStyle(t.pointer.style),r(i,{shape:t.pointer.shape}))},n.prototype.updateLabelEl=function(e,t,r,i){var s=cy(e).labelEl;s&&(s.setStyle(t.label.style),r(s,{x:t.label.x,y:t.label.y}),CZ(s,i))},n.prototype._renderHandle=function(e){if(!(this._dragging||!this.updateHandleTransform)){var t=this._axisPointerModel,r=this._api.getZr(),i=this._handle,s=t.getModel("handle"),a=t.get("status");if(!s.get("show")||!a||a==="hide"){i&&r.remove(i),this._handle=null;return}var l;this._handle||(l=!0,i=this._handle=SD(s.get("icon"),{cursor:"move",draggable:!0,onmousemove:function(h){tre(h.event)},onmousedown:uk(this._onHandleDragMove,this,0,0),drift:uk(this._onHandleDragMove,this),ondragend:uk(this._onHandleDragEnd,this)}),r.add(i)),EZ(i,t,!1),i.setStyle(s.getItemStyle(null,["color","borderColor","borderWidth","opacity","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY"]));var o=s.get("size");fr(o)||(o=[o,o]),i.scaleX=o[0]/2,i.scaleY=o[1]/2,gse(this,"_doDispatchAxisPointer",s.get("throttle")||0,"fixRate"),this._moveHandleToValue(e,l)}},n.prototype._moveHandleToValue=function(e,t){MZ(this._axisPointerModel,!t&&this._moveAnimation,this._handle,hk(this.getHandleTransform(e,this._axisModel,this._axisPointerModel)))},n.prototype._onHandleDragMove=function(e,t){var r=this._handle;if(r){this._dragging=!0;var i=this.updateHandleTransform(hk(r),[e,t],this._axisModel,this._axisPointerModel);this._payloadInfo=i,r.stopAnimation(),r.attr(hk(i)),cy(r).lastProp=null,this._doDispatchAxisPointer()}},n.prototype._doDispatchAxisPointer=function(){var e=this._handle;if(e){var t=this._payloadInfo,r=this._axisModel;this._api.dispatchAction({type:"updateAxisPointer",x:t.cursorPoint[0],y:t.cursorPoint[1],tooltipOption:t.tooltipOption,axesInfo:[{axisDim:r.axis.dim,axisIndex:r.componentIndex}]})}},n.prototype._onHandleDragEnd=function(){this._dragging=!1;var e=this._handle;if(e){var t=this._axisPointerModel.get("value");this._moveHandleToValue(t),this._api.dispatchAction({type:"hideTip"})}},n.prototype.clear=function(e){this._lastValue=null,this._lastStatus=null;var t=e.getZr(),r=this._group,i=this._handle;t&&r&&(this._lastGraphicKey=null,r&&t.remove(r),i&&t.remove(i),this._group=null,this._handle=null,this._payloadInfo=null),eN(this,"_doDispatchAxisPointer")},n.prototype.doClear=function(){},n.prototype.buildLabel=function(e,t,r){return r=r||0,{x:e[r],y:e[1-r],width:t[r],height:t[1-r]}},n}();function MZ(n,e,t,r){aae(cy(t).lastProp,r)||(cy(t).lastProp=r,e?sl(t,r,n):(t.stopAnimation(),t.attr(r)))}function aae(n,e){if(Xr(n)&&Xr(e)){var t=!0;return it(e,function(r,i){t=t&&aae(n[i],r)}),!!t}else return n===e}function CZ(n,e){n[e.get(["label","show"])?"show":"hide"]()}function hk(n){return{x:n.x||0,y:n.y||0,rotation:n.rotation||0}}function EZ(n,e,t){var r=e.get("z"),i=e.get("zlevel");n&&n.traverse(function(s){s.type!=="group"&&(r!=null&&(s.z=r),i!=null&&(s.zlevel=i),s.silent=t)})}function lae(n){var e=n.get("type"),t=n.getModel(e+"Style"),r;return e==="line"?(r=t.getLineStyle(),r.fill=null):e==="shadow"&&(r=t.getAreaStyle(),r.stroke=null),r}function cae(n,e,t,r,i){var s=t.get("value"),a=uae(s,e.axis,e.ecModel,t.get("seriesDataIndices"),{precision:t.get(["label","precision"]),formatter:t.get(["label","formatter"])}),l=t.getModel("label"),o=LD(l.get("padding")||0),h=l.getFont(),d=YT(a,h),m=i.position,_=d.width+o[1]+o[3],y=d.height+o[0]+o[2],T=i.align;T==="right"&&(m[0]-=_),T==="center"&&(m[0]-=_/2);var I=i.verticalAlign;I==="bottom"&&(m[1]-=y),I==="middle"&&(m[1]-=y/2),H3e(m,_,y,r);var C=l.get("backgroundColor");(!C||C==="auto")&&(C=e.get(["axisLine","lineStyle","color"])),n.label={x:m[0],y:m[1],style:Ym(l,{text:a,font:h,fill:l.getTextColor(),padding:o,backgroundColor:C}),z2:10}}function H3e(n,e,t,r){var i=r.getWidth(),s=r.getHeight();n[0]=Math.min(n[0]+e,i)-e,n[1]=Math.min(n[1]+t,s)-t,n[0]=Math.max(n[0],0),n[1]=Math.max(n[1],0)}function uae(n,e,t,r,i){n=e.scale.parse(n);var s=e.scale.getLabel({value:n},{precision:i.precision}),a=i.formatter;if(a){var l={value:jU(e,{value:n}),axisDimension:e.dim,axisIndex:e.index,seriesData:[]};it(r,function(o){var h=t.getSeriesByIndex(o.seriesIndex),d=o.dataIndexInside,m=h&&h.getDataParams(d);m&&l.seriesData.push(m)}),Dr(a)?s=a.replace("{value}",s):li(a)&&(s=a(l))}return s}function hae(n,e,t){var r=Dy();return lD(r,r,t.rotation),lP(r,r,t.position),wD([n.dataToCoord(e),(t.labelOffset||0)+(t.labelDirection||1)*(t.labelMargin||0)],r)}function j3e(n,e,t,r,i,s){var a=Ch.innerTextLayout(t.rotation,0,t.labelDirection);t.labelMargin=i.get(["label","margin"]),cae(e,r,i,s,{position:hae(r.axis,n,t),align:a.textAlign,verticalAlign:a.textVerticalAlign})}function fae(n,e,t){return t=t||0,{x1:n[t],y1:n[1-t],x2:e[t],y2:e[1-t]}}function W3e(n,e,t){return t=t||0,{x:n[t],y:n[1-t],width:e[t],height:e[1-t]}}function IZ(n,e,t,r,i,s){return{cx:n,cy:e,r0:t,r,startAngle:i,endAngle:s,clockwise:!0}}var X3e=function(n){Hn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.makeElOption=function(t,r,i,s,a){var l=i.axis,o=l.grid,h=s.get("type"),d=RZ(o,l).getOtherAxis(l).getGlobalExtent(),m=l.toGlobalCoord(l.dataToCoord(r,!0));if(h&&h!=="none"){var _=lae(s),y=$3e[h](l,m,d);y.style=_,t.graphicKey=y.type,t.pointer=y}var T=mN(o.model,i);j3e(r,t,T,i,s,a)},e.prototype.getHandleTransform=function(t,r,i){var s=mN(r.axis.grid.model,r,{labelInside:!1});s.labelMargin=i.get(["handle","margin"]);var a=hae(r.axis,t,s);return{x:a[0],y:a[1],rotation:s.rotation+(s.labelDirection<0?Math.PI:0)}},e.prototype.updateHandleTransform=function(t,r,i,s){var a=i.axis,l=a.grid,o=a.getGlobalExtent(!0),h=RZ(l,a).getOtherAxis(a).getGlobalExtent(),d=a.dim==="x"?0:1,m=[t.x,t.y];m[d]+=r[d],m[d]=Math.min(o[1],m[d]),m[d]=Math.max(o[0],m[d]);var _=(h[1]+h[0])/2,y=[_,_];y[d]=m[d];var T=[{verticalAlign:"middle"},{align:"center"}];return{x:m[0],y:m[1],rotation:t.rotation,cursorPoint:y,tooltipOption:T[d]}},e}(oae);function RZ(n,e){var t={};return t[e.dim+"AxisIndex"]=e.index,n.getCartesian(t)}var $3e={line:function(n,e,t){var r=fae([e,t[0]],[e,t[1]],PZ(n));return{type:"Line",subPixelOptimize:!0,shape:r}},shadow:function(n,e,t){var r=Math.max(1,n.getBandWidth()),i=t[1]-t[0];return{type:"Rect",shape:W3e([e-r/2,t[0]],[r,i],PZ(n))}}};function PZ(n){return n.dim==="x"?0:1}var q3e=function(n){Hn(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.type=e.type,t}return e.type="axisPointer",e.defaultOption={show:"auto",z:50,type:"line",snap:!1,triggerTooltip:!0,triggerEmphasis:!0,value:null,status:null,link:[],animation:null,animationDurationUpdate:200,lineStyle:{color:"#B9BEC9",width:1,type:"dashed"},shadowStyle:{color:"rgba(210,219,238,0.2)"},label:{show:!0,formatter:null,precision:"auto",margin:3,color:"#fff",padding:[5,7,5,7],backgroundColor:"auto",borderColor:null,borderWidth:0,borderRadius:3},handle:{show:!1,icon:"M10.7,11.9v-1.3H9.3v1.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4h1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7v-1.2h6.6z M13.3,22H6.7v-1.2h6.6z M13.3,19.6H6.7v-1.2h6.6z",size:45,margin:50,color:"#333",shadowBlur:3,shadowColor:"#aaa",shadowOffsetX:0,shadowOffsetY:2,throttle:40}},e}(is),Rm=Xs(),Z3e=it;function dae(n,e,t){if(!pi.node){var r=e.getZr();Rm(r).records||(Rm(r).records={}),Y3e(r,e);var i=Rm(r).records[n]||(Rm(r).records[n]={});i.handler=t}}function Y3e(n,e){if(Rm(n).initialized)return;Rm(n).initialized=!0,t("click",ms(LZ,"click")),t("mousemove",ms(LZ,"mousemove")),t("globalout",J3e);function t(r,i){n.on(r,function(s){var a=Q3e(e);Z3e(Rm(n).records,function(l){l&&i(l,s,a.dispatchAction)}),K3e(a.pendings,e)})}}function K3e(n,e){var t=n.showTip.length,r=n.hideTip.length,i;t?i=n.showTip[t-1]:r&&(i=n.hideTip[r-1]),i&&(i.dispatchAction=null,e.dispatchAction(i))}function J3e(n,e,t){n.handler("leave",null,t)}function LZ(n,e,t,r){e.handler(n,t,r)}function Q3e(n){var e={showTip:[],hideTip:[]},t=function(r){var i=e[r.type];i?i.push(r):(r.dispatchAction=t,n.dispatchAction(r))};return{dispatchAction:t,pendings:e}}function SN(n,e){if(!pi.node){var t=e.getZr(),r=(Rm(t).records||{})[n];r&&(Rm(t).records[n]=null)}}var e4e=function(n){Hn(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.render=function(t,r,i){var s=r.getComponent("tooltip"),a=t.get("triggerOn")||s&&s.get("triggerOn")||"mousemove|click";dae("axisPointer",i,function(l,o,h){a!=="none"&&(l==="leave"||a.indexOf(l)>=0)&&h({type:"updateAxisPointer",currTrigger:l,x:o&&o.offsetX,y:o&&o.offsetY})})},e.prototype.remove=function(t,r){SN("axisPointer",r)},e.prototype.dispose=function(t,r){SN("axisPointer",r)},e.type="axisPointer",e}(Rc);function pae(n,e){var t=[],r=n.seriesIndex,i;if(r==null||!(i=e.getSeriesByIndex(r)))return{point:[]};var s=i.getData(),a=Qy(s,n);if(a==null||a<0||fr(a))return{point:[]};var l=s.getItemGraphicEl(a),o=i.coordinateSystem;if(i.getTooltipPosition)t=i.getTooltipPosition(a)||[];else if(o&&o.dataToPoint)if(n.isStacked){var h=o.getBaseAxis(),d=o.getOtherAxis(h),m=d.dim,_=h.dim,y=m==="x"||m==="radius"?1:0,T=s.mapDimension(_),I=[];I[y]=s.get(T,a),I[1-y]=s.get(s.getCalculationInfo("stackResultDimension"),a),t=o.dataToPoint(I)||[]}else t=o.dataToPoint(s.getValues(xr(o.dimensions,function(M){return s.mapDimension(M)}),a))||[];else if(l){var C=l.getBoundingRect().clone();C.applyTransform(l.transform),t=[C.x+C.width/2,C.y+C.height/2]}return{point:t,el:l}}var DZ=Xs();function t4e(n,e,t){var r=n.currTrigger,i=[n.x,n.y],s=n,a=n.dispatchAction||Ns(t.dispatchAction,t),l=e.getComponent("axisPointer").coordSysAxesInfo;if(l){$I(i)&&(i=pae({seriesIndex:s.seriesIndex,dataIndex:s.dataIndex},e).point);var o=$I(i),h=s.axesInfo,d=l.axesInfo,m=r==="leave"||$I(i),_={},y={},T={list:[],map:{}},I={showPointer:ms(r4e,y),showTooltip:ms(i4e,T)};it(l.coordSysMap,function(M,B){var k=o||M.containPoint(i);it(l.coordSysAxesInfo[B],function(j,q){var Z=j.axis,te=l4e(h,j);if(!m&&k&&(!h||te)){var ie=te&&te.value;ie==null&&!o&&(ie=Z.pointToData(i)),ie!=null&&BZ(j,ie,I,!1,_)}})});var C={};return it(d,function(M,B){var k=M.linkGroup;k&&!y[B]&&it(k.axesInfo,function(j,q){var Z=y[q];if(j!==M&&Z){var te=Z.value;k.mapper&&(te=M.axis.scale.parse(k.mapper(te,kZ(j),kZ(M)))),C[M.key]=te}})}),it(C,function(M,B){BZ(d[B],M,I,!0,_)}),s4e(y,d,_),o4e(T,i,n,a),a4e(d,a,t),_}}function BZ(n,e,t,r,i){var s=n.axis;if(!(s.scale.isBlank()||!s.containData(e))){if(!n.involveSeries){t.showPointer(n,e);return}var a=n4e(e,n),l=a.payloadBatch,o=a.snapToValue;l[0]&&i.seriesIndex==null&&Jn(i,l[0]),!r&&n.snap&&s.containData(o)&&o!=null&&(e=o),t.showPointer(n,e,l),t.showTooltip(n,a,o)}}function n4e(n,e){var t=e.axis,r=t.dim,i=n,s=[],a=Number.MAX_VALUE,l=-1;return it(e.seriesModels,function(o,h){var d=o.getData().mapDimensionsAll(r),m,_;if(o.getAxisTooltipData){var y=o.getAxisTooltipData(d,n,t);_=y.dataIndices,m=y.nestestValue}else{if(_=o.getData().indicesOfNearest(d[0],n,t.type==="category"?.5:null),!_.length)return;m=o.getData().get(d[0],_[0])}if(!(m==null||!isFinite(m))){var T=n-m,I=Math.abs(T);I<=a&&((I<a||T>=0&&l<0)&&(a=I,l=T,i=m,s.length=0),it(_,function(C){s.push({seriesIndex:o.seriesIndex,dataIndexInside:C,dataIndex:o.getData().getRawIndex(C)})}))}}),{payloadBatch:s,snapToValue:i}}function r4e(n,e,t,r){n[e.key]={value:t,payloadBatch:r}}function i4e(n,e,t,r){var i=t.payloadBatch,s=e.axis,a=s.model,l=e.axisPointerModel;if(!(!e.triggerTooltip||!i.length)){var o=e.coordSys.model,h=lT(o),d=n.map[h];d||(d=n.map[h]={coordSysId:o.id,coordSysIndex:o.componentIndex,coordSysType:o.type,coordSysMainType:o.mainType,dataByAxis:[]},n.list.push(d)),d.dataByAxis.push({axisDim:s.dim,axisIndex:a.componentIndex,axisType:a.type,axisId:a.id,value:r,valueLabelOpt:{precision:l.get(["label","precision"]),formatter:l.get(["label","formatter"])},seriesDataIndices:i.slice()})}}function s4e(n,e,t){var r=t.axesInfo=[];it(e,function(i,s){var a=i.axisPointerModel.option,l=n[s];l?(!i.useHandle&&(a.status="show"),a.value=l.value,a.seriesDataIndices=(l.payloadBatch||[]).slice()):!i.useHandle&&(a.status="hide"),a.status==="show"&&r.push({axisDim:i.axis.dim,axisIndex:i.axis.model.componentIndex,value:a.value})})}function o4e(n,e,t,r){if($I(e)||!n.list.length){r({type:"hideTip"});return}var i=((n.list[0].dataByAxis[0]||{}).seriesDataIndices||[])[0]||{};r({type:"showTip",escapeConnect:!0,x:e[0],y:e[1],tooltipOption:t.tooltipOption,position:t.position,dataIndexInside:i.dataIndexInside,dataIndex:i.dataIndex,seriesIndex:i.seriesIndex,dataByCoordSys:n.list})}function a4e(n,e,t){var r=t.getZr(),i="axisPointerLastHighlights",s=DZ(r)[i]||{},a=DZ(r)[i]={};it(n,function(h,d){var m=h.axisPointerModel.option;m.status==="show"&&h.triggerEmphasis&&it(m.seriesDataIndices,function(_){var y=_.seriesIndex+" | "+_.dataIndex;a[y]=_})});var l=[],o=[];it(s,function(h,d){!a[d]&&o.push(h)}),it(a,function(h,d){!s[d]&&l.push(h)}),o.length&&t.dispatchAction({type:"downplay",escapeConnect:!0,notBlur:!0,batch:o}),l.length&&t.dispatchAction({type:"highlight",escapeConnect:!0,notBlur:!0,batch:l})}function l4e(n,e){for(var t=0;t<(n||[]).length;t++){var r=n[t];if(e.axis.dim===r.axisDim&&e.axis.model.componentIndex===r.axisIndex)return r}}function kZ(n){var e=n.axis.model,t={},r=t.axisDim=n.axis.dim;return t.axisIndex=t[r+"AxisIndex"]=e.componentIndex,t.axisName=t[r+"AxisName"]=e.name,t.axisId=t[r+"AxisId"]=e.id,t}function $I(n){return!n||n[0]==null||isNaN(n[0])||n[1]==null||isNaN(n[1])}function r8(n){nM.registerAxisPointerClass("CartesianAxisPointer",X3e),n.registerComponentModel(q3e),n.registerComponentView(e4e),n.registerPreprocessor(function(e){if(e){(!e.axisPointer||e.axisPointer.length===0)&&(e.axisPointer={});var t=e.axisPointer.link;t&&!fr(t)&&(e.axisPointer.link=[t])}}),n.registerProcessor(n.PRIORITY.PROCESSOR.STATISTIC,function(e,t){e.getComponent("axisPointer").coordSysAxesInfo=s3e(e,t)}),n.registerAction({type:"updateAxisPointer",event:"updateAxisPointer",update:":updateAxisPointer"},t4e)}function c4e(n){fp(y3e),fp(r8)}var u4e=function(n){Hn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.makeElOption=function(t,r,i,s,a){var l=i.axis;l.dim==="angle"&&(this.animationThreshold=Math.PI/18);var o=l.polar,h=o.getOtherAxis(l),d=h.getExtent(),m=l.dataToCoord(r),_=s.get("type");if(_&&_!=="none"){var y=lae(s),T=f4e[_](l,o,m,d);T.style=y,t.graphicKey=T.type,t.pointer=T}var I=s.get(["label","margin"]),C=h4e(r,i,s,o,I);cae(t,i,s,a,C)},e}(oae);function h4e(n,e,t,r,i){var s=e.axis,a=s.dataToCoord(n),l=r.getAngleAxis().getExtent()[0];l=l/180*Math.PI;var o=r.getRadiusAxis().getExtent(),h,d,m;if(s.dim==="radius"){var _=Dy();lD(_,_,l),lP(_,_,[r.cx,r.cy]),h=wD([a,-i],_);var y=e.getModel("axisLabel").get("rotate")||0,T=Ch.innerTextLayout(l,y*Math.PI/180,-1);d=T.textAlign,m=T.textVerticalAlign}else{var I=o[1];h=r.coordToPoint([I+i,a]);var C=r.cx,M=r.cy;d=Math.abs(h[0]-C)/I<.3?"center":h[0]>C?"left":"right",m=Math.abs(h[1]-M)/I<.3?"middle":h[1]>M?"top":"bottom"}return{position:h,align:d,verticalAlign:m}}var f4e={line:function(n,e,t,r){return n.dim==="angle"?{type:"Line",shape:fae(e.coordToPoint([r[0],t]),e.coordToPoint([r[1],t]))}:{type:"Circle",shape:{cx:e.cx,cy:e.cy,r:t}}},shadow:function(n,e,t,r){var i=Math.max(1,n.getBandWidth()),s=Math.PI/180;return n.dim==="angle"?{type:"Sector",shape:IZ(e.cx,e.cy,r[0],r[1],(-t-i/2)*s,(-t+i/2)*s)}:{type:"Sector",shape:IZ(e.cx,e.cy,t-i/2,t+i/2,0,Math.PI*2)}}},d4e=function(n){Hn(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.findAxisModel=function(t){var r,i=this.ecModel;return i.eachComponent(t,function(s){s.getCoordSysModel()===this&&(r=s)},this),r},e.type="polar",e.dependencies=["radiusAxis","angleAxis"],e.defaultOption={z:0,center:["50%","50%"],radius:"80%"},e}(is),i8=function(n){Hn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getCoordSysModel=function(){return this.getReferringComponents("polar",yl).models[0]},e.type="polarAxis",e}(is);nd(i8,doe);var p4e=function(n){Hn(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.type=e.type,t}return e.type="angleAxis",e}(i8),m4e=function(n){Hn(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.type=e.type,t}return e.type="radiusAxis",e}(i8),s8=function(n){Hn(e,n);function e(t,r){return n.call(this,"radius",t,r)||this}return e.prototype.pointToData=function(t,r){return this.polar.pointToData(t,r)[this.dim==="radius"?0:1]},e}(yx);s8.prototype.dataToRadius=yx.prototype.dataToCoord;s8.prototype.radiusToData=yx.prototype.coordToData;var g4e=Xs(),o8=function(n){Hn(e,n);function e(t,r){return n.call(this,"angle",t,r||[0,360])||this}return e.prototype.pointToData=function(t,r){return this.polar.pointToData(t,r)[this.dim==="radius"?0:1]},e.prototype.calculateCategoryInterval=function(){var t=this,r=t.getLabelModel(),i=t.scale,s=i.getExtent(),a=i.count();if(s[1]-s[0]<1)return 0;var l=s[0],o=t.dataToCoord(l+1)-t.dataToCoord(l),h=Math.abs(o),d=YT(l==null?"":l+"",r.getFont(),"center","top"),m=Math.max(d.height,7),_=m/h;isNaN(_)&&(_=1/0);var y=Math.max(0,Math.floor(_)),T=g4e(t.model),I=T.lastAutoInterval,C=T.lastTickCount;return I!=null&&C!=null&&Math.abs(I-y)<=1&&Math.abs(C-a)<=1&&I>y?y=I:(T.lastTickCount=a,T.lastAutoInterval=y),y},e}(yx);o8.prototype.dataToAngle=yx.prototype.dataToCoord;o8.prototype.angleToData=yx.prototype.coordToData;var mae=["radius","angle"],v4e=function(){function n(e){this.dimensions=mae,this.type="polar",this.cx=0,this.cy=0,this._radiusAxis=new s8,this._angleAxis=new o8,this.axisPointerEnabled=!0,this.name=e||"",this._radiusAxis.polar=this._angleAxis.polar=this}return n.prototype.containPoint=function(e){var t=this.pointToCoord(e);return this._radiusAxis.contain(t[0])&&this._angleAxis.contain(t[1])},n.prototype.containData=function(e){return this._radiusAxis.containData(e[0])&&this._angleAxis.containData(e[1])},n.prototype.getAxis=function(e){var t="_"+e+"Axis";return this[t]},n.prototype.getAxes=function(){return[this._radiusAxis,this._angleAxis]},n.prototype.getAxesByScale=function(e){var t=[],r=this._angleAxis,i=this._radiusAxis;return r.scale.type===e&&t.push(r),i.scale.type===e&&t.push(i),t},n.prototype.getAngleAxis=function(){return this._angleAxis},n.prototype.getRadiusAxis=function(){return this._radiusAxis},n.prototype.getOtherAxis=function(e){var t=this._angleAxis;return e===t?this._radiusAxis:t},n.prototype.getBaseAxis=function(){return this.getAxesByScale("ordinal")[0]||this.getAxesByScale("time")[0]||this.getAngleAxis()},n.prototype.getTooltipAxes=function(e){var t=e!=null&&e!=="auto"?this.getAxis(e):this.getBaseAxis();return{baseAxes:[t],otherAxes:[this.getOtherAxis(t)]}},n.prototype.dataToPoint=function(e,t){return this.coordToPoint([this._radiusAxis.dataToRadius(e[0],t),this._angleAxis.dataToAngle(e[1],t)])},n.prototype.pointToData=function(e,t){var r=this.pointToCoord(e);return[this._radiusAxis.radiusToData(r[0],t),this._angleAxis.angleToData(r[1],t)]},n.prototype.pointToCoord=function(e){var t=e[0]-this.cx,r=e[1]-this.cy,i=this.getAngleAxis(),s=i.getExtent(),a=Math.min(s[0],s[1]),l=Math.max(s[0],s[1]);i.inverse?a=l-360:l=a+360;var o=Math.sqrt(t*t+r*r);t/=o,r/=o;for(var h=Math.atan2(-r,t)/Math.PI*180,d=h<a?1:-1;h<a||h>l;)h+=d*360;return[o,h]},n.prototype.coordToPoint=function(e){var t=e[0],r=e[1]/180*Math.PI,i=Math.cos(r)*t+this.cx,s=-Math.sin(r)*t+this.cy;return[i,s]},n.prototype.getArea=function(){var e=this.getAngleAxis(),t=this.getRadiusAxis(),r=t.getExtent().slice();r[0]>r[1]&&r.reverse();var i=e.getExtent(),s=Math.PI/180;return{cx:this.cx,cy:this.cy,r0:r[0],r:r[1],startAngle:-i[0]*s,endAngle:-i[1]*s,clockwise:e.inverse,contain:function(a,l){var o=a-this.cx,h=l-this.cy,d=o*o+h*h-1e-4,m=this.r,_=this.r0;return d<=m*m&&d>=_*_}}},n.prototype.convertToPixel=function(e,t,r){var i=OZ(t);return i===this?this.dataToPoint(r):null},n.prototype.convertFromPixel=function(e,t,r){var i=OZ(t);return i===this?this.pointToData(r):null},n}();function OZ(n){var e=n.seriesModel,t=n.polarModel;return t&&t.coordinateSystem||e&&e.coordinateSystem}const _4e=v4e;function y4e(n,e,t){var r=e.get("center"),i=t.getWidth(),s=t.getHeight();n.cx=os(r[0],i),n.cy=os(r[1],s);var a=n.getRadiusAxis(),l=Math.min(i,s)/2,o=e.get("radius");o==null?o=[0,"100%"]:fr(o)||(o=[0,o]);var h=[os(o[0],l),os(o[1],l)];a.inverse?a.setExtent(h[1],h[0]):a.setExtent(h[0],h[1])}function x4e(n,e){var t=this,r=t.getAngleAxis(),i=t.getRadiusAxis();if(r.scale.setExtent(1/0,-1/0),i.scale.setExtent(1/0,-1/0),n.eachSeries(function(l){if(l.coordinateSystem===t){var o=l.getData();it(DP(o,"radius"),function(h){i.scale.unionExtentFromData(o,h)}),it(DP(o,"angle"),function(h){r.scale.unionExtentFromData(o,h)})}}),LP(r.scale,r.model),LP(i.scale,i.model),r.type==="category"&&!r.onBand){var s=r.getExtent(),a=360/r.scale.count();r.inverse?s[1]+=a:s[1]-=a,r.setExtent(s[0],s[1])}}function b4e(n){return n.mainType==="angleAxis"}function FZ(n,e){var t;if(n.type=e.get("type"),n.scale=hoe(e),n.onBand=e.get("boundaryGap")&&n.type==="category",n.inverse=e.get("inverse"),b4e(e)){n.inverse=n.inverse!==e.get("clockwise");var r=e.get("startAngle"),i=(t=e.get("endAngle"))!==null&&t!==void 0?t:r+(n.inverse?-360:360);n.setExtent(r,i)}e.axis=n,n.model=e}var w4e={dimensions:mae,create:function(n,e){var t=[];return n.eachComponent("polar",function(r,i){var s=new _4e(i+"");s.update=x4e;var a=s.getRadiusAxis(),l=s.getAngleAxis(),o=r.findAxisModel("radiusAxis"),h=r.findAxisModel("angleAxis");FZ(a,o),FZ(l,h),y4e(s,r,e),t.push(s),r.coordinateSystem=s,s.model=r}),n.eachSeries(function(r){if(r.get("coordinateSystem")==="polar"){var i=r.getReferringComponents("polar",yl).models[0];r.coordinateSystem=i.coordinateSystem}}),t}},S4e=["axisLine","axisLabel","axisTick","minorTick","splitLine","minorSplitLine","splitArea"];function nI(n,e,t){e[1]>e[0]&&(e=e.slice().reverse());var r=n.coordToPoint([e[0],t]),i=n.coordToPoint([e[1],t]);return{x1:r[0],y1:r[1],x2:i[0],y2:i[1]}}function rI(n){var e=n.getRadiusAxis();return e.inverse?0:1}function NZ(n){var e=n[0],t=n[n.length-1];e&&t&&Math.abs(Math.abs(e.coord-t.coord)-360)<1e-4&&n.pop()}var A4e=function(n){Hn(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.type=e.type,t.axisPointerClass="PolarAxisPointer",t}return e.prototype.render=function(t,r){if(this.group.removeAll(),!!t.get("show")){var i=t.axis,s=i.polar,a=s.getRadiusAxis().getExtent(),l=i.getTicksCoords(),o=i.getMinorTicksCoords(),h=xr(i.getViewLabels(),function(d){d=vi(d);var m=i.scale,_=m.type==="ordinal"?m.getRawOrdinalNumber(d.tickValue):d.tickValue;return d.coord=i.dataToCoord(_),d});NZ(h),NZ(l),it(S4e,function(d){t.get([d,"show"])&&(!i.scale.isBlank()||d==="axisLine")&&T4e[d](this.group,t,s,l,o,a,h)},this)}},e.type="angleAxis",e}(nM),T4e={axisLine:function(n,e,t,r,i,s){var a=e.getModel(["axisLine","lineStyle"]),l=t.getAngleAxis(),o=Math.PI/180,h=l.getExtent(),d=rI(t),m=d?0:1,_,y=Math.abs(h[1]-h[0])===360?"Circle":"Arc";s[m]===0?_=new _U[y]({shape:{cx:t.cx,cy:t.cy,r:s[d],startAngle:-h[0]*o,endAngle:-h[1]*o,clockwise:l.inverse},style:a.getLineStyle(),z2:1,silent:!0}):_=new fU({shape:{cx:t.cx,cy:t.cy,r:s[d],r0:s[m]},style:a.getLineStyle(),z2:1,silent:!0}),_.style.fill=null,n.add(_)},axisTick:function(n,e,t,r,i,s){var a=e.getModel("axisTick"),l=(a.get("inside")?-1:1)*a.get("length"),o=s[rI(t)],h=xr(r,function(d){return new Nf({shape:nI(t,[o,o+l],d.coord)})});n.add(Sm(h,{style:ti(a.getModel("lineStyle").getLineStyle(),{stroke:e.get(["axisLine","lineStyle","color"])})}))},minorTick:function(n,e,t,r,i,s){if(i.length){for(var a=e.getModel("axisTick"),l=e.getModel("minorTick"),o=(a.get("inside")?-1:1)*l.get("length"),h=s[rI(t)],d=[],m=0;m<i.length;m++)for(var _=0;_<i[m].length;_++)d.push(new Nf({shape:nI(t,[h,h+o],i[m][_].coord)}));n.add(Sm(d,{style:ti(l.getModel("lineStyle").getLineStyle(),ti(a.getLineStyle(),{stroke:e.get(["axisLine","lineStyle","color"])}))}))}},axisLabel:function(n,e,t,r,i,s,a){var l=e.getCategories(!0),o=e.getModel("axisLabel"),h=o.get("margin"),d=e.get("triggerEvent");it(a,function(m,_){var y=o,T=m.tickValue,I=s[rI(t)],C=t.coordToPoint([I+h,m.coord]),M=t.cx,B=t.cy,k=Math.abs(C[0]-M)/I<.3?"center":C[0]>M?"left":"right",j=Math.abs(C[1]-B)/I<.3?"middle":C[1]>B?"top":"bottom";if(l&&l[T]){var q=l[T];Xr(q)&&q.textStyle&&(y=new Io(q.textStyle,o,o.ecModel))}var Z=new Ca({silent:Ch.isLabelSilent(e),style:Ym(y,{x:C[0],y:C[1],fill:y.getTextColor()||e.get(["axisLine","lineStyle","color"]),text:m.formattedLabel,align:k,verticalAlign:j})});if(n.add(Z),d){var te=Ch.makeAxisEventDataBase(e);te.targetType="axisLabel",te.value=m.rawLabel,ji(Z).eventData=te}},this)},splitLine:function(n,e,t,r,i,s){var a=e.getModel("splitLine"),l=a.getModel("lineStyle"),o=l.get("color"),h=0;o=o instanceof Array?o:[o];for(var d=[],m=0;m<r.length;m++){var _=h++%o.length;d[_]=d[_]||[],d[_].push(new Nf({shape:nI(t,s,r[m].coord)}))}for(var m=0;m<d.length;m++)n.add(Sm(d[m],{style:ti({stroke:o[m%o.length]},l.getLineStyle()),silent:!0,z:e.get("z")}))},minorSplitLine:function(n,e,t,r,i,s){if(i.length){for(var a=e.getModel("minorSplitLine"),l=a.getModel("lineStyle"),o=[],h=0;h<i.length;h++)for(var d=0;d<i[h].length;d++)o.push(new Nf({shape:nI(t,s,i[h][d].coord)}));n.add(Sm(o,{style:l.getLineStyle(),silent:!0,z:e.get("z")}))}},splitArea:function(n,e,t,r,i,s){if(r.length){var a=e.getModel("splitArea"),l=a.getModel("areaStyle"),o=l.get("color"),h=0;o=o instanceof Array?o:[o];for(var d=[],m=Math.PI/180,_=-r[0].coord*m,y=Math.min(s[0],s[1]),T=Math.max(s[0],s[1]),I=e.get("clockwise"),C=1,M=r.length;C<=M;C++){var B=C===M?r[0].coord:r[C].coord,k=h++%o.length;d[k]=d[k]||[],d[k].push(new Dh({shape:{cx:t.cx,cy:t.cy,r0:y,r:T,startAngle:_,endAngle:-B*m,clockwise:I},silent:!0})),_=-B*m}for(var C=0;C<d.length;C++)n.add(Sm(d[C],{style:ti({fill:o[C%o.length]},l.getAreaStyle()),silent:!0}))}}},M4e=["axisLine","axisTickLabel","axisName"],C4e=["splitLine","splitArea","minorSplitLine"],E4e=function(n){Hn(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.type=e.type,t.axisPointerClass="PolarAxisPointer",t}return e.prototype.render=function(t,r){if(this.group.removeAll(),!!t.get("show")){var i=this._axisGroup,s=this._axisGroup=new pa;this.group.add(s);var a=t.axis,l=a.polar,o=l.getAngleAxis(),h=a.getTicksCoords(),d=a.getMinorTicksCoords(),m=o.getExtent()[0],_=a.getExtent(),y=R4e(l,t,m),T=new Ch(t,y);it(M4e,T.add,T),s.add(T.getGroup()),vU(i,s,t),it(C4e,function(I){t.get([I,"show"])&&!a.scale.isBlank()&&I4e[I](this.group,t,l,m,_,h,d)},this)}},e.type="radiusAxis",e}(nM),I4e={splitLine:function(n,e,t,r,i,s){var a=e.getModel("splitLine"),l=a.getModel("lineStyle"),o=l.get("color"),h=0,d=t.getAngleAxis(),m=Math.PI/180,_=d.getExtent(),y=Math.abs(_[1]-_[0])===360?"Circle":"Arc";o=o instanceof Array?o:[o];for(var T=[],I=0;I<s.length;I++){var C=h++%o.length;T[C]=T[C]||[],T[C].push(new _U[y]({shape:{cx:t.cx,cy:t.cy,r:Math.max(s[I].coord,0),startAngle:-_[0]*m,endAngle:-_[1]*m,clockwise:d.inverse}}))}for(var I=0;I<T.length;I++)n.add(Sm(T[I],{style:ti({stroke:o[I%o.length],fill:null},l.getLineStyle()),silent:!0}))},minorSplitLine:function(n,e,t,r,i,s,a){if(a.length){for(var l=e.getModel("minorSplitLine"),o=l.getModel("lineStyle"),h=[],d=0;d<a.length;d++)for(var m=0;m<a[d].length;m++)h.push(new _D({shape:{cx:t.cx,cy:t.cy,r:a[d][m].coord}}));n.add(Sm(h,{style:ti({fill:null},o.getLineStyle()),silent:!0}))}},splitArea:function(n,e,t,r,i,s){if(s.length){var a=e.getModel("splitArea"),l=a.getModel("areaStyle"),o=l.get("color"),h=0;o=o instanceof Array?o:[o];for(var d=[],m=s[0].coord,_=1;_<s.length;_++){var y=h++%o.length;d[y]=d[y]||[],d[y].push(new Dh({shape:{cx:t.cx,cy:t.cy,r0:m,r:s[_].coord,startAngle:0,endAngle:Math.PI*2},silent:!0})),m=s[_].coord}for(var _=0;_<d.length;_++)n.add(Sm(d[_],{style:ti({fill:o[_%o.length]},l.getAreaStyle()),silent:!0}))}}};function R4e(n,e,t){return{position:[n.cx,n.cy],rotation:t/180*Math.PI,labelDirection:-1,tickDirection:-1,nameDirection:1,labelRotate:e.getModel("axisLabel").get("rotate"),z2:1}}function gae(n){return n.get("stack")||"__ec_stack_"+n.seriesIndex}function vae(n,e){return e.dim+n.model.componentIndex}function P4e(n,e,t){var r={},i=L4e(ta(e.getSeriesByType(n),function(s){return!e.isSeriesFiltered(s)&&s.coordinateSystem&&s.coordinateSystem.type==="polar"}));e.eachSeriesByType(n,function(s){if(s.coordinateSystem.type==="polar"){var a=s.getData(),l=s.coordinateSystem,o=l.getBaseAxis(),h=vae(l,o),d=gae(s),m=i[h][d],_=m.offset,y=m.width,T=l.getOtherAxis(o),I=s.coordinateSystem.cx,C=s.coordinateSystem.cy,M=s.get("barMinHeight")||0,B=s.get("barMinAngle")||0;r[d]=r[d]||[];for(var k=a.mapDimension(T.dim),j=a.mapDimension(o.dim),q=tx(a,k),Z=o.dim!=="radius"||!s.get("roundCap",!0),te=T.model,ie=te.get("startValue"),se=T.dataToCoord(ie||0),ae=0,fe=a.count();ae<fe;ae++){var Se=a.get(k,ae),Ee=a.get(j,ae),Re=Se>=0?"p":"n",qe=se;q&&(r[d][Ee]||(r[d][Ee]={p:se,n:se}),qe=r[d][Ee][Re]);var Le=void 0,dt=void 0,ye=void 0,Xe=void 0;if(T.dim==="radius"){var He=T.dataToCoord(Se)-se,_t=o.dataToCoord(Ee);Math.abs(He)<M&&(He=(He<0?-1:1)*M),Le=qe,dt=qe+He,ye=_t-_,Xe=ye-y,q&&(r[d][Ee][Re]=dt)}else{var wt=T.dataToCoord(Se,Z)-se,Gt=o.dataToCoord(Ee);Math.abs(wt)<B&&(wt=(wt<0?-1:1)*B),Le=Gt+_,dt=Le+y,ye=qe,Xe=qe+wt,q&&(r[d][Ee][Re]=Xe)}a.setItemLayout(ae,{cx:I,cy:C,r0:Le,r:dt,startAngle:-ye*Math.PI/180,endAngle:-Xe*Math.PI/180,clockwise:ye>=Xe})}}})}function L4e(n){var e={};it(n,function(r,i){var s=r.getData(),a=r.coordinateSystem,l=a.getBaseAxis(),o=vae(a,l),h=l.getExtent(),d=l.type==="category"?l.getBandWidth():Math.abs(h[1]-h[0])/s.count(),m=e[o]||{bandWidth:d,remainedWidth:d,autoWidthCount:0,categoryGap:"20%",gap:"30%",stacks:{}},_=m.stacks;e[o]=m;var y=gae(r);_[y]||m.autoWidthCount++,_[y]=_[y]||{width:0,maxWidth:0};var T=os(r.get("barWidth"),d),I=os(r.get("barMaxWidth"),d),C=r.get("barGap"),M=r.get("barCategoryGap");T&&!_[y].width&&(T=Math.min(m.remainedWidth,T),_[y].width=T,m.remainedWidth-=T),I&&(_[y].maxWidth=I),C!=null&&(m.gap=C),M!=null&&(m.categoryGap=M)});var t={};return it(e,function(r,i){t[i]={};var s=r.stacks,a=r.bandWidth,l=os(r.categoryGap,a),o=os(r.gap,1),h=r.remainedWidth,d=r.autoWidthCount,m=(h-l)/(d+(d-1)*o);m=Math.max(m,0),it(s,function(I,C){var M=I.maxWidth;M&&M<m&&(M=Math.min(M,h),I.width&&(M=Math.min(M,I.width)),h-=M,I.width=M,d--)}),m=(h-l)/(d+(d-1)*o),m=Math.max(m,0);var _=0,y;it(s,function(I,C){I.width||(I.width=m),y=I,_+=I.width*(1+o)}),y&&(_-=y.width*o);var T=-_/2;it(s,function(I,C){t[i][C]=t[i][C]||{offset:T,width:I.width},T+=I.width*(1+o)})}),t}var D4e={startAngle:90,clockwise:!0,splitNumber:12,axisLabel:{rotate:0}},B4e={splitNumber:5},k4e=function(n){Hn(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.type=e.type,t}return e.type="polar",e}(Rc);function O4e(n){fp(r8),nM.registerAxisPointerClass("PolarAxisPointer",u4e),n.registerCoordinateSystem("polar",w4e),n.registerComponentModel(d4e),n.registerComponentView(k4e),OP(n,"angle",p4e,D4e),OP(n,"radius",m4e,B4e),n.registerComponentView(A4e),n.registerComponentView(E4e),n.registerLayout(ms(P4e,"bar"))}var zZ=["x","y","radius","angle","single"],F4e=["cartesian2d","polar","singleAxis"];function N4e(n){var e=n.get("coordinateSystem");return Wi(F4e,e)>=0}function vb(n){return n+"Axis"}function z4e(n,e){var t=ri(),r=[],i=ri();n.eachComponent({mainType:"dataZoom",query:e},function(d){i.get(d.uid)||l(d)});var s;do s=!1,n.eachComponent("dataZoom",a);while(s);function a(d){!i.get(d.uid)&&o(d)&&(l(d),s=!0)}function l(d){i.set(d.uid,!0),r.push(d),h(d)}function o(d){var m=!1;return d.eachTargetAxis(function(_,y){var T=t.get(_);T&&T[y]&&(m=!0)}),m}function h(d){d.eachTargetAxis(function(m,_){(t.get(m)||t.set(m,[]))[_]=!0})}return r}var fk=function(){function n(){this.indexList=[],this.indexMap=[]}return n.prototype.add=function(e){this.indexMap[e]||(this.indexList.push(e),this.indexMap[e]=!0)},n}(),U4e=function(n){Hn(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.type=e.type,t._autoThrottle=!0,t._noTarget=!0,t._rangePropMode=["percent","percent"],t}return e.prototype.init=function(t,r,i){var s=UZ(t);this.settledOption=s,this.mergeDefaultAndTheme(t,i),this._doInit(s)},e.prototype.mergeOption=function(t){var r=UZ(t);Li(this.option,t,!0),Li(this.settledOption,r,!0),this._doInit(r)},e.prototype._doInit=function(t){var r=this.option;this._setDefaultThrottle(t),this._updateRangeUse(t);var i=this.settledOption;it([["start","startValue"],["end","endValue"]],function(s,a){this._rangePropMode[a]==="value"&&(r[s[0]]=i[s[0]]=null)},this),this._resetTarget()},e.prototype._resetTarget=function(){var t=this.get("orient",!0),r=this._targetAxisInfoMap=ri(),i=this._fillSpecifiedTargetAxis(r);i?this._orient=t||this._makeAutoOrientByTargetAxis():(this._orient=t||"horizontal",this._fillAutoTargetAxisByOrient(r,this._orient)),this._noTarget=!0,r.each(function(s){s.indexList.length&&(this._noTarget=!1)},this)},e.prototype._fillSpecifiedTargetAxis=function(t){var r=!1;return it(zZ,function(i){var s=this.getReferringComponents(vb(i),qTe);if(s.specified){r=!0;var a=new fk;it(s.models,function(l){a.add(l.componentIndex)}),t.set(i,a)}},this),r},e.prototype._fillAutoTargetAxisByOrient=function(t,r){var i=this.ecModel,s=!0;if(s){var a=r==="vertical"?"y":"x",l=i.findComponents({mainType:a+"Axis"});o(l,a)}if(s){var l=i.findComponents({mainType:"singleAxis",filter:function(d){return d.get("orient",!0)===r}});o(l,"single")}function o(h,d){var m=h[0];if(m){var _=new fk;if(_.add(m.componentIndex),t.set(d,_),s=!1,d==="x"||d==="y"){var y=m.getReferringComponents("grid",yl).models[0];y&&it(h,function(T){m.componentIndex!==T.componentIndex&&y===T.getReferringComponents("grid",yl).models[0]&&_.add(T.componentIndex)})}}}s&&it(zZ,function(h){if(s){var d=i.findComponents({mainType:vb(h),filter:function(_){return _.get("type",!0)==="category"}});if(d[0]){var m=new fk;m.add(d[0].componentIndex),t.set(h,m),s=!1}}},this)},e.prototype._makeAutoOrientByTargetAxis=function(){var t;return this.eachTargetAxis(function(r){!t&&(t=r)},this),t==="y"?"vertical":"horizontal"},e.prototype._setDefaultThrottle=function(t){if(t.hasOwnProperty("throttle")&&(this._autoThrottle=!1),this._autoThrottle){var r=this.ecModel.option;this.option.throttle=r.animation&&r.animationDurationUpdate>0?100:20}},e.prototype._updateRangeUse=function(t){var r=this._rangePropMode,i=this.get("rangeMode");it([["start","startValue"],["end","endValue"]],function(s,a){var l=t[s[0]]!=null,o=t[s[1]]!=null;l&&!o?r[a]="percent":!l&&o?r[a]="value":i?r[a]=i[a]:l&&(r[a]="percent")})},e.prototype.noTarget=function(){return this._noTarget},e.prototype.getFirstTargetAxisModel=function(){var t;return this.eachTargetAxis(function(r,i){t==null&&(t=this.ecModel.getComponent(vb(r),i))},this),t},e.prototype.eachTargetAxis=function(t,r){this._targetAxisInfoMap.each(function(i,s){it(i.indexList,function(a){t.call(r,s,a)})})},e.prototype.getAxisProxy=function(t,r){var i=this.getAxisModel(t,r);if(i)return i.__dzAxisProxy},e.prototype.getAxisModel=function(t,r){var i=this._targetAxisInfoMap.get(t);if(i&&i.indexMap[r])return this.ecModel.getComponent(vb(t),r)},e.prototype.setRawRange=function(t){var r=this.option,i=this.settledOption;it([["start","startValue"],["end","endValue"]],function(s){(t[s[0]]!=null||t[s[1]]!=null)&&(r[s[0]]=i[s[0]]=t[s[0]],r[s[1]]=i[s[1]]=t[s[1]])},this),this._updateRangeUse(t)},e.prototype.setCalculatedRange=function(t){var r=this.option;it(["start","startValue","end","endValue"],function(i){r[i]=t[i]})},e.prototype.getPercentRange=function(){var t=this.findRepresentativeAxisProxy();if(t)return t.getDataPercentWindow()},e.prototype.getValueRange=function(t,r){if(t==null&&r==null){var i=this.findRepresentativeAxisProxy();if(i)return i.getDataValueWindow()}else return this.getAxisProxy(t,r).getDataValueWindow()},e.prototype.findRepresentativeAxisProxy=function(t){if(t)return t.__dzAxisProxy;for(var r,i=this._targetAxisInfoMap.keys(),s=0;s<i.length;s++)for(var a=i[s],l=this._targetAxisInfoMap.get(a),o=0;o<l.indexList.length;o++){var h=this.getAxisProxy(a,l.indexList[o]);if(h.hostedBy(this))return h;r||(r=h)}return r},e.prototype.getRangePropMode=function(){return this._rangePropMode.slice()},e.prototype.getOrient=function(){return this._orient},e.type="dataZoom",e.dependencies=["xAxis","yAxis","radiusAxis","angleAxis","singleAxis","series","toolbox"],e.defaultOption={z:4,filterMode:"filter",start:0,end:100},e}(is);function UZ(n){var e={};return it(["start","end","startValue","endValue","throttle"],function(t){n.hasOwnProperty(t)&&(e[t]=n[t])}),e}var V4e=function(n){Hn(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.type=e.type,t}return e.type="dataZoom.select",e}(U4e),G4e=function(n){Hn(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.render=function(t,r,i,s){this.dataZoomModel=t,this.ecModel=r,this.api=i},e.type="dataZoom",e}(Rc),H4e=function(n){Hn(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.type=e.type,t}return e.type="dataZoom.select",e}(G4e),$1=it,VZ=ITe,j4e=function(){function n(e,t,r,i){this._dimName=e,this._axisIndex=t,this.ecModel=i,this._dataZoomModel=r}return n.prototype.hostedBy=function(e){return this._dataZoomModel===e},n.prototype.getDataValueWindow=function(){return this._valueWindow.slice()},n.prototype.getDataPercentWindow=function(){return this._percentWindow.slice()},n.prototype.getTargetSeriesModels=function(){var e=[];return this.ecModel.eachSeries(function(t){if(N4e(t)){var r=vb(this._dimName),i=t.getReferringComponents(r,yl).models[0];i&&this._axisIndex===i.componentIndex&&e.push(t)}},this),e},n.prototype.getAxisModel=function(){return this.ecModel.getComponent(this._dimName+"Axis",this._axisIndex)},n.prototype.getMinMaxSpan=function(){return vi(this._minMaxSpan)},n.prototype.calculateDataWindow=function(e){var t=this._dataExtent,r=this.getAxisModel(),i=r.axis.scale,s=this._dataZoomModel.getRangePropMode(),a=[0,100],l=[],o=[],h;$1(["start","end"],function(_,y){var T=e[_],I=e[_+"Value"];s[y]==="percent"?(T==null&&(T=a[y]),I=i.parse(B0(T,a,t))):(h=!0,I=I==null?t[y]:i.parse(I),T=B0(I,t,a)),o[y]=I==null||isNaN(I)?t[y]:I,l[y]=T==null||isNaN(T)?a[y]:T}),VZ(o),VZ(l);var d=this._minMaxSpan;h?m(o,l,t,a,!1):m(l,o,a,t,!0);function m(_,y,T,I,C){var M=C?"Span":"ValueSpan";qoe(0,_,T,"all",d["min"+M],d["max"+M]);for(var B=0;B<2;B++)y[B]=B0(_[B],T,I,!0),C&&(y[B]=i.parse(y[B]))}return{valueWindow:o,percentWindow:l}},n.prototype.reset=function(e){if(e===this._dataZoomModel){var t=this.getTargetSeriesModels();this._dataExtent=W4e(this,this._dimName,t),this._updateMinMaxSpan();var r=this.calculateDataWindow(e.settledOption);this._valueWindow=r.valueWindow,this._percentWindow=r.percentWindow,this._setAxisModel()}},n.prototype.filterData=function(e,t){if(e!==this._dataZoomModel)return;var r=this._dimName,i=this.getTargetSeriesModels(),s=e.get("filterMode"),a=this._valueWindow;if(s==="none")return;$1(i,function(o){var h=o.getData(),d=h.mapDimensionsAll(r);if(d.length){if(s==="weakFilter"){var m=h.getStore(),_=xr(d,function(y){return h.getDimensionIndex(y)},h);h.filterSelf(function(y){for(var T,I,C,M=0;M<d.length;M++){var B=m.get(_[M],y),k=!isNaN(B),j=B<a[0],q=B>a[1];if(k&&!j&&!q)return!0;k&&(C=!0),j&&(T=!0),q&&(I=!0)}return C&&T&&I})}else $1(d,function(y){if(s==="empty")o.setData(h=h.map(y,function(I){return l(I)?I:NaN}));else{var T={};T[y]=a,h.selectRange(T)}});$1(d,function(y){h.setApproximateExtent(a,y)})}});function l(o){return o>=a[0]&&o<=a[1]}},n.prototype._updateMinMaxSpan=function(){var e=this._minMaxSpan={},t=this._dataZoomModel,r=this._dataExtent;$1(["min","max"],function(i){var s=t.get(i+"Span"),a=t.get(i+"ValueSpan");a!=null&&(a=this.getAxisModel().axis.scale.parse(a)),a!=null?s=B0(r[0]+a,r,[0,100],!0):s!=null&&(a=B0(s,[0,100],r,!0)-r[0]),e[i+"Span"]=s,e[i+"ValueSpan"]=a},this)},n.prototype._setAxisModel=function(){var e=this.getAxisModel(),t=this._percentWindow,r=this._valueWindow;if(t){var i=bre(r,[0,500]);i=Math.min(i,20);var s=e.axis.scale.rawExtentInfo;t[0]!==0&&s.setDeterminedMinMax("min",+r[0].toFixed(i)),t[1]!==100&&s.setDeterminedMinMax("max",+r[1].toFixed(i)),s.freeze()}},n}();function W4e(n,e,t){var r=[1/0,-1/0];$1(t,function(a){xLe(r,a.getData(),e)});var i=n.getAxisModel(),s=coe(i.axis.scale,i,r).calculate();return[s.min,s.max]}var X4e={getTargetSeries:function(n){function e(i){n.eachComponent("dataZoom",function(s){s.eachTargetAxis(function(a,l){var o=n.getComponent(vb(a),l);i(a,l,o,s)})})}e(function(i,s,a,l){a.__dzAxisProxy=null});var t=[];e(function(i,s,a,l){a.__dzAxisProxy||(a.__dzAxisProxy=new j4e(i,s,l,n),t.push(a.__dzAxisProxy))});var r=ri();return it(t,function(i){it(i.getTargetSeriesModels(),function(s){r.set(s.uid,s)})}),r},overallReset:function(n,e){n.eachComponent("dataZoom",function(t){t.eachTargetAxis(function(r,i){t.getAxisProxy(r,i).reset(t)}),t.eachTargetAxis(function(r,i){t.getAxisProxy(r,i).filterData(t,e)})}),n.eachComponent("dataZoom",function(t){var r=t.findRepresentativeAxisProxy();if(r){var i=r.getDataPercentWindow(),s=r.getDataValueWindow();t.setCalculatedRange({start:i[0],end:i[1],startValue:s[0],endValue:s[1]})}})}};function $4e(n){n.registerAction("dataZoom",function(e,t){var r=z4e(t,e);it(r,function(i){i.setRawRange({start:e.start,end:e.end,startValue:e.startValue,endValue:e.endValue})})})}var GZ=!1;function q4e(n){GZ||(GZ=!0,n.registerProcessor(n.PRIORITY.PROCESSOR.FILTER,X4e),$4e(n),n.registerSubTypeDefaulter("dataZoom",function(){return"slider"}))}function Z4e(n){n.registerComponentModel(V4e),n.registerComponentView(H4e),q4e(n)}var Of=function(){function n(){}return n}(),_ae={};function Q2(n,e){_ae[n]=e}function yae(n){return _ae[n]}var Y4e=function(n){Hn(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.optionUpdated=function(){n.prototype.optionUpdated.apply(this,arguments);var t=this.ecModel;it(this.option.feature,function(r,i){var s=yae(i);s&&(s.getDefaultOption&&(s.defaultOption=s.getDefaultOption(t)),Li(r,s.defaultOption))})},e.type="toolbox",e.layoutMode={type:"box",ignoreSize:!0},e.defaultOption={show:!0,z:6,orient:"horizontal",left:"right",top:"top",backgroundColor:"transparent",borderColor:"#ccc",borderRadius:0,borderWidth:0,padding:5,itemSize:15,itemGap:8,showTitle:!0,iconStyle:{borderColor:"#666",color:"none"},emphasis:{iconStyle:{borderColor:"#3E98C5"}},tooltip:{show:!1,position:"bottom"}},e}(is);function K4e(n,e,t){var r=e.getBoxLayoutParams(),i=e.get("padding"),s={width:t.getWidth(),height:t.getHeight()},a=mv(r,s,i);Bb(e.get("orient"),n,e.get("itemGap"),a.width,a.height),IEe(n,r,s,i)}function xae(n,e){var t=LD(e.get("padding")),r=e.getItemStyle(["color","opacity"]);return r.fill=e.get("backgroundColor"),n=new Go({shape:{x:n.x-t[3],y:n.y-t[0],width:n.width+t[1]+t[3],height:n.height+t[0]+t[2],r:e.get("borderRadius")},style:r,silent:!0,z2:-1}),n}var J4e=function(n){Hn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.render=function(t,r,i,s){var a=this.group;if(a.removeAll(),!t.get("show"))return;var l=+t.get("itemSize"),o=t.get("orient")==="vertical",h=t.get("feature")||{},d=this._features||(this._features={}),m=[];it(h,function(T,I){m.push(I)}),new oT(this._featureNames||[],m).add(_).update(_).remove(ms(_,null)).execute(),this._featureNames=m;function _(T,I){var C=m[T],M=m[I],B=h[C],k=new Io(B,t,t.ecModel),j;if(s&&s.newTitle!=null&&s.featureName===C&&(B.title=s.newTitle),C&&!M){if(Q4e(C))j={onclick:k.option.onclick,featureName:C};else{var q=yae(C);if(!q)return;j=new q}d[C]=j}else if(j=d[M],!j)return;j.uid=tM("toolbox-feature"),j.model=k,j.ecModel=r,j.api=i;var Z=j instanceof Of;if(!C&&M){Z&&j.dispose&&j.dispose(r,i);return}if(!k.get("show")||Z&&j.unusable){Z&&j.remove&&j.remove(r,i);return}y(k,j,C),k.setIconStatus=function(te,ie){var se=this.option,ae=this.iconPaths;se.iconStatus=se.iconStatus||{},se.iconStatus[te]=ie,ae[te]&&(ie==="emphasis"?Kb:Jb)(ae[te])},j instanceof Of&&j.render&&j.render(k,r,i,s)}function y(T,I,C){var M=T.getModel("iconStyle"),B=T.getModel(["emphasis","iconStyle"]),k=I instanceof Of&&I.getIcons?I.getIcons():T.get("icon"),j=T.get("title")||{},q,Z;Dr(k)?(q={},q[C]=k):q=k,Dr(j)?(Z={},Z[C]=j):Z=j;var te=T.iconPaths={};it(q,function(ie,se){var ae=SD(ie,{},{x:-l/2,y:-l/2,width:l,height:l});ae.setStyle(M.getItemStyle());var fe=ae.ensureState("emphasis");fe.style=B.getItemStyle();var Se=new Ca({style:{text:Z[se],align:B.get("textAlign"),borderRadius:B.get("textBorderRadius"),padding:B.get("textPadding"),fill:null,font:Sie({fontStyle:B.get("textFontStyle"),fontFamily:B.get("textFontFamily"),fontSize:B.get("textFontSize"),fontWeight:B.get("textFontWeight")},r)},ignore:!0});ae.setTextContent(Se),AD({el:ae,componentModel:t,itemName:se,formatterParamsExtra:{title:Z[se]}}),ae.__title=Z[se],ae.on("mouseover",function(){var Ee=B.getItemStyle(),Re=o?t.get("right")==null&&t.get("left")!=="right"?"right":"left":t.get("bottom")==null&&t.get("top")!=="bottom"?"bottom":"top";Se.setStyle({fill:B.get("textFill")||Ee.fill||Ee.stroke||"#000",backgroundColor:B.get("textBackgroundColor")}),ae.setTextConfig({position:B.get("textPosition")||Re}),Se.ignore=!t.get("showTitle"),i.enterEmphasis(this)}).on("mouseout",function(){T.get(["iconStatus",se])!=="emphasis"&&i.leaveEmphasis(this),Se.hide()}),(T.get(["iconStatus",se])==="emphasis"?Kb:Jb)(ae),a.add(ae),ae.on("click",Ns(I.onclick,I,r,i,se)),te[se]=ae})}K4e(a,t,i),a.add(xae(a.getBoundingRect(),t)),o||a.eachChild(function(T){var I=T.__title,C=T.ensureState("emphasis"),M=C.textConfig||(C.textConfig={}),B=T.getTextContent(),k=B&&B.ensureState("emphasis");if(k&&!li(k)&&I){var j=k.style||(k.style={}),q=YT(I,Ca.makeFont(j)),Z=T.x+a.x,te=T.y+a.y+l,ie=!1;te+q.height>i.getHeight()&&(M.position="top",ie=!0);var se=ie?-5-q.height:l+10;Z+q.width/2>i.getWidth()?(M.position=["100%",se],j.align="right"):Z-q.width/2<0&&(M.position=[0,se],j.align="left")}})},e.prototype.updateView=function(t,r,i,s){it(this._features,function(a){a instanceof Of&&a.updateView&&a.updateView(a.model,r,i,s)})},e.prototype.remove=function(t,r){it(this._features,function(i){i instanceof Of&&i.remove&&i.remove(t,r)}),this.group.removeAll()},e.prototype.dispose=function(t,r){it(this._features,function(i){i instanceof Of&&i.dispose&&i.dispose(t,r)})},e.type="toolbox",e}(Rc);function Q4e(n){return n.indexOf("my")===0}var e5e=function(n){Hn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.onclick=function(t,r){var i=this.model,s=i.get("name")||t.get("title.0.text")||"echarts",a=r.getZr().painter.getType()==="svg",l=a?"svg":i.get("type",!0)||"png",o=r.getConnectedDataURL({type:l,backgroundColor:i.get("backgroundColor",!0)||t.get("backgroundColor")||"#fff",connectedBackgroundColor:i.get("connectedBackgroundColor"),excludeComponents:i.get("excludeComponents"),pixelRatio:i.get("pixelRatio")}),h=pi.browser;if(typeof MouseEvent=="function"&&(h.newEdge||!h.ie&&!h.edge)){var d=document.createElement("a");d.download=s+"."+l,d.target="_blank",d.href=o;var m=new MouseEvent("click",{view:document.defaultView,bubbles:!0,cancelable:!1});d.dispatchEvent(m)}else if(window.navigator.msSaveOrOpenBlob||a){var _=o.split(","),y=_[0].indexOf("base64")>-1,T=a?decodeURIComponent(_[1]):_[1];y&&(T=window.atob(T));var I=s+"."+l;if(window.navigator.msSaveOrOpenBlob){for(var C=T.length,M=new Uint8Array(C);C--;)M[C]=T.charCodeAt(C);var B=new Blob([M]);window.navigator.msSaveOrOpenBlob(B,I)}else{var k=document.createElement("iframe");document.body.appendChild(k);var j=k.contentWindow,q=j.document;q.open("image/svg+xml","replace"),q.write(T),q.close(),j.focus(),q.execCommand("SaveAs",!0,I),document.body.removeChild(k)}}else{var Z=i.get("lang"),te='<body style="margin:0;"><img src="'+o+'" style="max-width:100%;" title="'+(Z&&Z[0]||"")+'" /></body>',ie=window.open();ie.document.write(te),ie.document.title=s}},e.getDefaultOption=function(t){var r={show:!0,icon:"M4.7,22.9L29.3,45.5L54.7,23.4M4.6,43.6L4.6,58L53.8,58L53.8,43.6M29.2,45.1L29.2,0",title:t.getLocaleModel().get(["toolbox","saveAsImage","title"]),type:"png",connectedBackgroundColor:"#fff",name:"",excludeComponents:["toolbox"],lang:t.getLocaleModel().get(["toolbox","saveAsImage","lang"])};return r},e}(Of),HZ="__ec_magicType_stack__",t5e=[["line","bar"],["stack"]],n5e=function(n){Hn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getIcons=function(){var t=this.model,r=t.get("icon"),i={};return it(t.get("type"),function(s){r[s]&&(i[s]=r[s])}),i},e.getDefaultOption=function(t){var r={show:!0,type:[],icon:{line:"M4.1,28.9h7.1l9.3-22l7.4,38l9.7-19.7l3,12.8h14.9M4.1,58h51.4",bar:"M6.7,22.9h10V48h-10V22.9zM24.9,13h10v35h-10V13zM43.2,2h10v46h-10V2zM3.1,58h53.7",stack:"M8.2,38.4l-8.4,4.1l30.6,15.3L60,42.5l-8.1-4.1l-21.5,11L8.2,38.4z M51.9,30l-8.1,4.2l-13.4,6.9l-13.9-6.9L8.2,30l-8.4,4.2l8.4,4.2l22.2,11l21.5-11l8.1-4.2L51.9,30z M51.9,21.7l-8.1,4.2L35.7,30l-5.3,2.8L24.9,30l-8.4-4.1l-8.3-4.2l-8.4,4.2L8.2,30l8.3,4.2l13.9,6.9l13.4-6.9l8.1-4.2l8.1-4.1L51.9,21.7zM30.4,2.2L-0.2,17.5l8.4,4.1l8.3,4.2l8.4,4.2l5.5,2.7l5.3-2.7l8.1-4.2l8.1-4.2l8.1-4.1L30.4,2.2z"},title:t.getLocaleModel().get(["toolbox","magicType","title"]),option:{},seriesIndex:{}};return r},e.prototype.onclick=function(t,r,i){var s=this.model,a=s.get(["seriesIndex",i]);if(jZ[i]){var l={series:[]},o=function(m){var _=m.subType,y=m.id,T=jZ[i](_,y,m,s);T&&(ti(T,m.option),l.series.push(T));var I=m.coordinateSystem;if(I&&I.type==="cartesian2d"&&(i==="line"||i==="bar")){var C=I.getAxesByScale("ordinal")[0];if(C){var M=C.dim,B=M+"Axis",k=m.getReferringComponents(B,yl).models[0],j=k.componentIndex;l[B]=l[B]||[];for(var q=0;q<=j;q++)l[B][j]=l[B][j]||{};l[B][j].boundaryGap=i==="bar"}}};it(t5e,function(m){Wi(m,i)>=0&&it(m,function(_){s.setIconStatus(_,"normal")})}),s.setIconStatus(i,"emphasis"),t.eachComponent({mainType:"series",query:a==null?null:{seriesIndex:a}},o);var h,d=i;i==="stack"&&(h=Li({stack:s.option.title.tiled,tiled:s.option.title.stack},s.option.title),s.get(["iconStatus",i])!=="emphasis"&&(d="tiled")),r.dispatchAction({type:"changeMagicType",currentType:d,newOption:l,newTitle:h,featureName:"magicType"})}},e}(Of),jZ={line:function(n,e,t,r){if(n==="bar")return Li({id:e,type:"line",data:t.get("data"),stack:t.get("stack"),markPoint:t.get("markPoint"),markLine:t.get("markLine")},r.get(["option","line"])||{},!0)},bar:function(n,e,t,r){if(n==="line")return Li({id:e,type:"bar",data:t.get("data"),stack:t.get("stack"),markPoint:t.get("markPoint"),markLine:t.get("markLine")},r.get(["option","bar"])||{},!0)},stack:function(n,e,t,r){var i=t.get("stack")===HZ;if(n==="line"||n==="bar")return r.setIconStatus("stack",i?"normal":"emphasis"),Li({id:e,stack:i?"":HZ},r.get(["option","stack"])||{},!0)}};vp({type:"changeMagicType",event:"magicTypeChanged",update:"prepareAndUpdate"},function(n,e){e.mergeOption(n.newOption)});var VD=new Array(60).join("-"),rw="	";function r5e(n){var e={},t=[],r=[];return n.eachRawSeries(function(i){var s=i.coordinateSystem;if(s&&(s.type==="cartesian2d"||s.type==="polar")){var a=s.getBaseAxis();if(a.type==="category"){var l=a.dim+"_"+a.index;e[l]||(e[l]={categoryAxis:a,valueAxis:s.getOtherAxis(a),series:[]},r.push({axisDim:a.dim,axisIndex:a.index})),e[l].series.push(i)}else t.push(i)}else t.push(i)}),{seriesGroupByCategoryAxis:e,other:t,meta:r}}function i5e(n){var e=[];return it(n,function(t,r){var i=t.categoryAxis,s=t.valueAxis,a=s.dim,l=[" "].concat(xr(t.series,function(y){return y.name})),o=[i.model.getCategories()];it(t.series,function(y){var T=y.getRawData();o.push(y.getRawData().mapArray(T.mapDimension(a),function(I){return I}))});for(var h=[l.join(rw)],d=0;d<o[0].length;d++){for(var m=[],_=0;_<o.length;_++)m.push(o[_][d]);h.push(m.join(rw))}e.push(h.join(`
`))}),e.join(`

`+VD+`

`)}function s5e(n){return xr(n,function(e){var t=e.getRawData(),r=[e.name],i=[];return t.each(t.dimensions,function(){for(var s=arguments.length,a=arguments[s-1],l=t.getName(a),o=0;o<s-1;o++)i[o]=arguments[o];r.push((l?l+rw:"")+i.join(rw))}),r.join(`
`)}).join(`

`+VD+`

`)}function o5e(n){var e=r5e(n);return{value:ta([i5e(e.seriesGroupByCategoryAxis),s5e(e.other)],function(t){return!!t.replace(/[\n\t\s]/g,"")}).join(`

`+VD+`

`),meta:e.meta}}function FP(n){return n.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function a5e(n){var e=n.slice(0,n.indexOf(`
`));if(e.indexOf(rw)>=0)return!0}var AN=new RegExp("["+rw+"]+","g");function l5e(n){for(var e=n.split(/\n+/g),t=FP(e.shift()).split(AN),r=[],i=xr(t,function(o){return{name:o,data:[]}}),s=0;s<e.length;s++){var a=FP(e[s]).split(AN);r.push(a.shift());for(var l=0;l<a.length;l++)i[l]&&(i[l].data[s]=a[l])}return{series:i,categories:r}}function c5e(n){for(var e=n.split(/\n+/g),t=FP(e.shift()),r=[],i=0;i<e.length;i++){var s=FP(e[i]);if(s){var a=s.split(AN),l="",o=void 0,h=!1;isNaN(a[0])?(h=!0,l=a[0],a=a.slice(1),r[i]={name:l,value:[]},o=r[i].value):o=r[i]=[];for(var d=0;d<a.length;d++)o.push(+a[d]);o.length===1&&(h?r[i].value=o[0]:r[i]=o[0])}}return{name:t,data:r}}function u5e(n,e){var t=n.split(new RegExp(`
*`+VD+`
*`,"g")),r={series:[]};return it(t,function(i,s){if(a5e(i)){var a=l5e(i),l=e[s],o=l.axisDim+"Axis";l&&(r[o]=r[o]||[],r[o][l.axisIndex]={data:a.categories},r.series=r.series.concat(a.series))}else{var a=c5e(i);r.series.push(a)}}),r}var h5e=function(n){Hn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.onclick=function(t,r){setTimeout(function(){r.dispatchAction({type:"hideTip"})});var i=r.getDom(),s=this.model;this._dom&&i.removeChild(this._dom);var a=document.createElement("div");a.style.cssText="position:absolute;top:0;bottom:0;left:0;right:0;padding:5px",a.style.backgroundColor=s.get("backgroundColor")||"#fff";var l=document.createElement("h4"),o=s.get("lang")||[];l.innerHTML=o[0]||s.get("title"),l.style.cssText="margin:10px 20px",l.style.color=s.get("textColor");var h=document.createElement("div"),d=document.createElement("textarea");h.style.cssText="overflow:auto";var m=s.get("optionToContent"),_=s.get("contentToOption"),y=o5e(t);if(li(m)){var T=m(r.getOption());Dr(T)?h.innerHTML=T:Yb(T)&&h.appendChild(T)}else{d.readOnly=s.get("readOnly");var I=d.style;I.cssText="display:block;width:100%;height:100%;font-family:monospace;font-size:14px;line-height:1.6rem;resize:none;box-sizing:border-box;outline:none",I.color=s.get("textColor"),I.borderColor=s.get("textareaBorderColor"),I.backgroundColor=s.get("textareaColor"),d.value=y.value,h.appendChild(d)}var C=y.meta,M=document.createElement("div");M.style.cssText="position:absolute;bottom:5px;left:0;right:0";var B="float:right;margin-right:20px;border:none;cursor:pointer;padding:2px 5px;font-size:12px;border-radius:3px",k=document.createElement("div"),j=document.createElement("div");B+=";background-color:"+s.get("buttonColor"),B+=";color:"+s.get("buttonTextColor");var q=this;function Z(){i.removeChild(a),q._dom=null}AF(k,"click",Z),AF(j,"click",function(){if(_==null&&m!=null||_!=null&&m==null){Z();return}var te;try{li(_)?te=_(h,r.getOption()):te=u5e(d.value,C)}catch(ie){throw Z(),new Error("Data view format error "+ie)}te&&r.dispatchAction({type:"changeDataView",newOption:te}),Z()}),k.innerHTML=o[1],j.innerHTML=o[2],j.style.cssText=k.style.cssText=B,!s.get("readOnly")&&M.appendChild(j),M.appendChild(k),a.appendChild(l),a.appendChild(h),a.appendChild(M),h.style.height=i.clientHeight-80+"px",i.appendChild(a),this._dom=a},e.prototype.remove=function(t,r){this._dom&&r.getDom().removeChild(this._dom)},e.prototype.dispose=function(t,r){this.remove(t,r)},e.getDefaultOption=function(t){var r={show:!0,readOnly:!1,optionToContent:null,contentToOption:null,icon:"M17.5,17.3H33 M17.5,17.3H33 M45.4,29.5h-28 M11.5,2v56H51V14.8L38.4,2H11.5z M38.4,2.2v12.7H51 M45.4,41.7h-28",title:t.getLocaleModel().get(["toolbox","dataView","title"]),lang:t.getLocaleModel().get(["toolbox","dataView","lang"]),backgroundColor:"#fff",textColor:"#000",textareaColor:"#fff",textareaBorderColor:"#333",buttonColor:"#c23531",buttonTextColor:"#fff"};return r},e}(Of);function f5e(n,e){return xr(n,function(t,r){var i=e&&e[r];if(Xr(i)&&!fr(i)){var s=Xr(t)&&!fr(t);s||(t={value:t});var a=i.name!=null&&t.name==null;return t=ti(t,i),a&&delete t.name,t}else return t})}vp({type:"changeDataView",event:"dataViewChanged",update:"prepareAndUpdate"},function(n,e){var t=[];it(n.newOption.series,function(r){var i=e.getSeriesByName(r.name)[0];if(!i)t.push(Jn({type:"scatter"},r));else{var s=i.get("data");t.push({name:r.name,data:f5e(r.data,s)})}}),e.mergeOption(ti({series:t},n.newOption))});var bae=it,wae=Xs();function d5e(n,e){var t=a8(n);bae(e,function(r,i){for(var s=t.length-1;s>=0;s--){var a=t[s];if(a[i])break}if(s<0){var l=n.queryComponents({mainType:"dataZoom",subType:"select",id:i})[0];if(l){var o=l.getPercentRange();t[0][i]={dataZoomId:i,start:o[0],end:o[1]}}}}),t.push(e)}function p5e(n){var e=a8(n),t=e[e.length-1];e.length>1&&e.pop();var r={};return bae(t,function(i,s){for(var a=e.length-1;a>=0;a--)if(i=e[a][s],i){r[s]=i;break}}),r}function m5e(n){wae(n).snapshots=null}function g5e(n){return a8(n).length}function a8(n){var e=wae(n);return e.snapshots||(e.snapshots=[{}]),e.snapshots}var v5e=function(n){Hn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.onclick=function(t,r){m5e(t),r.dispatchAction({type:"restore",from:this.uid})},e.getDefaultOption=function(t){var r={show:!0,icon:"M3.8,33.4 M47,18.9h9.8V8.7 M56.3,20.1 C52.1,9,40.5,0.6,26.8,2.1C12.6,3.7,1.6,16.2,2.1,30.6 M13,41.1H3.1v10.2 M3.7,39.9c4.2,11.1,15.8,19.5,29.5,18 c14.2-1.6,25.2-14.1,24.7-28.5",title:t.getLocaleModel().get(["toolbox","restore","title"])};return r},e}(Of);vp({type:"restore",event:"restore",update:"prepareAndUpdate"},function(n,e){e.resetOption("recreate")});var _5e=["grid","xAxis","yAxis","geo","graph","polar","radiusAxis","angleAxis","bmap"],Sae=function(){function n(e,t,r){var i=this;this._targetInfoList=[];var s=WZ(t,e);it(y5e,function(a,l){(!r||!r.include||Wi(r.include,l)>=0)&&a(s,i._targetInfoList)})}return n.prototype.setOutputRanges=function(e,t){return this.matchOutputRanges(e,t,function(r,i,s){if((r.coordRanges||(r.coordRanges=[])).push(i),!r.coordRange){r.coordRange=i;var a=dk[r.brushType](0,s,i);r.__rangeOffset={offset:ZZ[r.brushType](a.values,r.range,[1,1]),xyMinMax:a.xyMinMax}}}),e},n.prototype.matchOutputRanges=function(e,t,r){it(e,function(i){var s=this.findTargetInfo(i,t);s&&s!==!0&&it(s.coordSyses,function(a){var l=dk[i.brushType](1,a,i.range,!0);r(i,l.values,a,t)})},this)},n.prototype.setInputRanges=function(e,t){it(e,function(r){var i=this.findTargetInfo(r,t);if(r.range=r.range||[],i&&i!==!0){r.panelId=i.panelId;var s=dk[r.brushType](0,i.coordSys,r.coordRange),a=r.__rangeOffset;r.range=a?ZZ[r.brushType](s.values,a.offset,x5e(s.xyMinMax,a.xyMinMax)):s.values}},this)},n.prototype.makePanelOpts=function(e,t){return xr(this._targetInfoList,function(r){var i=r.getPanelRect();return{panelId:r.panelId,defaultBrushType:t?t(r):null,clipPath:U3e(i),isTargetByCursor:G3e(i,e,r.coordSysModel),getLinearBrushOtherExtent:V3e(i)}})},n.prototype.controlSeries=function(e,t,r){var i=this.findTargetInfo(e,r);return i===!0||i&&Wi(i.coordSyses,t.coordinateSystem)>=0},n.prototype.findTargetInfo=function(e,t){for(var r=this._targetInfoList,i=WZ(t,e),s=0;s<r.length;s++){var a=r[s],l=e.panelId;if(l){if(a.panelId===l)return a}else for(var o=0;o<XZ.length;o++)if(XZ[o](i,a))return a}return!0},n}();function TN(n){return n[0]>n[1]&&n.reverse(),n}function WZ(n,e){return KS(n,e,{includeMainTypes:_5e})}var y5e={grid:function(n,e){var t=n.xAxisModels,r=n.yAxisModels,i=n.gridModels,s=ri(),a={},l={};!t&&!r&&!i||(it(t,function(o){var h=o.axis.grid.model;s.set(h.id,h),a[h.id]=!0}),it(r,function(o){var h=o.axis.grid.model;s.set(h.id,h),l[h.id]=!0}),it(i,function(o){s.set(o.id,o),a[o.id]=!0,l[o.id]=!0}),s.each(function(o){var h=o.coordinateSystem,d=[];it(h.getCartesians(),function(m,_){(Wi(t,m.getAxis("x").model)>=0||Wi(r,m.getAxis("y").model)>=0)&&d.push(m)}),e.push({panelId:"grid--"+o.id,gridModel:o,coordSysModel:o,coordSys:d[0],coordSyses:d,getPanelRect:$Z.grid,xAxisDeclared:a[o.id],yAxisDeclared:l[o.id]})}))},geo:function(n,e){it(n.geoModels,function(t){var r=t.coordinateSystem;e.push({panelId:"geo--"+t.id,geoModel:t,coordSysModel:t,coordSys:r,coordSyses:[r],getPanelRect:$Z.geo})})}},XZ=[function(n,e){var t=n.xAxisModel,r=n.yAxisModel,i=n.gridModel;return!i&&t&&(i=t.axis.grid.model),!i&&r&&(i=r.axis.grid.model),i&&i===e.gridModel},function(n,e){var t=n.geoModel;return t&&t===e.geoModel}],$Z={grid:function(){return this.coordSys.master.getRect().clone()},geo:function(){var n=this.coordSys,e=n.getBoundingRect().clone();return e.applyTransform(gU(n)),e}},dk={lineX:ms(qZ,0),lineY:ms(qZ,1),rect:function(n,e,t,r){var i=n?e.pointToData([t[0][0],t[1][0]],r):e.dataToPoint([t[0][0],t[1][0]],r),s=n?e.pointToData([t[0][1],t[1][1]],r):e.dataToPoint([t[0][1],t[1][1]],r),a=[TN([i[0],s[0]]),TN([i[1],s[1]])];return{values:a,xyMinMax:a}},polygon:function(n,e,t,r){var i=[[1/0,-1/0],[1/0,-1/0]],s=xr(t,function(a){var l=n?e.pointToData(a,r):e.dataToPoint(a,r);return i[0][0]=Math.min(i[0][0],l[0]),i[1][0]=Math.min(i[1][0],l[1]),i[0][1]=Math.max(i[0][1],l[0]),i[1][1]=Math.max(i[1][1],l[1]),l});return{values:s,xyMinMax:i}}};function qZ(n,e,t,r){var i=t.getAxis(["x","y"][n]),s=TN(xr([0,1],function(l){return e?i.coordToData(i.toLocalCoord(r[l]),!0):i.toGlobalCoord(i.dataToCoord(r[l]))})),a=[];return a[n]=s,a[1-n]=[NaN,NaN],{values:s,xyMinMax:a}}var ZZ={lineX:ms(YZ,0),lineY:ms(YZ,1),rect:function(n,e,t){return[[n[0][0]-t[0]*e[0][0],n[0][1]-t[0]*e[0][1]],[n[1][0]-t[1]*e[1][0],n[1][1]-t[1]*e[1][1]]]},polygon:function(n,e,t){return xr(n,function(r,i){return[r[0]-t[0]*e[i][0],r[1]-t[1]*e[i][1]]})}};function YZ(n,e,t,r){return[e[0]-r[n]*t[0],e[1]-r[n]*t[1]]}function x5e(n,e){var t=KZ(n),r=KZ(e),i=[t[0]/r[0],t[1]/r[1]];return isNaN(i[0])&&(i[0]=1),isNaN(i[1])&&(i[1]=1),i}function KZ(n){return n?[n[0][1]-n[0][0],n[1][1]-n[1][0]]:[NaN,NaN]}var MN=it,b5e=jTe("toolbox-dataZoom_"),w5e=function(n){Hn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.render=function(t,r,i,s){this._brushController||(this._brushController=new P3e(i.getZr()),this._brushController.on("brush",Ns(this._onBrush,this)).mount()),T5e(t,r,this,s,i),A5e(t,r)},e.prototype.onclick=function(t,r,i){S5e[i].call(this)},e.prototype.remove=function(t,r){this._brushController&&this._brushController.unmount()},e.prototype.dispose=function(t,r){this._brushController&&this._brushController.dispose()},e.prototype._onBrush=function(t){var r=t.areas;if(!t.isEnd||!r.length)return;var i={},s=this.ecModel;this._brushController.updateCovers([]);var a=new Sae(l8(this.model),s,{include:["grid"]});a.matchOutputRanges(r,s,function(h,d,m){if(m.type==="cartesian2d"){var _=h.brushType;_==="rect"?(l("x",m,d[0]),l("y",m,d[1])):l({lineX:"x",lineY:"y"}[_],m,d)}}),d5e(s,i),this._dispatchZoomAction(i);function l(h,d,m){var _=d.getAxis(h),y=_.model,T=o(h,y,s),I=T.findRepresentativeAxisProxy(y).getMinMaxSpan();(I.minValueSpan!=null||I.maxValueSpan!=null)&&(m=qoe(0,m.slice(),_.scale.getExtent(),0,I.minValueSpan,I.maxValueSpan)),T&&(i[T.id]={dataZoomId:T.id,startValue:m[0],endValue:m[1]})}function o(h,d,m){var _;return m.eachComponent({mainType:"dataZoom",subType:"select"},function(y){var T=y.getAxisModel(h,d.componentIndex);T&&(_=y)}),_}},e.prototype._dispatchZoomAction=function(t){var r=[];MN(t,function(i,s){r.push(vi(i))}),r.length&&this.api.dispatchAction({type:"dataZoom",from:this.uid,batch:r})},e.getDefaultOption=function(t){var r={show:!0,filterMode:"filter",icon:{zoom:"M0,13.5h26.9 M13.5,26.9V0 M32.1,13.5H58V58H13.5 V32.1",back:"M22,1.4L9.9,13.5l12.3,12.3 M10.3,13.5H54.9v44.6 H10.3v-26"},title:t.getLocaleModel().get(["toolbox","dataZoom","title"]),brushStyle:{borderWidth:0,color:"rgba(210,219,238,0.2)"}};return r},e}(Of),S5e={zoom:function(){var n=!this._isZoomActive;this.api.dispatchAction({type:"takeGlobalCursor",key:"dataZoomSelect",dataZoomSelectActive:n})},back:function(){this._dispatchZoomAction(p5e(this.ecModel))}};function l8(n){var e={xAxisIndex:n.get("xAxisIndex",!0),yAxisIndex:n.get("yAxisIndex",!0),xAxisId:n.get("xAxisId",!0),yAxisId:n.get("yAxisId",!0)};return e.xAxisIndex==null&&e.xAxisId==null&&(e.xAxisIndex="all"),e.yAxisIndex==null&&e.yAxisId==null&&(e.yAxisIndex="all"),e}function A5e(n,e){n.setIconStatus("back",g5e(e)>1?"emphasis":"normal")}function T5e(n,e,t,r,i){var s=t._isZoomActive;r&&r.type==="takeGlobalCursor"&&(s=r.key==="dataZoomSelect"?r.dataZoomSelectActive:!1),t._isZoomActive=s,n.setIconStatus("zoom",s?"emphasis":"normal");var a=new Sae(l8(n),e,{include:["grid"]}),l=a.makePanelOpts(i,function(o){return o.xAxisDeclared&&!o.yAxisDeclared?"lineX":!o.xAxisDeclared&&o.yAxisDeclared?"lineY":"rect"});t._brushController.setPanels(l).enableBrush(s&&l.length?{brushType:"auto",brushStyle:n.getModel("brushStyle").getItemStyle()}:!1)}NEe("dataZoom",function(n){var e=n.getComponent("toolbox",0),t=["feature","dataZoom"];if(!e||e.get(t)==null)return;var r=e.getModel(t),i=[],s=l8(r),a=KS(n,s);MN(a.xAxisModels,function(o){return l(o,"xAxis","xAxisIndex")}),MN(a.yAxisModels,function(o){return l(o,"yAxis","yAxisIndex")});function l(o,h,d){var m=o.componentIndex,_={type:"select",$fromToolbox:!0,filterMode:r.get("filterMode",!0)||"filter",id:b5e+h+m};_[d]=m,i.push(_)}return i});function M5e(n){n.registerComponentModel(Y4e),n.registerComponentView(J4e),Q2("saveAsImage",e5e),Q2("magicType",n5e),Q2("dataView",h5e),Q2("dataZoom",w5e),Q2("restore",v5e),fp(Z4e)}var C5e=function(n){Hn(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.type=e.type,t}return e.type="tooltip",e.dependencies=["axisPointer"],e.defaultOption={z:60,show:!0,showContent:!0,trigger:"item",triggerOn:"mousemove|click",alwaysShowContent:!1,displayMode:"single",renderMode:"auto",confine:null,showDelay:0,hideDelay:100,transitionDuration:.4,enterable:!1,backgroundColor:"#fff",shadowBlur:10,shadowColor:"rgba(0, 0, 0, .2)",shadowOffsetX:1,shadowOffsetY:2,borderRadius:4,borderWidth:1,padding:null,extraCssText:"",axisPointer:{type:"line",axis:"auto",animation:"auto",animationDurationUpdate:200,animationEasingUpdate:"exponentialOut",crossStyle:{color:"#999",width:1,type:"dashed",textStyle:{}}},textStyle:{color:"#666",fontSize:14}},e}(is);function Aae(n){var e=n.get("confine");return e!=null?!!e:n.get("renderMode")==="richText"}function Tae(n){if(pi.domSupported){for(var e=document.documentElement.style,t=0,r=n.length;t<r;t++)if(n[t]in e)return n[t]}}var Mae=Tae(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),E5e=Tae(["webkitTransition","transition","OTransition","MozTransition","msTransition"]);function Cae(n,e){if(!n)return e;e=Nie(e,!0);var t=n.indexOf(e);return n=t===-1?e:"-"+n.slice(0,t)+"-"+e,n.toLowerCase()}function I5e(n,e){var t=n.currentStyle||document.defaultView&&document.defaultView.getComputedStyle(n);return t?t[e]:null}var R5e=Cae(E5e,"transition"),c8=Cae(Mae,"transform"),P5e="position:absolute;display:block;border-style:solid;white-space:nowrap;z-index:9999999;"+(pi.transform3dSupported?"will-change:transform;":"");function L5e(n){return n=n==="left"?"right":n==="right"?"left":n==="top"?"bottom":"top",n}function D5e(n,e,t){if(!Dr(t)||t==="inside")return"";var r=n.get("backgroundColor"),i=n.get("borderWidth");e=ex(e);var s=L5e(t),a=Math.max(Math.round(i)*1.5,6),l="",o=c8+":",h;Wi(["left","right"],s)>-1?(l+="top:50%",o+="translateY(-50%) rotate("+(h=s==="left"?-225:-45)+"deg)"):(l+="left:50%",o+="translateX(-50%) rotate("+(h=s==="top"?225:45)+"deg)");var d=h*Math.PI/180,m=a+i,_=m*Math.abs(Math.cos(d))+m*Math.abs(Math.sin(d)),y=Math.round(((_-Math.SQRT2*i)/2+Math.SQRT2*i-(_-m)/2)*100)/100;l+=";"+s+":-"+y+"px";var T=e+" solid "+i+"px;",I=["position:absolute;width:"+a+"px;height:"+a+"px;z-index:-1;",l+";"+o+";","border-bottom:"+T,"border-right:"+T,"background-color:"+r+";"];return'<div style="'+I.join("")+'"></div>'}function B5e(n,e){var t="cubic-bezier(0.23,1,0.32,1)",r=" "+n/2+"s "+t,i="opacity"+r+",visibility"+r;return e||(r=" "+n+"s "+t,i+=pi.transformSupported?","+c8+r:",left"+r+",top"+r),R5e+":"+i}function JZ(n,e,t){var r=n.toFixed(0)+"px",i=e.toFixed(0)+"px";if(!pi.transformSupported)return t?"top:"+i+";left:"+r+";":[["top",i],["left",r]];var s=pi.transform3dSupported,a="translate"+(s?"3d":"")+"("+r+","+i+(s?",0":"")+")";return t?"top:0;left:0;"+c8+":"+a+";":[["top",0],["left",0],[Mae,a]]}function k5e(n){var e=[],t=n.get("fontSize"),r=n.getTextColor();r&&e.push("color:"+r),e.push("font:"+n.getFont()),t&&e.push("line-height:"+Math.round(t*3/2)+"px");var i=n.get("textShadowColor"),s=n.get("textShadowBlur")||0,a=n.get("textShadowOffsetX")||0,l=n.get("textShadowOffsetY")||0;return i&&s&&e.push("text-shadow:"+a+"px "+l+"px "+s+"px "+i),it(["decoration","align"],function(o){var h=n.get(o);h&&e.push("text-"+o+":"+h)}),e.join(";")}function O5e(n,e,t){var r=[],i=n.get("transitionDuration"),s=n.get("backgroundColor"),a=n.get("shadowBlur"),l=n.get("shadowColor"),o=n.get("shadowOffsetX"),h=n.get("shadowOffsetY"),d=n.getModel("textStyle"),m=pse(n,"html"),_=o+"px "+h+"px "+a+"px "+l;return r.push("box-shadow:"+_),e&&i&&r.push(B5e(i,t)),s&&r.push("background-color:"+s),it(["width","color","radius"],function(y){var T="border-"+y,I=Nie(T),C=n.get(I);C!=null&&r.push(T+":"+C+(y==="color"?"":"px"))}),r.push(k5e(d)),m!=null&&r.push("padding:"+LD(m).join("px ")+"px"),r.join(";")+";"}function QZ(n,e,t,r,i){var s=e&&e.painter;if(t){var a=s&&s.getViewportRoot();a&&TAe(n,a,t,r,i)}else{n[0]=r,n[1]=i;var l=s&&s.getViewportRootOffset();l&&(n[0]+=l.offsetLeft,n[1]+=l.offsetTop)}n[2]=n[0]/e.getWidth(),n[3]=n[1]/e.getHeight()}var F5e=function(){function n(e,t){if(this._show=!1,this._styleCoord=[0,0,0,0],this._enterable=!0,this._alwaysShowContent=!1,this._firstShow=!0,this._longHide=!0,pi.wxa)return null;var r=document.createElement("div");r.domBelongToZr=!0,this.el=r;var i=this._zr=e.getZr(),s=t.appendTo,a=s&&(Dr(s)?document.querySelector(s):Yb(s)?s:li(s)&&s(e.getDom()));QZ(this._styleCoord,i,a,e.getWidth()/2,e.getHeight()/2),(a||e.getDom()).appendChild(r),this._api=e,this._container=a;var l=this;r.onmouseenter=function(){l._enterable&&(clearTimeout(l._hideTimeout),l._show=!0),l._inContent=!0},r.onmousemove=function(o){if(o=o||window.event,!l._enterable){var h=i.handler,d=i.painter.getViewportRoot();hh(d,o,!0),h.dispatch("mousemove",o)}},r.onmouseleave=function(){l._inContent=!1,l._enterable&&l._show&&l.hideLater(l._hideDelay)}}return n.prototype.update=function(e){if(!this._container){var t=this._api.getDom(),r=I5e(t,"position"),i=t.style;i.position!=="absolute"&&r!=="absolute"&&(i.position="relative")}var s=e.get("alwaysShowContent");s&&this._moveIfResized(),this._alwaysShowContent=s,this.el.className=e.get("className")||""},n.prototype.show=function(e,t){clearTimeout(this._hideTimeout),clearTimeout(this._longHideTimeout);var r=this.el,i=r.style,s=this._styleCoord;r.innerHTML?i.cssText=P5e+O5e(e,!this._firstShow,this._longHide)+JZ(s[0],s[1],!0)+("border-color:"+ex(t)+";")+(e.get("extraCssText")||"")+(";pointer-events:"+(this._enterable?"auto":"none")):i.display="none",this._show=!0,this._firstShow=!1,this._longHide=!1},n.prototype.setContent=function(e,t,r,i,s){var a=this.el;if(e==null){a.innerHTML="";return}var l="";if(Dr(s)&&r.get("trigger")==="item"&&!Aae(r)&&(l=D5e(r,i,s)),Dr(e))a.innerHTML=e+l;else if(e){a.innerHTML="",fr(e)||(e=[e]);for(var o=0;o<e.length;o++)Yb(e[o])&&e[o].parentNode!==a&&a.appendChild(e[o]);if(l&&a.childNodes.length){var h=document.createElement("div");h.innerHTML=l,a.appendChild(h)}}},n.prototype.setEnterable=function(e){this._enterable=e},n.prototype.getSize=function(){var e=this.el;return[e.offsetWidth,e.offsetHeight]},n.prototype.moveTo=function(e,t){var r=this._styleCoord;if(QZ(r,this._zr,this._container,e,t),r[0]!=null&&r[1]!=null){var i=this.el.style,s=JZ(r[0],r[1]);it(s,function(a){i[a[0]]=a[1]})}},n.prototype._moveIfResized=function(){var e=this._styleCoord[2],t=this._styleCoord[3];this.moveTo(e*this._zr.getWidth(),t*this._zr.getHeight())},n.prototype.hide=function(){var e=this,t=this.el.style;t.visibility="hidden",t.opacity="0",pi.transform3dSupported&&(t.willChange=""),this._show=!1,this._longHideTimeout=setTimeout(function(){return e._longHide=!0},500)},n.prototype.hideLater=function(e){this._show&&!(this._inContent&&this._enterable)&&!this._alwaysShowContent&&(e?(this._hideDelay=e,this._show=!1,this._hideTimeout=setTimeout(Ns(this.hide,this),e)):this.hide())},n.prototype.isShow=function(){return this._show},n.prototype.dispose=function(){clearTimeout(this._hideTimeout),clearTimeout(this._longHideTimeout);var e=this.el.parentNode;e&&e.removeChild(this.el),this.el=this._container=null},n}(),N5e=function(){function n(e){this._show=!1,this._styleCoord=[0,0,0,0],this._alwaysShowContent=!1,this._enterable=!0,this._zr=e.getZr(),tY(this._styleCoord,this._zr,e.getWidth()/2,e.getHeight()/2)}return n.prototype.update=function(e){var t=e.get("alwaysShowContent");t&&this._moveIfResized(),this._alwaysShowContent=t},n.prototype.show=function(){this._hideTimeout&&clearTimeout(this._hideTimeout),this.el.show(),this._show=!0},n.prototype.setContent=function(e,t,r,i,s){var a=this;Xr(e)&&ss(""),this.el&&this._zr.remove(this.el);var l=r.getModel("textStyle");this.el=new Ca({style:{rich:t.richTextStyles,text:e,lineHeight:22,borderWidth:1,borderColor:i,textShadowColor:l.get("textShadowColor"),fill:r.get(["textStyle","color"]),padding:pse(r,"richText"),verticalAlign:"top",align:"left"},z:r.get("z")}),it(["backgroundColor","borderRadius","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY"],function(h){a.el.style[h]=r.get(h)}),it(["textShadowBlur","textShadowOffsetX","textShadowOffsetY"],function(h){a.el.style[h]=l.get(h)||0}),this._zr.add(this.el);var o=this;this.el.on("mouseover",function(){o._enterable&&(clearTimeout(o._hideTimeout),o._show=!0),o._inContent=!0}),this.el.on("mouseout",function(){o._enterable&&o._show&&o.hideLater(o._hideDelay),o._inContent=!1})},n.prototype.setEnterable=function(e){this._enterable=e},n.prototype.getSize=function(){var e=this.el,t=this.el.getBoundingRect(),r=eY(e.style);return[t.width+r.left+r.right,t.height+r.top+r.bottom]},n.prototype.moveTo=function(e,t){var r=this.el;if(r){var i=this._styleCoord;tY(i,this._zr,e,t),e=i[0],t=i[1];var s=r.style,a=M0(s.borderWidth||0),l=eY(s);r.x=e+a+l.left,r.y=t+a+l.top,r.markRedraw()}},n.prototype._moveIfResized=function(){var e=this._styleCoord[2],t=this._styleCoord[3];this.moveTo(e*this._zr.getWidth(),t*this._zr.getHeight())},n.prototype.hide=function(){this.el&&this.el.hide(),this._show=!1},n.prototype.hideLater=function(e){this._show&&!(this._inContent&&this._enterable)&&!this._alwaysShowContent&&(e?(this._hideDelay=e,this._show=!1,this._hideTimeout=setTimeout(Ns(this.hide,this),e)):this.hide())},n.prototype.isShow=function(){return this._show},n.prototype.dispose=function(){this._zr.remove(this.el)},n}();function M0(n){return Math.max(0,n)}function eY(n){var e=M0(n.shadowBlur||0),t=M0(n.shadowOffsetX||0),r=M0(n.shadowOffsetY||0);return{left:M0(e-t),right:M0(e+t),top:M0(e-r),bottom:M0(e+r)}}function tY(n,e,t,r){n[0]=t,n[1]=r,n[2]=n[0]/e.getWidth(),n[3]=n[1]/e.getHeight()}var z5e=new Go({shape:{x:-1,y:-1,width:2,height:2}}),U5e=function(n){Hn(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.init=function(t,r){if(!(pi.node||!r.getDom())){var i=t.getComponent("tooltip"),s=this._renderMode=YTe(i.get("renderMode"));this._tooltipContent=s==="richText"?new N5e(r):new F5e(r,{appendTo:i.get("appendToBody",!0)?"body":i.get("appendTo",!0)})}},e.prototype.render=function(t,r,i){if(!(pi.node||!i.getDom())){this.group.removeAll(),this._tooltipModel=t,this._ecModel=r,this._api=i;var s=this._tooltipContent;s.update(t),s.setEnterable(t.get("enterable")),this._initGlobalListener(),this._keepShow(),this._renderMode!=="richText"&&t.get("transitionDuration")?gse(this,"_updatePosition",50,"fixRate"):eN(this,"_updatePosition")}},e.prototype._initGlobalListener=function(){var t=this._tooltipModel,r=t.get("triggerOn");dae("itemTooltip",this._api,Ns(function(i,s,a){r!=="none"&&(r.indexOf(i)>=0?this._tryShow(s,a):i==="leave"&&this._hide(a))},this))},e.prototype._keepShow=function(){var t=this._tooltipModel,r=this._ecModel,i=this._api,s=t.get("triggerOn");if(this._lastX!=null&&this._lastY!=null&&s!=="none"&&s!=="click"){var a=this;clearTimeout(this._refreshUpdateTimeout),this._refreshUpdateTimeout=setTimeout(function(){!i.isDisposed()&&a.manuallyShowTip(t,r,i,{x:a._lastX,y:a._lastY,dataByCoordSys:a._lastDataByCoordSys})})}},e.prototype.manuallyShowTip=function(t,r,i,s){if(!(s.from===this.uid||pi.node||!i.getDom())){var a=nY(s,i);this._ticket="";var l=s.dataByCoordSys,o=j5e(s,r,i);if(o){var h=o.el.getBoundingRect().clone();h.applyTransform(o.el.transform),this._tryShow({offsetX:h.x+h.width/2,offsetY:h.y+h.height/2,target:o.el,position:s.position,positionDefault:"bottom"},a)}else if(s.tooltip&&s.x!=null&&s.y!=null){var d=z5e;d.x=s.x,d.y=s.y,d.update(),ji(d).tooltipConfig={name:null,option:s.tooltip},this._tryShow({offsetX:s.x,offsetY:s.y,target:d},a)}else if(l)this._tryShow({offsetX:s.x,offsetY:s.y,position:s.position,dataByCoordSys:l,tooltipOption:s.tooltipOption},a);else if(s.seriesIndex!=null){if(this._manuallyAxisShowTip(t,r,i,s))return;var m=pae(s,r),_=m.point[0],y=m.point[1];_!=null&&y!=null&&this._tryShow({offsetX:_,offsetY:y,target:m.el,position:s.position,positionDefault:"bottom"},a)}else s.x!=null&&s.y!=null&&(i.dispatchAction({type:"updateAxisPointer",x:s.x,y:s.y}),this._tryShow({offsetX:s.x,offsetY:s.y,position:s.position,target:i.getZr().findHover(s.x,s.y).target},a))}},e.prototype.manuallyHideTip=function(t,r,i,s){var a=this._tooltipContent;this._tooltipModel&&a.hideLater(this._tooltipModel.get("hideDelay")),this._lastX=this._lastY=this._lastDataByCoordSys=null,s.from!==this.uid&&this._hide(nY(s,i))},e.prototype._manuallyAxisShowTip=function(t,r,i,s){var a=s.seriesIndex,l=s.dataIndex,o=r.getComponent("axisPointer").coordSysAxesInfo;if(!(a==null||l==null||o==null)){var h=r.getSeriesByIndex(a);if(h){var d=h.getData(),m=eS([d.getItemModel(l),h,(h.coordinateSystem||{}).model],this._tooltipModel);if(m.get("trigger")==="axis")return i.dispatchAction({type:"updateAxisPointer",seriesIndex:a,dataIndex:l,position:s.position}),!0}}},e.prototype._tryShow=function(t,r){var i=t.target,s=this._tooltipModel;if(s){this._lastX=t.offsetX,this._lastY=t.offsetY;var a=t.dataByCoordSys;if(a&&a.length)this._showAxisTooltip(a,t);else if(i){var l=ji(i);if(l.ssrType==="legend")return;this._lastDataByCoordSys=null;var o,h;bS(i,function(d){if(ji(d).dataIndex!=null)return o=d,!0;if(ji(d).tooltipConfig!=null)return h=d,!0},!0),o?this._showSeriesItemTooltip(t,o,r):h?this._showComponentItemTooltip(t,h,r):this._hide(r)}else this._lastDataByCoordSys=null,this._hide(r)}},e.prototype._showOrMove=function(t,r){var i=t.get("showDelay");r=Ns(r,this),clearTimeout(this._showTimout),i>0?this._showTimout=setTimeout(r,i):r()},e.prototype._showAxisTooltip=function(t,r){var i=this._ecModel,s=this._tooltipModel,a=[r.offsetX,r.offsetY],l=eS([r.tooltipOption],s),o=this._renderMode,h=[],d=rT("section",{blocks:[],noHeader:!0}),m=[],_=new zB;it(t,function(B){it(B.dataByAxis,function(k){var j=i.getComponent(k.axisDim+"Axis",k.axisIndex),q=k.value;if(!(!j||q==null)){var Z=uae(q,j.axis,i,k.seriesDataIndices,k.valueLabelOpt),te=rT("section",{header:Z,noHeader:!Jd(Z),sortBlocks:!0,blocks:[]});d.blocks.push(te),it(k.seriesDataIndices,function(ie){var se=i.getSeriesByIndex(ie.seriesIndex),ae=ie.dataIndexInside,fe=se.getDataParams(ae);if(!(fe.dataIndex<0)){fe.axisDim=k.axisDim,fe.axisIndex=k.axisIndex,fe.axisType=k.axisType,fe.axisId=k.axisId,fe.axisValue=jU(j.axis,{value:q}),fe.axisValueLabel=Z,fe.marker=_.makeTooltipMarker("item",ex(fe.color),o);var Se=W$(se.formatTooltip(ae,!0,null)),Ee=Se.frag;if(Ee){var Re=eS([se],s).get("valueFormatter");te.blocks.push(Re?Jn({valueFormatter:Re},Ee):Ee)}Se.text&&m.push(Se.text),h.push(fe)}})}})}),d.blocks.reverse(),m.reverse();var y=r.position,T=l.get("order"),I=K$(d,_,o,T,i.get("useUTC"),l.get("textStyle"));I&&m.unshift(I);var C=o==="richText"?`

`:"<br/>",M=m.join(C);this._showOrMove(l,function(){this._updateContentNotChangedOnAxis(t,h)?this._updatePosition(l,y,a[0],a[1],this._tooltipContent,h):this._showTooltipContent(l,M,h,Math.random()+"",a[0],a[1],y,null,_)})},e.prototype._showSeriesItemTooltip=function(t,r,i){var s=this._ecModel,a=ji(r),l=a.seriesIndex,o=s.getSeriesByIndex(l),h=a.dataModel||o,d=a.dataIndex,m=a.dataType,_=h.getData(m),y=this._renderMode,T=t.positionDefault,I=eS([_.getItemModel(d),h,o&&(o.coordinateSystem||{}).model],this._tooltipModel,T?{position:T}:null),C=I.get("trigger");if(!(C!=null&&C!=="item")){var M=h.getDataParams(d,m),B=new zB;M.marker=B.makeTooltipMarker("item",ex(M.color),y);var k=W$(h.formatTooltip(d,!1,m)),j=I.get("order"),q=I.get("valueFormatter"),Z=k.frag,te=Z?K$(q?Jn({valueFormatter:q},Z):Z,B,y,j,s.get("useUTC"),I.get("textStyle")):k.text,ie="item_"+h.name+"_"+d;this._showOrMove(I,function(){this._showTooltipContent(I,te,M,ie,t.offsetX,t.offsetY,t.position,t.target,B)}),i({type:"showTip",dataIndexInside:d,dataIndex:_.getRawIndex(d),seriesIndex:l,from:this.uid})}},e.prototype._showComponentItemTooltip=function(t,r,i){var s=this._renderMode==="html",a=ji(r),l=a.tooltipConfig,o=l.option||{},h=o.encodeHTMLContent;if(Dr(o)){var d=o;o={content:d,formatter:d},h=!0}h&&s&&o.content&&(o=vi(o),o.content=Eu(o.content));var m=[o],_=this._ecModel.getComponent(a.componentMainType,a.componentIndex);_&&m.push(_),m.push({formatter:o.content});var y=t.positionDefault,T=eS(m,this._tooltipModel,y?{position:y}:null),I=T.get("content"),C=Math.random()+"",M=new zB;this._showOrMove(T,function(){var B=vi(T.get("formatterParams")||{});this._showTooltipContent(T,I,B,C,t.offsetX,t.offsetY,t.position,r,M)}),i({type:"showTip",from:this.uid})},e.prototype._showTooltipContent=function(t,r,i,s,a,l,o,h,d){if(this._ticket="",!(!t.get("showContent")||!t.get("show"))){var m=this._tooltipContent;m.setEnterable(t.get("enterable"));var _=t.get("formatter");o=o||t.get("position");var y=r,T=this._getNearestPoint([a,l],i,t.get("trigger"),t.get("borderColor")),I=T.color;if(_)if(Dr(_)){var C=t.ecModel.get("useUTC"),M=fr(i)?i[0]:i,B=M&&M.axisType&&M.axisType.indexOf("time")>=0;y=_,B&&(y=CD(M.axisValue,y,C)),y=zie(y,i,!0)}else if(li(_)){var k=Ns(function(j,q){j===this._ticket&&(m.setContent(q,d,t,I,o),this._updatePosition(t,o,a,l,m,i,h))},this);this._ticket=s,y=_(i,s,k)}else y=_;m.setContent(y,d,t,I,o),m.show(t,I),this._updatePosition(t,o,a,l,m,i,h)}},e.prototype._getNearestPoint=function(t,r,i,s){if(i==="axis"||fr(r))return{color:s||(this._renderMode==="html"?"#fff":"none")};if(!fr(r))return{color:s||r.color||r.borderColor}},e.prototype._updatePosition=function(t,r,i,s,a,l,o){var h=this._api.getWidth(),d=this._api.getHeight();r=r||t.get("position");var m=a.getSize(),_=t.get("align"),y=t.get("verticalAlign"),T=o&&o.getBoundingRect().clone();if(o&&T.applyTransform(o.transform),li(r)&&(r=r([i,s],l,a.el,T,{viewSize:[h,d],contentSize:m.slice()})),fr(r))i=os(r[0],h),s=os(r[1],d);else if(Xr(r)){var I=r;I.width=m[0],I.height=m[1];var C=mv(I,{width:h,height:d});i=C.x,s=C.y,_=null,y=null}else if(Dr(r)&&o){var M=H5e(r,T,m,t.get("borderWidth"));i=M[0],s=M[1]}else{var M=V5e(i,s,a,h,d,_?null:20,y?null:20);i=M[0],s=M[1]}if(_&&(i-=rY(_)?m[0]/2:_==="right"?m[0]:0),y&&(s-=rY(y)?m[1]/2:y==="bottom"?m[1]:0),Aae(t)){var M=G5e(i,s,a,h,d);i=M[0],s=M[1]}a.moveTo(i,s)},e.prototype._updateContentNotChangedOnAxis=function(t,r){var i=this._lastDataByCoordSys,s=this._cbParamsList,a=!!i&&i.length===t.length;return a&&it(i,function(l,o){var h=l.dataByAxis||[],d=t[o]||{},m=d.dataByAxis||[];a=a&&h.length===m.length,a&&it(h,function(_,y){var T=m[y]||{},I=_.seriesDataIndices||[],C=T.seriesDataIndices||[];a=a&&_.value===T.value&&_.axisType===T.axisType&&_.axisId===T.axisId&&I.length===C.length,a&&it(I,function(M,B){var k=C[B];a=a&&M.seriesIndex===k.seriesIndex&&M.dataIndex===k.dataIndex}),s&&it(_.seriesDataIndices,function(M){var B=M.seriesIndex,k=r[B],j=s[B];k&&j&&j.data!==k.data&&(a=!1)})})}),this._lastDataByCoordSys=t,this._cbParamsList=r,!!a},e.prototype._hide=function(t){this._lastDataByCoordSys=null,t({type:"hideTip",from:this.uid})},e.prototype.dispose=function(t,r){pi.node||!r.getDom()||(eN(this,"_updatePosition"),this._tooltipContent.dispose(),SN("itemTooltip",r))},e.type="tooltip",e}(Rc);function eS(n,e,t){var r=e.ecModel,i;t?(i=new Io(t,r,r),i=new Io(e.option,i,r)):i=e;for(var s=n.length-1;s>=0;s--){var a=n[s];a&&(a instanceof Io&&(a=a.get("tooltip",!0)),Dr(a)&&(a={formatter:a}),a&&(i=new Io(a,i,r)))}return i}function nY(n,e){return n.dispatchAction||Ns(e.dispatchAction,e)}function V5e(n,e,t,r,i,s,a){var l=t.getSize(),o=l[0],h=l[1];return s!=null&&(n+o+s+2>r?n-=o+s:n+=s),a!=null&&(e+h+a>i?e-=h+a:e+=a),[n,e]}function G5e(n,e,t,r,i){var s=t.getSize(),a=s[0],l=s[1];return n=Math.min(n+a,r)-a,e=Math.min(e+l,i)-l,n=Math.max(n,0),e=Math.max(e,0),[n,e]}function H5e(n,e,t,r){var i=t[0],s=t[1],a=Math.ceil(Math.SQRT2*r)+8,l=0,o=0,h=e.width,d=e.height;switch(n){case"inside":l=e.x+h/2-i/2,o=e.y+d/2-s/2;break;case"top":l=e.x+h/2-i/2,o=e.y-s-a;break;case"bottom":l=e.x+h/2-i/2,o=e.y+d+a;break;case"left":l=e.x-i-a,o=e.y+d/2-s/2;break;case"right":l=e.x+h+a,o=e.y+d/2-s/2}return[l,o]}function rY(n){return n==="center"||n==="middle"}function j5e(n,e,t){var r=sU(n).queryOptionMap,i=r.keys()[0];if(!(!i||i==="series")){var s=JT(e,i,r.get(i),{useDefault:!1,enableAll:!1,enableNone:!1}),a=s.models[0];if(a){var l=t.getViewOfComponentModel(a),o;if(l.group.traverse(function(h){var d=ji(h).tooltipConfig;if(d&&d.name===n.name)return o=h,!0}),o)return{componentMainType:i,componentIndex:a.componentIndex,el:o}}}}function W5e(n){fp(r8),n.registerComponentModel(C5e),n.registerComponentView(U5e),n.registerAction({type:"showTip",event:"showTip",update:"tooltip:manuallyShowTip"},Cc),n.registerAction({type:"hideTip",event:"hideTip",update:"tooltip:manuallyHideTip"},Cc)}var X5e=function(n){Hn(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.type=e.type,t.layoutMode={type:"box",ignoreSize:!0},t}return e.type="title",e.defaultOption={z:6,show:!0,text:"",target:"blank",subtext:"",subtarget:"blank",left:0,top:0,backgroundColor:"rgba(0,0,0,0)",borderColor:"#ccc",borderWidth:0,padding:5,itemGap:10,textStyle:{fontSize:18,fontWeight:"bold",color:"#464646"},subtextStyle:{fontSize:12,color:"#6E7079"}},e}(is),$5e=function(n){Hn(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.render=function(t,r,i){if(this.group.removeAll(),!!t.get("show")){var s=this.group,a=t.getModel("textStyle"),l=t.getModel("subtextStyle"),o=t.get("textAlign"),h=Ci(t.get("textBaseline"),t.get("textVerticalAlign")),d=new Ca({style:Ym(a,{text:t.get("text"),fill:a.getTextColor()},{disableBox:!0}),z2:10}),m=d.getBoundingRect(),_=t.get("subtext"),y=new Ca({style:Ym(l,{text:_,fill:l.getTextColor(),y:m.height+t.get("itemGap"),verticalAlign:"top"},{disableBox:!0}),z2:10}),T=t.get("link"),I=t.get("sublink"),C=t.get("triggerEvent",!0);d.silent=!T&&!C,y.silent=!I&&!C,T&&d.on("click",function(){C$(T,"_"+t.get("target"))}),I&&y.on("click",function(){C$(I,"_"+t.get("subtarget"))}),ji(d).eventData=ji(y).eventData=C?{componentType:"title",componentIndex:t.componentIndex}:null,s.add(d),_&&s.add(y);var M=s.getBoundingRect(),B=t.getBoxLayoutParams();B.width=M.width,B.height=M.height;var k=mv(B,{width:i.getWidth(),height:i.getHeight()},t.get("padding"));o||(o=t.get("left")||t.get("right"),o==="middle"&&(o="center"),o==="right"?k.x+=k.width:o==="center"&&(k.x+=k.width/2)),h||(h=t.get("top")||t.get("bottom"),h==="center"&&(h="middle"),h==="bottom"?k.y+=k.height:h==="middle"&&(k.y+=k.height/2),h=h||"top"),s.x=k.x,s.y=k.y,s.markRedraw();var j={align:o,verticalAlign:h};d.setStyle(j),y.setStyle(j),M=s.getBoundingRect();var q=k.margin,Z=t.getItemStyle(["color","opacity"]);Z.fill=t.get("backgroundColor");var te=new Go({shape:{x:M.x-q[3],y:M.y-q[0],width:M.width+q[1]+q[3],height:M.height+q[0]+q[2],r:t.get("borderRadius")},style:Z,subPixelOptimize:!0,silent:!0});s.add(te)}},e.type="title",e}(Rc);function q5e(n){n.registerComponentModel(X5e),n.registerComponentView($5e)}var Z5e=function(n,e){if(e==="all")return{type:"all",title:n.getLocaleModel().get(["legend","selector","all"])};if(e==="inverse")return{type:"inverse",title:n.getLocaleModel().get(["legend","selector","inverse"])}},CN=function(n){Hn(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.type=e.type,t.layoutMode={type:"box",ignoreSize:!0},t}return e.prototype.init=function(t,r,i){this.mergeDefaultAndTheme(t,i),t.selected=t.selected||{},this._updateSelector(t)},e.prototype.mergeOption=function(t,r){n.prototype.mergeOption.call(this,t,r),this._updateSelector(t)},e.prototype._updateSelector=function(t){var r=t.selector,i=this.ecModel;r===!0&&(r=t.selector=["all","inverse"]),fr(r)&&it(r,function(s,a){Dr(s)&&(s={type:s}),r[a]=Li(s,Z5e(i,s.type))})},e.prototype.optionUpdated=function(){this._updateData(this.ecModel);var t=this._data;if(t[0]&&this.get("selectedMode")==="single"){for(var r=!1,i=0;i<t.length;i++){var s=t[i].get("name");if(this.isSelected(s)){this.select(s),r=!0;break}}!r&&this.select(t[0].get("name"))}},e.prototype._updateData=function(t){var r=[],i=[];t.eachRawSeries(function(o){var h=o.name;i.push(h);var d;if(o.legendVisualProvider){var m=o.legendVisualProvider,_=m.getAllNames();t.isSeriesFiltered(o)||(i=i.concat(_)),_.length?r=r.concat(_):d=!0}else d=!0;d&&iU(o)&&r.push(o.name)}),this._availableNames=i;var s=this.get("data")||r,a=ri(),l=xr(s,function(o){return(Dr(o)||Is(o))&&(o={name:o}),a.get(o.name)?null:(a.set(o.name,!0),new Io(o,this,this.ecModel))},this);this._data=ta(l,function(o){return!!o})},e.prototype.getData=function(){return this._data},e.prototype.select=function(t){var r=this.option.selected,i=this.get("selectedMode");if(i==="single"){var s=this._data;it(s,function(a){r[a.get("name")]=!1})}r[t]=!0},e.prototype.unSelect=function(t){this.get("selectedMode")!=="single"&&(this.option.selected[t]=!1)},e.prototype.toggleSelected=function(t){var r=this.option.selected;r.hasOwnProperty(t)||(r[t]=!0),this[r[t]?"unSelect":"select"](t)},e.prototype.allSelect=function(){var t=this._data,r=this.option.selected;it(t,function(i){r[i.get("name",!0)]=!0})},e.prototype.inverseSelect=function(){var t=this._data,r=this.option.selected;it(t,function(i){var s=i.get("name",!0);r.hasOwnProperty(s)||(r[s]=!0),r[s]=!r[s]})},e.prototype.isSelected=function(t){var r=this.option.selected;return!(r.hasOwnProperty(t)&&!r[t])&&Wi(this._availableNames,t)>=0},e.prototype.getOrient=function(){return this.get("orient")==="vertical"?{index:1,name:"vertical"}:{index:0,name:"horizontal"}},e.type="legend.plain",e.dependencies=["series"],e.defaultOption={z:4,show:!0,orient:"horizontal",left:"center",top:0,align:"auto",backgroundColor:"rgba(0,0,0,0)",borderColor:"#ccc",borderRadius:0,borderWidth:0,padding:5,itemGap:10,itemWidth:25,itemHeight:14,symbolRotate:"inherit",symbolKeepAspect:!0,inactiveColor:"#ccc",inactiveBorderColor:"#ccc",inactiveBorderWidth:"auto",itemStyle:{color:"inherit",opacity:"inherit",borderColor:"inherit",borderWidth:"auto",borderCap:"inherit",borderJoin:"inherit",borderDashOffset:"inherit",borderMiterLimit:"inherit"},lineStyle:{width:"auto",color:"inherit",inactiveColor:"#ccc",inactiveWidth:2,opacity:"inherit",type:"inherit",cap:"inherit",join:"inherit",dashOffset:"inherit",miterLimit:"inherit"},textStyle:{color:"#333"},selectedMode:!0,selector:!1,selectorLabel:{show:!0,borderRadius:10,padding:[3,5,3,5],fontSize:12,fontFamily:"sans-serif",color:"#666",borderWidth:1,borderColor:"#666"},emphasis:{selectorLabel:{show:!0,color:"#eee",backgroundColor:"#666"}},selectorPosition:"auto",selectorItemGap:7,selectorButtonGap:10,tooltip:{show:!1}},e}(is),k1=ms,EN=it,iI=pa,Eae=function(n){Hn(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.type=e.type,t.newlineDisabled=!1,t}return e.prototype.init=function(){this.group.add(this._contentGroup=new iI),this.group.add(this._selectorGroup=new iI),this._isFirstRender=!0},e.prototype.getContentGroup=function(){return this._contentGroup},e.prototype.getSelectorGroup=function(){return this._selectorGroup},e.prototype.render=function(t,r,i){var s=this._isFirstRender;if(this._isFirstRender=!1,this.resetInner(),!!t.get("show",!0)){var a=t.get("align"),l=t.get("orient");(!a||a==="auto")&&(a=t.get("left")==="right"&&l==="vertical"?"right":"left");var o=t.get("selector",!0),h=t.get("selectorPosition",!0);o&&(!h||h==="auto")&&(h=l==="horizontal"?"end":"start"),this.renderInner(a,t,r,i,o,l,h);var d=t.getBoxLayoutParams(),m={width:i.getWidth(),height:i.getHeight()},_=t.get("padding"),y=mv(d,m,_),T=this.layoutInner(t,a,y,s,o,h),I=mv(ti({width:T.width,height:T.height},d),m,_);this.group.x=I.x-T.x,this.group.y=I.y-T.y,this.group.markRedraw(),this.group.add(this._backgroundEl=xae(T,t))}},e.prototype.resetInner=function(){this.getContentGroup().removeAll(),this._backgroundEl&&this.group.remove(this._backgroundEl),this.getSelectorGroup().removeAll()},e.prototype.renderInner=function(t,r,i,s,a,l,o){var h=this.getContentGroup(),d=ri(),m=r.get("selectedMode"),_=[];i.eachRawSeries(function(y){!y.get("legendHoverLink")&&_.push(y.id)}),EN(r.getData(),function(y,T){var I=y.get("name");if(!this.newlineDisabled&&(I===""||I===`
`)){var C=new iI;C.newline=!0,h.add(C);return}var M=i.getSeriesByName(I)[0];if(!d.get(I))if(M){var B=M.getData(),k=B.getVisual("legendLineStyle")||{},j=B.getVisual("legendIcon"),q=B.getVisual("style"),Z=this._createItem(M,I,T,y,r,t,k,q,j,m,s);Z.on("click",k1(iY,I,null,s,_)).on("mouseover",k1(IN,M.name,null,s,_)).on("mouseout",k1(RN,M.name,null,s,_)),i.ssr&&Z.eachChild(function(te){var ie=ji(te);ie.seriesIndex=M.seriesIndex,ie.dataIndex=T,ie.ssrType="legend"}),d.set(I,!0)}else i.eachRawSeries(function(te){if(!d.get(I)&&te.legendVisualProvider){var ie=te.legendVisualProvider;if(!ie.containName(I))return;var se=ie.indexOfName(I),ae=ie.getItemVisual(se,"style"),fe=ie.getItemVisual(se,"legendIcon"),Se=Bm(ae.fill);Se&&Se[3]===0&&(Se[3]=.2,ae=Jn(Jn({},ae),{fill:uD(Se,"rgba")}));var Ee=this._createItem(te,I,T,y,r,t,{},ae,fe,m,s);Ee.on("click",k1(iY,null,I,s,_)).on("mouseover",k1(IN,null,I,s,_)).on("mouseout",k1(RN,null,I,s,_)),i.ssr&&Ee.eachChild(function(Re){var qe=ji(Re);qe.seriesIndex=te.seriesIndex,qe.dataIndex=T,qe.ssrType="legend"}),d.set(I,!0)}},this)},this),a&&this._createSelector(a,r,s,l,o)},e.prototype._createSelector=function(t,r,i,s,a){var l=this.getSelectorGroup();EN(t,function(h){var d=h.type,m=new Ca({style:{x:0,y:0,align:"center",verticalAlign:"middle"},onclick:function(){i.dispatchAction({type:d==="all"?"legendAllSelect":"legendInverseSelect"})}});l.add(m);var _=r.getModel("selectorLabel"),y=r.getModel(["emphasis","selectorLabel"]);QT(m,{normal:_,emphasis:y},{defaultText:h.title}),VF(m)})},e.prototype._createItem=function(t,r,i,s,a,l,o,h,d,m,_){var y=t.visualDrawType,T=a.get("itemWidth"),I=a.get("itemHeight"),C=a.isSelected(r),M=s.get("symbolRotate"),B=s.get("symbolKeepAspect"),k=s.get("icon");d=k||d||"roundRect";var j=Y5e(d,s,o,h,y,C,_),q=new iI,Z=s.getModel("textStyle");if(li(t.getLegendIcon)&&(!k||k==="inherit"))q.add(t.getLegendIcon({itemWidth:T,itemHeight:I,icon:d,iconRotate:M,itemStyle:j.itemStyle,lineStyle:j.lineStyle,symbolKeepAspect:B}));else{var te=k==="inherit"&&t.getData().getVisual("symbol")?M==="inherit"?t.getData().getVisual("symbolRotate"):M:0;q.add(K5e({itemWidth:T,itemHeight:I,icon:d,iconRotate:te,itemStyle:j.itemStyle,lineStyle:j.lineStyle,symbolKeepAspect:B}))}var ie=l==="left"?T+5:-5,se=l,ae=a.get("formatter"),fe=r;Dr(ae)&&ae?fe=ae.replace("{name}",r??""):li(ae)&&(fe=ae(r));var Se=C?Z.getTextColor():s.get("inactiveColor");q.add(new Ca({style:Ym(Z,{text:fe,x:ie,y:I/2,fill:Se,align:se,verticalAlign:"middle"},{inheritColor:Se})}));var Ee=new Go({shape:q.getBoundingRect(),style:{fill:"transparent"}}),Re=s.getModel("tooltip");return Re.get("show")&&AD({el:Ee,componentModel:a,itemName:r,itemTooltipOption:Re.option}),q.add(Ee),q.eachChild(function(qe){qe.silent=!0}),Ee.silent=!m,this.getContentGroup().add(q),VF(q),q.__legendDataIndex=i,q},e.prototype.layoutInner=function(t,r,i,s,a,l){var o=this.getContentGroup(),h=this.getSelectorGroup();Bb(t.get("orient"),o,t.get("itemGap"),i.width,i.height);var d=o.getBoundingRect(),m=[-d.x,-d.y];if(h.markRedraw(),o.markRedraw(),a){Bb("horizontal",h,t.get("selectorItemGap",!0));var _=h.getBoundingRect(),y=[-_.x,-_.y],T=t.get("selectorButtonGap",!0),I=t.getOrient().index,C=I===0?"width":"height",M=I===0?"height":"width",B=I===0?"y":"x";l==="end"?y[I]+=d[C]+T:m[I]+=_[C]+T,y[1-I]+=d[M]/2-_[M]/2,h.x=y[0],h.y=y[1],o.x=m[0],o.y=m[1];var k={x:0,y:0};return k[C]=d[C]+T+_[C],k[M]=Math.max(d[M],_[M]),k[B]=Math.min(0,_[B]+y[1-I]),k}else return o.x=m[0],o.y=m[1],this.group.getBoundingRect()},e.prototype.remove=function(){this.getContentGroup().removeAll(),this._isFirstRender=!0},e.type="legend.plain",e}(Rc);function Y5e(n,e,t,r,i,s,a){function l(C,M){C.lineWidth==="auto"&&(C.lineWidth=M.lineWidth>0?2:0),EN(C,function(B,k){C[k]==="inherit"&&(C[k]=M[k])})}var o=e.getModel("itemStyle"),h=o.getItemStyle(),d=n.lastIndexOf("empty",0)===0?"fill":"stroke",m=o.getShallow("decal");h.decal=!m||m==="inherit"?r.decal:sN(m,a),h.fill==="inherit"&&(h.fill=r[i]),h.stroke==="inherit"&&(h.stroke=r[d]),h.opacity==="inherit"&&(h.opacity=(i==="fill"?r:t).opacity),l(h,r);var _=e.getModel("lineStyle"),y=_.getLineStyle();if(l(y,t),h.fill==="auto"&&(h.fill=r.fill),h.stroke==="auto"&&(h.stroke=r.fill),y.stroke==="auto"&&(y.stroke=r.fill),!s){var T=e.get("inactiveBorderWidth"),I=h[d];h.lineWidth=T==="auto"?r.lineWidth>0&&I?2:0:h.lineWidth,h.fill=e.get("inactiveColor"),h.stroke=e.get("inactiveBorderColor"),y.stroke=_.get("inactiveColor"),y.lineWidth=_.get("inactiveWidth")}return{itemStyle:h,lineStyle:y}}function K5e(n){var e=n.icon||"roundRect",t=tw(e,0,0,n.itemWidth,n.itemHeight,n.itemStyle.fill,n.symbolKeepAspect);return t.setStyle(n.itemStyle),t.rotation=(n.iconRotate||0)*Math.PI/180,t.setOrigin([n.itemWidth/2,n.itemHeight/2]),e.indexOf("empty")>-1&&(t.style.stroke=t.style.fill,t.style.fill="#fff",t.style.lineWidth=2),t}function iY(n,e,t,r){RN(n,e,t,r),t.dispatchAction({type:"legendToggleSelect",name:n??e}),IN(n,e,t,r)}function Iae(n){for(var e=n.getZr().storage.getDisplayList(),t,r=0,i=e.length;r<i&&!(t=e[r].states.emphasis);)r++;return t&&t.hoverLayer}function IN(n,e,t,r){Iae(t)||t.dispatchAction({type:"highlight",seriesName:n,name:e,excludeSeriesId:r})}function RN(n,e,t,r){Iae(t)||t.dispatchAction({type:"downplay",seriesName:n,name:e,excludeSeriesId:r})}function J5e(n){var e=n.findComponents({mainType:"legend"});e&&e.length&&n.filterSeries(function(t){for(var r=0;r<e.length;r++)if(!e[r].isSelected(t.name))return!1;return!0})}function tS(n,e,t){var r={},i=n==="toggleSelected",s;return t.eachComponent("legend",function(a){i&&s!=null?a[s?"select":"unSelect"](e.name):n==="allSelect"||n==="inverseSelect"?a[n]():(a[n](e.name),s=a.isSelected(e.name));var l=a.getData();it(l,function(o){var h=o.get("name");if(!(h===`
`||h==="")){var d=a.isSelected(h);r.hasOwnProperty(h)?r[h]=r[h]&&d:r[h]=d}})}),n==="allSelect"||n==="inverseSelect"?{selected:r}:{name:e.name,selected:r}}function Q5e(n){n.registerAction("legendToggleSelect","legendselectchanged",ms(tS,"toggleSelected")),n.registerAction("legendAllSelect","legendselectall",ms(tS,"allSelect")),n.registerAction("legendInverseSelect","legendinverseselect",ms(tS,"inverseSelect")),n.registerAction("legendSelect","legendselected",ms(tS,"select")),n.registerAction("legendUnSelect","legendunselected",ms(tS,"unSelect"))}function Rae(n){n.registerComponentModel(CN),n.registerComponentView(Eae),n.registerProcessor(n.PRIORITY.PROCESSOR.SERIES_FILTER,J5e),n.registerSubTypeDefaulter("legend",function(){return"plain"}),Q5e(n)}var eBe=function(n){Hn(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.setScrollDataIndex=function(t){this.option.scrollDataIndex=t},e.prototype.init=function(t,r,i){var s=DD(t);n.prototype.init.call(this,t,r,i),sY(this,t,s)},e.prototype.mergeOption=function(t,r){n.prototype.mergeOption.call(this,t,r),sY(this,this.option,t)},e.type="legend.scroll",e.defaultOption=Mie(CN.defaultOption,{scrollDataIndex:0,pageButtonItemGap:5,pageButtonGap:null,pageButtonPosition:"end",pageFormatter:"{current}/{total}",pageIcons:{horizontal:["M0,0L12,-10L12,10z","M0,0L-12,-10L-12,10z"],vertical:["M0,0L20,0L10,-20z","M0,0L20,0L10,20z"]},pageIconColor:"#2f4554",pageIconInactiveColor:"#aaa",pageIconSize:15,pageTextStyle:{color:"#333"},animationDurationUpdate:800}),e}(CN);function sY(n,e,t){var r=n.getOrient(),i=[1,1];i[r.index]=0,Qb(e,t,{type:"box",ignoreSize:!!i})}var oY=pa,pk=["width","height"],mk=["x","y"],tBe=function(n){Hn(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.type=e.type,t.newlineDisabled=!0,t._currentIndex=0,t}return e.prototype.init=function(){n.prototype.init.call(this),this.group.add(this._containerGroup=new oY),this._containerGroup.add(this.getContentGroup()),this.group.add(this._controllerGroup=new oY)},e.prototype.resetInner=function(){n.prototype.resetInner.call(this),this._controllerGroup.removeAll(),this._containerGroup.removeClipPath(),this._containerGroup.__rectSize=null},e.prototype.renderInner=function(t,r,i,s,a,l,o){var h=this;n.prototype.renderInner.call(this,t,r,i,s,a,l,o);var d=this._controllerGroup,m=r.get("pageIconSize",!0),_=fr(m)?m:[m,m];T("pagePrev",0);var y=r.getModel("pageTextStyle");d.add(new Ca({name:"pageText",style:{text:"xx/xx",fill:y.getTextColor(),font:y.getFont(),verticalAlign:"middle",align:"center"},silent:!0})),T("pageNext",1);function T(I,C){var M=I+"DataIndex",B=SD(r.get("pageIcons",!0)[r.getOrient().name][C],{onclick:Ns(h._pageGo,h,M,r,s)},{x:-_[0]/2,y:-_[1]/2,width:_[0],height:_[1]});B.name=I,d.add(B)}},e.prototype.layoutInner=function(t,r,i,s,a,l){var o=this.getSelectorGroup(),h=t.getOrient().index,d=pk[h],m=mk[h],_=pk[1-h],y=mk[1-h];a&&Bb("horizontal",o,t.get("selectorItemGap",!0));var T=t.get("selectorButtonGap",!0),I=o.getBoundingRect(),C=[-I.x,-I.y],M=vi(i);a&&(M[d]=i[d]-I[d]-T);var B=this._layoutContentAndController(t,s,M,h,d,_,y,m);if(a){if(l==="end")C[h]+=B[d]+T;else{var k=I[d]+T;C[h]-=k,B[m]-=k}B[d]+=I[d]+T,C[1-h]+=B[y]+B[_]/2-I[_]/2,B[_]=Math.max(B[_],I[_]),B[y]=Math.min(B[y],I[y]+C[1-h]),o.x=C[0],o.y=C[1],o.markRedraw()}return B},e.prototype._layoutContentAndController=function(t,r,i,s,a,l,o,h){var d=this.getContentGroup(),m=this._containerGroup,_=this._controllerGroup;Bb(t.get("orient"),d,t.get("itemGap"),s?i.width:null,s?null:i.height),Bb("horizontal",_,t.get("pageButtonItemGap",!0));var y=d.getBoundingRect(),T=_.getBoundingRect(),I=this._showController=y[a]>i[a],C=[-y.x,-y.y];r||(C[s]=d[h]);var M=[0,0],B=[-T.x,-T.y],k=Ci(t.get("pageButtonGap",!0),t.get("itemGap",!0));if(I){var j=t.get("pageButtonPosition",!0);j==="end"?B[s]+=i[a]-T[a]:M[s]+=T[a]+k}B[1-s]+=y[l]/2-T[l]/2,d.setPosition(C),m.setPosition(M),_.setPosition(B);var q={x:0,y:0};if(q[a]=I?i[a]:y[a],q[l]=Math.max(y[l],T[l]),q[o]=Math.min(0,T[o]+B[1-s]),m.__rectSize=i[a],I){var Z={x:0,y:0};Z[a]=Math.max(i[a]-T[a]-k,0),Z[l]=q[l],m.setClipPath(new Go({shape:Z})),m.__rectSize=Z[a]}else _.eachChild(function(ie){ie.attr({invisible:!0,silent:!0})});var te=this._getPageInfo(t);return te.pageIndex!=null&&sl(d,{x:te.contentPosition[0],y:te.contentPosition[1]},I?t:null),this._updatePageInfoView(t,te),q},e.prototype._pageGo=function(t,r,i){var s=this._getPageInfo(r)[t];s!=null&&i.dispatchAction({type:"legendScroll",scrollDataIndex:s,legendId:r.id})},e.prototype._updatePageInfoView=function(t,r){var i=this._controllerGroup;it(["pagePrev","pageNext"],function(d){var m=d+"DataIndex",_=r[m]!=null,y=i.childOfName(d);y&&(y.setStyle("fill",_?t.get("pageIconColor",!0):t.get("pageIconInactiveColor",!0)),y.cursor=_?"pointer":"default")});var s=i.childOfName("pageText"),a=t.get("pageFormatter"),l=r.pageIndex,o=l!=null?l+1:0,h=r.pageCount;s&&a&&s.setStyle("text",Dr(a)?a.replace("{current}",o==null?"":o+"").replace("{total}",h==null?"":h+""):a({current:o,total:h}))},e.prototype._getPageInfo=function(t){var r=t.get("scrollDataIndex",!0),i=this.getContentGroup(),s=this._containerGroup.__rectSize,a=t.getOrient().index,l=pk[a],o=mk[a],h=this._findTargetItemIndex(r),d=i.children(),m=d[h],_=d.length,y=_?1:0,T={contentPosition:[i.x,i.y],pageCount:y,pageIndex:y-1,pagePrevDataIndex:null,pageNextDataIndex:null};if(!m)return T;var I=j(m);T.contentPosition[a]=-I.s;for(var C=h+1,M=I,B=I,k=null;C<=_;++C)k=j(d[C]),(!k&&B.e>M.s+s||k&&!q(k,M.s))&&(B.i>M.i?M=B:M=k,M&&(T.pageNextDataIndex==null&&(T.pageNextDataIndex=M.i),++T.pageCount)),B=k;for(var C=h-1,M=I,B=I,k=null;C>=-1;--C)k=j(d[C]),(!k||!q(B,k.s))&&M.i<B.i&&(B=M,T.pagePrevDataIndex==null&&(T.pagePrevDataIndex=M.i),++T.pageCount,++T.pageIndex),M=k;return T;function j(Z){if(Z){var te=Z.getBoundingRect(),ie=te[o]+Z[o];return{s:ie,e:ie+te[l],i:Z.__legendDataIndex}}}function q(Z,te){return Z.e>=te&&Z.s<=te+s}},e.prototype._findTargetItemIndex=function(t){if(!this._showController)return 0;var r,i=this.getContentGroup(),s;return i.eachChild(function(a,l){var o=a.__legendDataIndex;s==null&&o!=null&&(s=l),o===t&&(r=l)}),r??s},e.type="legend.scroll",e}(Eae);function nBe(n){n.registerAction("legendScroll","legendscroll",function(e,t){var r=e.scrollDataIndex;r!=null&&t.eachComponent({mainType:"legend",subType:"scroll",query:e},function(i){i.setScrollDataIndex(r)})})}function rBe(n){fp(Rae),n.registerComponentModel(eBe),n.registerComponentView(tBe),nBe(n)}function iBe(n){fp(Rae),fp(rBe)}var aY={value:"eq","<":"lt","<=":"lte",">":"gt",">=":"gte","=":"eq","!=":"ne","<>":"ne"},sBe=function(){function n(e){var t=this._condVal=Dr(e)?new RegExp(e):hAe(e)?e:null;if(t==null){var r="";ss(r)}}return n.prototype.evaluate=function(e){var t=typeof e;return Dr(t)?this._condVal.test(e):Is(t)?this._condVal.test(e+""):!1},n}(),oBe=function(){function n(){}return n.prototype.evaluate=function(){return this.value},n}(),aBe=function(){function n(){}return n.prototype.evaluate=function(){for(var e=this.children,t=0;t<e.length;t++)if(!e[t].evaluate())return!1;return!0},n}(),lBe=function(){function n(){}return n.prototype.evaluate=function(){for(var e=this.children,t=0;t<e.length;t++)if(e[t].evaluate())return!0;return!1},n}(),cBe=function(){function n(){}return n.prototype.evaluate=function(){return!this.child.evaluate()},n}(),uBe=function(){function n(){}return n.prototype.evaluate=function(){for(var e=!!this.valueParser,t=this.getValue,r=t(this.valueGetterParam),i=e?this.valueParser(r):null,s=0;s<this.subCondList.length;s++)if(!this.subCondList[s].evaluate(e?i:r))return!1;return!0},n}();function u8(n,e){if(n===!0||n===!1){var t=new oBe;return t.value=n,t}var r="";return Pae(n)||ss(r),n.and?lY("and",n,e):n.or?lY("or",n,e):n.not?hBe(n,e):fBe(n,e)}function lY(n,e,t){var r=e[n],i="";fr(r)||ss(i),r.length||ss(i);var s=n==="and"?new aBe:new lBe;return s.children=xr(r,function(a){return u8(a,t)}),s.children.length||ss(i),s}function hBe(n,e){var t=n.not,r="";Pae(t)||ss(r);var i=new cBe;return i.child=u8(t,e),i.child||ss(r),i}function fBe(n,e){for(var t="",r=e.prepareGetValue(n),i=[],s=io(n),a=n.parser,l=a?nse(a):null,o=0;o<s.length;o++){var h=s[o];if(!(h==="parser"||e.valueGetterAttrMap.get(h))){var d=$m(aY,h)?aY[h]:h,m=n[h],_=l?l(m):m,y=xIe(d,_)||d==="reg"&&new sBe(_);y||ss(t),i.push(y)}}i.length||ss(t);var T=new uBe;return T.valueGetterParam=r,T.valueParser=l,T.getValue=e.getValue,T.subCondList=i,T}function Pae(n){return Xr(n)&&!Ec(n)}var dBe=function(){function n(e,t){this._cond=u8(e,t)}return n.prototype.evaluate=function(){return this._cond.evaluate()},n}();function pBe(n,e){return new dBe(n,e)}var mBe={type:"echarts:filter",transform:function(n){for(var e=n.upstream,t,r=pBe(n.config,{valueGetterAttrMap:ri({dimension:!0}),prepareGetValue:function(l){var o="",h=l.dimension;$m(l,"dimension")||ss(o);var d=e.getDimensionInfo(h);return d||ss(o),{dimIdx:d.index}},getValue:function(l){return e.retrieveValueFromItem(t,l.dimIdx)}}),i=[],s=0,a=e.count();s<a;s++)t=e.getRawDataItem(s),r.evaluate()&&i.push(t);return{data:i}}},gBe={type:"echarts:sort",transform:function(n){var e=n.upstream,t=n.config,r="",i=da(t);i.length||ss(r);var s=[];it(i,function(d){var m=d.dimension,_=d.order,y=d.parser,T=d.incomparable;if(m==null&&ss(r),_!=="asc"&&_!=="desc"&&ss(r),T&&T!=="min"&&T!=="max"){var I="";ss(I)}if(_!=="asc"&&_!=="desc"){var C="";ss(C)}var M=e.getDimensionInfo(m);M||ss(r);var B=y?nse(y):null;y&&!B&&ss(r),s.push({dimIdx:M.index,parser:B,comparator:new ise(_,T)})});var a=e.sourceFormat;a!==Ic&&a!==kh&&ss(r);for(var l=[],o=0,h=e.count();o<h;o++)l.push(e.getRawDataItem(o));return l.sort(function(d,m){for(var _=0;_<s.length;_++){var y=s[_],T=e.retrieveValueFromItem(d,y.dimIdx),I=e.retrieveValueFromItem(m,y.dimIdx);y.parser&&(T=y.parser(T),I=y.parser(I));var C=y.comparator.evaluate(T,I);if(C!==0)return C}return 0}),{data:l}}};function vBe(n){n.registerTransform(mBe),n.registerTransform(gBe)}var _Be=function(n){Hn(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.type="dataset",t}return e.prototype.init=function(t,r,i){n.prototype.init.call(this,t,r,i),this._sourceManager=new lse(this),Z$(this)},e.prototype.mergeOption=function(t,r){n.prototype.mergeOption.call(this,t,r),Z$(this)},e.prototype.optionUpdated=function(){this._sourceManager.dirty()},e.prototype.getSourceManager=function(){return this._sourceManager},e.type="dataset",e.defaultOption={seriesLayoutBy:ap},e}(is),yBe=function(n){Hn(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.type="dataset",t}return e.type="dataset",e}(Rc);function xBe(n){n.registerComponentModel(_Be),n.registerComponentView(yBe)}var jd=Zm.CMD;function _b(n,e){return Math.abs(n-e)<1e-5}function PN(n){var e=n.data,t=n.len(),r=[],i,s=0,a=0,l=0,o=0;function h(Ee,Re){i&&i.length>2&&r.push(i),i=[Ee,Re]}function d(Ee,Re,qe,Le){_b(Ee,qe)&&_b(Re,Le)||i.push(Ee,Re,qe,Le,qe,Le)}function m(Ee,Re,qe,Le,dt,ye){var Xe=Math.abs(Re-Ee),He=Math.tan(Xe/4)*4/3,_t=Re<Ee?-1:1,wt=Math.cos(Ee),Gt=Math.sin(Ee),at=Math.cos(Re),Ht=Math.sin(Re),Qt=wt*dt+qe,rn=Gt*ye+Le,jn=at*dt+qe,Bn=Ht*ye+Le,Tn=dt*He*_t,Pe=ye*He*_t;i.push(Qt-Tn*Gt,rn+Pe*wt,jn+Tn*Ht,Bn-Pe*at,jn,Bn)}for(var _,y,T,I,C=0;C<t;){var M=e[C++],B=C===1;switch(B&&(s=e[C],a=e[C+1],l=s,o=a,(M===jd.L||M===jd.C||M===jd.Q)&&(i=[l,o])),M){case jd.M:s=l=e[C++],a=o=e[C++],h(l,o);break;case jd.L:_=e[C++],y=e[C++],d(s,a,_,y),s=_,a=y;break;case jd.C:i.push(e[C++],e[C++],e[C++],e[C++],s=e[C++],a=e[C++]);break;case jd.Q:_=e[C++],y=e[C++],T=e[C++],I=e[C++],i.push(s+2/3*(_-s),a+2/3*(y-a),T+2/3*(_-T),I+2/3*(y-I),T,I),s=T,a=I;break;case jd.A:var k=e[C++],j=e[C++],q=e[C++],Z=e[C++],te=e[C++],ie=e[C++]+te;C+=1;var se=!e[C++];_=Math.cos(te)*q+k,y=Math.sin(te)*Z+j,B?(l=_,o=y,h(l,o)):d(s,a,_,y),s=Math.cos(ie)*q+k,a=Math.sin(ie)*Z+j;for(var ae=(se?-1:1)*Math.PI/2,fe=te;se?fe>ie:fe<ie;fe+=ae){var Se=se?Math.max(fe+ae,ie):Math.min(fe+ae,ie);m(fe,Se,k,j,q,Z)}break;case jd.R:l=s=e[C++],o=a=e[C++],_=l+e[C++],y=o+e[C++],h(_,o),d(_,o,_,y),d(_,y,l,y),d(l,y,l,o),d(l,o,_,o);break;case jd.Z:i&&d(s,a,l,o),s=l,a=o;break}}return i&&i.length>2&&r.push(i),r}function LN(n,e,t,r,i,s,a,l,o,h){if(_b(n,t)&&_b(e,r)&&_b(i,a)&&_b(s,l)){o.push(a,l);return}var d=2/h,m=d*d,_=a-n,y=l-e,T=Math.sqrt(_*_+y*y);_/=T,y/=T;var I=t-n,C=r-e,M=i-a,B=s-l,k=I*I+C*C,j=M*M+B*B;if(k<m&&j<m){o.push(a,l);return}var q=_*I+y*C,Z=-_*M-y*B,te=k-q*q,ie=j-Z*Z;if(te<m&&q>=0&&ie<m&&Z>=0){o.push(a,l);return}var se=[],ae=[];fv(n,t,i,a,.5,se),fv(e,r,s,l,.5,ae),LN(se[0],ae[0],se[1],ae[1],se[2],ae[2],se[3],ae[3],o,h),LN(se[4],ae[4],se[5],ae[5],se[6],ae[6],se[7],ae[7],o,h)}function bBe(n,e){var t=PN(n),r=[];e=e||1;for(var i=0;i<t.length;i++){var s=t[i],a=[],l=s[0],o=s[1];a.push(l,o);for(var h=2;h<s.length;){var d=s[h++],m=s[h++],_=s[h++],y=s[h++],T=s[h++],I=s[h++];LN(l,o,d,m,_,y,T,I,a,e),l=T,o=I}r.push(a)}return r}function Lae(n,e,t){var r=n[e],i=n[1-e],s=Math.abs(r/i),a=Math.ceil(Math.sqrt(s*t)),l=Math.floor(t/a);l===0&&(l=1,a=t);for(var o=[],h=0;h<a;h++)o.push(l);var d=a*l,m=t-d;if(m>0)for(var h=0;h<m;h++)o[h%a]+=1;return o}function cY(n,e,t){for(var r=n.r0,i=n.r,s=n.startAngle,a=n.endAngle,l=Math.abs(a-s),o=l*i,h=i-r,d=o>Math.abs(h),m=Lae([o,h],d?0:1,e),_=(d?l:h)/m.length,y=0;y<m.length;y++)for(var T=(d?h:l)/m[y],I=0;I<m[y];I++){var C={};d?(C.startAngle=s+_*y,C.endAngle=s+_*(y+1),C.r0=r+T*I,C.r=r+T*(I+1)):(C.startAngle=s+T*I,C.endAngle=s+T*(I+1),C.r0=r+_*y,C.r=r+_*(y+1)),C.clockwise=n.clockwise,C.cx=n.cx,C.cy=n.cy,t.push(C)}}function wBe(n,e,t){for(var r=n.width,i=n.height,s=r>i,a=Lae([r,i],s?0:1,e),l=s?"width":"height",o=s?"height":"width",h=s?"x":"y",d=s?"y":"x",m=n[l]/a.length,_=0;_<a.length;_++)for(var y=n[o]/a[_],T=0;T<a[_];T++){var I={};I[h]=_*m,I[d]=T*y,I[l]=m,I[o]=y,I.x+=n.x,I.y+=n.y,t.push(I)}}function uY(n,e,t,r){return n*r-t*e}function SBe(n,e,t,r,i,s,a,l){var o=t-n,h=r-e,d=a-i,m=l-s,_=uY(d,m,o,h);if(Math.abs(_)<1e-6)return null;var y=n-i,T=e-s,I=uY(y,T,d,m)/_;return I<0||I>1?null:new Jr(I*o+n,I*h+e)}function ABe(n,e,t){var r=new Jr;Jr.sub(r,t,e),r.normalize();var i=new Jr;Jr.sub(i,n,e);var s=i.dot(r);return s}function O1(n,e){var t=n[n.length-1];t&&t[0]===e[0]&&t[1]===e[1]||n.push(e)}function TBe(n,e,t){for(var r=n.length,i=[],s=0;s<r;s++){var a=n[s],l=n[(s+1)%r],o=SBe(a[0],a[1],l[0],l[1],e.x,e.y,t.x,t.y);o&&i.push({projPt:ABe(o,e,t),pt:o,idx:s})}if(i.length<2)return[{points:n},{points:n}];i.sort(function(C,M){return C.projPt-M.projPt});var h=i[0],d=i[i.length-1];if(d.idx<h.idx){var m=h;h=d,d=m}for(var _=[h.pt.x,h.pt.y],y=[d.pt.x,d.pt.y],T=[_],I=[y],s=h.idx+1;s<=d.idx;s++)O1(T,n[s].slice());O1(T,y),O1(T,_);for(var s=d.idx+1;s<=h.idx+r;s++)O1(I,n[s%r].slice());return O1(I,_),O1(I,y),[{points:T},{points:I}]}function hY(n){var e=n.points,t=[],r=[];Fre(e,t,r);var i=new as(t[0],t[1],r[0]-t[0],r[1]-t[1]),s=i.width,a=i.height,l=i.x,o=i.y,h=new Jr,d=new Jr;return s>a?(h.x=d.x=l+s/2,h.y=o,d.y=o+a):(h.y=d.y=o+a/2,h.x=l,d.x=l+s),TBe(e,h,d)}function NP(n,e,t,r){if(t===1)r.push(e);else{var i=Math.floor(t/2),s=n(e);NP(n,s[0],i,r),NP(n,s[1],t-i,r)}return r}function MBe(n,e){for(var t=[],r=0;r<e;r++)t.push(hU(n));return t}function CBe(n,e){e.setStyle(n.style),e.z=n.z,e.z2=n.z2,e.zlevel=n.zlevel}function EBe(n){for(var e=[],t=0;t<n.length;)e.push([n[t++],n[t++]]);return e}function IBe(n,e){var t=[],r=n.shape,i;switch(n.type){case"rect":wBe(r,e,t),i=Go;break;case"sector":cY(r,e,t),i=Dh;break;case"circle":cY({r0:0,r:r.r,startAngle:0,endAngle:Math.PI*2,cx:r.cx,cy:r.cy},e,t),i=Dh;break;default:var s=n.getComputedTransform(),a=s?Math.sqrt(Math.max(s[0]*s[0]+s[1]*s[1],s[2]*s[2]+s[3]*s[3])):1,l=xr(bBe(n.getUpdatedPathProxy(),a),function(M){return EBe(M)}),o=l.length;if(o===0)NP(hY,{points:l[0]},e,t);else if(o===e)for(var h=0;h<o;h++)t.push({points:l[h]});else{var d=0,m=xr(l,function(M){var B=[],k=[];Fre(M,B,k);var j=(k[1]-B[1])*(k[0]-B[0]);return d+=j,{poly:M,area:j}});m.sort(function(M,B){return B.area-M.area});for(var _=e,h=0;h<o;h++){var y=m[h];if(_<=0)break;var T=h===o-1?_:Math.ceil(y.area/d*e);T<0||(NP(hY,{points:y.poly},T,t),_-=T)}}i=yD;break}if(!i)return MBe(n,e);for(var I=[],h=0;h<t.length;h++){var C=new i;C.setShape(t[h]),CBe(n,C),I.push(C)}return I}function RBe(n,e){var t=n.length,r=e.length;if(t===r)return[n,e];for(var i=[],s=[],a=t<r?n:e,l=Math.min(t,r),o=Math.abs(r-t)/6,h=(l-2)/6,d=Math.ceil(o/h)+1,m=[a[0],a[1]],_=o,y=2;y<l;){var T=a[y-2],I=a[y-1],C=a[y++],M=a[y++],B=a[y++],k=a[y++],j=a[y++],q=a[y++];if(_<=0){m.push(C,M,B,k,j,q);continue}for(var Z=Math.min(_,d-1)+1,te=1;te<=Z;te++){var ie=te/Z;fv(T,C,B,j,ie,i),fv(I,M,k,q,ie,s),T=i[3],I=s[3],m.push(i[1],s[1],i[2],s[2],T,I),C=i[5],M=s[5],B=i[6],k=s[6]}_-=Z-1}return a===n?[m,e]:[n,m]}function fY(n,e){for(var t=n.length,r=n[t-2],i=n[t-1],s=[],a=0;a<e.length;)s[a++]=r,s[a++]=i;return s}function PBe(n,e){for(var t,r,i,s=[],a=[],l=0;l<Math.max(n.length,e.length);l++){var o=n[l],h=e[l],d=void 0,m=void 0;o?h?(t=RBe(o,h),d=t[0],m=t[1],r=d,i=m):(m=fY(i||o,o),d=o):(d=fY(r||h,h),m=h),s.push(d),a.push(m)}return[s,a]}function dY(n){for(var e=0,t=0,r=0,i=n.length,s=0,a=i-2;s<i;a=s,s+=2){var l=n[a],o=n[a+1],h=n[s],d=n[s+1],m=l*d-h*o;e+=m,t+=(l+h)*m,r+=(o+d)*m}return e===0?[n[0]||0,n[1]||0]:[t/e/3,r/e/3,e]}function LBe(n,e,t,r){for(var i=(n.length-2)/6,s=1/0,a=0,l=n.length,o=l-2,h=0;h<i;h++){for(var d=h*6,m=0,_=0;_<l;_+=2){var y=_===0?d:(d+_-2)%o+2,T=n[y]-t[0],I=n[y+1]-t[1],C=e[_]-r[0],M=e[_+1]-r[1],B=C-T,k=M-I;m+=B*B+k*k}m<s&&(s=m,a=h)}return a}function DBe(n){for(var e=[],t=n.length,r=0;r<t;r+=2)e[r]=n[t-r-2],e[r+1]=n[t-r-1];return e}function BBe(n,e,t,r){for(var i=[],s,a=0;a<n.length;a++){var l=n[a],o=e[a],h=dY(l),d=dY(o);s==null&&(s=h[2]<0!=d[2]<0);var m=[],_=[],y=0,T=1/0,I=[],C=l.length;s&&(l=DBe(l));for(var M=LBe(l,o,h,d)*6,B=C-2,k=0;k<B;k+=2){var j=(M+k)%B+2;m[k+2]=l[j]-h[0],m[k+3]=l[j+1]-h[1]}m[0]=l[M]-h[0],m[1]=l[M+1]-h[1];for(var q=r/t,Z=-r/2;Z<=r/2;Z+=q){for(var te=Math.sin(Z),ie=Math.cos(Z),se=0,k=0;k<l.length;k+=2){var ae=m[k],fe=m[k+1],Se=o[k]-d[0],Ee=o[k+1]-d[1],Re=Se*ie-Ee*te,qe=Se*te+Ee*ie;I[k]=Re,I[k+1]=qe;var Le=Re-ae,dt=qe-fe;se+=Le*Le+dt*dt}if(se<T){T=se,y=Z;for(var ye=0;ye<I.length;ye++)_[ye]=I[ye]}}i.push({from:m,to:_,fromCp:h,toCp:d,rotation:-y})}return i}function zP(n){return n.__isCombineMorphing}var Dae="__mOriginal_";function UP(n,e,t){var r=Dae+e,i=n[r]||n[e];n[r]||(n[r]=n[e]);var s=t.replace,a=t.after,l=t.before;n[e]=function(){var o=arguments,h;return l&&l.apply(this,o),s?h=s.apply(this,o):h=i.apply(this,o),a&&a.apply(this,o),h}}function oA(n,e){var t=Dae+e;n[t]&&(n[e]=n[t],n[t]=null)}function pY(n,e){for(var t=0;t<n.length;t++)for(var r=n[t],i=0;i<r.length;){var s=r[i],a=r[i+1];r[i++]=e[0]*s+e[2]*a+e[4],r[i++]=e[1]*s+e[3]*a+e[5]}}function Bae(n,e){var t=n.getUpdatedPathProxy(),r=e.getUpdatedPathProxy(),i=PBe(PN(t),PN(r)),s=i[0],a=i[1],l=n.getComputedTransform(),o=e.getComputedTransform();function h(){this.transform=null}l&&pY(s,l),o&&pY(a,o),UP(e,"updateTransform",{replace:h}),e.transform=null;var d=BBe(s,a,10,Math.PI),m=[];UP(e,"buildPath",{replace:function(_){for(var y=e.__morphT,T=1-y,I=[],C=0;C<d.length;C++){var M=d[C],B=M.from,k=M.to,j=M.rotation*y,q=M.fromCp,Z=M.toCp,te=Math.sin(j),ie=Math.cos(j);DI(I,q,Z,y);for(var se=0;se<B.length;se+=2){var ae=B[se],fe=B[se+1],Se=k[se],Ee=k[se+1],Re=ae*T+Se*y,qe=fe*T+Ee*y;m[se]=Re*ie-qe*te+I[0],m[se+1]=Re*te+qe*ie+I[1]}var Le=m[0],dt=m[1];_.moveTo(Le,dt);for(var se=2;se<B.length;){var Se=m[se++],Ee=m[se++],ye=m[se++],Xe=m[se++],He=m[se++],_t=m[se++];Le===Se&&dt===Ee&&ye===He&&Xe===_t?_.lineTo(He,_t):_.bezierCurveTo(Se,Ee,ye,Xe,He,_t),Le=He,dt=_t}}}})}function h8(n,e,t){if(!n||!e)return e;var r=t.done,i=t.during;Bae(n,e),e.__morphT=0;function s(){oA(e,"buildPath"),oA(e,"updateTransform"),e.__morphT=-1,e.createPathProxy(),e.dirtyShape()}return e.animateTo({__morphT:1},ti({during:function(a){e.dirtyShape(),i&&i(a)},done:function(){s(),r&&r()}},t)),e}function kBe(n,e,t,r,i,s){var a=16;n=i===t?0:Math.round(32767*(n-t)/(i-t)),e=s===r?0:Math.round(32767*(e-r)/(s-r));for(var l=0,o,h=(1<<a)/2;h>0;h/=2){var d=0,m=0;(n&h)>0&&(d=1),(e&h)>0&&(m=1),l+=h*h*(3*d^m),m===0&&(d===1&&(n=h-1-n,e=h-1-e),o=n,n=e,e=o)}return l}function VP(n){var e=1/0,t=1/0,r=-1/0,i=-1/0,s=xr(n,function(l){var o=l.getBoundingRect(),h=l.getComputedTransform(),d=o.x+o.width/2+(h?h[4]:0),m=o.y+o.height/2+(h?h[5]:0);return e=Math.min(d,e),t=Math.min(m,t),r=Math.max(d,r),i=Math.max(m,i),[d,m]}),a=xr(s,function(l,o){return{cp:l,z:kBe(l[0],l[1],e,t,r,i),path:n[o]}});return a.sort(function(l,o){return l.z-o.z}).map(function(l){return l.path})}function kae(n){return IBe(n.path,n.count)}function DN(){return{fromIndividuals:[],toIndividuals:[],count:0}}function OBe(n,e,t){var r=[];function i(q){for(var Z=0;Z<q.length;Z++){var te=q[Z];zP(te)?i(te.childrenRef()):te instanceof Xi&&r.push(te)}}i(n);var s=r.length;if(!s)return DN();var a=t.dividePath||kae,l=a({path:e,count:s});if(l.length!==s)return console.error("Invalid morphing: unmatched splitted path"),DN();r=VP(r),l=VP(l);for(var o=t.done,h=t.during,d=t.individualDelay,m=new ZT,_=0;_<s;_++){var y=r[_],T=l[_];T.parent=e,T.copyTransform(m),d||Bae(y,T)}e.__isCombineMorphing=!0,e.childrenRef=function(){return l};function I(q){for(var Z=0;Z<l.length;Z++)l[Z].addSelfToZr(q)}UP(e,"addSelfToZr",{after:function(q){I(q)}}),UP(e,"removeSelfFromZr",{after:function(q){for(var Z=0;Z<l.length;Z++)l[Z].removeSelfFromZr(q)}});function C(){e.__isCombineMorphing=!1,e.__morphT=-1,e.childrenRef=null,oA(e,"addSelfToZr"),oA(e,"removeSelfFromZr")}var M=l.length;if(d)for(var B=M,k=function(){B--,B===0&&(C(),o&&o())},_=0;_<M;_++){var j=d?ti({delay:(t.delay||0)+d(_,M,r[_],l[_]),done:k},t):t;h8(r[_],l[_],j)}else e.__morphT=0,e.animateTo({__morphT:1},ti({during:function(q){for(var Z=0;Z<M;Z++){var te=l[Z];te.__morphT=e.__morphT,te.dirtyShape()}h&&h(q)},done:function(){C();for(var q=0;q<n.length;q++)oA(n[q],"updateTransform");o&&o()}},t));return e.__zr&&I(e.__zr),{fromIndividuals:r,toIndividuals:l,count:M}}function FBe(n,e,t){var r=e.length,i=[],s=t.dividePath||kae;function a(y){for(var T=0;T<y.length;T++){var I=y[T];zP(I)?a(I.childrenRef()):I instanceof Xi&&i.push(I)}}if(zP(n)){a(n.childrenRef());var l=i.length;if(l<r)for(var o=0,h=l;h<r;h++)i.push(hU(i[o++%l]));i.length=r}else{i=s({path:n,count:r});for(var d=n.getComputedTransform(),h=0;h<i.length;h++)i[h].setLocalTransform(d);if(i.length!==r)return console.error("Invalid morphing: unmatched splitted path"),DN()}i=VP(i),e=VP(e);for(var m=t.individualDelay,h=0;h<r;h++){var _=m?ti({delay:(t.delay||0)+m(h,r,i[h],e[h])},t):t;h8(i[h],e[h],_)}return{fromIndividuals:i,toIndividuals:e,count:e.length}}function mY(n){return fr(n[0])}function gY(n,e){for(var t=[],r=n.length,i=0;i<r;i++)t.push({one:n[i],many:[]});for(var i=0;i<e.length;i++){var s=e[i].length,a=void 0;for(a=0;a<s;a++)t[a%r].many.push(e[i][a])}for(var l=0,i=r-1;i>=0;i--)if(!t[i].many.length){var o=t[l].many;if(o.length<=1)if(l)l=0;else return t;var s=o.length,h=Math.ceil(s/2);t[i].many=o.slice(h,s),t[l].many=o.slice(0,h),l++}return t}var NBe={clone:function(n){for(var e=[],t=1-Math.pow(1-n.path.style.opacity,1/n.count),r=0;r<n.count;r++){var i=hU(n.path);i.setStyle("opacity",t),e.push(i)}return e},split:null};function gk(n,e,t,r,i,s){if(!n.length||!e.length)return;var a=bD("update",r,i);if(!(a&&a.duration>0))return;var l=r.getModel("universalTransition").get("delay"),o=Object.assign({setToFinal:!0},a),h,d;mY(n)&&(h=n,d=e),mY(e)&&(h=e,d=n);function m(M,B,k,j,q){var Z=M.many,te=M.one;if(Z.length===1&&!q){var ie=B?Z[0]:te,se=B?te:Z[0];if(zP(ie))m({many:[ie],one:se},!0,k,j,!0);else{var ae=l?ti({delay:l(k,j)},o):o;h8(ie,se,ae),s(ie,se,ie,se,ae)}}else for(var fe=ti({dividePath:NBe[t],individualDelay:l&&function(dt,ye,Xe,He){return l(dt+k,j)}},o),Se=B?OBe(Z,te,fe):FBe(te,Z,fe),Ee=Se.fromIndividuals,Re=Se.toIndividuals,qe=Ee.length,Le=0;Le<qe;Le++){var ae=l?ti({delay:l(Le,qe)},o):o;s(Ee[Le],Re[Le],B?Z[Le]:M.one,B?M.one:Z[Le],ae)}}for(var _=h?h===n:n.length>e.length,y=h?gY(d,h):gY(_?e:n,[_?n:e]),T=0,I=0;I<y.length;I++)T+=y[I].many.length;for(var C=0,I=0;I<y.length;I++)m(y[I],_,C,T),C+=y[I].many.length}function ay(n){if(!n)return[];if(fr(n)){for(var e=[],t=0;t<n.length;t++)e.push(ay(n[t]));return e}var r=[];return n.traverse(function(i){i instanceof Xi&&!i.disableMorphing&&!i.invisible&&!i.ignore&&r.push(i)}),r}var Oae=1e4,zBe=0,vY=1,_Y=2,UBe=Xs();function VBe(n,e){for(var t=n.dimensions,r=0;r<t.length;r++){var i=n.getDimensionInfo(t[r]);if(i&&i.otherDims[e]===0)return t[r]}}function GBe(n,e,t){var r=n.getDimensionInfo(t),i=r&&r.ordinalMeta;if(r){var s=n.get(r.name,e);return i&&i.categories[s]||s+""}}function yY(n,e,t,r){var i=r?"itemChildGroupId":"itemGroupId",s=VBe(n,i);if(s){var a=GBe(n,e,s);return a}var l=n.getRawDataItem(e),o=r?"childGroupId":"groupId";if(l&&l[o])return l[o]+"";if(!r)return t||n.getId(e)}function xY(n){var e=[];return it(n,function(t){var r=t.data,i=t.dataGroupId;if(!(r.count()>Oae))for(var s=r.getIndices(),a=0;a<s.length;a++)e.push({data:r,groupId:yY(r,a,i,!1),childGroupId:yY(r,a,i,!0),divide:t.divide,dataIndex:a})}),e}function vk(n,e,t){n.traverse(function(r){r instanceof Xi&&$l(r,{style:{opacity:0}},e,{dataIndex:t,isFrom:!0})})}function _k(n){if(n.parent){var e=n.getComputedTransform();n.setLocalTransform(e),n.parent.remove(n)}}function F1(n){n.stopAnimation(),n.isGroup&&n.traverse(function(e){e.stopAnimation()})}function HBe(n,e,t){var r=bD("update",t,e);r&&n.traverse(function(i){if(i instanceof yw){var s=qCe(i);s&&i.animateFrom({style:s},r)}})}function jBe(n,e){var t=n.length;if(t!==e.length)return!1;for(var r=0;r<t;r++){var i=n[r],s=e[r];if(i.data.getId(i.dataIndex)!==s.data.getId(s.dataIndex))return!1}return!0}function Fae(n,e,t){var r=xY(n),i=xY(e);function s(k,j,q,Z,te){(q||k)&&j.animateFrom({style:q&&q!==k?Jn(Jn({},q.style),k.style):k.style},te)}var a=!1,l=zBe,o=ri(),h=ri();r.forEach(function(k){k.groupId&&o.set(k.groupId,!0),k.childGroupId&&h.set(k.childGroupId,!0)});for(var d=0;d<i.length;d++){var m=i[d].groupId;if(h.get(m)){l=vY;break}var _=i[d].childGroupId;if(_&&o.get(_)){l=_Y;break}}function y(k,j){return function(q){var Z=q.data,te=q.dataIndex;return j?Z.getId(te):k?l===vY?q.childGroupId:q.groupId:l===_Y?q.childGroupId:q.groupId}}var T=jBe(r,i),I={};if(!T)for(var d=0;d<i.length;d++){var C=i[d],M=C.data.getItemGraphicEl(C.dataIndex);M&&(I[M.id]=!0)}function B(k,j){var q=r[j],Z=i[k],te=Z.data.hostModel,ie=q.data.getItemGraphicEl(q.dataIndex),se=Z.data.getItemGraphicEl(Z.dataIndex);if(ie===se){se&&HBe(se,Z.dataIndex,te);return}ie&&I[ie.id]||se&&(F1(se),ie?(F1(ie),_k(ie),a=!0,gk(ay(ie),ay(se),Z.divide,te,k,s)):vk(se,te,k))}new oT(r,i,y(!0,T),y(!1,T),null,"multiple").update(B).updateManyToOne(function(k,j){var q=i[k],Z=q.data,te=Z.hostModel,ie=Z.getItemGraphicEl(q.dataIndex),se=ta(xr(j,function(ae){return r[ae].data.getItemGraphicEl(r[ae].dataIndex)}),function(ae){return ae&&ae!==ie&&!I[ae.id]});ie&&(F1(ie),se.length?(it(se,function(ae){F1(ae),_k(ae)}),a=!0,gk(ay(se),ay(ie),q.divide,te,k,s)):vk(ie,te,q.dataIndex))}).updateOneToMany(function(k,j){var q=r[j],Z=q.data.getItemGraphicEl(q.dataIndex);if(!(Z&&I[Z.id])){var te=ta(xr(k,function(se){return i[se].data.getItemGraphicEl(i[se].dataIndex)}),function(se){return se&&se!==Z}),ie=i[k[0]].data.hostModel;te.length&&(it(te,function(se){return F1(se)}),Z?(F1(Z),_k(Z),a=!0,gk(ay(Z),ay(te),q.divide,ie,k[0],s)):it(te,function(se){return vk(se,ie,k[0])}))}}).updateManyToMany(function(k,j){new oT(j,k,function(q){return r[q].data.getId(r[q].dataIndex)},function(q){return i[q].data.getId(i[q].dataIndex)}).update(function(q,Z){B(k[q],j[Z])}).execute()}).execute(),a&&it(e,function(k){var j=k.data,q=j.hostModel,Z=q&&t.getViewOfSeriesModel(q),te=bD("update",q,0);Z&&q.isAnimationEnabled()&&te&&te.duration>0&&Z.group.traverse(function(ie){ie instanceof Xi&&!ie.animators.length&&ie.animateFrom({style:{opacity:0}},te)})})}function bY(n){var e=n.getModel("universalTransition").get("seriesKey");return e||n.id}function wY(n){return fr(n)?n.sort().join(","):n}function I0(n){if(n.hostModel)return n.hostModel.getModel("universalTransition").get("divideShape")}function WBe(n,e){var t=ri(),r=ri(),i=ri();return it(n.oldSeries,function(s,a){var l=n.oldDataGroupIds[a],o=n.oldData[a],h=bY(s),d=wY(h);r.set(d,{dataGroupId:l,data:o}),fr(h)&&it(h,function(m){i.set(m,{key:d,dataGroupId:l,data:o})})}),it(e.updatedSeries,function(s){if(s.isUniversalTransitionEnabled()&&s.isAnimationEnabled()){var a=s.get("dataGroupId"),l=s.getData(),o=bY(s),h=wY(o),d=r.get(h);if(d)t.set(h,{oldSeries:[{dataGroupId:d.dataGroupId,divide:I0(d.data),data:d.data}],newSeries:[{dataGroupId:a,divide:I0(l),data:l}]});else if(fr(o)){var m=[];it(o,function(T){var I=r.get(T);I.data&&m.push({dataGroupId:I.dataGroupId,divide:I0(I.data),data:I.data})}),m.length&&t.set(h,{oldSeries:m,newSeries:[{dataGroupId:a,data:l,divide:I0(l)}]})}else{var _=i.get(o);if(_){var y=t.get(_.key);y||(y={oldSeries:[{dataGroupId:_.dataGroupId,data:_.data,divide:I0(_.data)}],newSeries:[]},t.set(_.key,y)),y.newSeries.push({dataGroupId:a,data:l,divide:I0(l)})}}}}),t}function SY(n,e){for(var t=0;t<n.length;t++){var r=e.seriesIndex!=null&&e.seriesIndex===n[t].seriesIndex||e.seriesId!=null&&e.seriesId===n[t].id;if(r)return t}}function XBe(n,e,t,r){var i=[],s=[];it(da(n.from),function(a){var l=SY(e.oldSeries,a);l>=0&&i.push({dataGroupId:e.oldDataGroupIds[l],data:e.oldData[l],divide:I0(e.oldData[l]),groupIdDim:a.dimension})}),it(da(n.to),function(a){var l=SY(t.updatedSeries,a);if(l>=0){var o=t.updatedSeries[l].getData();s.push({dataGroupId:e.oldDataGroupIds[l],data:o,divide:I0(o),groupIdDim:a.dimension})}}),i.length>0&&s.length>0&&Fae(i,s,r)}function $Be(n){n.registerUpdateLifecycle("series:beforeupdate",function(e,t,r){it(da(r.seriesTransition),function(i){it(da(i.to),function(s){for(var a=r.updatedSeries,l=0;l<a.length;l++)(s.seriesIndex!=null&&s.seriesIndex===a[l].seriesIndex||s.seriesId!=null&&s.seriesId===a[l].id)&&(a[l][WI]=!0)})})}),n.registerUpdateLifecycle("series:transition",function(e,t,r){var i=UBe(t);if(i.oldSeries&&r.updatedSeries&&r.optionChanged){var s=r.seriesTransition;if(s)it(da(s),function(y){XBe(y,i,r,t)});else{var a=WBe(i,r);it(a.keys(),function(y){var T=a.get(y);Fae(T.oldSeries,T.newSeries,t)})}it(r.updatedSeries,function(y){y[WI]&&(y[WI]=!1)})}for(var l=e.getSeries(),o=i.oldSeries=[],h=i.oldDataGroupIds=[],d=i.oldData=[],m=0;m<l.length;m++){var _=l[m].getData();_.count()<Oae&&(o.push(l[m]),h.push(l[m].get("dataGroupId")),d.push(_))}})}function AY(n,e,t){var r=gw.createCanvas(),i=e.getWidth(),s=e.getHeight(),a=r.style;return a&&(a.position="absolute",a.left="0",a.top="0",a.width=i+"px",a.height=s+"px",r.setAttribute("data-zr-dom-id",n)),r.width=i*t,r.height=s*t,r}var yk=function(n){Hn(e,n);function e(t,r,i){var s=n.call(this)||this;s.motionBlur=!1,s.lastFrameAlpha=.7,s.dpr=1,s.virtual=!1,s.config={},s.incremental=!1,s.zlevel=0,s.maxRepaintRectCount=5,s.__dirty=!0,s.__firstTimePaint=!0,s.__used=!1,s.__drawIndex=0,s.__startIndex=0,s.__endIndex=0,s.__prevStartIndex=null,s.__prevEndIndex=null;var a;i=i||pP,typeof t=="string"?a=AY(t,r,i):Xr(t)&&(a=t,t=a.id),s.id=t,s.dom=a;var l=a.style;return l&&(Qne(a),a.onselectstart=function(){return!1},l.padding="0",l.margin="0",l.borderWidth="0"),s.painter=r,s.dpr=i,s}return e.prototype.getElementCount=function(){return this.__endIndex-this.__startIndex},e.prototype.afterBrush=function(){this.__prevStartIndex=this.__startIndex,this.__prevEndIndex=this.__endIndex},e.prototype.initContext=function(){this.ctx=this.dom.getContext("2d"),this.ctx.dpr=this.dpr},e.prototype.setUnpainted=function(){this.__firstTimePaint=!0},e.prototype.createBackBuffer=function(){var t=this.dpr;this.domBack=AY("back-"+this.id,this.painter,t),this.ctxBack=this.domBack.getContext("2d"),t!==1&&this.ctxBack.scale(t,t)},e.prototype.createRepaintRects=function(t,r,i,s){if(this.__firstTimePaint)return this.__firstTimePaint=!1,null;var a=[],l=this.maxRepaintRectCount,o=!1,h=new as(0,0,0,0);function d(B){if(!(!B.isFinite()||B.isZero()))if(a.length===0){var k=new as(0,0,0,0);k.copy(B),a.push(k)}else{for(var j=!1,q=1/0,Z=0,te=0;te<a.length;++te){var ie=a[te];if(ie.intersect(B)){var se=new as(0,0,0,0);se.copy(ie),se.union(B),a[te]=se,j=!0;break}else if(o){h.copy(B),h.union(ie);var ae=B.width*B.height,fe=ie.width*ie.height,Se=h.width*h.height,Ee=Se-ae-fe;Ee<q&&(q=Ee,Z=te)}}if(o&&(a[Z].union(B),j=!0),!j){var k=new as(0,0,0,0);k.copy(B),a.push(k)}o||(o=a.length>=l)}}for(var m=this.__startIndex;m<this.__endIndex;++m){var _=t[m];if(_){var y=_.shouldBePainted(i,s,!0,!0),T=_.__isRendered&&(_.__dirty&Iu||!y)?_.getPrevPaintRect():null;T&&d(T);var I=y&&(_.__dirty&Iu||!_.__isRendered)?_.getPaintRect():null;I&&d(I)}}for(var m=this.__prevStartIndex;m<this.__prevEndIndex;++m){var _=r[m],y=_&&_.shouldBePainted(i,s,!0,!0);if(_&&(!y||!_.__zr)&&_.__isRendered){var T=_.getPrevPaintRect();T&&d(T)}}var C;do{C=!1;for(var m=0;m<a.length;){if(a[m].isZero()){a.splice(m,1);continue}for(var M=m+1;M<a.length;)a[m].intersect(a[M])?(C=!0,a[m].union(a[M]),a.splice(M,1)):M++;m++}}while(C);return this._paintRects=a,a},e.prototype.debugGetPaintRects=function(){return(this._paintRects||[]).slice()},e.prototype.resize=function(t,r){var i=this.dpr,s=this.dom,a=s.style,l=this.domBack;a&&(a.width=t+"px",a.height=r+"px"),s.width=t*i,s.height=r*i,l&&(l.width=t*i,l.height=r*i,i!==1&&this.ctxBack.scale(i,i))},e.prototype.clear=function(t,r,i){var s=this.dom,a=this.ctx,l=s.width,o=s.height;r=r||this.clearColor;var h=this.motionBlur&&!t,d=this.lastFrameAlpha,m=this.dpr,_=this;h&&(this.domBack||this.createBackBuffer(),this.ctxBack.globalCompositeOperation="copy",this.ctxBack.drawImage(s,0,0,l/m,o/m));var y=this.domBack;function T(I,C,M,B){if(a.clearRect(I,C,M,B),r&&r!=="transparent"){var k=void 0;if(oD(r)){var j=r.global||r.__width===M&&r.__height===B;k=j&&r.__canvasGradient||rN(a,r,{x:0,y:0,width:M,height:B}),r.__canvasGradient=k,r.__width=M,r.__height=B}else uAe(r)&&(r.scaleX=r.scaleX||m,r.scaleY=r.scaleY||m,k=iN(a,r,{dirty:function(){_.setUnpainted(),_.painter.refresh()}}));a.save(),a.fillStyle=k||r,a.fillRect(I,C,M,B),a.restore()}h&&(a.save(),a.globalAlpha=d,a.drawImage(y,I,C,M,B),a.restore())}!i||h?T(0,0,l,o):i.length&&it(i,function(I){T(I.x*m,I.y*m,I.width*m,I.height*m)})},e}(rd),TY=1e5,Y_=314159,sI=.01,qBe=.001;function ZBe(n){return n?n.__builtin__?!0:!(typeof n.resize!="function"||typeof n.refresh!="function"):!1}function YBe(n,e){var t=document.createElement("div");return t.style.cssText=["position:relative","width:"+n+"px","height:"+e+"px","padding:0","margin:0","border-width:0"].join(";")+";",t}var KBe=function(){function n(e,t,r,i){this.type="canvas",this._zlevelList=[],this._prevDisplayList=[],this._layers={},this._layerConfig={},this._needsManuallyCompositing=!1,this.type="canvas";var s=!e.nodeName||e.nodeName.toUpperCase()==="CANVAS";this._opts=r=Jn({},r||{}),this.dpr=r.devicePixelRatio||pP,this._singleCanvas=s,this.root=e;var a=e.style;a&&(Qne(e),e.innerHTML=""),this.storage=t;var l=this._zlevelList;this._prevDisplayList=[];var o=this._layers;if(s){var d=e,m=d.width,_=d.height;r.width!=null&&(m=r.width),r.height!=null&&(_=r.height),this.dpr=r.devicePixelRatio||1,d.width=m*this.dpr,d.height=_*this.dpr,this._width=m,this._height=_;var y=new yk(d,this,this.dpr);y.__builtin__=!0,y.initContext(),o[Y_]=y,y.zlevel=Y_,l.push(Y_),this._domRoot=e}else{this._width=VE(e,0,r),this._height=VE(e,1,r);var h=this._domRoot=YBe(this._width,this._height);e.appendChild(h)}}return n.prototype.getType=function(){return"canvas"},n.prototype.isSingleCanvas=function(){return this._singleCanvas},n.prototype.getViewportRoot=function(){return this._domRoot},n.prototype.getViewportRootOffset=function(){var e=this.getViewportRoot();if(e)return{offsetLeft:e.offsetLeft||0,offsetTop:e.offsetTop||0}},n.prototype.refresh=function(e){var t=this.storage.getDisplayList(!0),r=this._prevDisplayList,i=this._zlevelList;this._redrawId=Math.random(),this._paintList(t,r,e,this._redrawId);for(var s=0;s<i.length;s++){var a=i[s],l=this._layers[a];if(!l.__builtin__&&l.refresh){var o=s===0?this._backgroundColor:null;l.refresh(o)}}return this._opts.useDirtyRect&&(this._prevDisplayList=t.slice()),this},n.prototype.refreshHover=function(){this._paintHoverList(this.storage.getDisplayList(!1))},n.prototype._paintHoverList=function(e){var t=e.length,r=this._hoverlayer;if(r&&r.clear(),!!t){for(var i={inHover:!0,viewWidth:this._width,viewHeight:this._height},s,a=0;a<t;a++){var l=e[a];l.__inHover&&(r||(r=this._hoverlayer=this.getLayer(TY)),s||(s=r.ctx,s.save()),wy(s,l,i,a===t-1))}s&&s.restore()}},n.prototype.getHoverLayer=function(){return this.getLayer(TY)},n.prototype.paintOne=function(e,t){Ese(e,t)},n.prototype._paintList=function(e,t,r,i){if(this._redrawId===i){r=r||!1,this._updateLayerStatus(e);var s=this._doPaintList(e,t,r),a=s.finished,l=s.needsRefreshHover;if(this._needsManuallyCompositing&&this._compositeManually(),l&&this._paintHoverList(e),a)this.eachLayer(function(h){h.afterBrush&&h.afterBrush()});else{var o=this;cP(function(){o._paintList(e,t,r,i)})}}},n.prototype._compositeManually=function(){var e=this.getLayer(Y_).ctx,t=this._domRoot.width,r=this._domRoot.height;e.clearRect(0,0,t,r),this.eachBuiltinLayer(function(i){i.virtual&&e.drawImage(i.dom,0,0,t,r)})},n.prototype._doPaintList=function(e,t,r){for(var i=this,s=[],a=this._opts.useDirtyRect,l=0;l<this._zlevelList.length;l++){var o=this._zlevelList[l],h=this._layers[o];h.__builtin__&&h!==this._hoverlayer&&(h.__dirty||r)&&s.push(h)}for(var d=!0,m=!1,_=function(I){var C=s[I],M=C.ctx,B=a&&C.createRepaintRects(e,t,y._width,y._height),k=r?C.__startIndex:C.__drawIndex,j=!r&&C.incremental&&Date.now,q=j&&Date.now(),Z=C.zlevel===y._zlevelList[0]?y._backgroundColor:null;if(C.__startIndex===C.__endIndex)C.clear(!1,Z,B);else if(k===C.__startIndex){var te=e[k];(!te.incremental||!te.notClear||r)&&C.clear(!1,Z,B)}k===-1&&(console.error("For some unknown reason. drawIndex is -1"),k=C.__startIndex);var ie,se=function(Ee){var Re={inHover:!1,allClipped:!1,prevEl:null,viewWidth:i._width,viewHeight:i._height};for(ie=k;ie<C.__endIndex;ie++){var qe=e[ie];if(qe.__inHover&&(m=!0),i._doPaintEl(qe,C,a,Ee,Re,ie===C.__endIndex-1),j){var Le=Date.now()-q;if(Le>15)break}}Re.prevElClipPaths&&M.restore()};if(B)if(B.length===0)ie=C.__endIndex;else for(var ae=y.dpr,fe=0;fe<B.length;++fe){var Se=B[fe];M.save(),M.beginPath(),M.rect(Se.x*ae,Se.y*ae,Se.width*ae,Se.height*ae),M.clip(),se(Se),M.restore()}else M.save(),se(),M.restore();C.__drawIndex=ie,C.__drawIndex<C.__endIndex&&(d=!1)},y=this,T=0;T<s.length;T++)_(T);return pi.wxa&&it(this._layers,function(I){I&&I.ctx&&I.ctx.draw&&I.ctx.draw()}),{finished:d,needsRefreshHover:m}},n.prototype._doPaintEl=function(e,t,r,i,s,a){var l=t.ctx;if(r){var o=e.getPaintRect();(!i||o&&o.intersect(i))&&(wy(l,e,s,a),e.setPrevPaintRect(o))}else wy(l,e,s,a)},n.prototype.getLayer=function(e,t){this._singleCanvas&&!this._needsManuallyCompositing&&(e=Y_);var r=this._layers[e];return r||(r=new yk("zr_"+e,this,this.dpr),r.zlevel=e,r.__builtin__=!0,this._layerConfig[e]?Li(r,this._layerConfig[e],!0):this._layerConfig[e-sI]&&Li(r,this._layerConfig[e-sI],!0),t&&(r.virtual=t),this.insertLayer(e,r),r.initContext()),r},n.prototype.insertLayer=function(e,t){var r=this._layers,i=this._zlevelList,s=i.length,a=this._domRoot,l=null,o=-1;if(!r[e]&&ZBe(t)){if(s>0&&e>i[0]){for(o=0;o<s-1&&!(i[o]<e&&i[o+1]>e);o++);l=r[i[o]]}if(i.splice(o+1,0,e),r[e]=t,!t.virtual)if(l){var h=l.dom;h.nextSibling?a.insertBefore(t.dom,h.nextSibling):a.appendChild(t.dom)}else a.firstChild?a.insertBefore(t.dom,a.firstChild):a.appendChild(t.dom);t.painter||(t.painter=this)}},n.prototype.eachLayer=function(e,t){for(var r=this._zlevelList,i=0;i<r.length;i++){var s=r[i];e.call(t,this._layers[s],s)}},n.prototype.eachBuiltinLayer=function(e,t){for(var r=this._zlevelList,i=0;i<r.length;i++){var s=r[i],a=this._layers[s];a.__builtin__&&e.call(t,a,s)}},n.prototype.eachOtherLayer=function(e,t){for(var r=this._zlevelList,i=0;i<r.length;i++){var s=r[i],a=this._layers[s];a.__builtin__||e.call(t,a,s)}},n.prototype.getLayers=function(){return this._layers},n.prototype._updateLayerStatus=function(e){this.eachBuiltinLayer(function(m,_){m.__dirty=m.__used=!1});function t(m){s&&(s.__endIndex!==m&&(s.__dirty=!0),s.__endIndex=m)}if(this._singleCanvas)for(var r=1;r<e.length;r++){var i=e[r];if(i.zlevel!==e[r-1].zlevel||i.incremental){this._needsManuallyCompositing=!0;break}}var s=null,a=0,l,o;for(o=0;o<e.length;o++){var i=e[o],h=i.zlevel,d=void 0;l!==h&&(l=h,a=0),i.incremental?(d=this.getLayer(h+qBe,this._needsManuallyCompositing),d.incremental=!0,a=1):d=this.getLayer(h+(a>0?sI:0),this._needsManuallyCompositing),d.__builtin__||K6("ZLevel "+h+" has been used by unkown layer "+d.id),d!==s&&(d.__used=!0,d.__startIndex!==o&&(d.__dirty=!0),d.__startIndex=o,d.incremental?d.__drawIndex=-1:d.__drawIndex=o,t(o),s=d),i.__dirty&Iu&&!i.__inHover&&(d.__dirty=!0,d.incremental&&d.__drawIndex<0&&(d.__drawIndex=o))}t(o),this.eachBuiltinLayer(function(m,_){!m.__used&&m.getElementCount()>0&&(m.__dirty=!0,m.__startIndex=m.__endIndex=m.__drawIndex=0),m.__dirty&&m.__drawIndex<0&&(m.__drawIndex=m.__startIndex)})},n.prototype.clear=function(){return this.eachBuiltinLayer(this._clearLayer),this},n.prototype._clearLayer=function(e){e.clear()},n.prototype.setBackgroundColor=function(e){this._backgroundColor=e,it(this._layers,function(t){t.setUnpainted()})},n.prototype.configLayer=function(e,t){if(t){var r=this._layerConfig;r[e]?Li(r[e],t,!0):r[e]=t;for(var i=0;i<this._zlevelList.length;i++){var s=this._zlevelList[i];if(s===e||s===e+sI){var a=this._layers[s];Li(a,r[e],!0)}}}},n.prototype.delLayer=function(e){var t=this._layers,r=this._zlevelList,i=t[e];i&&(i.dom.parentNode.removeChild(i.dom),delete t[e],r.splice(Wi(r,e),1))},n.prototype.resize=function(e,t){if(this._domRoot.style){var r=this._domRoot;r.style.display="none";var i=this._opts,s=this.root;if(e!=null&&(i.width=e),t!=null&&(i.height=t),e=VE(s,0,i),t=VE(s,1,i),r.style.display="",this._width!==e||t!==this._height){r.style.width=e+"px",r.style.height=t+"px";for(var a in this._layers)this._layers.hasOwnProperty(a)&&this._layers[a].resize(e,t);this.refresh(!0)}this._width=e,this._height=t}else{if(e==null||t==null)return;this._width=e,this._height=t,this.getLayer(Y_).resize(e,t)}return this},n.prototype.clearLayer=function(e){var t=this._layers[e];t&&t.clear()},n.prototype.dispose=function(){this.root.innerHTML="",this.root=this.storage=this._domRoot=this._layers=null},n.prototype.getRenderedCanvas=function(e){if(e=e||{},this._singleCanvas&&!this._compositeManually)return this._layers[Y_].dom;var t=new yk("image",this,e.pixelRatio||this.dpr);t.initContext(),t.clear(!1,e.backgroundColor||this._backgroundColor);var r=t.ctx;if(e.pixelRatio<=this.dpr){this.refresh();var i=t.dom.width,s=t.dom.height;this.eachLayer(function(m){m.__builtin__?r.drawImage(m.dom,0,0,i,s):m.renderToCanvas&&(r.save(),m.renderToCanvas(r),r.restore())})}else for(var a={inHover:!1,viewWidth:this._width,viewHeight:this._height},l=this.storage.getDisplayList(!0),o=0,h=l.length;o<h;o++){var d=l[o];wy(r,d,a,o===h-1)}return t.dom},n.prototype.getWidth=function(){return this._width},n.prototype.getHeight=function(){return this._height},n}();function JBe(n){n.registerPainter("canvas",KBe)}fp([q5e,W5e,c4e,xBe,vBe,O4e,iBe,M5e,dDe,VDe,EDe,HLe,$Be,JBe]);const QBe=()=>{let n=null,e=null,t=null,r=null,i=null,s=null,a=Ae.useRef(null),l=[],o=[],h={colors:{base:"#f9f002",gradInner:"#8ae66e",gradOuter:"#03c03c"},reset:()=>{r.reset()}},d={impacts:{value:l},maxSize:{value:.04},minSize:{value:.025},waveHeight:{value:.1},scaling:{value:1},gradInner:{value:new Gn(h.colors.gradInner)},gradOuter:{value:new Gn(h.colors.gradOuter)}},m=10,_=null;const[y,T]=Ae.useState(USe[new Date().getDay()]),[I,C]=Ae.useState(new Date().toLocaleTimeString()),[M,B]=Ae.useState(!1),[k,j]=Ae.useState(X5[0]),[q,Z]=Ae.useState(!1),te=Ae.useRef(q),ie=new tD,se=new nn;Ae.useEffect(()=>{ae(),Le();for(let wt=0;wt<m;wt++)l.push({impactPosition:new Ze().random().subScalar(.5).setLength(5),impactMaxRadius:5*to.randFloat(.5,.75),impactRatio:0,prevPosition:new Ze().random().subScalar(.5).setLength(5),trailRatio:{value:0},trailLength:{value:0}}),Se(wt);return Re(),dt(),ye(),window.addEventListener("resize",Xe),window.addEventListener("dblclick",He,!1),()=>{window.removeEventListener("resize",Xe),window.removeEventListener("dblclick",He,!1),_&&clearInterval(_)}},[]),Ae.useEffect(()=>{te.current=q},[q]);const ae=()=>{n=new Al,e=new Qi(45,window.innerWidth/window.innerHeight,.1,50),e.position.set(0,0,15.5),n.add(e),t=new Zl({canvas:a.current,antialias:!0,alpha:!0}),t.setSize(window.innerWidth,window.innerHeight),t.setPixelRatio(Math.min(window.devicePixelRatio,2)),t.render(n,e),r=new Ev(e,t.domElement),r.enableDamping=!0,r.enablePan=!1,s=new rD(t),s.addPass(new iD(n,e)),s.addPass(new NSe)},fe=()=>{let wt=5,Gt=75e3,at=Math.PI*(3-Math.sqrt(5)),Ht=2/Gt,Qt=1-Ht/2,rn=0,jn=0,Bn=new Ze,Tn=new XA,Pe=new Ii,$e=[],mn=new qf().load($Se);for(let Jt=0;Jt<Gt;Jt++){jn=Math.sqrt(1-Qt*Qt),Bn.set(jn*Math.cos(rn),Qt,-jn*Math.sin(rn)).multiplyScalar(wt),Tn.setFromVector3(Bn),rn=rn+at,Qt=Qt-Ht,Pe.lookAt(Bn),Pe.updateMatrix();let kn=new Jm(1,1);kn.applyMatrix4(Pe.matrix),kn.translate(Bn.x,Bn.y,Bn.z);let Vn=[Bn.x,Bn.y,Bn.z,Bn.x,Bn.y,Bn.z,Bn.x,Bn.y,Bn.z,Bn.x,Bn.y,Bn.z];kn.setAttribute("center",new ar(Vn,3));let sn=new nn((Tn.theta+Math.PI)/(2*Math.PI),1-Tn.phi/Math.PI),ot=[sn.x,sn.y,sn.x,sn.y,sn.x,sn.y,sn.x,sn.y];kn.setAttribute("baseUv",new ar(ot,2)),$e.push(kn)}let cn=zSe($e),St=new vo({color:new Gn(h.colors.base),onBeforeCompile:Jt=>{Jt.uniforms.impacts=d.impacts,Jt.uniforms.maxSize=d.maxSize,Jt.uniforms.minSize=d.minSize,Jt.uniforms.waveHeight=d.waveHeight,Jt.uniforms.scaling=d.scaling,Jt.uniforms.gradInner=d.gradInner,Jt.uniforms.gradOuter=d.gradOuter,Jt.uniforms.tex={value:mn},Jt.vertexShader=`
            struct impact {
              vec3 impactPosition;
              float impactMaxRadius;
              float impactRatio;
            };
            uniform impact impacts[${m}];
            uniform sampler2D tex;
            uniform float maxSize;
            uniform float minSize;
            uniform float waveHeight;
            uniform float scaling;

            attribute vec3 center;
            attribute vec2 baseUv;

            varying float vFinalStep;
            varying float vMap;

            ${Jt.vertexShader}
          `.replace("#include <begin_vertex>",`#include <begin_vertex>
            float finalStep = 0.0;
            for (int i = 0; i < ${m};i++){
              float dist = distance(center, impacts[i].impactPosition);
              float curRadius = impacts[i].impactMaxRadius * impacts[i].impactRatio;
              float sstep = smoothstep(0., curRadius, dist) - smoothstep(curRadius - ( 0.25 * impacts[i].impactRatio ), curRadius, dist);
              sstep *= 1. - impacts[i].impactRatio;
              finalStep += sstep;
            }
            finalStep = clamp(finalStep, 0., 1.);
            vFinalStep = finalStep;

            float map = texture(tex, baseUv).g;
            vMap = map;
            float pSize = map < 0.5 ? maxSize : minSize;
            float scale = scaling;

            transformed = (position - center) * pSize * mix(1., scale * 1.25, finalStep) + center; // scale on wave
            transformed += normal * finalStep * waveHeight; // lift on wave
            `),Jt.fragmentShader=`
            uniform vec3 gradInner;
            uniform vec3 gradOuter;
            varying float vFinalStep;
            varying float vMap;
            ${Jt.fragmentShader}
            `.replace("vec4 diffuseColor = vec4( diffuse, opacity );",`
            // shaping the point, pretty much from The Book of Shaders
            vec2 hUv = (vUv - 0.5);
            int N = 8;
            float a = atan(hUv.x,hUv.y); 
            float r = PI2/float(N);
            float d = cos(floor(.5+a/r)*r-a)*length(hUv);
            float f = cos(PI / float(N)) * 0.5;
            if (d > f) discard;

            vec3 grad = mix(gradInner, gradOuter, clamp( d / f, 0., 1.)); // gradient
            vec3 diffuseMap = diffuse * ((vMap > 0.5) ? 0.5 : 1.);
            vec3 col = mix(diffuseMap, grad, vFinalStep); // color on wave
            if (!gl_FrontFacing) col *= 0.25; // moderate the color on backside
            vec4 diffuseColor = vec4( col , opacity );
            `)}});St.defines={USE_UV:""},i=new Ei(cn,St),i.rotation.y=Math.PI,o.forEach(Jt=>i.add(Jt)),i.position.set(0,-.4,0),n.add(i)};function Se(wt){let Gt=new Array(300).fill(0),at=new $r;at.setAttribute("position",new ar(Gt,3));let Ht=new C6({color:h.colors.gradOuter,transparent:!0,onBeforeCompile:rn=>{rn.uniforms.actionRatio=l[wt].trailRatio,rn.uniforms.lineLength=l[wt].trailLength,rn.fragmentShader=qSe}}),Qt=new $f(at,Ht);Qt.userData.idx=wt,Ee(Qt,l[wt].prevPosition,l[wt].impactPosition),o.push(Qt)}const Ee=(wt,Gt,at,Ht,Qt)=>{let rn=wt.geometry.attributes.position,jn=rn.count-1,Bn=1,Tn=1,Pe=Gt.length(),$e=Gt.angleTo(at),cn=Pe*$e/Math.PI,St=cn/2/Bn,Jt=Tn/cn,kn=Pe+St,Vn=new Ze().copy(Gt).setLength(kn),sn=new Ze().copy(Gt).negate().setLength(St),ot=new U0(Gt,at,new Ze),Ue=new Ze;ot.getNormal(Ue);let $t=new Ze,An=new Ze,Sn=new Ze,jt=new Ze;for(let mr=0;mr<=jn;mr++){let Un=mr/jn,tr=Un*$e;$t.copy(Vn).applyAxisAngle(Ue,tr),An.copy(sn).applyAxisAngle(Ue,tr+Math.PI*2*Un*Bn),Sn.addVectors($t,An);let Sr=(Sn.length()-Pe)*Jt+Pe;jt.copy(Sn).setLength(Sr),rn.setXYZ(mr,jt.x,jt.y,jt.z)}rn.needsUpdate=!0,wt.computeLineDistances(),wt.geometry.attributes.lineDistance.needsUpdate=!0,l[wt.userData.idx].trailLength.value=wt.geometry.attributes.lineDistance.array[99],wt.material.dashSize=3},Re=()=>{let wt=[];for(let Gt=0;Gt<m;Gt++)wt.push({runTween:()=>{let at=o[Gt],rn=at.geometry.attributes.lineDistance.array[99]/3,jn=new W5.Tween({value:0}).to({value:1},rn*1e3).onUpdate(Tn=>{l[Gt].trailRatio.value=Tn.value});var Bn=new W5.Tween({value:0}).to({value:1},to.randInt(2500,5e3)).onUpdate(Tn=>{d.impacts.value[Gt].impactRatio=Tn.value}).onComplete(Tn=>{l[Gt].prevPosition.copy(l[Gt].impactPosition),l[Gt].impactPosition.random().subScalar(.5).setLength(5),Ee(at,l[Gt].prevPosition,l[Gt].impactPosition),d.impacts.value[Gt].impactMaxRadius=5*to.randFloat(.5,.75),wt[Gt].runTween()});jn.chain(Bn),jn.start()}});wt.forEach(Gt=>Gt.runTween()),fe()};let qe=Array.from({length:5}).map(()=>Ae.useRef(null));const Le=()=>{const wt=[GSe,HSe,jSe,WSe,XSe];qe.map(at=>at.current&&dPe(at.current,"dark")).forEach((at,Ht)=>{at&&at.setOption(wt[Ht])})},dt=()=>{W5.update(),i.rotation.y+=.001,t&&n&&e&&t.render(n,e),requestAnimationFrame(dt),te.current&&s.render()},ye=()=>{_=setInterval(()=>{let wt=new Date,Gt=wt.getHours(),at=wt.getMinutes(),Ht=wt.getSeconds();C(`${Gt<10?"0"+Gt:Gt}:${at<10?"0"+at:at}:${Ht<10?"0"+Ht:Ht}`)},1e3)},Xe=()=>{e.aspect=window.innerWidth/window.innerHeight,e.updateProjectionMatrix(),t.setSize(window.innerWidth,window.innerHeight),s.setSize(window.innerWidth,window.innerHeight)},He=wt=>{se.x=wt.clientX/window.innerWidth*2-1,se.y=-wt.clientY/window.innerHeight*2+1,ie.setFromCamera(se,e),ie.intersectObjects(i.children).length>0&&(B(!0),j(X5[to.randInt(0,X5.length-1)]))},_t=()=>{Z(!q)};return me.jsx("div",{className:"earth-digital bg-black h-screen w-full overflow-hidden select-none",children:me.jsxs("div",{className:"p-0 m-0 box-border",children:[me.jsx("canvas",{ref:a,className:"relative z-1 cursor-pointer"}),me.jsxs("div",{className:"fixed h-40 w-48 z-10 left-1/2 top-1/2 tips-modal",style:{display:M?"block":"none"},children:[me.jsx("div",{className:"tips",children:me.jsx("p",{className:"w-full",children:k})}),me.jsx("i",{className:"close",onClick:()=>B(!1),children:"CLOSE"})]}),me.jsxs("header",{className:"hud header w-full left-0 top-0",children:[me.jsx("div",{className:"left",children:me.jsxs("p",{className:"date",children:[me.jsx("span",{className:"text",children:`${y}曜日 `}),me.jsx("span",{className:"text",children:I})]})}),me.jsx("div",{className:"middle"}),me.jsx("div",{className:"right",children:me.jsx("p",{className:"date",children:me.jsx("span",{className:"text",children:"Kepler-90 +49°18′18.58″"})})})]}),me.jsx("div",{className:"logo-pic",title:"Cyberpunk 2077"}),me.jsxs("aside",{className:"hud aside left",children:[me.jsxs("div",{className:"box box_0 inverse",children:[me.jsx("div",{className:"cover"}),me.jsxs("div",{className:"info",children:[me.jsxs("p",{className:"text",children:[me.jsx("b",{children:"Cyberpunk"}),' is a subgenre of science fiction in a dystopian futuristic setting that tends to focus on a "combination of lowlife and high tech", featuring futuristic technological and scientific achievements, such as artificial intelligence and cybernetics, juxtaposed with societal collapse or decay.'," "]}),me.jsx("button",{className:"startBtn",onClick:_t,children:"START"})]})]}),me.jsx("div",{className:"box",children:me.jsx("div",{className:"chart",ref:qe[0]})}),me.jsx("div",{className:"box inverse dotted",children:me.jsx("div",{className:"chart",ref:qe[1]})})]}),me.jsxs("aside",{className:"hud aside right",children:[me.jsx("div",{className:"box",children:me.jsx("div",{className:"chart",ref:qe[2]})}),me.jsx("div",{className:"box",children:me.jsx("div",{className:"chart",ref:qe[3]})}),me.jsx("div",{className:"box inverse dotted",children:me.jsx("div",{className:"chart",ref:qe[4]})})]}),me.jsx("footer",{className:"hud footer",children:VSe.map(wt=>me.jsxs("div",{className:"square",children:[me.jsx("div",{className:"radar"}),me.jsxs("div",{className:"text",children:[me.jsx("p",{className:"title",children:wt.value}),me.jsx("p",{className:"desc",children:wt.desc})]})]}))}),me.jsx("section",{className:"background",children:"section"})]})})},eke=""+new URL("bird-D9YInZSw.glb",import.meta.url).href,tke=()=>{const n=Ae.useRef(),{scene:e,animations:t}=eg(eke),{actions:r}=G6(t,n);return Ae.useEffect(()=>{r["Take 001"].play()},[]),jT(({clock:i,camera:s})=>{n.current.position.y=Math.sin(i.elapsedTime)*.2+2,n.current.position.x>s.position.x+10?n.current.rotation.y=Math.PI:n.current.position.x<s.position.x-10&&(n.current.rotation.y=0),n.current.rotation.y===0?(n.current.position.x+=.01,n.current.position.z-=.01):(n.current.position.x-=.01,n.current.position.z+=.01)}),me.jsx("mesh",{ref:n,position:[-5,2,1],scale:[.003,.003,.003],children:me.jsx("primitive",{object:e})})},nke=""+new URL("fox-W5Giziuq.glb",import.meta.url).href,Nae=({currentAnimation:n,...e})=>{const t=Ae.useRef(),{nodes:r,materials:i,animations:s}=eg(nke),{actions:a}=G6(s,t);return Ae.useEffect(()=>{console.log(a),Object.values(a).forEach(l=>{l.stop()}),a[n]&&a[n].play()},[a,n]),me.jsx("group",{ref:t,...e,dispose:null,children:me.jsxs("group",{name:"Sketchfab_Scene",children:[me.jsx("primitive",{object:r.GLTF_created_0_rootJoint}),me.jsx("skinnedMesh",{name:"Object_7",geometry:r.Object_7.geometry,material:i.PaletteMaterial001,skeleton:r.Object_7.skeleton}),me.jsx("skinnedMesh",{name:"Object_8",geometry:r.Object_8.geometry,material:i.PaletteMaterial001,skeleton:r.Object_8.skeleton}),me.jsx("skinnedMesh",{name:"Object_9",geometry:r.Object_9.geometry,material:i.PaletteMaterial001,skeleton:r.Object_9.skeleton}),me.jsx("skinnedMesh",{name:"Object_10",geometry:r.Object_10.geometry,material:i.PaletteMaterial001,skeleton:r.Object_10.skeleton}),me.jsx("skinnedMesh",{name:"Object_11",geometry:r.Object_11.geometry,material:i.PaletteMaterial001,skeleton:r.Object_11.skeleton})]})})},rke=()=>me.jsx("section",{className:"absolute w-full h-full",children:me.jsxs(nD,{camera:{position:[0,0,5],fov:75,aspect:window.innerWidth/window.innerHeight,near:.1,far:1e3},children:[me.jsx("ambientLight",{intensity:.5}),me.jsx("directionalLight",{intensity:2.5,position:[0,0,1]}),me.jsx(Nae,{currentAnimation:"idle",position:[.5,0,0],rotation:[12.6,-.5,0],scale:[.6,.6,.6]})]})}),ike=""+new URL("../gltfModels/world_2d/world_2d.gltf",import.meta.url).href,ske=({...n})=>{const t=eg(ike).scene;return me.jsx("mesh",{...n,children:me.jsx("primitive",{object:t})})},oke=()=>me.jsx("section",{className:"absolute w-full h-full",children:me.jsxs(nD,{camera:{fov:75,aspect:window.innerWidth/window.innerHeight,near:.1,far:100,position:[0,0,5]},children:[me.jsx("ambientLight",{intensity:.5}),me.jsx("directionalLight",{intensity:2.5,position:[0,0,1]}),me.jsxs("group",{children:[me.jsxs("mesh",{position:[-2,0,0],children:[me.jsx("meshNormalMaterial",{}),me.jsx("boxGeometry",{args:[1,1,1]})]}),me.jsxs("mesh",{position:[2,0,0],children:[me.jsx("meshNormalMaterial",{}),me.jsx("boxGeometry",{args:[1,1,1]})]})]})]})});class ake extends Ea{constructor(e){super(e)}load(e,t,r,i){const s=this,a=this.path===""?cu.extractUrlBase(e):this.path,l=new Wa(this.manager);l.setPath(this.path),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(o){try{t(s.parse(o,a))}catch(h){i?i(h):console.error(h),s.manager.itemError(e)}},r,i)}setMaterialOptions(e){return this.materialOptions=e,this}parse(e,t){const r=e.split(`
`);let i={};const s=/\s+/,a={};for(let o=0;o<r.length;o++){let h=r[o];if(h=h.trim(),h.length===0||h.charAt(0)==="#")continue;const d=h.indexOf(" ");let m=d>=0?h.substring(0,d):h;m=m.toLowerCase();let _=d>=0?h.substring(d+1):"";if(_=_.trim(),m==="newmtl")i={name:_},a[_]=i;else if(m==="ka"||m==="kd"||m==="ks"||m==="ke"){const y=_.split(s,3);i[m]=[parseFloat(y[0]),parseFloat(y[1]),parseFloat(y[2])]}else i[m]=_}const l=new lke(this.resourcePath||t,this.materialOptions);return l.setCrossOrigin(this.crossOrigin),l.setManager(this.manager),l.setMaterials(a),l}}class lke{constructor(e="",t={}){this.baseUrl=e,this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=this.options.side!==void 0?this.options.side:Rh,this.wrap=this.options.wrap!==void 0?this.options.wrap:Ph}setCrossOrigin(e){return this.crossOrigin=e,this}setManager(e){this.manager=e}setMaterials(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(e){if(!this.options)return e;const t={};for(const r in e){const i=e[r],s={};t[r]=s;for(const a in i){let l=!0,o=i[a];const h=a.toLowerCase();switch(h){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(o=[o[0]/255,o[1]/255,o[2]/255]),this.options&&this.options.ignoreZeroRGBs&&o[0]===0&&o[1]===0&&o[2]===0&&(l=!1);break}l&&(s[h]=o)}}return t}preload(){for(const e in this.materialsInfo)this.create(e)}getIndex(e){return this.nameLookup[e]}getAsArray(){let e=0;for(const t in this.materialsInfo)this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray}create(e){return this.materials[e]===void 0&&this.createMaterial_(e),this.materials[e]}createMaterial_(e){const t=this,r=this.materialsInfo[e],i={name:e,side:this.side};function s(l,o){return typeof o!="string"||o===""?"":/^https?:\/\//i.test(o)?o:l+o}function a(l,o){if(i[l])return;const h=t.getTextureParams(o,i),d=t.loadTexture(s(t.baseUrl,h.url));d.repeat.copy(h.scale),d.offset.copy(h.offset),d.wrapS=t.wrap,d.wrapT=t.wrap,(l==="map"||l==="emissiveMap")&&(d.colorSpace=Ao),i[l]=d}for(const l in r){const o=r[l];let h;if(o!=="")switch(l.toLowerCase()){case"kd":i.color=new Gn().fromArray(o).convertSRGBToLinear();break;case"ks":i.specular=new Gn().fromArray(o).convertSRGBToLinear();break;case"ke":i.emissive=new Gn().fromArray(o).convertSRGBToLinear();break;case"map_kd":a("map",o);break;case"map_ks":a("specularMap",o);break;case"map_ke":a("emissiveMap",o);break;case"norm":a("normalMap",o);break;case"map_bump":case"bump":a("bumpMap",o);break;case"map_d":a("alphaMap",o),i.transparent=!0;break;case"ns":i.shininess=parseFloat(o);break;case"d":h=parseFloat(o),h<1&&(i.opacity=h,i.transparent=!0);break;case"tr":h=parseFloat(o),this.options&&this.options.invertTrProperty&&(h=1-h),h>0&&(i.opacity=1-h,i.transparent=!0);break}}return this.materials[e]=new UT(i),this.materials[e]}getTextureParams(e,t){const r={scale:new nn(1,1),offset:new nn(0,0)},i=e.split(/\s+/);let s;return s=i.indexOf("-bm"),s>=0&&(t.bumpScale=parseFloat(i[s+1]),i.splice(s,2)),s=i.indexOf("-s"),s>=0&&(r.scale.set(parseFloat(i[s+1]),parseFloat(i[s+2])),i.splice(s,4)),s=i.indexOf("-o"),s>=0&&(r.offset.set(parseFloat(i[s+1]),parseFloat(i[s+2])),i.splice(s,4)),r.url=i.join(" ").trim(),r}loadTexture(e,t,r,i,s){const a=this.manager!==void 0?this.manager:P6;let l=a.getHandler(e);l===null&&(l=new qf(a)),l.setCrossOrigin&&l.setCrossOrigin(this.crossOrigin);const o=l.load(e,r,i,s);return t!==void 0&&(o.mapping=t),o}}const cke=/^[og]\s*(.+)?/,uke=/^mtllib /,hke=/^usemtl /,fke=/^usemap /,MY=/\s+/,CY=new Ze,xk=new Ze,EY=new Ze,IY=new Ze,lh=new Ze,oI=new Gn;function dke(){const n={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&this.object.fromDeclaration===!1){this.object.name=e,this.object.fromDeclaration=t!==!1;return}const r=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:t!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(i,s){const a=this._finalize(!1);a&&(a.inherited||a.groupCount<=0)&&this.materials.splice(a.index,1);const l={index:this.materials.length,name:i||"",mtllib:Array.isArray(s)&&s.length>0?s[s.length-1]:"",smooth:a!==void 0?a.smooth:this.smooth,groupStart:a!==void 0?a.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(o){const h={index:typeof o=="number"?o:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return h.clone=this.clone.bind(h),h}};return this.materials.push(l),l},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(i){const s=this.currentMaterial();if(s&&s.groupEnd===-1&&(s.groupEnd=this.geometry.vertices.length/3,s.groupCount=s.groupEnd-s.groupStart,s.inherited=!1),i&&this.materials.length>1)for(let a=this.materials.length-1;a>=0;a--)this.materials[a].groupCount<=0&&this.materials.splice(a,1);return i&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),s}},r&&r.name&&typeof r.clone=="function"){const i=r.clone(0);i.inherited=!0,this.object.materials.push(i)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(e,t){const r=parseInt(e,10);return(r>=0?r-1:r+t/3)*3},parseNormalIndex:function(e,t){const r=parseInt(e,10);return(r>=0?r-1:r+t/3)*3},parseUVIndex:function(e,t){const r=parseInt(e,10);return(r>=0?r-1:r+t/2)*2},addVertex:function(e,t,r){const i=this.vertices,s=this.object.geometry.vertices;s.push(i[e+0],i[e+1],i[e+2]),s.push(i[t+0],i[t+1],i[t+2]),s.push(i[r+0],i[r+1],i[r+2])},addVertexPoint:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,r){const i=this.normals,s=this.object.geometry.normals;s.push(i[e+0],i[e+1],i[e+2]),s.push(i[t+0],i[t+1],i[t+2]),s.push(i[r+0],i[r+1],i[r+2])},addFaceNormal:function(e,t,r){const i=this.vertices,s=this.object.geometry.normals;CY.fromArray(i,e),xk.fromArray(i,t),EY.fromArray(i,r),lh.subVectors(EY,xk),IY.subVectors(CY,xk),lh.cross(IY),lh.normalize(),s.push(lh.x,lh.y,lh.z),s.push(lh.x,lh.y,lh.z),s.push(lh.x,lh.y,lh.z)},addColor:function(e,t,r){const i=this.colors,s=this.object.geometry.colors;i[e]!==void 0&&s.push(i[e+0],i[e+1],i[e+2]),i[t]!==void 0&&s.push(i[t+0],i[t+1],i[t+2]),i[r]!==void 0&&s.push(i[r+0],i[r+1],i[r+2])},addUV:function(e,t,r){const i=this.uvs,s=this.object.geometry.uvs;s.push(i[e+0],i[e+1]),s.push(i[t+0],i[t+1]),s.push(i[r+0],i[r+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,r,i,s,a,l,o,h){const d=this.vertices.length;let m=this.parseVertexIndex(e,d),_=this.parseVertexIndex(t,d),y=this.parseVertexIndex(r,d);if(this.addVertex(m,_,y),this.addColor(m,_,y),l!==void 0&&l!==""){const T=this.normals.length;m=this.parseNormalIndex(l,T),_=this.parseNormalIndex(o,T),y=this.parseNormalIndex(h,T),this.addNormal(m,_,y)}else this.addFaceNormal(m,_,y);if(i!==void 0&&i!==""){const T=this.uvs.length;m=this.parseUVIndex(i,T),_=this.parseUVIndex(s,T),y=this.parseUVIndex(a,T),this.addUV(m,_,y),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const t=this.vertices.length;for(let r=0,i=e.length;r<i;r++){const s=this.parseVertexIndex(e[r],t);this.addVertexPoint(s),this.addColor(s)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";const r=this.vertices.length,i=this.uvs.length;for(let s=0,a=e.length;s<a;s++)this.addVertexLine(this.parseVertexIndex(e[s],r));for(let s=0,a=t.length;s<a;s++)this.addUVLine(this.parseUVIndex(t[s],i))}};return n.startObject("",!1),n}class pke extends Ea{constructor(e){super(e),this.materials=null}load(e,t,r,i){const s=this,a=new Wa(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(l){try{t(s.parse(l))}catch(o){i?i(o):console.error(o),s.manager.itemError(e)}},r,i)}setMaterials(e){return this.materials=e,this}parse(e){const t=new dke;e.indexOf(`\r
`)!==-1&&(e=e.replace(/\r\n/g,`
`)),e.indexOf(`\\
`)!==-1&&(e=e.replace(/\\\n/g,""));const r=e.split(`
`);let i=[];for(let l=0,o=r.length;l<o;l++){const h=r[l].trimStart();if(h.length===0)continue;const d=h.charAt(0);if(d!=="#")if(d==="v"){const m=h.split(MY);switch(m[0]){case"v":t.vertices.push(parseFloat(m[1]),parseFloat(m[2]),parseFloat(m[3])),m.length>=7?(oI.setRGB(parseFloat(m[4]),parseFloat(m[5]),parseFloat(m[6])).convertSRGBToLinear(),t.colors.push(oI.r,oI.g,oI.b)):t.colors.push(void 0,void 0,void 0);break;case"vn":t.normals.push(parseFloat(m[1]),parseFloat(m[2]),parseFloat(m[3]));break;case"vt":t.uvs.push(parseFloat(m[1]),parseFloat(m[2]));break}}else if(d==="f"){const _=h.slice(1).trim().split(MY),y=[];for(let I=0,C=_.length;I<C;I++){const M=_[I];if(M.length>0){const B=M.split("/");y.push(B)}}const T=y[0];for(let I=1,C=y.length-1;I<C;I++){const M=y[I],B=y[I+1];t.addFace(T[0],M[0],B[0],T[1],M[1],B[1],T[2],M[2],B[2])}}else if(d==="l"){const m=h.substring(1).trim().split(" ");let _=[];const y=[];if(h.indexOf("/")===-1)_=m;else for(let T=0,I=m.length;T<I;T++){const C=m[T].split("/");C[0]!==""&&_.push(C[0]),C[1]!==""&&y.push(C[1])}t.addLineGeometry(_,y)}else if(d==="p"){const _=h.slice(1).trim().split(" ");t.addPointGeometry(_)}else if((i=cke.exec(h))!==null){const m=(" "+i[0].slice(1).trim()).slice(1);t.startObject(m)}else if(hke.test(h))t.object.startMaterial(h.substring(7).trim(),t.materialLibraries);else if(uke.test(h))t.materialLibraries.push(h.substring(7).trim());else if(fke.test(h))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(d==="s"){if(i=h.split(" "),i.length>1){const _=i[1].trim().toLowerCase();t.object.smooth=_!=="0"&&_!=="off"}else t.object.smooth=!0;const m=t.object.currentMaterial();m&&(m.smooth=t.object.smooth)}else{if(h==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+h+'"')}}t.finalize();const s=new Wl;if(s.materialLibraries=[].concat(t.materialLibraries),!(t.objects.length===1&&t.objects[0].geometry.vertices.length===0)===!0)for(let l=0,o=t.objects.length;l<o;l++){const h=t.objects[l],d=h.geometry,m=h.materials,_=d.type==="Line",y=d.type==="Points";let T=!1;if(d.vertices.length===0)continue;const I=new $r;I.setAttribute("position",new ar(d.vertices,3)),d.normals.length>0&&I.setAttribute("normal",new ar(d.normals,3)),d.colors.length>0&&(T=!0,I.setAttribute("color",new ar(d.colors,3))),d.hasUVIndices===!0&&I.setAttribute("uv",new ar(d.uvs,2));const C=[];for(let B=0,k=m.length;B<k;B++){const j=m[B],q=j.name+"_"+j.smooth+"_"+T;let Z=t.materials[q];if(this.materials!==null){if(Z=this.materials.create(j.name),_&&Z&&!(Z instanceof Ta)){const te=new Ta;_o.prototype.copy.call(te,Z),te.color.copy(Z.color),Z=te}else if(y&&Z&&!(Z instanceof su)){const te=new su({size:10,sizeAttenuation:!1});_o.prototype.copy.call(te,Z),te.color.copy(Z.color),te.map=Z.map,Z=te}}Z===void 0&&(_?Z=new Ta:y?Z=new su({size:1,sizeAttenuation:!1}):Z=new UT,Z.name=j.name,Z.flatShading=!j.smooth,Z.vertexColors=T,t.materials[q]=Z),C.push(Z)}let M;if(C.length>1){for(let B=0,k=m.length;B<k;B++){const j=m[B];I.addGroup(j.groupStart,j.groupCount,B)}_?M=new uu(I,C):y?M=new wh(I,C):M=new Ei(I,C)}else _?M=new uu(I,C[0]):y?M=new wh(I,C[0]):M=new Ei(I,C[0]);M.name=h.name,s.add(M)}else if(t.vertices.length>0){const l=new su({size:1,sizeAttenuation:!1}),o=new $r;o.setAttribute("position",new ar(t.vertices,3)),t.colors.length>0&&t.colors[0]!==void 0&&(o.setAttribute("color",new ar(t.colors,3)),l.vertexColors=!0);const h=new wh(o,l);s.add(h)}return s}}const mke=""+new URL("../gltfModels/earth_star/earth.mtl",import.meta.url).href,gke=""+new URL("../gltfModels/earth_star/earth.obj",import.meta.url).href,vke=()=>{let n=null,e=null,t=null,r=null,i,s,a=null,l=0,o=Ae.useRef(null),h=()=>{let m={width:o.current.clientWidth,height:o.current.clientHeight};e=new Qi(70,m.width/m.height,.01,1e3),e.position.set(50,20,200),e.lookAt(0,0,0),n=new Al,n.fog=new fw(1710618,1,1e3),n.background=new Gn(1710618),t=new mx(14609919,3),r=new Zl({canvas:o.current,alpha:!0,antialias:!0}),r.setSize(m.width,m.height);let _=new Ev(e,r.domElement);_.enableDamping=!0;let y=new zT(100,4,2,120),T=new vo({color:4237823,wireframe:!0});a=new Ei(y,T),a.rotation.x=Math.PI/2,a.rotation.y=-.1*(Math.PI/2);let I=new Yy(12,0),C=new VT({color:16776192});s=new Ei(I,C),i=new Wl;for(let k=0;k<500;k++){let j=new Yy(Math.random()*3,0),q=new vo({color:16777215}),Z=new Ei(j,q);Z.position.set((Math.random()-.5)*800,(Math.random()-.5)*800,(Math.random()-.5)*800),Z.rotation.set(Math.random()*2*Math.PI,Math.random()*2*Math.PI,Math.random()*2*Math.PI),i.add(Z)}let M=new ake,B=new pke;M.load(mke,k=>{k.preload(),k.side=bc,B.setMaterials(k),B.load(gke,j=>{j.scale.set(80,80,80),j.children.map((q,Z)=>{const te=q.material.name;q.material=k.materials[te],q.name==="Earth_Sphere"?(q.visible=!0,j.add(new Ei(q.geometry,q.material))):q.material.opacity=.1}),n.add(j)})}),n.add(t),n.add(a),n.add(s),n.add(i),r.render(n,e)},d=()=>{let m=new Ze(0,0,1);l+=Math.random()*.8;let _=Math.PI*l/180;a&&a.rotateOnAxis(m,Math.PI/400),s.position.set(140*Math.cos(_),100*Math.sin(_),80*Math.sin(_)),s.rotation.x+=.01,s.rotation.y+=.01,s.rotation.z-=.01,i.rotation.y+=9e-4,i.rotation.z-=9e-4,requestAnimationFrame(d),r.render(n,e)};return Ae.useEffect(()=>{h(),d()},[]),me.jsx("div",{className:"w-screen h-screen",children:me.jsx("canvas",{ref:o,className:"w-full h-full"})})},_ke=""+new URL("statue-C3oCcb_2.glb",import.meta.url).href,bk=new WeakMap;class f8 extends Ea{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,r,i){const s=new Wa(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,a=>{this.parse(a,t,i)},r,i)}parse(e,t,r=()=>{}){this.decodeDracoFile(e,t,null,null,Ao,r).catch(r)}decodeDracoFile(e,t,r,i,s=Ga,a=()=>{}){const l={attributeIDs:r||this.defaultAttributeIDs,attributeTypes:i||this.defaultAttributeTypes,useUniqueIDs:!!r,vertexColorSpace:s};return this.decodeGeometry(e,l).then(t).catch(a)}decodeGeometry(e,t){const r=JSON.stringify(t);if(bk.has(e)){const o=bk.get(e);if(o.key===r)return o.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let i;const s=this.workerNextTaskID++,a=e.byteLength,l=this._getWorker(s,a).then(o=>(i=o,new Promise((h,d)=>{i._callbacks[s]={resolve:h,reject:d},i.postMessage({type:"decode",id:s,taskConfig:t,buffer:e},[e])}))).then(o=>this._createGeometry(o.geometry));return l.catch(()=>!0).then(()=>{i&&s&&this._releaseTask(i,s)}),bk.set(e,{key:r,promise:l}),l}_createGeometry(e){const t=new $r;e.index&&t.setIndex(new Di(e.index.array,1));for(let r=0;r<e.attributes.length;r++){const i=e.attributes[r],s=i.name,a=i.array,l=i.itemSize,o=new Di(a,l);s==="color"&&(this._assignVertexColorSpace(o,i.vertexColorSpace),o.normalized=!(a instanceof Float32Array)),t.setAttribute(s,o)}return t}_assignVertexColorSpace(e,t){if(t!==Ao)return;const r=new Gn;for(let i=0,s=e.count;i<s;i++)r.fromBufferAttribute(e,i).convertSRGBToLinear(),e.setXYZ(i,r.r,r.g,r.b)}_loadLibrary(e,t){const r=new Wa(this.manager);return r.setPath(this.decoderPath),r.setResponseType(t),r.setWithCredentials(this.withCredentials),new Promise((i,s)=>{r.load(e,i,void 0,s)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(r=>{const i=r[0];e||(this.decoderConfig.wasmBinary=r[1]);const s=yke.toString(),a=["/* draco decoder */",i,"","/* worker */",s.substring(s.indexOf("{")+1,s.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([a]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const i=new Worker(this.workerSourceURL);i._callbacks={},i._taskCosts={},i._taskLoad=0,i.postMessage({type:"init",decoderConfig:this.decoderConfig}),i.onmessage=function(s){const a=s.data;switch(a.type){case"decode":i._callbacks[a.id].resolve(a);break;case"error":i._callbacks[a.id].reject(a);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+a.type+'"')}},this.workerPool.push(i)}else this.workerPool.sort(function(i,s){return i._taskLoad>s._taskLoad?-1:1});const r=this.workerPool[this.workerPool.length-1];return r._taskCosts[e]=t,r._taskLoad+=t,r})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function yke(){let n,e;onmessage=function(a){const l=a.data;switch(l.type){case"init":n=l.decoderConfig,e=new Promise(function(d){n.onModuleLoaded=function(m){d({draco:m})},DracoDecoderModule(n)});break;case"decode":const o=l.buffer,h=l.taskConfig;e.then(d=>{const m=d.draco,_=new m.Decoder;try{const y=t(m,_,new Int8Array(o),h),T=y.attributes.map(I=>I.array.buffer);y.index&&T.push(y.index.array.buffer),self.postMessage({type:"decode",id:l.id,geometry:y},T)}catch(y){console.error(y),self.postMessage({type:"error",id:l.id,error:y.message})}finally{m.destroy(_)}});break}};function t(a,l,o,h){const d=h.attributeIDs,m=h.attributeTypes;let _,y;const T=l.GetEncodedGeometryType(o);if(T===a.TRIANGULAR_MESH)_=new a.Mesh,y=l.DecodeArrayToMesh(o,o.byteLength,_);else if(T===a.POINT_CLOUD)_=new a.PointCloud,y=l.DecodeArrayToPointCloud(o,o.byteLength,_);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!y.ok()||_.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+y.error_msg());const I={index:null,attributes:[]};for(const C in d){const M=self[m[C]];let B,k;if(h.useUniqueIDs)k=d[C],B=l.GetAttributeByUniqueId(_,k);else{if(k=l.GetAttributeId(_,a[d[C]]),k===-1)continue;B=l.GetAttribute(_,k)}const j=i(a,l,_,C,M,B);C==="color"&&(j.vertexColorSpace=h.vertexColorSpace),I.attributes.push(j)}return T===a.TRIANGULAR_MESH&&(I.index=r(a,l,_)),a.destroy(_),I}function r(a,l,o){const d=o.num_faces()*3,m=d*4,_=a._malloc(m);l.GetTrianglesUInt32Array(o,m,_);const y=new Uint32Array(a.HEAPF32.buffer,_,d).slice();return a._free(_),{array:y,itemSize:1}}function i(a,l,o,h,d,m){const _=m.num_components(),T=o.num_points()*_,I=T*d.BYTES_PER_ELEMENT,C=s(a,d),M=a._malloc(I);l.GetAttributeDataArrayForAllPoints(o,m,C,I,M);const B=new d(a.HEAPF32.buffer,M,T).slice();return a._free(M),{name:h,array:B,itemSize:_}}function s(a,l){switch(l){case Float32Array:return a.DT_FLOAT32;case Int8Array:return a.DT_INT8;case Int16Array:return a.DT_INT16;case Int32Array:return a.DT_INT32;case Uint8Array:return a.DT_UINT8;case Uint16Array:return a.DT_UINT16;case Uint32Array:return a.DT_UINT32}}}class GD extends Ea{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new Ake(t)}),this.register(function(t){return new Tke(t)}),this.register(function(t){return new Bke(t)}),this.register(function(t){return new kke(t)}),this.register(function(t){return new Oke(t)}),this.register(function(t){return new Cke(t)}),this.register(function(t){return new Eke(t)}),this.register(function(t){return new Ike(t)}),this.register(function(t){return new Rke(t)}),this.register(function(t){return new Ske(t)}),this.register(function(t){return new Pke(t)}),this.register(function(t){return new Mke(t)}),this.register(function(t){return new Dke(t)}),this.register(function(t){return new Lke(t)}),this.register(function(t){return new bke(t)}),this.register(function(t){return new Fke(t)}),this.register(function(t){return new Nke(t)})}load(e,t,r,i){const s=this;let a;if(this.resourcePath!=="")a=this.resourcePath;else if(this.path!==""){const h=cu.extractUrlBase(e);a=cu.resolveURL(h,this.path)}else a=cu.extractUrlBase(e);this.manager.itemStart(e);const l=function(h){i?i(h):console.error(h),s.manager.itemError(e),s.manager.itemEnd(e)},o=new Wa(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(h){try{s.parse(h,a,function(d){t(d),s.manager.itemEnd(e)},l)}catch(d){l(d)}},r,l)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,r,i){let s;const a={},l={},o=new TextDecoder;if(typeof e=="string")s=JSON.parse(e);else if(e instanceof ArrayBuffer)if(o.decode(new Uint8Array(e,0,4))===zae){try{a[Vi.KHR_BINARY_GLTF]=new zke(e)}catch(m){i&&i(m);return}s=JSON.parse(a[Vi.KHR_BINARY_GLTF].content)}else s=JSON.parse(o.decode(e));else s=e;if(s.asset===void 0||s.asset.version[0]<2){i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const h=new Jke(s,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});h.fileLoader.setRequestHeader(this.requestHeader);for(let d=0;d<this.pluginCallbacks.length;d++){const m=this.pluginCallbacks[d](h);m.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),l[m.name]=m,a[m.name]=!0}if(s.extensionsUsed)for(let d=0;d<s.extensionsUsed.length;++d){const m=s.extensionsUsed[d],_=s.extensionsRequired||[];switch(m){case Vi.KHR_MATERIALS_UNLIT:a[m]=new wke;break;case Vi.KHR_DRACO_MESH_COMPRESSION:a[m]=new Uke(s,this.dracoLoader);break;case Vi.KHR_TEXTURE_TRANSFORM:a[m]=new Vke;break;case Vi.KHR_MESH_QUANTIZATION:a[m]=new Gke;break;default:_.indexOf(m)>=0&&l[m]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+m+'".')}}h.setExtensions(a),h.setPlugins(l),h.parse(r,i)}parseAsync(e,t){const r=this;return new Promise(function(i,s){r.parse(e,t,i,s)})}}function xke(){let n={};return{get:function(e){return n[e]},add:function(e,t){n[e]=t},remove:function(e){delete n[e]},removeAll:function(){n={}}}}const Vi={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class bke{constructor(e){this.parser=e,this.name=Vi.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let r=0,i=t.length;r<i;r++){const s=t[r];s.extensions&&s.extensions[this.name]&&s.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(e){const t=this.parser,r="light:"+e;let i=t.cache.get(r);if(i)return i;const s=t.json,o=((s.extensions&&s.extensions[this.name]||{}).lights||[])[e];let h;const d=new Gn(16777215);o.color!==void 0&&d.setRGB(o.color[0],o.color[1],o.color[2],Ga);const m=o.range!==void 0?o.range:0;switch(o.type){case"directional":h=new Cv(d),h.target.position.set(0,0,-1),h.add(h.target);break;case"point":h=new ev(d),h.distance=m;break;case"spot":h=new QL(d),h.distance=m,o.spot=o.spot||{},o.spot.innerConeAngle=o.spot.innerConeAngle!==void 0?o.spot.innerConeAngle:0,o.spot.outerConeAngle=o.spot.outerConeAngle!==void 0?o.spot.outerConeAngle:Math.PI/4,h.angle=o.spot.outerConeAngle,h.penumbra=1-o.spot.innerConeAngle/o.spot.outerConeAngle,h.target.position.set(0,0,-1),h.add(h.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+o.type)}return h.position.set(0,0,0),h.decay=2,vm(h,o),o.intensity!==void 0&&(h.intensity=o.intensity),h.name=t.createUniqueName(o.name||"light_"+e),i=Promise.resolve(h),t.cache.add(r,i),i}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,r=this.parser,s=r.json.nodes[e],l=(s.extensions&&s.extensions[this.name]||{}).light;return l===void 0?null:this._loadLight(l).then(function(o){return r._getNodeRef(t.cache,l,o)})}}class wke{constructor(){this.name=Vi.KHR_MATERIALS_UNLIT}getMaterialType(){return vo}extendParams(e,t,r){const i=[];e.color=new Gn(1,1,1),e.opacity=1;const s=t.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const a=s.baseColorFactor;e.color.setRGB(a[0],a[1],a[2],Ga),e.opacity=a[3]}s.baseColorTexture!==void 0&&i.push(r.assignTexture(e,"map",s.baseColorTexture,Ao))}return Promise.all(i)}}class Ske{constructor(e){this.parser=e,this.name=Vi.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name].emissiveStrength;return s!==void 0&&(t.emissiveIntensity=s),Promise.resolve()}}class Ake{constructor(e){this.parser=e,this.name=Vi.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:jo}extendMaterialParams(e,t){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],a=i.extensions[this.name];if(a.clearcoatFactor!==void 0&&(t.clearcoat=a.clearcoatFactor),a.clearcoatTexture!==void 0&&s.push(r.assignTexture(t,"clearcoatMap",a.clearcoatTexture)),a.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=a.clearcoatRoughnessFactor),a.clearcoatRoughnessTexture!==void 0&&s.push(r.assignTexture(t,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),a.clearcoatNormalTexture!==void 0&&(s.push(r.assignTexture(t,"clearcoatNormalMap",a.clearcoatNormalTexture)),a.clearcoatNormalTexture.scale!==void 0)){const l=a.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new nn(l,l)}return Promise.all(s)}}class Tke{constructor(e){this.parser=e,this.name=Vi.KHR_MATERIALS_DISPERSION}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:jo}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name];return t.dispersion=s.dispersion!==void 0?s.dispersion:0,Promise.resolve()}}class Mke{constructor(e){this.parser=e,this.name=Vi.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:jo}extendMaterialParams(e,t){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],a=i.extensions[this.name];return a.iridescenceFactor!==void 0&&(t.iridescence=a.iridescenceFactor),a.iridescenceTexture!==void 0&&s.push(r.assignTexture(t,"iridescenceMap",a.iridescenceTexture)),a.iridescenceIor!==void 0&&(t.iridescenceIOR=a.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),a.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=a.iridescenceThicknessMinimum),a.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=a.iridescenceThicknessMaximum),a.iridescenceThicknessTexture!==void 0&&s.push(r.assignTexture(t,"iridescenceThicknessMap",a.iridescenceThicknessTexture)),Promise.all(s)}}class Cke{constructor(e){this.parser=e,this.name=Vi.KHR_MATERIALS_SHEEN}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:jo}extendMaterialParams(e,t){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[];t.sheenColor=new Gn(0,0,0),t.sheenRoughness=0,t.sheen=1;const a=i.extensions[this.name];if(a.sheenColorFactor!==void 0){const l=a.sheenColorFactor;t.sheenColor.setRGB(l[0],l[1],l[2],Ga)}return a.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=a.sheenRoughnessFactor),a.sheenColorTexture!==void 0&&s.push(r.assignTexture(t,"sheenColorMap",a.sheenColorTexture,Ao)),a.sheenRoughnessTexture!==void 0&&s.push(r.assignTexture(t,"sheenRoughnessMap",a.sheenRoughnessTexture)),Promise.all(s)}}class Eke{constructor(e){this.parser=e,this.name=Vi.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:jo}extendMaterialParams(e,t){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],a=i.extensions[this.name];return a.transmissionFactor!==void 0&&(t.transmission=a.transmissionFactor),a.transmissionTexture!==void 0&&s.push(r.assignTexture(t,"transmissionMap",a.transmissionTexture)),Promise.all(s)}}class Ike{constructor(e){this.parser=e,this.name=Vi.KHR_MATERIALS_VOLUME}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:jo}extendMaterialParams(e,t){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],a=i.extensions[this.name];t.thickness=a.thicknessFactor!==void 0?a.thicknessFactor:0,a.thicknessTexture!==void 0&&s.push(r.assignTexture(t,"thicknessMap",a.thicknessTexture)),t.attenuationDistance=a.attenuationDistance||1/0;const l=a.attenuationColor||[1,1,1];return t.attenuationColor=new Gn().setRGB(l[0],l[1],l[2],Ga),Promise.all(s)}}class Rke{constructor(e){this.parser=e,this.name=Vi.KHR_MATERIALS_IOR}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:jo}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name];return t.ior=s.ior!==void 0?s.ior:1.5,Promise.resolve()}}class Pke{constructor(e){this.parser=e,this.name=Vi.KHR_MATERIALS_SPECULAR}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:jo}extendMaterialParams(e,t){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],a=i.extensions[this.name];t.specularIntensity=a.specularFactor!==void 0?a.specularFactor:1,a.specularTexture!==void 0&&s.push(r.assignTexture(t,"specularIntensityMap",a.specularTexture));const l=a.specularColorFactor||[1,1,1];return t.specularColor=new Gn().setRGB(l[0],l[1],l[2],Ga),a.specularColorTexture!==void 0&&s.push(r.assignTexture(t,"specularColorMap",a.specularColorTexture,Ao)),Promise.all(s)}}class Lke{constructor(e){this.parser=e,this.name=Vi.EXT_MATERIALS_BUMP}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:jo}extendMaterialParams(e,t){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],a=i.extensions[this.name];return t.bumpScale=a.bumpFactor!==void 0?a.bumpFactor:1,a.bumpTexture!==void 0&&s.push(r.assignTexture(t,"bumpMap",a.bumpTexture)),Promise.all(s)}}class Dke{constructor(e){this.parser=e,this.name=Vi.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:jo}extendMaterialParams(e,t){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],a=i.extensions[this.name];return a.anisotropyStrength!==void 0&&(t.anisotropy=a.anisotropyStrength),a.anisotropyRotation!==void 0&&(t.anisotropyRotation=a.anisotropyRotation),a.anisotropyTexture!==void 0&&s.push(r.assignTexture(t,"anisotropyMap",a.anisotropyTexture)),Promise.all(s)}}class Bke{constructor(e){this.parser=e,this.name=Vi.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,r=t.json,i=r.textures[e];if(!i.extensions||!i.extensions[this.name])return null;const s=i.extensions[this.name],a=t.options.ktx2Loader;if(!a){if(r.extensionsRequired&&r.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,s.source,a)}}class kke{constructor(e){this.parser=e,this.name=Vi.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,r=this.parser,i=r.json,s=i.textures[e];if(!s.extensions||!s.extensions[t])return null;const a=s.extensions[t],l=i.images[a.source];let o=r.textureLoader;if(l.uri){const h=r.options.manager.getHandler(l.uri);h!==null&&(o=h)}return this.detectSupport().then(function(h){if(h)return r.loadTextureImage(e,a.source,o);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return r.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class Oke{constructor(e){this.parser=e,this.name=Vi.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,r=this.parser,i=r.json,s=i.textures[e];if(!s.extensions||!s.extensions[t])return null;const a=s.extensions[t],l=i.images[a.source];let o=r.textureLoader;if(l.uri){const h=r.options.manager.getHandler(l.uri);h!==null&&(o=h)}return this.detectSupport().then(function(h){if(h)return r.loadTextureImage(e,a.source,o);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return r.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class Fke{constructor(e){this.name=Vi.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,r=t.bufferViews[e];if(r.extensions&&r.extensions[this.name]){const i=r.extensions[this.name],s=this.parser.getDependency("buffer",i.buffer),a=this.parser.options.meshoptDecoder;if(!a||!a.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return s.then(function(l){const o=i.byteOffset||0,h=i.byteLength||0,d=i.count,m=i.byteStride,_=new Uint8Array(l,o,h);return a.decodeGltfBufferAsync?a.decodeGltfBufferAsync(d,m,_,i.mode,i.filter).then(function(y){return y.buffer}):a.ready.then(function(){const y=new ArrayBuffer(d*m);return a.decodeGltfBuffer(new Uint8Array(y),d,m,_,i.mode,i.filter),y})})}else return null}}class Nke{constructor(e){this.name=Vi.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,r=t.nodes[e];if(!r.extensions||!r.extensions[this.name]||r.mesh===void 0)return null;const i=t.meshes[r.mesh];for(const h of i.primitives)if(h.mode!==dh.TRIANGLES&&h.mode!==dh.TRIANGLE_STRIP&&h.mode!==dh.TRIANGLE_FAN&&h.mode!==void 0)return null;const a=r.extensions[this.name].attributes,l=[],o={};for(const h in a)l.push(this.parser.getDependency("accessor",a[h]).then(d=>(o[h]=d,o[h])));return l.length<1?null:(l.push(this.parser.createNodeMesh(e)),Promise.all(l).then(h=>{const d=h.pop(),m=d.isGroup?d.children:[d],_=h[0].count,y=[];for(const T of m){const I=new Vr,C=new Ze,M=new Aa,B=new Ze(1,1,1),k=new NL(T.geometry,T.material,_);for(let j=0;j<_;j++)o.TRANSLATION&&C.fromBufferAttribute(o.TRANSLATION,j),o.ROTATION&&M.fromBufferAttribute(o.ROTATION,j),o.SCALE&&B.fromBufferAttribute(o.SCALE,j),k.setMatrixAt(j,I.compose(C,M,B));for(const j in o)if(j==="_COLOR_0"){const q=o[j];k.instanceColor=new cv(q.array,q.itemSize,q.normalized)}else j!=="TRANSLATION"&&j!=="ROTATION"&&j!=="SCALE"&&T.geometry.setAttribute(j,o[j]);Ii.prototype.copy.call(k,T),this.parser.assignFinalMaterial(k),y.push(k)}return d.isGroup?(d.clear(),d.add(...y),d):y[0]}))}}const zae="glTF",nS=12,RY={JSON:1313821514,BIN:5130562};class zke{constructor(e){this.name=Vi.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,nS),r=new TextDecoder;if(this.header={magic:r.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==zae)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const i=this.header.length-nS,s=new DataView(e,nS);let a=0;for(;a<i;){const l=s.getUint32(a,!0);a+=4;const o=s.getUint32(a,!0);if(a+=4,o===RY.JSON){const h=new Uint8Array(e,nS+a,l);this.content=r.decode(h)}else if(o===RY.BIN){const h=nS+a;this.body=e.slice(h,h+l)}a+=l}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Uke{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Vi.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const r=this.json,i=this.dracoLoader,s=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,l={},o={},h={};for(const d in a){const m=BN[d]||d.toLowerCase();l[m]=a[d]}for(const d in e.attributes){const m=BN[d]||d.toLowerCase();if(a[d]!==void 0){const _=r.accessors[e.attributes[d]],y=kb[_.componentType];h[m]=y.name,o[m]=_.normalized===!0}}return t.getDependency("bufferView",s).then(function(d){return new Promise(function(m,_){i.decodeDracoFile(d,function(y){for(const T in y.attributes){const I=y.attributes[T],C=o[T];C!==void 0&&(I.normalized=C)}m(y)},l,h,Ga,_)})})}}class Vke{constructor(){this.name=Vi.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class Gke{constructor(){this.name=Vi.KHR_MESH_QUANTIZATION}}class Uae extends fx{constructor(e,t,r,i){super(e,t,r,i)}copySampleValue_(e){const t=this.resultBuffer,r=this.sampleValues,i=this.valueSize,s=e*i*3+i;for(let a=0;a!==i;a++)t[a]=r[s+a];return t}interpolate_(e,t,r,i){const s=this.resultBuffer,a=this.sampleValues,l=this.valueSize,o=l*2,h=l*3,d=i-t,m=(r-t)/d,_=m*m,y=_*m,T=e*h,I=T-h,C=-2*y+3*_,M=y-_,B=1-C,k=M-_+m;for(let j=0;j!==l;j++){const q=a[I+j+l],Z=a[I+j+o]*d,te=a[T+j+l],ie=a[T+j]*d;s[j]=B*q+k*Z+C*te+M*ie}return s}}const Hke=new Aa;class jke extends Uae{interpolate_(e,t,r,i){const s=super.interpolate_(e,t,r,i);return Hke.fromArray(s).normalize().toArray(s),s}}const dh={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},kb={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},PY={9728:wa,9729:Co,9984:CT,9985:Ey,9986:z0,9987:iu},LY={33071:ru,33648:jy,10497:Ph},wk={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},BN={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},w0={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Wke={CUBICSPLINE:void 0,LINEAR:lv,STEP:$y},Sk={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Xke(n){return n.DefaultMaterial===void 0&&(n.DefaultMaterial=new cp({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Rh})),n.DefaultMaterial}function K_(n,e,t){for(const r in t.extensions)n[r]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[r]=t.extensions[r])}function vm(n,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(n.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function $ke(n,e,t){let r=!1,i=!1,s=!1;for(let h=0,d=e.length;h<d;h++){const m=e[h];if(m.POSITION!==void 0&&(r=!0),m.NORMAL!==void 0&&(i=!0),m.COLOR_0!==void 0&&(s=!0),r&&i&&s)break}if(!r&&!i&&!s)return Promise.resolve(n);const a=[],l=[],o=[];for(let h=0,d=e.length;h<d;h++){const m=e[h];if(r){const _=m.POSITION!==void 0?t.getDependency("accessor",m.POSITION):n.attributes.position;a.push(_)}if(i){const _=m.NORMAL!==void 0?t.getDependency("accessor",m.NORMAL):n.attributes.normal;l.push(_)}if(s){const _=m.COLOR_0!==void 0?t.getDependency("accessor",m.COLOR_0):n.attributes.color;o.push(_)}}return Promise.all([Promise.all(a),Promise.all(l),Promise.all(o)]).then(function(h){const d=h[0],m=h[1],_=h[2];return r&&(n.morphAttributes.position=d),i&&(n.morphAttributes.normal=m),s&&(n.morphAttributes.color=_),n.morphTargetsRelative=!0,n})}function qke(n,e){if(n.updateMorphTargets(),e.weights!==void 0)for(let t=0,r=e.weights.length;t<r;t++)n.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(n.morphTargetInfluences.length===t.length){n.morphTargetDictionary={};for(let r=0,i=t.length;r<i;r++)n.morphTargetDictionary[t[r]]=r}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Zke(n){let e;const t=n.extensions&&n.extensions[Vi.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+Ak(t.attributes):e=n.indices+":"+Ak(n.attributes)+":"+n.mode,n.targets!==void 0)for(let r=0,i=n.targets.length;r<i;r++)e+=":"+Ak(n.targets[r]);return e}function Ak(n){let e="";const t=Object.keys(n).sort();for(let r=0,i=t.length;r<i;r++)e+=t[r]+":"+n[t[r]]+";";return e}function kN(n){switch(n){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function Yke(n){return n.search(/\.jpe?g($|\?)/i)>0||n.search(/^data\:image\/jpeg/)===0?"image/jpeg":n.search(/\.webp($|\?)/i)>0||n.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const Kke=new Vr;class Jke{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new xke,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let r=!1,i=-1,s=!1,a=-1;if(typeof navigator<"u"){const l=navigator.userAgent;r=/^((?!chrome|android).)*safari/i.test(l)===!0;const o=l.match(/Version\/(\d+)/);i=r&&o?parseInt(o[1],10):-1,s=l.indexOf("Firefox")>-1,a=s?l.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||r&&i<17||s&&a<98?this.textureLoader=new qf(this.options.manager):this.textureLoader=new D6(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Wa(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const r=this,i=this.json,s=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(a){return a._markDefs&&a._markDefs()}),Promise.all(this._invokeAll(function(a){return a.beforeRoot&&a.beforeRoot()})).then(function(){return Promise.all([r.getDependencies("scene"),r.getDependencies("animation"),r.getDependencies("camera")])}).then(function(a){const l={scene:a[0][i.scene||0],scenes:a[0],animations:a[1],cameras:a[2],asset:i.asset,parser:r,userData:{}};return K_(s,l,i),vm(l,i),Promise.all(r._invokeAll(function(o){return o.afterRoot&&o.afterRoot(l)})).then(function(){for(const o of l.scenes)o.updateMatrixWorld();e(l)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],r=this.json.meshes||[];for(let i=0,s=t.length;i<s;i++){const a=t[i].joints;for(let l=0,o=a.length;l<o;l++)e[a[l]].isBone=!0}for(let i=0,s=e.length;i<s;i++){const a=e[i];a.mesh!==void 0&&(this._addNodeRef(this.meshCache,a.mesh),a.skin!==void 0&&(r[a.mesh].isSkinnedMesh=!0)),a.camera!==void 0&&this._addNodeRef(this.cameraCache,a.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,r){if(e.refs[t]<=1)return r;const i=r.clone(),s=(a,l)=>{const o=this.associations.get(a);o!=null&&this.associations.set(l,o);for(const[h,d]of a.children.entries())s(d,l.children[h])};return s(r,i),i.name+="_instance_"+e.uses[t]++,i}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let r=0;r<t.length;r++){const i=e(t[r]);if(i)return i}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const r=[];for(let i=0;i<t.length;i++){const s=e(t[i]);s&&r.push(s)}return r}getDependency(e,t){const r=e+":"+t;let i=this.cache.get(r);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this._invokeOne(function(s){return s.loadNode&&s.loadNode(t)});break;case"mesh":i=this._invokeOne(function(s){return s.loadMesh&&s.loadMesh(t)});break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this._invokeOne(function(s){return s.loadBufferView&&s.loadBufferView(t)});break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this._invokeOne(function(s){return s.loadMaterial&&s.loadMaterial(t)});break;case"texture":i=this._invokeOne(function(s){return s.loadTexture&&s.loadTexture(t)});break;case"skin":i=this.loadSkin(t);break;case"animation":i=this._invokeOne(function(s){return s.loadAnimation&&s.loadAnimation(t)});break;case"camera":i=this.loadCamera(t);break;default:if(i=this._invokeOne(function(s){return s!=this&&s.getDependency&&s.getDependency(e,t)}),!i)throw new Error("Unknown type: "+e);break}this.cache.add(r,i)}return i}getDependencies(e){let t=this.cache.get(e);if(!t){const r=this,i=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(i.map(function(s,a){return r.getDependency(e,a)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],r=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[Vi.KHR_BINARY_GLTF].body);const i=this.options;return new Promise(function(s,a){r.load(cu.resolveURL(t.uri,i.path),s,void 0,function(){a(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(r){const i=t.byteLength||0,s=t.byteOffset||0;return r.slice(s,s+i)})}loadAccessor(e){const t=this,r=this.json,i=this.json.accessors[e];if(i.bufferView===void 0&&i.sparse===void 0){const a=wk[i.type],l=kb[i.componentType],o=i.normalized===!0,h=new l(i.count*a);return Promise.resolve(new Di(h,a,o))}const s=[];return i.bufferView!==void 0?s.push(this.getDependency("bufferView",i.bufferView)):s.push(null),i.sparse!==void 0&&(s.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(s).then(function(a){const l=a[0],o=wk[i.type],h=kb[i.componentType],d=h.BYTES_PER_ELEMENT,m=d*o,_=i.byteOffset||0,y=i.bufferView!==void 0?r.bufferViews[i.bufferView].byteStride:void 0,T=i.normalized===!0;let I,C;if(y&&y!==m){const M=Math.floor(_/y),B="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+M+":"+i.count;let k=t.cache.get(B);k||(I=new h(l,M*y,i.count*y/d),k=new dw(I,y/d),t.cache.add(B,k)),C=new Hm(k,o,_%y/d,T)}else l===null?I=new h(i.count*o):I=new h(l,_,i.count*o),C=new Di(I,o,T);if(i.sparse!==void 0){const M=wk.SCALAR,B=kb[i.sparse.indices.componentType],k=i.sparse.indices.byteOffset||0,j=i.sparse.values.byteOffset||0,q=new B(a[1],k,i.sparse.count*M),Z=new h(a[2],j,i.sparse.count*o);l!==null&&(C=new Di(C.array.slice(),C.itemSize,C.normalized));for(let te=0,ie=q.length;te<ie;te++){const se=q[te];if(C.setX(se,Z[te*o]),o>=2&&C.setY(se,Z[te*o+1]),o>=3&&C.setZ(se,Z[te*o+2]),o>=4&&C.setW(se,Z[te*o+3]),o>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return C})}loadTexture(e){const t=this.json,r=this.options,s=t.textures[e].source,a=t.images[s];let l=this.textureLoader;if(a.uri){const o=r.manager.getHandler(a.uri);o!==null&&(l=o)}return this.loadTextureImage(e,s,l)}loadTextureImage(e,t,r){const i=this,s=this.json,a=s.textures[e],l=s.images[t],o=(l.uri||l.bufferView)+":"+a.sampler;if(this.textureCache[o])return this.textureCache[o];const h=this.loadImageSource(t,r).then(function(d){d.flipY=!1,d.name=a.name||l.name||"",d.name===""&&typeof l.uri=="string"&&l.uri.startsWith("data:image/")===!1&&(d.name=l.uri);const _=(s.samplers||{})[a.sampler]||{};return d.magFilter=PY[_.magFilter]||Co,d.minFilter=PY[_.minFilter]||iu,d.wrapS=LY[_.wrapS]||Ph,d.wrapT=LY[_.wrapT]||Ph,i.associations.set(d,{textures:e}),d}).catch(function(){return null});return this.textureCache[o]=h,h}loadImageSource(e,t){const r=this,i=this.json,s=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(m=>m.clone());const a=i.images[e],l=self.URL||self.webkitURL;let o=a.uri||"",h=!1;if(a.bufferView!==void 0)o=r.getDependency("bufferView",a.bufferView).then(function(m){h=!0;const _=new Blob([m],{type:a.mimeType});return o=l.createObjectURL(_),o});else if(a.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const d=Promise.resolve(o).then(function(m){return new Promise(function(_,y){let T=_;t.isImageBitmapLoader===!0&&(T=function(I){const C=new Ws(I);C.needsUpdate=!0,_(C)}),t.load(cu.resolveURL(m,s.path),T,void 0,y)})}).then(function(m){return h===!0&&l.revokeObjectURL(o),vm(m,a),m.userData.mimeType=a.mimeType||Yke(a.uri),m}).catch(function(m){throw console.error("THREE.GLTFLoader: Couldn't load texture",o),m});return this.sourceCache[e]=d,d}assignTexture(e,t,r,i){const s=this;return this.getDependency("texture",r.index).then(function(a){if(!a)return null;if(r.texCoord!==void 0&&r.texCoord>0&&(a=a.clone(),a.channel=r.texCoord),s.extensions[Vi.KHR_TEXTURE_TRANSFORM]){const l=r.extensions!==void 0?r.extensions[Vi.KHR_TEXTURE_TRANSFORM]:void 0;if(l){const o=s.associations.get(a);a=s.extensions[Vi.KHR_TEXTURE_TRANSFORM].extendTexture(a,l),s.associations.set(a,o)}}return i!==void 0&&(a.colorSpace=i),e[t]=a,a})}assignFinalMaterial(e){const t=e.geometry;let r=e.material;const i=t.attributes.tangent===void 0,s=t.attributes.color!==void 0,a=t.attributes.normal===void 0;if(e.isPoints){const l="PointsMaterial:"+r.uuid;let o=this.cache.get(l);o||(o=new su,_o.prototype.copy.call(o,r),o.color.copy(r.color),o.map=r.map,o.sizeAttenuation=!1,this.cache.add(l,o)),r=o}else if(e.isLine){const l="LineBasicMaterial:"+r.uuid;let o=this.cache.get(l);o||(o=new Ta,_o.prototype.copy.call(o,r),o.color.copy(r.color),o.map=r.map,this.cache.add(l,o)),r=o}if(i||s||a){let l="ClonedMaterial:"+r.uuid+":";i&&(l+="derivative-tangents:"),s&&(l+="vertex-colors:"),a&&(l+="flat-shading:");let o=this.cache.get(l);o||(o=r.clone(),s&&(o.vertexColors=!0),a&&(o.flatShading=!0),i&&(o.normalScale&&(o.normalScale.y*=-1),o.clearcoatNormalScale&&(o.clearcoatNormalScale.y*=-1)),this.cache.add(l,o),this.associations.set(o,this.associations.get(r))),r=o}e.material=r}getMaterialType(){return cp}loadMaterial(e){const t=this,r=this.json,i=this.extensions,s=r.materials[e];let a;const l={},o=s.extensions||{},h=[];if(o[Vi.KHR_MATERIALS_UNLIT]){const m=i[Vi.KHR_MATERIALS_UNLIT];a=m.getMaterialType(),h.push(m.extendParams(l,s,t))}else{const m=s.pbrMetallicRoughness||{};if(l.color=new Gn(1,1,1),l.opacity=1,Array.isArray(m.baseColorFactor)){const _=m.baseColorFactor;l.color.setRGB(_[0],_[1],_[2],Ga),l.opacity=_[3]}m.baseColorTexture!==void 0&&h.push(t.assignTexture(l,"map",m.baseColorTexture,Ao)),l.metalness=m.metallicFactor!==void 0?m.metallicFactor:1,l.roughness=m.roughnessFactor!==void 0?m.roughnessFactor:1,m.metallicRoughnessTexture!==void 0&&(h.push(t.assignTexture(l,"metalnessMap",m.metallicRoughnessTexture)),h.push(t.assignTexture(l,"roughnessMap",m.metallicRoughnessTexture))),a=this._invokeOne(function(_){return _.getMaterialType&&_.getMaterialType(e)}),h.push(Promise.all(this._invokeAll(function(_){return _.extendMaterialParams&&_.extendMaterialParams(e,l)})))}s.doubleSided===!0&&(l.side=bc);const d=s.alphaMode||Sk.OPAQUE;if(d===Sk.BLEND?(l.transparent=!0,l.depthWrite=!1):(l.transparent=!1,d===Sk.MASK&&(l.alphaTest=s.alphaCutoff!==void 0?s.alphaCutoff:.5)),s.normalTexture!==void 0&&a!==vo&&(h.push(t.assignTexture(l,"normalMap",s.normalTexture)),l.normalScale=new nn(1,1),s.normalTexture.scale!==void 0)){const m=s.normalTexture.scale;l.normalScale.set(m,m)}if(s.occlusionTexture!==void 0&&a!==vo&&(h.push(t.assignTexture(l,"aoMap",s.occlusionTexture)),s.occlusionTexture.strength!==void 0&&(l.aoMapIntensity=s.occlusionTexture.strength)),s.emissiveFactor!==void 0&&a!==vo){const m=s.emissiveFactor;l.emissive=new Gn().setRGB(m[0],m[1],m[2],Ga)}return s.emissiveTexture!==void 0&&a!==vo&&h.push(t.assignTexture(l,"emissiveMap",s.emissiveTexture,Ao)),Promise.all(h).then(function(){const m=new a(l);return s.name&&(m.name=s.name),vm(m,s),t.associations.set(m,{materials:e}),s.extensions&&K_(i,m,s),m})}createUniqueName(e){const t=Ji.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,r=this.extensions,i=this.primitiveCache;function s(l){return r[Vi.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(l,t).then(function(o){return DY(o,l,t)})}const a=[];for(let l=0,o=e.length;l<o;l++){const h=e[l],d=Zke(h),m=i[d];if(m)a.push(m.promise);else{let _;h.extensions&&h.extensions[Vi.KHR_DRACO_MESH_COMPRESSION]?_=s(h):_=DY(new $r,h,t),i[d]={primitive:h,promise:_},a.push(_)}}return Promise.all(a)}loadMesh(e){const t=this,r=this.json,i=this.extensions,s=r.meshes[e],a=s.primitives,l=[];for(let o=0,h=a.length;o<h;o++){const d=a[o].material===void 0?Xke(this.cache):this.getDependency("material",a[o].material);l.push(d)}return l.push(t.loadGeometries(a)),Promise.all(l).then(function(o){const h=o.slice(0,o.length-1),d=o[o.length-1],m=[];for(let y=0,T=d.length;y<T;y++){const I=d[y],C=a[y];let M;const B=h[y];if(C.mode===dh.TRIANGLES||C.mode===dh.TRIANGLE_STRIP||C.mode===dh.TRIANGLE_FAN||C.mode===void 0)M=s.isSkinnedMesh===!0?new FL(I,B):new Ei(I,B),M.isSkinnedMesh===!0&&M.normalizeSkinWeights(),C.mode===dh.TRIANGLE_STRIP?M.geometry=nX(M.geometry,RT):C.mode===dh.TRIANGLE_FAN&&(M.geometry=nX(M.geometry,qy));else if(C.mode===dh.LINES)M=new uu(I,B);else if(C.mode===dh.LINE_STRIP)M=new $f(I,B);else if(C.mode===dh.LINE_LOOP)M=new zL(I,B);else if(C.mode===dh.POINTS)M=new wh(I,B);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+C.mode);Object.keys(M.geometry.morphAttributes).length>0&&qke(M,s),M.name=t.createUniqueName(s.name||"mesh_"+e),vm(M,s),C.extensions&&K_(i,M,C),t.assignFinalMaterial(M),m.push(M)}for(let y=0,T=m.length;y<T;y++)t.associations.set(m[y],{meshes:e,primitives:y});if(m.length===1)return s.extensions&&K_(i,m[0],s),m[0];const _=new Wl;s.extensions&&K_(i,_,s),t.associations.set(_,{meshes:e});for(let y=0,T=m.length;y<T;y++)_.add(m[y]);return _})}loadCamera(e){let t;const r=this.json.cameras[e],i=r[r.type];if(!i){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return r.type==="perspective"?t=new Qi(to.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):r.type==="orthographic"&&(t=new Kf(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),r.name&&(t.name=this.createUniqueName(r.name)),vm(t,r),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],r=[];for(let i=0,s=t.joints.length;i<s;i++)r.push(this._loadNodeShallow(t.joints[i]));return t.inverseBindMatrices!==void 0?r.push(this.getDependency("accessor",t.inverseBindMatrices)):r.push(null),Promise.all(r).then(function(i){const s=i.pop(),a=i,l=[],o=[];for(let h=0,d=a.length;h<d;h++){const m=a[h];if(m){l.push(m);const _=new Vr;s!==null&&_.fromArray(s.array,h*16),o.push(_)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[h])}return new pw(l,o)})}loadAnimation(e){const t=this.json,r=this,i=t.animations[e],s=i.name?i.name:"animation_"+e,a=[],l=[],o=[],h=[],d=[];for(let m=0,_=i.channels.length;m<_;m++){const y=i.channels[m],T=i.samplers[y.sampler],I=y.target,C=I.node,M=i.parameters!==void 0?i.parameters[T.input]:T.input,B=i.parameters!==void 0?i.parameters[T.output]:T.output;I.node!==void 0&&(a.push(this.getDependency("node",C)),l.push(this.getDependency("accessor",M)),o.push(this.getDependency("accessor",B)),h.push(T),d.push(I))}return Promise.all([Promise.all(a),Promise.all(l),Promise.all(o),Promise.all(h),Promise.all(d)]).then(function(m){const _=m[0],y=m[1],T=m[2],I=m[3],C=m[4],M=[];for(let B=0,k=_.length;B<k;B++){const j=_[B],q=y[B],Z=T[B],te=I[B],ie=C[B];if(j===void 0)continue;j.updateMatrix&&j.updateMatrix();const se=r._createAnimationTracks(j,q,Z,te,ie);if(se)for(let ae=0;ae<se.length;ae++)M.push(se[ae])}return new Ky(s,void 0,M)})}createNodeMesh(e){const t=this.json,r=this,i=t.nodes[e];return i.mesh===void 0?null:r.getDependency("mesh",i.mesh).then(function(s){const a=r._getNodeRef(r.meshCache,i.mesh,s);return i.weights!==void 0&&a.traverse(function(l){if(l.isMesh)for(let o=0,h=i.weights.length;o<h;o++)l.morphTargetInfluences[o]=i.weights[o]}),a})}loadNode(e){const t=this.json,r=this,i=t.nodes[e],s=r._loadNodeShallow(e),a=[],l=i.children||[];for(let h=0,d=l.length;h<d;h++)a.push(r.getDependency("node",l[h]));const o=i.skin===void 0?Promise.resolve(null):r.getDependency("skin",i.skin);return Promise.all([s,Promise.all(a),o]).then(function(h){const d=h[0],m=h[1],_=h[2];_!==null&&d.traverse(function(y){y.isSkinnedMesh&&y.bind(_,Kke)});for(let y=0,T=m.length;y<T;y++)d.add(m[y]);return d})}_loadNodeShallow(e){const t=this.json,r=this.extensions,i=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const s=t.nodes[e],a=s.name?i.createUniqueName(s.name):"",l=[],o=i._invokeOne(function(h){return h.createNodeMesh&&h.createNodeMesh(e)});return o&&l.push(o),s.camera!==void 0&&l.push(i.getDependency("camera",s.camera).then(function(h){return i._getNodeRef(i.cameraCache,s.camera,h)})),i._invokeAll(function(h){return h.createNodeAttachment&&h.createNodeAttachment(e)}).forEach(function(h){l.push(h)}),this.nodeCache[e]=Promise.all(l).then(function(h){let d;if(s.isBone===!0?d=new OT:h.length>1?d=new Wl:h.length===1?d=h[0]:d=new Ii,d!==h[0])for(let m=0,_=h.length;m<_;m++)d.add(h[m]);if(s.name&&(d.userData.name=s.name,d.name=a),vm(d,s),s.extensions&&K_(r,d,s),s.matrix!==void 0){const m=new Vr;m.fromArray(s.matrix),d.applyMatrix4(m)}else s.translation!==void 0&&d.position.fromArray(s.translation),s.rotation!==void 0&&d.quaternion.fromArray(s.rotation),s.scale!==void 0&&d.scale.fromArray(s.scale);return i.associations.has(d)||i.associations.set(d,{}),i.associations.get(d).nodes=e,d}),this.nodeCache[e]}loadScene(e){const t=this.extensions,r=this.json.scenes[e],i=this,s=new Wl;r.name&&(s.name=i.createUniqueName(r.name)),vm(s,r),r.extensions&&K_(t,s,r);const a=r.nodes||[],l=[];for(let o=0,h=a.length;o<h;o++)l.push(i.getDependency("node",a[o]));return Promise.all(l).then(function(o){for(let d=0,m=o.length;d<m;d++)s.add(o[d]);const h=d=>{const m=new Map;for(const[_,y]of i.associations)(_ instanceof _o||_ instanceof Ws)&&m.set(_,y);return d.traverse(_=>{const y=i.associations.get(_);y!=null&&m.set(_,y)}),m};return i.associations=h(s),s})}_createAnimationTracks(e,t,r,i,s){const a=[],l=e.name?e.name:e.uuid,o=[];w0[s.path]===w0.weights?e.traverse(function(_){_.morphTargetInfluences&&o.push(_.name?_.name:_.uuid)}):o.push(l);let h;switch(w0[s.path]){case w0.weights:h=jm;break;case w0.rotation:h=Wm;break;case w0.position:case w0.scale:h=Xm;break;default:switch(r.itemSize){case 1:h=jm;break;case 2:case 3:default:h=Xm;break}break}const d=i.interpolation!==void 0?Wke[i.interpolation]:lv,m=this._getArrayFromAccessor(r);for(let _=0,y=o.length;_<y;_++){const T=new h(o[_]+"."+w0[s.path],t.array,m,d);i.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(T),a.push(T)}return a}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const r=kN(t.constructor),i=new Float32Array(t.length);for(let s=0,a=t.length;s<a;s++)i[s]=t[s]*r;t=i}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(r){const i=this instanceof Wm?jke:Uae;return new i(this.times,this.values,this.getValueSize()/3,r)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Qke(n,e,t){const r=e.attributes,i=new wl;if(r.POSITION!==void 0){const l=t.json.accessors[r.POSITION],o=l.min,h=l.max;if(o!==void 0&&h!==void 0){if(i.set(new Ze(o[0],o[1],o[2]),new Ze(h[0],h[1],h[2])),l.normalized){const d=kN(kb[l.componentType]);i.min.multiplyScalar(d),i.max.multiplyScalar(d)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const s=e.targets;if(s!==void 0){const l=new Ze,o=new Ze;for(let h=0,d=s.length;h<d;h++){const m=s[h];if(m.POSITION!==void 0){const _=t.json.accessors[m.POSITION],y=_.min,T=_.max;if(y!==void 0&&T!==void 0){if(o.setX(Math.max(Math.abs(y[0]),Math.abs(T[0]))),o.setY(Math.max(Math.abs(y[1]),Math.abs(T[1]))),o.setZ(Math.max(Math.abs(y[2]),Math.abs(T[2]))),_.normalized){const I=kN(kb[_.componentType]);o.multiplyScalar(I)}l.max(o)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}i.expandByVector(l)}n.boundingBox=i;const a=new rl;i.getCenter(a.center),a.radius=i.min.distanceTo(i.max)/2,n.boundingSphere=a}function DY(n,e,t){const r=e.attributes,i=[];function s(a,l){return t.getDependency("accessor",a).then(function(o){n.setAttribute(l,o)})}for(const a in r){const l=BN[a]||a.toLowerCase();l in n.attributes||i.push(s(r[a],l))}if(e.indices!==void 0&&!n.index){const a=t.getDependency("accessor",e.indices).then(function(l){n.setIndex(l)});i.push(a)}return ds.workingColorSpace!==Ga&&"COLOR_0"in r&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${ds.workingColorSpace}" not supported.`),vm(n,e),Qke(n,e,t),Promise.all(i).then(function(){return e.targets!==void 0?$ke(n,e.targets,t):n})}const eOe=()=>{let n=Ae.useRef(null),e=Ae.useRef(null),t,r,i,s,a,l,o=null;const h=new Qm;let d=0,m=!1;const _={x:0,y:0};let y=()=>{t=new Zl({canvas:n.current,antialias:!0,alpha:!0,powerPreference:"high-performance"}),r=new Zl({canvas:e.current,antialias:!1});const B={width:n.current.clientWidth,height:n.current.clientHeight};t.autoClear=!0,t.outputColorSpace=Ao,t.setSize(B.width,B.height),t.setPixelRatio(Math.min(window.devicePixelRatio,2)),r.outputColorSpace=Ao,r.setSize(B.width,B.height),r.setPixelRatio(Math.min(window.devicePixelRatio,2)),i=new Al,s=new Wl,a=new Qi(35,1,1,100),l=new Qi(35,1,1,100),i.add(s),a.aspect=B.width/B.height,a.position.set(19,1.54,-.1),s.add(a),l.aspect=B.width/B.height,l.position.set(3,3,3),l.rotation.set(0,1,0),i.add(l);const k=new Cv(16777215,.8);k.position.set(-100,0,-100),i.add(k),o=new ev(8978414,2.7,4,3),o.position.set(30,3,1.8),i.add(o);const j=new GT;j.onLoad=()=>{document.querySelector(".content").style.visibility="visible";let se={y:0};const ae=document.querySelector(".lds-roller"),fe=document.getElementById("loading-text-intro"),Se=new dS(se).to({y:100},900).easing(Kd.Quadratic.InOut).start().onUpdate(()=>{fe.style.setProperty("transform",`translate(0,${se.y}%)`)}).onComplete(()=>{fe.parentNode.removeChild(document.getElementById("loading-text-intro")),pS(Se)}),Ee=new dS(a.position.set(0,4,2)).to({x:0,y:2.4,z:5.8},3500).easing(Kd.Quadratic.InOut).start().onComplete(()=>{pS(Ee),document.querySelector(".nav-head").classList.add("ended"),document.querySelector(".description").classList.add("ended")});ae.parentNode.removeChild(ae),window.scroll(0,0)},j.onError=se=>{console.log("There was an error loading "+se)};const q=new f8;q.setDecoderPath("/draco/"),q.setDecoderConfig({type:"js"});const Z=new GD(j);Z.setDRACOLoader(q);let te;Z.load(_ke,se=>{se.scene.traverse(ae=>{ae.isMesh&&(te=ae.material,ae.material=new UT({shininess:100}))}),i.add(se.scene),te.dispose(),t.renderLists.dispose()}),new IntersectionObserver(se=>{m=se[0].intersectionRatio>.05},{threshold:.05}).observe(document.querySelector(".second"))};const T=function(B){const k=document.querySelector("span");if(B.type==="mouseleave")k.style.cssText="";else{const{offsetX:j,offsetY:q}=B,{offsetWidth:Z,offsetHeight:te}=this,ie=20,se=j/Z*(ie*2)-ie,ae=q/te*(ie*2)-ie;k.style.cssText=`transform: translate(${se}px, ${ae}px);`}},I=()=>{const B=h.getElapsedTime(),k=B-d;d=B;const j=_.y,q=_.x;o.position.y-=(j*9+o.position.y-2)*k,o.position.x+=(q*8-o.position.x)*2*k,s.position.z-=(j/3+s.position.z)*2*k,s.position.x+=(q/3-s.position.x)*2*k,Wne(),m?r.render(i,l):t.render(i,a),requestAnimationFrame(I)},C=(B,k)=>{const j=new dS(l.position).to(B,3500).easing(Kd.Quadratic.InOut).start().onComplete(()=>{pS(j)}),q=new dS(l.rotation).to(k,3500).easing(Kd.Quadratic.InOut).start().onComplete(()=>{pS(q)})},M=()=>{let B={width:n.current.clientWidth,height:n.current.clientHeight};t.setSize(B.width,B.height),t.setPixelRatio(Math.min(window.devicePixelRatio,2)),r.setSize(B.width,B.height),r.setPixelRatio(Math.min(window.devicePixelRatio,2)),a.aspect=B.width/B.height,a.updateProjectionMatrix(),l.aspect=B.width/B.height,l.updateProjectionMatrix()};return Ae.useEffect(()=>{y(),I(),document.addEventListener("mousemove",k=>{k.preventDefault(),_.x=k.clientX/window.innerWidth-.5,_.y=k.clientY/window.innerHeight-.5,document.querySelector(".cursor").style.cssText=`left: ${k.clientX}px; top: ${k.clientY}px;`},!1);const B=document.querySelectorAll(".nav-head > .a");return B.forEach(k=>k.addEventListener("mousemove",T)),B.forEach(k=>k.addEventListener("mouseleave",T)),document.getElementById("one").addEventListener("click",()=>{document.getElementById("one").classList.add("active"),document.getElementById("two").classList.remove("active"),document.getElementById("three").classList.remove("active"),C({x:3,y:3,z:3},{x:0,y:1,z:0}),document.getElementById("content").innerText="入门阶段"}),document.getElementById("two").addEventListener("click",()=>{document.getElementById("one").classList.remove("active"),document.getElementById("two").classList.add("active"),document.getElementById("three").classList.remove("active"),C({x:-1.4,y:2.8,z:4.4},{x:0,y:-.1,z:0}),document.getElementById("content").innerText="运行阶段"}),document.getElementById("three").addEventListener("click",()=>{document.getElementById("one").classList.remove("active"),document.getElementById("two").classList.remove("active"),document.getElementById("three").classList.add("active"),C({x:-4.8,y:2.9,z:3.2},{x:0,y:-.75,z:0}),document.getElementById("content").innerText="结束阶段"}),window.addEventListener("resize",M),()=>{window.removeEventListener("resize",M)}},[]),me.jsxs("div",{className:"shadow_page",children:[me.jsxs("div",{className:"lds-roller",children:[me.jsx("div",{}),me.jsx("div",{}),me.jsx("div",{}),me.jsx("div",{}),me.jsx("div",{}),me.jsx("div",{}),me.jsx("div",{}),me.jsx("div",{})]}),me.jsx("div",{id:"loading-text-intro",children:me.jsx("p",{children:"Loading"})}),me.jsxs("div",{className:"content",style:{visibility:"hidden"},children:[me.jsxs("div",{className:"nav-head",children:[me.jsx("a",{href:"#",className:"a active",children:me.jsx("span",{children:"Main"})}),me.jsx("a",{href:"#",className:"a",children:me.jsx("span",{children:"About"})}),me.jsx("a",{href:"#",className:"a",children:me.jsx("span",{children:"Gallery"})}),me.jsx("a",{href:"#",className:"a",children:me.jsx("span",{children:"Contact"})}),me.jsx("a",{href:"#",className:"a",children:me.jsx("span",{children:"More"})}),me.jsx("div",{className:"cursor"})]}),me.jsxs("section",{className:"section first",children:[me.jsx("canvas",{ref:n,id:"container",className:"webgl"}),me.jsxs("div",{className:"info",children:[me.jsx("h2",{className:"name",children:"DEAGONIR"}),me.jsx("h1",{className:"title",children:"THREEJS"}),me.jsx("p",{className:"description",children:" "})]})]}),me.jsxs("section",{className:"section second",children:[me.jsxs("div",{className:"second-container",children:[me.jsxs("ul",{children:[me.jsx("li",{id:"one",className:"active",children:"start"}),me.jsx("li",{id:"two",children:"running"}),me.jsx("li",{id:"three",children:"finished"})]}),me.jsx("p",{className:"text",id:"content",children:"入门阶段"})]}),me.jsx("canvas",{ref:e,id:"containerDetails",className:"webgl"})]})]})]})};var tOe=`uniform vec3 iResolution; 
uniform float iTime;      \r

varying vec2 vUv;\r

#ifdef FAST_DESCENT\r
const vec3 cameraDir = normalize(vec3(-2.0, -1.0, -4.0));\r
const float cameraDist = 5.0;\r
const float speed = 3.0;\r
const float zoom = 2.5;

const vec3 windowColorA = vec3(0.0, 0.0, 1.5);\r
const vec3 windowColorB = vec3(0.5, 1.5, 2.0);

const float fogOffset = 2.5;\r
const float fogDensity = 0.6;\r
const vec3 fogColor = vec3(0.25, 0.0, 0.3);

const float lightHeight = 0.5;\r
const float lightSpeed = 0.2;\r
const vec3 lightColorA = vec3(0.6, 0.3, 0.1);\r
const vec3 lightColorB = vec3(0.8, 0.6, 0.4);

const vec3 signColorA = vec3(0.0, 0.0, 1.5);\r
const vec3 signColorB = vec3(3.0, 3.0, 3.0);\r
#else\r
const vec3 cameraDir = normalize(vec3(-2.0, -1.0, -2.0));\r
const float cameraDist = 9.0;\r
const float speed = 1.0;\r
const float zoom = 3.5;

const vec3 windowColorA = vec3(0.0, 0.0, 1.5);\r
const vec3 windowColorB = vec3(0.5, 1.5, 2.0);

const float fogOffset = 7.0;\r
const float fogDensity = 0.7;\r
const vec3 fogColor = vec3(0.25, 0.0, 0.3);

const float lightHeight = 0.0;\r
const float lightSpeed = 0.15;\r
const vec3 lightColorA = vec3(0.6, 0.3, 0.1);\r
const vec3 lightColorB = vec3(0.8, 0.6, 0.4);

const vec3 signColorA = vec3(0.0, 0.0, 1.5);\r
const vec3 signColorB = vec3(3.0, 3.0, 3.0);\r
#endif

const float tau = 6.283185;

float hash1(float p) {\r
  vec3 p3 = fract(p * vec3(5.3983, 5.4427, 6.9371));\r
  p3 += dot(p3, p3.yzx + 19.19);\r
  return fract((p3.x + p3.y) * p3.z);\r
}

float hash1(vec2 p2) {\r
  p2 = fract(p2 * vec2(5.3983, 5.4427));\r
  p2 += dot(p2.yx, p2.xy + vec2(21.5351, 14.3137));\r
  return fract(p2.x * p2.y * 95.4337);\r
}

float hash1(vec2 p2, float p) {\r
  vec3 p3 = fract(vec3(5.3983 * p2.x, 5.4427 * p2.y, 6.9371 * p));\r
  p3 += dot(p3, p3.yzx + 19.19);\r
  return fract((p3.x + p3.y) * p3.z);\r
}

vec2 hash2(vec2 p2, float p) {\r
  vec3 p3 = fract(vec3(5.3983 * p2.x, 5.4427 * p2.y, 6.9371 * p));\r
  p3 += dot(p3, p3.yzx + 19.19);\r
  return fract((p3.xx + p3.yz) * p3.zy);\r
}

vec3 hash3(vec2 p2) {\r
  vec3 p3 = fract(vec3(p2.xyx) * vec3(5.3983, 5.4427, 6.9371));\r
  p3 += dot(p3, p3.yxz + 19.19);\r
  return fract((p3.xxy + p3.yzz) * p3.zyx);\r
}

vec4 hash4(vec2 p2) {\r
  vec4 p4 = fract(p2.xyxy * vec4(5.3983, 5.4427, 6.9371, 7.1283));\r
  p4 += dot(p4, p4.yxwz + 19.19);\r
  return fract((p4.xxxy + p4.yyzz + p4.zwww) * p4.wzyx);\r
}

float noise(vec2 p) {\r
  vec2 i = floor(p);\r
  vec2 f = fract(p);\r
  vec2 u = f * f * (3.0 - 2.0 * f);\r
  return mix(mix(hash1(i + vec2(0.0, 0.0)), hash1(i + vec2(1.0, 0.0)), u.x),\r
             mix(hash1(i + vec2(0.0, 1.0)), hash1(i + vec2(1.0, 1.0)), u.x),\r
             u.y);\r
}

vec4 castRay(vec3 eye, vec3 ray, vec2 center) {\r
  vec2 block = floor(eye.xy);\r
  vec3 ri = 1.0 / ray;\r
  vec3 rs = sign(ray);\r
  vec3 side = 0.5 + 0.5 * rs;\r
  vec2 ris = ri.xy * rs.xy;\r
  vec2 dis = (block - eye.xy + 0.5 + rs.xy * 0.5) * ri.xy;

  for (int i = 0; i < 16; ++i) {\r
    float d = dot(block - center, cameraDir.xy);\r
    float height = 3.0 * hash1(block) - 1.0 + 1.5 * d - 0.1 * d * d;

    vec2 lo0 = vec2(block);\r
    vec2 loX = vec2(0.45, 0.45);\r
    vec2 hi0 = vec2(block + 0.55);\r
    vec2 hiX = vec2(0.45, 0.45);

    float dist = 500.0;\r
    float face = 0.0;

    {\r
      vec4 signHash = hash4(block);\r
      vec2 center = vec2(0.2, -0.4) + vec2(0.6, -0.8) * signHash.xy;\r
      float width = 0.06 + 0.1 * signHash.w;

      vec3 lo = vec3(center.x - width, 0.55, -100.0);\r
      vec3 hi = vec3(center.x + width, 0.99, center.y + width + height);

      float s = step(0.5, signHash.z);\r
      lo = vec3(block, 0.0) + mix(lo, lo.yxz, s);\r
      hi = vec3(block, 0.0) + mix(hi, hi.yxz, s);

      vec3 wall = mix(hi, lo, side);\r
      vec3 t = (wall - eye) * ri;

      vec3 dim = step(t.zxy, t) * step(t.yzx, t);\r
      float maxT = dot(dim, t);\r
      float maxFace = dim.x - dim.y;

      vec3 p = eye + maxT * ray;\r
      dim += step(lo, p) * step(p, hi);

      if (dim.x * dim.y * dim.z > 0.5) {\r
        dist = maxT;\r
        face = maxFace;\r
      }\r
    }

    for (int j = 0; j < 5; ++j) {\r
      float top = height - 0.4 * float(j);\r
      vec3 lo = vec3(lo0 + loX * hash2(block, float(j)), -100.0);\r
      vec3 hi = vec3(hi0 + hiX * hash2(block, float(j) + 0.5), top);

      vec3 wall = mix(hi, lo, side);\r
      vec3 t = (wall - eye) * ri;

      vec3 dim = step(t.zxy, t) * step(t.yzx, t);\r
      float maxT = dot(dim, t);\r
      float maxFace = dim.x - dim.y;

      vec3 p = eye + maxT * ray;\r
      dim += step(lo, p) * step(p, hi);

      if (dim.x * dim.y * dim.z > 0.5 && maxT < dist) {\r
        dist = maxT;\r
        face = maxFace;\r
      }\r
    }

    if (dist < 400.0) {\r
      return vec4(dist, height, face, 1.0);\r
    }

    float t = eye.z * ri.z;\r
    vec3 p = eye - t * ray;\r
    vec2 g = p.xy - block;

    vec2 dim = step(dis.xy, dis.yx);\r
    dis += dim * ris;\r
    block += dim * rs.xy;\r
  }

  return vec4(100.0, 0.0, 0.0, 1.0);\r
}

vec3 window(float z, vec2 pos, vec2 id) {\r
  float windowSize = 0.03 + 0.12 * hash1(id + 0.1);\r
  float windowProb = 0.3 + 0.8 * hash1(id + 0.2);\r
  float depth = z / windowSize;\r
  float level = floor(depth);\r
  vec3 colorA = mix(windowColorA, windowColorB, hash3(id));\r
  vec3 colorB = mix(windowColorA, windowColorB, hash3(id + 0.1));\r
  vec3 color = mix(colorA, colorB, hash1(id, level));\r
  color *= 0.3 +\r
           0.7 * smoothstep(0.1, 0.5, noise(20.0 * pos + 100.0 * hash1(level)));\r
  color *=\r
      smoothstep(windowProb - 0.2, windowProb + 0.2, hash1(id, level + 0.1));\r
  return color * (0.5 - 0.5 * cos(tau * depth));\r
}

vec3 addLight(vec3 eye, vec3 ray, float res, float time, float height) {\r
  vec2 q = eye.xy + ((height - eye.z) / ray.z) * ray.xy;

  float row = floor(q.x + 0.5);\r
  time += hash1(row);\r
  float col = floor(0.125 * q.y - time);

  float pos = 0.4 + 0.4 * cos(time + tau * hash1(vec2(row, col)));\r
  vec3 lightPos = vec3(row, 8.0 * (col + time + pos), height);\r
  vec3 lightDir = vec3(0.0, 1.0, 0.0);

  
  vec3 w = eye - lightPos;\r
  float a = dot(ray, ray);\r
  float b = dot(ray, lightDir);\r
  float c = dot(lightDir, lightDir);\r
  float d = dot(ray, w);\r
  float e = dot(lightDir, w);\r
  float D = a * c - b * b;\r
  float s = (b * e - c * d) / D;\r
  float t = (a * e - b * d) / D;

  t = max(t, 0.0);\r
  float dist = distance(eye + s * ray, lightPos + t * lightDir);

  float mask = smoothstep(res + 0.1, res, s);\r
  float light =\r
      min(1.0 / pow(200.0 * dist * dist / t + 20.0 * t * t, 0.8), 2.0);\r
  float fog = exp(-fogDensity * max(s - fogOffset, 0.0));\r
  vec3 color = mix(lightColorA, lightColorB, hash3(vec2(row, col)));\r
  return mask * light * fog * color;\r
}

vec3 addSign(vec3 color, vec3 pos, float side, vec2 id) {\r
  vec4 signHash = hash4(id);\r
  float s = step(0.5, signHash.z);\r
  if ((s - 0.5) * side < 0.1)\r
    return color;

  vec2 center = vec2(0.2, -0.4) + vec2(0.6, -0.8) * signHash.xy;\r
  vec2 p = mix(pos.xz, pos.yz, s);\r
  float halfWidth = 0.04 + 0.06 * signHash.w;

  float charCount = floor(1.0 + 8.0 * hash1(id + 0.5));\r
  if (center.y - p.y > 2.0 * halfWidth * (charCount + 1.0)) {\r
    center.y -= 2.0 * halfWidth * (charCount + 1.5 + 5.0 * hash1(id + 0.6));\r
    charCount = floor(2.0 + 12.0 * hash1(id + 0.7));\r
    id += 0.05;\r
  }

  vec3 signColor = mix(signColorA, signColorB, hash3(id + 0.5));\r
  vec3 outlineColor = mix(signColorA, signColorB, hash3(id + 0.6));\r
  float flash = 6.0 - 24.0 * hash1(id + 0.8);\r
  flash *= step(3.0, flash);\r
  flash = smoothstep(0.1, 0.5, 0.5 + 0.5 * cos(flash * iTime));

  vec2 halfSize = vec2(halfWidth, halfWidth * charCount);\r
  center.y -= halfSize.y;\r
  float outline = length(max(abs(p - center) - halfSize, 0.0)) / halfWidth;\r
  color *= smoothstep(0.1, 0.4, outline);

  vec2 charPos = 0.5 * (p - center + halfSize) / halfWidth;\r
  vec2 charId = id + 0.05 + 0.1 * floor(charPos);\r
  float flicker = hash1(charId);\r
  flicker = step(0.93, flicker);\r
  flicker = 1.0 - flicker * step(0.96, hash1(charId, iTime));

  float char = -3.5 + 8.0 * noise(id + 6.0 * charPos);\r
  charPos = fract(charPos);\r
  char *= smoothstep(0.0, 0.4, charPos.x) * smoothstep(1.0, 0.6, charPos.x);\r
  char *= smoothstep(0.0, 0.4, charPos.y) * smoothstep(1.0, 0.6, charPos.y);\r
  color = mix(color, signColor,\r
              flash * flicker * step(outline, 0.01) * clamp(char, 0.0, 1.0));

  outline = smoothstep(0.0, 0.2, outline) * smoothstep(0.5, 0.3, outline);\r
  return mix(color, outlineColor, flash * outline);\r
}

void main() {\r
  vec2 center = -speed * iTime * cameraDir.xy;\r
  vec3 eye = vec3(center, 0.0) - cameraDist * cameraDir;

  vec3 forward = normalize(cameraDir);\r
  vec3 right = normalize(cross(forward, vec3(0.0, 0.0, 1.0)));\r
  vec3 up = cross(right, forward);\r
  
  vec2 xy = vUv - 0.5;\r
  
  
  vec3 ray = normalize(xy.x * right + xy.y * up + zoom * forward * 0.4);

  vec4 res = castRay(eye, ray, center);\r
  vec3 p = eye + res.x * ray;

  vec2 block = floor(p.xy);\r
  vec3 color = window(p.z - res.y, p.xy, block);

  color = addSign(color, vec3(p.xy - block, p.z - res.y), res.z, block);\r
  color = mix(vec3(0.0), color, abs(res.z));

  float fog = exp(-fogDensity * max(res.x - fogOffset, 0.0));\r
  color = mix(fogColor, color, fog);

  float time = lightSpeed * iTime;\r
  color += addLight(eye.xyz, ray.xyz, res.x, time, lightHeight - 0.6);\r
  color += addLight(eye.yxz, ray.yxz, res.x, time, lightHeight - 0.4);\r
  color += addLight(vec3(-eye.xy, eye.z), vec3(-ray.xy, ray.z), res.x, time,\r
                    lightHeight - 0.2);\r
  color += addLight(vec3(-eye.yx, eye.z), vec3(-ray.yx, ray.z), res.x, time,\r
                    lightHeight);

#ifdef BLACK_AND_WHITE\r
  float c = clamp(dot(vec3(0.4, 0.3, 0.4), color), 0.0, 1.0);\r
  c = 1.0 - pow(1.0 - pow(c, 2.0), 4.0);\r
  color = vec3(c);\r
#endif

  gl_FragColor = vec4(color, 1.0);\r
}`;const nOe=()=>{let n=null,e=null,t=null,r=null,i=null,s=Ae.useRef(null);const a=()=>{r={width:s.current.clientWidth,height:s.current.clientHeight},n=new Al,n.fog=new fw(1710618,1,1e3),n.background=new Gn(1710618),e=new Qi(70,r.width/r.height,.01,1e3),e.position.set(0,0,5),n.add(e),t=new mx(14609919,3),n.add(t),i=new Zl({canvas:s.current,alpha:!0,antialias:!0}),i.setSize(r.width,r.height),i.setPixelRatio(Math.min(window.devicePixelRatio,2));const h=new Ev(e,i.domElement);h.enableDamping=!0,n.add(h)},l=()=>{const{x:h,y:d}=i.getDrawingBufferSize(new nn),m=new Eo({vertexShader:`
        varying vec2 vUv;
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
        }
      `,fragmentShader:tOe,uniforms:{iResolution:{value:new Ze(h,d)},iTime:{value:0}}}),_=new Ei(new Jm(5,5),m);_.onBeforeRender=()=>{m.uniforms.iTime.value+=.01},n.add(_)},o=()=>{i.render(n,e),requestAnimationFrame(o)};return Ae.useEffect(()=>{a(),l(),o()},[]),me.jsx("div",{className:"w-screen h-screen",children:me.jsx("canvas",{className:"w-full h-full",ref:s})})},rOe=()=>{let n=null,e=null,t=null,r=Ae.useRef(null),i,s,a;const l=()=>{i=new mp(5,5,5),s=new vo({color:16711680}),a=new Ei(i,s);let h={width:r.current.clientWidth,height:r.current.clientHeight};n=new Al,n.add(a),e=new Qi(70,h.width/h.height,.01,1e3),e.position.z=10,t=new Zl({canvas:r.current,antialias:!0}),t.setSize(h.width,h.height)},o=()=>{a&&(a.rotation.y+=.02),a&&(a.rotation.x+=.02),t.render(n,e),requestAnimationFrame(o)};return Ae.useEffect(()=>{l(),o()},[]),me.jsx("div",{className:"w-screen h-screen",children:me.jsx("canvas",{className:"w-full h-full",ref:r})})},iOe=""+new URL("cat-DI6FY0oP.mp3",import.meta.url).href,sOe=""+new URL("cow-D6Dskg5A.mp3",import.meta.url).href,oOe=""+new URL("bg-BEcaSD04.png",import.meta.url).href,Vae=""+new URL("perlinnoise-D9vz38ra.png",import.meta.url).href,Gae=""+new URL("sparknoise-C0zIzS_R.png",import.meta.url).href,BY=new Ze,Tk=new XA,Mk=new Ze;class Hae{constructor(e,t){this.object=e,this.domElement=t,this.enabled=!0,this.movementSpeed=1,this.lookSpeed=.005,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.mouseDragOn=!1,this.autoSpeedFactor=0,this.pointerX=0,this.pointerY=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.viewHalfX=0,this.viewHalfY=0;let r=0,i=0;this.handleResize=function(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)},this.onPointerDown=function(m){if(this.domElement!==document&&this.domElement.focus(),this.activeLook)switch(m.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0;break}this.mouseDragOn=!0},this.onPointerUp=function(m){if(this.activeLook)switch(m.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1;break}this.mouseDragOn=!1},this.onPointerMove=function(m){this.domElement===document?(this.pointerX=m.pageX-this.viewHalfX,this.pointerY=m.pageY-this.viewHalfY):(this.pointerX=m.pageX-this.domElement.offsetLeft-this.viewHalfX,this.pointerY=m.pageY-this.domElement.offsetTop-this.viewHalfY)},this.onKeyDown=function(m){switch(m.code){case"ArrowUp":case"KeyW":this.moveForward=!0;break;case"ArrowLeft":case"KeyA":this.moveLeft=!0;break;case"ArrowDown":case"KeyS":this.moveBackward=!0;break;case"ArrowRight":case"KeyD":this.moveRight=!0;break;case"KeyR":this.moveUp=!0;break;case"KeyF":this.moveDown=!0;break}},this.onKeyUp=function(m){switch(m.code){case"ArrowUp":case"KeyW":this.moveForward=!1;break;case"ArrowLeft":case"KeyA":this.moveLeft=!1;break;case"ArrowDown":case"KeyS":this.moveBackward=!1;break;case"ArrowRight":case"KeyD":this.moveRight=!1;break;case"KeyR":this.moveUp=!1;break;case"KeyF":this.moveDown=!1;break}},this.lookAt=function(m,_,y){return m.isVector3?Mk.copy(m):Mk.set(m,_,y),this.object.lookAt(Mk),d(this),this},this.update=function(){const m=new Ze;return function(y){if(this.enabled===!1)return;if(this.heightSpeed){const q=to.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=y*(q*this.heightCoef)}else this.autoSpeedFactor=0;const T=y*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(T+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(T),this.moveLeft&&this.object.translateX(-T),this.moveRight&&this.object.translateX(T),this.moveUp&&this.object.translateY(T),this.moveDown&&this.object.translateY(-T);let I=y*this.lookSpeed;this.activeLook||(I=0);let C=1;this.constrainVertical&&(C=Math.PI/(this.verticalMax-this.verticalMin)),i-=this.pointerX*I,this.lookVertical&&(r-=this.pointerY*I*C),r=Math.max(-85,Math.min(85,r));let M=to.degToRad(90-r);const B=to.degToRad(i);this.constrainVertical&&(M=to.mapLinear(M,0,Math.PI,this.verticalMin,this.verticalMax));const k=this.object.position;m.setFromSphericalCoords(1,M,B).add(k),this.object.lookAt(m)}}(),this.dispose=function(){this.domElement.removeEventListener("contextmenu",kY),this.domElement.removeEventListener("pointerdown",a),this.domElement.removeEventListener("pointermove",s),this.domElement.removeEventListener("pointerup",l),window.removeEventListener("keydown",o),window.removeEventListener("keyup",h)};const s=this.onPointerMove.bind(this),a=this.onPointerDown.bind(this),l=this.onPointerUp.bind(this),o=this.onKeyDown.bind(this),h=this.onKeyUp.bind(this);this.domElement.addEventListener("contextmenu",kY),this.domElement.addEventListener("pointerdown",a),this.domElement.addEventListener("pointermove",s),this.domElement.addEventListener("pointerup",l),window.addEventListener("keydown",o),window.addEventListener("keyup",h);function d(m){const _=m.object.quaternion;BY.set(0,0,-1).applyQuaternion(_),Tk.setFromVector3(BY),r=90-to.radToDeg(Tk.phi),i=to.radToDeg(Tk.theta)}this.handleResize(),d(this)}}function kY(n){n.preventDefault()}const aOe=()=>{const n=Ae.useRef(null);let e,t,r,i=null,s={width:0,height:0};const a=()=>{s.width=window.innerWidth,s.height=window.innerHeight,t.aspect=s.width/s.height,t.updateProjectionMatrix(),r.setSize(s.width,s.height),r.setPixelRatio(Math.min(window.devicePixelRatio,2))},l=()=>{s.width=window.innerWidth,s.height=window.innerHeight,e=new Al,t=new Qi(50,s.width/s.height,1,1e5),t.position.set(-200,25,0),t.lookAt(.1,.1,.1),e.add(t),r=new Zl({canvas:n.current,antialias:!0,alpha:!0}),r.setSize(s.width,s.height),r.setPixelRatio(Math.min(window.devicePixelRatio,2)),r.render(e,t);const _=new Cv(16777215,1);_.position.set(0,.5,1).normalize(),e.add(_),i=new Hae(t,r.domElement),i.movementSpeed=50,i.lookSpeed=.1,i.noFly=!0,i.lookVertical=!1},o=()=>{e.background=new qf().load(oOe),h(sOe,Vae,0,20,-50),h(iOe,Gae,0,20,50)},h=(_,y,T,I,C)=>{let M=new $te;t.add(M);let B=new Ei(new mp(40,40,40),new vo({map:new qf().load(y)}));B.position.set(T,I,C),e.add(B);var k=new Zte(M),j=new Xte;j.load(_,q=>{k.setBuffer(q),k.setRefDistance(30),k.play(),k.setRolloffFactor(10),k.setLoop(!0)})},d=new Qm,m=()=>{r.render(e,t),i.update(d.getDelta()),requestAnimationFrame(m)};return Ae.useEffect(()=>(l(),o(),m(),window.addEventListener("resize",a),()=>{window.removeEventListener("resize",a)}),[]),me.jsx("div",{className:"w-screen h-screen",children:me.jsx("canvas",{className:"w-screen h-screen",ref:n})})},lOe=""+new URL("px-DZeywvNe.jpg",import.meta.url).href,cOe=""+new URL("nx-gXUpNenc.jpg",import.meta.url).href,uOe=""+new URL("py-DXf_Q1NF.jpg",import.meta.url).href,hOe=""+new URL("ny-Bo9il99d.jpg",import.meta.url).href,fOe=""+new URL("pz-BKu-NtuL.jpg",import.meta.url).href,dOe=""+new URL("nz-D5GMLchw.jpg",import.meta.url).href,pOe=""+new URL("iphone-D4eE8fd6.glb",import.meta.url).href,mOe=()=>{const n=Ae.useRef(null),e=Ae.useRef(null);let t,r,i,s=null,a={width:0,height:0};const l=()=>{t=new Al,a.width=window.innerWidth,a.height=window.innerHeight,r=new Qi(75,a.width/a.height,.1,1e3),r.position.set(0,0,20),r.lookAt(new Ze(0,0,0)),t.add(r),i=new Zl({canvas:n.current,antialias:!0,alpha:!0}),i.setSize(a.width,a.height),i.setPixelRatio(Math.min(window.devicePixelRatio,2)),i.physicallyCorrectLights=!0,i.toneMapping=TL,i.toneMappingExposure=2,i.outputColorSpace=Ao,s=new Hae(r,i.domElement),s.movementSpeed=30,s.lookSpeed=.1,s.noFly=!0};let o=null;const h=()=>{o=new zte().load([lOe,cOe,uOe,hOe,fOe,dOe]),o.colorSpace=Ao,t.background=o,t.environment=o};let d=null,m={mesh:null,material:null,videoMaterial:null};const _=()=>{const M=new _te(e.current),B=new jo({map:M,envMap:o});m.videoMaterial=B;const k=new f8;k.setDecoderPath("/draco/"),k.setDecoderConfig({type:"js"});const j=new GD;j.setDRACOLoader(k),j.load(pOe,q=>{q.scene&&(q.scene.traverse(Z=>{Z instanceof Ei&&Z.material instanceof cp&&(Z.material.envMap=o,Z.material.envMapIntensity=2,Z.name==="屏幕"&&(m.mesh=Z,m.material=Z.material),Z.name.includes("logo")&&(Z.material.metalness=1))}),d=q.scene,d.scale.set(60,60,60),d.position.y=-5,d.rotation.y=-Math.PI,t.add(d))})},y=()=>{const M=new tD,B=new nn;window.addEventListener("click",k=>{B.x=k.clientX/a.width*2-1,B.y=-(k.clientY/a.height)*2+1,M.setFromCamera(B,r);const j=M.intersectObjects([m.mesh]);if(j.length>0){const q=j[0].object;q.material.type==="MeshStandardMaterial"?q.material=m.videoMaterial:q.material=m.material}})},T=()=>{a.width=window.innerWidth,a.height=window.innerHeight,r.aspect=a.width/a.height,r.updateProjectionMatrix(),i.setSize(a.width,a.height),i.setPixelRatio(Math.min(window.devicePixelRatio,2))},I=new Qm,C=()=>{i.render(t,r),s.update(I.getDelta()),requestAnimationFrame(C)};return Ae.useEffect(()=>(l(),h(),_(),y(),C(),window.addEventListener("resize",T),()=>{window.removeEventListener("resize",T)}),[]),me.jsxs("div",{className:"w-screen h-screen",children:[me.jsx("canvas",{ref:n}),me.jsx("video",{className:"invisible fixed t-0 l-0",ref:e,src:"/src/assets/video/demo.mp4",muted:!0,autoPlay:!0,type:"mp4",loop:!0}),me.jsxs("div",{className:"w-64 h-12 bg-black-500 fixed top-0 left-1/2 -ml-32 rounded-b-md flex items-center py-3",children:[me.jsxs("svg",{className:"ml-4",width:"26",height:"26",viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[me.jsx("path",{d:"M39 6H9C7.34315 6 6 7.34315 6 9V39C6 40.6569 7.34315 42 9 42H39C40.6569 42 42 40.6569 42 39V9C42 7.34315 40.6569 6 39 6Z",fill:"none",stroke:"#FFF",strokeWidth:"4"}),me.jsx("path",{d:"M24 19H12V29H24V19Z",fill:"none",stroke:"#FFF",strokeWidth:"4",strokeLinejoin:"bevel"}),me.jsx("path",{d:"M35 18L30 22V26L35 30V18Z",fill:"none",stroke:"#FFF",strokeWidth:"4",strokeLinejoin:"bevel"})]}),me.jsx("span",{className:"text-white text-lg align-middle pl-2",children:"轻触手机屏幕与我聊天"})]})]})},jae=typeof document<"u"?Xl.useLayoutEffect:()=>{};function gOe(n){const e=Ae.useRef(null);return jae(()=>{e.current=n},[n]),Ae.useCallback((...t)=>{const r=e.current;return r==null?void 0:r(...t)},[])}const rM=n=>{var e;return(e=n==null?void 0:n.ownerDocument)!==null&&e!==void 0?e:document},Sy=n=>n&&"window"in n&&n.window===n?n:rM(n).defaultView||window;function vOe(n){var e;return typeof window>"u"||window.navigator==null?!1:((e=window.navigator.userAgentData)===null||e===void 0?void 0:e.brands.some(t=>n.test(t.brand)))||n.test(window.navigator.userAgent)}function _Oe(n){var e;return typeof window<"u"&&window.navigator!=null?n.test(((e=window.navigator.userAgentData)===null||e===void 0?void 0:e.platform)||window.navigator.platform):!1}function Wae(n){let e=null;return()=>(e==null&&(e=n()),e)}const yOe=Wae(function(){return _Oe(/^Mac/i)}),xOe=Wae(function(){return vOe(/Android/i)});function bOe(n){return n.mozInputSource===0&&n.isTrusted?!0:xOe()&&n.pointerType?n.type==="click"&&n.buttons===1:n.detail===0&&!n.pointerType}class wOe{isDefaultPrevented(){return this.nativeEvent.defaultPrevented}preventDefault(){this.defaultPrevented=!0,this.nativeEvent.preventDefault()}stopPropagation(){this.nativeEvent.stopPropagation(),this.isPropagationStopped=()=>!0}isPropagationStopped(){return!1}persist(){}constructor(e,t){this.nativeEvent=t,this.target=t.target,this.currentTarget=t.currentTarget,this.relatedTarget=t.relatedTarget,this.bubbles=t.bubbles,this.cancelable=t.cancelable,this.defaultPrevented=t.defaultPrevented,this.eventPhase=t.eventPhase,this.isTrusted=t.isTrusted,this.timeStamp=t.timeStamp,this.type=e}}function Xae(n){let e=Ae.useRef({isFocused:!1,observer:null});jae(()=>{const r=e.current;return()=>{r.observer&&(r.observer.disconnect(),r.observer=null)}},[]);let t=gOe(r=>{n==null||n(r)});return Ae.useCallback(r=>{if(r.target instanceof HTMLButtonElement||r.target instanceof HTMLInputElement||r.target instanceof HTMLTextAreaElement||r.target instanceof HTMLSelectElement){e.current.isFocused=!0;let i=r.target,s=a=>{e.current.isFocused=!1,i.disabled&&t(new wOe("blur",a)),e.current.observer&&(e.current.observer.disconnect(),e.current.observer=null)};i.addEventListener("focusout",s,{once:!0}),e.current.observer=new MutationObserver(()=>{if(e.current.isFocused&&i.disabled){var a;(a=e.current.observer)===null||a===void 0||a.disconnect();let l=i===document.activeElement?null:document.activeElement;i.dispatchEvent(new FocusEvent("blur",{relatedTarget:l})),i.dispatchEvent(new FocusEvent("focusout",{bubbles:!0,relatedTarget:l}))}}),e.current.observer.observe(i,{attributes:!0,attributeFilter:["disabled"]})}},[t])}function SOe(n){let{isDisabled:e,onFocus:t,onBlur:r,onFocusChange:i}=n;const s=Ae.useCallback(o=>{if(o.target===o.currentTarget)return r&&r(o),i&&i(!1),!0},[r,i]),a=Xae(s),l=Ae.useCallback(o=>{const h=rM(o.target);o.target===o.currentTarget&&h.activeElement===o.target&&(t&&t(o),i&&i(!0),a(o))},[i,t,a]);return{focusProps:{onFocus:!e&&(t||i||r)?l:void 0,onBlur:!e&&(r||i)?s:void 0}}}let iM=null,ON=new Set,aA=new Map,ix=!1,FN=!1;const AOe={Tab:!0,Escape:!0};function d8(n,e){for(let t of ON)t(n,e)}function TOe(n){return!(n.metaKey||!yOe()&&n.altKey||n.ctrlKey||n.key==="Control"||n.key==="Shift"||n.key==="Meta")}function GP(n){ix=!0,TOe(n)&&(iM="keyboard",d8("keyboard",n))}function _h(n){iM="pointer",(n.type==="mousedown"||n.type==="pointerdown")&&(ix=!0,d8("pointer",n))}function $ae(n){bOe(n)&&(ix=!0,iM="virtual")}function qae(n){n.target===window||n.target===document||(!ix&&!FN&&(iM="virtual",d8("virtual",n)),ix=!1,FN=!1)}function Zae(){ix=!1,FN=!0}function NN(n){if(typeof window>"u"||aA.get(Sy(n)))return;const e=Sy(n),t=rM(n);let r=e.HTMLElement.prototype.focus;e.HTMLElement.prototype.focus=function(){ix=!0,r.apply(this,arguments)},t.addEventListener("keydown",GP,!0),t.addEventListener("keyup",GP,!0),t.addEventListener("click",$ae,!0),e.addEventListener("focus",qae,!0),e.addEventListener("blur",Zae,!1),typeof PointerEvent<"u"?(t.addEventListener("pointerdown",_h,!0),t.addEventListener("pointermove",_h,!0),t.addEventListener("pointerup",_h,!0)):(t.addEventListener("mousedown",_h,!0),t.addEventListener("mousemove",_h,!0),t.addEventListener("mouseup",_h,!0)),e.addEventListener("beforeunload",()=>{Yae(n)},{once:!0}),aA.set(e,{focus:r})}const Yae=(n,e)=>{const t=Sy(n),r=rM(n);e&&r.removeEventListener("DOMContentLoaded",e),aA.has(t)&&(t.HTMLElement.prototype.focus=aA.get(t).focus,r.removeEventListener("keydown",GP,!0),r.removeEventListener("keyup",GP,!0),r.removeEventListener("click",$ae,!0),t.removeEventListener("focus",qae,!0),t.removeEventListener("blur",Zae,!1),typeof PointerEvent<"u"?(r.removeEventListener("pointerdown",_h,!0),r.removeEventListener("pointermove",_h,!0),r.removeEventListener("pointerup",_h,!0)):(r.removeEventListener("mousedown",_h,!0),r.removeEventListener("mousemove",_h,!0),r.removeEventListener("mouseup",_h,!0)),aA.delete(t))};function MOe(n){const e=rM(n);let t;return e.readyState!=="loading"?NN(n):(t=()=>{NN(n)},e.addEventListener("DOMContentLoaded",t)),()=>Yae(n,t)}typeof document<"u"&&MOe();function Kae(){return iM!=="pointer"}const COe=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]);function EOe(n,e,t){var r;const i=typeof window<"u"?Sy(t==null?void 0:t.target).HTMLInputElement:HTMLInputElement,s=typeof window<"u"?Sy(t==null?void 0:t.target).HTMLTextAreaElement:HTMLTextAreaElement,a=typeof window<"u"?Sy(t==null?void 0:t.target).HTMLElement:HTMLElement,l=typeof window<"u"?Sy(t==null?void 0:t.target).KeyboardEvent:KeyboardEvent;return n=n||(t==null?void 0:t.target)instanceof i&&!COe.has(t==null||(r=t.target)===null||r===void 0?void 0:r.type)||(t==null?void 0:t.target)instanceof s||(t==null?void 0:t.target)instanceof a&&(t==null?void 0:t.target.isContentEditable),!(n&&e==="keyboard"&&t instanceof l&&!AOe[t.key])}function IOe(n,e,t){NN(),Ae.useEffect(()=>{let r=(i,s)=>{EOe(!!(t!=null&&t.isTextInput),i,s)&&n(Kae())};return ON.add(r),()=>{ON.delete(r)}},e)}function ROe(n){let{isDisabled:e,onBlurWithin:t,onFocusWithin:r,onFocusWithinChange:i}=n,s=Ae.useRef({isFocusWithin:!1}),a=Ae.useCallback(h=>{s.current.isFocusWithin&&!h.currentTarget.contains(h.relatedTarget)&&(s.current.isFocusWithin=!1,t&&t(h),i&&i(!1))},[t,i,s]),l=Xae(a),o=Ae.useCallback(h=>{!s.current.isFocusWithin&&document.activeElement===h.target&&(r&&r(h),i&&i(!0),s.current.isFocusWithin=!0,l(h))},[r,i,l]);return e?{focusWithinProps:{onFocus:void 0,onBlur:void 0}}:{focusWithinProps:{onFocus:o,onBlur:a}}}let HP=!1,Ck=0;function zN(){HP=!0,setTimeout(()=>{HP=!1},50)}function OY(n){n.pointerType==="touch"&&zN()}function POe(){if(!(typeof document>"u"))return typeof PointerEvent<"u"?document.addEventListener("pointerup",OY):document.addEventListener("touchend",zN),Ck++,()=>{Ck--,!(Ck>0)&&(typeof PointerEvent<"u"?document.removeEventListener("pointerup",OY):document.removeEventListener("touchend",zN))}}function LOe(n){let{onHoverStart:e,onHoverChange:t,onHoverEnd:r,isDisabled:i}=n,[s,a]=Ae.useState(!1),l=Ae.useRef({isHovered:!1,ignoreEmulatedMouseEvents:!1,pointerType:"",target:null}).current;Ae.useEffect(POe,[]);let{hoverProps:o,triggerHoverEnd:h}=Ae.useMemo(()=>{let d=(y,T)=>{if(l.pointerType=T,i||T==="touch"||l.isHovered||!y.currentTarget.contains(y.target))return;l.isHovered=!0;let I=y.currentTarget;l.target=I,e&&e({type:"hoverstart",target:I,pointerType:T}),t&&t(!0),a(!0)},m=(y,T)=>{if(l.pointerType="",l.target=null,T==="touch"||!l.isHovered)return;l.isHovered=!1;let I=y.currentTarget;r&&r({type:"hoverend",target:I,pointerType:T}),t&&t(!1),a(!1)},_={};return typeof PointerEvent<"u"?(_.onPointerEnter=y=>{HP&&y.pointerType==="mouse"||d(y,y.pointerType)},_.onPointerLeave=y=>{!i&&y.currentTarget.contains(y.target)&&m(y,y.pointerType)}):(_.onTouchStart=()=>{l.ignoreEmulatedMouseEvents=!0},_.onMouseEnter=y=>{!l.ignoreEmulatedMouseEvents&&!HP&&d(y,"mouse"),l.ignoreEmulatedMouseEvents=!1},_.onMouseLeave=y=>{!i&&y.currentTarget.contains(y.target)&&m(y,"mouse")}),{hoverProps:_,triggerHoverEnd:m}},[e,t,r,i,l]);return Ae.useEffect(()=>{i&&h({currentTarget:l.target},l.pointerType)},[i]),{hoverProps:o,isHovered:s}}function DOe(n={}){let{autoFocus:e=!1,isTextInput:t,within:r}=n,i=Ae.useRef({isFocused:!1,isFocusVisible:e||Kae()}),[s,a]=Ae.useState(!1),[l,o]=Ae.useState(()=>i.current.isFocused&&i.current.isFocusVisible),h=Ae.useCallback(()=>o(i.current.isFocused&&i.current.isFocusVisible),[]),d=Ae.useCallback(y=>{i.current.isFocused=y,a(y),h()},[h]);IOe(y=>{i.current.isFocusVisible=y,h()},[],{isTextInput:t});let{focusProps:m}=SOe({isDisabled:r,onFocusChange:d}),{focusWithinProps:_}=ROe({isDisabled:!r,onFocusWithinChange:d});return{isFocused:s,isFocusVisible:l,focusProps:r?_:m}}var BOe=Object.defineProperty,kOe=(n,e,t)=>e in n?BOe(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Ek=(n,e,t)=>(kOe(n,typeof e!="symbol"?e+"":e,t),t);let OOe=class{constructor(){Ek(this,"current",this.detect()),Ek(this,"handoffState","pending"),Ek(this,"currentId",0)}set(e){this.current!==e&&(this.handoffState="pending",this.currentId=0,this.current=e)}reset(){this.set(this.detect())}nextId(){return++this.currentId}get isServer(){return this.current==="server"}get isClient(){return this.current==="client"}detect(){return typeof window>"u"||typeof document>"u"?"server":"client"}handoff(){this.handoffState==="pending"&&(this.handoffState="complete")}get isHandoffComplete(){return this.handoffState==="complete"}},Fy=new OOe;function Tw(n){return Fy.isServer?null:n instanceof Node?n.ownerDocument:n!=null&&n.hasOwnProperty("current")&&n.current instanceof Node?n.current.ownerDocument:document}function Jae(n){typeof queueMicrotask=="function"?queueMicrotask(n):Promise.resolve().then(n).catch(e=>setTimeout(()=>{throw e}))}function yp(){let n=[],e={addEventListener(t,r,i,s){return t.addEventListener(r,i,s),e.add(()=>t.removeEventListener(r,i,s))},requestAnimationFrame(...t){let r=requestAnimationFrame(...t);return e.add(()=>cancelAnimationFrame(r))},nextFrame(...t){return e.requestAnimationFrame(()=>e.requestAnimationFrame(...t))},setTimeout(...t){let r=setTimeout(...t);return e.add(()=>clearTimeout(r))},microTask(...t){let r={current:!0};return Jae(()=>{r.current&&t[0]()}),e.add(()=>{r.current=!1})},style(t,r,i){let s=t.style.getPropertyValue(r);return Object.assign(t.style,{[r]:i}),this.add(()=>{Object.assign(t.style,{[r]:s})})},group(t){let r=yp();return t(r),this.add(()=>r.dispose())},add(t){return n.includes(t)||n.push(t),()=>{let r=n.indexOf(t);if(r>=0)for(let i of n.splice(r,1))i()}},dispose(){for(let t of n.splice(0))t()}};return e}function HD(){let[n]=Ae.useState(yp);return Ae.useEffect(()=>()=>n.dispose(),[n]),n}let Ma=(n,e)=>{Fy.isServer?Ae.useEffect(n,e):Ae.useLayoutEffect(n,e)};function sM(n){let e=Ae.useRef(n);return Ma(()=>{e.current=n},[n]),e}let Mo=function(n){let e=sM(n);return Xl.useCallback((...t)=>e.current(...t),[e])};function FOe(n){let e=n.width/2,t=n.height/2;return{top:n.clientY-t,right:n.clientX+e,bottom:n.clientY+t,left:n.clientX-e}}function NOe(n,e){return!(!n||!e||n.right<e.left||n.left>e.right||n.bottom<e.top||n.top>e.bottom)}function zOe({disabled:n=!1}={}){let e=Ae.useRef(null),[t,r]=Ae.useState(!1),i=HD(),s=Mo(()=>{e.current=null,r(!1),i.dispose()}),a=Mo(l=>{if(i.dispose(),e.current===null){e.current=l.currentTarget,r(!0);{let o=Tw(l.currentTarget);i.addEventListener(o,"pointerup",s,!1),i.addEventListener(o,"pointermove",h=>{if(e.current){let d=FOe(h);r(NOe(d,e.current.getBoundingClientRect()))}},!1),i.addEventListener(o,"pointercancel",s,!1)}}});return{pressed:t,pressProps:n?{}:{onPointerDown:a,onPointerUp:s,onClick:s}}}let UOe=Ae.createContext(void 0);function Qae(){return Ae.useContext(UOe)}function FY(...n){return Array.from(new Set(n.flatMap(e=>typeof e=="string"?e.split(" "):[]))).filter(Boolean).join(" ")}function oM(n,e,...t){if(n in e){let i=e[n];return typeof i=="function"?i(...t):i}let r=new Error(`Tried to handle "${n}" but there is no handler defined. Only defined handlers are: ${Object.keys(e).map(i=>`"${i}"`).join(", ")}.`);throw Error.captureStackTrace&&Error.captureStackTrace(r,oM),r}var UN=(n=>(n[n.None=0]="None",n[n.RenderStrategy=1]="RenderStrategy",n[n.Static=2]="Static",n))(UN||{}),VOe=(n=>(n[n.Unmount=0]="Unmount",n[n.Hidden=1]="Hidden",n))(VOe||{});function Oh(){let n=HOe();return Ae.useCallback(e=>GOe({mergeRefs:n,...e}),[n])}function GOe({ourProps:n,theirProps:e,slot:t,defaultTag:r,features:i,visible:s=!0,name:a,mergeRefs:l}){l=l??jOe;let o=ele(e,n);if(s)return aI(o,t,r,a,l);let h=i??0;if(h&2){let{static:d=!1,...m}=o;if(d)return aI(m,t,r,a,l)}if(h&1){let{unmount:d=!0,...m}=o;return oM(d?0:1,{0(){return null},1(){return aI({...m,hidden:!0,style:{display:"none"}},t,r,a,l)}})}return aI(o,t,r,a,l)}function aI(n,e={},t,r,i){let{as:s=t,children:a,refName:l="ref",...o}=Ik(n,["unmount","static"]),h=n.ref!==void 0?{[l]:n.ref}:{},d=typeof a=="function"?a(e):a;"className"in o&&o.className&&typeof o.className=="function"&&(o.className=o.className(e)),o["aria-labelledby"]&&o["aria-labelledby"]===o.id&&(o["aria-labelledby"]=void 0);let m={};if(e){let _=!1,y=[];for(let[T,I]of Object.entries(e))typeof I=="boolean"&&(_=!0),I===!0&&y.push(T.replace(/([A-Z])/g,C=>`-${C.toLowerCase()}`));if(_){m["data-headlessui-state"]=y.join(" ");for(let T of y)m[`data-${T}`]=""}}if(s===Ae.Fragment&&(Object.keys(N1(o)).length>0||Object.keys(N1(m)).length>0))if(!Ae.isValidElement(d)||Array.isArray(d)&&d.length>1){if(Object.keys(N1(o)).length>0)throw new Error(['Passing props on "Fragment"!',"",`The current component <${r} /> is rendering a "Fragment".`,"However we need to passthrough the following props:",Object.keys(N1(o)).concat(Object.keys(N1(m))).map(_=>`  - ${_}`).join(`
`),"","You can apply a few solutions:",['Add an `as="..."` prop, to ensure that we render an actual element instead of a "Fragment".',"Render a single element as the child so that we can forward the props onto that element."].map(_=>`  - ${_}`).join(`
`)].join(`
`))}else{let _=d.props,y=_==null?void 0:_.className,T=typeof y=="function"?(...M)=>FY(y(...M),o.className):FY(y,o.className),I=T?{className:T}:{},C=ele(d.props,N1(Ik(o,["ref"])));for(let M in m)M in C&&delete m[M];return Ae.cloneElement(d,Object.assign({},C,m,h,{ref:i(WOe(d),h.ref)},I))}return Ae.createElement(s,Object.assign({},Ik(o,["ref"]),s!==Ae.Fragment&&h,s!==Ae.Fragment&&m),d)}function HOe(){let n=Ae.useRef([]),e=Ae.useCallback(t=>{for(let r of n.current)r!=null&&(typeof r=="function"?r(t):r.current=t)},[]);return(...t)=>{if(!t.every(r=>r==null))return n.current=t,e}}function jOe(...n){return n.every(e=>e==null)?void 0:e=>{for(let t of n)t!=null&&(typeof t=="function"?t(e):t.current=e)}}function ele(...n){if(n.length===0)return{};if(n.length===1)return n[0];let e={},t={};for(let r of n)for(let i in r)i.startsWith("on")&&typeof r[i]=="function"?(t[i]!=null||(t[i]=[]),t[i].push(r[i])):e[i]=r[i];if(e.disabled||e["aria-disabled"])for(let r in t)/^(on(?:Click|Pointer|Mouse|Key)(?:Down|Up|Press)?)$/.test(r)&&(t[r]=[i=>{var s;return(s=i==null?void 0:i.preventDefault)==null?void 0:s.call(i)}]);for(let r in t)Object.assign(e,{[r](i,...s){let a=t[r];for(let l of a){if((i instanceof Event||(i==null?void 0:i.nativeEvent)instanceof Event)&&i.defaultPrevented)return;l(i,...s)}}});return e}function tle(...n){if(n.length===0)return{};if(n.length===1)return n[0];let e={},t={};for(let r of n)for(let i in r)i.startsWith("on")&&typeof r[i]=="function"?(t[i]!=null||(t[i]=[]),t[i].push(r[i])):e[i]=r[i];for(let r in t)Object.assign(e,{[r](...i){let s=t[r];for(let a of s)a==null||a(...i)}});return e}function Fh(n){var e;return Object.assign(Ae.forwardRef(n),{displayName:(e=n.displayName)!=null?e:n.name})}function N1(n){let e=Object.assign({},n);for(let t in e)e[t]===void 0&&delete e[t];return e}function Ik(n,e=[]){let t=Object.assign({},n);for(let r of e)r in t&&delete t[r];return t}function WOe(n){return Xl.version.split(".")[0]>="19"?n.props.ref:n.ref}let XOe=Ae.createContext(void 0);function $Oe(){return Ae.useContext(XOe)}function qOe(n){let e=n.parentElement,t=null;for(;e&&!(e instanceof HTMLFieldSetElement);)e instanceof HTMLLegendElement&&(t=e),e=e.parentElement;let r=(e==null?void 0:e.getAttribute("disabled"))==="";return r&&ZOe(t)?!1:r}function ZOe(n){if(!n)return!1;let e=n.previousElementSibling;for(;e!==null;){if(e instanceof HTMLLegendElement)return!1;e=e.previousElementSibling}return!0}let nle=Symbol();function YOe(n,e=!0){return Object.assign(n,{[nle]:e})}function ng(...n){let e=Ae.useRef(n);Ae.useEffect(()=>{e.current=n},[n]);let t=Mo(r=>{for(let i of e.current)i!=null&&(typeof i=="function"?i(r):i.current=r)});return n.every(r=>r==null||(r==null?void 0:r[nle]))?void 0:t}let p8=Ae.createContext(null);p8.displayName="DescriptionContext";function rle(){let n=Ae.useContext(p8);if(n===null){let e=new Error("You used a <Description /> component, but it is not inside a relevant parent.");throw Error.captureStackTrace&&Error.captureStackTrace(e,rle),e}return n}function KOe(){let[n,e]=Ae.useState([]);return[n.length>0?n.join(" "):void 0,Ae.useMemo(()=>function(t){let r=Mo(s=>(e(a=>[...a,s]),()=>e(a=>{let l=a.slice(),o=l.indexOf(s);return o!==-1&&l.splice(o,1),l}))),i=Ae.useMemo(()=>({register:r,slot:t.slot,name:t.name,props:t.props,value:t.value}),[r,t.slot,t.name,t.props,t.value]);return Xl.createElement(p8.Provider,{value:i},t.children)},[e])]}let JOe="p";function QOe(n,e){let t=Ae.useId(),r=Qae(),{id:i=`headlessui-description-${t}`,...s}=n,a=rle(),l=ng(e);Ma(()=>a.register(i),[i,a.register]);let o=r||!1,h=Ae.useMemo(()=>({...a.slot,disabled:o}),[a.slot,o]),d={ref:l,...a.props,id:i};return Oh()({ourProps:d,theirProps:s,slot:h,defaultTag:JOe,name:a.name||"Description"})}let eFe=Fh(QOe);Object.assign(eFe,{});var _l=(n=>(n.Space=" ",n.Enter="Enter",n.Escape="Escape",n.Backspace="Backspace",n.Delete="Delete",n.ArrowLeft="ArrowLeft",n.ArrowUp="ArrowUp",n.ArrowRight="ArrowRight",n.ArrowDown="ArrowDown",n.Home="Home",n.End="End",n.PageUp="PageUp",n.PageDown="PageDown",n.Tab="Tab",n))(_l||{});let jD=Ae.createContext(null);jD.displayName="LabelContext";function m8(){let n=Ae.useContext(jD);if(n===null){let e=new Error("You used a <Label /> component, but it is not inside a relevant parent.");throw Error.captureStackTrace&&Error.captureStackTrace(e,m8),e}return n}function tFe(n){var e,t,r;let i=(t=(e=Ae.useContext(jD))==null?void 0:e.value)!=null?t:void 0;return((r=void 0)!=null?r:0)>0?[i,...n].filter(Boolean).join(" "):i}function ile({inherit:n=!1}={}){let e=tFe(),[t,r]=Ae.useState([]),i=n?[e,...t].filter(Boolean):t;return[i.length>0?i.join(" "):void 0,Ae.useMemo(()=>function(s){let a=Mo(o=>(r(h=>[...h,o]),()=>r(h=>{let d=h.slice(),m=d.indexOf(o);return m!==-1&&d.splice(m,1),d}))),l=Ae.useMemo(()=>({register:a,slot:s.slot,name:s.name,props:s.props,value:s.value}),[a,s.slot,s.name,s.props,s.value]);return Xl.createElement(jD.Provider,{value:l},s.children)},[r])]}let nFe="label";function rFe(n,e){var t;let r=Ae.useId(),i=m8(),s=$Oe(),a=Qae(),{id:l=`headlessui-label-${r}`,htmlFor:o=s??((t=i.props)==null?void 0:t.htmlFor),passive:h=!1,...d}=n,m=ng(e);Ma(()=>i.register(l),[l,i.register]);let _=Mo(C=>{let M=C.currentTarget;if(M instanceof HTMLLabelElement&&C.preventDefault(),i.props&&"onClick"in i.props&&typeof i.props.onClick=="function"&&i.props.onClick(C),M instanceof HTMLLabelElement){let B=document.getElementById(M.htmlFor);if(B){let k=B.getAttribute("disabled");if(k==="true"||k==="")return;let j=B.getAttribute("aria-disabled");if(j==="true"||j==="")return;(B instanceof HTMLInputElement&&(B.type==="radio"||B.type==="checkbox")||B.role==="radio"||B.role==="checkbox"||B.role==="switch")&&B.click(),B.focus({preventScroll:!0})}}}),y=a||!1,T=Ae.useMemo(()=>({...i.slot,disabled:y}),[i.slot,y]),I={ref:m,...i.props,id:l,htmlFor:o,onClick:_};return h&&("onClick"in I&&(delete I.htmlFor,delete I.onClick),"onClick"in d&&delete d.onClick),Oh()({ourProps:I,theirProps:d,slot:T,defaultTag:o?nFe:"div",name:i.name||"Label"})}let iFe=Fh(rFe);Object.assign(iFe,{});function sFe(n){if(n===null)return{width:0,height:0};let{width:e,height:t}=n.getBoundingClientRect();return{width:e,height:t}}function oFe(n,e=!1){let[t,r]=Ae.useReducer(()=>({}),{}),i=Ae.useMemo(()=>sFe(n),[n,t]);return Ma(()=>{if(!n)return;let s=new ResizeObserver(r);return s.observe(n),()=>{s.disconnect()}},[n]),e?{width:`${i.width}px`,height:`${i.height}px`}:i}let aFe=class extends Map{constructor(e){super(),this.factory=e}get(e){let t=super.get(e);return t===void 0&&(t=this.factory(e),this.set(e,t)),t}};function sle(n,e){let t=n(),r=new Set;return{getSnapshot(){return t},subscribe(i){return r.add(i),()=>r.delete(i)},dispatch(i,...s){let a=e[i].call(t,...s);a&&(t=a,r.forEach(l=>l()))}}}function ole(n){return Ae.useSyncExternalStore(n.subscribe,n.getSnapshot,n.getSnapshot)}let lFe=new aFe(()=>sle(()=>[],{ADD(n){return this.includes(n)?this:[...this,n]},REMOVE(n){let e=this.indexOf(n);if(e===-1)return this;let t=this.slice();return t.splice(e,1),t}}));function g8(n,e){let t=lFe.get(e),r=Ae.useId(),i=ole(t);if(Ma(()=>{if(n)return t.dispatch("ADD",r),()=>t.dispatch("REMOVE",r)},[t,n]),!n)return!1;let s=i.indexOf(r),a=i.length;return s===-1&&(s=a,a+=1),s===a-1}let VN=new Map,lA=new Map;function NY(n){var e;let t=(e=lA.get(n))!=null?e:0;return lA.set(n,t+1),t!==0?()=>zY(n):(VN.set(n,{"aria-hidden":n.getAttribute("aria-hidden"),inert:n.inert}),n.setAttribute("aria-hidden","true"),n.inert=!0,()=>zY(n))}function zY(n){var e;let t=(e=lA.get(n))!=null?e:1;if(t===1?lA.delete(n):lA.set(n,t-1),t!==1)return;let r=VN.get(n);r&&(r["aria-hidden"]===null?n.removeAttribute("aria-hidden"):n.setAttribute("aria-hidden",r["aria-hidden"]),n.inert=r.inert,VN.delete(n))}function cFe(n,{allowed:e,disallowed:t}={}){let r=g8(n,"inert-others");Ma(()=>{var i,s;if(!r)return;let a=yp();for(let o of(i=t==null?void 0:t())!=null?i:[])o&&a.add(NY(o));let l=(s=e==null?void 0:e())!=null?s:[];for(let o of l){if(!o)continue;let h=Tw(o);if(!h)continue;let d=o.parentElement;for(;d&&d!==h.body;){for(let m of d.children)l.some(_=>m.contains(_))||a.add(NY(m));d=d.parentElement}}return a.dispose},[r,e,t])}function uFe(n,e,t){let r=sM(i=>{let s=i.getBoundingClientRect();s.x===0&&s.y===0&&s.width===0&&s.height===0&&t()});Ae.useEffect(()=>{if(!n)return;let i=e===null?null:e instanceof HTMLElement?e:e.current;if(!i)return;let s=yp();if(typeof ResizeObserver<"u"){let a=new ResizeObserver(()=>r.current(i));a.observe(i),s.add(()=>a.disconnect())}if(typeof IntersectionObserver<"u"){let a=new IntersectionObserver(()=>r.current(i));a.observe(i),s.add(()=>a.disconnect())}return()=>s.dispose()},[e,r,n])}let GN=["[contentEditable=true]","[tabindex]","a[href]","area[href]","button:not([disabled])","iframe","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].map(n=>`${n}:not([tabindex='-1'])`).join(","),hFe=["[data-autofocus]"].map(n=>`${n}:not([tabindex='-1'])`).join(",");var HN=(n=>(n[n.First=1]="First",n[n.Previous=2]="Previous",n[n.Next=4]="Next",n[n.Last=8]="Last",n[n.WrapAround=16]="WrapAround",n[n.NoScroll=32]="NoScroll",n[n.AutoFocus=64]="AutoFocus",n))(HN||{}),fFe=(n=>(n[n.Error=0]="Error",n[n.Overflow=1]="Overflow",n[n.Success=2]="Success",n[n.Underflow=3]="Underflow",n))(fFe||{}),dFe=(n=>(n[n.Previous=-1]="Previous",n[n.Next=1]="Next",n))(dFe||{});function ale(n=document.body){return n==null?[]:Array.from(n.querySelectorAll(GN)).sort((e,t)=>Math.sign((e.tabIndex||Number.MAX_SAFE_INTEGER)-(t.tabIndex||Number.MAX_SAFE_INTEGER)))}function pFe(n=document.body){return n==null?[]:Array.from(n.querySelectorAll(hFe)).sort((e,t)=>Math.sign((e.tabIndex||Number.MAX_SAFE_INTEGER)-(t.tabIndex||Number.MAX_SAFE_INTEGER)))}var v8=(n=>(n[n.Strict=0]="Strict",n[n.Loose=1]="Loose",n))(v8||{});function _8(n,e=0){var t;return n===((t=Tw(n))==null?void 0:t.body)?!1:oM(e,{0(){return n.matches(GN)},1(){let r=n;for(;r!==null;){if(r.matches(GN))return!0;r=r.parentElement}return!1}})}function lle(n){let e=Tw(n);yp().nextFrame(()=>{e&&!_8(e.activeElement,0)&&gFe(n)})}var mFe=(n=>(n[n.Keyboard=0]="Keyboard",n[n.Mouse=1]="Mouse",n))(mFe||{});typeof window<"u"&&typeof document<"u"&&(document.addEventListener("keydown",n=>{n.metaKey||n.altKey||n.ctrlKey||(document.documentElement.dataset.headlessuiFocusVisible="")},!0),document.addEventListener("click",n=>{n.detail===1?delete document.documentElement.dataset.headlessuiFocusVisible:n.detail===0&&(document.documentElement.dataset.headlessuiFocusVisible="")},!0));function gFe(n){n==null||n.focus({preventScroll:!0})}let vFe=["textarea","input"].join(",");function _Fe(n){var e,t;return(t=(e=n==null?void 0:n.matches)==null?void 0:e.call(n,vFe))!=null?t:!1}function cle(n,e=t=>t){return n.slice().sort((t,r)=>{let i=e(t),s=e(r);if(i===null||s===null)return 0;let a=i.compareDocumentPosition(s);return a&Node.DOCUMENT_POSITION_FOLLOWING?-1:a&Node.DOCUMENT_POSITION_PRECEDING?1:0})}function yFe(n,e){return xFe(ale(),e,{relativeTo:n})}function xFe(n,e,{sorted:t=!0,relativeTo:r=null,skipElements:i=[]}={}){let s=Array.isArray(n)?n.length>0?n[0].ownerDocument:document:n.ownerDocument,a=Array.isArray(n)?t?cle(n):n:e&64?pFe(n):ale(n);i.length>0&&a.length>1&&(a=a.filter(y=>!i.some(T=>T!=null&&"current"in T?(T==null?void 0:T.current)===y:T===y))),r=r??s.activeElement;let l=(()=>{if(e&5)return 1;if(e&10)return-1;throw new Error("Missing Focus.First, Focus.Previous, Focus.Next or Focus.Last")})(),o=(()=>{if(e&1)return 0;if(e&2)return Math.max(0,a.indexOf(r))-1;if(e&4)return Math.max(0,a.indexOf(r))+1;if(e&8)return a.length-1;throw new Error("Missing Focus.First, Focus.Previous, Focus.Next or Focus.Last")})(),h=e&32?{preventScroll:!0}:{},d=0,m=a.length,_;do{if(d>=m||d+m<=0)return 0;let y=o+d;if(e&16)y=(y+m)%m;else{if(y<0)return 3;if(y>=m)return 1}_=a[y],_==null||_.focus(h),d+=l}while(_!==s.activeElement);return e&6&&_Fe(_)&&_.select(),2}function ule(){return/iPhone/gi.test(window.navigator.platform)||/Mac/gi.test(window.navigator.platform)&&window.navigator.maxTouchPoints>0}function bFe(){return/Android/gi.test(window.navigator.userAgent)}function wFe(){return ule()||bFe()}function rS(n,e,t,r){let i=sM(t);Ae.useEffect(()=>{if(!n)return;function s(a){i.current(a)}return document.addEventListener(e,s,r),()=>document.removeEventListener(e,s,r)},[n,e,r])}function SFe(n,e,t,r){let i=sM(t);Ae.useEffect(()=>{if(!n)return;function s(a){i.current(a)}return window.addEventListener(e,s,r),()=>window.removeEventListener(e,s,r)},[n,e,r])}const UY=30;function AFe(n,e,t){let r=g8(n,"outside-click"),i=sM(t),s=Ae.useCallback(function(o,h){if(o.defaultPrevented)return;let d=h(o);if(d===null||!d.getRootNode().contains(d)||!d.isConnected)return;let m=function _(y){return typeof y=="function"?_(y()):Array.isArray(y)||y instanceof Set?y:[y]}(e);for(let _ of m)if(_!==null&&(_.contains(d)||o.composed&&o.composedPath().includes(_)))return;return!_8(d,v8.Loose)&&d.tabIndex!==-1&&o.preventDefault(),i.current(o,d)},[i,e]),a=Ae.useRef(null);rS(r,"pointerdown",o=>{var h,d;a.current=((d=(h=o.composedPath)==null?void 0:h.call(o))==null?void 0:d[0])||o.target},!0),rS(r,"mousedown",o=>{var h,d;a.current=((d=(h=o.composedPath)==null?void 0:h.call(o))==null?void 0:d[0])||o.target},!0),rS(r,"click",o=>{wFe()||a.current&&(s(o,()=>a.current),a.current=null)},!0);let l=Ae.useRef({x:0,y:0});rS(r,"touchstart",o=>{l.current.x=o.touches[0].clientX,l.current.y=o.touches[0].clientY},!0),rS(r,"touchend",o=>{let h={x:o.changedTouches[0].clientX,y:o.changedTouches[0].clientY};if(!(Math.abs(h.x-l.current.x)>=UY||Math.abs(h.y-l.current.y)>=UY))return s(o,()=>o.target instanceof HTMLElement?o.target:null)},!0),SFe(r,"blur",o=>s(o,()=>window.document.activeElement instanceof HTMLIFrameElement?window.document.activeElement:null),!0)}function y8(...n){return Ae.useMemo(()=>Tw(...n),[...n])}function TFe(n,e){return Ae.useMemo(()=>{var t;if(n.type)return n.type;let r=(t=n.as)!=null?t:"button";if(typeof r=="string"&&r.toLowerCase()==="button"||(e==null?void 0:e.tagName)==="BUTTON"&&!e.hasAttribute("type"))return"button"},[n.type,n.as,e])}function MFe(){let n;return{before({doc:e}){var t;let r=e.documentElement,i=(t=e.defaultView)!=null?t:window;n=Math.max(0,i.innerWidth-r.clientWidth)},after({doc:e,d:t}){let r=e.documentElement,i=Math.max(0,r.clientWidth-r.offsetWidth),s=Math.max(0,n-i);t.style(r,"paddingRight",`${s}px`)}}}function CFe(){return ule()?{before({doc:n,d:e,meta:t}){function r(i){return t.containers.flatMap(s=>s()).some(s=>s.contains(i))}e.microTask(()=>{var i;if(window.getComputedStyle(n.documentElement).scrollBehavior!=="auto"){let l=yp();l.style(n.documentElement,"scrollBehavior","auto"),e.add(()=>e.microTask(()=>l.dispose()))}let s=(i=window.scrollY)!=null?i:window.pageYOffset,a=null;e.addEventListener(n,"click",l=>{if(l.target instanceof HTMLElement)try{let o=l.target.closest("a");if(!o)return;let{hash:h}=new URL(o.href),d=n.querySelector(h);d&&!r(d)&&(a=d)}catch{}},!0),e.addEventListener(n,"touchstart",l=>{if(l.target instanceof HTMLElement)if(r(l.target)){let o=l.target;for(;o.parentElement&&r(o.parentElement);)o=o.parentElement;e.style(o,"overscrollBehavior","contain")}else e.style(l.target,"touchAction","none")}),e.addEventListener(n,"touchmove",l=>{if(l.target instanceof HTMLElement){if(l.target.tagName==="INPUT")return;if(r(l.target)){let o=l.target;for(;o.parentElement&&o.dataset.headlessuiPortal!==""&&!(o.scrollHeight>o.clientHeight||o.scrollWidth>o.clientWidth);)o=o.parentElement;o.dataset.headlessuiPortal===""&&l.preventDefault()}else l.preventDefault()}},{passive:!1}),e.add(()=>{var l;let o=(l=window.scrollY)!=null?l:window.pageYOffset;s!==o&&window.scrollTo(0,s),a&&a.isConnected&&(a.scrollIntoView({block:"nearest"}),a=null)})})}}:{}}function EFe(){return{before({doc:n,d:e}){e.style(n.documentElement,"overflow","hidden")}}}function IFe(n){let e={};for(let t of n)Object.assign(e,t(e));return e}let Ay=sle(()=>new Map,{PUSH(n,e){var t;let r=(t=this.get(n))!=null?t:{doc:n,count:0,d:yp(),meta:new Set};return r.count++,r.meta.add(e),this.set(n,r),this},POP(n,e){let t=this.get(n);return t&&(t.count--,t.meta.delete(e)),this},SCROLL_PREVENT({doc:n,d:e,meta:t}){let r={doc:n,d:e,meta:IFe(t)},i=[CFe(),MFe(),EFe()];i.forEach(({before:s})=>s==null?void 0:s(r)),i.forEach(({after:s})=>s==null?void 0:s(r))},SCROLL_ALLOW({d:n}){n.dispose()},TEARDOWN({doc:n}){this.delete(n)}});Ay.subscribe(()=>{let n=Ay.getSnapshot(),e=new Map;for(let[t]of n)e.set(t,t.documentElement.style.overflow);for(let t of n.values()){let r=e.get(t.doc)==="hidden",i=t.count!==0;(i&&!r||!i&&r)&&Ay.dispatch(t.count>0?"SCROLL_PREVENT":"SCROLL_ALLOW",t),t.count===0&&Ay.dispatch("TEARDOWN",t)}});function RFe(n,e,t=()=>({containers:[]})){let r=ole(Ay),i=e?r.get(e):void 0,s=i?i.count>0:!1;return Ma(()=>{if(!(!e||!n))return Ay.dispatch("PUSH",e,t),()=>Ay.dispatch("POP",e,t)},[n,e]),s}function PFe(n,e,t=()=>[document.body]){let r=g8(n,"scroll-lock");RFe(r,e,i=>{var s;return{containers:[...(s=i.containers)!=null?s:[],t]}})}function VY(n){return[n.screenX,n.screenY]}function LFe(){let n=Ae.useRef([-1,-1]);return{wasMoved(e){let t=VY(e);return n.current[0]===t[0]&&n.current[1]===t[1]?!1:(n.current=t,!0)},update(e){n.current=VY(e)}}}function DFe(n=0){let[e,t]=Ae.useState(n),r=Ae.useCallback(o=>t(o),[e]),i=Ae.useCallback(o=>t(h=>h|o),[e]),s=Ae.useCallback(o=>(e&o)===o,[e]),a=Ae.useCallback(o=>t(h=>h&~o),[t]),l=Ae.useCallback(o=>t(h=>h^o),[t]);return{flags:e,setFlag:r,addFlag:i,hasFlag:s,removeFlag:a,toggleFlag:l}}var BFe={},GY,HY;typeof process<"u"&&typeof globalThis<"u"&&typeof Element<"u"&&((GY=process==null?void 0:BFe)==null?void 0:GY.NODE_ENV)==="test"&&typeof((HY=Element==null?void 0:Element.prototype)==null?void 0:HY.getAnimations)>"u"&&(Element.prototype.getAnimations=function(){return console.warn(["Headless UI has polyfilled `Element.prototype.getAnimations` for your tests.","Please install a proper polyfill e.g. `jsdom-testing-mocks`, to silence these warnings.","","Example usage:","```js","import { mockAnimationsApi } from 'jsdom-testing-mocks'","mockAnimationsApi()","```"].join(`
`)),[]});var kFe=(n=>(n[n.None=0]="None",n[n.Closed=1]="Closed",n[n.Enter=2]="Enter",n[n.Leave=4]="Leave",n))(kFe||{});function OFe(n){let e={};for(let t in n)n[t]===!0&&(e[`data-${t}`]="");return e}function FFe(n,e,t,r){let[i,s]=Ae.useState(t),{hasFlag:a,addFlag:l,removeFlag:o}=DFe(n&&i?3:0),h=Ae.useRef(!1),d=Ae.useRef(!1),m=HD();return Ma(()=>{var _;if(n){if(t&&s(!0),!e){t&&l(3);return}return(_=void 0)==null||_.call(r,t),NFe(e,{inFlight:h,prepare(){d.current?d.current=!1:d.current=h.current,h.current=!0,!d.current&&(t?(l(3),o(4)):(l(4),o(2)))},run(){d.current?t?(o(3),l(4)):(o(4),l(3)):t?o(1):l(1)},done(){var y;d.current&&typeof e.getAnimations=="function"&&e.getAnimations().length>0||(h.current=!1,o(7),t||s(!1),(y=void 0)==null||y.call(r,t))}})}},[n,t,e,m]),n?[i,{closed:a(1),enter:a(2),leave:a(4),transition:a(2)||a(4)}]:[t,{closed:void 0,enter:void 0,leave:void 0,transition:void 0}]}function NFe(n,{prepare:e,run:t,done:r,inFlight:i}){let s=yp();return UFe(n,{prepare:e,inFlight:i}),s.nextFrame(()=>{t(),s.requestAnimationFrame(()=>{s.add(zFe(n,r))})}),s.dispose}function zFe(n,e){var t,r;let i=yp();if(!n)return i.dispose;let s=!1;i.add(()=>{s=!0});let a=(r=(t=n.getAnimations)==null?void 0:t.call(n).filter(l=>l instanceof CSSTransition))!=null?r:[];return a.length===0?(e(),i.dispose):(Promise.allSettled(a.map(l=>l.finished)).then(()=>{s||e()}),i.dispose)}function UFe(n,{inFlight:e,prepare:t}){if(e!=null&&e.current){t();return}let r=n.style.transition;n.style.transition="none",t(),n.offsetHeight,n.style.transition=r}function VFe(n,{container:e,accept:t,walk:r}){let i=Ae.useRef(t),s=Ae.useRef(r);Ae.useEffect(()=>{i.current=t,s.current=r},[t,r]),Ma(()=>{if(!e||!n)return;let a=Tw(e);if(!a)return;let l=i.current,o=s.current,h=Object.assign(m=>l(m),{acceptNode:l}),d=a.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,h,!1);for(;d.nextNode();)o(d.currentNode)},[e,n,i,s])}function WD(){return typeof window<"u"}function Mw(n){return hle(n)?(n.nodeName||"").toLowerCase():"#document"}function Bu(n){var e;return(n==null||(e=n.ownerDocument)==null?void 0:e.defaultView)||window}function xp(n){var e;return(e=(hle(n)?n.ownerDocument:n.document)||window.document)==null?void 0:e.documentElement}function hle(n){return WD()?n instanceof Node||n instanceof Bu(n).Node:!1}function Ac(n){return WD()?n instanceof Element||n instanceof Bu(n).Element:!1}function dp(n){return WD()?n instanceof HTMLElement||n instanceof Bu(n).HTMLElement:!1}function jY(n){return!WD()||typeof ShadowRoot>"u"?!1:n instanceof ShadowRoot||n instanceof Bu(n).ShadowRoot}function aM(n){const{overflow:e,overflowX:t,overflowY:r,display:i}=Yf(n);return/auto|scroll|overlay|hidden|clip/.test(e+r+t)&&!["inline","contents"].includes(i)}function GFe(n){return["table","td","th"].includes(Mw(n))}function XD(n){return[":popover-open",":modal"].some(e=>{try{return n.matches(e)}catch{return!1}})}function x8(n){const e=b8(),t=Ac(n)?Yf(n):n;return t.transform!=="none"||t.perspective!=="none"||(t.containerType?t.containerType!=="normal":!1)||!e&&(t.backdropFilter?t.backdropFilter!=="none":!1)||!e&&(t.filter?t.filter!=="none":!1)||["transform","perspective","filter"].some(r=>(t.willChange||"").includes(r))||["paint","layout","strict","content"].some(r=>(t.contain||"").includes(r))}function HFe(n){let e=gv(n);for(;dp(e)&&!iw(e);){if(x8(e))return e;if(XD(e))return null;e=gv(e)}return null}function b8(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function iw(n){return["html","body","#document"].includes(Mw(n))}function Yf(n){return Bu(n).getComputedStyle(n)}function $D(n){return Ac(n)?{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}:{scrollLeft:n.scrollX,scrollTop:n.scrollY}}function gv(n){if(Mw(n)==="html")return n;const e=n.assignedSlot||n.parentNode||jY(n)&&n.host||xp(n);return jY(e)?e.host:e}function fle(n){const e=gv(n);return iw(e)?n.ownerDocument?n.ownerDocument.body:n.body:dp(e)&&aM(e)?e:fle(e)}function uT(n,e,t){var r;e===void 0&&(e=[]),t===void 0&&(t=!0);const i=fle(n),s=i===((r=n.ownerDocument)==null?void 0:r.body),a=Bu(i);if(s){const l=jN(a);return e.concat(a,a.visualViewport||[],aM(i)?i:[],l&&t?uT(l):[])}return e.concat(i,uT(i,[],t))}function jN(n){return n.parent&&Object.getPrototypeOf(n.parent)?n.frameElement:null}function jFe(){const n=navigator.userAgentData;return n&&Array.isArray(n.brands)?n.brands.map(e=>{let{brand:t,version:r}=e;return t+"/"+r}).join(" "):navigator.userAgent}const sx=Math.min,Gl=Math.max,hT=Math.round,lI=Math.floor,lp=n=>({x:n,y:n}),WFe={left:"right",right:"left",bottom:"top",top:"bottom"},XFe={start:"end",end:"start"};function WY(n,e,t){return Gl(n,sx(e,t))}function Cw(n,e){return typeof n=="function"?n(e):n}function vv(n){return n.split("-")[0]}function lM(n){return n.split("-")[1]}function dle(n){return n==="x"?"y":"x"}function ple(n){return n==="y"?"height":"width"}function ox(n){return["top","bottom"].includes(vv(n))?"y":"x"}function mle(n){return dle(ox(n))}function $Fe(n,e,t){t===void 0&&(t=!1);const r=lM(n),i=mle(n),s=ple(i);let a=i==="x"?r===(t?"end":"start")?"right":"left":r==="start"?"bottom":"top";return e.reference[s]>e.floating[s]&&(a=jP(a)),[a,jP(a)]}function qFe(n){const e=jP(n);return[WN(n),e,WN(e)]}function WN(n){return n.replace(/start|end/g,e=>XFe[e])}function ZFe(n,e,t){const r=["left","right"],i=["right","left"],s=["top","bottom"],a=["bottom","top"];switch(n){case"top":case"bottom":return t?e?i:r:e?r:i;case"left":case"right":return e?s:a;default:return[]}}function YFe(n,e,t,r){const i=lM(n);let s=ZFe(vv(n),t==="start",r);return i&&(s=s.map(a=>a+"-"+i),e&&(s=s.concat(s.map(WN)))),s}function jP(n){return n.replace(/left|right|bottom|top/g,e=>WFe[e])}function KFe(n){return{top:0,right:0,bottom:0,left:0,...n}}function JFe(n){return typeof n!="number"?KFe(n):{top:n,right:n,bottom:n,left:n}}function WP(n){const{x:e,y:t,width:r,height:i}=n;return{width:r,height:i,top:t,left:e,right:e+r,bottom:t+i,x:e,y:t}}function XY(n,e,t){let{reference:r,floating:i}=n;const s=ox(e),a=mle(e),l=ple(a),o=vv(e),h=s==="y",d=r.x+r.width/2-i.width/2,m=r.y+r.height/2-i.height/2,_=r[l]/2-i[l]/2;let y;switch(o){case"top":y={x:d,y:r.y-i.height};break;case"bottom":y={x:d,y:r.y+r.height};break;case"right":y={x:r.x+r.width,y:m};break;case"left":y={x:r.x-i.width,y:m};break;default:y={x:r.x,y:r.y}}switch(lM(e)){case"start":y[a]-=_*(t&&h?-1:1);break;case"end":y[a]+=_*(t&&h?-1:1);break}return y}const QFe=async(n,e,t)=>{const{placement:r="bottom",strategy:i="absolute",middleware:s=[],platform:a}=t,l=s.filter(Boolean),o=await(a.isRTL==null?void 0:a.isRTL(e));let h=await a.getElementRects({reference:n,floating:e,strategy:i}),{x:d,y:m}=XY(h,r,o),_=r,y={},T=0;for(let I=0;I<l.length;I++){const{name:C,fn:M}=l[I],{x:B,y:k,data:j,reset:q}=await M({x:d,y:m,initialPlacement:r,placement:_,strategy:i,middlewareData:y,rects:h,platform:a,elements:{reference:n,floating:e}});d=B??d,m=k??m,y={...y,[C]:{...y[C],...j}},q&&T<=50&&(T++,typeof q=="object"&&(q.placement&&(_=q.placement),q.rects&&(h=q.rects===!0?await a.getElementRects({reference:n,floating:e,strategy:i}):q.rects),{x:d,y:m}=XY(h,_,o)),I=-1)}return{x:d,y:m,placement:_,strategy:i,middlewareData:y}};async function qD(n,e){var t;e===void 0&&(e={});const{x:r,y:i,platform:s,rects:a,elements:l,strategy:o}=n,{boundary:h="clippingAncestors",rootBoundary:d="viewport",elementContext:m="floating",altBoundary:_=!1,padding:y=0}=Cw(e,n),T=JFe(y),C=l[_?m==="floating"?"reference":"floating":m],M=WP(await s.getClippingRect({element:(t=await(s.isElement==null?void 0:s.isElement(C)))==null||t?C:C.contextElement||await(s.getDocumentElement==null?void 0:s.getDocumentElement(l.floating)),boundary:h,rootBoundary:d,strategy:o})),B=m==="floating"?{x:r,y:i,width:a.floating.width,height:a.floating.height}:a.reference,k=await(s.getOffsetParent==null?void 0:s.getOffsetParent(l.floating)),j=await(s.isElement==null?void 0:s.isElement(k))?await(s.getScale==null?void 0:s.getScale(k))||{x:1,y:1}:{x:1,y:1},q=WP(s.convertOffsetParentRelativeRectToViewportRelativeRect?await s.convertOffsetParentRelativeRectToViewportRelativeRect({elements:l,rect:B,offsetParent:k,strategy:o}):B);return{top:(M.top-q.top+T.top)/j.y,bottom:(q.bottom-M.bottom+T.bottom)/j.y,left:(M.left-q.left+T.left)/j.x,right:(q.right-M.right+T.right)/j.x}}const eNe=function(n){return n===void 0&&(n={}),{name:"flip",options:n,async fn(e){var t,r;const{placement:i,middlewareData:s,rects:a,initialPlacement:l,platform:o,elements:h}=e,{mainAxis:d=!0,crossAxis:m=!0,fallbackPlacements:_,fallbackStrategy:y="bestFit",fallbackAxisSideDirection:T="none",flipAlignment:I=!0,...C}=Cw(n,e);if((t=s.arrow)!=null&&t.alignmentOffset)return{};const M=vv(i),B=ox(l),k=vv(l)===l,j=await(o.isRTL==null?void 0:o.isRTL(h.floating)),q=_||(k||!I?[jP(l)]:qFe(l)),Z=T!=="none";!_&&Z&&q.push(...YFe(l,I,T,j));const te=[l,...q],ie=await qD(e,C),se=[];let ae=((r=s.flip)==null?void 0:r.overflows)||[];if(d&&se.push(ie[M]),m){const Re=$Fe(i,a,j);se.push(ie[Re[0]],ie[Re[1]])}if(ae=[...ae,{placement:i,overflows:se}],!se.every(Re=>Re<=0)){var fe,Se;const Re=(((fe=s.flip)==null?void 0:fe.index)||0)+1,qe=te[Re];if(qe)return{data:{index:Re,overflows:ae},reset:{placement:qe}};let Le=(Se=ae.filter(dt=>dt.overflows[0]<=0).sort((dt,ye)=>dt.overflows[1]-ye.overflows[1])[0])==null?void 0:Se.placement;if(!Le)switch(y){case"bestFit":{var Ee;const dt=(Ee=ae.filter(ye=>{if(Z){const Xe=ox(ye.placement);return Xe===B||Xe==="y"}return!0}).map(ye=>[ye.placement,ye.overflows.filter(Xe=>Xe>0).reduce((Xe,He)=>Xe+He,0)]).sort((ye,Xe)=>ye[1]-Xe[1])[0])==null?void 0:Ee[0];dt&&(Le=dt);break}case"initialPlacement":Le=l;break}if(i!==Le)return{reset:{placement:Le}}}return{}}}};async function tNe(n,e){const{placement:t,platform:r,elements:i}=n,s=await(r.isRTL==null?void 0:r.isRTL(i.floating)),a=vv(t),l=lM(t),o=ox(t)==="y",h=["left","top"].includes(a)?-1:1,d=s&&o?-1:1,m=Cw(e,n);let{mainAxis:_,crossAxis:y,alignmentAxis:T}=typeof m=="number"?{mainAxis:m,crossAxis:0,alignmentAxis:null}:{mainAxis:m.mainAxis||0,crossAxis:m.crossAxis||0,alignmentAxis:m.alignmentAxis};return l&&typeof T=="number"&&(y=l==="end"?T*-1:T),o?{x:y*d,y:_*h}:{x:_*h,y:y*d}}const nNe=function(n){return n===void 0&&(n=0),{name:"offset",options:n,async fn(e){var t,r;const{x:i,y:s,placement:a,middlewareData:l}=e,o=await tNe(e,n);return a===((t=l.offset)==null?void 0:t.placement)&&(r=l.arrow)!=null&&r.alignmentOffset?{}:{x:i+o.x,y:s+o.y,data:{...o,placement:a}}}}},rNe=function(n){return n===void 0&&(n={}),{name:"shift",options:n,async fn(e){const{x:t,y:r,placement:i}=e,{mainAxis:s=!0,crossAxis:a=!1,limiter:l={fn:C=>{let{x:M,y:B}=C;return{x:M,y:B}}},...o}=Cw(n,e),h={x:t,y:r},d=await qD(e,o),m=ox(vv(i)),_=dle(m);let y=h[_],T=h[m];if(s){const C=_==="y"?"top":"left",M=_==="y"?"bottom":"right",B=y+d[C],k=y-d[M];y=WY(B,y,k)}if(a){const C=m==="y"?"top":"left",M=m==="y"?"bottom":"right",B=T+d[C],k=T-d[M];T=WY(B,T,k)}const I=l.fn({...e,[_]:y,[m]:T});return{...I,data:{x:I.x-t,y:I.y-r,enabled:{[_]:s,[m]:a}}}}}},iNe=function(n){return n===void 0&&(n={}),{name:"size",options:n,async fn(e){var t,r;const{placement:i,rects:s,platform:a,elements:l}=e,{apply:o=()=>{},...h}=Cw(n,e),d=await qD(e,h),m=vv(i),_=lM(i),y=ox(i)==="y",{width:T,height:I}=s.floating;let C,M;m==="top"||m==="bottom"?(C=m,M=_===(await(a.isRTL==null?void 0:a.isRTL(l.floating))?"start":"end")?"left":"right"):(M=m,C=_==="end"?"top":"bottom");const B=I-d.top-d.bottom,k=T-d.left-d.right,j=sx(I-d[C],B),q=sx(T-d[M],k),Z=!e.middlewareData.shift;let te=j,ie=q;if((t=e.middlewareData.shift)!=null&&t.enabled.x&&(ie=k),(r=e.middlewareData.shift)!=null&&r.enabled.y&&(te=B),Z&&!_){const ae=Gl(d.left,0),fe=Gl(d.right,0),Se=Gl(d.top,0),Ee=Gl(d.bottom,0);y?ie=T-2*(ae!==0||fe!==0?ae+fe:Gl(d.left,d.right)):te=I-2*(Se!==0||Ee!==0?Se+Ee:Gl(d.top,d.bottom))}await o({...e,availableWidth:ie,availableHeight:te});const se=await a.getDimensions(l.floating);return T!==se.width||I!==se.height?{reset:{rects:!0}}:{}}}};function gle(n){const e=Yf(n);let t=parseFloat(e.width)||0,r=parseFloat(e.height)||0;const i=dp(n),s=i?n.offsetWidth:t,a=i?n.offsetHeight:r,l=hT(t)!==s||hT(r)!==a;return l&&(t=s,r=a),{width:t,height:r,$:l}}function w8(n){return Ac(n)?n:n.contextElement}function Ob(n){const e=w8(n);if(!dp(e))return lp(1);const t=e.getBoundingClientRect(),{width:r,height:i,$:s}=gle(e);let a=(s?hT(t.width):t.width)/r,l=(s?hT(t.height):t.height)/i;return(!a||!Number.isFinite(a))&&(a=1),(!l||!Number.isFinite(l))&&(l=1),{x:a,y:l}}const sNe=lp(0);function vle(n){const e=Bu(n);return!b8()||!e.visualViewport?sNe:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function oNe(n,e,t){return e===void 0&&(e=!1),!t||e&&t!==Bu(n)?!1:e}function ax(n,e,t,r){e===void 0&&(e=!1),t===void 0&&(t=!1);const i=n.getBoundingClientRect(),s=w8(n);let a=lp(1);e&&(r?Ac(r)&&(a=Ob(r)):a=Ob(n));const l=oNe(s,t,r)?vle(s):lp(0);let o=(i.left+l.x)/a.x,h=(i.top+l.y)/a.y,d=i.width/a.x,m=i.height/a.y;if(s){const _=Bu(s),y=r&&Ac(r)?Bu(r):r;let T=_,I=jN(T);for(;I&&r&&y!==T;){const C=Ob(I),M=I.getBoundingClientRect(),B=Yf(I),k=M.left+(I.clientLeft+parseFloat(B.paddingLeft))*C.x,j=M.top+(I.clientTop+parseFloat(B.paddingTop))*C.y;o*=C.x,h*=C.y,d*=C.x,m*=C.y,o+=k,h+=j,T=Bu(I),I=jN(T)}}return WP({width:d,height:m,x:o,y:h})}function S8(n,e){const t=$D(n).scrollLeft;return e?e.left+t:ax(xp(n)).left+t}function _le(n,e,t){t===void 0&&(t=!1);const r=n.getBoundingClientRect(),i=r.left+e.scrollLeft-(t?0:S8(n,r)),s=r.top+e.scrollTop;return{x:i,y:s}}function aNe(n){let{elements:e,rect:t,offsetParent:r,strategy:i}=n;const s=i==="fixed",a=xp(r),l=e?XD(e.floating):!1;if(r===a||l&&s)return t;let o={scrollLeft:0,scrollTop:0},h=lp(1);const d=lp(0),m=dp(r);if((m||!m&&!s)&&((Mw(r)!=="body"||aM(a))&&(o=$D(r)),dp(r))){const y=ax(r);h=Ob(r),d.x=y.x+r.clientLeft,d.y=y.y+r.clientTop}const _=a&&!m&&!s?_le(a,o,!0):lp(0);return{width:t.width*h.x,height:t.height*h.y,x:t.x*h.x-o.scrollLeft*h.x+d.x+_.x,y:t.y*h.y-o.scrollTop*h.y+d.y+_.y}}function lNe(n){return Array.from(n.getClientRects())}function cNe(n){const e=xp(n),t=$D(n),r=n.ownerDocument.body,i=Gl(e.scrollWidth,e.clientWidth,r.scrollWidth,r.clientWidth),s=Gl(e.scrollHeight,e.clientHeight,r.scrollHeight,r.clientHeight);let a=-t.scrollLeft+S8(n);const l=-t.scrollTop;return Yf(r).direction==="rtl"&&(a+=Gl(e.clientWidth,r.clientWidth)-i),{width:i,height:s,x:a,y:l}}function uNe(n,e){const t=Bu(n),r=xp(n),i=t.visualViewport;let s=r.clientWidth,a=r.clientHeight,l=0,o=0;if(i){s=i.width,a=i.height;const h=b8();(!h||h&&e==="fixed")&&(l=i.offsetLeft,o=i.offsetTop)}return{width:s,height:a,x:l,y:o}}function hNe(n,e){const t=ax(n,!0,e==="fixed"),r=t.top+n.clientTop,i=t.left+n.clientLeft,s=dp(n)?Ob(n):lp(1),a=n.clientWidth*s.x,l=n.clientHeight*s.y,o=i*s.x,h=r*s.y;return{width:a,height:l,x:o,y:h}}function $Y(n,e,t){let r;if(e==="viewport")r=uNe(n,t);else if(e==="document")r=cNe(xp(n));else if(Ac(e))r=hNe(e,t);else{const i=vle(n);r={x:e.x-i.x,y:e.y-i.y,width:e.width,height:e.height}}return WP(r)}function yle(n,e){const t=gv(n);return t===e||!Ac(t)||iw(t)?!1:Yf(t).position==="fixed"||yle(t,e)}function fNe(n,e){const t=e.get(n);if(t)return t;let r=uT(n,[],!1).filter(l=>Ac(l)&&Mw(l)!=="body"),i=null;const s=Yf(n).position==="fixed";let a=s?gv(n):n;for(;Ac(a)&&!iw(a);){const l=Yf(a),o=x8(a);!o&&l.position==="fixed"&&(i=null),(s?!o&&!i:!o&&l.position==="static"&&!!i&&["absolute","fixed"].includes(i.position)||aM(a)&&!o&&yle(n,a))?r=r.filter(d=>d!==a):i=l,a=gv(a)}return e.set(n,r),r}function dNe(n){let{element:e,boundary:t,rootBoundary:r,strategy:i}=n;const a=[...t==="clippingAncestors"?XD(e)?[]:fNe(e,this._c):[].concat(t),r],l=a[0],o=a.reduce((h,d)=>{const m=$Y(e,d,i);return h.top=Gl(m.top,h.top),h.right=sx(m.right,h.right),h.bottom=sx(m.bottom,h.bottom),h.left=Gl(m.left,h.left),h},$Y(e,l,i));return{width:o.right-o.left,height:o.bottom-o.top,x:o.left,y:o.top}}function pNe(n){const{width:e,height:t}=gle(n);return{width:e,height:t}}function mNe(n,e,t){const r=dp(e),i=xp(e),s=t==="fixed",a=ax(n,!0,s,e);let l={scrollLeft:0,scrollTop:0};const o=lp(0);if(r||!r&&!s)if((Mw(e)!=="body"||aM(i))&&(l=$D(e)),r){const _=ax(e,!0,s,e);o.x=_.x+e.clientLeft,o.y=_.y+e.clientTop}else i&&(o.x=S8(i));const h=i&&!r&&!s?_le(i,l):lp(0),d=a.left+l.scrollLeft-o.x-h.x,m=a.top+l.scrollTop-o.y-h.y;return{x:d,y:m,width:a.width,height:a.height}}function Rk(n){return Yf(n).position==="static"}function qY(n,e){if(!dp(n)||Yf(n).position==="fixed")return null;if(e)return e(n);let t=n.offsetParent;return xp(n)===t&&(t=t.ownerDocument.body),t}function xle(n,e){const t=Bu(n);if(XD(n))return t;if(!dp(n)){let i=gv(n);for(;i&&!iw(i);){if(Ac(i)&&!Rk(i))return i;i=gv(i)}return t}let r=qY(n,e);for(;r&&GFe(r)&&Rk(r);)r=qY(r,e);return r&&iw(r)&&Rk(r)&&!x8(r)?t:r||HFe(n)||t}const gNe=async function(n){const e=this.getOffsetParent||xle,t=this.getDimensions,r=await t(n.floating);return{reference:mNe(n.reference,await e(n.floating),n.strategy),floating:{x:0,y:0,width:r.width,height:r.height}}};function vNe(n){return Yf(n).direction==="rtl"}const _Ne={convertOffsetParentRelativeRectToViewportRelativeRect:aNe,getDocumentElement:xp,getClippingRect:dNe,getOffsetParent:xle,getElementRects:gNe,getClientRects:lNe,getDimensions:pNe,getScale:Ob,isElement:Ac,isRTL:vNe};function yNe(n,e){let t=null,r;const i=xp(n);function s(){var l;clearTimeout(r),(l=t)==null||l.disconnect(),t=null}function a(l,o){l===void 0&&(l=!1),o===void 0&&(o=1),s();const{left:h,top:d,width:m,height:_}=n.getBoundingClientRect();if(l||e(),!m||!_)return;const y=lI(d),T=lI(i.clientWidth-(h+m)),I=lI(i.clientHeight-(d+_)),C=lI(h),B={rootMargin:-y+"px "+-T+"px "+-I+"px "+-C+"px",threshold:Gl(0,sx(1,o))||1};let k=!0;function j(q){const Z=q[0].intersectionRatio;if(Z!==o){if(!k)return a();Z?a(!1,Z):r=setTimeout(()=>{a(!1,1e-7)},1e3)}k=!1}try{t=new IntersectionObserver(j,{...B,root:i.ownerDocument})}catch{t=new IntersectionObserver(j,B)}t.observe(n)}return a(!0),s}function xNe(n,e,t,r){r===void 0&&(r={});const{ancestorScroll:i=!0,ancestorResize:s=!0,elementResize:a=typeof ResizeObserver=="function",layoutShift:l=typeof IntersectionObserver=="function",animationFrame:o=!1}=r,h=w8(n),d=i||s?[...h?uT(h):[],...uT(e)]:[];d.forEach(M=>{i&&M.addEventListener("scroll",t,{passive:!0}),s&&M.addEventListener("resize",t)});const m=h&&l?yNe(h,t):null;let _=-1,y=null;a&&(y=new ResizeObserver(M=>{let[B]=M;B&&B.target===h&&y&&(y.unobserve(e),cancelAnimationFrame(_),_=requestAnimationFrame(()=>{var k;(k=y)==null||k.observe(e)})),t()}),h&&!o&&y.observe(h),y.observe(e));let T,I=o?ax(n):null;o&&C();function C(){const M=ax(n);I&&(M.x!==I.x||M.y!==I.y||M.width!==I.width||M.height!==I.height)&&t(),I=M,T=requestAnimationFrame(C)}return t(),()=>{var M;d.forEach(B=>{i&&B.removeEventListener("scroll",t),s&&B.removeEventListener("resize",t)}),m==null||m(),(M=y)==null||M.disconnect(),y=null,o&&cancelAnimationFrame(T)}}const Pk=qD,bNe=nNe,wNe=rNe,SNe=eNe,ANe=iNe,TNe=(n,e,t)=>{const r=new Map,i={platform:_Ne,...t},s={...i.platform,_c:r};return QFe(n,e,{...i,platform:s})};var qI=typeof document<"u"?Ae.useLayoutEffect:Ae.useEffect;function XP(n,e){if(n===e)return!0;if(typeof n!=typeof e)return!1;if(typeof n=="function"&&n.toString()===e.toString())return!0;let t,r,i;if(n&&e&&typeof n=="object"){if(Array.isArray(n)){if(t=n.length,t!==e.length)return!1;for(r=t;r--!==0;)if(!XP(n[r],e[r]))return!1;return!0}if(i=Object.keys(n),t=i.length,t!==Object.keys(e).length)return!1;for(r=t;r--!==0;)if(!{}.hasOwnProperty.call(e,i[r]))return!1;for(r=t;r--!==0;){const s=i[r];if(!(s==="_owner"&&n.$$typeof)&&!XP(n[s],e[s]))return!1}return!0}return n!==n&&e!==e}function ble(n){return typeof window>"u"?1:(n.ownerDocument.defaultView||window).devicePixelRatio||1}function ZY(n,e){const t=ble(n);return Math.round(e*t)/t}function Lk(n){const e=Ae.useRef(n);return qI(()=>{e.current=n}),e}function MNe(n){n===void 0&&(n={});const{placement:e="bottom",strategy:t="absolute",middleware:r=[],platform:i,elements:{reference:s,floating:a}={},transform:l=!0,whileElementsMounted:o,open:h}=n,[d,m]=Ae.useState({x:0,y:0,strategy:t,placement:e,middlewareData:{},isPositioned:!1}),[_,y]=Ae.useState(r);XP(_,r)||y(r);const[T,I]=Ae.useState(null),[C,M]=Ae.useState(null),B=Ae.useCallback(ye=>{ye!==Z.current&&(Z.current=ye,I(ye))},[]),k=Ae.useCallback(ye=>{ye!==te.current&&(te.current=ye,M(ye))},[]),j=s||T,q=a||C,Z=Ae.useRef(null),te=Ae.useRef(null),ie=Ae.useRef(d),se=o!=null,ae=Lk(o),fe=Lk(i),Se=Lk(h),Ee=Ae.useCallback(()=>{if(!Z.current||!te.current)return;const ye={placement:e,strategy:t,middleware:_};fe.current&&(ye.platform=fe.current),TNe(Z.current,te.current,ye).then(Xe=>{const He={...Xe,isPositioned:Se.current!==!1};Re.current&&!XP(ie.current,He)&&(ie.current=He,Hf.flushSync(()=>{m(He)}))})},[_,e,t,fe,Se]);qI(()=>{h===!1&&ie.current.isPositioned&&(ie.current.isPositioned=!1,m(ye=>({...ye,isPositioned:!1})))},[h]);const Re=Ae.useRef(!1);qI(()=>(Re.current=!0,()=>{Re.current=!1}),[]),qI(()=>{if(j&&(Z.current=j),q&&(te.current=q),j&&q){if(ae.current)return ae.current(j,q,Ee);Ee()}},[j,q,Ee,ae,se]);const qe=Ae.useMemo(()=>({reference:Z,floating:te,setReference:B,setFloating:k}),[B,k]),Le=Ae.useMemo(()=>({reference:j,floating:q}),[j,q]),dt=Ae.useMemo(()=>{const ye={position:t,left:0,top:0};if(!Le.floating)return ye;const Xe=ZY(Le.floating,d.x),He=ZY(Le.floating,d.y);return l?{...ye,transform:"translate("+Xe+"px, "+He+"px)",...ble(Le.floating)>=1.5&&{willChange:"transform"}}:{position:t,left:Xe,top:He}},[t,l,Le.floating,d.x,d.y]);return Ae.useMemo(()=>({...d,update:Ee,refs:qe,elements:Le,floatingStyles:dt}),[d,Ee,qe,Le,dt])}const wle=(n,e)=>({...bNe(n),options:[n,e]}),CNe=(n,e)=>({...wNe(n),options:[n,e]}),ENe=(n,e)=>({...SNe(n),options:[n,e]}),INe=(n,e)=>({...ANe(n),options:[n,e]}),Sle={...KI},RNe=Sle.useInsertionEffect,PNe=RNe||(n=>n());function Ale(n){const e=Ae.useRef(()=>{});return PNe(()=>{e.current=n}),Ae.useCallback(function(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return e.current==null?void 0:e.current(...r)},[])}var XN=typeof document<"u"?Ae.useLayoutEffect:Ae.useEffect;let YY=!1,LNe=0;const KY=()=>"floating-ui-"+Math.random().toString(36).slice(2,6)+LNe++;function DNe(){const[n,e]=Ae.useState(()=>YY?KY():void 0);return XN(()=>{n==null&&e(KY())},[]),Ae.useEffect(()=>{YY=!0},[]),n}const BNe=Sle.useId,kNe=BNe||DNe;function ONe(){const n=new Map;return{emit(e,t){var r;(r=n.get(e))==null||r.forEach(i=>i(t))},on(e,t){n.set(e,[...n.get(e)||[],t])},off(e,t){var r;n.set(e,((r=n.get(e))==null?void 0:r.filter(i=>i!==t))||[])}}}const FNe=Ae.createContext(null),NNe=Ae.createContext(null),zNe=()=>{var n;return((n=Ae.useContext(FNe))==null?void 0:n.id)||null},UNe=()=>Ae.useContext(NNe),VNe="data-floating-ui-focusable";function GNe(n){const{open:e=!1,onOpenChange:t,elements:r}=n,i=kNe(),s=Ae.useRef({}),[a]=Ae.useState(()=>ONe()),l=zNe()!=null,[o,h]=Ae.useState(r.reference),d=Ale((y,T,I)=>{s.current.openEvent=y?T:void 0,a.emit("openchange",{open:y,event:T,reason:I,nested:l}),t==null||t(y,T,I)}),m=Ae.useMemo(()=>({setPositionReference:h}),[]),_=Ae.useMemo(()=>({reference:o||r.reference||null,floating:r.floating||null,domReference:r.reference}),[o,r.reference,r.floating]);return Ae.useMemo(()=>({dataRef:s,open:e,onOpenChange:d,elements:_,events:a,floatingId:i,refs:m}),[e,d,_,a,i,m])}function HNe(n){n===void 0&&(n={});const{nodeId:e}=n,t=GNe({...n,elements:{reference:null,floating:null,...n.elements}}),r=n.rootContext||t,i=r.elements,[s,a]=Ae.useState(null),[l,o]=Ae.useState(null),d=(i==null?void 0:i.domReference)||s,m=Ae.useRef(null),_=UNe();XN(()=>{d&&(m.current=d)},[d]);const y=MNe({...n,elements:{...i,...l&&{reference:l}}}),T=Ae.useCallback(k=>{const j=Ac(k)?{getBoundingClientRect:()=>k.getBoundingClientRect(),contextElement:k}:k;o(j),y.refs.setReference(j)},[y.refs]),I=Ae.useCallback(k=>{(Ac(k)||k===null)&&(m.current=k,a(k)),(Ac(y.refs.reference.current)||y.refs.reference.current===null||k!==null&&!Ac(k))&&y.refs.setReference(k)},[y.refs]),C=Ae.useMemo(()=>({...y.refs,setReference:I,setPositionReference:T,domReference:m}),[y.refs,I,T]),M=Ae.useMemo(()=>({...y.elements,domReference:d}),[y.elements,d]),B=Ae.useMemo(()=>({...y,...r,refs:C,elements:M,nodeId:e}),[y,C,M,e,r]);return XN(()=>{r.dataRef.current.floatingContext=B;const k=_==null?void 0:_.nodesRef.current.find(j=>j.id===e);k&&(k.context=B)}),Ae.useMemo(()=>({...y,context:B,refs:C,elements:M}),[y,C,M,B])}const JY="active",QY="selected";function Dk(n,e,t){const r=new Map,i=t==="item";let s=n;if(i&&n){const{[JY]:a,[QY]:l,...o}=n;s=o}return{...t==="floating"&&{tabIndex:-1,[VNe]:""},...s,...e.map(a=>{const l=a?a[t]:null;return typeof l=="function"?n?l(n):null:l}).concat(n).reduce((a,l)=>(l&&Object.entries(l).forEach(o=>{let[h,d]=o;if(!(i&&[JY,QY].includes(h)))if(h.indexOf("on")===0){if(r.has(h)||r.set(h,[]),typeof d=="function"){var m;(m=r.get(h))==null||m.push(d),a[h]=function(){for(var _,y=arguments.length,T=new Array(y),I=0;I<y;I++)T[I]=arguments[I];return(_=r.get(h))==null?void 0:_.map(C=>C(...T)).find(C=>C!==void 0)}}}else a[h]=d}),a),{})}}function jNe(n){n===void 0&&(n=[]);const e=n.map(l=>l==null?void 0:l.reference),t=n.map(l=>l==null?void 0:l.floating),r=n.map(l=>l==null?void 0:l.item),i=Ae.useCallback(l=>Dk(l,n,"reference"),e),s=Ae.useCallback(l=>Dk(l,n,"floating"),t),a=Ae.useCallback(l=>Dk(l,n,"item"),r);return Ae.useMemo(()=>({getReferenceProps:i,getFloatingProps:s,getItemProps:a}),[i,s,a])}function eK(n,e){return{...n,rects:{...n.rects,floating:{...n.rects.floating,height:e}}}}const WNe=n=>({name:"inner",options:n,async fn(e){const{listRef:t,overflowRef:r,onFallbackChange:i,offset:s=0,index:a=0,minItemsVisible:l=4,referenceOverflowThreshold:o=0,scrollRef:h,...d}=Cw(n,e),{rects:m,elements:{floating:_}}=e,y=t.current[a],T=(h==null?void 0:h.current)||_,I=_.clientTop||T.clientTop,C=_.clientTop!==0,M=T.clientTop!==0,B=_===T;if(!y)return{};const k={...e,...await wle(-y.offsetTop-_.clientTop-m.reference.height/2-y.offsetHeight/2-s).fn(e)},j=await Pk(eK(k,T.scrollHeight+I+_.clientTop),d),q=await Pk(k,{...d,elementContext:"reference"}),Z=Gl(0,j.top),te=k.y+Z,ae=(T.scrollHeight>T.clientHeight?fe=>fe:hT)(Gl(0,T.scrollHeight+(C&&B||M?I*2:0)-Z-Gl(0,j.bottom)));if(T.style.maxHeight=ae+"px",T.scrollTop=Z,i){const fe=T.offsetHeight<y.offsetHeight*sx(l,t.current.length)-1||q.top>=-o||q.bottom>=-o;Hf.flushSync(()=>i(fe))}return r&&(r.current=await Pk(eK({...k,y:te},T.offsetHeight+I+_.clientTop),d)),{y:te}}});function XNe(n,e){const{open:t,elements:r}=n,{enabled:i=!0,overflowRef:s,scrollRef:a,onChange:l}=e,o=Ale(l),h=Ae.useRef(!1),d=Ae.useRef(null),m=Ae.useRef(null);Ae.useEffect(()=>{if(!i)return;function y(I){if(I.ctrlKey||!T||s.current==null)return;const C=I.deltaY,M=s.current.top>=-.5,B=s.current.bottom>=-.5,k=T.scrollHeight-T.clientHeight,j=C<0?-1:1,q=C<0?"max":"min";T.scrollHeight<=T.clientHeight||(!M&&C>0||!B&&C<0?(I.preventDefault(),Hf.flushSync(()=>{o(Z=>Z+Math[q](C,k*j))})):/firefox/i.test(jFe())&&(T.scrollTop+=C))}const T=(a==null?void 0:a.current)||r.floating;if(t&&T)return T.addEventListener("wheel",y),requestAnimationFrame(()=>{d.current=T.scrollTop,s.current!=null&&(m.current={...s.current})}),()=>{d.current=null,m.current=null,T.removeEventListener("wheel",y)}},[i,t,r.floating,s,a,o]);const _=Ae.useMemo(()=>({onKeyDown(){h.current=!0},onWheel(){h.current=!1},onPointerMove(){h.current=!1},onScroll(){const y=(a==null?void 0:a.current)||r.floating;if(!(!s.current||!y||!h.current)){if(d.current!==null){const T=y.scrollTop-d.current;(s.current.bottom<-.5&&T<-1||s.current.top<-.5&&T>1)&&Hf.flushSync(()=>o(I=>I+T))}requestAnimationFrame(()=>{d.current=y.scrollTop})}}}),[r.floating,o,s,a]);return Ae.useMemo(()=>i?{floating:_}:{},[i,_])}let Ew=Ae.createContext({styles:void 0,setReference:()=>{},setFloating:()=>{},getReferenceProps:()=>({}),getFloatingProps:()=>({}),slot:{}});Ew.displayName="FloatingContext";let A8=Ae.createContext(null);A8.displayName="PlacementContext";function $Ne(n){return Ae.useMemo(()=>n?typeof n=="string"?{to:n}:n:null,[n])}function qNe(){return Ae.useContext(Ew).setReference}function ZNe(){return Ae.useContext(Ew).getReferenceProps}function YNe(){let{getFloatingProps:n,slot:e}=Ae.useContext(Ew);return Ae.useCallback((...t)=>Object.assign({},n(...t),{"data-anchor":e.anchor}),[n,e])}function KNe(n=null){n===!1&&(n=null),typeof n=="string"&&(n={to:n});let e=Ae.useContext(A8),t=Ae.useMemo(()=>n,[JSON.stringify(n,(i,s)=>{var a;return(a=s==null?void 0:s.outerHTML)!=null?a:s})]);Ma(()=>{e==null||e(t??null)},[e,t]);let r=Ae.useContext(Ew);return Ae.useMemo(()=>[r.setFloating,n?r.styles:{}],[r.setFloating,n,r.styles])}let tK=4;function JNe({children:n,enabled:e=!0}){let[t,r]=Ae.useState(null),[i,s]=Ae.useState(0),a=Ae.useRef(null),[l,o]=Ae.useState(null);QNe(l);let h=e&&t!==null&&l!==null,{to:d="bottom",gap:m=0,offset:_=0,padding:y=0,inner:T}=eze(t,l),[I,C="center"]=d.split(" ");Ma(()=>{h&&s(0)},[h]);let{refs:M,floatingStyles:B,context:k}=HNe({open:h,placement:I==="selection"?C==="center"?"bottom":`bottom-${C}`:C==="center"?`${I}`:`${I}-${C}`,strategy:"absolute",transform:!1,middleware:[wle({mainAxis:I==="selection"?0:m,crossAxis:_}),CNe({padding:y}),I!=="selection"&&ENe({padding:y}),I==="selection"&&T?WNe({...T,padding:y,overflowRef:a,offset:i,minItemsVisible:tK,referenceOverflowThreshold:y,onFallbackChange(fe){var Se,Ee;if(!fe)return;let Re=k.elements.floating;if(!Re)return;let qe=parseFloat(getComputedStyle(Re).scrollPaddingBottom)||0,Le=Math.min(tK,Re.childElementCount),dt=0,ye=0;for(let Xe of(Ee=(Se=k.elements.floating)==null?void 0:Se.childNodes)!=null?Ee:[])if(Xe instanceof HTMLElement){let He=Xe.offsetTop,_t=He+Xe.clientHeight+qe,wt=Re.scrollTop,Gt=wt+Re.clientHeight;if(He>=wt&&_t<=Gt)Le--;else{ye=Math.max(0,Math.min(_t,Gt)-Math.max(He,wt)),dt=Xe.clientHeight;break}}Le>=1&&s(Xe=>{let He=dt*Le-ye+qe;return Xe>=He?Xe:He})}}):null,INe({padding:y,apply({availableWidth:fe,availableHeight:Se,elements:Ee}){Object.assign(Ee.floating.style,{overflow:"auto",maxWidth:`${fe}px`,maxHeight:`min(var(--anchor-max-height, 100vh), ${Se}px)`})}})].filter(Boolean),whileElementsMounted:xNe}),[j=I,q=C]=k.placement.split("-");I==="selection"&&(j="selection");let Z=Ae.useMemo(()=>({anchor:[j,q].filter(Boolean).join(" ")}),[j,q]),te=XNe(k,{overflowRef:a,onChange:s}),{getReferenceProps:ie,getFloatingProps:se}=jNe([te]),ae=Mo(fe=>{o(fe),M.setFloating(fe)});return Ae.createElement(A8.Provider,{value:r},Ae.createElement(Ew.Provider,{value:{setFloating:ae,setReference:M.setReference,styles:B,getReferenceProps:ie,getFloatingProps:se,slot:Z}},n))}function QNe(n){Ma(()=>{if(!n)return;let e=new MutationObserver(()=>{let t=window.getComputedStyle(n).maxHeight,r=parseFloat(t);if(isNaN(r))return;let i=parseInt(t);isNaN(i)||r!==i&&(n.style.maxHeight=`${Math.ceil(r)}px`)});return e.observe(n,{attributes:!0,attributeFilter:["style"]}),()=>{e.disconnect()}},[n])}function eze(n,e){var t,r,i;let s=Bk((t=n==null?void 0:n.gap)!=null?t:"var(--anchor-gap, 0)",e),a=Bk((r=n==null?void 0:n.offset)!=null?r:"var(--anchor-offset, 0)",e),l=Bk((i=n==null?void 0:n.padding)!=null?i:"var(--anchor-padding, 0)",e);return{...n,gap:s,offset:a,padding:l}}function Bk(n,e,t=void 0){let r=HD(),i=Mo((o,h)=>{if(o==null)return[t,null];if(typeof o=="number")return[o,null];if(typeof o=="string"){if(!h)return[t,null];let d=nK(o,h);return[d,m=>{let _=Tle(o);{let y=_.map(T=>window.getComputedStyle(h).getPropertyValue(T));r.requestAnimationFrame(function T(){r.nextFrame(T);let I=!1;for(let[M,B]of _.entries()){let k=window.getComputedStyle(h).getPropertyValue(B);if(y[M]!==k){y[M]=k,I=!0;break}}if(!I)return;let C=nK(o,h);d!==C&&(m(C),d=C)})}return r.dispose}]}return[t,null]}),s=Ae.useMemo(()=>i(n,e)[0],[n,e]),[a=s,l]=Ae.useState();return Ma(()=>{let[o,h]=i(n,e);if(l(o),!!h)return h(l)},[n,e]),a}function Tle(n){let e=/var\((.*)\)/.exec(n);if(e){let t=e[1].indexOf(",");if(t===-1)return[e[1]];let r=e[1].slice(0,t).trim(),i=e[1].slice(t+1).trim();return i?[r,...Tle(i)]:[r]}return[]}function nK(n,e){let t=document.createElement("div");e.appendChild(t),t.style.setProperty("margin-top","0px","important"),t.style.setProperty("margin-top",n,"important");let r=parseFloat(window.getComputedStyle(t).marginTop)||0;return e.removeChild(t),r}let T8=Ae.createContext(null);T8.displayName="OpenClosedContext";var fT=(n=>(n[n.Open=1]="Open",n[n.Closed=2]="Closed",n[n.Closing=4]="Closing",n[n.Opening=8]="Opening",n))(fT||{});function tze(){return Ae.useContext(T8)}function nze({value:n,children:e}){return Xl.createElement(T8.Provider,{value:n},e)}function rze(n){throw new Error("Unexpected object: "+n)}var Hl=(n=>(n[n.First=0]="First",n[n.Previous=1]="Previous",n[n.Next=2]="Next",n[n.Last=3]="Last",n[n.Specific=4]="Specific",n[n.Nothing=5]="Nothing",n))(Hl||{});function kk(n,e){let t=e.resolveItems();if(t.length<=0)return null;let r=e.resolveActiveIndex(),i=r??-1;switch(n.focus){case 0:{for(let s=0;s<t.length;++s)if(!e.resolveDisabled(t[s],s,t))return s;return r}case 1:{i===-1&&(i=t.length);for(let s=i-1;s>=0;--s)if(!e.resolveDisabled(t[s],s,t))return s;return r}case 2:{for(let s=i+1;s<t.length;++s)if(!e.resolveDisabled(t[s],s,t))return s;return r}case 3:{for(let s=t.length-1;s>=0;--s)if(!e.resolveDisabled(t[s],s,t))return s;return r}case 4:{for(let s=0;s<t.length;++s)if(e.resolveId(t[s],s,t)===n.id)return s;return r}case 5:return null;default:rze(n)}}function ize(n){let e=Mo(n),t=Ae.useRef(!1);Ae.useEffect(()=>(t.current=!1,()=>{t.current=!0,Jae(()=>{t.current&&e()})}),[e])}function sze(){let n=typeof document>"u";return"useSyncExternalStore"in KI?(e=>e.useSyncExternalStore)(KI)(()=>()=>{},()=>!1,()=>!n):!1}function oze(){let n=sze(),[e,t]=Ae.useState(Fy.isHandoffComplete);return e&&Fy.isHandoffComplete===!1&&t(!1),Ae.useEffect(()=>{e!==!0&&t(!0)},[e]),Ae.useEffect(()=>Fy.handoff(),[]),n?!1:e}let aze=Ae.createContext(!1);function lze(){return Ae.useContext(aze)}function cze(n){let e=lze(),t=Ae.useContext(Cle),r=y8(n),[i,s]=Ae.useState(()=>{var a;if(!e&&t!==null)return(a=t.current)!=null?a:null;if(Fy.isServer)return null;let l=r==null?void 0:r.getElementById("headlessui-portal-root");if(l)return l;if(r===null)return null;let o=r.createElement("div");return o.setAttribute("id","headlessui-portal-root"),r.body.appendChild(o)});return Ae.useEffect(()=>{i!==null&&(r!=null&&r.body.contains(i)||r==null||r.body.appendChild(i))},[i,r]),Ae.useEffect(()=>{e||t!==null&&s(t.current)},[t,s,e]),i}let Mle=Ae.Fragment,uze=Fh(function(n,e){let t=n,r=Ae.useRef(null),i=ng(YOe(m=>{r.current=m}),e),s=y8(r),a=cze(r),[l]=Ae.useState(()=>{var m;return Fy.isServer?null:(m=s==null?void 0:s.createElement("div"))!=null?m:null}),o=Ae.useContext(pze),h=oze();Ma(()=>{!a||!l||a.contains(l)||(l.setAttribute("data-headlessui-portal",""),a.appendChild(l))},[a,l]),Ma(()=>{if(l&&o)return o.register(l)},[o,l]),ize(()=>{var m;!a||!l||(l instanceof Node&&a.contains(l)&&a.removeChild(l),a.childNodes.length<=0&&((m=a.parentElement)==null||m.removeChild(a)))});let d=Oh();return h?!a||!l?null:Hf.createPortal(d({ourProps:{ref:i},theirProps:t,slot:{},defaultTag:Mle,name:"Portal"}),l):null});function hze(n,e){let t=ng(e),{enabled:r=!0,...i}=n,s=Oh();return r?Xl.createElement(uze,{...i,ref:t}):s({ourProps:{ref:t},theirProps:i,slot:{},defaultTag:Mle,name:"Portal"})}let fze=Ae.Fragment,Cle=Ae.createContext(null);function dze(n,e){let{target:t,...r}=n,i={ref:ng(e)},s=Oh();return Xl.createElement(Cle.Provider,{value:t},s({ourProps:i,theirProps:r,defaultTag:fze,name:"Popover.Group"}))}let pze=Ae.createContext(null),mze=Fh(hze),gze=Fh(dze),vze=Object.assign(mze,{Group:gze});function _ze(n,e){let t=Ae.useRef({left:0,top:0});if(Ma(()=>{if(!e)return;let i=e.getBoundingClientRect();i&&(t.current=i)},[n,e]),e==null||!n||e===document.activeElement)return!1;let r=e.getBoundingClientRect();return r.top!==t.current.top||r.left!==t.current.left}let rK=/([\u2700-\u27BF]|[\uE000-\uF8FF]|\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDFFF]|[\u2011-\u26FF]|\uD83E[\uDD10-\uDDFF])/g;function iK(n){var e,t;let r=(e=n.innerText)!=null?e:"",i=n.cloneNode(!0);if(!(i instanceof HTMLElement))return r;let s=!1;for(let l of i.querySelectorAll('[hidden],[aria-hidden],[role="img"]'))l.remove(),s=!0;let a=s?(t=i.innerText)!=null?t:"":r;return rK.test(a)&&(a=a.replace(rK,"")),a}function yze(n){let e=n.getAttribute("aria-label");if(typeof e=="string")return e.trim();let t=n.getAttribute("aria-labelledby");if(t){let r=t.split(" ").map(i=>{let s=document.getElementById(i);if(s){let a=s.getAttribute("aria-label");return typeof a=="string"?a.trim():iK(s).trim()}return null}).filter(Boolean);if(r.length>0)return r.join(", ")}return iK(n).trim()}function xze(n){let e=Ae.useRef(""),t=Ae.useRef("");return Mo(()=>{let r=n.current;if(!r)return"";let i=r.innerText;if(e.current===i)return t.current;let s=yze(r).trim().toLowerCase();return e.current=i,t.current=s,s})}var bze=(n=>(n[n.Open=0]="Open",n[n.Closed=1]="Closed",n))(bze||{}),wze=(n=>(n[n.Pointer=0]="Pointer",n[n.Other=1]="Other",n))(wze||{}),Sze=(n=>(n[n.OpenMenu=0]="OpenMenu",n[n.CloseMenu=1]="CloseMenu",n[n.GoToItem=2]="GoToItem",n[n.Search=3]="Search",n[n.ClearSearch=4]="ClearSearch",n[n.RegisterItem=5]="RegisterItem",n[n.UnregisterItem=6]="UnregisterItem",n[n.SetButtonElement=7]="SetButtonElement",n[n.SetItemsElement=8]="SetItemsElement",n))(Sze||{});function Ok(n,e=t=>t){let t=n.activeItemIndex!==null?n.items[n.activeItemIndex]:null,r=cle(e(n.items.slice()),s=>s.dataRef.current.domRef.current),i=t?r.indexOf(t):null;return i===-1&&(i=null),{items:r,activeItemIndex:i}}let Aze={1(n){return n.menuState===1?n:{...n,activeItemIndex:null,menuState:1}},0(n){return n.menuState===0?n:{...n,__demoMode:!1,menuState:0}},2:(n,e)=>{var t,r,i,s,a;if(n.menuState===1)return n;let l={...n,searchQuery:"",activationTrigger:(t=e.trigger)!=null?t:1,__demoMode:!1};if(e.focus===Hl.Nothing)return{...l,activeItemIndex:null};if(e.focus===Hl.Specific)return{...l,activeItemIndex:n.items.findIndex(d=>d.id===e.id)};if(e.focus===Hl.Previous){let d=n.activeItemIndex;if(d!==null){let m=n.items[d].dataRef.current.domRef,_=kk(e,{resolveItems:()=>n.items,resolveActiveIndex:()=>n.activeItemIndex,resolveId:y=>y.id,resolveDisabled:y=>y.dataRef.current.disabled});if(_!==null){let y=n.items[_].dataRef.current.domRef;if(((r=m.current)==null?void 0:r.previousElementSibling)===y.current||((i=y.current)==null?void 0:i.previousElementSibling)===null)return{...l,activeItemIndex:_}}}}else if(e.focus===Hl.Next){let d=n.activeItemIndex;if(d!==null){let m=n.items[d].dataRef.current.domRef,_=kk(e,{resolveItems:()=>n.items,resolveActiveIndex:()=>n.activeItemIndex,resolveId:y=>y.id,resolveDisabled:y=>y.dataRef.current.disabled});if(_!==null){let y=n.items[_].dataRef.current.domRef;if(((s=m.current)==null?void 0:s.nextElementSibling)===y.current||((a=y.current)==null?void 0:a.nextElementSibling)===null)return{...l,activeItemIndex:_}}}}let o=Ok(n),h=kk(e,{resolveItems:()=>o.items,resolveActiveIndex:()=>o.activeItemIndex,resolveId:d=>d.id,resolveDisabled:d=>d.dataRef.current.disabled});return{...l,...o,activeItemIndex:h}},3:(n,e)=>{let t=n.searchQuery!==""?0:1,r=n.searchQuery+e.value.toLowerCase(),i=(n.activeItemIndex!==null?n.items.slice(n.activeItemIndex+t).concat(n.items.slice(0,n.activeItemIndex+t)):n.items).find(a=>{var l;return((l=a.dataRef.current.textValue)==null?void 0:l.startsWith(r))&&!a.dataRef.current.disabled}),s=i?n.items.indexOf(i):-1;return s===-1||s===n.activeItemIndex?{...n,searchQuery:r}:{...n,searchQuery:r,activeItemIndex:s,activationTrigger:1}},4(n){return n.searchQuery===""?n:{...n,searchQuery:"",searchActiveItemIndex:null}},5:(n,e)=>{let t=Ok(n,r=>[...r,{id:e.id,dataRef:e.dataRef}]);return{...n,...t}},6:(n,e)=>{let t=Ok(n,r=>{let i=r.findIndex(s=>s.id===e.id);return i!==-1&&r.splice(i,1),r});return{...n,...t,activationTrigger:1}},7:(n,e)=>n.buttonElement===e.element?n:{...n,buttonElement:e.element},8:(n,e)=>n.itemsElement===e.element?n:{...n,itemsElement:e.element}},M8=Ae.createContext(null);M8.displayName="MenuContext";function ZD(n){let e=Ae.useContext(M8);if(e===null){let t=new Error(`<${n} /> is missing a parent <Menu /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(t,ZD),t}return e}function Tze(n,e){return oM(e.type,Aze,n,e)}let Mze=Ae.Fragment;function Cze(n,e){let{__demoMode:t=!1,...r}=n,i=Ae.useReducer(Tze,{__demoMode:t,menuState:t?0:1,buttonElement:null,itemsElement:null,items:[],searchQuery:"",activeItemIndex:null,activationTrigger:1}),[{menuState:s,itemsElement:a,buttonElement:l},o]=i,h=ng(e);AFe(s===0,[l,a],(T,I)=>{o({type:1}),_8(I,v8.Loose)||(T.preventDefault(),l==null||l.focus())});let d=Mo(()=>{o({type:1})}),m=Ae.useMemo(()=>({open:s===0,close:d}),[s,d]),_={ref:h},y=Oh();return Xl.createElement(JNe,null,Xl.createElement(M8.Provider,{value:i},Xl.createElement(nze,{value:oM(s,{0:fT.Open,1:fT.Closed})},y({ourProps:_,theirProps:r,slot:m,defaultTag:Mze,name:"Menu"}))))}let Eze="button";function Ize(n,e){var t;let r=Ae.useId(),{id:i=`headlessui-menu-button-${r}`,disabled:s=!1,autoFocus:a=!1,...l}=n,[o,h]=ZD("Menu.Button"),d=ZNe(),m=ng(e,qNe(),Mo(te=>h({type:7,element:te}))),_=Mo(te=>{switch(te.key){case _l.Space:case _l.Enter:case _l.ArrowDown:te.preventDefault(),te.stopPropagation(),Hf.flushSync(()=>h({type:0})),h({type:2,focus:Hl.First});break;case _l.ArrowUp:te.preventDefault(),te.stopPropagation(),Hf.flushSync(()=>h({type:0})),h({type:2,focus:Hl.Last});break}}),y=Mo(te=>{switch(te.key){case _l.Space:te.preventDefault();break}}),T=Mo(te=>{var ie;if(qOe(te.currentTarget))return te.preventDefault();s||(o.menuState===0?(Hf.flushSync(()=>h({type:1})),(ie=o.buttonElement)==null||ie.focus({preventScroll:!0})):(te.preventDefault(),h({type:0})))}),{isFocusVisible:I,focusProps:C}=DOe({autoFocus:a}),{isHovered:M,hoverProps:B}=LOe({isDisabled:s}),{pressed:k,pressProps:j}=zOe({disabled:s}),q=Ae.useMemo(()=>({open:o.menuState===0,active:k||o.menuState===0,disabled:s,hover:M,focus:I,autofocus:a}),[o,M,I,k,s,a]),Z=tle(d(),{ref:m,id:i,type:TFe(n,o.buttonElement),"aria-haspopup":"menu","aria-controls":(t=o.itemsElement)==null?void 0:t.id,"aria-expanded":o.menuState===0,disabled:s||void 0,autoFocus:a,onKeyDown:_,onKeyUp:y,onClick:T},C,B,j);return Oh()({ourProps:Z,theirProps:l,slot:q,defaultTag:Eze,name:"Menu.Button"})}let Rze="div",Pze=UN.RenderStrategy|UN.Static;function Lze(n,e){var t,r;let i=Ae.useId(),{id:s=`headlessui-menu-items-${i}`,anchor:a,portal:l=!1,modal:o=!0,transition:h=!1,...d}=n,m=$Ne(a),[_,y]=ZD("Menu.Items"),[T,I]=KNe(m),C=YNe(),[M,B]=Ae.useState(null),k=ng(e,m?T:null,Mo(ye=>y({type:8,element:ye})),B),j=y8(_.itemsElement);m&&(l=!0);let q=tze(),[Z,te]=FFe(h,M,q!==null?(q&fT.Open)===fT.Open:_.menuState===0);uFe(Z,_.buttonElement,()=>{y({type:1})});let ie=_.__demoMode?!1:o&&_.menuState===0;PFe(ie,j);let se=_.__demoMode?!1:o&&_.menuState===0;cFe(se,{allowed:Ae.useCallback(()=>[_.buttonElement,_.itemsElement],[_.buttonElement,_.itemsElement])});let ae=_.menuState!==0,fe=_ze(ae,_.buttonElement)?!1:Z;Ae.useEffect(()=>{let ye=_.itemsElement;ye&&_.menuState===0&&ye!==(j==null?void 0:j.activeElement)&&ye.focus({preventScroll:!0})},[_.menuState,_.itemsElement,j]),VFe(_.menuState===0,{container:_.itemsElement,accept(ye){return ye.getAttribute("role")==="menuitem"?NodeFilter.FILTER_REJECT:ye.hasAttribute("role")?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT},walk(ye){ye.setAttribute("role","none")}});let Se=HD(),Ee=Mo(ye=>{var Xe,He,_t;switch(Se.dispose(),ye.key){case _l.Space:if(_.searchQuery!=="")return ye.preventDefault(),ye.stopPropagation(),y({type:3,value:ye.key});case _l.Enter:if(ye.preventDefault(),ye.stopPropagation(),y({type:1}),_.activeItemIndex!==null){let{dataRef:wt}=_.items[_.activeItemIndex];(He=(Xe=wt.current)==null?void 0:Xe.domRef.current)==null||He.click()}lle(_.buttonElement);break;case _l.ArrowDown:return ye.preventDefault(),ye.stopPropagation(),y({type:2,focus:Hl.Next});case _l.ArrowUp:return ye.preventDefault(),ye.stopPropagation(),y({type:2,focus:Hl.Previous});case _l.Home:case _l.PageUp:return ye.preventDefault(),ye.stopPropagation(),y({type:2,focus:Hl.First});case _l.End:case _l.PageDown:return ye.preventDefault(),ye.stopPropagation(),y({type:2,focus:Hl.Last});case _l.Escape:ye.preventDefault(),ye.stopPropagation(),Hf.flushSync(()=>y({type:1})),(_t=_.buttonElement)==null||_t.focus({preventScroll:!0});break;case _l.Tab:ye.preventDefault(),ye.stopPropagation(),Hf.flushSync(()=>y({type:1})),yFe(_.buttonElement,ye.shiftKey?HN.Previous:HN.Next);break;default:ye.key.length===1&&(y({type:3,value:ye.key}),Se.setTimeout(()=>y({type:4}),350));break}}),Re=Mo(ye=>{switch(ye.key){case _l.Space:ye.preventDefault();break}}),qe=Ae.useMemo(()=>({open:_.menuState===0}),[_.menuState]),Le=tle(m?C():{},{"aria-activedescendant":_.activeItemIndex===null||(t=_.items[_.activeItemIndex])==null?void 0:t.id,"aria-labelledby":(r=_.buttonElement)==null?void 0:r.id,id:s,onKeyDown:Ee,onKeyUp:Re,role:"menu",tabIndex:_.menuState===0?0:void 0,ref:k,style:{...d.style,...I,"--button-width":oFe(_.buttonElement,!0).width},...OFe(te)}),dt=Oh();return Xl.createElement(vze,{enabled:l?n.static||Z:!1},dt({ourProps:Le,theirProps:d,slot:qe,defaultTag:Rze,features:Pze,visible:fe,name:"Menu.Items"}))}let Dze=Ae.Fragment;function Bze(n,e){let t=Ae.useId(),{id:r=`headlessui-menu-item-${t}`,disabled:i=!1,...s}=n,[a,l]=ZD("Menu.Item"),o=a.activeItemIndex!==null?a.items[a.activeItemIndex].id===r:!1,h=Ae.useRef(null),d=ng(e,h);Ma(()=>{if(!a.__demoMode&&a.menuState===0&&o&&a.activationTrigger!==0)return yp().requestAnimationFrame(()=>{var fe,Se;(Se=(fe=h.current)==null?void 0:fe.scrollIntoView)==null||Se.call(fe,{block:"nearest"})})},[a.__demoMode,h,o,a.menuState,a.activationTrigger,a.activeItemIndex]);let m=xze(h),_=Ae.useRef({disabled:i,domRef:h,get textValue(){return m()}});Ma(()=>{_.current.disabled=i},[_,i]),Ma(()=>(l({type:5,id:r,dataRef:_}),()=>l({type:6,id:r})),[_,r]);let y=Mo(()=>{l({type:1})}),T=Mo(fe=>{if(i)return fe.preventDefault();l({type:1}),lle(a.buttonElement)}),I=Mo(()=>{if(i)return l({type:2,focus:Hl.Nothing});l({type:2,focus:Hl.Specific,id:r})}),C=LFe(),M=Mo(fe=>{C.update(fe),!i&&(o||l({type:2,focus:Hl.Specific,id:r,trigger:0}))}),B=Mo(fe=>{C.wasMoved(fe)&&(i||o||l({type:2,focus:Hl.Specific,id:r,trigger:0}))}),k=Mo(fe=>{C.wasMoved(fe)&&(i||o&&l({type:2,focus:Hl.Nothing}))}),[j,q]=ile(),[Z,te]=KOe(),ie=Ae.useMemo(()=>({active:o,focus:o,disabled:i,close:y}),[o,i,y]),se={id:r,ref:d,role:"menuitem",tabIndex:i===!0?void 0:-1,"aria-disabled":i===!0?!0:void 0,"aria-labelledby":j,"aria-describedby":Z,disabled:void 0,onClick:T,onFocus:I,onPointerEnter:M,onMouseEnter:M,onPointerMove:B,onMouseMove:B,onPointerLeave:k,onMouseLeave:k},ae=Oh();return Xl.createElement(q,null,Xl.createElement(te,null,ae({ourProps:se,theirProps:s,slot:ie,defaultTag:Dze,name:"Menu.Item"})))}let kze="div";function Oze(n,e){let[t,r]=ile(),i=n,s={ref:e,"aria-labelledby":t,role:"group"},a=Oh();return Xl.createElement(r,null,a({ourProps:s,theirProps:i,slot:{},defaultTag:kze,name:"Menu.Section"}))}let Fze="header";function Nze(n,e){let t=Ae.useId(),{id:r=`headlessui-menu-heading-${t}`,...i}=n,s=m8();Ma(()=>s.register(r),[r,s.register]);let a={id:r,ref:e,role:"presentation",...s.props};return Oh()({ourProps:a,theirProps:i,slot:{},defaultTag:Fze,name:"Menu.Heading"})}let zze="div";function Uze(n,e){let t=n,r={ref:e,role:"separator"};return Oh()({ourProps:r,theirProps:t,slot:{},defaultTag:zze,name:"Menu.Separator"})}let Vze=Fh(Cze),C8=Fh(Ize),E8=Fh(Lze),Ff=Fh(Bze),Gze=Fh(Oze),Hze=Fh(Nze),jze=Fh(Uze),Ele=Object.assign(Vze,{Button:C8,Items:E8,Item:Ff,Section:Gze,Heading:Hze,Separator:jze});const Wze=""+new URL("heart--ic8Oklh.png",import.meta.url).href,Xze=()=>{let n=Ae.useRef(null),e,t,r,i=null;const s=()=>{for(let I=-15;I<16;I++)for(let C=-10;C<11;C++){let M=new OL({color:Math.random()*16777215}),B=new x6(M);B.position.set(I*2,C*2,0),e.add(B)}},a=()=>{const I=new $r,C=new su({size:3,vertexColors:!0,color:16777215});let M=[],B=[];for(let j=-15;j<16;j++)for(let q=-15;q<16;q++){M.push(j*4,q*4,0);let Z=new Gn(Math.random()*16777215);B.push(Z.r,Z.g,Z.b)}I.attributes.position=new ar(M,3),I.attributes.color=new ar(B,3);const k=new wh(I,C);e.add(k)},l=()=>{const I=document.createElement("canvas");I.width=300,I.height=300;const C=I.getContext("2d");C.lineWidth=10,C.beginPath(),C.moveTo(200,150);var M=C.createLinearGradient(100,0,200,0);M.addColorStop("0","black"),M.addColorStop("0.3","magenta"),M.addColorStop("0.5","blue"),M.addColorStop("0.6","green"),M.addColorStop("0.8","yellow"),M.addColorStop("1","red"),C.strokeStyle=M,C.arc(150,150,50,0,2*Math.PI),C.stroke();const B=new QO(I);return B.needsUpdate=!0,B},o=(I,C,M,B,k)=>{const j=new $r,q=new su({size:I,transparent:C,opacity:M,sizeAttenuation:B,map:l(),color:k,depthTest:!0,depthWrite:!1});let Z=[],te=200;for(let ae=0;ae<400;ae++){let fe=new Ze(Math.random()*te-te/2,Math.random()*te-te/2,Math.random()*te-te/2);Z.push(fe.x,fe.y,fe.z)}let ie=new ar(Z,3);j.attributes.position=ie;const se=new wh(j,q);e.add(se)},h=(I,C,M)=>{const B=new $r,k=new su({size:I,transparent:M,opacity:C,map:new qf().load(Wze),sizeAttenuation:!0,depthTest:!0,depthWrite:!1});let j=[],q=200;for(let te=0;te<400;te++){let ie=new Ze(Math.random()*q-q/2,Math.random()*q-q/2,Math.random()*q-q/2);j.push(ie.x,ie.y,ie.z)}B.attributes.position=new ar(j,3);let Z=new wh(B,k);e.add(Z)},d=()=>{const I=document.createElement("canvas");I.width=16,I.height=16;let C=I.getContext("2d"),M=C.createRadialGradient(I.width/2,I.height/2,0,I.width/2,I.height/2,I.width/2);M.addColorStop(0,"rgba(255,255,255,1)"),M.addColorStop(.2,"rgba(0,255,255,1)"),M.addColorStop(.4,"rgba(0,0,255,1)"),M.addColorStop(1,"rgba(0,255,0,1)"),C.fillStyle=M,C.fillRect(0,0,I.width,I.height);const B=new QO(I);return B.needsUpdate=!0,B},m=()=>{const I=new Lm(50,32,32),C=new su({size:1,map:d(),transparent:!0,opacity:1,sizeAttenuation:!0,color:15539236,blending:Wb,depthTest:!0,depthWrite:!1}),M=new wh(I,C);e.add(M)},_=()=>{const I={width:window.innerWidth,height:window.innerHeight};e=new Al,t=new Qi(75,1,.1,1e3),e.add(t),r=new Ev(t,n.current),r.enableDamping=!0,i=new Zl({canvas:n.current}),i.setSize(I.width,I.height),i.setPixelRatio(Math.min(window.devicePixelRatio,2)),t.aspect=I.width/I.height,t.position.z=120,t.lookAt(new Ze(0,0,0))},y=()=>{i.render(e,t),r&&r.update(),requestAnimationFrame(y)},T=I=>{switch(e.clear(),I){case 0:s();break;case 1:{a();break}case 2:o(10,!0,.6,!0,16777215);break;case 3:h(10,.6,!0);break;case 4:m();break;default:s()}};return Ae.useEffect(()=>{_(),T(0),y()},[]),me.jsxs("div",{className:"absolute flex w-screen top-20 flex-col items-center",children:[me.jsx("header",{className:"flex w-full items-center justify-between border-b-2 border-b-black shadow-xl",children:me.jsx("div",{className:"mr-8 text-right",children:me.jsxs(Ele,{children:[me.jsx(C8,{className:"inline-flex items-center gap-2 rounded-md bg-gray-800 py-1.5 px-3 text-sm/6 font-semibold text-white shadow-inner shadow-white/10 focus:outline-none data-[hover]:bg-gray-700 data-[open]:bg-gray-700 data-[focus]:outline-1 data-[focus]:outline-white",children:"different ways to create particles"}),me.jsxs(E8,{transition:!0,anchor:"bottom end",className:"w-52 origin-top-right rounded-xl border border-gray-800 bg-gray-700 p-1 text-sm/6 text-white transition duration-100 ease-out [--anchor-gap:var(--spacing-1)] focus:outline-none",children:[me.jsx(Ff,{children:me.jsx("button",{className:"group flex w-full items-center gap-2 rounded-lg py-1.5 px-3 data-[focus]:bg-black/10 justify-end",onClick:()=>T(0),children:"createParticlesBySprite"})}),me.jsx(Ff,{children:me.jsx("button",{className:"group flex w-full items-center gap-2 rounded-lg py-1.5 px-3 data-[focus]:bg-black/10 justify-end",onClick:()=>T(1),children:"createParticlesByPoints"})}),me.jsx(Ff,{children:me.jsx("button",{className:"group flex w-full items-center gap-2 rounded-lg py-1.5 px-3 data-[focus]:bg-black/10 justify-end",onClick:()=>T(2),children:"createParticlesByCanvas"})}),me.jsx(Ff,{children:me.jsx("button",{className:"group flex w-full items-center gap-2 rounded-lg py-1.5 px-3 data-[focus]:bg-black/10 justify-end",onClick:()=>T(3),children:"createParticlesByTexture"})}),me.jsx(Ff,{children:me.jsx("button",{className:"group flex w-full items-center gap-2 rounded-lg py-1.5 px-3 data-[focus]:bg-black/10 justify-end",onClick:()=>T(4),children:"createParticlesByGeometry"})})]})]})})}),me.jsx("canvas",{ref:n})]})},$ze=""+new URL("astronaut-FRdIWehG.glb",import.meta.url).href,qze="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAgSURBVHgB7cmxDQAACALBj/vvrIWUJCzAtQf1VtwNlR3vKwf7lmC9zQAAAABJRU5ErkJggg==",Zze=()=>{let n=Ae.useRef(null),e=null,t=null,r=null,i=null,s=null,a=0,l=[],o={width:0,height:0};const h=()=>{t=new Zl({canvas:n.current,antialias:!0}),t.setSize(o.width,o.height),t.setPixelRatio(Math.min(window.devicePixelRatio,2)),e=new Al,r=new Qi(75,o.width/o.height,.1,100),r.position.z=150,r.lookAt(new Ze(0,0,0)),e.add(r),t.render(e,r),d(),m(),_()},d=()=>{new GD().load($ze,Z=>{i=Z.scene,i.material=new VT,i.scale.set(4e-4,4e-4,4e-4),i.position.z=-10,e.add(i)})},m=()=>{const q=new $r,Z=new su({size:10,alphaTest:.8,color:16777215,map:new qf().load(qze)});let te=[];for(let ie=0;ie<1e3;ie++){l.push(j(20,300)*Math.cos(ie),j(20,300)*Math.sin(ie),j(-1500,10));let se=new Gn(Math.random()*16777215);te.push(se.r,se.g,se.b)}q.attributes.position=new ar(l,3),q.attributes.color=new ar(te,3),s=new wh(q,Z),e.add(s)},_=()=>{e.fog=new kT(0,.005);let q=new ev(16777215,.8);q.position.set(50,50,75),e.add(q),q=new ev(16777215,.8),q.position.set(-50,-50,75),e.add(q),q=new ev(16777215,.5),q.position.set(25,50,200),e.add(q),q=new mx(16777215,.8),e.add(q)},y=()=>{s.position.x=.2*Math.cos(a),s.position.y=.2*Math.cos(a),s.position.z+=.015,r.lookAt(s.position);for(let q=0;q<l.length;q++)if((q+1)%3===0){l[q]-r.position.z>=0&&(l[q]=j(-1e3,-500)),l[q]+=2.5;let te=new ar(l,3);s.geometry.attributes.position=te}s.geometry.verticesNeedUpdate=!0},T=()=>{i&&(i.position.z=.08*Math.sin(a)+(r.position.z-.2),i.rotation.x+=.015,i.rotation.y+=.015,i.rotation.z+=.01)},I=()=>{let q=window.innerWidth,Z=window.innerHeight;(window.innerHeight!==Z||window.innerWidth!==q)&&(t.setSize(q,Z,!1),r.aspect=q/Z,r.updateProjectionMatrix())},C=()=>{y(),T(),I(),t.render(e,r),a+=.01,requestAnimationFrame(C)},M=()=>({onResize:()=>{o.width=window.innerWidth,o.height=window.innerHeight,t.setSize(o.width,o.height),t.setPixelRatio(Math.min(window.devicePixelRatio,2)),r.aspect=o.width/o.height,r.updateProjectionMatrix()},onMouseMove:te=>{let ie=window.innerWidth/2,se=window.innerHeight/2,ae=-1*((ie-te.clientX)/ie),fe=-1*((se-te.clientY)/se);r&&(r.position.x=ae*5),r&&(r.position.y=fe*5),i&&(i.position.x=ae*5),i&&(i.position.y=fe*5)}}),{onResize:B,onMouseMove:k}=M(),j=(q,Z)=>q+Math.random()*(Z-q);return Ae.useEffect(()=>(o.width=window.innerWidth,o.height=window.innerHeight,h(),C(),window.addEventListener("resize",B),window.addEventListener("mousemove",k),()=>{window.removeEventListener("resize",B),window.removeEventListener("mousemove",k)}),[]),me.jsx("div",{className:"w-screen h-screen",children:me.jsx("canvas",{ref:n})})},Yze={name:"LuminosityHighPassShader",shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new Gn(0)},defaultOpacity:{value:0}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform vec3 defaultColor;
		uniform float defaultOpacity;
		uniform float luminosityThreshold;
		uniform float smoothWidth;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );

			vec3 luma = vec3( 0.299, 0.587, 0.114 );

			float v = dot( texel.xyz, luma );

			vec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );

			float alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );

			gl_FragColor = mix( outputColor, texel, alpha );

		}`};class _v extends Pv{constructor(e,t,r,i){super(),this.strength=t!==void 0?t:1,this.radius=r,this.threshold=i,this.resolution=e!==void 0?new nn(e.x,e.y):new nn(256,256),this.clearColor=new Gn(0,0,0),this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;let s=Math.round(this.resolution.x/2),a=Math.round(this.resolution.y/2);this.renderTargetBright=new bl(s,a,{type:Ah}),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(let m=0;m<this.nMips;m++){const _=new bl(s,a,{type:Ah});_.texture.name="UnrealBloomPass.h"+m,_.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(_);const y=new bl(s,a,{type:Ah});y.texture.name="UnrealBloomPass.v"+m,y.texture.generateMipmaps=!1,this.renderTargetsVertical.push(y),s=Math.round(s/2),a=Math.round(a/2)}const l=Yze;this.highPassUniforms=Gm.clone(l.uniforms),this.highPassUniforms.luminosityThreshold.value=i,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new Eo({uniforms:this.highPassUniforms,vertexShader:l.vertexShader,fragmentShader:l.fragmentShader}),this.separableBlurMaterials=[];const o=[3,5,7,9,11];s=Math.round(this.resolution.x/2),a=Math.round(this.resolution.y/2);for(let m=0;m<this.nMips;m++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(o[m])),this.separableBlurMaterials[m].uniforms.invSize.value=new nn(1/s,1/a),s=Math.round(s/2),a=Math.round(a/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=t,this.compositeMaterial.uniforms.bloomRadius.value=.1;const h=[1,.8,.6,.4,.2];this.compositeMaterial.uniforms.bloomFactors.value=h,this.bloomTintColors=[new Ze(1,1,1),new Ze(1,1,1),new Ze(1,1,1),new Ze(1,1,1),new Ze(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors;const d=Xne;this.copyUniforms=Gm.clone(d.uniforms),this.blendMaterial=new Eo({uniforms:this.copyUniforms,vertexShader:d.vertexShader,fragmentShader:d.fragmentShader,blending:Wb,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new Gn,this.oldClearAlpha=1,this.basic=new vo,this.fsQuad=new $T(null)}dispose(){for(let e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(let e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose();this.renderTargetBright.dispose();for(let e=0;e<this.separableBlurMaterials.length;e++)this.separableBlurMaterials[e].dispose();this.compositeMaterial.dispose(),this.blendMaterial.dispose(),this.basic.dispose(),this.fsQuad.dispose()}setSize(e,t){let r=Math.round(e/2),i=Math.round(t/2);this.renderTargetBright.setSize(r,i);for(let s=0;s<this.nMips;s++)this.renderTargetsHorizontal[s].setSize(r,i),this.renderTargetsVertical[s].setSize(r,i),this.separableBlurMaterials[s].uniforms.invSize.value=new nn(1/r,1/i),r=Math.round(r/2),i=Math.round(i/2)}render(e,t,r,i,s){e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();const a=e.autoClear;e.autoClear=!1,e.setClearColor(this.clearColor,0),s&&e.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=r.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e)),this.highPassUniforms.tDiffuse.value=r.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,e.setRenderTarget(this.renderTargetBright),e.clear(),this.fsQuad.render(e);let l=this.renderTargetBright;for(let o=0;o<this.nMips;o++)this.fsQuad.material=this.separableBlurMaterials[o],this.separableBlurMaterials[o].uniforms.colorTexture.value=l.texture,this.separableBlurMaterials[o].uniforms.direction.value=_v.BlurDirectionX,e.setRenderTarget(this.renderTargetsHorizontal[o]),e.clear(),this.fsQuad.render(e),this.separableBlurMaterials[o].uniforms.colorTexture.value=this.renderTargetsHorizontal[o].texture,this.separableBlurMaterials[o].uniforms.direction.value=_v.BlurDirectionY,e.setRenderTarget(this.renderTargetsVertical[o]),e.clear(),this.fsQuad.render(e),l=this.renderTargetsVertical[o];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,e.setRenderTarget(this.renderTargetsHorizontal[0]),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.blendMaterial,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,s&&e.state.buffers.stencil.setTest(!0),this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(r),this.fsQuad.render(e)),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=a}getSeperableBlurMaterial(e){const t=[];for(let r=0;r<e;r++)t.push(.39894*Math.exp(-.5*r*r/(e*e))/e);return new Eo({defines:{KERNEL_RADIUS:e},uniforms:{colorTexture:{value:null},invSize:{value:new nn(.5,.5)},direction:{value:new nn(.5,.5)},gaussianCoefficients:{value:t}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`#include <common>
				varying vec2 vUv;
				uniform sampler2D colorTexture;
				uniform vec2 invSize;
				uniform vec2 direction;
				uniform float gaussianCoefficients[KERNEL_RADIUS];

				void main() {
					float weightSum = gaussianCoefficients[0];
					vec3 diffuseSum = texture2D( colorTexture, vUv ).rgb * weightSum;
					for( int i = 1; i < KERNEL_RADIUS; i ++ ) {
						float x = float(i);
						float w = gaussianCoefficients[i];
						vec2 uvOffset = direction * invSize * x;
						vec3 sample1 = texture2D( colorTexture, vUv + uvOffset ).rgb;
						vec3 sample2 = texture2D( colorTexture, vUv - uvOffset ).rgb;
						diffuseSum += (sample1 + sample2) * w;
						weightSum += 2.0 * w;
					}
					gl_FragColor = vec4(diffuseSum/weightSum, 1.0);
				}`})}getCompositeMaterial(e){return new Eo({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`varying vec2 vUv;
				uniform sampler2D blurTexture1;
				uniform sampler2D blurTexture2;
				uniform sampler2D blurTexture3;
				uniform sampler2D blurTexture4;
				uniform sampler2D blurTexture5;
				uniform float bloomStrength;
				uniform float bloomRadius;
				uniform float bloomFactors[NUM_MIPS];
				uniform vec3 bloomTintColors[NUM_MIPS];

				float lerpBloomFactor(const in float factor) {
					float mirrorFactor = 1.2 - factor;
					return mix(factor, mirrorFactor, bloomRadius);
				}

				void main() {
					gl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +
						lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +
						lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +
						lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +
						lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );
				}`})}}_v.BlurDirectionX=new nn(1,0);_v.BlurDirectionY=new nn(0,1);const sK={name:"ConvolutionShader",defines:{KERNEL_SIZE_FLOAT:"25.0",KERNEL_SIZE_INT:"25"},uniforms:{tDiffuse:{value:null},uImageIncrement:{value:new nn(.001953125,0)},cKernel:{value:[]}},vertexShader:`

		uniform vec2 uImageIncrement;

		varying vec2 vUv;

		void main() {

			vUv = uv - ( ( KERNEL_SIZE_FLOAT - 1.0 ) / 2.0 ) * uImageIncrement;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float cKernel[ KERNEL_SIZE_INT ];

		uniform sampler2D tDiffuse;
		uniform vec2 uImageIncrement;

		varying vec2 vUv;

		void main() {

			vec2 imageCoord = vUv;
			vec4 sum = vec4( 0.0, 0.0, 0.0, 0.0 );

			for( int i = 0; i < KERNEL_SIZE_INT; i ++ ) {

				sum += texture2D( tDiffuse, imageCoord ) * cKernel[ i ];
				imageCoord += uImageIncrement;

			}

			gl_FragColor = sum;

		}`,buildKernel:function(n){let t=2*Math.ceil(n*3)+1;t>25&&(t=25);const r=(t-1)*.5,i=new Array(t);let s=0;for(let a=0;a<t;++a)i[a]=Kze(a-r,n),s+=i[a];for(let a=0;a<t;++a)i[a]/=s;return i}};function Kze(n,e){return Math.exp(-(n*n)/(2*e*e))}class Ny extends Pv{constructor(e=1,t=25,r=4){super(),this.renderTargetX=new bl(1,1,{type:Ah}),this.renderTargetX.texture.name="BloomPass.x",this.renderTargetY=new bl(1,1,{type:Ah}),this.renderTargetY.texture.name="BloomPass.y",this.combineUniforms=Gm.clone(cI.uniforms),this.combineUniforms.strength.value=e,this.materialCombine=new Eo({name:cI.name,uniforms:this.combineUniforms,vertexShader:cI.vertexShader,fragmentShader:cI.fragmentShader,blending:Wb,transparent:!0});const i=sK;this.convolutionUniforms=Gm.clone(i.uniforms),this.convolutionUniforms.uImageIncrement.value=Ny.blurX,this.convolutionUniforms.cKernel.value=sK.buildKernel(r),this.materialConvolution=new Eo({name:i.name,uniforms:this.convolutionUniforms,vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,defines:{KERNEL_SIZE_FLOAT:t.toFixed(1),KERNEL_SIZE_INT:t.toFixed(0)}}),this.needsSwap=!1,this.fsQuad=new $T(null)}render(e,t,r,i,s){s&&e.state.buffers.stencil.setTest(!1),this.fsQuad.material=this.materialConvolution,this.convolutionUniforms.tDiffuse.value=r.texture,this.convolutionUniforms.uImageIncrement.value=Ny.blurX,e.setRenderTarget(this.renderTargetX),e.clear(),this.fsQuad.render(e),this.convolutionUniforms.tDiffuse.value=this.renderTargetX.texture,this.convolutionUniforms.uImageIncrement.value=Ny.blurY,e.setRenderTarget(this.renderTargetY),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.materialCombine,this.combineUniforms.tDiffuse.value=this.renderTargetY.texture,s&&e.state.buffers.stencil.setTest(!0),e.setRenderTarget(r),this.clear&&e.clear(),this.fsQuad.render(e)}setSize(e,t){this.renderTargetX.setSize(e,t),this.renderTargetY.setSize(e,t)}dispose(){this.renderTargetX.dispose(),this.renderTargetY.dispose(),this.materialCombine.dispose(),this.materialConvolution.dispose(),this.fsQuad.dispose()}}const cI={name:"CombineShader",uniforms:{tDiffuse:{value:null},strength:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float strength;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = strength * texel;

		}`};Ny.blurX=new nn(.001953125,0);Ny.blurY=new nn(0,.001953125);const Jze={name:"FilmShader",uniforms:{tDiffuse:{value:null},time:{value:0},intensity:{value:.5},grayscale:{value:!1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		#include <common>

		uniform float intensity;
		uniform bool grayscale;
		uniform float time;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 base = texture2D( tDiffuse, vUv );

			float noise = rand( fract( vUv + time ) );

			vec3 color = base.rgb + base.rgb * clamp( 0.1 + noise, 0.0, 1.0 );

			color = mix( base.rgb, color, intensity );

			if ( grayscale ) {

				color = vec3( luminance( color ) ); // assuming linear-srgb

			}

			gl_FragColor = vec4( color, base.a );

		}`};class Qze extends Pv{constructor(e=.5,t=!1){super();const r=Jze;this.uniforms=Gm.clone(r.uniforms),this.material=new Eo({name:r.name,uniforms:this.uniforms,vertexShader:r.vertexShader,fragmentShader:r.fragmentShader}),this.uniforms.intensity.value=e,this.uniforms.grayscale.value=t,this.fsQuad=new $T(this.material)}render(e,t,r,i){this.uniforms.tDiffuse.value=r.texture,this.uniforms.time.value+=i,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}const e6e=()=>{const n=Ae.useRef(null);let e,t,r,i,s=null,a={width:0,height:0},l;const o=()=>{a.width=window.innerWidth,a.height=window.innerHeight,e=new Al,t=new Qi(75,a.width/a.height,.1,100),t.position.set(1,-1,1),e.add(t),s=new Zl({canvas:n.current,antialias:!0}),s.setSize(a.width,a.height),s.setPixelRatio(Math.min(window.devicePixelRatio,2)),s.autoClear=!1,l=new Ev(t,s.domElement),l.enableDamping=!0;const d=new mp(1,1,1),m=new vo({color:65280});i=new Ei(d,m),e.add(i);const _=new iD(e,t);new _v(new nn(a.width,a.height),1.5,.4,.85);const y=new Ny(1.5,25,4,256),T=new Qze(.35,.25,648,!1);r=new rD(s),r.renderToScreen=!0,r.addPass(_),r.addPass(y),r.addPass(T)},h=()=>{l&&l.update(),i&&(i.rotation.y+=.002),i&&(i.rotation.x+=.002),r&&r.render(),r.setSize(a.width,a.height),s.render(e,t),window.requestAnimationFrame(h)};return Ae.useEffect(()=>{o(),h()},[]),me.jsx("div",{className:"w-screen h-screen",children:me.jsx("canvas",{ref:n})})};var t6e=`varying vec2 vUv;\r
varying vec3 vNormal;\r
varying vec3 vCamPos;

void main() {\r
  vUv = uv;\r
  vNormal = normal;\r
  vCamPos = cameraPosition;\r
  gl_Position =\r
      projectionMatrix * modelViewMatrix *\r
      vec4(position,\r
           1.0); 
}`,n6e=`#define MUN_OCTAVES 5\r
#define M_PI 3.1415926535897932384626433832795\r
precision mediump float;

varying vec3 vNormal;\r
varying vec3 vCamPos;\r
varying vec2 vUv;

uniform vec4 resolution;\r
uniform sampler2D perlinNoise;\r
uniform sampler2D sparkNoise;\r
uniform sampler2D waterTurbulence;\r
uniform sampler2D noiseText;\r
uniform float time;\r
uniform vec3 color0;\r
uniform vec3 color1;\r
uniform vec3 color2;\r
uniform vec3 color3;\r
uniform vec3 color4;\r
uniform vec3 color5;

float Rand(vec2 n) {\r
  return fract(sin(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\r
}

float Noise(vec2 p) {\r
  vec2 ip = floor(p);\r
  vec2 u = fract(p);\r
  u = u * u * (3.0 - 2.0 * u);

  float res =\r
      mix(mix(Rand(ip), Rand(ip + vec2(1.0, 0.0)), u.x),\r
          mix(Rand(ip + vec2(0.0, 1.0)), Rand(ip + vec2(1.0, 1.0)), u.x), u.y);\r
  return res * res;\r
}

float Fbm(vec2 p) {\r
  float v = 0.0;\r
  float a = 0.5;\r
  vec2 shift = vec2(100);\r
  
  mat2 rot = mat2(cos(0.5), sin(0.5), -sin(0.5), cos(0.50));\r
  for (int i = 0; i < MUN_OCTAVES; ++i) {\r
    v += a * Noise(p);\r
    p = rot * p * 2.0 + shift;\r
    a *= 0.5;\r
  }\r
  return v;\r
}

float SetOpacity(float r, float g, float b, float toneThreshold) {\r
  float tone = (r + g + b) / 3.0;\r
  if (tone < toneThreshold) {\r
    return 0.0;\r
  }\r
  return 1.0;\r
}

vec3 Rgbcol(vec3 col) {\r
  return vec3(col.r / 255.0, col.g / 255.0, col.b / 255.0);\r
}

vec2 Rotate(vec2 v, float a) {\r
  float s = sin(a);\r
  float c = cos(a);\r
  mat2 m = mat2(c, -s, s, c);\r
  return m * v;\r
}

vec2 UnityPolarCoordinates(vec2 uv, vec2 center, float radialScale,\r
                           float lengthScale) {\r
  vec2 delta = uv - center;\r
  float radius = length(delta) * radialScale * 2.0;\r
  float angle = atan(delta.x, delta.y) * 1.0 / 6.28 * lengthScale;\r
  return vec2(radius, angle);\r
}

void main() {\r
  
  vec2 oldUv = gl_FragCoord.xy / resolution.xy;\r
  vec2 uv = vUv;\r
  vec2 imgUv = uv;\r
  float scale = 1.0;\r
  oldUv *= 0.5 + time;\r
  oldUv.y = oldUv.y;\r
  vec2 p = oldUv * scale; 

  
  float noise = Fbm(p) * 0.04;\r
  vec4 txt = texture2D(perlinNoise, oldUv);\r
  float gradient = dot(normalize(-vCamPos), normalize(vNormal));\r
  float pct = distance(vUv, vec2(0.5));\r
  
  vec3 rgbColor0 = Rgbcol(color0);\r
  vec3 rgbColor1 = Rgbcol(color1);\r
  vec3 rgbColor2 = Rgbcol(color2);\r
  vec3 rgbColor3 = Rgbcol(color3);\r
  vec3 rgbColor4 = Rgbcol(color4);\r
  vec3 rgbColor5 = Rgbcol(color5);

  
  float y = smoothstep(0.16, 0.525, pct);\r
  vec3 backColor = mix(rgbColor0, rgbColor5, y);\r
  gl_FragColor = vec4(backColor, 1.0);

  
  vec2 center = vec2(0.5);\r
  vec2 cor = UnityPolarCoordinates(vUv, center, 1.0, 1.0);\r
  vec2 newvUv = vUv - 0.5;\r
  vec3 noiseTextvUv =\r
      texture2D(perlinNoise, mod(Rotate(newvUv * 0.15 + vec2(sin(time * 0.005),\r
                                                             cos(time * 0.005)),\r
                                        time),\r
                                 1.0))\r
          .rgb; 

  
  vec2 newUv = vec2(cor.x + time, cor.x + cor.y);\r
  vec3 noiseText1 = texture2D(perlinNoise, mod(newUv, 1.0))\r
                        .rgb; 
  vec3 noiseText2 = texture2D(sparkNoise, mod(newUv, 1.)).rgb;\r
  vec3 noiseText3 = texture2D(waterTurbulence, mod(newUv, 1.))\r
                        .rgb; 

  
  float tone0 = 1. - smoothstep(0.3, 0.6, noiseText1.r);\r
  float tone1 = smoothstep(0.3, 0.6, noiseText2.r);\r
  float tone2 = smoothstep(0.3, 0.6, noiseText3.r);

  
  float opacity0 = SetOpacity(tone0, tone0, tone0, .29);\r
  float opacity1 = SetOpacity(tone1, tone1, tone1, .49);\r
  float opacity2 = SetOpacity(tone2, tone2, tone2, .69);

  
  float gradientTone = 1. - smoothstep(0.196, 0.532, pct);\r
  vec4 circularNoise = vec4(vec3(gradientTone) * noiseTextvUv * 1.4, 1.0);\r
  float gradOpacity =\r
      SetOpacity(circularNoise.r, circularNoise.g, circularNoise.b, 0.19);

  
  vec2 uv2 = uv;\r
  float iTime = time * 0.004;\r
  uv.y += iTime / 10.0;\r
  uv.x -= (sin(iTime / 10.0) / 2.0);\r
  uv2.x += iTime / 14.0;\r
  uv2.x += (sin(iTime / 10.0) / 9.0);\r
  float result = 0.0;\r
  result +=\r
      texture2D(noiseText, mod(uv * 0.5, 1.) * 0.6 + vec2(iTime * (-0.003)))\r
          .r; 
              
  result *=\r
      texture2D(noiseText, mod(uv2 * 0.5, 1.) * 0.9 + vec2(iTime * 0.002)).b;\r
  result = pow(result, 4.0);

  
  if (opacity2 > 0.0) {\r
    gl_FragColor = vec4(rgbColor4, 0.) * vec4(opacity2);\r
  } else if (opacity1 > 0.0) {\r
    gl_FragColor = vec4(rgbColor2, 0.) * vec4(opacity1);\r
  } else if (opacity0 > 0.0) {\r
    gl_FragColor = vec4(rgbColor1, 0.) * vec4(opacity0);\r
  }\r
  gl_FragColor += vec4(108.0) * result * (y * 0.02);\r
  gl_FragColor *= vec4(gradOpacity);\r
}`;const r6e=""+new URL("rickAndMorty-Do2rctLy.glb",import.meta.url).href,i6e=""+new URL("waterturbulence-D5gcttvO.png",import.meta.url).href,s6e=""+new URL("noise-CSy_EG5b.png",import.meta.url).href,o6e=()=>{const n=Ae.useRef(null);let e,t,r,i=null,s={width:0,height:0},a,l,o=null,h=null;const d=()=>{s.width=window.innerWidth,s.height=window.innerHeight,e=new Al,t=new Qi(75,s.width/s.height,.1,100),t.position.set(0,1,5),e.add(t),r=new Zl({canvas:n.current,antialias:!0,alpha:!0}),r.setSize(s.width,s.height),r.setPixelRatio(Math.min(window.devicePixelRatio,2)),r.autoClear=!1,r.setClearAlpha(0),r.physicallyCorrectLights=!0,r.toneMapping=AL,r.toneMappingExposure=2,r.render(e,t);const C=new Cv(16777215,1);C.castShadow=!0,C.shadow.camera.far=15,C.shadow.mapSize.set(1024,1024),C.shadow.normalBias=.05,C.position.set(.25,3,-1.25),e.add(C);const M=new mx(16777215,1.2);e.add(M),i=new Ev(t,r.domElement),i.enableDamping=!0,i.enablePan=!1,i.minPolarAngle=.5,i.maxPolarAngle=2.5,i.minAzimuthAngle=-1,i.maxAzimuthAngle=1},m={exposure:2.8,bloomStrength:2.39,bloomThreshold:0,bloomRadius:.38,color0:[1,5,1],color1:[2,20,2],color2:[44,97,15],color3:[14,28,5],color4:[255,255,255],color5:[74,145,0]},_=()=>{const C=new iD(e,t),M=new _v(new nn(s.width,s.height),1.5,.4,.85);M.threshold=m.bloomThreshold,M.strength=m.bloomStrength,M.radius=m.bloomRadius,h=new rD(r),h.renderToScreen=!0,h.addPass(C),h.addPass(M)},y=()=>{const C=new Jm(8,8,1,1),M=new qf;l=new Eo({uniforms:{time:{type:"f",value:0},perlinNoise:{type:"t",value:M.load(Vae)},sparkNoise:{type:"t",value:M.load(Gae)},waterTurbulence:{type:"t",value:M.load(i6e)},noiseText:{type:"t",value:M.load(s6e)},color0:{value:new Ze(...m.color0)},color1:{value:new Ze(...m.color1)},color2:{value:new Ze(...m.color2)},color3:{value:new Ze(...m.color3)},color4:{value:new Ze(...m.color4)},color5:{value:new Ze(...m.color5)},resolution:{value:new nn(s.width,s.height)}},vertexShader:t6e,fragmentShader:n6e}),a=new Ei(C,l),a.layers.enable(1),e.add(a),_();const B=new GT;B.onLoad=()=>{};const k=new f8;k.setDecoderPath("/draco/"),k.setDecoderConfig({type:"js"});const j=new GD(B);j.setDRACOLoader(k),j.load(r6e,q=>{q.scene&&(o=q.scene,o.scale.set(.02,.02,.02),o.position.x=-.5,o.rotation.y=Math.PI,o.layers.set(0),e.add(o))})},T=()=>{const C=new MSe,M=C.addFolder("bloom");M.add(m,"bloomStrength",0,10).name("bloomStrength").listen(),M.add(m,"bloomRadius",.1,10).name("bloomRadius").listen(),M.open();const B=C.addFolder("Colors");B.addColor(m,"color0").name("layer0"),B.addColor(m,"color1").name("layer1"),B.addColor(m,"color2").name("layer2"),B.addColor(m,"color3").name("layer3"),B.addColor(m,"color4").name("layer4"),B.addColor(m,"color5").name("layer5"),B.open()},I=C=>{const M=new Qm;l.uniforms.time.value=C/5e3,l.uniforms.color5.value=new Ze(...m.color5),l.uniforms.color4.value=new Ze(...m.color4),l.uniforms.color3.value=new Ze(...m.color3),l.uniforms.color2.value=new Ze(...m.color2),l.uniforms.color1.value=new Ze(...m.color1),l.uniforms.color0.value=new Ze(...m.color0),r.clear(),t.layers.set(1),h.render(),r.clearDepth(),t.layers.set(0),r.render(e,t);const k=M.getElapsedTime()*.5;o&&(o.rotation.x=Math.cos(k)*.2,o.rotation.z=Math.sin(k)*.1,o.position.z+=Math.cos(k)*.005);const j=Math.cos(k)*2+3;a&&a.scale.set(j,j,j),i.update(),window.requestAnimationFrame(I)};return Ae.useEffect(()=>{d(),y(),T(),I()},[]),me.jsx("div",{className:"w-screen h-screen bg-black",children:me.jsx("canvas",{ref:n})})};var a6e=`varying vec2 vUv;

void main() {\r
  gl_Position =\r
      projectionMatrix * modelViewMatrix *\r
      vec4(position,\r
           1.0); 
  vUv = uv;\r
}`,l6e=`precision mediump float;\r
#define PI 3.1415926535897932384626433832795

varying vec2 vUv;

float random(vec2 st) {\r
  return fract(sin(dot(st.xy, vec2(12.9898, 78.233))) * 43758.5453123);\r
}

vec2 rotate(vec2 uv, float rotation, vec2 mid) {\r
  return vec2(\r
      cos(rotation) * (uv.x - mid.x) - sin(rotation) * (uv.y - mid.y) + mid.x,\r
      sin(rotation) * (uv.x - mid.x) + cos(rotation) * (uv.y - mid.y) + mid.y);\r
}\r

vec2 fade(vec2 t) { return t * t * t * (t * (t * 6.0 - 15.0) + 10.0); }

vec4 permute(vec4 x) { return mod(((x * 34.0) + 1.0) * x, 289.0); }

float cnoise(vec2 P) {\r
  vec4 Pi = floor(P.xyxy) + vec4(0.0, 0.0, 1.0, 1.0);\r
  vec4 Pf = fract(P.xyxy) - vec4(0.0, 0.0, 1.0, 1.0);\r
  Pi = mod(Pi, 289.0); 
  vec4 ix = Pi.xzxz;\r
  vec4 iy = Pi.yyww;\r
  vec4 fx = Pf.xzxz;\r
  vec4 fy = Pf.yyww;\r
  vec4 i = permute(permute(ix) + iy);\r
  vec4 gx = 2.0 * fract(i * 0.0243902439) - 1.0; 
  vec4 gy = abs(gx) - 0.5;\r
  vec4 tx = floor(gx + 0.5);\r
  gx = gx - tx;\r
  vec2 g00 = vec2(gx.x, gy.x);\r
  vec2 g10 = vec2(gx.y, gy.y);\r
  vec2 g01 = vec2(gx.z, gy.z);\r
  vec2 g11 = vec2(gx.w, gy.w);\r
  vec4 norm =\r
      1.79284291400159 - 0.85373472095314 * vec4(dot(g00, g00), dot(g01, g01),\r
                                                 dot(g10, g10), dot(g11, g11));\r
  g00 *= norm.x;\r
  g01 *= norm.y;\r
  g10 *= norm.z;\r
  g11 *= norm.w;\r
  float n00 = dot(g00, vec2(fx.x, fy.x));\r
  float n10 = dot(g10, vec2(fx.y, fy.y));\r
  float n01 = dot(g01, vec2(fx.z, fy.z));\r
  float n11 = dot(g11, vec2(fx.w, fy.w));\r
  vec2 fade_xy = fade(Pf.xy);\r
  vec2 n_x = mix(vec2(n00, n01), vec2(n10, n11), fade_xy.x);\r
  float n_xy = mix(n_x.x, n_x.y, fade_xy.y);\r
  return 2.3 * n_xy;\r
}

void main() {\r
  
  
  
  
  
  
  
  

  
  
  
  
  

  vec2 rotateUv = rotate(vUv, PI / 4.0, vec2(0.5));\r
  
  
  
  
  
  
  
  
  
  

  
  
  
  
  

  

  
  
  
  
  
  
  
  
  

  
  

  
  

  
  
  
  

  
  
  

  float strength = step(0.9, sin(cnoise(vUv * 10.0) * 20.0));

  vec3 blackColor = vec3(0.0);\r
  vec3 uvColor = vec3(vUv, 0.2);\r
  vec3 mixColor = mix(blackColor, uvColor, strength);\r
  gl_FragColor = vec4(mixColor, 1.0);\r
}`;const c6e=()=>{let n,e,t=null,r={width:0,height:0},i=Ae.useRef(null),s,a,l=null;const o=()=>{r.width=window.innerWidth,r.height=window.innerHeight,n=new Al,e=new Qi(75,r.width/r.height,.1,100),e.position.set(1,-1,1),n.add(e),t=new Zl({canvas:i.current}),t.setSize(r.width,r.height),t.setPixelRatio(Math.min(window.devicePixelRatio,2)),t.autoClear=!1,a=new Ev(e,t.domElement),a.enableDamping=!0;const d=new Yy(1,64),m=new Eo({vertexShader:a6e,fragmentShader:l6e,side:bc});s=new Ei(d,m),n.add(s);const _=new iD(n,e),y=new _v(new nn(r.width,r.height),2.2,.2,0);l=new rD(t),l.renderToScreen=!0,l.addPass(_),l.addPass(y)},h=()=>{a&&a.update(),s&&(s.rotation.y+=.002),s&&(s.rotation.x+=.002),l&&l.render(),a.update(),t.render(n,e),requestAnimationFrame(h)};return Ae.useEffect(()=>{o(),h()},[]),me.jsx("div",{className:"w-screen h-screen",children:me.jsx("canvas",{ref:i})})};var Ile={exports:{}};(function(n,e){var t={};(function(r,i){n.exports=i()})(mfe,function(){var r,i,s;function a(o,h){if(!r)r=h;else if(!i)i=h;else{var d="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+r+")(sharedChunk); ("+i+")(sharedChunk); self.onerror = null;",m={};r(m),s=h(m),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(s.workerUrl=window.URL.createObjectURL(new Blob([d],{type:"text/javascript"})))}}a(["exports"],function(o){function h(g){return g&&g.__esModule&&Object.prototype.hasOwnProperty.call(g,"default")?g.default:g}var d,m={},_={};function y(){if(d)return _;d=1,Object.defineProperty(_,"__esModule",{value:!0}),_.setMatrixArrayType=function(S){_.ARRAY_TYPE=c=S},_.toRadian=function(S){return S*v},_.equals=function(S,x){return Math.abs(S-x)<=g*Math.max(1,Math.abs(S),Math.abs(x))},_.RANDOM=_.ARRAY_TYPE=_.EPSILON=void 0;var g=1e-6;_.EPSILON=g;var c=typeof Float32Array<"u"?Float32Array:Array;_.ARRAY_TYPE=c;var f=Math.random;_.RANDOM=f;var v=Math.PI/180;return Math.hypot||(Math.hypot=function(){for(var S=0,x=arguments.length;x--;)S+=arguments[x]*arguments[x];return Math.sqrt(S)}),_}var T,I={};function C(){if(T)return I;function g(x){return g=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(A){return typeof A}:function(A){return A&&typeof Symbol=="function"&&A.constructor===Symbol&&A!==Symbol.prototype?"symbol":typeof A},g(x)}T=1,Object.defineProperty(I,"__esModule",{value:!0}),I.create=function(){var x=new c.ARRAY_TYPE(4);return c.ARRAY_TYPE!=Float32Array&&(x[1]=0,x[2]=0),x[0]=1,x[3]=1,x},I.clone=function(x){var A=new c.ARRAY_TYPE(4);return A[0]=x[0],A[1]=x[1],A[2]=x[2],A[3]=x[3],A},I.copy=function(x,A){return x[0]=A[0],x[1]=A[1],x[2]=A[2],x[3]=A[3],x},I.identity=function(x){return x[0]=1,x[1]=0,x[2]=0,x[3]=1,x},I.fromValues=function(x,A,D,U){var H=new c.ARRAY_TYPE(4);return H[0]=x,H[1]=A,H[2]=D,H[3]=U,H},I.set=function(x,A,D,U,H){return x[0]=A,x[1]=D,x[2]=U,x[3]=H,x},I.transpose=function(x,A){if(x===A){var D=A[1];x[1]=A[2],x[2]=D}else x[0]=A[0],x[1]=A[2],x[2]=A[1],x[3]=A[3];return x},I.invert=function(x,A){var D=A[0],U=A[1],H=A[2],R=A[3],N=D*R-H*U;return N?(x[0]=R*(N=1/N),x[1]=-U*N,x[2]=-H*N,x[3]=D*N,x):null},I.adjoint=function(x,A){var D=A[0];return x[0]=A[3],x[1]=-A[1],x[2]=-A[2],x[3]=D,x},I.determinant=function(x){return x[0]*x[3]-x[2]*x[1]},I.multiply=v,I.rotate=function(x,A,D){var U=A[0],H=A[1],R=A[2],N=A[3],G=Math.sin(D),z=Math.cos(D);return x[0]=U*z+R*G,x[1]=H*z+N*G,x[2]=U*-G+R*z,x[3]=H*-G+N*z,x},I.scale=function(x,A,D){var U=A[1],H=A[2],R=A[3],N=D[0],G=D[1];return x[0]=A[0]*N,x[1]=U*N,x[2]=H*G,x[3]=R*G,x},I.fromRotation=function(x,A){var D=Math.sin(A),U=Math.cos(A);return x[0]=U,x[1]=D,x[2]=-D,x[3]=U,x},I.fromScaling=function(x,A){return x[0]=A[0],x[1]=0,x[2]=0,x[3]=A[1],x},I.str=function(x){return"mat2("+x[0]+", "+x[1]+", "+x[2]+", "+x[3]+")"},I.frob=function(x){return Math.hypot(x[0],x[1],x[2],x[3])},I.LDU=function(x,A,D,U){return x[2]=U[2]/U[0],D[0]=U[0],D[1]=U[1],D[3]=U[3]-x[2]*D[1],[x,A,D]},I.add=function(x,A,D){return x[0]=A[0]+D[0],x[1]=A[1]+D[1],x[2]=A[2]+D[2],x[3]=A[3]+D[3],x},I.subtract=S,I.exactEquals=function(x,A){return x[0]===A[0]&&x[1]===A[1]&&x[2]===A[2]&&x[3]===A[3]},I.equals=function(x,A){var D=x[0],U=x[1],H=x[2],R=x[3],N=A[0],G=A[1],z=A[2],V=A[3];return Math.abs(D-N)<=c.EPSILON*Math.max(1,Math.abs(D),Math.abs(N))&&Math.abs(U-G)<=c.EPSILON*Math.max(1,Math.abs(U),Math.abs(G))&&Math.abs(H-z)<=c.EPSILON*Math.max(1,Math.abs(H),Math.abs(z))&&Math.abs(R-V)<=c.EPSILON*Math.max(1,Math.abs(R),Math.abs(V))},I.multiplyScalar=function(x,A,D){return x[0]=A[0]*D,x[1]=A[1]*D,x[2]=A[2]*D,x[3]=A[3]*D,x},I.multiplyScalarAndAdd=function(x,A,D,U){return x[0]=A[0]+D[0]*U,x[1]=A[1]+D[1]*U,x[2]=A[2]+D[2]*U,x[3]=A[3]+D[3]*U,x},I.sub=I.mul=void 0;var c=function(x,A){if(x&&x.__esModule)return x;if(x===null||g(x)!=="object"&&typeof x!="function")return{default:x};var D=f(void 0);if(D&&D.has(x))return D.get(x);var U={},H=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var R in x)if(R!=="default"&&Object.prototype.hasOwnProperty.call(x,R)){var N=H?Object.getOwnPropertyDescriptor(x,R):null;N&&(N.get||N.set)?Object.defineProperty(U,R,N):U[R]=x[R]}return U.default=x,D&&D.set(x,U),U}(y());function f(x){if(typeof WeakMap!="function")return null;var A=new WeakMap,D=new WeakMap;return(f=function(U){return U?D:A})(x)}function v(x,A,D){var U=A[0],H=A[1],R=A[2],N=A[3],G=D[0],z=D[1],V=D[2],X=D[3];return x[0]=U*G+R*z,x[1]=H*G+N*z,x[2]=U*V+R*X,x[3]=H*V+N*X,x}function S(x,A,D){return x[0]=A[0]-D[0],x[1]=A[1]-D[1],x[2]=A[2]-D[2],x[3]=A[3]-D[3],x}return I.mul=v,I.sub=S,I}var M,B={};function k(){if(M)return B;function g(x){return g=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(A){return typeof A}:function(A){return A&&typeof Symbol=="function"&&A.constructor===Symbol&&A!==Symbol.prototype?"symbol":typeof A},g(x)}M=1,Object.defineProperty(B,"__esModule",{value:!0}),B.create=function(){var x=new c.ARRAY_TYPE(6);return c.ARRAY_TYPE!=Float32Array&&(x[1]=0,x[2]=0,x[4]=0,x[5]=0),x[0]=1,x[3]=1,x},B.clone=function(x){var A=new c.ARRAY_TYPE(6);return A[0]=x[0],A[1]=x[1],A[2]=x[2],A[3]=x[3],A[4]=x[4],A[5]=x[5],A},B.copy=function(x,A){return x[0]=A[0],x[1]=A[1],x[2]=A[2],x[3]=A[3],x[4]=A[4],x[5]=A[5],x},B.identity=function(x){return x[0]=1,x[1]=0,x[2]=0,x[3]=1,x[4]=0,x[5]=0,x},B.fromValues=function(x,A,D,U,H,R){var N=new c.ARRAY_TYPE(6);return N[0]=x,N[1]=A,N[2]=D,N[3]=U,N[4]=H,N[5]=R,N},B.set=function(x,A,D,U,H,R,N){return x[0]=A,x[1]=D,x[2]=U,x[3]=H,x[4]=R,x[5]=N,x},B.invert=function(x,A){var D=A[0],U=A[1],H=A[2],R=A[3],N=A[4],G=A[5],z=D*R-U*H;return z?(x[0]=R*(z=1/z),x[1]=-U*z,x[2]=-H*z,x[3]=D*z,x[4]=(H*G-R*N)*z,x[5]=(U*N-D*G)*z,x):null},B.determinant=function(x){return x[0]*x[3]-x[1]*x[2]},B.multiply=v,B.rotate=function(x,A,D){var U=A[0],H=A[1],R=A[2],N=A[3],G=A[4],z=A[5],V=Math.sin(D),X=Math.cos(D);return x[0]=U*X+R*V,x[1]=H*X+N*V,x[2]=U*-V+R*X,x[3]=H*-V+N*X,x[4]=G,x[5]=z,x},B.scale=function(x,A,D){var U=A[1],H=A[2],R=A[3],N=A[4],G=A[5],z=D[0],V=D[1];return x[0]=A[0]*z,x[1]=U*z,x[2]=H*V,x[3]=R*V,x[4]=N,x[5]=G,x},B.translate=function(x,A,D){var U=A[0],H=A[1],R=A[2],N=A[3],G=A[4],z=A[5],V=D[0],X=D[1];return x[0]=U,x[1]=H,x[2]=R,x[3]=N,x[4]=U*V+R*X+G,x[5]=H*V+N*X+z,x},B.fromRotation=function(x,A){var D=Math.sin(A),U=Math.cos(A);return x[0]=U,x[1]=D,x[2]=-D,x[3]=U,x[4]=0,x[5]=0,x},B.fromScaling=function(x,A){return x[0]=A[0],x[1]=0,x[2]=0,x[3]=A[1],x[4]=0,x[5]=0,x},B.fromTranslation=function(x,A){return x[0]=1,x[1]=0,x[2]=0,x[3]=1,x[4]=A[0],x[5]=A[1],x},B.str=function(x){return"mat2d("+x[0]+", "+x[1]+", "+x[2]+", "+x[3]+", "+x[4]+", "+x[5]+")"},B.frob=function(x){return Math.hypot(x[0],x[1],x[2],x[3],x[4],x[5],1)},B.add=function(x,A,D){return x[0]=A[0]+D[0],x[1]=A[1]+D[1],x[2]=A[2]+D[2],x[3]=A[3]+D[3],x[4]=A[4]+D[4],x[5]=A[5]+D[5],x},B.subtract=S,B.multiplyScalar=function(x,A,D){return x[0]=A[0]*D,x[1]=A[1]*D,x[2]=A[2]*D,x[3]=A[3]*D,x[4]=A[4]*D,x[5]=A[5]*D,x},B.multiplyScalarAndAdd=function(x,A,D,U){return x[0]=A[0]+D[0]*U,x[1]=A[1]+D[1]*U,x[2]=A[2]+D[2]*U,x[3]=A[3]+D[3]*U,x[4]=A[4]+D[4]*U,x[5]=A[5]+D[5]*U,x},B.exactEquals=function(x,A){return x[0]===A[0]&&x[1]===A[1]&&x[2]===A[2]&&x[3]===A[3]&&x[4]===A[4]&&x[5]===A[5]},B.equals=function(x,A){var D=x[0],U=x[1],H=x[2],R=x[3],N=x[4],G=x[5],z=A[0],V=A[1],X=A[2],K=A[3],ee=A[4],ce=A[5];return Math.abs(D-z)<=c.EPSILON*Math.max(1,Math.abs(D),Math.abs(z))&&Math.abs(U-V)<=c.EPSILON*Math.max(1,Math.abs(U),Math.abs(V))&&Math.abs(H-X)<=c.EPSILON*Math.max(1,Math.abs(H),Math.abs(X))&&Math.abs(R-K)<=c.EPSILON*Math.max(1,Math.abs(R),Math.abs(K))&&Math.abs(N-ee)<=c.EPSILON*Math.max(1,Math.abs(N),Math.abs(ee))&&Math.abs(G-ce)<=c.EPSILON*Math.max(1,Math.abs(G),Math.abs(ce))},B.sub=B.mul=void 0;var c=function(x,A){if(x&&x.__esModule)return x;if(x===null||g(x)!=="object"&&typeof x!="function")return{default:x};var D=f(void 0);if(D&&D.has(x))return D.get(x);var U={},H=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var R in x)if(R!=="default"&&Object.prototype.hasOwnProperty.call(x,R)){var N=H?Object.getOwnPropertyDescriptor(x,R):null;N&&(N.get||N.set)?Object.defineProperty(U,R,N):U[R]=x[R]}return U.default=x,D&&D.set(x,U),U}(y());function f(x){if(typeof WeakMap!="function")return null;var A=new WeakMap,D=new WeakMap;return(f=function(U){return U?D:A})(x)}function v(x,A,D){var U=A[0],H=A[1],R=A[2],N=A[3],G=A[4],z=A[5],V=D[0],X=D[1],K=D[2],ee=D[3],ce=D[4],he=D[5];return x[0]=U*V+R*X,x[1]=H*V+N*X,x[2]=U*K+R*ee,x[3]=H*K+N*ee,x[4]=U*ce+R*he+G,x[5]=H*ce+N*he+z,x}function S(x,A,D){return x[0]=A[0]-D[0],x[1]=A[1]-D[1],x[2]=A[2]-D[2],x[3]=A[3]-D[3],x[4]=A[4]-D[4],x[5]=A[5]-D[5],x}return B.mul=v,B.sub=S,B}var j,q={};function Z(){if(j)return q;function g(x){return g=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(A){return typeof A}:function(A){return A&&typeof Symbol=="function"&&A.constructor===Symbol&&A!==Symbol.prototype?"symbol":typeof A},g(x)}j=1,Object.defineProperty(q,"__esModule",{value:!0}),q.create=function(){var x=new c.ARRAY_TYPE(9);return c.ARRAY_TYPE!=Float32Array&&(x[1]=0,x[2]=0,x[3]=0,x[5]=0,x[6]=0,x[7]=0),x[0]=1,x[4]=1,x[8]=1,x},q.fromMat4=function(x,A){return x[0]=A[0],x[1]=A[1],x[2]=A[2],x[3]=A[4],x[4]=A[5],x[5]=A[6],x[6]=A[8],x[7]=A[9],x[8]=A[10],x},q.clone=function(x){var A=new c.ARRAY_TYPE(9);return A[0]=x[0],A[1]=x[1],A[2]=x[2],A[3]=x[3],A[4]=x[4],A[5]=x[5],A[6]=x[6],A[7]=x[7],A[8]=x[8],A},q.copy=function(x,A){return x[0]=A[0],x[1]=A[1],x[2]=A[2],x[3]=A[3],x[4]=A[4],x[5]=A[5],x[6]=A[6],x[7]=A[7],x[8]=A[8],x},q.fromValues=function(x,A,D,U,H,R,N,G,z){var V=new c.ARRAY_TYPE(9);return V[0]=x,V[1]=A,V[2]=D,V[3]=U,V[4]=H,V[5]=R,V[6]=N,V[7]=G,V[8]=z,V},q.set=function(x,A,D,U,H,R,N,G,z,V){return x[0]=A,x[1]=D,x[2]=U,x[3]=H,x[4]=R,x[5]=N,x[6]=G,x[7]=z,x[8]=V,x},q.identity=function(x){return x[0]=1,x[1]=0,x[2]=0,x[3]=0,x[4]=1,x[5]=0,x[6]=0,x[7]=0,x[8]=1,x},q.transpose=function(x,A){if(x===A){var D=A[1],U=A[2],H=A[5];x[1]=A[3],x[2]=A[6],x[3]=D,x[5]=A[7],x[6]=U,x[7]=H}else x[0]=A[0],x[1]=A[3],x[2]=A[6],x[3]=A[1],x[4]=A[4],x[5]=A[7],x[6]=A[2],x[7]=A[5],x[8]=A[8];return x},q.invert=function(x,A){var D=A[0],U=A[1],H=A[2],R=A[3],N=A[4],G=A[5],z=A[6],V=A[7],X=A[8],K=X*N-G*V,ee=-X*R+G*z,ce=V*R-N*z,he=D*K+U*ee+H*ce;return he?(x[0]=K*(he=1/he),x[1]=(-X*U+H*V)*he,x[2]=(G*U-H*N)*he,x[3]=ee*he,x[4]=(X*D-H*z)*he,x[5]=(-G*D+H*R)*he,x[6]=ce*he,x[7]=(-V*D+U*z)*he,x[8]=(N*D-U*R)*he,x):null},q.adjoint=function(x,A){var D=A[0],U=A[1],H=A[2],R=A[3],N=A[4],G=A[5],z=A[6],V=A[7],X=A[8];return x[0]=N*X-G*V,x[1]=H*V-U*X,x[2]=U*G-H*N,x[3]=G*z-R*X,x[4]=D*X-H*z,x[5]=H*R-D*G,x[6]=R*V-N*z,x[7]=U*z-D*V,x[8]=D*N-U*R,x},q.determinant=function(x){var A=x[3],D=x[4],U=x[5],H=x[6],R=x[7],N=x[8];return x[0]*(N*D-U*R)+x[1]*(-N*A+U*H)+x[2]*(R*A-D*H)},q.multiply=v,q.translate=function(x,A,D){var U=A[0],H=A[1],R=A[2],N=A[3],G=A[4],z=A[5],V=A[6],X=A[7],K=A[8],ee=D[0],ce=D[1];return x[0]=U,x[1]=H,x[2]=R,x[3]=N,x[4]=G,x[5]=z,x[6]=ee*U+ce*N+V,x[7]=ee*H+ce*G+X,x[8]=ee*R+ce*z+K,x},q.rotate=function(x,A,D){var U=A[0],H=A[1],R=A[2],N=A[3],G=A[4],z=A[5],V=A[6],X=A[7],K=A[8],ee=Math.sin(D),ce=Math.cos(D);return x[0]=ce*U+ee*N,x[1]=ce*H+ee*G,x[2]=ce*R+ee*z,x[3]=ce*N-ee*U,x[4]=ce*G-ee*H,x[5]=ce*z-ee*R,x[6]=V,x[7]=X,x[8]=K,x},q.scale=function(x,A,D){var U=D[0],H=D[1];return x[0]=U*A[0],x[1]=U*A[1],x[2]=U*A[2],x[3]=H*A[3],x[4]=H*A[4],x[5]=H*A[5],x[6]=A[6],x[7]=A[7],x[8]=A[8],x},q.fromTranslation=function(x,A){return x[0]=1,x[1]=0,x[2]=0,x[3]=0,x[4]=1,x[5]=0,x[6]=A[0],x[7]=A[1],x[8]=1,x},q.fromRotation=function(x,A){var D=Math.sin(A),U=Math.cos(A);return x[0]=U,x[1]=D,x[2]=0,x[3]=-D,x[4]=U,x[5]=0,x[6]=0,x[7]=0,x[8]=1,x},q.fromScaling=function(x,A){return x[0]=A[0],x[1]=0,x[2]=0,x[3]=0,x[4]=A[1],x[5]=0,x[6]=0,x[7]=0,x[8]=1,x},q.fromMat2d=function(x,A){return x[0]=A[0],x[1]=A[1],x[2]=0,x[3]=A[2],x[4]=A[3],x[5]=0,x[6]=A[4],x[7]=A[5],x[8]=1,x},q.fromQuat=function(x,A){var D=A[0],U=A[1],H=A[2],R=A[3],N=D+D,G=U+U,z=H+H,V=D*N,X=U*N,K=U*G,ee=H*N,ce=H*G,he=H*z,ne=R*N,de=R*G,ge=R*z;return x[0]=1-K-he,x[3]=X-ge,x[6]=ee+de,x[1]=X+ge,x[4]=1-V-he,x[7]=ce-ne,x[2]=ee-de,x[5]=ce+ne,x[8]=1-V-K,x},q.normalFromMat4=function(x,A){var D=A[0],U=A[1],H=A[2],R=A[3],N=A[4],G=A[5],z=A[6],V=A[7],X=A[8],K=A[9],ee=A[10],ce=A[11],he=A[12],ne=A[13],de=A[14],ge=A[15],Me=D*G-U*N,Be=D*z-H*N,Oe=D*V-R*N,Ie=U*z-H*G,Ye=U*V-R*G,ze=H*V-R*z,Qe=X*ne-K*he,lt=X*de-ee*he,ut=X*ge-ce*he,ht=K*de-ee*ne,mt=K*ge-ce*ne,Et=ee*ge-ce*de,vt=Me*Et-Be*mt+Oe*ht+Ie*ut-Ye*lt+ze*Qe;return vt?(x[0]=(G*Et-z*mt+V*ht)*(vt=1/vt),x[1]=(z*ut-N*Et-V*lt)*vt,x[2]=(N*mt-G*ut+V*Qe)*vt,x[3]=(H*mt-U*Et-R*ht)*vt,x[4]=(D*Et-H*ut+R*lt)*vt,x[5]=(U*ut-D*mt-R*Qe)*vt,x[6]=(ne*ze-de*Ye+ge*Ie)*vt,x[7]=(de*Oe-he*ze-ge*Be)*vt,x[8]=(he*Ye-ne*Oe+ge*Me)*vt,x):null},q.projection=function(x,A,D){return x[0]=2/A,x[1]=0,x[2]=0,x[3]=0,x[4]=-2/D,x[5]=0,x[6]=-1,x[7]=1,x[8]=1,x},q.str=function(x){return"mat3("+x[0]+", "+x[1]+", "+x[2]+", "+x[3]+", "+x[4]+", "+x[5]+", "+x[6]+", "+x[7]+", "+x[8]+")"},q.frob=function(x){return Math.hypot(x[0],x[1],x[2],x[3],x[4],x[5],x[6],x[7],x[8])},q.add=function(x,A,D){return x[0]=A[0]+D[0],x[1]=A[1]+D[1],x[2]=A[2]+D[2],x[3]=A[3]+D[3],x[4]=A[4]+D[4],x[5]=A[5]+D[5],x[6]=A[6]+D[6],x[7]=A[7]+D[7],x[8]=A[8]+D[8],x},q.subtract=S,q.multiplyScalar=function(x,A,D){return x[0]=A[0]*D,x[1]=A[1]*D,x[2]=A[2]*D,x[3]=A[3]*D,x[4]=A[4]*D,x[5]=A[5]*D,x[6]=A[6]*D,x[7]=A[7]*D,x[8]=A[8]*D,x},q.multiplyScalarAndAdd=function(x,A,D,U){return x[0]=A[0]+D[0]*U,x[1]=A[1]+D[1]*U,x[2]=A[2]+D[2]*U,x[3]=A[3]+D[3]*U,x[4]=A[4]+D[4]*U,x[5]=A[5]+D[5]*U,x[6]=A[6]+D[6]*U,x[7]=A[7]+D[7]*U,x[8]=A[8]+D[8]*U,x},q.exactEquals=function(x,A){return x[0]===A[0]&&x[1]===A[1]&&x[2]===A[2]&&x[3]===A[3]&&x[4]===A[4]&&x[5]===A[5]&&x[6]===A[6]&&x[7]===A[7]&&x[8]===A[8]},q.equals=function(x,A){var D=x[0],U=x[1],H=x[2],R=x[3],N=x[4],G=x[5],z=x[6],V=x[7],X=x[8],K=A[0],ee=A[1],ce=A[2],he=A[3],ne=A[4],de=A[5],ge=A[6],Me=A[7],Be=A[8];return Math.abs(D-K)<=c.EPSILON*Math.max(1,Math.abs(D),Math.abs(K))&&Math.abs(U-ee)<=c.EPSILON*Math.max(1,Math.abs(U),Math.abs(ee))&&Math.abs(H-ce)<=c.EPSILON*Math.max(1,Math.abs(H),Math.abs(ce))&&Math.abs(R-he)<=c.EPSILON*Math.max(1,Math.abs(R),Math.abs(he))&&Math.abs(N-ne)<=c.EPSILON*Math.max(1,Math.abs(N),Math.abs(ne))&&Math.abs(G-de)<=c.EPSILON*Math.max(1,Math.abs(G),Math.abs(de))&&Math.abs(z-ge)<=c.EPSILON*Math.max(1,Math.abs(z),Math.abs(ge))&&Math.abs(V-Me)<=c.EPSILON*Math.max(1,Math.abs(V),Math.abs(Me))&&Math.abs(X-Be)<=c.EPSILON*Math.max(1,Math.abs(X),Math.abs(Be))},q.sub=q.mul=void 0;var c=function(x,A){if(x&&x.__esModule)return x;if(x===null||g(x)!=="object"&&typeof x!="function")return{default:x};var D=f(void 0);if(D&&D.has(x))return D.get(x);var U={},H=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var R in x)if(R!=="default"&&Object.prototype.hasOwnProperty.call(x,R)){var N=H?Object.getOwnPropertyDescriptor(x,R):null;N&&(N.get||N.set)?Object.defineProperty(U,R,N):U[R]=x[R]}return U.default=x,D&&D.set(x,U),U}(y());function f(x){if(typeof WeakMap!="function")return null;var A=new WeakMap,D=new WeakMap;return(f=function(U){return U?D:A})(x)}function v(x,A,D){var U=A[0],H=A[1],R=A[2],N=A[3],G=A[4],z=A[5],V=A[6],X=A[7],K=A[8],ee=D[0],ce=D[1],he=D[2],ne=D[3],de=D[4],ge=D[5],Me=D[6],Be=D[7],Oe=D[8];return x[0]=ee*U+ce*N+he*V,x[1]=ee*H+ce*G+he*X,x[2]=ee*R+ce*z+he*K,x[3]=ne*U+de*N+ge*V,x[4]=ne*H+de*G+ge*X,x[5]=ne*R+de*z+ge*K,x[6]=Me*U+Be*N+Oe*V,x[7]=Me*H+Be*G+Oe*X,x[8]=Me*R+Be*z+Oe*K,x}function S(x,A,D){return x[0]=A[0]-D[0],x[1]=A[1]-D[1],x[2]=A[2]-D[2],x[3]=A[3]-D[3],x[4]=A[4]-D[4],x[5]=A[5]-D[5],x[6]=A[6]-D[6],x[7]=A[7]-D[7],x[8]=A[8]-D[8],x}return q.mul=v,q.sub=S,q}var te,ie={};function se(){if(te)return ie;function g(R){return g=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(N){return typeof N}:function(N){return N&&typeof Symbol=="function"&&N.constructor===Symbol&&N!==Symbol.prototype?"symbol":typeof N},g(R)}te=1,Object.defineProperty(ie,"__esModule",{value:!0}),ie.create=function(){var R=new c.ARRAY_TYPE(16);return c.ARRAY_TYPE!=Float32Array&&(R[1]=0,R[2]=0,R[3]=0,R[4]=0,R[6]=0,R[7]=0,R[8]=0,R[9]=0,R[11]=0,R[12]=0,R[13]=0,R[14]=0),R[0]=1,R[5]=1,R[10]=1,R[15]=1,R},ie.clone=function(R){var N=new c.ARRAY_TYPE(16);return N[0]=R[0],N[1]=R[1],N[2]=R[2],N[3]=R[3],N[4]=R[4],N[5]=R[5],N[6]=R[6],N[7]=R[7],N[8]=R[8],N[9]=R[9],N[10]=R[10],N[11]=R[11],N[12]=R[12],N[13]=R[13],N[14]=R[14],N[15]=R[15],N},ie.copy=function(R,N){return R[0]=N[0],R[1]=N[1],R[2]=N[2],R[3]=N[3],R[4]=N[4],R[5]=N[5],R[6]=N[6],R[7]=N[7],R[8]=N[8],R[9]=N[9],R[10]=N[10],R[11]=N[11],R[12]=N[12],R[13]=N[13],R[14]=N[14],R[15]=N[15],R},ie.fromValues=function(R,N,G,z,V,X,K,ee,ce,he,ne,de,ge,Me,Be,Oe){var Ie=new c.ARRAY_TYPE(16);return Ie[0]=R,Ie[1]=N,Ie[2]=G,Ie[3]=z,Ie[4]=V,Ie[5]=X,Ie[6]=K,Ie[7]=ee,Ie[8]=ce,Ie[9]=he,Ie[10]=ne,Ie[11]=de,Ie[12]=ge,Ie[13]=Me,Ie[14]=Be,Ie[15]=Oe,Ie},ie.set=function(R,N,G,z,V,X,K,ee,ce,he,ne,de,ge,Me,Be,Oe,Ie){return R[0]=N,R[1]=G,R[2]=z,R[3]=V,R[4]=X,R[5]=K,R[6]=ee,R[7]=ce,R[8]=he,R[9]=ne,R[10]=de,R[11]=ge,R[12]=Me,R[13]=Be,R[14]=Oe,R[15]=Ie,R},ie.identity=v,ie.transpose=function(R,N){if(R===N){var G=N[1],z=N[2],V=N[3],X=N[6],K=N[7],ee=N[11];R[1]=N[4],R[2]=N[8],R[3]=N[12],R[4]=G,R[6]=N[9],R[7]=N[13],R[8]=z,R[9]=X,R[11]=N[14],R[12]=V,R[13]=K,R[14]=ee}else R[0]=N[0],R[1]=N[4],R[2]=N[8],R[3]=N[12],R[4]=N[1],R[5]=N[5],R[6]=N[9],R[7]=N[13],R[8]=N[2],R[9]=N[6],R[10]=N[10],R[11]=N[14],R[12]=N[3],R[13]=N[7],R[14]=N[11],R[15]=N[15];return R},ie.invert=function(R,N){var G=N[0],z=N[1],V=N[2],X=N[3],K=N[4],ee=N[5],ce=N[6],he=N[7],ne=N[8],de=N[9],ge=N[10],Me=N[11],Be=N[12],Oe=N[13],Ie=N[14],Ye=N[15],ze=G*ee-z*K,Qe=G*ce-V*K,lt=G*he-X*K,ut=z*ce-V*ee,ht=z*he-X*ee,mt=V*he-X*ce,Et=ne*Oe-de*Be,vt=ne*Ie-ge*Be,Ut=ne*Ye-Me*Be,Yt=de*Ie-ge*Oe,Dt=de*Ye-Me*Oe,Rn=ge*Ye-Me*Ie,bn=ze*Rn-Qe*Dt+lt*Yt+ut*Ut-ht*vt+mt*Et;return bn?(R[0]=(ee*Rn-ce*Dt+he*Yt)*(bn=1/bn),R[1]=(V*Dt-z*Rn-X*Yt)*bn,R[2]=(Oe*mt-Ie*ht+Ye*ut)*bn,R[3]=(ge*ht-de*mt-Me*ut)*bn,R[4]=(ce*Ut-K*Rn-he*vt)*bn,R[5]=(G*Rn-V*Ut+X*vt)*bn,R[6]=(Ie*lt-Be*mt-Ye*Qe)*bn,R[7]=(ne*mt-ge*lt+Me*Qe)*bn,R[8]=(K*Dt-ee*Ut+he*Et)*bn,R[9]=(z*Ut-G*Dt-X*Et)*bn,R[10]=(Be*ht-Oe*lt+Ye*ze)*bn,R[11]=(de*lt-ne*ht-Me*ze)*bn,R[12]=(ee*vt-K*Yt-ce*Et)*bn,R[13]=(G*Yt-z*vt+V*Et)*bn,R[14]=(Oe*Qe-Be*ut-Ie*ze)*bn,R[15]=(ne*ut-de*Qe+ge*ze)*bn,R):null},ie.adjoint=function(R,N){var G=N[0],z=N[1],V=N[2],X=N[3],K=N[4],ee=N[5],ce=N[6],he=N[7],ne=N[8],de=N[9],ge=N[10],Me=N[11],Be=N[12],Oe=N[13],Ie=N[14],Ye=N[15];return R[0]=ee*(ge*Ye-Me*Ie)-de*(ce*Ye-he*Ie)+Oe*(ce*Me-he*ge),R[1]=-(z*(ge*Ye-Me*Ie)-de*(V*Ye-X*Ie)+Oe*(V*Me-X*ge)),R[2]=z*(ce*Ye-he*Ie)-ee*(V*Ye-X*Ie)+Oe*(V*he-X*ce),R[3]=-(z*(ce*Me-he*ge)-ee*(V*Me-X*ge)+de*(V*he-X*ce)),R[4]=-(K*(ge*Ye-Me*Ie)-ne*(ce*Ye-he*Ie)+Be*(ce*Me-he*ge)),R[5]=G*(ge*Ye-Me*Ie)-ne*(V*Ye-X*Ie)+Be*(V*Me-X*ge),R[6]=-(G*(ce*Ye-he*Ie)-K*(V*Ye-X*Ie)+Be*(V*he-X*ce)),R[7]=G*(ce*Me-he*ge)-K*(V*Me-X*ge)+ne*(V*he-X*ce),R[8]=K*(de*Ye-Me*Oe)-ne*(ee*Ye-he*Oe)+Be*(ee*Me-he*de),R[9]=-(G*(de*Ye-Me*Oe)-ne*(z*Ye-X*Oe)+Be*(z*Me-X*de)),R[10]=G*(ee*Ye-he*Oe)-K*(z*Ye-X*Oe)+Be*(z*he-X*ee),R[11]=-(G*(ee*Me-he*de)-K*(z*Me-X*de)+ne*(z*he-X*ee)),R[12]=-(K*(de*Ie-ge*Oe)-ne*(ee*Ie-ce*Oe)+Be*(ee*ge-ce*de)),R[13]=G*(de*Ie-ge*Oe)-ne*(z*Ie-V*Oe)+Be*(z*ge-V*de),R[14]=-(G*(ee*Ie-ce*Oe)-K*(z*Ie-V*Oe)+Be*(z*ce-V*ee)),R[15]=G*(ee*ge-ce*de)-K*(z*ge-V*de)+ne*(z*ce-V*ee),R},ie.determinant=function(R){var N=R[0],G=R[1],z=R[2],V=R[3],X=R[4],K=R[5],ee=R[6],ce=R[7],he=R[8],ne=R[9],de=R[10],ge=R[11],Me=R[12],Be=R[13],Oe=R[14],Ie=R[15];return(N*K-G*X)*(de*Ie-ge*Oe)-(N*ee-z*X)*(ne*Ie-ge*Be)+(N*ce-V*X)*(ne*Oe-de*Be)+(G*ee-z*K)*(he*Ie-ge*Me)-(G*ce-V*K)*(he*Oe-de*Me)+(z*ce-V*ee)*(he*Be-ne*Me)},ie.multiply=S,ie.translate=function(R,N,G){var z,V,X,K,ee,ce,he,ne,de,ge,Me,Be,Oe=G[0],Ie=G[1],Ye=G[2];return N===R?(R[12]=N[0]*Oe+N[4]*Ie+N[8]*Ye+N[12],R[13]=N[1]*Oe+N[5]*Ie+N[9]*Ye+N[13],R[14]=N[2]*Oe+N[6]*Ie+N[10]*Ye+N[14],R[15]=N[3]*Oe+N[7]*Ie+N[11]*Ye+N[15]):(V=N[1],X=N[2],K=N[3],ee=N[4],ce=N[5],he=N[6],ne=N[7],de=N[8],ge=N[9],Me=N[10],Be=N[11],R[0]=z=N[0],R[1]=V,R[2]=X,R[3]=K,R[4]=ee,R[5]=ce,R[6]=he,R[7]=ne,R[8]=de,R[9]=ge,R[10]=Me,R[11]=Be,R[12]=z*Oe+ee*Ie+de*Ye+N[12],R[13]=V*Oe+ce*Ie+ge*Ye+N[13],R[14]=X*Oe+he*Ie+Me*Ye+N[14],R[15]=K*Oe+ne*Ie+Be*Ye+N[15]),R},ie.scale=function(R,N,G){var z=G[0],V=G[1],X=G[2];return R[0]=N[0]*z,R[1]=N[1]*z,R[2]=N[2]*z,R[3]=N[3]*z,R[4]=N[4]*V,R[5]=N[5]*V,R[6]=N[6]*V,R[7]=N[7]*V,R[8]=N[8]*X,R[9]=N[9]*X,R[10]=N[10]*X,R[11]=N[11]*X,R[12]=N[12],R[13]=N[13],R[14]=N[14],R[15]=N[15],R},ie.rotate=function(R,N,G,z){var V,X,K,ee,ce,he,ne,de,ge,Me,Be,Oe,Ie,Ye,ze,Qe,lt,ut,ht,mt,Et,vt,Ut,Yt,Dt=z[0],Rn=z[1],bn=z[2],dn=Math.hypot(Dt,Rn,bn);return dn<c.EPSILON?null:(Dt*=dn=1/dn,Rn*=dn,bn*=dn,V=Math.sin(G),X=Math.cos(G),ce=N[1],he=N[2],ne=N[3],ge=N[5],Me=N[6],Be=N[7],Ie=N[9],Ye=N[10],ze=N[11],Qe=Dt*Dt*(K=1-X)+X,ht=Dt*Rn*K-bn*V,mt=Rn*Rn*K+X,Et=bn*Rn*K+Dt*V,vt=Dt*bn*K+Rn*V,Ut=Rn*bn*K-Dt*V,Yt=bn*bn*K+X,R[0]=(ee=N[0])*Qe+(de=N[4])*(lt=Rn*Dt*K+bn*V)+(Oe=N[8])*(ut=bn*Dt*K-Rn*V),R[1]=ce*Qe+ge*lt+Ie*ut,R[2]=he*Qe+Me*lt+Ye*ut,R[3]=ne*Qe+Be*lt+ze*ut,R[4]=ee*ht+de*mt+Oe*Et,R[5]=ce*ht+ge*mt+Ie*Et,R[6]=he*ht+Me*mt+Ye*Et,R[7]=ne*ht+Be*mt+ze*Et,R[8]=ee*vt+de*Ut+Oe*Yt,R[9]=ce*vt+ge*Ut+Ie*Yt,R[10]=he*vt+Me*Ut+Ye*Yt,R[11]=ne*vt+Be*Ut+ze*Yt,N!==R&&(R[12]=N[12],R[13]=N[13],R[14]=N[14],R[15]=N[15]),R)},ie.rotateX=function(R,N,G){var z=Math.sin(G),V=Math.cos(G),X=N[4],K=N[5],ee=N[6],ce=N[7],he=N[8],ne=N[9],de=N[10],ge=N[11];return N!==R&&(R[0]=N[0],R[1]=N[1],R[2]=N[2],R[3]=N[3],R[12]=N[12],R[13]=N[13],R[14]=N[14],R[15]=N[15]),R[4]=X*V+he*z,R[5]=K*V+ne*z,R[6]=ee*V+de*z,R[7]=ce*V+ge*z,R[8]=he*V-X*z,R[9]=ne*V-K*z,R[10]=de*V-ee*z,R[11]=ge*V-ce*z,R},ie.rotateY=function(R,N,G){var z=Math.sin(G),V=Math.cos(G),X=N[0],K=N[1],ee=N[2],ce=N[3],he=N[8],ne=N[9],de=N[10],ge=N[11];return N!==R&&(R[4]=N[4],R[5]=N[5],R[6]=N[6],R[7]=N[7],R[12]=N[12],R[13]=N[13],R[14]=N[14],R[15]=N[15]),R[0]=X*V-he*z,R[1]=K*V-ne*z,R[2]=ee*V-de*z,R[3]=ce*V-ge*z,R[8]=X*z+he*V,R[9]=K*z+ne*V,R[10]=ee*z+de*V,R[11]=ce*z+ge*V,R},ie.rotateZ=function(R,N,G){var z=Math.sin(G),V=Math.cos(G),X=N[0],K=N[1],ee=N[2],ce=N[3],he=N[4],ne=N[5],de=N[6],ge=N[7];return N!==R&&(R[8]=N[8],R[9]=N[9],R[10]=N[10],R[11]=N[11],R[12]=N[12],R[13]=N[13],R[14]=N[14],R[15]=N[15]),R[0]=X*V+he*z,R[1]=K*V+ne*z,R[2]=ee*V+de*z,R[3]=ce*V+ge*z,R[4]=he*V-X*z,R[5]=ne*V-K*z,R[6]=de*V-ee*z,R[7]=ge*V-ce*z,R},ie.fromTranslation=function(R,N){return R[0]=1,R[1]=0,R[2]=0,R[3]=0,R[4]=0,R[5]=1,R[6]=0,R[7]=0,R[8]=0,R[9]=0,R[10]=1,R[11]=0,R[12]=N[0],R[13]=N[1],R[14]=N[2],R[15]=1,R},ie.fromScaling=function(R,N){return R[0]=N[0],R[1]=0,R[2]=0,R[3]=0,R[4]=0,R[5]=N[1],R[6]=0,R[7]=0,R[8]=0,R[9]=0,R[10]=N[2],R[11]=0,R[12]=0,R[13]=0,R[14]=0,R[15]=1,R},ie.fromRotation=function(R,N,G){var z,V,X,K=G[0],ee=G[1],ce=G[2],he=Math.hypot(K,ee,ce);return he<c.EPSILON?null:(K*=he=1/he,ee*=he,ce*=he,z=Math.sin(N),V=Math.cos(N),R[0]=K*K*(X=1-V)+V,R[1]=ee*K*X+ce*z,R[2]=ce*K*X-ee*z,R[3]=0,R[4]=K*ee*X-ce*z,R[5]=ee*ee*X+V,R[6]=ce*ee*X+K*z,R[7]=0,R[8]=K*ce*X+ee*z,R[9]=ee*ce*X-K*z,R[10]=ce*ce*X+V,R[11]=0,R[12]=0,R[13]=0,R[14]=0,R[15]=1,R)},ie.fromXRotation=function(R,N){var G=Math.sin(N),z=Math.cos(N);return R[0]=1,R[1]=0,R[2]=0,R[3]=0,R[4]=0,R[5]=z,R[6]=G,R[7]=0,R[8]=0,R[9]=-G,R[10]=z,R[11]=0,R[12]=0,R[13]=0,R[14]=0,R[15]=1,R},ie.fromYRotation=function(R,N){var G=Math.sin(N),z=Math.cos(N);return R[0]=z,R[1]=0,R[2]=-G,R[3]=0,R[4]=0,R[5]=1,R[6]=0,R[7]=0,R[8]=G,R[9]=0,R[10]=z,R[11]=0,R[12]=0,R[13]=0,R[14]=0,R[15]=1,R},ie.fromZRotation=function(R,N){var G=Math.sin(N),z=Math.cos(N);return R[0]=z,R[1]=G,R[2]=0,R[3]=0,R[4]=-G,R[5]=z,R[6]=0,R[7]=0,R[8]=0,R[9]=0,R[10]=1,R[11]=0,R[12]=0,R[13]=0,R[14]=0,R[15]=1,R},ie.fromRotationTranslation=x,ie.fromQuat2=function(R,N){var G=new c.ARRAY_TYPE(3),z=-N[0],V=-N[1],X=-N[2],K=N[3],ee=N[4],ce=N[5],he=N[6],ne=N[7],de=z*z+V*V+X*X+K*K;return de>0?(G[0]=2*(ee*K+ne*z+ce*X-he*V)/de,G[1]=2*(ce*K+ne*V+he*z-ee*X)/de,G[2]=2*(he*K+ne*X+ee*V-ce*z)/de):(G[0]=2*(ee*K+ne*z+ce*X-he*V),G[1]=2*(ce*K+ne*V+he*z-ee*X),G[2]=2*(he*K+ne*X+ee*V-ce*z)),x(R,N,G),R},ie.getTranslation=function(R,N){return R[0]=N[12],R[1]=N[13],R[2]=N[14],R},ie.getScaling=A,ie.getRotation=function(R,N){var G=new c.ARRAY_TYPE(3);A(G,N);var z=1/G[0],V=1/G[1],X=1/G[2],K=N[0]*z,ee=N[1]*V,ce=N[2]*X,he=N[4]*z,ne=N[5]*V,de=N[6]*X,ge=N[8]*z,Me=N[9]*V,Be=N[10]*X,Oe=K+ne+Be,Ie=0;return Oe>0?(Ie=2*Math.sqrt(Oe+1),R[3]=.25*Ie,R[0]=(de-Me)/Ie,R[1]=(ge-ce)/Ie,R[2]=(ee-he)/Ie):K>ne&&K>Be?(Ie=2*Math.sqrt(1+K-ne-Be),R[3]=(de-Me)/Ie,R[0]=.25*Ie,R[1]=(ee+he)/Ie,R[2]=(ge+ce)/Ie):ne>Be?(Ie=2*Math.sqrt(1+ne-K-Be),R[3]=(ge-ce)/Ie,R[0]=(ee+he)/Ie,R[1]=.25*Ie,R[2]=(de+Me)/Ie):(Ie=2*Math.sqrt(1+Be-K-ne),R[3]=(ee-he)/Ie,R[0]=(ge+ce)/Ie,R[1]=(de+Me)/Ie,R[2]=.25*Ie),R},ie.fromRotationTranslationScale=function(R,N,G,z){var V=N[0],X=N[1],K=N[2],ee=N[3],ce=V+V,he=X+X,ne=K+K,de=V*ce,ge=V*he,Me=V*ne,Be=X*he,Oe=X*ne,Ie=K*ne,Ye=ee*ce,ze=ee*he,Qe=ee*ne,lt=z[0],ut=z[1],ht=z[2];return R[0]=(1-(Be+Ie))*lt,R[1]=(ge+Qe)*lt,R[2]=(Me-ze)*lt,R[3]=0,R[4]=(ge-Qe)*ut,R[5]=(1-(de+Ie))*ut,R[6]=(Oe+Ye)*ut,R[7]=0,R[8]=(Me+ze)*ht,R[9]=(Oe-Ye)*ht,R[10]=(1-(de+Be))*ht,R[11]=0,R[12]=G[0],R[13]=G[1],R[14]=G[2],R[15]=1,R},ie.fromRotationTranslationScaleOrigin=function(R,N,G,z,V){var X=N[0],K=N[1],ee=N[2],ce=N[3],he=X+X,ne=K+K,de=ee+ee,ge=X*he,Me=X*ne,Be=X*de,Oe=K*ne,Ie=K*de,Ye=ee*de,ze=ce*he,Qe=ce*ne,lt=ce*de,ut=z[0],ht=z[1],mt=z[2],Et=V[0],vt=V[1],Ut=V[2],Yt=(1-(Oe+Ye))*ut,Dt=(Me+lt)*ut,Rn=(Be-Qe)*ut,bn=(Me-lt)*ht,dn=(1-(ge+Ye))*ht,tn=(Ie+ze)*ht,nr=(Be+Qe)*mt,In=(Ie-ze)*mt,Nn=(1-(ge+Oe))*mt;return R[0]=Yt,R[1]=Dt,R[2]=Rn,R[3]=0,R[4]=bn,R[5]=dn,R[6]=tn,R[7]=0,R[8]=nr,R[9]=In,R[10]=Nn,R[11]=0,R[12]=G[0]+Et-(Yt*Et+bn*vt+nr*Ut),R[13]=G[1]+vt-(Dt*Et+dn*vt+In*Ut),R[14]=G[2]+Ut-(Rn*Et+tn*vt+Nn*Ut),R[15]=1,R},ie.fromQuat=function(R,N){var G=N[0],z=N[1],V=N[2],X=N[3],K=G+G,ee=z+z,ce=V+V,he=G*K,ne=z*K,de=z*ee,ge=V*K,Me=V*ee,Be=V*ce,Oe=X*K,Ie=X*ee,Ye=X*ce;return R[0]=1-de-Be,R[1]=ne+Ye,R[2]=ge-Ie,R[3]=0,R[4]=ne-Ye,R[5]=1-he-Be,R[6]=Me+Oe,R[7]=0,R[8]=ge+Ie,R[9]=Me-Oe,R[10]=1-he-de,R[11]=0,R[12]=0,R[13]=0,R[14]=0,R[15]=1,R},ie.frustum=function(R,N,G,z,V,X,K){var ee=1/(G-N),ce=1/(V-z),he=1/(X-K);return R[0]=2*X*ee,R[1]=0,R[2]=0,R[3]=0,R[4]=0,R[5]=2*X*ce,R[6]=0,R[7]=0,R[8]=(G+N)*ee,R[9]=(V+z)*ce,R[10]=(K+X)*he,R[11]=-1,R[12]=0,R[13]=0,R[14]=K*X*2*he,R[15]=0,R},ie.perspectiveNO=D,ie.perspectiveZO=function(R,N,G,z,V){var X,K=1/Math.tan(N/2);return R[0]=K/G,R[1]=0,R[2]=0,R[3]=0,R[4]=0,R[5]=K,R[6]=0,R[7]=0,R[8]=0,R[9]=0,R[11]=-1,R[12]=0,R[13]=0,R[15]=0,V!=null&&V!==1/0?(R[10]=V*(X=1/(z-V)),R[14]=V*z*X):(R[10]=-1,R[14]=-z),R},ie.perspectiveFromFieldOfView=function(R,N,G,z){var V=Math.tan(N.upDegrees*Math.PI/180),X=Math.tan(N.downDegrees*Math.PI/180),K=Math.tan(N.leftDegrees*Math.PI/180),ee=Math.tan(N.rightDegrees*Math.PI/180),ce=2/(K+ee),he=2/(V+X);return R[0]=ce,R[1]=0,R[2]=0,R[3]=0,R[4]=0,R[5]=he,R[6]=0,R[7]=0,R[8]=-(K-ee)*ce*.5,R[9]=(V-X)*he*.5,R[10]=z/(G-z),R[11]=-1,R[12]=0,R[13]=0,R[14]=z*G/(G-z),R[15]=0,R},ie.orthoNO=U,ie.orthoZO=function(R,N,G,z,V,X,K){var ee=1/(N-G),ce=1/(z-V),he=1/(X-K);return R[0]=-2*ee,R[1]=0,R[2]=0,R[3]=0,R[4]=0,R[5]=-2*ce,R[6]=0,R[7]=0,R[8]=0,R[9]=0,R[10]=he,R[11]=0,R[12]=(N+G)*ee,R[13]=(V+z)*ce,R[14]=X*he,R[15]=1,R},ie.lookAt=function(R,N,G,z){var V,X,K,ee,ce,he,ne,de,ge,Me,Be=N[0],Oe=N[1],Ie=N[2],Ye=z[0],ze=z[1],Qe=z[2],lt=G[0],ut=G[1],ht=G[2];return Math.abs(Be-lt)<c.EPSILON&&Math.abs(Oe-ut)<c.EPSILON&&Math.abs(Ie-ht)<c.EPSILON?v(R):(ne=Be-lt,de=Oe-ut,ge=Ie-ht,V=ze*(ge*=Me=1/Math.hypot(ne,de,ge))-Qe*(de*=Me),X=Qe*(ne*=Me)-Ye*ge,K=Ye*de-ze*ne,(Me=Math.hypot(V,X,K))?(V*=Me=1/Me,X*=Me,K*=Me):(V=0,X=0,K=0),ee=de*K-ge*X,ce=ge*V-ne*K,he=ne*X-de*V,(Me=Math.hypot(ee,ce,he))?(ee*=Me=1/Me,ce*=Me,he*=Me):(ee=0,ce=0,he=0),R[0]=V,R[1]=ee,R[2]=ne,R[3]=0,R[4]=X,R[5]=ce,R[6]=de,R[7]=0,R[8]=K,R[9]=he,R[10]=ge,R[11]=0,R[12]=-(V*Be+X*Oe+K*Ie),R[13]=-(ee*Be+ce*Oe+he*Ie),R[14]=-(ne*Be+de*Oe+ge*Ie),R[15]=1,R)},ie.targetTo=function(R,N,G,z){var V=N[0],X=N[1],K=N[2],ee=z[0],ce=z[1],he=z[2],ne=V-G[0],de=X-G[1],ge=K-G[2],Me=ne*ne+de*de+ge*ge;Me>0&&(ne*=Me=1/Math.sqrt(Me),de*=Me,ge*=Me);var Be=ce*ge-he*de,Oe=he*ne-ee*ge,Ie=ee*de-ce*ne;return(Me=Be*Be+Oe*Oe+Ie*Ie)>0&&(Be*=Me=1/Math.sqrt(Me),Oe*=Me,Ie*=Me),R[0]=Be,R[1]=Oe,R[2]=Ie,R[3]=0,R[4]=de*Ie-ge*Oe,R[5]=ge*Be-ne*Ie,R[6]=ne*Oe-de*Be,R[7]=0,R[8]=ne,R[9]=de,R[10]=ge,R[11]=0,R[12]=V,R[13]=X,R[14]=K,R[15]=1,R},ie.str=function(R){return"mat4("+R[0]+", "+R[1]+", "+R[2]+", "+R[3]+", "+R[4]+", "+R[5]+", "+R[6]+", "+R[7]+", "+R[8]+", "+R[9]+", "+R[10]+", "+R[11]+", "+R[12]+", "+R[13]+", "+R[14]+", "+R[15]+")"},ie.frob=function(R){return Math.hypot(R[0],R[1],R[2],R[3],R[4],R[5],R[6],R[7],R[8],R[9],R[10],R[11],R[12],R[13],R[14],R[15])},ie.add=function(R,N,G){return R[0]=N[0]+G[0],R[1]=N[1]+G[1],R[2]=N[2]+G[2],R[3]=N[3]+G[3],R[4]=N[4]+G[4],R[5]=N[5]+G[5],R[6]=N[6]+G[6],R[7]=N[7]+G[7],R[8]=N[8]+G[8],R[9]=N[9]+G[9],R[10]=N[10]+G[10],R[11]=N[11]+G[11],R[12]=N[12]+G[12],R[13]=N[13]+G[13],R[14]=N[14]+G[14],R[15]=N[15]+G[15],R},ie.subtract=H,ie.multiplyScalar=function(R,N,G){return R[0]=N[0]*G,R[1]=N[1]*G,R[2]=N[2]*G,R[3]=N[3]*G,R[4]=N[4]*G,R[5]=N[5]*G,R[6]=N[6]*G,R[7]=N[7]*G,R[8]=N[8]*G,R[9]=N[9]*G,R[10]=N[10]*G,R[11]=N[11]*G,R[12]=N[12]*G,R[13]=N[13]*G,R[14]=N[14]*G,R[15]=N[15]*G,R},ie.multiplyScalarAndAdd=function(R,N,G,z){return R[0]=N[0]+G[0]*z,R[1]=N[1]+G[1]*z,R[2]=N[2]+G[2]*z,R[3]=N[3]+G[3]*z,R[4]=N[4]+G[4]*z,R[5]=N[5]+G[5]*z,R[6]=N[6]+G[6]*z,R[7]=N[7]+G[7]*z,R[8]=N[8]+G[8]*z,R[9]=N[9]+G[9]*z,R[10]=N[10]+G[10]*z,R[11]=N[11]+G[11]*z,R[12]=N[12]+G[12]*z,R[13]=N[13]+G[13]*z,R[14]=N[14]+G[14]*z,R[15]=N[15]+G[15]*z,R},ie.exactEquals=function(R,N){return R[0]===N[0]&&R[1]===N[1]&&R[2]===N[2]&&R[3]===N[3]&&R[4]===N[4]&&R[5]===N[5]&&R[6]===N[6]&&R[7]===N[7]&&R[8]===N[8]&&R[9]===N[9]&&R[10]===N[10]&&R[11]===N[11]&&R[12]===N[12]&&R[13]===N[13]&&R[14]===N[14]&&R[15]===N[15]},ie.equals=function(R,N){var G=R[0],z=R[1],V=R[2],X=R[3],K=R[4],ee=R[5],ce=R[6],he=R[7],ne=R[8],de=R[9],ge=R[10],Me=R[11],Be=R[12],Oe=R[13],Ie=R[14],Ye=R[15],ze=N[0],Qe=N[1],lt=N[2],ut=N[3],ht=N[4],mt=N[5],Et=N[6],vt=N[7],Ut=N[8],Yt=N[9],Dt=N[10],Rn=N[11],bn=N[12],dn=N[13],tn=N[14],nr=N[15];return Math.abs(G-ze)<=c.EPSILON*Math.max(1,Math.abs(G),Math.abs(ze))&&Math.abs(z-Qe)<=c.EPSILON*Math.max(1,Math.abs(z),Math.abs(Qe))&&Math.abs(V-lt)<=c.EPSILON*Math.max(1,Math.abs(V),Math.abs(lt))&&Math.abs(X-ut)<=c.EPSILON*Math.max(1,Math.abs(X),Math.abs(ut))&&Math.abs(K-ht)<=c.EPSILON*Math.max(1,Math.abs(K),Math.abs(ht))&&Math.abs(ee-mt)<=c.EPSILON*Math.max(1,Math.abs(ee),Math.abs(mt))&&Math.abs(ce-Et)<=c.EPSILON*Math.max(1,Math.abs(ce),Math.abs(Et))&&Math.abs(he-vt)<=c.EPSILON*Math.max(1,Math.abs(he),Math.abs(vt))&&Math.abs(ne-Ut)<=c.EPSILON*Math.max(1,Math.abs(ne),Math.abs(Ut))&&Math.abs(de-Yt)<=c.EPSILON*Math.max(1,Math.abs(de),Math.abs(Yt))&&Math.abs(ge-Dt)<=c.EPSILON*Math.max(1,Math.abs(ge),Math.abs(Dt))&&Math.abs(Me-Rn)<=c.EPSILON*Math.max(1,Math.abs(Me),Math.abs(Rn))&&Math.abs(Be-bn)<=c.EPSILON*Math.max(1,Math.abs(Be),Math.abs(bn))&&Math.abs(Oe-dn)<=c.EPSILON*Math.max(1,Math.abs(Oe),Math.abs(dn))&&Math.abs(Ie-tn)<=c.EPSILON*Math.max(1,Math.abs(Ie),Math.abs(tn))&&Math.abs(Ye-nr)<=c.EPSILON*Math.max(1,Math.abs(Ye),Math.abs(nr))},ie.sub=ie.mul=ie.ortho=ie.perspective=void 0;var c=function(R,N){if(R&&R.__esModule)return R;if(R===null||g(R)!=="object"&&typeof R!="function")return{default:R};var G=f(void 0);if(G&&G.has(R))return G.get(R);var z={},V=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var X in R)if(X!=="default"&&Object.prototype.hasOwnProperty.call(R,X)){var K=V?Object.getOwnPropertyDescriptor(R,X):null;K&&(K.get||K.set)?Object.defineProperty(z,X,K):z[X]=R[X]}return z.default=R,G&&G.set(R,z),z}(y());function f(R){if(typeof WeakMap!="function")return null;var N=new WeakMap,G=new WeakMap;return(f=function(z){return z?G:N})(R)}function v(R){return R[0]=1,R[1]=0,R[2]=0,R[3]=0,R[4]=0,R[5]=1,R[6]=0,R[7]=0,R[8]=0,R[9]=0,R[10]=1,R[11]=0,R[12]=0,R[13]=0,R[14]=0,R[15]=1,R}function S(R,N,G){var z=N[0],V=N[1],X=N[2],K=N[3],ee=N[4],ce=N[5],he=N[6],ne=N[7],de=N[8],ge=N[9],Me=N[10],Be=N[11],Oe=N[12],Ie=N[13],Ye=N[14],ze=N[15],Qe=G[0],lt=G[1],ut=G[2],ht=G[3];return R[0]=Qe*z+lt*ee+ut*de+ht*Oe,R[1]=Qe*V+lt*ce+ut*ge+ht*Ie,R[2]=Qe*X+lt*he+ut*Me+ht*Ye,R[3]=Qe*K+lt*ne+ut*Be+ht*ze,R[4]=(Qe=G[4])*z+(lt=G[5])*ee+(ut=G[6])*de+(ht=G[7])*Oe,R[5]=Qe*V+lt*ce+ut*ge+ht*Ie,R[6]=Qe*X+lt*he+ut*Me+ht*Ye,R[7]=Qe*K+lt*ne+ut*Be+ht*ze,R[8]=(Qe=G[8])*z+(lt=G[9])*ee+(ut=G[10])*de+(ht=G[11])*Oe,R[9]=Qe*V+lt*ce+ut*ge+ht*Ie,R[10]=Qe*X+lt*he+ut*Me+ht*Ye,R[11]=Qe*K+lt*ne+ut*Be+ht*ze,R[12]=(Qe=G[12])*z+(lt=G[13])*ee+(ut=G[14])*de+(ht=G[15])*Oe,R[13]=Qe*V+lt*ce+ut*ge+ht*Ie,R[14]=Qe*X+lt*he+ut*Me+ht*Ye,R[15]=Qe*K+lt*ne+ut*Be+ht*ze,R}function x(R,N,G){var z=N[0],V=N[1],X=N[2],K=N[3],ee=z+z,ce=V+V,he=X+X,ne=z*ee,de=z*ce,ge=z*he,Me=V*ce,Be=V*he,Oe=X*he,Ie=K*ee,Ye=K*ce,ze=K*he;return R[0]=1-(Me+Oe),R[1]=de+ze,R[2]=ge-Ye,R[3]=0,R[4]=de-ze,R[5]=1-(ne+Oe),R[6]=Be+Ie,R[7]=0,R[8]=ge+Ye,R[9]=Be-Ie,R[10]=1-(ne+Me),R[11]=0,R[12]=G[0],R[13]=G[1],R[14]=G[2],R[15]=1,R}function A(R,N){var G=N[4],z=N[5],V=N[6],X=N[8],K=N[9],ee=N[10];return R[0]=Math.hypot(N[0],N[1],N[2]),R[1]=Math.hypot(G,z,V),R[2]=Math.hypot(X,K,ee),R}function D(R,N,G,z,V){var X,K=1/Math.tan(N/2);return R[0]=K/G,R[1]=0,R[2]=0,R[3]=0,R[4]=0,R[5]=K,R[6]=0,R[7]=0,R[8]=0,R[9]=0,R[11]=-1,R[12]=0,R[13]=0,R[15]=0,V!=null&&V!==1/0?(R[10]=(V+z)*(X=1/(z-V)),R[14]=2*V*z*X):(R[10]=-1,R[14]=-2*z),R}function U(R,N,G,z,V,X,K){var ee=1/(N-G),ce=1/(z-V),he=1/(X-K);return R[0]=-2*ee,R[1]=0,R[2]=0,R[3]=0,R[4]=0,R[5]=-2*ce,R[6]=0,R[7]=0,R[8]=0,R[9]=0,R[10]=2*he,R[11]=0,R[12]=(N+G)*ee,R[13]=(V+z)*ce,R[14]=(K+X)*he,R[15]=1,R}function H(R,N,G){return R[0]=N[0]-G[0],R[1]=N[1]-G[1],R[2]=N[2]-G[2],R[3]=N[3]-G[3],R[4]=N[4]-G[4],R[5]=N[5]-G[5],R[6]=N[6]-G[6],R[7]=N[7]-G[7],R[8]=N[8]-G[8],R[9]=N[9]-G[9],R[10]=N[10]-G[10],R[11]=N[11]-G[11],R[12]=N[12]-G[12],R[13]=N[13]-G[13],R[14]=N[14]-G[14],R[15]=N[15]-G[15],R}return ie.perspective=D,ie.ortho=U,ie.mul=S,ie.sub=H,ie}var ae,fe={},Se={};function Ee(){if(ae)return Se;function g(V){return g=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(X){return typeof X}:function(X){return X&&typeof Symbol=="function"&&X.constructor===Symbol&&X!==Symbol.prototype?"symbol":typeof X},g(V)}ae=1,Object.defineProperty(Se,"__esModule",{value:!0}),Se.create=v,Se.clone=function(V){var X=new c.ARRAY_TYPE(3);return X[0]=V[0],X[1]=V[1],X[2]=V[2],X},Se.length=S,Se.fromValues=function(V,X,K){var ee=new c.ARRAY_TYPE(3);return ee[0]=V,ee[1]=X,ee[2]=K,ee},Se.copy=function(V,X){return V[0]=X[0],V[1]=X[1],V[2]=X[2],V},Se.set=function(V,X,K,ee){return V[0]=X,V[1]=K,V[2]=ee,V},Se.add=function(V,X,K){return V[0]=X[0]+K[0],V[1]=X[1]+K[1],V[2]=X[2]+K[2],V},Se.subtract=x,Se.multiply=A,Se.divide=D,Se.ceil=function(V,X){return V[0]=Math.ceil(X[0]),V[1]=Math.ceil(X[1]),V[2]=Math.ceil(X[2]),V},Se.floor=function(V,X){return V[0]=Math.floor(X[0]),V[1]=Math.floor(X[1]),V[2]=Math.floor(X[2]),V},Se.min=function(V,X,K){return V[0]=Math.min(X[0],K[0]),V[1]=Math.min(X[1],K[1]),V[2]=Math.min(X[2],K[2]),V},Se.max=function(V,X,K){return V[0]=Math.max(X[0],K[0]),V[1]=Math.max(X[1],K[1]),V[2]=Math.max(X[2],K[2]),V},Se.round=function(V,X){return V[0]=Math.round(X[0]),V[1]=Math.round(X[1]),V[2]=Math.round(X[2]),V},Se.scale=function(V,X,K){return V[0]=X[0]*K,V[1]=X[1]*K,V[2]=X[2]*K,V},Se.scaleAndAdd=function(V,X,K,ee){return V[0]=X[0]+K[0]*ee,V[1]=X[1]+K[1]*ee,V[2]=X[2]+K[2]*ee,V},Se.distance=U,Se.squaredDistance=H,Se.squaredLength=R,Se.negate=function(V,X){return V[0]=-X[0],V[1]=-X[1],V[2]=-X[2],V},Se.inverse=function(V,X){return V[0]=1/X[0],V[1]=1/X[1],V[2]=1/X[2],V},Se.normalize=function(V,X){var K=X[0],ee=X[1],ce=X[2],he=K*K+ee*ee+ce*ce;return he>0&&(he=1/Math.sqrt(he)),V[0]=X[0]*he,V[1]=X[1]*he,V[2]=X[2]*he,V},Se.dot=N,Se.cross=function(V,X,K){var ee=X[0],ce=X[1],he=X[2],ne=K[0],de=K[1],ge=K[2];return V[0]=ce*ge-he*de,V[1]=he*ne-ee*ge,V[2]=ee*de-ce*ne,V},Se.lerp=function(V,X,K,ee){var ce=X[0],he=X[1],ne=X[2];return V[0]=ce+ee*(K[0]-ce),V[1]=he+ee*(K[1]-he),V[2]=ne+ee*(K[2]-ne),V},Se.hermite=function(V,X,K,ee,ce,he){var ne=he*he,de=ne*(2*he-3)+1,ge=ne*(he-2)+he,Me=ne*(he-1),Be=ne*(3-2*he);return V[0]=X[0]*de+K[0]*ge+ee[0]*Me+ce[0]*Be,V[1]=X[1]*de+K[1]*ge+ee[1]*Me+ce[1]*Be,V[2]=X[2]*de+K[2]*ge+ee[2]*Me+ce[2]*Be,V},Se.bezier=function(V,X,K,ee,ce,he){var ne=1-he,de=ne*ne,ge=he*he,Me=de*ne,Be=3*he*de,Oe=3*ge*ne,Ie=ge*he;return V[0]=X[0]*Me+K[0]*Be+ee[0]*Oe+ce[0]*Ie,V[1]=X[1]*Me+K[1]*Be+ee[1]*Oe+ce[1]*Ie,V[2]=X[2]*Me+K[2]*Be+ee[2]*Oe+ce[2]*Ie,V},Se.random=function(V,X){X=X||1;var K=2*c.RANDOM()*Math.PI,ee=2*c.RANDOM()-1,ce=Math.sqrt(1-ee*ee)*X;return V[0]=Math.cos(K)*ce,V[1]=Math.sin(K)*ce,V[2]=ee*X,V},Se.transformMat4=function(V,X,K){var ee=X[0],ce=X[1],he=X[2],ne=K[3]*ee+K[7]*ce+K[11]*he+K[15];return V[0]=(K[0]*ee+K[4]*ce+K[8]*he+K[12])/(ne=ne||1),V[1]=(K[1]*ee+K[5]*ce+K[9]*he+K[13])/ne,V[2]=(K[2]*ee+K[6]*ce+K[10]*he+K[14])/ne,V},Se.transformMat3=function(V,X,K){var ee=X[0],ce=X[1],he=X[2];return V[0]=ee*K[0]+ce*K[3]+he*K[6],V[1]=ee*K[1]+ce*K[4]+he*K[7],V[2]=ee*K[2]+ce*K[5]+he*K[8],V},Se.transformQuat=function(V,X,K){var ee=K[0],ce=K[1],he=K[2],ne=X[0],de=X[1],ge=X[2],Me=ce*ge-he*de,Be=he*ne-ee*ge,Oe=ee*de-ce*ne,Ie=ce*Oe-he*Be,Ye=he*Me-ee*Oe,ze=ee*Be-ce*Me,Qe=2*K[3];return Be*=Qe,Oe*=Qe,Ye*=2,ze*=2,V[0]=ne+(Me*=Qe)+(Ie*=2),V[1]=de+Be+Ye,V[2]=ge+Oe+ze,V},Se.rotateX=function(V,X,K,ee){var ce=[],he=[];return ce[0]=X[0]-K[0],ce[1]=X[1]-K[1],ce[2]=X[2]-K[2],he[0]=ce[0],he[1]=ce[1]*Math.cos(ee)-ce[2]*Math.sin(ee),he[2]=ce[1]*Math.sin(ee)+ce[2]*Math.cos(ee),V[0]=he[0]+K[0],V[1]=he[1]+K[1],V[2]=he[2]+K[2],V},Se.rotateY=function(V,X,K,ee){var ce=[],he=[];return ce[0]=X[0]-K[0],ce[1]=X[1]-K[1],ce[2]=X[2]-K[2],he[0]=ce[2]*Math.sin(ee)+ce[0]*Math.cos(ee),he[1]=ce[1],he[2]=ce[2]*Math.cos(ee)-ce[0]*Math.sin(ee),V[0]=he[0]+K[0],V[1]=he[1]+K[1],V[2]=he[2]+K[2],V},Se.rotateZ=function(V,X,K,ee){var ce=[],he=[];return ce[0]=X[0]-K[0],ce[1]=X[1]-K[1],ce[2]=X[2]-K[2],he[0]=ce[0]*Math.cos(ee)-ce[1]*Math.sin(ee),he[1]=ce[0]*Math.sin(ee)+ce[1]*Math.cos(ee),he[2]=ce[2],V[0]=he[0]+K[0],V[1]=he[1]+K[1],V[2]=he[2]+K[2],V},Se.angle=function(V,X){var K=V[0],ee=V[1],ce=V[2],he=X[0],ne=X[1],de=X[2],ge=Math.sqrt(K*K+ee*ee+ce*ce)*Math.sqrt(he*he+ne*ne+de*de),Me=ge&&N(V,X)/ge;return Math.acos(Math.min(Math.max(Me,-1),1))},Se.zero=function(V){return V[0]=0,V[1]=0,V[2]=0,V},Se.str=function(V){return"vec3("+V[0]+", "+V[1]+", "+V[2]+")"},Se.exactEquals=function(V,X){return V[0]===X[0]&&V[1]===X[1]&&V[2]===X[2]},Se.equals=function(V,X){var K=V[0],ee=V[1],ce=V[2],he=X[0],ne=X[1],de=X[2];return Math.abs(K-he)<=c.EPSILON*Math.max(1,Math.abs(K),Math.abs(he))&&Math.abs(ee-ne)<=c.EPSILON*Math.max(1,Math.abs(ee),Math.abs(ne))&&Math.abs(ce-de)<=c.EPSILON*Math.max(1,Math.abs(ce),Math.abs(de))},Se.forEach=Se.sqrLen=Se.len=Se.sqrDist=Se.dist=Se.div=Se.mul=Se.sub=void 0;var c=function(V,X){if(V&&V.__esModule)return V;if(V===null||g(V)!=="object"&&typeof V!="function")return{default:V};var K=f(void 0);if(K&&K.has(V))return K.get(V);var ee={},ce=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var he in V)if(he!=="default"&&Object.prototype.hasOwnProperty.call(V,he)){var ne=ce?Object.getOwnPropertyDescriptor(V,he):null;ne&&(ne.get||ne.set)?Object.defineProperty(ee,he,ne):ee[he]=V[he]}return ee.default=V,K&&K.set(V,ee),ee}(y());function f(V){if(typeof WeakMap!="function")return null;var X=new WeakMap,K=new WeakMap;return(f=function(ee){return ee?K:X})(V)}function v(){var V=new c.ARRAY_TYPE(3);return c.ARRAY_TYPE!=Float32Array&&(V[0]=0,V[1]=0,V[2]=0),V}function S(V){return Math.hypot(V[0],V[1],V[2])}function x(V,X,K){return V[0]=X[0]-K[0],V[1]=X[1]-K[1],V[2]=X[2]-K[2],V}function A(V,X,K){return V[0]=X[0]*K[0],V[1]=X[1]*K[1],V[2]=X[2]*K[2],V}function D(V,X,K){return V[0]=X[0]/K[0],V[1]=X[1]/K[1],V[2]=X[2]/K[2],V}function U(V,X){return Math.hypot(X[0]-V[0],X[1]-V[1],X[2]-V[2])}function H(V,X){var K=X[0]-V[0],ee=X[1]-V[1],ce=X[2]-V[2];return K*K+ee*ee+ce*ce}function R(V){var X=V[0],K=V[1],ee=V[2];return X*X+K*K+ee*ee}function N(V,X){return V[0]*X[0]+V[1]*X[1]+V[2]*X[2]}Se.sub=x,Se.mul=A,Se.div=D,Se.dist=U,Se.sqrDist=H,Se.len=S,Se.sqrLen=R;var G,z=(G=v(),function(V,X,K,ee,ce,he){var ne,de;for(X||(X=3),K||(K=0),de=ee?Math.min(ee*X+K,V.length):V.length,ne=K;ne<de;ne+=X)G[0]=V[ne],G[1]=V[ne+1],G[2]=V[ne+2],ce(G,G,he),V[ne]=G[0],V[ne+1]=G[1],V[ne+2]=G[2];return V});return Se.forEach=z,Se}var Re,qe,Le={};function dt(){if(Re)return Le;function g(z){return g=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(V){return typeof V}:function(V){return V&&typeof Symbol=="function"&&V.constructor===Symbol&&V!==Symbol.prototype?"symbol":typeof V},g(z)}Re=1,Object.defineProperty(Le,"__esModule",{value:!0}),Le.create=v,Le.clone=function(z){var V=new c.ARRAY_TYPE(4);return V[0]=z[0],V[1]=z[1],V[2]=z[2],V[3]=z[3],V},Le.fromValues=function(z,V,X,K){var ee=new c.ARRAY_TYPE(4);return ee[0]=z,ee[1]=V,ee[2]=X,ee[3]=K,ee},Le.copy=function(z,V){return z[0]=V[0],z[1]=V[1],z[2]=V[2],z[3]=V[3],z},Le.set=function(z,V,X,K,ee){return z[0]=V,z[1]=X,z[2]=K,z[3]=ee,z},Le.add=function(z,V,X){return z[0]=V[0]+X[0],z[1]=V[1]+X[1],z[2]=V[2]+X[2],z[3]=V[3]+X[3],z},Le.subtract=S,Le.multiply=x,Le.divide=A,Le.ceil=function(z,V){return z[0]=Math.ceil(V[0]),z[1]=Math.ceil(V[1]),z[2]=Math.ceil(V[2]),z[3]=Math.ceil(V[3]),z},Le.floor=function(z,V){return z[0]=Math.floor(V[0]),z[1]=Math.floor(V[1]),z[2]=Math.floor(V[2]),z[3]=Math.floor(V[3]),z},Le.min=function(z,V,X){return z[0]=Math.min(V[0],X[0]),z[1]=Math.min(V[1],X[1]),z[2]=Math.min(V[2],X[2]),z[3]=Math.min(V[3],X[3]),z},Le.max=function(z,V,X){return z[0]=Math.max(V[0],X[0]),z[1]=Math.max(V[1],X[1]),z[2]=Math.max(V[2],X[2]),z[3]=Math.max(V[3],X[3]),z},Le.round=function(z,V){return z[0]=Math.round(V[0]),z[1]=Math.round(V[1]),z[2]=Math.round(V[2]),z[3]=Math.round(V[3]),z},Le.scale=function(z,V,X){return z[0]=V[0]*X,z[1]=V[1]*X,z[2]=V[2]*X,z[3]=V[3]*X,z},Le.scaleAndAdd=function(z,V,X,K){return z[0]=V[0]+X[0]*K,z[1]=V[1]+X[1]*K,z[2]=V[2]+X[2]*K,z[3]=V[3]+X[3]*K,z},Le.distance=D,Le.squaredDistance=U,Le.length=H,Le.squaredLength=R,Le.negate=function(z,V){return z[0]=-V[0],z[1]=-V[1],z[2]=-V[2],z[3]=-V[3],z},Le.inverse=function(z,V){return z[0]=1/V[0],z[1]=1/V[1],z[2]=1/V[2],z[3]=1/V[3],z},Le.normalize=function(z,V){var X=V[0],K=V[1],ee=V[2],ce=V[3],he=X*X+K*K+ee*ee+ce*ce;return he>0&&(he=1/Math.sqrt(he)),z[0]=X*he,z[1]=K*he,z[2]=ee*he,z[3]=ce*he,z},Le.dot=function(z,V){return z[0]*V[0]+z[1]*V[1]+z[2]*V[2]+z[3]*V[3]},Le.cross=function(z,V,X,K){var ee=X[0]*K[1]-X[1]*K[0],ce=X[0]*K[2]-X[2]*K[0],he=X[0]*K[3]-X[3]*K[0],ne=X[1]*K[2]-X[2]*K[1],de=X[1]*K[3]-X[3]*K[1],ge=X[2]*K[3]-X[3]*K[2],Me=V[0],Be=V[1],Oe=V[2],Ie=V[3];return z[0]=Be*ge-Oe*de+Ie*ne,z[1]=-Me*ge+Oe*he-Ie*ce,z[2]=Me*de-Be*he+Ie*ee,z[3]=-Me*ne+Be*ce-Oe*ee,z},Le.lerp=function(z,V,X,K){var ee=V[0],ce=V[1],he=V[2],ne=V[3];return z[0]=ee+K*(X[0]-ee),z[1]=ce+K*(X[1]-ce),z[2]=he+K*(X[2]-he),z[3]=ne+K*(X[3]-ne),z},Le.random=function(z,V){var X,K,ee,ce,he,ne;V=V||1;do he=(X=2*c.RANDOM()-1)*X+(K=2*c.RANDOM()-1)*K;while(he>=1);do ne=(ee=2*c.RANDOM()-1)*ee+(ce=2*c.RANDOM()-1)*ce;while(ne>=1);var de=Math.sqrt((1-he)/ne);return z[0]=V*X,z[1]=V*K,z[2]=V*ee*de,z[3]=V*ce*de,z},Le.transformMat4=function(z,V,X){var K=V[0],ee=V[1],ce=V[2],he=V[3];return z[0]=X[0]*K+X[4]*ee+X[8]*ce+X[12]*he,z[1]=X[1]*K+X[5]*ee+X[9]*ce+X[13]*he,z[2]=X[2]*K+X[6]*ee+X[10]*ce+X[14]*he,z[3]=X[3]*K+X[7]*ee+X[11]*ce+X[15]*he,z},Le.transformQuat=function(z,V,X){var K=V[0],ee=V[1],ce=V[2],he=X[0],ne=X[1],de=X[2],ge=X[3],Me=ge*K+ne*ce-de*ee,Be=ge*ee+de*K-he*ce,Oe=ge*ce+he*ee-ne*K,Ie=-he*K-ne*ee-de*ce;return z[0]=Me*ge+Ie*-he+Be*-de-Oe*-ne,z[1]=Be*ge+Ie*-ne+Oe*-he-Me*-de,z[2]=Oe*ge+Ie*-de+Me*-ne-Be*-he,z[3]=V[3],z},Le.zero=function(z){return z[0]=0,z[1]=0,z[2]=0,z[3]=0,z},Le.str=function(z){return"vec4("+z[0]+", "+z[1]+", "+z[2]+", "+z[3]+")"},Le.exactEquals=function(z,V){return z[0]===V[0]&&z[1]===V[1]&&z[2]===V[2]&&z[3]===V[3]},Le.equals=function(z,V){var X=z[0],K=z[1],ee=z[2],ce=z[3],he=V[0],ne=V[1],de=V[2],ge=V[3];return Math.abs(X-he)<=c.EPSILON*Math.max(1,Math.abs(X),Math.abs(he))&&Math.abs(K-ne)<=c.EPSILON*Math.max(1,Math.abs(K),Math.abs(ne))&&Math.abs(ee-de)<=c.EPSILON*Math.max(1,Math.abs(ee),Math.abs(de))&&Math.abs(ce-ge)<=c.EPSILON*Math.max(1,Math.abs(ce),Math.abs(ge))},Le.forEach=Le.sqrLen=Le.len=Le.sqrDist=Le.dist=Le.div=Le.mul=Le.sub=void 0;var c=function(z,V){if(z&&z.__esModule)return z;if(z===null||g(z)!=="object"&&typeof z!="function")return{default:z};var X=f(void 0);if(X&&X.has(z))return X.get(z);var K={},ee=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var ce in z)if(ce!=="default"&&Object.prototype.hasOwnProperty.call(z,ce)){var he=ee?Object.getOwnPropertyDescriptor(z,ce):null;he&&(he.get||he.set)?Object.defineProperty(K,ce,he):K[ce]=z[ce]}return K.default=z,X&&X.set(z,K),K}(y());function f(z){if(typeof WeakMap!="function")return null;var V=new WeakMap,X=new WeakMap;return(f=function(K){return K?X:V})(z)}function v(){var z=new c.ARRAY_TYPE(4);return c.ARRAY_TYPE!=Float32Array&&(z[0]=0,z[1]=0,z[2]=0,z[3]=0),z}function S(z,V,X){return z[0]=V[0]-X[0],z[1]=V[1]-X[1],z[2]=V[2]-X[2],z[3]=V[3]-X[3],z}function x(z,V,X){return z[0]=V[0]*X[0],z[1]=V[1]*X[1],z[2]=V[2]*X[2],z[3]=V[3]*X[3],z}function A(z,V,X){return z[0]=V[0]/X[0],z[1]=V[1]/X[1],z[2]=V[2]/X[2],z[3]=V[3]/X[3],z}function D(z,V){return Math.hypot(V[0]-z[0],V[1]-z[1],V[2]-z[2],V[3]-z[3])}function U(z,V){var X=V[0]-z[0],K=V[1]-z[1],ee=V[2]-z[2],ce=V[3]-z[3];return X*X+K*K+ee*ee+ce*ce}function H(z){return Math.hypot(z[0],z[1],z[2],z[3])}function R(z){var V=z[0],X=z[1],K=z[2],ee=z[3];return V*V+X*X+K*K+ee*ee}Le.sub=S,Le.mul=x,Le.div=A,Le.dist=D,Le.sqrDist=U,Le.len=H,Le.sqrLen=R;var N,G=(N=v(),function(z,V,X,K,ee,ce){var he,ne;for(V||(V=4),X||(X=0),ne=K?Math.min(K*V+X,z.length):z.length,he=X;he<ne;he+=V)N[0]=z[he],N[1]=z[he+1],N[2]=z[he+2],N[3]=z[he+3],ee(N,N,ce),z[he]=N[0],z[he+1]=N[1],z[he+2]=N[2],z[he+3]=N[3];return z});return Le.forEach=G,Le}function ye(){if(qe)return fe;function g(ze){return g=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Qe){return typeof Qe}:function(Qe){return Qe&&typeof Symbol=="function"&&Qe.constructor===Symbol&&Qe!==Symbol.prototype?"symbol":typeof Qe},g(ze)}qe=1,Object.defineProperty(fe,"__esModule",{value:!0}),fe.create=D,fe.identity=function(ze){return ze[0]=0,ze[1]=0,ze[2]=0,ze[3]=1,ze},fe.setAxisAngle=U,fe.getAxisAngle=function(ze,Qe){var lt=2*Math.acos(Qe[3]),ut=Math.sin(lt/2);return ut>c.EPSILON?(ze[0]=Qe[0]/ut,ze[1]=Qe[1]/ut,ze[2]=Qe[2]/ut):(ze[0]=1,ze[1]=0,ze[2]=0),lt},fe.getAngle=function(ze,Qe){var lt=X(ze,Qe);return Math.acos(2*lt*lt-1)},fe.multiply=H,fe.rotateX=function(ze,Qe,lt){lt*=.5;var ut=Qe[0],ht=Qe[1],mt=Qe[2],Et=Qe[3],vt=Math.sin(lt),Ut=Math.cos(lt);return ze[0]=ut*Ut+Et*vt,ze[1]=ht*Ut+mt*vt,ze[2]=mt*Ut-ht*vt,ze[3]=Et*Ut-ut*vt,ze},fe.rotateY=function(ze,Qe,lt){lt*=.5;var ut=Qe[0],ht=Qe[1],mt=Qe[2],Et=Qe[3],vt=Math.sin(lt),Ut=Math.cos(lt);return ze[0]=ut*Ut-mt*vt,ze[1]=ht*Ut+Et*vt,ze[2]=mt*Ut+ut*vt,ze[3]=Et*Ut-ht*vt,ze},fe.rotateZ=function(ze,Qe,lt){lt*=.5;var ut=Qe[0],ht=Qe[1],mt=Qe[2],Et=Qe[3],vt=Math.sin(lt),Ut=Math.cos(lt);return ze[0]=ut*Ut+ht*vt,ze[1]=ht*Ut-ut*vt,ze[2]=mt*Ut+Et*vt,ze[3]=Et*Ut-mt*vt,ze},fe.calculateW=function(ze,Qe){var lt=Qe[0],ut=Qe[1],ht=Qe[2];return ze[0]=lt,ze[1]=ut,ze[2]=ht,ze[3]=Math.sqrt(Math.abs(1-lt*lt-ut*ut-ht*ht)),ze},fe.exp=R,fe.ln=N,fe.pow=function(ze,Qe,lt){return N(ze,Qe),V(ze,ze,lt),R(ze,ze),ze},fe.slerp=G,fe.random=function(ze){var Qe=c.RANDOM(),lt=c.RANDOM(),ut=c.RANDOM(),ht=Math.sqrt(1-Qe),mt=Math.sqrt(Qe);return ze[0]=ht*Math.sin(2*Math.PI*lt),ze[1]=ht*Math.cos(2*Math.PI*lt),ze[2]=mt*Math.sin(2*Math.PI*ut),ze[3]=mt*Math.cos(2*Math.PI*ut),ze},fe.invert=function(ze,Qe){var lt=Qe[0],ut=Qe[1],ht=Qe[2],mt=Qe[3],Et=lt*lt+ut*ut+ht*ht+mt*mt,vt=Et?1/Et:0;return ze[0]=-lt*vt,ze[1]=-ut*vt,ze[2]=-ht*vt,ze[3]=mt*vt,ze},fe.conjugate=function(ze,Qe){return ze[0]=-Qe[0],ze[1]=-Qe[1],ze[2]=-Qe[2],ze[3]=Qe[3],ze},fe.fromMat3=z,fe.fromEuler=function(ze,Qe,lt,ut){var ht=.5*Math.PI/180;Qe*=ht,lt*=ht,ut*=ht;var mt=Math.sin(Qe),Et=Math.cos(Qe),vt=Math.sin(lt),Ut=Math.cos(lt),Yt=Math.sin(ut),Dt=Math.cos(ut);return ze[0]=mt*Ut*Dt-Et*vt*Yt,ze[1]=Et*vt*Dt+mt*Ut*Yt,ze[2]=Et*Ut*Yt-mt*vt*Dt,ze[3]=Et*Ut*Dt+mt*vt*Yt,ze},fe.str=function(ze){return"quat("+ze[0]+", "+ze[1]+", "+ze[2]+", "+ze[3]+")"},fe.setAxes=fe.sqlerp=fe.rotationTo=fe.equals=fe.exactEquals=fe.normalize=fe.sqrLen=fe.squaredLength=fe.len=fe.length=fe.lerp=fe.dot=fe.scale=fe.mul=fe.add=fe.set=fe.copy=fe.fromValues=fe.clone=void 0;var c=A(y()),f=A(Z()),v=A(Ee()),S=A(dt());function x(ze){if(typeof WeakMap!="function")return null;var Qe=new WeakMap,lt=new WeakMap;return(x=function(ut){return ut?lt:Qe})(ze)}function A(ze,Qe){if(ze&&ze.__esModule)return ze;if(ze===null||g(ze)!=="object"&&typeof ze!="function")return{default:ze};var lt=x(Qe);if(lt&&lt.has(ze))return lt.get(ze);var ut={},ht=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var mt in ze)if(mt!=="default"&&Object.prototype.hasOwnProperty.call(ze,mt)){var Et=ht?Object.getOwnPropertyDescriptor(ze,mt):null;Et&&(Et.get||Et.set)?Object.defineProperty(ut,mt,Et):ut[mt]=ze[mt]}return ut.default=ze,lt&&lt.set(ze,ut),ut}function D(){var ze=new c.ARRAY_TYPE(4);return c.ARRAY_TYPE!=Float32Array&&(ze[0]=0,ze[1]=0,ze[2]=0),ze[3]=1,ze}function U(ze,Qe,lt){lt*=.5;var ut=Math.sin(lt);return ze[0]=ut*Qe[0],ze[1]=ut*Qe[1],ze[2]=ut*Qe[2],ze[3]=Math.cos(lt),ze}function H(ze,Qe,lt){var ut=Qe[0],ht=Qe[1],mt=Qe[2],Et=Qe[3],vt=lt[0],Ut=lt[1],Yt=lt[2],Dt=lt[3];return ze[0]=ut*Dt+Et*vt+ht*Yt-mt*Ut,ze[1]=ht*Dt+Et*Ut+mt*vt-ut*Yt,ze[2]=mt*Dt+Et*Yt+ut*Ut-ht*vt,ze[3]=Et*Dt-ut*vt-ht*Ut-mt*Yt,ze}function R(ze,Qe){var lt=Qe[0],ut=Qe[1],ht=Qe[2],mt=Qe[3],Et=Math.sqrt(lt*lt+ut*ut+ht*ht),vt=Math.exp(mt),Ut=Et>0?vt*Math.sin(Et)/Et:0;return ze[0]=lt*Ut,ze[1]=ut*Ut,ze[2]=ht*Ut,ze[3]=vt*Math.cos(Et),ze}function N(ze,Qe){var lt=Qe[0],ut=Qe[1],ht=Qe[2],mt=Qe[3],Et=Math.sqrt(lt*lt+ut*ut+ht*ht),vt=Et>0?Math.atan2(Et,mt)/Et:0;return ze[0]=lt*vt,ze[1]=ut*vt,ze[2]=ht*vt,ze[3]=.5*Math.log(lt*lt+ut*ut+ht*ht+mt*mt),ze}function G(ze,Qe,lt,ut){var ht,mt,Et,vt,Ut,Yt=Qe[0],Dt=Qe[1],Rn=Qe[2],bn=Qe[3],dn=lt[0],tn=lt[1],nr=lt[2],In=lt[3];return(mt=Yt*dn+Dt*tn+Rn*nr+bn*In)<0&&(mt=-mt,dn=-dn,tn=-tn,nr=-nr,In=-In),1-mt>c.EPSILON?(ht=Math.acos(mt),Et=Math.sin(ht),vt=Math.sin((1-ut)*ht)/Et,Ut=Math.sin(ut*ht)/Et):(vt=1-ut,Ut=ut),ze[0]=vt*Yt+Ut*dn,ze[1]=vt*Dt+Ut*tn,ze[2]=vt*Rn+Ut*nr,ze[3]=vt*bn+Ut*In,ze}function z(ze,Qe){var lt,ut=Qe[0]+Qe[4]+Qe[8];if(ut>0)lt=Math.sqrt(ut+1),ze[3]=.5*lt,ze[0]=(Qe[5]-Qe[7])*(lt=.5/lt),ze[1]=(Qe[6]-Qe[2])*lt,ze[2]=(Qe[1]-Qe[3])*lt;else{var ht=0;Qe[4]>Qe[0]&&(ht=1),Qe[8]>Qe[3*ht+ht]&&(ht=2);var mt=(ht+1)%3,Et=(ht+2)%3;lt=Math.sqrt(Qe[3*ht+ht]-Qe[3*mt+mt]-Qe[3*Et+Et]+1),ze[ht]=.5*lt,ze[3]=(Qe[3*mt+Et]-Qe[3*Et+mt])*(lt=.5/lt),ze[mt]=(Qe[3*mt+ht]+Qe[3*ht+mt])*lt,ze[Et]=(Qe[3*Et+ht]+Qe[3*ht+Et])*lt}return ze}fe.clone=S.clone,fe.fromValues=S.fromValues,fe.copy=S.copy,fe.set=S.set,fe.add=S.add,fe.mul=H;var V=S.scale;fe.scale=V;var X=S.dot;fe.dot=X,fe.lerp=S.lerp;var K=S.length;fe.length=K,fe.len=K;var ee=S.squaredLength;fe.squaredLength=ee,fe.sqrLen=ee;var ce=S.normalize;fe.normalize=ce,fe.exactEquals=S.exactEquals,fe.equals=S.equals;var he,ne,de,ge=(he=v.create(),ne=v.fromValues(1,0,0),de=v.fromValues(0,1,0),function(ze,Qe,lt){var ut=v.dot(Qe,lt);return ut<-.999999?(v.cross(he,ne,Qe),v.len(he)<1e-6&&v.cross(he,de,Qe),v.normalize(he,he),U(ze,he,Math.PI),ze):ut>.999999?(ze[0]=0,ze[1]=0,ze[2]=0,ze[3]=1,ze):(v.cross(he,Qe,lt),ze[0]=he[0],ze[1]=he[1],ze[2]=he[2],ze[3]=1+ut,ce(ze,ze))});fe.rotationTo=ge;var Me,Be,Oe=(Me=D(),Be=D(),function(ze,Qe,lt,ut,ht,mt){return G(Me,Qe,ht,mt),G(Be,lt,ut,mt),G(ze,Me,Be,2*mt*(1-mt)),ze});fe.sqlerp=Oe;var Ie,Ye=(Ie=f.create(),function(ze,Qe,lt,ut){return Ie[0]=lt[0],Ie[3]=lt[1],Ie[6]=lt[2],Ie[1]=ut[0],Ie[4]=ut[1],Ie[7]=ut[2],Ie[2]=-Qe[0],Ie[5]=-Qe[1],Ie[8]=-Qe[2],ce(ze,z(ze,Ie))});return fe.setAxes=Ye,fe}var Xe,He={};function _t(){if(Xe)return He;function g(G){return g=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(z){return typeof z}:function(z){return z&&typeof Symbol=="function"&&z.constructor===Symbol&&z!==Symbol.prototype?"symbol":typeof z},g(G)}Xe=1,Object.defineProperty(He,"__esModule",{value:!0}),He.create=function(){var G=new c.ARRAY_TYPE(8);return c.ARRAY_TYPE!=Float32Array&&(G[0]=0,G[1]=0,G[2]=0,G[4]=0,G[5]=0,G[6]=0,G[7]=0),G[3]=1,G},He.clone=function(G){var z=new c.ARRAY_TYPE(8);return z[0]=G[0],z[1]=G[1],z[2]=G[2],z[3]=G[3],z[4]=G[4],z[5]=G[5],z[6]=G[6],z[7]=G[7],z},He.fromValues=function(G,z,V,X,K,ee,ce,he){var ne=new c.ARRAY_TYPE(8);return ne[0]=G,ne[1]=z,ne[2]=V,ne[3]=X,ne[4]=K,ne[5]=ee,ne[6]=ce,ne[7]=he,ne},He.fromRotationTranslationValues=function(G,z,V,X,K,ee,ce){var he=new c.ARRAY_TYPE(8);he[0]=G,he[1]=z,he[2]=V,he[3]=X;var ne=.5*K,de=.5*ee,ge=.5*ce;return he[4]=ne*X+de*V-ge*z,he[5]=de*X+ge*G-ne*V,he[6]=ge*X+ne*z-de*G,he[7]=-ne*G-de*z-ge*V,he},He.fromRotationTranslation=A,He.fromTranslation=function(G,z){return G[0]=0,G[1]=0,G[2]=0,G[3]=1,G[4]=.5*z[0],G[5]=.5*z[1],G[6]=.5*z[2],G[7]=0,G},He.fromRotation=function(G,z){return G[0]=z[0],G[1]=z[1],G[2]=z[2],G[3]=z[3],G[4]=0,G[5]=0,G[6]=0,G[7]=0,G},He.fromMat4=function(G,z){var V=f.create();v.getRotation(V,z);var X=new c.ARRAY_TYPE(3);return v.getTranslation(X,z),A(G,V,X),G},He.copy=D,He.identity=function(G){return G[0]=0,G[1]=0,G[2]=0,G[3]=1,G[4]=0,G[5]=0,G[6]=0,G[7]=0,G},He.set=function(G,z,V,X,K,ee,ce,he,ne){return G[0]=z,G[1]=V,G[2]=X,G[3]=K,G[4]=ee,G[5]=ce,G[6]=he,G[7]=ne,G},He.getDual=function(G,z){return G[0]=z[4],G[1]=z[5],G[2]=z[6],G[3]=z[7],G},He.setDual=function(G,z){return G[4]=z[0],G[5]=z[1],G[6]=z[2],G[7]=z[3],G},He.getTranslation=function(G,z){var V=z[4],X=z[5],K=z[6],ee=z[7],ce=-z[0],he=-z[1],ne=-z[2],de=z[3];return G[0]=2*(V*de+ee*ce+X*ne-K*he),G[1]=2*(X*de+ee*he+K*ce-V*ne),G[2]=2*(K*de+ee*ne+V*he-X*ce),G},He.translate=function(G,z,V){var X=z[0],K=z[1],ee=z[2],ce=z[3],he=.5*V[0],ne=.5*V[1],de=.5*V[2],ge=z[4],Me=z[5],Be=z[6],Oe=z[7];return G[0]=X,G[1]=K,G[2]=ee,G[3]=ce,G[4]=ce*he+K*de-ee*ne+ge,G[5]=ce*ne+ee*he-X*de+Me,G[6]=ce*de+X*ne-K*he+Be,G[7]=-X*he-K*ne-ee*de+Oe,G},He.rotateX=function(G,z,V){var X=-z[0],K=-z[1],ee=-z[2],ce=z[3],he=z[4],ne=z[5],de=z[6],ge=z[7],Me=he*ce+ge*X+ne*ee-de*K,Be=ne*ce+ge*K+de*X-he*ee,Oe=de*ce+ge*ee+he*K-ne*X,Ie=ge*ce-he*X-ne*K-de*ee;return f.rotateX(G,z,V),G[4]=Me*(ce=G[3])+Ie*(X=G[0])+Be*(ee=G[2])-Oe*(K=G[1]),G[5]=Be*ce+Ie*K+Oe*X-Me*ee,G[6]=Oe*ce+Ie*ee+Me*K-Be*X,G[7]=Ie*ce-Me*X-Be*K-Oe*ee,G},He.rotateY=function(G,z,V){var X=-z[0],K=-z[1],ee=-z[2],ce=z[3],he=z[4],ne=z[5],de=z[6],ge=z[7],Me=he*ce+ge*X+ne*ee-de*K,Be=ne*ce+ge*K+de*X-he*ee,Oe=de*ce+ge*ee+he*K-ne*X,Ie=ge*ce-he*X-ne*K-de*ee;return f.rotateY(G,z,V),G[4]=Me*(ce=G[3])+Ie*(X=G[0])+Be*(ee=G[2])-Oe*(K=G[1]),G[5]=Be*ce+Ie*K+Oe*X-Me*ee,G[6]=Oe*ce+Ie*ee+Me*K-Be*X,G[7]=Ie*ce-Me*X-Be*K-Oe*ee,G},He.rotateZ=function(G,z,V){var X=-z[0],K=-z[1],ee=-z[2],ce=z[3],he=z[4],ne=z[5],de=z[6],ge=z[7],Me=he*ce+ge*X+ne*ee-de*K,Be=ne*ce+ge*K+de*X-he*ee,Oe=de*ce+ge*ee+he*K-ne*X,Ie=ge*ce-he*X-ne*K-de*ee;return f.rotateZ(G,z,V),G[4]=Me*(ce=G[3])+Ie*(X=G[0])+Be*(ee=G[2])-Oe*(K=G[1]),G[5]=Be*ce+Ie*K+Oe*X-Me*ee,G[6]=Oe*ce+Ie*ee+Me*K-Be*X,G[7]=Ie*ce-Me*X-Be*K-Oe*ee,G},He.rotateByQuatAppend=function(G,z,V){var X=V[0],K=V[1],ee=V[2],ce=V[3],he=z[0],ne=z[1],de=z[2],ge=z[3];return G[0]=he*ce+ge*X+ne*ee-de*K,G[1]=ne*ce+ge*K+de*X-he*ee,G[2]=de*ce+ge*ee+he*K-ne*X,G[3]=ge*ce-he*X-ne*K-de*ee,G[4]=(he=z[4])*ce+(ge=z[7])*X+(ne=z[5])*ee-(de=z[6])*K,G[5]=ne*ce+ge*K+de*X-he*ee,G[6]=de*ce+ge*ee+he*K-ne*X,G[7]=ge*ce-he*X-ne*K-de*ee,G},He.rotateByQuatPrepend=function(G,z,V){var X=z[0],K=z[1],ee=z[2],ce=z[3],he=V[0],ne=V[1],de=V[2],ge=V[3];return G[0]=X*ge+ce*he+K*de-ee*ne,G[1]=K*ge+ce*ne+ee*he-X*de,G[2]=ee*ge+ce*de+X*ne-K*he,G[3]=ce*ge-X*he-K*ne-ee*de,G[4]=X*(ge=V[7])+ce*(he=V[4])+K*(de=V[6])-ee*(ne=V[5]),G[5]=K*ge+ce*ne+ee*he-X*de,G[6]=ee*ge+ce*de+X*ne-K*he,G[7]=ce*ge-X*he-K*ne-ee*de,G},He.rotateAroundAxis=function(G,z,V,X){if(Math.abs(X)<c.EPSILON)return D(G,z);var K=Math.hypot(V[0],V[1],V[2]);X*=.5;var ee=Math.sin(X),ce=ee*V[0]/K,he=ee*V[1]/K,ne=ee*V[2]/K,de=Math.cos(X),ge=z[0],Me=z[1],Be=z[2],Oe=z[3];G[0]=ge*de+Oe*ce+Me*ne-Be*he,G[1]=Me*de+Oe*he+Be*ce-ge*ne,G[2]=Be*de+Oe*ne+ge*he-Me*ce,G[3]=Oe*de-ge*ce-Me*he-Be*ne;var Ie=z[4],Ye=z[5],ze=z[6],Qe=z[7];return G[4]=Ie*de+Qe*ce+Ye*ne-ze*he,G[5]=Ye*de+Qe*he+ze*ce-Ie*ne,G[6]=ze*de+Qe*ne+Ie*he-Ye*ce,G[7]=Qe*de-Ie*ce-Ye*he-ze*ne,G},He.add=function(G,z,V){return G[0]=z[0]+V[0],G[1]=z[1]+V[1],G[2]=z[2]+V[2],G[3]=z[3]+V[3],G[4]=z[4]+V[4],G[5]=z[5]+V[5],G[6]=z[6]+V[6],G[7]=z[7]+V[7],G},He.multiply=U,He.scale=function(G,z,V){return G[0]=z[0]*V,G[1]=z[1]*V,G[2]=z[2]*V,G[3]=z[3]*V,G[4]=z[4]*V,G[5]=z[5]*V,G[6]=z[6]*V,G[7]=z[7]*V,G},He.lerp=function(G,z,V,X){var K=1-X;return H(z,V)<0&&(X=-X),G[0]=z[0]*K+V[0]*X,G[1]=z[1]*K+V[1]*X,G[2]=z[2]*K+V[2]*X,G[3]=z[3]*K+V[3]*X,G[4]=z[4]*K+V[4]*X,G[5]=z[5]*K+V[5]*X,G[6]=z[6]*K+V[6]*X,G[7]=z[7]*K+V[7]*X,G},He.invert=function(G,z){var V=N(z);return G[0]=-z[0]/V,G[1]=-z[1]/V,G[2]=-z[2]/V,G[3]=z[3]/V,G[4]=-z[4]/V,G[5]=-z[5]/V,G[6]=-z[6]/V,G[7]=z[7]/V,G},He.conjugate=function(G,z){return G[0]=-z[0],G[1]=-z[1],G[2]=-z[2],G[3]=z[3],G[4]=-z[4],G[5]=-z[5],G[6]=-z[6],G[7]=z[7],G},He.normalize=function(G,z){var V=N(z);if(V>0){V=Math.sqrt(V);var X=z[0]/V,K=z[1]/V,ee=z[2]/V,ce=z[3]/V,he=z[4],ne=z[5],de=z[6],ge=z[7],Me=X*he+K*ne+ee*de+ce*ge;G[0]=X,G[1]=K,G[2]=ee,G[3]=ce,G[4]=(he-X*Me)/V,G[5]=(ne-K*Me)/V,G[6]=(de-ee*Me)/V,G[7]=(ge-ce*Me)/V}return G},He.str=function(G){return"quat2("+G[0]+", "+G[1]+", "+G[2]+", "+G[3]+", "+G[4]+", "+G[5]+", "+G[6]+", "+G[7]+")"},He.exactEquals=function(G,z){return G[0]===z[0]&&G[1]===z[1]&&G[2]===z[2]&&G[3]===z[3]&&G[4]===z[4]&&G[5]===z[5]&&G[6]===z[6]&&G[7]===z[7]},He.equals=function(G,z){var V=G[0],X=G[1],K=G[2],ee=G[3],ce=G[4],he=G[5],ne=G[6],de=G[7],ge=z[0],Me=z[1],Be=z[2],Oe=z[3],Ie=z[4],Ye=z[5],ze=z[6],Qe=z[7];return Math.abs(V-ge)<=c.EPSILON*Math.max(1,Math.abs(V),Math.abs(ge))&&Math.abs(X-Me)<=c.EPSILON*Math.max(1,Math.abs(X),Math.abs(Me))&&Math.abs(K-Be)<=c.EPSILON*Math.max(1,Math.abs(K),Math.abs(Be))&&Math.abs(ee-Oe)<=c.EPSILON*Math.max(1,Math.abs(ee),Math.abs(Oe))&&Math.abs(ce-Ie)<=c.EPSILON*Math.max(1,Math.abs(ce),Math.abs(Ie))&&Math.abs(he-Ye)<=c.EPSILON*Math.max(1,Math.abs(he),Math.abs(Ye))&&Math.abs(ne-ze)<=c.EPSILON*Math.max(1,Math.abs(ne),Math.abs(ze))&&Math.abs(de-Qe)<=c.EPSILON*Math.max(1,Math.abs(de),Math.abs(Qe))},He.sqrLen=He.squaredLength=He.len=He.length=He.dot=He.mul=He.setReal=He.getReal=void 0;var c=x(y()),f=x(ye()),v=x(se());function S(G){if(typeof WeakMap!="function")return null;var z=new WeakMap,V=new WeakMap;return(S=function(X){return X?V:z})(G)}function x(G,z){if(G&&G.__esModule)return G;if(G===null||g(G)!=="object"&&typeof G!="function")return{default:G};var V=S(z);if(V&&V.has(G))return V.get(G);var X={},K=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var ee in G)if(ee!=="default"&&Object.prototype.hasOwnProperty.call(G,ee)){var ce=K?Object.getOwnPropertyDescriptor(G,ee):null;ce&&(ce.get||ce.set)?Object.defineProperty(X,ee,ce):X[ee]=G[ee]}return X.default=G,V&&V.set(G,X),X}function A(G,z,V){var X=.5*V[0],K=.5*V[1],ee=.5*V[2],ce=z[0],he=z[1],ne=z[2],de=z[3];return G[0]=ce,G[1]=he,G[2]=ne,G[3]=de,G[4]=X*de+K*ne-ee*he,G[5]=K*de+ee*ce-X*ne,G[6]=ee*de+X*he-K*ce,G[7]=-X*ce-K*he-ee*ne,G}function D(G,z){return G[0]=z[0],G[1]=z[1],G[2]=z[2],G[3]=z[3],G[4]=z[4],G[5]=z[5],G[6]=z[6],G[7]=z[7],G}function U(G,z,V){var X=z[0],K=z[1],ee=z[2],ce=z[3],he=V[4],ne=V[5],de=V[6],ge=V[7],Me=z[4],Be=z[5],Oe=z[6],Ie=z[7],Ye=V[0],ze=V[1],Qe=V[2],lt=V[3];return G[0]=X*lt+ce*Ye+K*Qe-ee*ze,G[1]=K*lt+ce*ze+ee*Ye-X*Qe,G[2]=ee*lt+ce*Qe+X*ze-K*Ye,G[3]=ce*lt-X*Ye-K*ze-ee*Qe,G[4]=X*ge+ce*he+K*de-ee*ne+Me*lt+Ie*Ye+Be*Qe-Oe*ze,G[5]=K*ge+ce*ne+ee*he-X*de+Be*lt+Ie*ze+Oe*Ye-Me*Qe,G[6]=ee*ge+ce*de+X*ne-K*he+Oe*lt+Ie*Qe+Me*ze-Be*Ye,G[7]=ce*ge-X*he-K*ne-ee*de+Ie*lt-Me*Ye-Be*ze-Oe*Qe,G}He.getReal=f.copy,He.setReal=f.copy,He.mul=U;var H=f.dot;He.dot=H;var R=f.length;He.length=R,He.len=R;var N=f.squaredLength;return He.squaredLength=N,He.sqrLen=N,He}var wt,Gt,at={};function Ht(){if(wt)return at;function g(z){return g=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(V){return typeof V}:function(V){return V&&typeof Symbol=="function"&&V.constructor===Symbol&&V!==Symbol.prototype?"symbol":typeof V},g(z)}wt=1,Object.defineProperty(at,"__esModule",{value:!0}),at.create=v,at.clone=function(z){var V=new c.ARRAY_TYPE(2);return V[0]=z[0],V[1]=z[1],V},at.fromValues=function(z,V){var X=new c.ARRAY_TYPE(2);return X[0]=z,X[1]=V,X},at.copy=function(z,V){return z[0]=V[0],z[1]=V[1],z},at.set=function(z,V,X){return z[0]=V,z[1]=X,z},at.add=function(z,V,X){return z[0]=V[0]+X[0],z[1]=V[1]+X[1],z},at.subtract=S,at.multiply=x,at.divide=A,at.ceil=function(z,V){return z[0]=Math.ceil(V[0]),z[1]=Math.ceil(V[1]),z},at.floor=function(z,V){return z[0]=Math.floor(V[0]),z[1]=Math.floor(V[1]),z},at.min=function(z,V,X){return z[0]=Math.min(V[0],X[0]),z[1]=Math.min(V[1],X[1]),z},at.max=function(z,V,X){return z[0]=Math.max(V[0],X[0]),z[1]=Math.max(V[1],X[1]),z},at.round=function(z,V){return z[0]=Math.round(V[0]),z[1]=Math.round(V[1]),z},at.scale=function(z,V,X){return z[0]=V[0]*X,z[1]=V[1]*X,z},at.scaleAndAdd=function(z,V,X,K){return z[0]=V[0]+X[0]*K,z[1]=V[1]+X[1]*K,z},at.distance=D,at.squaredDistance=U,at.length=H,at.squaredLength=R,at.negate=function(z,V){return z[0]=-V[0],z[1]=-V[1],z},at.inverse=function(z,V){return z[0]=1/V[0],z[1]=1/V[1],z},at.normalize=function(z,V){var X=V[0],K=V[1],ee=X*X+K*K;return ee>0&&(ee=1/Math.sqrt(ee)),z[0]=V[0]*ee,z[1]=V[1]*ee,z},at.dot=function(z,V){return z[0]*V[0]+z[1]*V[1]},at.cross=function(z,V,X){var K=V[0]*X[1]-V[1]*X[0];return z[0]=z[1]=0,z[2]=K,z},at.lerp=function(z,V,X,K){var ee=V[0],ce=V[1];return z[0]=ee+K*(X[0]-ee),z[1]=ce+K*(X[1]-ce),z},at.random=function(z,V){V=V||1;var X=2*c.RANDOM()*Math.PI;return z[0]=Math.cos(X)*V,z[1]=Math.sin(X)*V,z},at.transformMat2=function(z,V,X){var K=V[0],ee=V[1];return z[0]=X[0]*K+X[2]*ee,z[1]=X[1]*K+X[3]*ee,z},at.transformMat2d=function(z,V,X){var K=V[0],ee=V[1];return z[0]=X[0]*K+X[2]*ee+X[4],z[1]=X[1]*K+X[3]*ee+X[5],z},at.transformMat3=function(z,V,X){var K=V[0],ee=V[1];return z[0]=X[0]*K+X[3]*ee+X[6],z[1]=X[1]*K+X[4]*ee+X[7],z},at.transformMat4=function(z,V,X){var K=V[0],ee=V[1];return z[0]=X[0]*K+X[4]*ee+X[12],z[1]=X[1]*K+X[5]*ee+X[13],z},at.rotate=function(z,V,X,K){var ee=V[0]-X[0],ce=V[1]-X[1],he=Math.sin(K),ne=Math.cos(K);return z[0]=ee*ne-ce*he+X[0],z[1]=ee*he+ce*ne+X[1],z},at.angle=function(z,V){var X=z[0],K=z[1],ee=V[0],ce=V[1],he=Math.sqrt(X*X+K*K)*Math.sqrt(ee*ee+ce*ce);return Math.acos(Math.min(Math.max(he&&(X*ee+K*ce)/he,-1),1))},at.zero=function(z){return z[0]=0,z[1]=0,z},at.str=function(z){return"vec2("+z[0]+", "+z[1]+")"},at.exactEquals=function(z,V){return z[0]===V[0]&&z[1]===V[1]},at.equals=function(z,V){var X=z[0],K=z[1],ee=V[0],ce=V[1];return Math.abs(X-ee)<=c.EPSILON*Math.max(1,Math.abs(X),Math.abs(ee))&&Math.abs(K-ce)<=c.EPSILON*Math.max(1,Math.abs(K),Math.abs(ce))},at.forEach=at.sqrLen=at.sqrDist=at.dist=at.div=at.mul=at.sub=at.len=void 0;var c=function(z,V){if(z&&z.__esModule)return z;if(z===null||g(z)!=="object"&&typeof z!="function")return{default:z};var X=f(void 0);if(X&&X.has(z))return X.get(z);var K={},ee=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var ce in z)if(ce!=="default"&&Object.prototype.hasOwnProperty.call(z,ce)){var he=ee?Object.getOwnPropertyDescriptor(z,ce):null;he&&(he.get||he.set)?Object.defineProperty(K,ce,he):K[ce]=z[ce]}return K.default=z,X&&X.set(z,K),K}(y());function f(z){if(typeof WeakMap!="function")return null;var V=new WeakMap,X=new WeakMap;return(f=function(K){return K?X:V})(z)}function v(){var z=new c.ARRAY_TYPE(2);return c.ARRAY_TYPE!=Float32Array&&(z[0]=0,z[1]=0),z}function S(z,V,X){return z[0]=V[0]-X[0],z[1]=V[1]-X[1],z}function x(z,V,X){return z[0]=V[0]*X[0],z[1]=V[1]*X[1],z}function A(z,V,X){return z[0]=V[0]/X[0],z[1]=V[1]/X[1],z}function D(z,V){return Math.hypot(V[0]-z[0],V[1]-z[1])}function U(z,V){var X=V[0]-z[0],K=V[1]-z[1];return X*X+K*K}function H(z){return Math.hypot(z[0],z[1])}function R(z){var V=z[0],X=z[1];return V*V+X*X}at.len=H,at.sub=S,at.mul=x,at.div=A,at.dist=D,at.sqrDist=U,at.sqrLen=R;var N,G=(N=v(),function(z,V,X,K,ee,ce){var he,ne;for(V||(V=2),X||(X=0),ne=K?Math.min(K*V+X,z.length):z.length,he=X;he<ne;he+=V)N[0]=z[he],N[1]=z[he+1],ee(N,N,ce),z[he]=N[0],z[he+1]=N[1];return z});return at.forEach=G,at}function Qt(){if(Gt)return m;function g(z){return g=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(V){return typeof V}:function(V){return V&&typeof Symbol=="function"&&V.constructor===Symbol&&V!==Symbol.prototype?"symbol":typeof V},g(z)}Gt=1,Object.defineProperty(m,"__esModule",{value:!0}),m.vec4=m.vec3=m.vec2=m.quat2=m.quat=m.mat4=m.mat3=m.mat2d=m.mat2=m.glMatrix=void 0;var c=G(y());m.glMatrix=c;var f=G(C());m.mat2=f;var v=G(k());m.mat2d=v;var S=G(Z());m.mat3=S;var x=G(se());m.mat4=x;var A=G(ye());m.quat=A;var D=G(_t());m.quat2=D;var U=G(Ht());m.vec2=U;var H=G(Ee());m.vec3=H;var R=G(dt());function N(z){if(typeof WeakMap!="function")return null;var V=new WeakMap,X=new WeakMap;return(N=function(K){return K?X:V})(z)}function G(z,V){if(z&&z.__esModule)return z;if(z===null||g(z)!=="object"&&typeof z!="function")return{default:z};var X=N(V);if(X&&X.has(z))return X.get(z);var K={},ee=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var ce in z)if(ce!=="default"&&Object.prototype.hasOwnProperty.call(z,ce)){var he=ee?Object.getOwnPropertyDescriptor(z,ce):null;he&&(he.get||he.set)?Object.defineProperty(K,ce,he):K[ce]=z[ce]}return K.default=z,X&&X.set(z,K),K}return m.vec4=R,m}var rn,jn,Bn,Tn,Pe=Qt(),$e=function(){if(jn)return rn;function g(c,f,v,S){this.cx=3*c,this.bx=3*(v-c)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*f,this.by=3*(S-f)-this.cy,this.ay=1-this.cy-this.by,this.p1x=c,this.p1y=f,this.p2x=v,this.p2y=S}return jn=1,rn=g,g.prototype={sampleCurveX:function(c){return((this.ax*c+this.bx)*c+this.cx)*c},sampleCurveY:function(c){return((this.ay*c+this.by)*c+this.cy)*c},sampleCurveDerivativeX:function(c){return(3*this.ax*c+2*this.bx)*c+this.cx},solveCurveX:function(c,f){if(f===void 0&&(f=1e-6),c<0)return 0;if(c>1)return 1;for(var v=c,S=0;S<8;S++){var x=this.sampleCurveX(v)-c;if(Math.abs(x)<f)return v;var A=this.sampleCurveDerivativeX(v);if(Math.abs(A)<1e-6)break;v-=x/A}var D=0,U=1;for(v=c,S=0;S<20&&(x=this.sampleCurveX(v),!(Math.abs(x-c)<f));S++)c>x?D=v:U=v,v=.5*(U-D)+D;return v},solve:function(c,f){return this.sampleCurveY(this.solveCurveX(c,f))}},rn}(),mn=h($e);function cn(){if(Tn)return Bn;function g(c,f){this.x=c,this.y=f}return Tn=1,Bn=g,g.prototype={clone:function(){return new g(this.x,this.y)},add:function(c){return this.clone()._add(c)},sub:function(c){return this.clone()._sub(c)},multByPoint:function(c){return this.clone()._multByPoint(c)},divByPoint:function(c){return this.clone()._divByPoint(c)},mult:function(c){return this.clone()._mult(c)},div:function(c){return this.clone()._div(c)},rotate:function(c){return this.clone()._rotate(c)},rotateAround:function(c,f){return this.clone()._rotateAround(c,f)},matMult:function(c){return this.clone()._matMult(c)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(c){return this.x===c.x&&this.y===c.y},dist:function(c){return Math.sqrt(this.distSqr(c))},distSqr:function(c){var f=c.x-this.x,v=c.y-this.y;return f*f+v*v},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(c){return Math.atan2(this.y-c.y,this.x-c.x)},angleWith:function(c){return this.angleWithSep(c.x,c.y)},angleWithSep:function(c,f){return Math.atan2(this.x*f-this.y*c,this.x*c+this.y*f)},_matMult:function(c){var f=c[2]*this.x+c[3]*this.y;return this.x=c[0]*this.x+c[1]*this.y,this.y=f,this},_add:function(c){return this.x+=c.x,this.y+=c.y,this},_sub:function(c){return this.x-=c.x,this.y-=c.y,this},_mult:function(c){return this.x*=c,this.y*=c,this},_div:function(c){return this.x/=c,this.y/=c,this},_multByPoint:function(c){return this.x*=c.x,this.y*=c.y,this},_divByPoint:function(c){return this.x/=c.x,this.y/=c.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var c=this.y;return this.y=this.x,this.x=-c,this},_rotate:function(c){var f=Math.cos(c),v=Math.sin(c),S=v*this.x+f*this.y;return this.x=f*this.x-v*this.y,this.y=S,this},_rotateAround:function(c,f){var v=Math.cos(c),S=Math.sin(c),x=f.y+S*(this.x-f.x)+v*(this.y-f.y);return this.x=f.x+v*(this.x-f.x)-S*(this.y-f.y),this.y=x,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},g.convert=function(c){return c instanceof g?c:Array.isArray(c)?new g(c[0],c[1]):c},Bn}var St=h(cn());function Jt(g,c){if(Array.isArray(g)){if(!Array.isArray(c)||g.length!==c.length)return!1;for(let f=0;f<g.length;f++)if(!Jt(g[f],c[f]))return!1;return!0}if(typeof g=="object"&&g!==null&&c!==null){if(typeof c!="object"||Object.keys(g).length!==Object.keys(c).length)return!1;for(const f in g)if(!Jt(g[f],c[f]))return!1;return!0}return g===c}const kn=Math.PI/180,Vn=180/Math.PI;function sn(g){return g*kn}function ot(g){return g*Vn}const Ue=[[0,0],[1,0],[1,1],[0,1]];function $t(g){if(g<=0)return 0;if(g>=1)return 1;const c=g*g,f=c*g;return 4*(g<.5?f:3*(g-c)+f-.75)}function An(g,c,f,v){const S=new mn(g,c,f,v);return function(x){return S.solve(x)}}const Sn=An(.25,.1,.25,1);function jt(g,c,f){return Math.min(f,Math.max(c,g))}function mr(g,c,f){return(f=jt((f-g)/(c-g),0,1))*f*(3-2*f)}function Un(g,c,f){const v=f-c,S=((g-c)%v+v)%v+c;return S===c?f:S}function tr(g,c,f){if(!g.length)return f(null,[]);let v=g.length;const S=new Array(g.length);let x=null;g.forEach((A,D)=>{c(A,(U,H)=>{U&&(x=U),S[D]=H,--v==0&&f(x,S)})})}function Sr(g,...c){for(const f of c)for(const v in f)g[v]=f[v];return g}let Ln=1;function ir(){return Ln++}function ci(g){return g<=1?1:Math.pow(2,Math.ceil(Math.log(g)/Math.LN2))}function Fr(g,c){g.forEach(f=>{c[f]&&(c[f]=c[f].bind(c))})}function or(g,c){return g.indexOf(c,g.length-c.length)!==-1}function Nr(g,c,f){const v={};for(const S in g)v[S]=c.call(this,g[S],S,g);return v}function Hr(g,c,f){const v={};for(const S in g)c.call(this,g[S],S,g)&&(v[S]=g[S]);return v}function _i(g){return Array.isArray(g)?g.map(_i):typeof g=="object"&&g?Nr(g,_i):g}const Fe={};function Lt(g){Fe[g]||(typeof console<"u"&&console.warn(g),Fe[g]=!0)}function Kt(g,c,f){return(f.y-g.y)*(c.x-g.x)>(c.y-g.y)*(f.x-g.x)}function un(g){let c=0;for(let f,v,S=0,x=g.length,A=x-1;S<x;A=S++)f=g[S],v=g[A],c+=(v.x-f.x)*(f.y+v.y);return c}function En([g,c,f]){const v=sn(c+90),S=sn(f);return{x:g*Math.cos(v)*Math.sin(S),y:g*Math.sin(v)*Math.sin(S),z:g*Math.cos(S),azimuthal:c,polar:f}}function Ar(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Gr(g){const c={};if(g.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(f,v,S,x)=>{const A=S||x;return c[v]=!A||A.toLowerCase(),""}),c["max-age"]){const f=parseInt(c["max-age"],10);isNaN(f)?delete c["max-age"]:c["max-age"]=f}return c}let cs,Rs=null;function ui(g,c){return[g[4*c],g[4*c+1],g[4*c+2],g[4*c+3]]}function Tt(g,c,f,v){for(;c<f;){const S=c+f>>1;g[S]<v?c=S+1:f=S}return c}function xe(g,c,f,v){for(;c<f;){const S=c+f>>1;g[S]<=v?c=S+1:f=S}return c}function Ce(g){return g>0?1/(1.001-g):1+g}function We(g){return g>0?1-1/(1.001-g):-g}const nt={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(cs==null){const g=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{cs=t.API_URL_REGEX!=null?new RegExp(t.API_URL_REGEX):g}catch{cs=g}}return cs},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!nt.API_URL)return null;try{const g=new URL(nt.API_URL);return g.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":g.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Je(g){return nt.API_URL_REGEX.test(g)}function pt(g){return nt.API_SPRITE_REGEX.test(g)}let Rt,gt,Pt,zt,Bt,ln;function Mn(){return Rt==null&&(Rt=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Rt}const Cn={now:()=>zt!==void 0?zt:performance.now(),setNow(g){zt=g},restoreNow(){zt=void 0},frame(g){const c=requestAnimationFrame(g);return{cancel:()=>cancelAnimationFrame(c)}},getImageData(g,c=0){const{width:f,height:v}=g;Bt||(Bt=document.createElement("canvas"));const S=Bt.getContext("2d",{willReadFrequently:!0});if(!S)throw new Error("failed to create canvas 2d context");return(f>Bt.width||v>Bt.height)&&(Bt.width=f,Bt.height=v),S.clearRect(-c,-c,f+2*c,v+2*c),S.drawImage(g,0,0,f,v),S.getImageData(-c,-c,f+2*c,v+2*c)},resolveURL:g=>(gt||(gt=document.createElement("a")),gt.href=g,gt.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Pt==null&&(Pt=window.matchMedia("(prefers-reduced-motion: reduce)")),Pt.matches)},hasCanvasFingerprintNoise(){if(ln!==void 0)return ln;if(!Mn())return ln=!1,!1;const g=new OffscreenCanvas(85,1),c=g.getContext("2d",{willReadFrequently:!0});let f=0;for(let S=0;S<g.width;++S)c.fillStyle=`rgba(${f++},${f++},${f++}, 255)`,c.fillRect(S,0,1,1);const v=c.getImageData(0,0,g.width,g.height);f=0;for(let S=0;S<v.data.length;++S)if(S%4!=3&&f++!==v.data[S])return ln=!0,!0;return ln=!1,!1}};function Ve(g,c){const f=g.indexOf("?");if(f<0)return`${g}?${new URLSearchParams(c).toString()}`;const v=new URLSearchParams(g.slice(f));for(const S in c)v.set(S,c[S]);return`${g.slice(0,f)}?${v.toString()}`}function yt(g,c={persistentParams:[]}){const f=g.indexOf("?");if(f<0)return g;const v=new URLSearchParams,S=new URLSearchParams(g.slice(f));for(const A of c.persistentParams){const D=S.get(A);D&&v.set(A,D)}const x=v.toString();return`${g.slice(0,f)}${x.length>0?`?${x}`:""}`}const Mt="mapbox-tiles";let Ct=500,It=50;const wn=["language","worldview","jobid"];let _n,zn;function Xn(){try{return caches}catch{}}function lr(){const g=Xn();g&&_n==null&&(_n=g.open(Mt))}let gr=1/0;const dr={supported:!1,testSupport:function(g){!Gi&&Bi&&(ws?Qn(g):hi=g)}};let hi,Bi,Gi=!1,ws=!1;const Er=typeof self<"u"?self:{};function Qn(g){const c=g.createTexture();g.bindTexture(g.TEXTURE_2D,c);try{if(g.texImage2D(g.TEXTURE_2D,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,Bi),g.isContextLost())return;dr.supported=!0}catch{}g.deleteTexture(c),Gi=!0}Er.document&&(Bi=Er.document.createElement("img"),Bi.onload=function(){hi&&Qn(hi),hi=null,ws=!0},Bi.onerror=function(){Gi=!0,hi=null},Bi.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const qi={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(qi);class qr extends Error{constructor(c,f,v){f===401&&Je(v)&&(c+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(c),this.status=f,this.url=v}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const gs=Ar()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Wo=function(g,c){if(!(/^file:/.test(f=g.url)||/^file:/.test(gs())&&!/^\w+:/.test(f))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(v,S){const x=new AbortController,A=new Request(v.url,{method:v.method||"GET",body:v.body,credentials:v.credentials,headers:v.headers,referrer:gs(),referrerPolicy:v.referrerPolicy,signal:x.signal});let D=!1,U=!1;const H=(R=A.url).indexOf("sku=")>0&&Je(R);var R;v.type==="json"&&A.headers.set("Accept","application/json");const N=(z,V,X)=>{if(U)return;if(z&&z.message!=="SecurityError"&&Lt(z.toString()),V&&X)return G(V);const K=Date.now();fetch(A).then(ee=>{if(ee.ok){const ce=H?ee.clone():null;return G(ee,ce,K)}return S(new qr(ee.statusText,ee.status,v.url))}).catch(ee=>{ee.name!=="AbortError"&&S(new Error(`${ee.message} ${v.url}`))})},G=(z,V,X)=>{(v.type==="arrayBuffer"?z.arrayBuffer():v.type==="json"?z.json():z.text()).then(K=>{U||(V&&X&&function(ee,ce,he){if(lr(),_n==null)return;const ne=Gr(ce.headers.get("Cache-Control")||"");if(ne["no-store"])return;const de={status:ce.status,statusText:ce.statusText,headers:new Headers};ce.headers.forEach((Be,Oe)=>de.headers.set(Oe,Be)),ne["max-age"]&&de.headers.set("Expires",new Date(he+1e3*ne["max-age"]).toUTCString());const ge=de.headers.get("Expires");if(!ge||new Date(ge).getTime()-he<42e4)return;let Me=yt(ee.url,{persistentParams:wn});if(ce.status===206){const Be=ee.headers.get("Range");if(!Be)return;de.status=200,Me=Ve(Me,{range:Be})}(function(Be,Oe){if(zn===void 0)try{new Response(new ReadableStream),zn=!0}catch{zn=!1}zn?Oe(Be.body):Be.blob().then(Oe)})(ce,Be=>{const Oe=new Response((Ie=ce.status)!==200&&Ie!==404&&[101,103,204,205,304].includes(Ie)?null:Be,de);var Ie;lr(),_n!=null&&_n.then(Ye=>Ye.put(Me,Oe)).catch(Ye=>Lt(Ye.message))})}(A,V,X),D=!0,S(null,K,z.headers.get("Cache-Control"),z.headers.get("Expires")))}).catch(K=>{U||S(new Error(K.message))})};return H?function(z,V){if(lr(),_n==null)return V(null);_n.then(X=>{let K=yt(z.url,{persistentParams:wn});const ee=z.headers.get("Range");ee&&(K=Ve(K,{range:ee})),X.match(K).then(ce=>{const he=function(ne){if(!ne)return!1;const de=new Date(ne.headers.get("Expires")||0),ge=Gr(ne.headers.get("Cache-Control")||"");return de>Date.now()&&!ge["no-cache"]}(ce);X.delete(K),he&&X.put(K,ce.clone()),V(null,ce,he)}).catch(V)}).catch(V)}(A,N):N(null,null),{cancel:()=>{U=!0,D||x.abort()}}}(g,c);if(Ar()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",g,c,void 0,!0)}var f;return function(v,S){const x=new XMLHttpRequest;x.open(v.method||"GET",v.url,!0),v.type==="arrayBuffer"&&(x.responseType="arraybuffer");for(const A in v.headers)x.setRequestHeader(A,v.headers[A]);return v.type==="json"&&(x.responseType="text",x.setRequestHeader("Accept","application/json")),x.withCredentials=v.credentials==="include",x.onerror=()=>{S(new Error(x.statusText))},x.onload=()=>{if((x.status>=200&&x.status<300||x.status===0)&&x.response!==null){let A=x.response;if(v.type==="json")try{A=JSON.parse(x.response)}catch(D){return S(D)}S(null,A,x.getResponseHeader("Cache-Control"),x.getResponseHeader("Expires"))}else S(new qr(x.statusText,x.status,v.url))},x.send(v.body),{cancel:()=>x.abort()}}(g,c)},Ps=function(g,c){return Wo(Sr(g,{type:"arrayBuffer"}),c)};function us(g){const c=document.createElement("a");return c.href=g,c.protocol===location.protocol&&c.host===location.host}const Ri="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let so,Ro;so=[],Ro=0;const Ss=function(g,c){if(dr.supported&&(g.headers||(g.headers={}),g.headers.accept="image/webp,*/*"),Ro>=nt.MAX_PARALLEL_IMAGE_REQUESTS){const x={requestParameters:g,callback:c,cancelled:!1,cancel(){this.cancelled=!0}};return so.push(x),x}Ro++;let f=!1;const v=()=>{if(!f)for(f=!0,Ro--;so.length&&Ro<nt.MAX_PARALLEL_IMAGE_REQUESTS;){const x=so.shift(),{requestParameters:A,callback:D,cancelled:U}=x;U||(x.cancel=Ss(A,D).cancel)}},S=Ps(g,(x,A,D,U)=>{v(),x?c(x):A&&(self.createImageBitmap?function(H,R){const N=new Blob([new Uint8Array(H)],{type:"image/png"});createImageBitmap(N).then(G=>{R(null,G)}).catch(G=>{R(new Error(`Could not load image because of ${G.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(A,(H,R)=>c(H,R,D,U)):function(H,R){const N=new Image;N.onload=()=>{R(null,N),URL.revokeObjectURL(N.src),N.onload=null,requestAnimationFrame(()=>{N.src=Ri})},N.onerror=()=>R(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const G=new Blob([new Uint8Array(H)],{type:"image/png"});N.src=H.byteLength?URL.createObjectURL(G):Ri}(A,(H,R)=>c(H,R,D,U)))});return{cancel:()=>{S.cancel(),v()}}};var Dc,Ia,sd,Bc={exports:{}},rg={exports:{}},bp={exports:{}},ig=function(){if(sd)return Bc.exports;sd=1;var g=(Dc||(Dc=1,rg.exports=function(f,v){var S,x,A,D,U,H,R,N;for(x=f.length-(S=3&f.length),A=v,U=3432918353,H=461845907,N=0;N<x;)R=255&f.charCodeAt(N)|(255&f.charCodeAt(++N))<<8|(255&f.charCodeAt(++N))<<16|(255&f.charCodeAt(++N))<<24,++N,A=27492+(65535&(D=5*(65535&(A=(A^=R=(65535&(R=(R=(65535&R)*U+(((R>>>16)*U&65535)<<16)&4294967295)<<15|R>>>17))*H+(((R>>>16)*H&65535)<<16)&4294967295)<<13|A>>>19))+((5*(A>>>16)&65535)<<16)&4294967295))+((58964+(D>>>16)&65535)<<16);switch(R=0,S){case 3:R^=(255&f.charCodeAt(N+2))<<16;case 2:R^=(255&f.charCodeAt(N+1))<<8;case 1:A^=R=(65535&(R=(R=(65535&(R^=255&f.charCodeAt(N)))*U+(((R>>>16)*U&65535)<<16)&4294967295)<<15|R>>>17))*H+(((R>>>16)*H&65535)<<16)&4294967295}return A^=f.length,A=2246822507*(65535&(A^=A>>>16))+((2246822507*(A>>>16)&65535)<<16)&4294967295,A=3266489909*(65535&(A^=A>>>13))+((3266489909*(A>>>16)&65535)<<16)&4294967295,(A^=A>>>16)>>>0}),rg.exports),c=(Ia||(Ia=1,bp.exports=function(f,v){for(var S,x=f.length,A=v^x,D=0;x>=4;)S=1540483477*(65535&(S=255&f.charCodeAt(D)|(255&f.charCodeAt(++D))<<8|(255&f.charCodeAt(++D))<<16|(255&f.charCodeAt(++D))<<24))+((1540483477*(S>>>16)&65535)<<16),A=1540483477*(65535&A)+((1540483477*(A>>>16)&65535)<<16)^(S=1540483477*(65535&(S^=S>>>24))+((1540483477*(S>>>16)&65535)<<16)),x-=4,++D;switch(x){case 3:A^=(255&f.charCodeAt(D+2))<<16;case 2:A^=(255&f.charCodeAt(D+1))<<8;case 1:A=1540483477*(65535&(A^=255&f.charCodeAt(D)))+((1540483477*(A>>>16)&65535)<<16)}return A=1540483477*(65535&(A^=A>>>13))+((1540483477*(A>>>16)&65535)<<16),(A^=A>>>15)>>>0}),bp.exports);return Bc.exports=g,Bc.exports.murmur3=g,Bc.exports.murmur2=c,Bc.exports}(),Xo=h(ig);class Yl{constructor(c,...f){Sr(this,f[0]||{}),this.type=c}}class wp extends Yl{constructor(c,f={}){super("error",Sr({error:c},f))}}function od(g,c,f){f[g]&&f[g].indexOf(c)!==-1||(f[g]=f[g]||[],f[g].push(c))}function Sp(g,c,f){if(f&&f[g]){const v=f[g].indexOf(c);v!==-1&&f[g].splice(v,1)}}class zu{on(c,f){return this._listeners=this._listeners||{},od(c,f,this._listeners),this}off(c,f){return Sp(c,f,this._listeners),Sp(c,f,this._oneTimeListeners),this}once(c,f){return f?(this._oneTimeListeners=this._oneTimeListeners||{},od(c,f,this._oneTimeListeners),this):new Promise(v=>this.once(c,v))}fire(c,f){const v=typeof c=="string"?new Yl(c,f):c,S=v.type;if(this.listens(S)){v.target=this;const x=this._listeners&&this._listeners[S]?this._listeners[S].slice():[];for(const U of x)U.call(this,v);const A=this._oneTimeListeners&&this._oneTimeListeners[S]?this._oneTimeListeners[S].slice():[];for(const U of A)Sp(S,U,this._oneTimeListeners),U.call(this,v);const D=this._eventedParent;D&&(Sr(v,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),D.fire(v))}else v instanceof wp&&console.error(v.error);return this}listens(c){return!!(this._listeners&&this._listeners[c]&&this._listeners[c].length>0||this._oneTimeListeners&&this._oneTimeListeners[c]&&this._oneTimeListeners[c].length>0||this._eventedParent&&this._eventedParent.listens(c))}setEventedParent(c,f){return this._eventedParent=c,this._eventedParentData=f,this}}var Nh,ii={},Ap=function(){if(Nh)return ii;Nh=1;var g={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function c(x){return(x=Math.round(x))<0?0:x>255?255:x}function f(x){return c(x[x.length-1]==="%"?parseFloat(x)/100*255:parseInt(x))}function v(x){return(A=x[x.length-1]==="%"?parseFloat(x)/100:parseFloat(x))<0?0:A>1?1:A;var A}function S(x,A,D){return D<0?D+=1:D>1&&(D-=1),6*D<1?x+(A-x)*D*6:2*D<1?A:3*D<2?x+(A-x)*(2/3-D)*6:x}try{ii.parseCSSColor=function(x){var A,D=x.replace(/ /g,"").toLowerCase();if(D in g)return g[D].slice();if(D[0]==="#")return D.length===4?(A=parseInt(D.substr(1),16))>=0&&A<=4095?[(3840&A)>>4|(3840&A)>>8,240&A|(240&A)>>4,15&A|(15&A)<<4,1]:null:D.length===7&&(A=parseInt(D.substr(1),16))>=0&&A<=16777215?[(16711680&A)>>16,(65280&A)>>8,255&A,1]:null;var U=D.indexOf("("),H=D.indexOf(")");if(U!==-1&&H+1===D.length){var R=D.substr(0,U),N=D.substr(U+1,H-(U+1)).split(","),G=1;switch(R){case"rgba":if(N.length!==4)return null;G=v(N.pop());case"rgb":return N.length!==3?null:[f(N[0]),f(N[1]),f(N[2]),G];case"hsla":if(N.length!==4)return null;G=v(N.pop());case"hsl":if(N.length!==3)return null;var z=(parseFloat(N[0])%360+360)%360/360,V=v(N[1]),X=v(N[2]),K=X<=.5?X*(V+1):X+V-X*V,ee=2*X-K;return[c(255*S(ee,K,z+1/3)),c(255*S(ee,K,z)),c(255*S(ee,K,z-1/3)),G];default:return null}}return null}}catch{}return ii}();class vr{constructor(c,f,v,S=1){this.r=c,this.g=f,this.b=v,this.a=S}static parse(c){if(!c)return;if(c instanceof vr)return c;if(typeof c!="string")return;const f=Ap.parseCSSColor(c);return f?new vr(f[0]/255*f[3],f[1]/255*f[3],f[2]/255*f[3],f[3]):void 0}toString(){const[c,f,v,S]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(c)},${Math.round(f)},${Math.round(v)},${S})`}toRenderColor(c){const{r:f,g:v,b:S,a:x}=this;return new xx(c,f,v,S,x)}}class xx{constructor(c,f,v,S,x){if(c){const A=c.image.height,D=A*A;f=x===0?0:f/x*(A-1),v=x===0?0:v/x*(A-1),S=x===0?0:S/x*(A-1);const U=Math.floor(f),H=Math.floor(v),R=Math.floor(S),N=Math.ceil(f),G=Math.ceil(v),z=Math.ceil(S),V=f-U,X=v-H,K=S-R,ee=c.image.data,ce=4*(U+H*D+R*A),he=4*(U+H*D+z*A),ne=4*(U+G*D+R*A),de=4*(U+G*D+z*A),ge=4*(N+H*D+R*A),Me=4*(N+H*D+z*A),Be=4*(N+G*D+R*A),Oe=4*(N+G*D+z*A);if(ce<0||Oe>=ee.length)throw new Error("out of range");this.r=cr(cr(cr(ee[ce],ee[he],K),cr(ee[ne],ee[de],K),X),cr(cr(ee[ge],ee[Me],K),cr(ee[Be],ee[Oe],K),X),V)/255*x,this.g=cr(cr(cr(ee[ce+1],ee[he+1],K),cr(ee[ne+1],ee[de+1],K),X),cr(cr(ee[ge+1],ee[Me+1],K),cr(ee[Be+1],ee[Oe+1],K),X),V)/255*x,this.b=cr(cr(cr(ee[ce+2],ee[he+2],K),cr(ee[ne+2],ee[de+2],K),X),cr(cr(ee[ge+2],ee[Me+2],K),cr(ee[Be+2],ee[Oe+2],K),X),V)/255*x,this.a=x}else this.r=f,this.g=v,this.b=S,this.a=x}toArray(){const{r:c,g:f,b:v,a:S}=this;return S===0?[0,0,0,0]:[255*c/S,255*f/S,255*v/S,S]}toArray01(){const{r:c,g:f,b:v,a:S}=this;return S===0?[0,0,0,0]:[c/S,f/S,v/S,S]}toArray01Scaled(c){const{r:f,g:v,b:S,a:x}=this;return x===0?[0,0,0]:[f/x*c,v/x*c,S/x*c]}toArray01PremultipliedAlpha(){const{r:c,g:f,b:v,a:S}=this;return[c,f,v,S]}toArray01Linear(){const{r:c,g:f,b:v,a:S}=this;return S===0?[0,0,0,0]:[Math.pow(c/S,2.2),Math.pow(f/S,2.2),Math.pow(v/S,2.2),S]}}function cr(g,c,f){return g*(1-f)+c*f}function ad(g,c,f){return g.map((v,S)=>cr(v,c[S],f))}vr.black=new vr(0,0,0,1),vr.white=new vr(1,1,1,1),vr.transparent=new vr(0,0,0,0),vr.red=new vr(1,0,0,1),vr.blue=new vr(0,0,1,1);var zh=Object.freeze({__proto__:null,array:ad,color:function(g,c,f){return new vr(cr(g.r,c.r,f),cr(g.g,c.g,f),cr(g.b,c.b,f),cr(g.a,c.a,f))},number:cr});function ld(g,...c){for(const f of c)for(const v in f)g[v]=f[v];return g}class ys extends Error{constructor(c,f){super(f),this.message=f,this.key=c}}class cd{constructor(c,f=[]){this.parent=c,this.bindings={};for(const[v,S]of f)this.bindings[v]=S}concat(c){return new cd(this,c)}get(c){if(this.bindings[c])return this.bindings[c];if(this.parent)return this.parent.get(c);throw new Error(`${c} not found in scope.`)}has(c){return!!this.bindings[c]||!!this.parent&&this.parent.has(c)}}const Kl={kind:"null"},On={kind:"number"},ei={kind:"string"},Zr={kind:"boolean"},zs={kind:"color"},ma={kind:"object"},ni={kind:"value"},ol={kind:"collator"},Xa={kind:"formatted"},fu={kind:"resolvedImage"};function ia(g,c){return{kind:"array",itemType:g,N:c}}function As(g){if(g.kind==="array"){const c=As(g.itemType);return typeof g.N=="number"?`array<${c}, ${g.N}>`:g.itemType.kind==="value"?"array":`array<${c}>`}return g.kind}const bx=[Kl,On,ei,Zr,zs,Xa,ma,ia(ni),fu];function Ra(g,c){if(c.kind==="error")return null;if(g.kind==="array"){if(c.kind==="array"&&(c.N===0&&c.itemType.kind==="value"||!Ra(g.itemType,c.itemType))&&(typeof g.N!="number"||g.N===c.N))return null}else{if(g.kind===c.kind)return null;if(g.kind==="value"){for(const f of bx)if(!Ra(f,c))return null}}return`Expected ${As(g)} but found ${As(c)} instead.`}function ud(g,c){return c.some(f=>f.kind===g.kind)}function al(g,c){return c.some(f=>f==="null"?g===null:f==="array"?Array.isArray(g):f==="object"?g&&!Array.isArray(g)&&typeof g=="object":f===typeof g)}class sg{constructor(c,f,v){this.sensitivity=c?f?"variant":"case":f?"accent":"base",this.locale=v,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(c,f){return this.collator.compare(c,f)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Us{constructor(c,f,v,S,x){this.text=c.normalize?c.normalize():c,this.image=f,this.scale=v,this.fontStack=S,this.textColor=x}}class Po{constructor(c){this.sections=c}static fromString(c){return new Po([new Us(c,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(c=>c.text.length!==0||c.image&&c.image.namePrimary.length!==0)}static factory(c){return c instanceof Po?c:Po.fromString(c)}toString(){return this.sections.length===0?"":this.sections.map(c=>c.text).join("")}serialize(){const c=["format"];for(const f of this.sections){if(f.image){c.push(["image",f.image.namePrimary]);continue}c.push(f.text);const v={};f.fontStack&&(v["text-font"]=["literal",f.fontStack.split(",")]),f.scale&&(v["font-scale"]=f.scale),f.textColor&&(v["text-color"]=["rgba"].concat(f.textColor.toRenderColor(null).toArray())),c.push(v)}return c}}class $o{constructor(c){this.namePrimary=c.namePrimary,c.nameSecondary&&(this.nameSecondary=c.nameSecondary),this.available=c.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(c,f){return c?new $o({namePrimary:c,nameSecondary:f,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function Uh(g,c,f,v){return typeof g=="number"&&g>=0&&g<=255&&typeof c=="number"&&c>=0&&c<=255&&typeof f=="number"&&f>=0&&f<=255?v===void 0||typeof v=="number"&&v>=0&&v<=1?null:`Invalid rgba value [${[g,c,f,v].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof v=="number"?[g,c,f,v]:[g,c,f]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function kc(g){if(g===null||typeof g=="string"||typeof g=="boolean"||typeof g=="number"||g instanceof vr||g instanceof sg||g instanceof Po||g instanceof $o)return!0;if(Array.isArray(g)){for(const c of g)if(!kc(c))return!1;return!0}if(typeof g=="object"){for(const c in g)if(!kc(g[c]))return!1;return!0}return!1}function Ls(g){if(g===null)return Kl;if(typeof g=="string")return ei;if(typeof g=="boolean")return Zr;if(typeof g=="number")return On;if(g instanceof vr)return zs;if(g instanceof sg)return ol;if(g instanceof Po)return Xa;if(g instanceof $o)return fu;if(Array.isArray(g)){const c=g.length;let f;for(const v of g){const S=Ls(v);if(f){if(f===S)continue;f=ni;break}f=S}return ia(f||ni,c)}return ma}function ga(g){const c=typeof g;return g===null?"":c==="string"||c==="number"||c==="boolean"?String(g):g instanceof vr||g instanceof Po||g instanceof $o?g.toString():JSON.stringify(g)}class ll{constructor(c,f){this.type=c,this.value=f}static parse(c,f){if(c.length!==2)return f.error(`'literal' expression requires exactly one argument, but found ${c.length-1} instead.`);if(!kc(c[1]))return f.error("invalid value");const v=c[1];let S=Ls(v);const x=f.expectedType;return S.kind!=="array"||S.N!==0||!x||x.kind!=="array"||typeof x.N=="number"&&x.N!==0||(S=x),new ll(S,v)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof vr?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof Po?this.value.serialize():this.value}}class $s{constructor(c){this.name="ExpressionEvaluationError",this.message=c}toJSON(){return this.message}}const Uu={string:ei,number:On,boolean:Zr,object:ma};class qs{constructor(c,f){this.type=c,this.args=f}static parse(c,f){if(c.length<2)return f.error("Expected at least one argument.");let v,S=1;const x=c[0];if(x==="array"){let D,U;if(c.length>2){const H=c[1];if(typeof H!="string"||!(H in Uu)||H==="object")return f.error('The item type argument of "array" must be one of string, number, boolean',1);D=Uu[H],S++}else D=ni;if(c.length>3){if(c[2]!==null&&(typeof c[2]!="number"||c[2]<0||c[2]!==Math.floor(c[2])))return f.error('The length argument to "array" must be a positive integer literal',2);U=c[2],S++}v=ia(D,U)}else v=Uu[x];const A=[];for(;S<c.length;S++){const D=f.parse(c[S],S,ni);if(!D)return null;A.push(D)}return new qs(v,A)}evaluate(c){for(let f=0;f<this.args.length;f++){const v=this.args[f].evaluate(c);if(!Ra(this.type,Ls(v)))return v;if(f===this.args.length-1)throw new $s(`The expression ${JSON.stringify(this.args[f].serialize())} evaluated to ${As(Ls(v))} but was expected to be of type ${As(this.type)}.`)}return null}eachChild(c){this.args.forEach(c)}outputDefined(){return this.args.every(c=>c.outputDefined())}serialize(){const c=this.type,f=[c.kind];if(c.kind==="array"){const v=c.itemType;if(v.kind==="string"||v.kind==="number"||v.kind==="boolean"){f.push(v.kind);const S=c.N;(typeof S=="number"||this.args.length>1)&&f.push(S)}}return f.concat(this.args.map(v=>v.serialize()))}}class Pa{constructor(c){this.type=Xa,this.sections=c}static parse(c,f){if(c.length<2)return f.error("Expected at least one argument.");const v=c[1];if(!Array.isArray(v)&&typeof v=="object")return f.error("First argument must be an image or text section.");const S=[];let x=!1;for(let A=1;A<=c.length-1;++A){const D=c[A];if(x&&typeof D=="object"&&!Array.isArray(D)){x=!1;let U=null;if(D["font-scale"]&&(U=f.parseObjectValue(D["font-scale"],A,"font-scale",On),!U))return null;let H=null;if(D["text-font"]&&(H=f.parseObjectValue(D["text-font"],A,"text-font",ia(ei)),!H))return null;let R=null;if(D["text-color"]&&(R=f.parseObjectValue(D["text-color"],A,"text-color",zs),!R))return null;const N=S[S.length-1];N.scale=U,N.font=H,N.textColor=R}else{const U=f.parse(c[A],A,ni);if(!U)return null;const H=U.type.kind;if(H!=="string"&&H!=="value"&&H!=="null"&&H!=="resolvedImage")return f.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");x=!0,S.push({content:U,scale:null,font:null,textColor:null})}}return new Pa(S)}evaluate(c){return new Po(this.sections.map(f=>{const v=f.content.evaluate(c);return Ls(v)===fu?new Us("",v,null,null,null):new Us(ga(v),null,f.scale?f.scale.evaluate(c):null,f.font?f.font.evaluate(c).join(","):null,f.textColor?f.textColor.evaluate(c):null)}))}eachChild(c){for(const f of this.sections)c(f.content),f.scale&&c(f.scale),f.font&&c(f.font),f.textColor&&c(f.textColor)}outputDefined(){return!1}serialize(){const c=["format"];for(const f of this.sections){c.push(f.content.serialize());const v={};f.scale&&(v["font-scale"]=f.scale.serialize()),f.font&&(v["text-font"]=f.font.serialize()),f.textColor&&(v["text-color"]=f.textColor.serialize()),c.push(v)}return c}}class $a{constructor(c,f){this.type=fu,this.inputPrimary=c,this.inputSecondary=f}static parse(c,f){if(c.length<2)return f.error("Expected two or more arguments.");const v=f.parse(c[1],1,ei);if(!v)return f.error("No image name provided.");if(c.length===2)return new $a(v);const S=f.parse(c[2],1,ei);return S?new $a(v,S):f.error("Secondary image variant is not a string.")}evaluate(c){const f=$o.fromString(this.inputPrimary.evaluate(c),this.inputSecondary?this.inputSecondary.evaluate(c):void 0);return f&&c.availableImages&&(f.available=c.availableImages.indexOf(f.namePrimary)>-1,f.nameSecondary&&f.available&&c.availableImages&&(f.available=c.availableImages.indexOf(f.nameSecondary)>-1)),f}eachChild(c){c(this.inputPrimary),this.inputSecondary&&c(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function du(g){return g instanceof Number?"number":g instanceof String?"string":g instanceof Boolean?"boolean":Array.isArray(g)?"array":g===null?"null":typeof g}const Tp={"to-boolean":Zr,"to-color":zs,"to-number":On,"to-string":ei};class sa{constructor(c,f){this.type=c,this.args=f}static parse(c,f){if(c.length<2)return f.error("Expected at least one argument.");const v=c[0],S=[];let x=Kl;if(v==="to-array"){if(!Array.isArray(c[1]))return null;const A=c[1].length;if(f.expectedType){if(f.expectedType.kind!=="array")return f.error(`Expected ${f.expectedType.kind} but found array.`);x=ia(f.expectedType.itemType,A)}else{if(!(A>0&&kc(c[1][0])))return null;x=ia(Ls(c[1][0]),A)}for(let D=0;D<A;D++){const U=c[1][D];let H;if(du(U)==="array")H=f.parse(U,void 0,x.itemType);else{const R=du(U);if(R!==x.itemType.kind)return f.error(`Expected ${x.itemType.kind} but found ${R}.`);H=f.registry.literal.parse(["literal",U===void 0?null:U],f)}if(!H)return null;S.push(H)}}else{if((v==="to-boolean"||v==="to-string")&&c.length!==2)return f.error("Expected one argument.");x=Tp[v];for(let A=1;A<c.length;A++){const D=f.parse(c[A],A,ni);if(!D)return null;S.push(D)}}return new sa(x,S)}evaluate(c){if(this.type.kind==="boolean")return!!this.args[0].evaluate(c);if(this.type.kind==="color"){let f,v;for(const S of this.args){if(f=S.evaluate(c),v=null,f instanceof vr)return f;if(typeof f=="string"){const x=c.parseColor(f);if(x)return x}else if(Array.isArray(f)&&(v=f.length<3||f.length>4?`Invalid rbga value ${JSON.stringify(f)}: expected an array containing either three or four numeric values.`:Uh(f[0],f[1],f[2],f[3]),!v))return new vr(f[0]/255,f[1]/255,f[2]/255,f[3])}throw new $s(v||`Could not parse color from value '${typeof f=="string"?f:String(JSON.stringify(f))}'`)}if(this.type.kind==="number"){let f=null;for(const v of this.args){if(f=v.evaluate(c),f===null)return 0;const S=Number(f);if(!isNaN(S))return S}throw new $s(`Could not convert ${JSON.stringify(f)} to number.`)}return this.type.kind==="formatted"?Po.fromString(ga(this.args[0].evaluate(c))):this.type.kind==="resolvedImage"?$o.fromString(ga(this.args[0].evaluate(c))):this.type.kind==="array"?this.args.map(f=>f.evaluate(c)):ga(this.args[0].evaluate(c))}eachChild(c){this.args.forEach(c)}outputDefined(){return this.args.every(c=>c.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Pa([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new $a(this.args[0]).serialize();const c=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(f=>{c.push(f.serialize())}),c}}const Vu=["Unknown","Point","LineString","Polygon"];class Mp{constructor(c,f){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=c,this.options=f}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Vu[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(c){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const c=this.featureDistanceData.center,f=this.featureDistanceData.scale,{x:v,y:S}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(v*f-c[0])+this.featureDistanceData.bearing[1]*(S*f-c[1])}return 0}parseColor(c){let f=this._parseColorCache[c];return f||(f=this._parseColorCache[c]=vr.parse(c)),f}getConfig(c){return this.options?this.options.get(c):null}}class La{constructor(c,f,v,S,x){this.name=c,this.type=f,this._evaluate=v,this.args=S,this._overloadIndex=x}evaluate(c){if(!this._evaluate){const f=La.definitions[this.name];this._evaluate=Array.isArray(f)?f[2]:f.overloads[this._overloadIndex][1]}return this._evaluate(c,this.args)}eachChild(c){this.args.forEach(c)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(c=>c.serialize()))}static parse(c,f){const v=c[0],S=La.definitions[v];if(!S)return f.error(`Unknown expression "${v}". If you wanted a literal array, use ["literal", [...]].`,0);const x=Array.isArray(S)?S[0]:S.type,A=Array.isArray(S)?[[S[1],S[2]]]:S.overloads,D=[];let U=null,H=-1;for(const[R,N]of A){if(Array.isArray(R)&&R.length!==c.length-1)continue;D.push(R),H++,U=new kv(f.registry,f.path,null,f.scope,void 0,f._scope,f.options);const G=[];let z=!1;for(let V=1;V<c.length;V++){const X=c[V],K=Array.isArray(R)?R[V-1]:R.type,ee=U.parse(X,1+G.length,K);if(!ee){z=!0;break}G.push(ee)}if(!z)if(Array.isArray(R)&&R.length!==G.length)U.error(`Expected ${R.length} arguments, but found ${G.length} instead.`);else{for(let V=0;V<G.length;V++){const X=Array.isArray(R)?R[V]:R.type,K=G[V];U.concat(V+1).checkSubtype(X,K.type)}if(U.errors.length===0)return new La(v,x,N,G,H)}}if(D.length===1)f.errors.push(...U.errors);else{const R=(D.length?D:A.map(([G])=>G)).map(og).join(" | "),N=[];for(let G=1;G<c.length;G++){const z=f.parse(c[G],1+N.length);if(!z)return null;N.push(As(z.type))}f.error(`Expected arguments of type ${R}, but found (${N.join(", ")}) instead.`)}return null}static register(c,f){La.definitions=f;for(const v in f)c[v]=La}}function og(g){return Array.isArray(g)?`(${g.map(As).join(", ")})`:`(${As(g.type)}...)`}class Cp{constructor(c,f,v){this.type=ol,this.locale=v,this.caseSensitive=c,this.diacriticSensitive=f}static parse(c,f){if(c.length!==2)return f.error("Expected one argument.");const v=c[1];if(typeof v!="object"||Array.isArray(v))return f.error("Collator options argument must be an object.");const S=v["case-sensitive"]===void 0?f.parse(!1,1,Zr):f.parseObjectValue(v["case-sensitive"],1,"case-sensitive",Zr);if(!S)return null;const x=v["diacritic-sensitive"]===void 0?f.parse(!1,1,Zr):f.parseObjectValue(v["diacritic-sensitive"],1,"diacritic-sensitive",Zr);if(!x)return null;let A=null;return v.locale&&(A=f.parseObjectValue(v.locale,1,"locale",ei),!A)?null:new Cp(S,x,A)}evaluate(c){return new sg(this.caseSensitive.evaluate(c),this.diacriticSensitive.evaluate(c),this.locale?this.locale.evaluate(c):null)}eachChild(c){c(this.caseSensitive),c(this.diacriticSensitive),this.locale&&c(this.locale)}outputDefined(){return!1}serialize(){const c={};return c["case-sensitive"]=this.caseSensitive.serialize(),c["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(c.locale=this.locale.serialize()),["collator",c]}}function Dv(g,c,f=0,v=g.length-1,S=pu){for(;v>f;){if(v-f>600){const U=v-f+1,H=c-f+1,R=Math.log(U),N=.5*Math.exp(2*R/3),G=.5*Math.sqrt(R*N*(U-N)/U)*(H-U/2<0?-1:1);Dv(g,c,Math.max(f,Math.floor(c-H*N/U+G)),Math.min(v,Math.floor(c+(U-H)*N/U+G)),S)}const x=g[c];let A=f,D=v;for(Gu(g,f,c),S(g[v],x)>0&&Gu(g,f,v);A<D;){for(Gu(g,A,D),A++,D--;S(g[A],x)<0;)A++;for(;S(g[D],x)>0;)D--}S(g[f],x)===0?Gu(g,f,D):(D++,Gu(g,D,v)),D<=c&&(f=D+1),c<=D&&(v=D-1)}}function Gu(g,c,f){const v=g[c];g[c]=g[f],g[f]=v}function pu(g,c){return g<c?-1:g>c?1:0}function Sx(g){let c=0;for(let f,v,S=0,x=g.length,A=x-1;S<x;A=S++)f=g[S],v=g[A],c+=(v.x-f.x)*(f.y+v.y);return c}function hd(g,c){g[0]=Math.min(g[0],c[0]),g[1]=Math.min(g[1],c[1]),g[2]=Math.max(g[2],c[0]),g[3]=Math.max(g[3],c[1])}function Hu(g,c){return!(g[0]<=c[0]||g[2]>=c[2]||g[1]<=c[1]||g[3]>=c[3])}function Bv(g,c,f){const v=g[0]-c[0],S=g[1]-c[1],x=g[0]-f[0],A=g[1]-f[1];return v*A-x*S==0&&v*x<=0&&S*A<=0}function Jl(g,c,f=!1){let v=!1;for(let D=0,U=c.length;D<U;D++){const H=c[D];for(let R=0,N=H.length,G=N-1;R<N;G=R++){const z=H[G],V=H[R];if(Bv(g,z,V))return f;(x=z)[1]>(S=g)[1]!=(A=V)[1]>S[1]&&S[0]<(A[0]-x[0])*(S[1]-x[1])/(A[1]-x[1])+x[0]&&(v=!v)}}var S,x,A;return v}function Vh(g,c,f,v){const S=v[0]-f[0],x=v[1]-f[1],A=(g[0]-f[0])*x-S*(g[1]-f[1]),D=(c[0]-f[0])*x-S*(c[1]-f[1]);return A>0&&D<0||A<0&&D>0}function Gh(g,c,f,v){return(S=[v[0]-f[0],v[1]-f[1]])[0]*(x=[c[0]-g[0],c[1]-g[1]])[1]-S[1]*x[0]!=0&&!(!Vh(g,c,f,v)||!Vh(f,v,g,c));var S,x}const va=8192;function Mr(g,c){const f=(180+g[0])/360,v=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+g[1]*Math.PI/360)))/360,S=Math.pow(2,c.z);return[Math.round(f*S*va),Math.round(v*S*va)]}function $n(g,c){for(let f=0;f<c.length;f++)if(Jl(g,c[f]))return!0;return!1}function mu(g,c,f){for(const v of f)for(let S=0,x=v.length,A=x-1;S<x;A=S++)if(Gh(g,c,v[A],v[S]))return!0;return!1}function pr(g,c){for(let f=0;f<g.length;++f)if(!Jl(g[f],c))return!1;for(let f=0;f<g.length-1;++f)if(mu(g[f],g[f+1],c))return!1;return!0}function Ql(g,c){for(let f=0;f<c.length;f++)if(pr(g,c[f]))return!0;return!1}function ec(g,c,f){const v=[];for(let S=0;S<g.length;S++){const x=[];for(let A=0;A<g[S].length;A++){const D=Mr(g[S][A],f);hd(c,D),x.push(D)}v.push(x)}return v}function _r(g,c,f){const v=[];for(let S=0;S<g.length;S++){const x=ec(g[S],c,f);v.push(x)}return v}function Ep(g,c,f,v){if(g[0]<f[0]||g[0]>f[2]){const S=.5*v;let x=g[0]-f[0]>S?-v:f[0]-g[0]>S?v:0;x===0&&(x=g[0]-f[2]>S?-v:f[2]-g[0]>S?v:0),g[0]+=x}hd(c,g)}function fd(g,c,f,v){const S=Math.pow(2,v.z)*va,x=[v.x*va,v.y*va],A=[];if(!g)return A;for(const D of g)for(const U of D){const H=[U.x+x[0],U.y+x[1]];Ep(H,c,f,S),A.push(H)}return A}function Da(g,c,f,v){const S=Math.pow(2,v.z)*va,x=[v.x*va,v.y*va],A=[];if(!g)return A;for(const U of g){const H=[];for(const R of U){const N=[R.x+x[0],R.y+x[1]];hd(c,N),H.push(N)}A.push(H)}if(c[2]-c[0]<=S/2){(D=c)[0]=D[1]=1/0,D[2]=D[3]=-1/0;for(const U of A)for(const H of U)Ep(H,c,f,S)}var D;return A}class yo{constructor(c,f){this.type=Zr,this.geojson=c,this.geometries=f}static parse(c,f){if(c.length!==2)return f.error(`'within' expression requires exactly one argument, but found ${c.length-1} instead.`);if(kc(c[1])){const v=c[1];if(v.type==="FeatureCollection")for(let S=0;S<v.features.length;++S){const x=v.features[S].geometry.type;if(x==="Polygon"||x==="MultiPolygon")return new yo(v,v.features[S].geometry)}else if(v.type==="Feature"){const S=v.geometry.type;if(S==="Polygon"||S==="MultiPolygon")return new yo(v,v.geometry)}else if(v.type==="Polygon"||v.type==="MultiPolygon")return new yo(v,v)}return f.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(c){if(c.geometry()!=null&&c.canonicalID()!=null){if(c.geometryType()==="Point")return function(f,v){const S=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],A=f.canonicalID();if(!A)return!1;if(v.type==="Polygon"){const D=ec(v.coordinates,x,A),U=fd(f.geometry(),S,x,A);if(!Hu(S,x))return!1;for(const H of U)if(!Jl(H,D))return!1}if(v.type==="MultiPolygon"){const D=_r(v.coordinates,x,A),U=fd(f.geometry(),S,x,A);if(!Hu(S,x))return!1;for(const H of U)if(!$n(H,D))return!1}return!0}(c,this.geometries);if(c.geometryType()==="LineString")return function(f,v){const S=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],A=f.canonicalID();if(!A)return!1;if(v.type==="Polygon"){const D=ec(v.coordinates,x,A),U=Da(f.geometry(),S,x,A);if(!Hu(S,x))return!1;for(const H of U)if(!pr(H,D))return!1}if(v.type==="MultiPolygon"){const D=_r(v.coordinates,x,A),U=Da(f.geometry(),S,x,A);if(!Hu(S,x))return!1;for(const H of U)if(!Ql(H,D))return!1}return!0}(c,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const es={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},oo=1/298.257223563,qa=oo*(2-oo),Hh=Math.PI/180;class jh{static fromTile(c,f,v){const S=Math.PI*(1-2*(c+.5)/Math.pow(2,f)),x=Math.atan(.5*(Math.exp(S)-Math.exp(-S)))/Hh;return new jh(x,v)}static get units(){return es}constructor(c,f){if(c===void 0)throw new Error("No latitude given.");if(f&&!es[f])throw new Error(`Unknown unit ${f}. Use one of: ${Object.keys(es).join(", ")}`);const v=6378.137*Hh*(f?es[f]:1),S=Math.cos(c*Hh),x=1/(1-qa*(1-S*S)),A=Math.sqrt(x);this.kx=v*A*S,this.ky=v*A*x*(1-qa)}distance(c,f){const v=vs(c[0]-f[0])*this.kx,S=(c[1]-f[1])*this.ky;return Math.sqrt(v*v+S*S)}bearing(c,f){const v=vs(f[0]-c[0])*this.kx;return Math.atan2(v,(f[1]-c[1])*this.ky)/Hh}destination(c,f,v){const S=v*Hh;return this.offset(c,Math.sin(S)*f,Math.cos(S)*f)}offset(c,f,v){return[c[0]+f/this.kx,c[1]+v/this.ky]}lineDistance(c){let f=0;for(let v=0;v<c.length-1;v++)f+=this.distance(c[v],c[v+1]);return f}area(c){let f=0;for(let v=0;v<c.length;v++){const S=c[v];for(let x=0,A=S.length,D=A-1;x<A;D=x++)f+=vs(S[x][0]-S[D][0])*(S[x][1]+S[D][1])*(v?-1:1)}return Math.abs(f)/2*this.kx*this.ky}along(c,f){let v=0;if(f<=0)return c[0];for(let S=0;S<c.length-1;S++){const x=c[S],A=c[S+1],D=this.distance(x,A);if(v+=D,v>f)return tc(x,A,(f-(v-D))/D)}return c[c.length-1]}pointToSegmentDistance(c,f,v){let[S,x]=f,A=vs(v[0]-S)*this.kx,D=(v[1]-x)*this.ky;if(A!==0||D!==0){const U=(vs(c[0]-S)*this.kx*A+(c[1]-x)*this.ky*D)/(A*A+D*D);U>1?(S=v[0],x=v[1]):U>0&&(S+=A/this.kx*U,x+=D/this.ky*U)}return A=vs(c[0]-S)*this.kx,D=(c[1]-x)*this.ky,Math.sqrt(A*A+D*D)}pointOnLine(c,f){let v=1/0,S=c[0][0],x=c[0][1],A=0,D=0;for(let U=0;U<c.length-1;U++){let H=c[U][0],R=c[U][1],N=vs(c[U+1][0]-H)*this.kx,G=(c[U+1][1]-R)*this.ky,z=0;N===0&&G===0||(z=(vs(f[0]-H)*this.kx*N+(f[1]-R)*this.ky*G)/(N*N+G*G),z>1?(H=c[U+1][0],R=c[U+1][1]):z>0&&(H+=N/this.kx*z,R+=G/this.ky*z)),N=vs(f[0]-H)*this.kx,G=(f[1]-R)*this.ky;const V=N*N+G*G;V<v&&(v=V,S=H,x=R,A=U,D=z)}return{point:[S,x],index:A,t:Math.max(0,Math.min(1,D))}}lineSlice(c,f,v){let S=this.pointOnLine(v,c),x=this.pointOnLine(v,f);if(S.index>x.index||S.index===x.index&&S.t>x.t){const H=S;S=x,x=H}const A=[S.point],D=S.index+1,U=x.index;!dd(v[D],A[0])&&D<=U&&A.push(v[D]);for(let H=D+1;H<=U;H++)A.push(v[H]);return dd(v[U],x.point)||A.push(x.point),A}lineSliceAlong(c,f,v){let S=0;const x=[];for(let A=0;A<v.length-1;A++){const D=v[A],U=v[A+1],H=this.distance(D,U);if(S+=H,S>c&&x.length===0&&x.push(tc(D,U,(c-(S-H))/H)),S>=f)return x.push(tc(D,U,(f-(S-H))/H)),x;S>c&&x.push(U)}return x}bufferPoint(c,f){const v=f/this.ky,S=f/this.kx;return[c[0]-S,c[1]-v,c[0]+S,c[1]+v]}bufferBBox(c,f){const v=f/this.ky,S=f/this.kx;return[c[0]-S,c[1]-v,c[2]+S,c[3]+v]}insideBBox(c,f){return vs(c[0]-f[0])>=0&&vs(c[0]-f[2])<=0&&c[1]>=f[1]&&c[1]<=f[3]}}function dd(g,c){return g[0]===c[0]&&g[1]===c[1]}function tc(g,c,f){const v=vs(c[0]-g[0]);return[g[0]+v*f,g[1]+(c[1]-g[1])*f]}function vs(g){for(;g<-180;)g+=360;for(;g>180;)g-=360;return g}class Wh{constructor(c=[],f=(v,S)=>v<S?-1:v>S?1:0){if(this.data=c,this.length=this.data.length,this.compare=f,this.length>0)for(let v=(this.length>>1)-1;v>=0;v--)this._down(v)}push(c){this.data.push(c),this._up(this.length++)}pop(){if(this.length===0)return;const c=this.data[0],f=this.data.pop();return--this.length>0&&(this.data[0]=f,this._down(0)),c}peek(){return this.data[0]}_up(c){const{data:f,compare:v}=this,S=f[c];for(;c>0;){const x=c-1>>1,A=f[x];if(v(S,A)>=0)break;f[c]=A,c=x}f[c]=S}_down(c){const{data:f,compare:v}=this,S=this.length>>1,x=f[c];for(;c<S;){let A=1+(c<<1);const D=A+1;if(D<this.length&&v(f[D],f[A])<0&&(A=D),v(f[A],x)>=0)break;f[c]=f[A],c=A}f[c]=x}}var yn=8192;function ag(g,c){return c.dist-g.dist}const Oc=100,Xh=50;function Ip(g){const c=[1/0,1/0,-1/0,-1/0];if(c.length!==g.length)return!1;for(let f=0;f<c.length;f++)if(c[f]!==g[f])return!1;return!0}function Rp(g){return g[1]-g[0]+1}function Za(g,c){const f=g[1]>=g[0]&&g[1]<c;return f||console.warn("Distance Expression: Index is out of range"),f}function lg(g,c){if(g[0]>g[1])return[null,null];const f=Rp(g);if(c){if(f===2)return[g,null];const v=Math.floor(f/2);return[[g[0],g[0]+v],[g[0]+v,g[1]]]}{if(f===1)return[g,null];const v=Math.floor(f/2)-1;return[[g[0],g[0]+v],[g[0]+v+1,g[1]]]}}function oa(g,c){const f=[1/0,1/0,-1/0,-1/0];if(!Za(c,g.length))return f;for(let v=c[0];v<=c[1];++v)hd(f,g[v]);return f}function Ba(g){const c=[1/0,1/0,-1/0,-1/0];for(let f=0;f<g.length;++f)for(let v=0;v<g[f].length;++v)hd(c,g[f][v]);return c}function Fc(g,c,f){if(Ip(g)||Ip(c))return NaN;let v=0,S=0;return g[2]<c[0]&&(v=c[0]-g[2]),g[0]>c[2]&&(v=g[0]-c[2]),g[1]>c[3]&&(S=g[1]-c[3]),g[3]<c[1]&&(S=c[1]-g[3]),f.distance([0,0],[v,S])}function $h(g){return 360*g-180}function nc(g){return 360/Math.PI*Math.atan(Math.exp((180-360*g)*Math.PI/180))-90}function ka(g,c){const f=Math.pow(2,c.z),v=(g.y/yn+c.y)/f;return[$h((g.x/yn+c.x)/f),nc(v)]}function qh(g,c){const f=[];for(let v=0;v<g.length;++v)f.push(ka(g[v],c));return f}function cg(g,c,f){const v=f.pointOnLine(c,g).point;return f.distance(g,v)}function Pp(g,c,f,v,S){const x=f.slice(v[0],v[1]+1);let A=1/0;for(let D=c[0];D<=c[1];++D)if((A=Math.min(A,cg(g[D],x,S)))===0)return 0;return A}function Ts(g,c,f,v,S){const x=Math.min(S.pointToSegmentDistance(g,f,v),S.pointToSegmentDistance(c,f,v)),A=Math.min(S.pointToSegmentDistance(f,g,c),S.pointToSegmentDistance(v,g,c));return Math.min(x,A)}function Lp(g,c,f,v,S){if(!Za(c,g.length)||!Za(v,f.length))return NaN;let x=1/0;for(let A=c[0];A<c[1];++A)for(let D=v[0];D<v[1];++D){if(Gh(g[A],g[A+1],f[D],f[D+1]))return 0;x=Math.min(x,Ts(g[A],g[A+1],f[D],f[D+1],S))}return x}function ug(g,c,f,v,S){if(!Za(c,g.length)||!Za(v,f.length))return NaN;let x=1/0;for(let A=c[0];A<=c[1];++A)for(let D=v[0];D<=v[1];++D)if((x=Math.min(x,S.distance(g[A],f[D])))===0)return x;return x}function hg(g,c,f){if(Jl(g,c,!0))return 0;let v=1/0;for(const S of c){const x=S.length;if(x<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(S[0]!==S[x-1]&&(v=Math.min(v,f.pointToSegmentDistance(g,S[x-1],S[0])))===0||(v=Math.min(v,cg(g,S,f)))===0)return v}return v}function Dp(g,c,f,v){if(!Za(c,g.length))return NaN;for(let x=c[0];x<=c[1];++x)if(Jl(g[x],f,!0))return 0;let S=1/0;for(let x=c[0];x<c[1];++x)for(const A of f)for(let D=0,U=A.length,H=U-1;D<U;H=D++){if(Gh(g[x],g[x+1],A[H],A[D]))return 0;S=Math.min(S,Ts(g[x],g[x+1],A[H],A[D],v))}return S}function Ya(g,c){for(const f of g)for(let v=0;v<=f.length-1;++v)if(Jl(f[v],c,!0))return!0;return!1}function Zh(g,c,f,v=1/0){const S=Ba(g),x=Ba(c);if(v!==1/0&&Fc(S,x,f)>=v)return v;if(Hu(S,x)){if(Ya(g,c))return 0}else if(Ya(c,g))return 0;let A=v;for(const D of g)for(let U=0,H=D.length,R=H-1;U<H;R=U++)for(const N of c)for(let G=0,z=N.length,V=z-1;G<z;V=G++){if(Gh(D[R],D[U],N[V],N[G]))return 0;A=Math.min(A,Ts(D[R],D[U],N[V],N[G],f))}return A}function Ms(g,c,f,v,S,x,A){if(x===null||A===null)return;const D=Fc(oa(v,x),oa(S,A),f);D<c&&g.push({dist:D,range1:x,range2:A})}function Lo(g,c,f,v,S=1/0){let x=Math.min(v.distance(g[0],f[0][0]),S);if(x===0)return x;const A=new Wh([{dist:0,range1:[0,g.length-1],range2:[0,0]}],ag),D=c?Xh:Oc,U=Ba(f);for(;A.length;){const H=A.pop();if(H.dist>=x)continue;const R=H.range1;if(Rp(R)<=D){if(!Za(R,g.length))return NaN;if(c){const N=Dp(g,R,f,v);if((x=Math.min(x,N))===0)return x}else for(let N=R[0];N<=R[1];++N){const G=hg(g[N],f,v);if((x=Math.min(x,G))===0)return x}}else{const N=lg(R,c);if(N[0]!==null){const G=Fc(oa(g,N[0]),U,v);G<x&&A.push({dist:G,range1:N[0],range2:[0,0]})}if(N[1]!==null){const G=Fc(oa(g,N[1]),U,v);G<x&&A.push({dist:G,range1:N[1],range2:[0,0]})}}}return x}function Zs(g,c,f,v,S,x=1/0){let A=Math.min(x,S.distance(g[0],f[0]));if(A===0)return A;const D=new Wh([{dist:0,range1:[0,g.length-1],range2:[0,f.length-1]}],ag),U=c?Xh:Oc,H=v?Xh:Oc;for(;D.length;){const R=D.pop();if(R.dist>=A)continue;const N=R.range1,G=R.range2;if(Rp(N)<=U&&Rp(G)<=H){if(!Za(N,g.length)||!Za(G,f.length))return NaN;if(c&&v?A=Math.min(A,Lp(g,N,f,G,S)):c||v?c&&!v?A=Math.min(A,Pp(f,G,g,N,S)):!c&&v&&(A=Math.min(A,Pp(g,N,f,G,S))):A=Math.min(A,ug(g,N,f,G,S)),A===0)return A}else{const z=lg(N,c),V=lg(G,v);Ms(D,A,S,g,f,z[0],V[0]),Ms(D,A,S,g,f,z[0],V[1]),Ms(D,A,S,g,f,z[1],V[0]),Ms(D,A,S,g,f,z[1],V[1])}}return A}function gu(g,c,f,v,S=1/0){let x=S;const A=oa(g,[0,g.length-1]);for(const D of f)if(!(x!==1/0&&Fc(A,oa(D,[0,D.length-1]),v)>=x)&&(x=Math.min(x,Zs(g,c,D,!0,v,x)),x===0))return x;return x}function vu(g,c,f,v,S=1/0){let x=S;const A=oa(g,[0,g.length-1]);for(const D of f){if(x!==1/0&&Fc(A,Ba(D),v)>=x)continue;const U=Lo(g,c,D,v,x);if(isNaN(U))return U;if((x=Math.min(x,U))===0)return x}return x}function ju(g){return g==="Point"||g==="MultiPoint"||g==="LineString"||g==="MultiLineString"||g==="Polygon"||g==="MultiPolygon"}class Wu{constructor(c,f){this.type=On,this.geojson=c,this.geometries=f}static parse(c,f){if(c.length!==2)return f.error(`'distance' expression requires either one argument, but found ' ${c.length-1} instead.`);if(kc(c[1])){const v=c[1];if(v.type==="FeatureCollection"){for(let S=0;S<v.features.length;++S)if(ju(v.features[S].geometry.type))return new Wu(v,v.features[S].geometry)}else if(v.type==="Feature"){if(ju(v.geometry.type))return new Wu(v,v.geometry)}else if(ju(v.type))return new Wu(v,v)}return f.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(c){const f=c.geometry(),v=c.canonicalID();if(f!=null&&v!=null){if(c.geometryType()==="Point")return function(S,x,A){const D=[];for(const H of S)for(const R of H)D.push(ka(R,x));const U=new jh(D[0][1],"meters");return A.type==="Point"||A.type==="MultiPoint"||A.type==="LineString"?Zs(D,!1,A.type==="Point"?[A.coordinates]:A.coordinates,A.type==="LineString",U):A.type==="MultiLineString"?gu(D,!1,A.coordinates,U):A.type==="Polygon"||A.type==="MultiPolygon"?vu(D,!1,A.type==="Polygon"?[A.coordinates]:A.coordinates,U):null}(f,v,this.geometries);if(c.geometryType()==="LineString")return function(S,x,A){const D=[];for(const H of S){const R=[];for(const N of H)R.push(ka(N,x));D.push(R)}const U=new jh(D[0][0][1],"meters");if(A.type==="Point"||A.type==="MultiPoint"||A.type==="LineString")return gu(A.type==="Point"?[A.coordinates]:A.coordinates,A.type==="LineString",D,U);if(A.type==="MultiLineString"){let H=1/0;for(let R=0;R<A.coordinates.length;R++){const N=gu(A.coordinates[R],!0,D,U,H);if(isNaN(N))return N;if((H=Math.min(H,N))===0)return H}return H}if(A.type==="Polygon"||A.type==="MultiPolygon"){let H=1/0;for(let R=0;R<D.length;R++){const N=vu(D[R],!0,A.type==="Polygon"?[A.coordinates]:A.coordinates,U,H);if(isNaN(N))return N;if((H=Math.min(H,N))===0)return H}return H}return null}(f,v,this.geometries);if(c.geometryType()==="Polygon")return function(S,x,A){const D=[];for(const H of function(R,N){const G=R.length;if(G<=1)return[R];const z=[];let V,X;for(let K=0;K<G;K++){const ee=Sx(R[K]);ee!==0&&(R[K].area=Math.abs(ee),X===void 0&&(X=ee<0),X===ee<0?(V&&z.push(V),V=[R[K]]):V.push(R[K]))}return V&&z.push(V),z}(S)){const R=[];for(let N=0;N<H.length;++N)R.push(qh(H[N],x));D.push(R)}const U=new jh(D[0][0][0][1],"meters");if(A.type==="Point"||A.type==="MultiPoint"||A.type==="LineString")return vu(A.type==="Point"?[A.coordinates]:A.coordinates,A.type==="LineString",D,U);if(A.type==="MultiLineString"){let H=1/0;for(let R=0;R<A.coordinates.length;R++){const N=vu(A.coordinates[R],!0,D,U,H);if(isNaN(N))return N;if((H=Math.min(H,N))===0)return H}return H}return A.type==="Polygon"||A.type==="MultiPolygon"?function(H,R,N){let G=1/0;for(const z of H)for(const V of R){const X=Zh(z,V,N,G);if(isNaN(X))return X;if((G=Math.min(G,X))===0)return G}return G}(A.type==="Polygon"?[A.coordinates]:A.coordinates,D,U):null}(f,v,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Vs(g,c){switch(g){case"string":return ga(c);case"number":return+c;case"boolean":return!!c;case"color":return vr.parse(c);case"formatted":return Po.fromString(ga(c));case"resolvedImage":return $o.fromString(ga(c))}return c}function Kr(g,c,f,v){return v!==void 0&&(g=v*Math.round(g/v)),c!==void 0&&g<c&&(g=c),f!==void 0&&g>f&&(g=f),g}class Xu{constructor(c,f,v){this.type=c,this.key=f,this.scope=v}static parse(c,f){let v=f.expectedType;if(v==null&&(v=ni),c.length<2||c.length>3)return f.error("Invalid number of arguments for 'config' expression.");const S=f.parse(c[1],1);if(!(S instanceof ll))return f.error("Key name of 'config' expression must be a string literal.");if(c.length>=3){const x=f.parse(c[2],2);return x instanceof ll?new Xu(v,ga(S.value),ga(x.value)):f.error("Scope of 'config' expression must be a string literal.")}return new Xu(v,ga(S.value))}evaluate(c){const f=[this.key,this.scope,c.scope].filter(Boolean).join(""),v=c.getConfig(f);if(!v)return null;const{type:S,value:x,values:A,minValue:D,maxValue:U,stepValue:H}=v,R=v.default.evaluate(c);let N=R;if(x){const G=c.scope;c.scope=(G||"").split("").slice(1).join(""),N=x.evaluate(c),c.scope=G}return S&&(N=Vs(S,N)),N===void 0||D===void 0&&U===void 0&&H===void 0||(typeof N=="number"?N=Kr(N,D,U,H):Array.isArray(N)&&(N=N.map(G=>typeof G=="number"?Kr(G,D,U,H):G))),x!==void 0&&N!==void 0&&A&&!A.includes(N)&&(N=R,S&&(N=Vs(S,N))),(S&&S!==this.type||N!==void 0&&Ls(N)!==this.type)&&(N=Vs(this.type.kind,N)),N}eachChild(){}outputDefined(){return!1}serialize(){const c=["config",this.key];return this.scope&&c.concat(this.key),c}}function Yh(g){if(g instanceof La&&(g.name==="get"&&g.args.length===1||g.name==="feature-state"||g.name==="has"&&g.args.length===1||g.name==="properties"||g.name==="geometry-type"||g.name==="id"||/^filter-/.test(g.name))||g instanceof yo||g instanceof Wu)return!1;let c=!0;return g.eachChild(f=>{c&&!Yh(f)&&(c=!1)}),c}function Tl(g){if(g instanceof La&&g.name==="feature-state")return!1;let c=!0;return g.eachChild(f=>{c&&!Tl(f)&&(c=!1)}),c}function cl(g){if(g instanceof Xu)return new Set([g.key]);let c=new Set;return g.eachChild(f=>{c=new Set([...c,...cl(f)])}),c}function rc(g,c){if(g instanceof La&&c.indexOf(g.name)>=0)return!1;let f=!0;return g.eachChild(v=>{f&&!rc(v,c)&&(f=!1)}),f}class yi{constructor(c,f){this.type=f.type,this.name=c,this.boundExpression=f}static parse(c,f){if(c.length!==2||typeof c[1]!="string")return f.error("'var' expression requires exactly one string literal argument.");const v=c[1];return f.scope.has(v)?new yi(v,f.scope.get(v)):f.error(`Unknown variable "${v}". Make sure "${v}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(c){return this.boundExpression.evaluate(c)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class pd{constructor(c,f=[],v,S=new cd,x=[],A,D){this.registry=c,this.path=f,this.key=f.map(U=>typeof U=="string"?`['${U}']`:`[${U}]`).join(""),this.scope=S,this.errors=x,this.expectedType=v,this._scope=A,this.options=D}parse(c,f,v,S,x={}){return f||v?this.concat(f,null,v,S)._parse(c,x):this._parse(c,x)}parseObjectValue(c,f,v,S,x,A={}){return this.concat(f,v,S,x)._parse(c,A)}_parse(c,f){function v(S,x,A){return A==="assert"?new qs(x,[S]):A==="coerce"?new sa(x,[S]):S}if(c!==null&&typeof c!="string"&&typeof c!="boolean"&&typeof c!="number"||(c=["literal",c]),Array.isArray(c)){if(c.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const S=typeof c[0]=="string"?this.registry[c[0]]:void 0;if(S){let x=S.parse(c,this);if(!x)return null;if(this.expectedType){const A=this.expectedType,D=x.type;if(A.kind!=="string"&&A.kind!=="number"&&A.kind!=="boolean"&&A.kind!=="object"&&A.kind!=="array"||D.kind!=="value")if(A.kind!=="color"&&A.kind!=="formatted"&&A.kind!=="resolvedImage"||D.kind!=="value"&&D.kind!=="string"){if(this.checkSubtype(A,D))return null}else x=v(x,A,f.typeAnnotation||"coerce");else x=v(x,A,f.typeAnnotation||"assert")}if(!(x instanceof ll)&&x.type.kind!=="resolvedImage"&&fg(x)){const A=new Mp(this._scope,this.options);try{x=new ll(x.type,x.evaluate(A))}catch(D){return this.error(D.message),null}}return x}return sa.parse(["to-array",c],this)}return this.error(c===void 0?"'undefined' value invalid. Use null instead.":typeof c=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof c} instead.`)}concat(c,f,v,S){let x=typeof c=="number"?this.path.concat(c):this.path;x=typeof f=="string"?x.concat(f):x;const A=S?this.scope.concat(S):this.scope;return new pd(this.registry,x,v||null,A,this.errors,this._scope,this.options)}error(c,...f){const v=`${this.key}${f.map(S=>`[${S}]`).join("")}`;this.errors.push(new ys(v,c))}checkSubtype(c,f){const v=Ra(c,f);return v&&this.error(v),v}}var kv=pd;function fg(g){if(g instanceof yi)return fg(g.boundExpression);if(g instanceof La&&g.name==="error"||g instanceof Cp||g instanceof yo||g instanceof Wu||g instanceof Xu)return!1;const c=g instanceof sa||g instanceof qs;let f=!0;return g.eachChild(v=>{f=c?f&&fg(v):f&&v instanceof ll}),!!f&&Yh(g)&&rc(g,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Bp(g,c){const f=g.length-1;let v,S,x=0,A=f,D=0;for(;x<=A;)if(D=Math.floor((x+A)/2),v=g[D],S=g[D+1],v<=c){if(D===f||c<S)return D;x=D+1}else{if(!(v>c))throw new $s("Input is not a number.");A=D-1}return 0}class md{constructor(c,f,v){this.type=c,this.input=f,this.labels=[],this.outputs=[];for(const[S,x]of v)this.labels.push(S),this.outputs.push(x)}static parse(c,f){if(c.length-1<4)return f.error(`Expected at least 4 arguments, but found only ${c.length-1}.`);if((c.length-1)%2!=0)return f.error("Expected an even number of arguments.");const v=f.parse(c[1],1,On);if(!v)return null;const S=[];let x=null;f.expectedType&&f.expectedType.kind!=="value"&&(x=f.expectedType);for(let A=1;A<c.length;A+=2){const D=A===1?-1/0:c[A],U=c[A+1],H=A,R=A+1;if(typeof D!="number")return f.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',H);if(S.length&&S[S.length-1][0]>=D)return f.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',H);const N=f.parse(U,R,x);if(!N)return null;x=x||N.type,S.push([D,N])}return new md(x,v,S)}evaluate(c){const f=this.labels,v=this.outputs;if(f.length===1)return v[0].evaluate(c);const S=this.input.evaluate(c);if(S<=f[0])return v[0].evaluate(c);const x=f.length;return S>=f[x-1]?v[x-1].evaluate(c):v[Bp(f,S)].evaluate(c)}eachChild(c){c(this.input);for(const f of this.outputs)c(f)}outputDefined(){return this.outputs.every(c=>c.outputDefined())}serialize(){const c=["step",this.input.serialize()];for(let f=0;f<this.labels.length;f++)f>0&&c.push(this.labels[f]),c.push(this.outputs[f].serialize());return c}}const Ov=.95047,Fv=1.08883,dg=4/29,Nc=6/29,Nv=3*Nc*Nc,pg=Nc*Nc*Nc,mg=Math.PI/180,zv=180/Math.PI;function Kh(g){return g>pg?Math.pow(g,1/3):g/Nv+dg}function gg(g){return g>Nc?g*g*g:Nv*(g-dg)}function vg(g){return 255*(g<=.0031308?12.92*g:1.055*Math.pow(g,1/2.4)-.055)}function _g(g){return(g/=255)<=.04045?g/12.92:Math.pow((g+.055)/1.055,2.4)}function Uv(g){const c=_g(g.r),f=_g(g.g),v=_g(g.b),S=Kh((.4124564*c+.3575761*f+.1804375*v)/Ov),x=Kh((.2126729*c+.7151522*f+.072175*v)/1);return{l:116*x-16,a:500*(S-x),b:200*(x-Kh((.0193339*c+.119192*f+.9503041*v)/Fv)),alpha:g.a}}function yg(g){let c=(g.l+16)/116,f=isNaN(g.a)?c:c+g.a/500,v=isNaN(g.b)?c:c-g.b/200;return c=1*gg(c),f=Ov*gg(f),v=Fv*gg(v),new vr(vg(3.2404542*f-1.5371385*c-.4985314*v),vg(-.969266*f+1.8760108*c+.041556*v),vg(.0556434*f-.2040259*c+1.0572252*v),g.alpha)}function Ax(g,c,f){const v=c-g;return g+f*(v>180||v<-180?v-360*Math.round(v/360):v)}const gd={forward:Uv,reverse:yg,interpolate:function(g,c,f){return{l:cr(g.l,c.l,f),a:cr(g.a,c.a,f),b:cr(g.b,c.b,f),alpha:cr(g.alpha,c.alpha,f)}}},kp={forward:function(g){const{l:c,a:f,b:v}=Uv(g),S=Math.atan2(v,f)*zv;return{h:S<0?S+360:S,c:Math.sqrt(f*f+v*v),l:c,alpha:g.a}},reverse:function(g){const c=g.h*mg,f=g.c;return yg({l:g.l,a:Math.cos(c)*f,b:Math.sin(c)*f,alpha:g.alpha})},interpolate:function(g,c,f){return{h:Ax(g.h,c.h,f),c:cr(g.c,c.c,f),l:cr(g.l,c.l,f),alpha:cr(g.alpha,c.alpha,f)}}};var Vv=Object.freeze({__proto__:null,hcl:kp,lab:gd});class ul{constructor(c,f,v,S,x){this.type=c,this.operator=f,this.interpolation=v,this.input=S,this.labels=[],this.outputs=[];for(const[A,D]of x)this.labels.push(A),this.outputs.push(D)}static interpolationFactor(c,f,v,S){let x=0;if(c.name==="exponential")x=Gv(f,c.base,v,S);else if(c.name==="linear")x=Gv(f,1,v,S);else if(c.name==="cubic-bezier"){const A=c.controlPoints;x=new mn(A[0],A[1],A[2],A[3]).solve(Gv(f,1,v,S))}return x}static parse(c,f){let[v,S,x,...A]=c;if(!Array.isArray(S)||S.length===0)return f.error("Expected an interpolation type expression.",1);if(S[0]==="linear")S={name:"linear"};else if(S[0]==="exponential"){const H=S[1];if(typeof H!="number")return f.error("Exponential interpolation requires a numeric base.",1,1);S={name:"exponential",base:H}}else{if(S[0]!=="cubic-bezier")return f.error(`Unknown interpolation type ${String(S[0])}`,1,0);{const H=S.slice(1);if(H.length!==4||H.some(R=>typeof R!="number"||R<0||R>1))return f.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);S={name:"cubic-bezier",controlPoints:H}}}if(c.length-1<4)return f.error(`Expected at least 4 arguments, but found only ${c.length-1}.`);if((c.length-1)%2!=0)return f.error("Expected an even number of arguments.");if(x=f.parse(x,2,On),!x)return null;const D=[];let U=null;v==="interpolate-hcl"||v==="interpolate-lab"?U=zs:f.expectedType&&f.expectedType.kind!=="value"&&(U=f.expectedType);for(let H=0;H<A.length;H+=2){const R=A[H],N=A[H+1],G=H+3,z=H+4;if(typeof R!="number")return f.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',G);if(D.length&&D[D.length-1][0]>=R)return f.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',G);const V=f.parse(N,z,U);if(!V)return null;U=U||V.type,D.push([R,V])}return U.kind==="number"||U.kind==="color"||U.kind==="array"&&U.itemType.kind==="number"&&typeof U.N=="number"?new ul(U,v,S,x,D):f.error(`Type ${As(U)} is not interpolatable.`)}evaluate(c){const f=this.labels,v=this.outputs;if(f.length===1)return v[0].evaluate(c);const S=this.input.evaluate(c);if(S<=f[0])return v[0].evaluate(c);const x=f.length;if(S>=f[x-1])return v[x-1].evaluate(c);const A=Bp(f,S),D=ul.interpolationFactor(this.interpolation,S,f[A],f[A+1]),U=v[A].evaluate(c),H=v[A+1].evaluate(c);return this.operator==="interpolate"?zh[this.type.kind.toLowerCase()](U,H,D):this.operator==="interpolate-hcl"?kp.reverse(kp.interpolate(kp.forward(U),kp.forward(H),D)):gd.reverse(gd.interpolate(gd.forward(U),gd.forward(H),D))}eachChild(c){c(this.input);for(const f of this.outputs)c(f)}outputDefined(){return this.outputs.every(c=>c.outputDefined())}serialize(){let c;c=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const f=[this.operator,c,this.input.serialize()];for(let v=0;v<this.labels.length;v++)f.push(this.labels[v],this.outputs[v].serialize());return f}}function Gv(g,c,f,v){const S=v-f,x=g-f;return S===0?0:c===1?x/S:(Math.pow(c,x)-1)/(Math.pow(c,S)-1)}class Op{constructor(c,f){this.type=c,this.args=f}static parse(c,f){if(c.length<2)return f.error("Expectected at least one argument.");let v=null;const S=f.expectedType;S&&S.kind!=="value"&&(v=S);const x=[];for(const D of c.slice(1)){const U=f.parse(D,1+x.length,v,void 0,{typeAnnotation:"omit"});if(!U)return null;v=v||U.type,x.push(U)}const A=S&&x.some(D=>Ra(S,D.type));return new Op(A?ni:v,x)}evaluate(c){let f,v=null,S=0;for(const x of this.args){if(S++,v=x.evaluate(c),v&&v instanceof $o&&!v.available&&(f||(f=v),v=null,S===this.args.length))return f;if(v!==null)break}return v}eachChild(c){this.args.forEach(c)}outputDefined(){return this.args.every(c=>c.outputDefined())}serialize(){const c=["coalesce"];return this.eachChild(f=>{c.push(f.serialize())}),c}}class Fp{constructor(c,f){this.type=f.type,this.bindings=[].concat(c),this.result=f}evaluate(c){return this.result.evaluate(c)}eachChild(c){for(const f of this.bindings)c(f[1]);c(this.result)}static parse(c,f){if(c.length<4)return f.error(`Expected at least 3 arguments, but found ${c.length-1} instead.`);const v=[];for(let x=1;x<c.length-1;x+=2){const A=c[x];if(typeof A!="string")return f.error(`Expected string, but found ${typeof A} instead.`,x);if(/[^a-zA-Z0-9_]/.test(A))return f.error("Variable names must contain only alphanumeric characters or '_'.",x);const D=f.parse(c[x+1],x+1);if(!D)return null;v.push([A,D])}const S=f.parse(c[c.length-1],c.length-1,f.expectedType,v);return S?new Fp(v,S):null}outputDefined(){return this.result.outputDefined()}serialize(){const c=["let"];for(const[f,v]of this.bindings)c.push(f,v.serialize());return c.push(this.result.serialize()),c}}class xg{constructor(c,f,v){this.type=c,this.index=f,this.input=v}static parse(c,f){if(c.length!==3)return f.error(`Expected 2 arguments, but found ${c.length-1} instead.`);const v=f.parse(c[1],1,On),S=f.parse(c[2],2,ia(f.expectedType||ni));return v&&S?new xg(S.type.itemType,v,S):null}evaluate(c){const f=this.index.evaluate(c),v=this.input.evaluate(c);if(f<0)throw new $s(`Array index out of bounds: ${f} < 0.`);if(f>=v.length)throw new $s(`Array index out of bounds: ${f} > ${v.length-1}.`);if(f!==Math.floor(f))throw new $s(`Array index must be an integer, but found ${f} instead.`);return v[f]}eachChild(c){c(this.index),c(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class bg{constructor(c,f){this.type=Zr,this.needle=c,this.haystack=f}static parse(c,f){if(c.length!==3)return f.error(`Expected 2 arguments, but found ${c.length-1} instead.`);const v=f.parse(c[1],1,ni),S=f.parse(c[2],2,ni);return v&&S?ud(v.type,[Zr,ei,On,Kl,ni])?new bg(v,S):f.error(`Expected first argument to be of type boolean, string, number or null, but found ${As(v.type)} instead`):null}evaluate(c){const f=this.needle.evaluate(c),v=this.haystack.evaluate(c);if(v==null)return!1;if(!al(f,["boolean","string","number","null"]))throw new $s(`Expected first argument to be of type boolean, string, number or null, but found ${As(Ls(f))} instead.`);if(!al(v,["string","array"]))throw new $s(`Expected second argument to be of type array or string, but found ${As(Ls(v))} instead.`);return v.indexOf(f)>=0}eachChild(c){c(this.needle),c(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Jh{constructor(c,f,v){this.type=On,this.needle=c,this.haystack=f,this.fromIndex=v}static parse(c,f){if(c.length<=2||c.length>=5)return f.error(`Expected 3 or 4 arguments, but found ${c.length-1} instead.`);const v=f.parse(c[1],1,ni),S=f.parse(c[2],2,ni);if(!v||!S)return null;if(!ud(v.type,[Zr,ei,On,Kl,ni]))return f.error(`Expected first argument to be of type boolean, string, number or null, but found ${As(v.type)} instead`);if(c.length===4){const x=f.parse(c[3],3,On);return x?new Jh(v,S,x):null}return new Jh(v,S)}evaluate(c){const f=this.needle.evaluate(c),v=this.haystack.evaluate(c);if(!al(f,["boolean","string","number","null"]))throw new $s(`Expected first argument to be of type boolean, string, number or null, but found ${As(Ls(f))} instead.`);if(!al(v,["string","array"]))throw new $s(`Expected second argument to be of type array or string, but found ${As(Ls(v))} instead.`);if(this.fromIndex){const S=this.fromIndex.evaluate(c);return v.indexOf(f,S)}return v.indexOf(f)}eachChild(c){c(this.needle),c(this.haystack),this.fromIndex&&c(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const c=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),c]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Hv{constructor(c,f,v,S,x,A){this.inputType=c,this.type=f,this.input=v,this.cases=S,this.outputs=x,this.otherwise=A}static parse(c,f){if(c.length<5)return f.error(`Expected at least 4 arguments, but found only ${c.length-1}.`);if(c.length%2!=1)return f.error("Expected an even number of arguments.");let v,S;f.expectedType&&f.expectedType.kind!=="value"&&(S=f.expectedType);const x={},A=[];for(let H=2;H<c.length-1;H+=2){let R=c[H];const N=c[H+1];Array.isArray(R)||(R=[R]);const G=f.concat(H);if(R.length===0)return G.error("Expected at least one branch label.");for(const V of R){if(typeof V!="number"&&typeof V!="string")return G.error("Branch labels must be numbers or strings.");if(typeof V=="number"&&Math.abs(V)>Number.MAX_SAFE_INTEGER)return G.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof V=="number"&&Math.floor(V)!==V)return G.error("Numeric branch labels must be integer values.");if(v){if(G.checkSubtype(v,Ls(V)))return null}else v=Ls(V);if(x[String(V)]!==void 0)return G.error("Branch labels must be unique.");x[String(V)]=A.length}const z=f.parse(N,H,S);if(!z)return null;S=S||z.type,A.push(z)}const D=f.parse(c[1],1,ni);if(!D)return null;const U=f.parse(c[c.length-1],c.length-1,S);return U?D.type.kind!=="value"&&f.concat(1).checkSubtype(v,D.type)?null:new Hv(v,S,D,x,A,U):null}evaluate(c){const f=this.input.evaluate(c);return(Ls(f)===this.inputType&&this.outputs[this.cases[f]]||this.otherwise).evaluate(c)}eachChild(c){c(this.input),this.outputs.forEach(c),c(this.otherwise)}outputDefined(){return this.outputs.every(c=>c.outputDefined())&&this.otherwise.outputDefined()}serialize(){const c=["match",this.input.serialize()],f=Object.keys(this.cases).sort(),v=[],S={};for(const A of f){const D=S[this.cases[A]];D===void 0?(S[this.cases[A]]=v.length,v.push([this.cases[A],[A]])):v[D][1].push(A)}const x=A=>this.inputType.kind==="number"?Number(A):A;for(const[A,D]of v)c.push(D.length===1?x(D[0]):D.map(x)),c.push(this.outputs[A].serialize());return c.push(this.otherwise.serialize()),c}}class Np{constructor(c,f,v){this.type=c,this.branches=f,this.otherwise=v}static parse(c,f){if(c.length<4)return f.error(`Expected at least 3 arguments, but found only ${c.length-1}.`);if(c.length%2!=0)return f.error("Expected an odd number of arguments.");let v;f.expectedType&&f.expectedType.kind!=="value"&&(v=f.expectedType);const S=[];for(let A=1;A<c.length-1;A+=2){const D=f.parse(c[A],A,Zr);if(!D)return null;const U=f.parse(c[A+1],A+1,v);if(!U)return null;S.push([D,U]),v=v||U.type}const x=f.parse(c[c.length-1],c.length-1,v);return x?new Np(v,S,x):null}evaluate(c){for(const[f,v]of this.branches)if(f.evaluate(c))return v.evaluate(c);return this.otherwise.evaluate(c)}eachChild(c){for(const[f,v]of this.branches)c(f),c(v);c(this.otherwise)}outputDefined(){return this.branches.every(([c,f])=>f.outputDefined())&&this.otherwise.outputDefined()}serialize(){const c=["case"];return this.eachChild(f=>{c.push(f.serialize())}),c}}class wg{constructor(c,f,v,S){this.type=c,this.input=f,this.beginIndex=v,this.endIndex=S}static parse(c,f){if(c.length<=2||c.length>=5)return f.error(`Expected 3 or 4 arguments, but found ${c.length-1} instead.`);const v=f.parse(c[1],1,ni),S=f.parse(c[2],2,On);if(!v||!S)return null;if(!ud(v.type,[ia(ni),ei,ni]))return f.error(`Expected first argument to be of type array or string, but found ${As(v.type)} instead`);if(c.length===4){const x=f.parse(c[3],3,On);return x?new wg(v.type,v,S,x):null}return new wg(v.type,v,S)}evaluate(c){const f=this.input.evaluate(c),v=this.beginIndex.evaluate(c);if(!al(f,["string","array"]))throw new $s(`Expected first argument to be of type array or string, but found ${As(Ls(f))} instead.`);if(this.endIndex){const S=this.endIndex.evaluate(c);return f.slice(v,S)}return f.slice(v)}eachChild(c){c(this.input),c(this.beginIndex),this.endIndex&&c(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const c=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),c]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function zp(g,c){return g==="=="||g==="!="?c.kind==="boolean"||c.kind==="string"||c.kind==="number"||c.kind==="null"||c.kind==="value":c.kind==="string"||c.kind==="number"||c.kind==="value"}function Sg(g,c,f,v){return v.compare(c,f)===0}function vd(g,c,f){const v=g!=="=="&&g!=="!=";return class Rle{constructor(x,A,D){this.type=Zr,this.lhs=x,this.rhs=A,this.collator=D,this.hasUntypedArgument=x.type.kind==="value"||A.type.kind==="value"}static parse(x,A){if(x.length!==3&&x.length!==4)return A.error("Expected two or three arguments.");const D=x[0];let U=A.parse(x[1],1,ni);if(!U)return null;if(!zp(D,U.type))return A.concat(1).error(`"${D}" comparisons are not supported for type '${As(U.type)}'.`);let H=A.parse(x[2],2,ni);if(!H)return null;if(!zp(D,H.type))return A.concat(2).error(`"${D}" comparisons are not supported for type '${As(H.type)}'.`);if(U.type.kind!==H.type.kind&&U.type.kind!=="value"&&H.type.kind!=="value")return A.error(`Cannot compare types '${As(U.type)}' and '${As(H.type)}'.`);v&&(U.type.kind==="value"&&H.type.kind!=="value"?U=new qs(H.type,[U]):U.type.kind!=="value"&&H.type.kind==="value"&&(H=new qs(U.type,[H])));let R=null;if(x.length===4){if(U.type.kind!=="string"&&H.type.kind!=="string"&&U.type.kind!=="value"&&H.type.kind!=="value")return A.error("Cannot use collator to compare non-string types.");if(R=A.parse(x[3],3,ol),!R)return null}return new Rle(U,H,R)}evaluate(x){const A=this.lhs.evaluate(x),D=this.rhs.evaluate(x);if(v&&this.hasUntypedArgument){const U=Ls(A),H=Ls(D);if(U.kind!==H.kind||U.kind!=="string"&&U.kind!=="number")throw new $s(`Expected arguments for "${g}" to be (string, string) or (number, number), but found (${U.kind}, ${H.kind}) instead.`)}if(this.collator&&!v&&this.hasUntypedArgument){const U=Ls(A),H=Ls(D);if(U.kind!=="string"||H.kind!=="string")return c(x,A,D)}return this.collator?f(x,A,D,this.collator.evaluate(x)):c(x,A,D)}eachChild(x){x(this.lhs),x(this.rhs),this.collator&&x(this.collator)}outputDefined(){return!0}serialize(){const x=[g];return this.eachChild(A=>{x.push(A.serialize())}),x}}}const Tx=vd("==",function(g,c,f){return c===f},Sg),jv=vd("!=",function(g,c,f){return c!==f},function(g,c,f,v){return!Sg(0,c,f,v)}),Wv=vd("<",function(g,c,f){return c<f},function(g,c,f,v){return v.compare(c,f)<0}),Qh=vd(">",function(g,c,f){return c>f},function(g,c,f,v){return v.compare(c,f)>0}),Xv=vd("<=",function(g,c,f){return c<=f},function(g,c,f,v){return v.compare(c,f)<=0}),ic=vd(">=",function(g,c,f){return c>=f},function(g,c,f,v){return v.compare(c,f)>=0});class Ag{constructor(c,f,v,S,x,A){this.type=ei,this.number=c,this.locale=f,this.currency=v,this.unit=S,this.minFractionDigits=x,this.maxFractionDigits=A}static parse(c,f){if(c.length!==3)return f.error("Expected two arguments.");const v=f.parse(c[1],1,On);if(!v)return null;const S=c[2];if(typeof S!="object"||Array.isArray(S))return f.error("NumberFormat options argument must be an object.");let x=null;if(S.locale&&(x=f.parseObjectValue(S.locale,2,"locale",ei),!x))return null;let A=null;if(S.currency&&(A=f.parseObjectValue(S.currency,2,"currency",ei),!A))return null;let D=null;if(S.unit&&(D=f.parseObjectValue(S.unit,2,"unit",ei),!D))return null;let U=null;if(S["min-fraction-digits"]&&(U=f.parseObjectValue(S["min-fraction-digits"],2,"min-fraction-digits",On),!U))return null;let H=null;return S["max-fraction-digits"]&&(H=f.parseObjectValue(S["max-fraction-digits"],2,"max-fraction-digits",On),!H)?null:new Ag(v,x,A,D,U,H)}evaluate(c){return new Intl.NumberFormat(this.locale?this.locale.evaluate(c):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(c):void 0,unit:this.unit?this.unit.evaluate(c):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(c):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(c):void 0}).format(this.number.evaluate(c))}eachChild(c){c(this.number),this.locale&&c(this.locale),this.currency&&c(this.currency),this.unit&&c(this.unit),this.minFractionDigits&&c(this.minFractionDigits),this.maxFractionDigits&&c(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const c={};return this.locale&&(c.locale=this.locale.serialize()),this.currency&&(c.currency=this.currency.serialize()),this.unit&&(c.unit=this.unit.serialize()),this.minFractionDigits&&(c["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(c["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),c]}}class _u{constructor(c){this.type=On,this.input=c}static parse(c,f){if(c.length!==2)return f.error(`Expected 1 argument, but found ${c.length-1} instead.`);const v=f.parse(c[1],1);return v?v.type.kind!=="array"&&v.type.kind!=="string"&&v.type.kind!=="value"?f.error(`Expected argument of type string or array, but found ${As(v.type)} instead.`):new _u(v):null}evaluate(c){const f=this.input.evaluate(c);if(typeof f=="string"||Array.isArray(f))return f.length;throw new $s(`Expected value to be of type string or array, but found ${As(Ls(f))} instead.`)}eachChild(c){c(this.input)}outputDefined(){return!1}serialize(){const c=["length"];return this.eachChild(f=>{c.push(f.serialize())}),c}}function $u(g){return function(){g=1831565813+(g|=0)|0;let c=Math.imul(g^g>>>15,1|g);return c=c+Math.imul(c^c>>>7,61|c)^c,((c^c>>>14)>>>0)/4294967296}}const yu={"==":Tx,"!=":jv,">":Qh,"<":Wv,">=":ic,"<=":Xv,array:qs,at:xg,boolean:qs,case:Np,coalesce:Op,collator:Cp,format:Pa,image:$a,in:bg,"index-of":Jh,interpolate:ul,"interpolate-hcl":ul,"interpolate-lab":ul,length:_u,let:Fp,literal:ll,match:Hv,number:qs,"number-format":Ag,object:qs,slice:wg,step:md,string:qs,"to-boolean":sa,"to-color":sa,"to-number":sa,"to-string":sa,var:yi,within:yo,distance:Wu,config:Xu};function Up(g,[c,f,v,S]){c=c.evaluate(g),f=f.evaluate(g),v=v.evaluate(g);const x=S?S.evaluate(g):1,A=Uh(c,f,v,x);if(A)throw new $s(A);return new vr(c/255*x,f/255*x,v/255*x,x)}function Tg(g,[c,f,v,S]){c=c.evaluate(g),f=f.evaluate(g),v=v.evaluate(g);const x=S?S.evaluate(g):1,A=function(H,R,N,G){return typeof H=="number"&&H>=0&&H<=360?typeof R=="number"&&R>=0&&R<=100&&typeof N=="number"&&N>=0&&N<=100?G===void 0||typeof G=="number"&&G>=0&&G<=1?null:`Invalid hsla value [${[H,R,N,G].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof G=="number"?[H,R,N,G]:[H,R,N]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof G=="number"?[H,R,N,G]:[H,R,N]).join(", ")}]: 'h' must be between 0 and 360.`}(c,f,v,x);if(A)throw new $s(A);const D=`hsla(${c}, ${f}%, ${v}%, ${x})`,U=vr.parse(D);if(!U)throw new $s(`Failed to parse HSLA color: ${D}`);return U}function ef(g,c){return g in c}function qo(g,c){const f=c[g];return f===void 0?null:f}function tf(g){return{type:g}}function Mx(g){return{result:"success",value:g}}function xo(g){return{result:"error",value:g}}function aa(g,c){return!!g&&!!g.parameters&&g.parameters.indexOf(c)>-1}function Vp(g){return g["property-type"]==="data-driven"}function Mg(g){return aa(g.expression,"measure-light")}function $v(g){return aa(g.expression,"zoom")}function Cg(g){return!!g.expression&&g.expression.interpolated}function Gp(g){return typeof g=="object"&&g!==null&&!Array.isArray(g)}function Eg(g){return g}function qv(g,c){const f=c.type==="color",v=g.stops&&typeof g.stops[0][0]=="object",S=v||!(v||g.property!==void 0),x=g.type||(Cg(c)?"exponential":"interval");if(f&&((g=ld({},g)).stops&&(g.stops=g.stops.map(H=>[H[0],vr.parse(H[1])])),g.default=vr.parse(g.default?g.default:c.default)),g.colorSpace&&g.colorSpace!=="rgb"&&!Vv[g.colorSpace])throw new Error(`Unknown color space: ${g.colorSpace}`);let A,D,U;if(x==="exponential")A=Hp;else if(x==="interval")A=Zv;else if(x==="categorical"){A=Cx,D=Object.create(null);for(const H of g.stops)D[H[0]]=H[1];U=typeof g.stops[0][0]}else{if(x!=="identity")throw new Error(`Unknown function type "${x}"`);A=Ig}if(v){const H={},R=[];for(let z=0;z<g.stops.length;z++){const V=g.stops[z],X=V[0].zoom;H[X]===void 0&&(H[X]={zoom:X,type:g.type,property:g.property,default:g.default,stops:[]},R.push(X)),H[X].stops.push([V[0].value,V[1]])}const N=[];for(const z of R)N.push([H[z].zoom,qv(H[z],c)]);const G={name:"linear"};return{kind:"composite",interpolationType:G,interpolationFactor:ul.interpolationFactor.bind(void 0,G),zoomStops:N.map(z=>z[0]),evaluate:({zoom:z},V)=>Hp({stops:N,base:g.base},c,z).evaluate(z,V)}}if(S){const H=x==="exponential"?{name:"exponential",base:g.base!==void 0?g.base:1}:null;return{kind:"camera",interpolationType:H,interpolationFactor:ul.interpolationFactor.bind(void 0,H),zoomStops:g.stops.map(R=>R[0]),evaluate:({zoom:R})=>A(g,c,R,D,U)}}return{kind:"source",evaluate(H,R){const N=R&&R.properties?R.properties[g.property]:void 0;return N===void 0?nf(g.default,c.default):A(g,c,N,D,U)}}}function nf(g,c,f){return g!==void 0?g:c!==void 0?c:f!==void 0?f:void 0}function Cx(g,c,f,v,S){return nf(typeof f===S?v[f]:void 0,g.default,c.default)}function Zv(g,c,f){if(du(f)!=="number")return nf(g.default,c.default);const v=g.stops.length;if(v===1||f<=g.stops[0][0])return g.stops[0][1];if(f>=g.stops[v-1][0])return g.stops[v-1][1];const S=Bp(g.stops.map(x=>x[0]),f);return g.stops[S][1]}function Hp(g,c,f){const v=g.base!==void 0?g.base:1;if(du(f)!=="number")return nf(g.default,c.default);const S=g.stops.length;if(S===1||f<=g.stops[0][0])return g.stops[0][1];if(f>=g.stops[S-1][0])return g.stops[S-1][1];const x=Bp(g.stops.map(R=>R[0]),f),A=function(R,N,G,z){const V=z-G,X=R-G;return V===0?0:N===1?X/V:(Math.pow(N,X)-1)/(Math.pow(N,V)-1)}(f,v,g.stops[x][0],g.stops[x+1][0]),D=g.stops[x][1],U=g.stops[x+1][1];let H=zh[c.type]||Eg;if(g.colorSpace&&g.colorSpace!=="rgb"){const R=Vv[g.colorSpace];H=(N,G)=>R.reverse(R.interpolate(R.forward(N),R.forward(G),A))}return typeof D.evaluate=="function"?{evaluate(...R){const N=D.evaluate.apply(void 0,R),G=U.evaluate.apply(void 0,R);if(N!==void 0&&G!==void 0)return H(N,G,A)}}:H(D,U,A)}function Ig(g,c,f){return c.type==="color"?f=vr.parse(f):c.type==="formatted"?f=Po.fromString(f.toString()):c.type==="resolvedImage"?f=$o.fromString(f.toString()):du(f)===c.type||c.type==="enum"&&c.values[f]||(f=void 0),nf(f,g.default,c.default)}La.register(yu,{error:[{kind:"error"},[ei],(g,[c])=>{throw new $s(c.evaluate(g))}],typeof:[ei,[ni],(g,[c])=>As(Ls(c.evaluate(g)))],"to-rgba":[ia(On,4),[zs],(g,[c])=>c.evaluate(g).toRenderColor(null).toArray()],rgb:[zs,[On,On,On],Up],rgba:[zs,[On,On,On,On],Up],hsl:[zs,[On,On,On],Tg],hsla:[zs,[On,On,On,On],Tg],has:{type:Zr,overloads:[[[ei],(g,[c])=>ef(c.evaluate(g),g.properties())],[[ei,ma],(g,[c,f])=>ef(c.evaluate(g),f.evaluate(g))]]},get:{type:ni,overloads:[[[ei],(g,[c])=>qo(c.evaluate(g),g.properties())],[[ei,ma],(g,[c,f])=>qo(c.evaluate(g),f.evaluate(g))]]},"feature-state":[ni,[ei],(g,[c])=>qo(c.evaluate(g),g.featureState||{})],properties:[ma,[],g=>g.properties()],"geometry-type":[ei,[],g=>g.geometryType()],id:[ni,[],g=>g.id()],zoom:[On,[],g=>g.globals.zoom],pitch:[On,[],g=>g.globals.pitch||0],"distance-from-center":[On,[],g=>g.distanceFromCenter()],"measure-light":[On,[ei],(g,[c])=>g.measureLight(c.evaluate(g))],"heatmap-density":[On,[],g=>g.globals.heatmapDensity||0],"line-progress":[On,[],g=>g.globals.lineProgress||0],"raster-value":[On,[],g=>g.globals.rasterValue||0],"raster-particle-speed":[On,[],g=>g.globals.rasterParticleSpeed||0],"sky-radial-progress":[On,[],g=>g.globals.skyRadialProgress||0],accumulated:[ni,[],g=>g.globals.accumulated===void 0?null:g.globals.accumulated],"+":[On,tf(On),(g,c)=>{let f=0;for(const v of c)f+=v.evaluate(g);return f}],"*":[On,tf(On),(g,c)=>{let f=1;for(const v of c)f*=v.evaluate(g);return f}],"-":{type:On,overloads:[[[On,On],(g,[c,f])=>c.evaluate(g)-f.evaluate(g)],[[On],(g,[c])=>-c.evaluate(g)]]},"/":[On,[On,On],(g,[c,f])=>c.evaluate(g)/f.evaluate(g)],"%":[On,[On,On],(g,[c,f])=>c.evaluate(g)%f.evaluate(g)],ln2:[On,[],()=>Math.LN2],pi:[On,[],()=>Math.PI],e:[On,[],()=>Math.E],"^":[On,[On,On],(g,[c,f])=>Math.pow(c.evaluate(g),f.evaluate(g))],sqrt:[On,[On],(g,[c])=>Math.sqrt(c.evaluate(g))],log10:[On,[On],(g,[c])=>Math.log(c.evaluate(g))/Math.LN10],ln:[On,[On],(g,[c])=>Math.log(c.evaluate(g))],log2:[On,[On],(g,[c])=>Math.log(c.evaluate(g))/Math.LN2],sin:[On,[On],(g,[c])=>Math.sin(c.evaluate(g))],cos:[On,[On],(g,[c])=>Math.cos(c.evaluate(g))],tan:[On,[On],(g,[c])=>Math.tan(c.evaluate(g))],asin:[On,[On],(g,[c])=>Math.asin(c.evaluate(g))],acos:[On,[On],(g,[c])=>Math.acos(c.evaluate(g))],atan:[On,[On],(g,[c])=>Math.atan(c.evaluate(g))],min:[On,tf(On),(g,c)=>Math.min(...c.map(f=>f.evaluate(g)))],max:[On,tf(On),(g,c)=>Math.max(...c.map(f=>f.evaluate(g)))],abs:[On,[On],(g,[c])=>Math.abs(c.evaluate(g))],round:[On,[On],(g,[c])=>{const f=c.evaluate(g);return f<0?-Math.round(-f):Math.round(f)}],floor:[On,[On],(g,[c])=>Math.floor(c.evaluate(g))],ceil:[On,[On],(g,[c])=>Math.ceil(c.evaluate(g))],"filter-==":[Zr,[ei,ni],(g,[c,f])=>g.properties()[c.value]===f.value],"filter-id-==":[Zr,[ni],(g,[c])=>g.id()===c.value],"filter-type-==":[Zr,[ei],(g,[c])=>g.geometryType()===c.value],"filter-<":[Zr,[ei,ni],(g,[c,f])=>{const v=g.properties()[c.value],S=f.value;return typeof v==typeof S&&v<S}],"filter-id-<":[Zr,[ni],(g,[c])=>{const f=g.id(),v=c.value;return typeof f==typeof v&&f<v}],"filter->":[Zr,[ei,ni],(g,[c,f])=>{const v=g.properties()[c.value],S=f.value;return typeof v==typeof S&&v>S}],"filter-id->":[Zr,[ni],(g,[c])=>{const f=g.id(),v=c.value;return typeof f==typeof v&&f>v}],"filter-<=":[Zr,[ei,ni],(g,[c,f])=>{const v=g.properties()[c.value],S=f.value;return typeof v==typeof S&&v<=S}],"filter-id-<=":[Zr,[ni],(g,[c])=>{const f=g.id(),v=c.value;return typeof f==typeof v&&f<=v}],"filter->=":[Zr,[ei,ni],(g,[c,f])=>{const v=g.properties()[c.value],S=f.value;return typeof v==typeof S&&v>=S}],"filter-id->=":[Zr,[ni],(g,[c])=>{const f=g.id(),v=c.value;return typeof f==typeof v&&f>=v}],"filter-has":[Zr,[ni],(g,[c])=>c.value in g.properties()],"filter-has-id":[Zr,[],g=>g.id()!==null&&g.id()!==void 0],"filter-type-in":[Zr,[ia(ei)],(g,[c])=>c.value.indexOf(g.geometryType())>=0],"filter-id-in":[Zr,[ia(ni)],(g,[c])=>c.value.indexOf(g.id())>=0],"filter-in-small":[Zr,[ei,ia(ni)],(g,[c,f])=>f.value.indexOf(g.properties()[c.value])>=0],"filter-in-large":[Zr,[ei,ia(ni)],(g,[c,f])=>function(v,S,x,A){for(;x<=A;){const D=x+A>>1;if(S[D]===v)return!0;S[D]>v?A=D-1:x=D+1}return!1}(g.properties()[c.value],f.value,0,f.value.length-1)],all:{type:Zr,overloads:[[[Zr,Zr],(g,[c,f])=>c.evaluate(g)&&f.evaluate(g)],[tf(Zr),(g,c)=>{for(const f of c)if(!f.evaluate(g))return!1;return!0}]]},any:{type:Zr,overloads:[[[Zr,Zr],(g,[c,f])=>c.evaluate(g)||f.evaluate(g)],[tf(Zr),(g,c)=>{for(const f of c)if(f.evaluate(g))return!0;return!1}]]},"!":[Zr,[Zr],(g,[c])=>!c.evaluate(g)],"is-supported-script":[Zr,[ei],(g,[c])=>{const f=g.globals&&g.globals.isSupportedScript;return!f||f(c.evaluate(g))}],upcase:[ei,[ei],(g,[c])=>c.evaluate(g).toUpperCase()],downcase:[ei,[ei],(g,[c])=>c.evaluate(g).toLowerCase()],concat:[ei,tf(ni),(g,c)=>c.map(f=>ga(f.evaluate(g))).join("")],"resolved-locale":[ei,[ol],(g,[c])=>c.evaluate(g).resolvedLocale()],random:[On,[On,On,ni],(g,c)=>{const[f,v,S]=c.map(A=>A.evaluate(g));if(f>v||f===v)return f;let x;if(typeof S=="string")x=function(A){let D=0;if(A.length===0)return D;for(let U=0;U<A.length;U++)D=(D<<5)-D+A.charCodeAt(U),D|=0;return D}(S);else{if(typeof S!="number")throw new $s(`Invalid seed input: ${S}`);x=S}return f+$u(x)()*(v-f)}]});class jp{constructor(c,f,v,S){this.expression=c,this._warningHistory={},this._evaluator=new Mp(v,S),this._defaultValue=f?function(x){return x.type==="color"&&(Gp(x.default)||Array.isArray(x.default))?new vr(0,0,0,0):x.type==="color"?vr.parse(x.default)||null:x.default===void 0?null:x.default}(f):null,this._enumValues=f&&f.type==="enum"?f.values:null}evaluateWithoutErrorHandling(c,f,v,S,x,A,D,U){return this._evaluator.globals=c,this._evaluator.feature=f,this._evaluator.featureState=v,this._evaluator.canonical=S||null,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=A,this._evaluator.featureTileCoord=D||null,this._evaluator.featureDistanceData=U||null,this.expression.evaluate(this._evaluator)}evaluate(c,f,v,S,x,A,D,U){this._evaluator.globals=c,this._evaluator.feature=f||null,this._evaluator.featureState=v||null,this._evaluator.canonical=S||null,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=A||null,this._evaluator.featureTileCoord=D||null,this._evaluator.featureDistanceData=U||null;try{const H=this.expression.evaluate(this._evaluator);if(H==null||typeof H=="number"&&H!=H)return this._defaultValue;if(this._enumValues&&!(H in this._enumValues))throw new $s(`Expected value to be one of ${Object.keys(this._enumValues).map(R=>JSON.stringify(R)).join(", ")}, but found ${JSON.stringify(H)} instead.`);return H}catch(H){return this._warningHistory[H.message]||(this._warningHistory[H.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${H.message}`)),this._defaultValue}}}function _d(g){return Array.isArray(g)&&g.length>0&&typeof g[0]=="string"&&g[0]in yu}function yd(g,c,f,v){const S=new kv(yu,[],c?function(A){const D={color:zs,string:ei,number:On,enum:ei,boolean:Zr,formatted:Xa,resolvedImage:fu};return A.type==="array"?ia(D[A.value]||ni,A.length):D[A.type]}(c):void 0,void 0,void 0,f,v),x=S.parse(g,void 0,void 0,void 0,c&&c.type==="string"?{typeAnnotation:"coerce"}:void 0);return x?Mx(new jp(x,c,f,v)):xo(S.errors)}class Rg{constructor(c,f,v){this.kind=c,this._styleExpression=f,this.isLightConstant=v,this.isStateDependent=c!=="constant"&&!Tl(f.expression),this.configDependencies=cl(f.expression)}evaluateWithoutErrorHandling(c,f,v,S,x,A){return this._styleExpression.evaluateWithoutErrorHandling(c,f,v,S,x,A)}evaluate(c,f,v,S,x,A){return this._styleExpression.evaluate(c,f,v,S,x,A)}}class hl{constructor(c,f,v,S,x){this.kind=c,this.zoomStops=v,this._styleExpression=f,this.isStateDependent=c!=="camera"&&!Tl(f.expression),this.isLightConstant=x,this.configDependencies=cl(f.expression),this.interpolationType=S}evaluateWithoutErrorHandling(c,f,v,S,x,A){return this._styleExpression.evaluateWithoutErrorHandling(c,f,v,S,x,A)}evaluate(c,f,v,S,x,A){return this._styleExpression.evaluate(c,f,v,S,x,A)}interpolationFactor(c,f,v){return this.interpolationType?ul.interpolationFactor(this.interpolationType,c,f,v):0}}function Yv(g,c,f,v){if((g=yd(g,c,f,v)).result==="error")return g;const S=g.value.expression,x=Yh(S);if(!x&&!Vp(c))return xo([new ys("","data expressions not supported")]);const A=rc(S,["zoom","pitch","distance-from-center"]);if(!A&&!$v(c))return xo([new ys("","zoom expressions not supported")]);const D=rc(S,["measure-light"]);if(!D&&!Mg(c))return xo([new ys("","measure-light expression not supported")]);const U=c.expression&&c.expression.relaxZoomRestriction,H=Wp(S);return H||A||U?H instanceof ys?xo([H]):H instanceof ul&&!Cg(c)?xo([new ys("",'"interpolate" expressions cannot be used with this property')]):Mx(H?new hl(x?"camera":"composite",g.value,H.labels,H instanceof ul?H.interpolation:void 0,D):new Rg(x?"constant":"source",g.value,D)):xo([new ys("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class xd{constructor(c,f){this._parameters=c,this._specification=f,ld(this,qv(this._parameters,this._specification))}static deserialize(c){return new xd(c._parameters,c._specification)}static serialize(c){return{_parameters:c._parameters,_specification:c._specification}}}function Wp(g){let c=null;if(g instanceof Fp)c=Wp(g.result);else if(g instanceof Op){for(const f of g.args)if(c=Wp(f),c)break}else(g instanceof md||g instanceof ul)&&g.input instanceof La&&g.input.name==="zoom"&&(c=g);return c instanceof ys||g.eachChild(f=>{const v=Wp(f);v instanceof ys?c=v:c&&v&&c!==v&&(c=new ys("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),c}var Ml,Kv,Ex=function(){if(Kv)return Ml;Kv=1,Ml=c;var g=3;function c(f,v,S){var x=this.cells=[];if(f instanceof ArrayBuffer){this.arrayBuffer=f;var A=new Int32Array(this.arrayBuffer);f=A[0],this.d=(v=A[1])+2*(S=A[2]);for(var D=0;D<this.d*this.d;D++){var U=A[g+D],H=A[g+D+1];x.push(U===H?null:A.subarray(U,H))}var R=A[g+x.length+1];this.keys=A.subarray(A[g+x.length],R),this.bboxes=A.subarray(R),this.insert=this._insertReadonly}else{this.d=v+2*S;for(var N=0;N<this.d*this.d;N++)x.push([]);this.keys=[],this.bboxes=[]}this.n=v,this.extent=f,this.padding=S,this.scale=v/f,this.uid=0;var G=S/v*f;this.min=-G,this.max=f+G}return c.prototype.insert=function(f,v,S,x,A){this._forEachCell(v,S,x,A,this._insertCell,this.uid++),this.keys.push(f),this.bboxes.push(v),this.bboxes.push(S),this.bboxes.push(x),this.bboxes.push(A)},c.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},c.prototype._insertCell=function(f,v,S,x,A,D){this.cells[A].push(D)},c.prototype.query=function(f,v,S,x,A){var D=this.min,U=this.max;if(f<=D&&v<=D&&U<=S&&U<=x&&!A)return Array.prototype.slice.call(this.keys);var H=[];return this._forEachCell(f,v,S,x,this._queryCell,H,{},A),H},c.prototype._queryCell=function(f,v,S,x,A,D,U,H){var R=this.cells[A];if(R!==null)for(var N=this.keys,G=this.bboxes,z=0;z<R.length;z++){var V=R[z];if(U[V]===void 0){var X=4*V;(H?H(G[X+0],G[X+1],G[X+2],G[X+3]):f<=G[X+2]&&v<=G[X+3]&&S>=G[X+0]&&x>=G[X+1])?(U[V]=!0,D.push(N[V])):U[V]=!1}}},c.prototype._forEachCell=function(f,v,S,x,A,D,U,H){for(var R=this._convertToCellCoord(f),N=this._convertToCellCoord(v),G=this._convertToCellCoord(S),z=this._convertToCellCoord(x),V=R;V<=G;V++)for(var X=N;X<=z;X++){var K=this.d*X+V;if((!H||H(this._convertFromCellCoord(V),this._convertFromCellCoord(X),this._convertFromCellCoord(V+1),this._convertFromCellCoord(X+1)))&&A.call(this,f,v,S,x,K,D,U,H))return}},c.prototype._convertFromCellCoord=function(f){return(f-this.padding)/this.scale},c.prototype._convertToCellCoord=function(f){return Math.max(0,Math.min(this.d-1,Math.floor(f*this.scale)+this.padding))},c.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var f=this.cells,v=g+this.cells.length+1+1,S=0,x=0;x<this.cells.length;x++)S+=this.cells[x].length;var A=new Int32Array(v+S+this.keys.length+this.bboxes.length);A[0]=this.extent,A[1]=this.n,A[2]=this.padding;for(var D=v,U=0;U<f.length;U++){var H=f[U];A[g+U]=D,A.set(H,D),D+=H.length}return A[g+f.length]=D,A.set(this.keys,D),A[g+f.length+1]=D+=this.keys.length,A.set(this.bboxes,D),D+=this.bboxes.length,A.buffer},Ml}(),zc=h(Ex);const Cl={};function Fn(g,c,f={}){Object.defineProperty(g,"_classRegistryKey",{value:c,writable:!1}),Cl[c]={klass:g,omit:f.omit||[]}}Fn(Object,"Object"),zc.serialize=function(g,c){const f=g.toArrayBuffer();return c&&c.add(f),{buffer:f}},zc.deserialize=function(g){return new zc(g.buffer)},Object.defineProperty(zc,"name",{value:"Grid"}),Fn(zc,"Grid"),Fn(vr,"Color"),Fn(Error,"Error"),Fn(Po,"Formatted"),Fn(Us,"FormattedSection"),Fn(qr,"AJAXError"),Fn($o,"ResolvedImage"),Fn(xd,"StylePropertyFunction"),Fn(jp,"StyleExpression",{omit:["_evaluator"]}),Fn(hl,"ZoomDependentExpression"),Fn(Rg,"ZoomConstantExpression"),Fn(La,"CompoundExpression",{omit:["_evaluate"]});for(const g in yu)Cl[yu[g]._classRegistryKey]||Fn(yu[g],`Expression${g}`);function sr(g){return g&&typeof ArrayBuffer<"u"&&(g instanceof ArrayBuffer||g.constructor&&g.constructor.name==="ArrayBuffer")}function Xp(g){return self.ImageBitmap&&g instanceof ImageBitmap}function _a(g,c){if(g==null||typeof g=="boolean"||typeof g=="number"||typeof g=="string"||g instanceof Boolean||g instanceof Number||g instanceof String||g instanceof Date||g instanceof RegExp)return g;if(sr(g)||Xp(g))return c&&c.add(g),g;if(ArrayBuffer.isView(g)){const f=g;return c&&c.add(f.buffer),f}if(g instanceof ImageData)return c&&c.add(g.data.buffer),g;if(Array.isArray(g)){const f=[];for(const v of g)f.push(_a(v,c));return f}if(g instanceof Map){const f={$name:"Map"};for(const[v,S]of g.entries())f[v]=_a(S);return f}if(g instanceof Set){const f={$name:"Set"};let v=0;for(const S of g.values())f[++v]=_a(S);return f}if(typeof g=="object"){const f=g.constructor,v=f._classRegistryKey;if(!v)throw new Error(`can't serialize object of unregistered class ${v}`);const S=f.serialize?f.serialize(g,c):{};if(!f.serialize){for(const x in g)g.hasOwnProperty(x)&&(Cl[v].omit.indexOf(x)>=0||(S[x]=_a(g[x],c)));g instanceof Error&&(S.message=g.message)}if(S.$name)throw new Error("$name property is reserved for worker serialization logic.");return v!=="Object"&&(S.$name=v),S}throw new Error("can't serialize object of type "+typeof g)}function qu(g){if(g==null||typeof g=="boolean"||typeof g=="number"||typeof g=="string"||g instanceof Boolean||g instanceof Number||g instanceof String||g instanceof Date||g instanceof RegExp||sr(g)||Xp(g)||ArrayBuffer.isView(g)||g instanceof ImageData)return g;if(Array.isArray(g))return g.map(qu);if(typeof g=="object"){const c=g.$name||"Object";if(c==="Map"){const S=new Map;for(const x of Object.keys(g))x!=="$name"&&S.set(x,qu(g[x]));return S}if(c==="Set"){const S=new Set;for(const x of Object.keys(g))x!=="$name"&&S.add(qu(g[x]));return S}const{klass:f}=Cl[c];if(!f)throw new Error(`can't deserialize unregistered class ${c}`);if(f.deserialize)return f.deserialize(g);const v=Object.create(f.prototype);for(const S of Object.keys(g))S!=="$name"&&(v[S]=qu(g[S]));return v}throw new Error("can't deserialize object of type "+typeof g)}const Yn={"Latin-1 Supplement":g=>g>=128&&g<=255,Arabic:g=>g>=1536&&g<=1791,"Arabic Supplement":g=>g>=1872&&g<=1919,"Arabic Extended-A":g=>g>=2208&&g<=2303,"Hangul Jamo":g=>g>=4352&&g<=4607,"Unified Canadian Aboriginal Syllabics":g=>g>=5120&&g<=5759,Khmer:g=>g>=6016&&g<=6143,"Unified Canadian Aboriginal Syllabics Extended":g=>g>=6320&&g<=6399,"General Punctuation":g=>g>=8192&&g<=8303,"Letterlike Symbols":g=>g>=8448&&g<=8527,"Number Forms":g=>g>=8528&&g<=8591,"Miscellaneous Technical":g=>g>=8960&&g<=9215,"Control Pictures":g=>g>=9216&&g<=9279,"Optical Character Recognition":g=>g>=9280&&g<=9311,"Enclosed Alphanumerics":g=>g>=9312&&g<=9471,"Geometric Shapes":g=>g>=9632&&g<=9727,"Miscellaneous Symbols":g=>g>=9728&&g<=9983,"Miscellaneous Symbols and Arrows":g=>g>=11008&&g<=11263,"CJK Radicals Supplement":g=>g>=11904&&g<=12031,"Kangxi Radicals":g=>g>=12032&&g<=12255,"Ideographic Description Characters":g=>g>=12272&&g<=12287,"CJK Symbols and Punctuation":g=>g>=12288&&g<=12351,Hiragana:g=>g>=12352&&g<=12447,Katakana:g=>g>=12448&&g<=12543,Bopomofo:g=>g>=12544&&g<=12591,"Hangul Compatibility Jamo":g=>g>=12592&&g<=12687,Kanbun:g=>g>=12688&&g<=12703,"Bopomofo Extended":g=>g>=12704&&g<=12735,"CJK Strokes":g=>g>=12736&&g<=12783,"Katakana Phonetic Extensions":g=>g>=12784&&g<=12799,"Enclosed CJK Letters and Months":g=>g>=12800&&g<=13055,"CJK Compatibility":g=>g>=13056&&g<=13311,"CJK Unified Ideographs Extension A":g=>g>=13312&&g<=19903,"Yijing Hexagram Symbols":g=>g>=19904&&g<=19967,"CJK Unified Ideographs":g=>g>=19968&&g<=40959,"Yi Syllables":g=>g>=40960&&g<=42127,"Yi Radicals":g=>g>=42128&&g<=42191,"Hangul Jamo Extended-A":g=>g>=43360&&g<=43391,"Hangul Syllables":g=>g>=44032&&g<=55215,"Hangul Jamo Extended-B":g=>g>=55216&&g<=55295,"Private Use Area":g=>g>=57344&&g<=63743,"CJK Compatibility Ideographs":g=>g>=63744&&g<=64255,"Arabic Presentation Forms-A":g=>g>=64336&&g<=65023,"Vertical Forms":g=>g>=65040&&g<=65055,"CJK Compatibility Forms":g=>g>=65072&&g<=65103,"Small Form Variants":g=>g>=65104&&g<=65135,"Arabic Presentation Forms-B":g=>g>=65136&&g<=65279,"Halfwidth and Fullwidth Forms":g=>g>=65280&&g<=65519,"CJK Unified Ideographs Extension B":g=>g>=131072&&g<=173791};function Uc(g){for(const c of g)if(qp(c.charCodeAt(0)))return!0;return!1}function $p(g){for(const c of g)if(!bd(c.charCodeAt(0)))return!1;return!0}function bd(g){return!(Yn.Arabic(g)||Yn["Arabic Supplement"](g)||Yn["Arabic Extended-A"](g)||Yn["Arabic Presentation Forms-A"](g)||Yn["Arabic Presentation Forms-B"](g))}function qp(g){return!(g!==746&&g!==747&&(g<4352||!(Yn["Bopomofo Extended"](g)||Yn.Bopomofo(g)||Yn["CJK Compatibility Forms"](g)&&!(g>=65097&&g<=65103)||Yn["CJK Compatibility Ideographs"](g)||Yn["CJK Compatibility"](g)||Yn["CJK Radicals Supplement"](g)||Yn["CJK Strokes"](g)||!(!Yn["CJK Symbols and Punctuation"](g)||g>=12296&&g<=12305||g>=12308&&g<=12319||g===12336)||Yn["CJK Unified Ideographs Extension A"](g)||Yn["CJK Unified Ideographs"](g)||Yn["Enclosed CJK Letters and Months"](g)||Yn["Hangul Compatibility Jamo"](g)||Yn["Hangul Jamo Extended-A"](g)||Yn["Hangul Jamo Extended-B"](g)||Yn["Hangul Jamo"](g)||Yn["Hangul Syllables"](g)||Yn.Hiragana(g)||Yn["Ideographic Description Characters"](g)||Yn.Kanbun(g)||Yn["Kangxi Radicals"](g)||Yn["Katakana Phonetic Extensions"](g)||Yn.Katakana(g)&&g!==12540||!(!Yn["Halfwidth and Fullwidth Forms"](g)||g===65288||g===65289||g===65293||g>=65306&&g<=65310||g===65339||g===65341||g===65343||g>=65371&&g<=65503||g===65507||g>=65512&&g<=65519)||!(!Yn["Small Form Variants"](g)||g>=65112&&g<=65118||g>=65123&&g<=65126)||Yn["Unified Canadian Aboriginal Syllabics"](g)||Yn["Unified Canadian Aboriginal Syllabics Extended"](g)||Yn["Vertical Forms"](g)||Yn["Yijing Hexagram Symbols"](g)||Yn["Yi Syllables"](g)||Yn["Yi Radicals"](g))))}function wd(g){return!(qp(g)||function(c){return!!(Yn["Latin-1 Supplement"](c)&&(c===167||c===169||c===174||c===177||c===188||c===189||c===190||c===215||c===247)||Yn["General Punctuation"](c)&&(c===8214||c===8224||c===8225||c===8240||c===8241||c===8251||c===8252||c===8258||c===8263||c===8264||c===8265||c===8273)||Yn["Letterlike Symbols"](c)||Yn["Number Forms"](c)||Yn["Miscellaneous Technical"](c)&&(c>=8960&&c<=8967||c>=8972&&c<=8991||c>=8996&&c<=9e3||c===9003||c>=9085&&c<=9114||c>=9150&&c<=9165||c===9167||c>=9169&&c<=9179||c>=9186&&c<=9215)||Yn["Control Pictures"](c)&&c!==9251||Yn["Optical Character Recognition"](c)||Yn["Enclosed Alphanumerics"](c)||Yn["Geometric Shapes"](c)||Yn["Miscellaneous Symbols"](c)&&!(c>=9754&&c<=9759)||Yn["Miscellaneous Symbols and Arrows"](c)&&(c>=11026&&c<=11055||c>=11088&&c<=11097||c>=11192&&c<=11243)||Yn["CJK Symbols and Punctuation"](c)||Yn.Katakana(c)||Yn["Private Use Area"](c)||Yn["CJK Compatibility Forms"](c)||Yn["Small Form Variants"](c)||Yn["Halfwidth and Fullwidth Forms"](c)||c===8734||c===8756||c===8757||c>=9984&&c<=10087||c>=10102&&c<=10131||c===65532||c===65533)}(g))}function Pg(g){return g>=1424&&g<=2303||Yn["Arabic Presentation Forms-A"](g)||Yn["Arabic Presentation Forms-B"](g)}function Ix(g,c){return!(!c&&Pg(g)||g>=2304&&g<=3583||g>=3840&&g<=4255||Yn.Khmer(g))}function Rx(g){for(const c of g)if(Pg(c.charCodeAt(0)))return!0;return!1}const Sd="deferred",rf="loading",Ad="loaded";let sf=null,ao="unavailable",sc=null;const Px=function(g){g&&typeof g=="string"&&g.indexOf("NetworkError")>-1&&(ao="error"),sf&&sf(g)};function Jv(){Lg.fire(new Yl("pluginStateChange",{pluginStatus:ao,pluginURL:sc}))}const Lg=new zu,Dg=function(){return ao},Bg=function(){if(ao!==Sd||!sc)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ao=rf,Jv(),sc&&Ps({url:sc},g=>{g?Px(g):(ao=Ad,Jv())})},Oa={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>ao===Ad||Oa.applyArabicShaping!=null,isLoading:()=>ao===rf,setState(g){ao=g.pluginStatus,sc=g.pluginURL},isParsed:()=>Oa.applyArabicShaping!=null&&Oa.processBidirectionalText!=null&&Oa.processStyledBidirectionalText!=null,getPluginURL:()=>sc};class hs{constructor(c,f){this.zoom=c,f?(this.now=f.now,this.fadeDuration=f.fadeDuration,this.transition=f.transition,this.pitch=f.pitch,this.brightness=f.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(c){return function(f,v){for(const S of f)if(!Ix(S.charCodeAt(0),v))return!1;return!0}(c,Oa.isLoaded())}}class of{constructor(c,f,v,S){this.property=c,this.value=f,this.expression=function(x,A,D,U){if(Gp(x))return new xd(x,A);if(_d(x)||Array.isArray(x)&&x.length>0){const H=Yv(x,A,D,U);if(H.result==="error")throw new Error(H.value.map(R=>`${R.key}: ${R.message}`).join(", "));return H.value}{let H=x;return typeof x=="string"&&A.type==="color"&&(H=vr.parse(x)),{kind:"constant",configDependencies:new Set,evaluate:()=>H}}}(f===void 0?c.specification.default:f,c.specification,v,S)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(c,f,v){return this.property.possiblyEvaluate(this,c,f,v)}}class Td{constructor(c,f,v){this.property=c,this.value=new of(c,void 0,f,v)}transitioned(c,f){return new Yp(this.property,this.value,f,Sr({},c.transition,this.transition),c.now)}untransitioned(){return new Yp(this.property,this.value,null,{},0)}}class Zp{constructor(c,f,v){this._properties=c,this._values=Object.create(c.defaultTransitionablePropertyValues),this._scope=f,this._options=v,this.configDependencies=new Set}getValue(c){return _i(this._values[c].value.value)}setValue(c,f){this._values.hasOwnProperty(c)||(this._values[c]=new Td(this._values[c].property,this._scope,this._options)),this._values[c].value=new of(this._values[c].property,f===null?void 0:_i(f),this._scope,this._options),this._values[c].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[c].value.expression.configDependencies]))}setTransitionOrValue(c,f){f&&(this._options=f);const v=this._properties.properties;if(c)for(const S in c){const x=c[S];if(or(S,"-transition")){const A=S.slice(0,-11);v[A]&&this.setTransition(A,x)}else v.hasOwnProperty(S)&&this.setValue(S,x)}}getTransition(c){return _i(this._values[c].transition)}setTransition(c,f){this._values.hasOwnProperty(c)||(this._values[c]=new Td(this._values[c].property)),this._values[c].transition=_i(f)||void 0}serialize(){const c={};for(const f of Object.keys(this._values)){const v=this.getValue(f);v!==void 0&&(c[f]=v);const S=this.getTransition(f);S!==void 0&&(c[`${f}-transition`]=S)}return c}transitioned(c,f){const v=new Md(this._properties);for(const S of Object.keys(this._values))v._values[S]=this._values[S].transitioned(c,f._values[S]);return v}untransitioned(){const c=new Md(this._properties);for(const f of Object.keys(this._values))c._values[f]=this._values[f].untransitioned();return c}}class Yp{constructor(c,f,v,S,x){const A=S.delay||0,D=S.duration||0;x=x||0,this.property=c,this.value=f,this.begin=x+A,this.end=this.begin+D,c.specification.transition&&(S.delay||S.duration)&&(this.prior=v)}possiblyEvaluate(c,f,v){const S=c.now||0,x=this.value.possiblyEvaluate(c,f,v),A=this.prior;if(A){if(S>this.end)return this.prior=null,x;if(this.value.isDataDriven())return this.prior=null,x;if(S<this.begin)return A.possiblyEvaluate(c,f,v);{const D=(S-this.begin)/(this.end-this.begin);return this.property.interpolate(A.possiblyEvaluate(c,f,v),x,$t(D))}}return x}}class Md{constructor(c){this._properties=c,this._values=Object.create(c.defaultTransitioningPropertyValues)}possiblyEvaluate(c,f,v){const S=new Yu(this._properties);for(const x of Object.keys(this._values))S._values[x]=this._values[x].possiblyEvaluate(c,f,v);return S}hasTransition(){for(const c of Object.keys(this._values))if(this._values[c].prior)return!0;return!1}}class Qv{constructor(c,f,v){this._properties=c,this._values=Object.create(c.defaultPropertyValues),this._scope=f,this._options=v,this.configDependencies=new Set}getValue(c){return _i(this._values[c].value)}setValue(c,f){this._values[c]=new of(this._values[c].property,f===null?void 0:_i(f),this._scope,this._options),this._values[c].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[c].expression.configDependencies]))}serialize(){const c={};for(const f of Object.keys(this._values)){const v=this.getValue(f);v!==void 0&&(c[f]=v)}return c}possiblyEvaluate(c,f,v){const S=new Yu(this._properties);for(const x of Object.keys(this._values))S._values[x]=this._values[x].possiblyEvaluate(c,f,v);return S}}class Zu{constructor(c,f,v){this.property=c,this.value=f,this.parameters=v}isConstant(){return this.value.kind==="constant"}constantOr(c){return this.value.kind==="constant"?this.value.value:c}evaluate(c,f,v,S){return this.property.evaluate(this.value,this.parameters,c,f,v,S)}}class Yu{constructor(c){this._properties=c,this._values=Object.create(c.defaultPossiblyEvaluatedValues)}get(c){return this._values[c]}}class gn{constructor(c){this.specification=c}possiblyEvaluate(c,f){return c.expression.evaluate(f)}interpolate(c,f,v){const S=zh[this.specification.type];return S?S(c,f,v):c}}class Kn{constructor(c,f){this.specification=c,this.overrides=f}possiblyEvaluate(c,f,v,S){return new Zu(this,c.expression.kind==="constant"||c.expression.kind==="camera"?{kind:"constant",value:c.expression.evaluate(f,null,{},v,S)}:c.expression,f)}interpolate(c,f,v){if(c.value.kind!=="constant"||f.value.kind!=="constant")return c;if(c.value.value===void 0||f.value.value===void 0)return new Zu(this,{kind:"constant",value:void 0},c.parameters);const S=zh[this.specification.type];return S?new Zu(this,{kind:"constant",value:S(c.value.value,f.value.value,v)},c.parameters):c}evaluate(c,f,v,S,x,A){return c.kind==="constant"?c.value:c.evaluate(f,v,S,x,A)}}class oc{constructor(c){this.specification=c}possiblyEvaluate(c,f,v,S){return!!c.expression.evaluate(f,null,{},v,S)}interpolate(){return!1}}class Hi{constructor(c){this.properties=c,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const f=new hs(0,{});for(const v in c){const S=c[v];S.specification.overridable&&this.overridableProperties.push(v);const x=this.defaultPropertyValues[v]=new of(S,void 0),A=this.defaultTransitionablePropertyValues[v]=new Td(S);this.defaultTransitioningPropertyValues[v]=A.untransitioned(),this.defaultPossiblyEvaluatedValues[v]=x.possiblyEvaluate(f)}}}Fn(Kn,"DataDrivenProperty"),Fn(gn,"DataConstantProperty"),Fn(oc,"ColorRampProperty");var At=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"experimental":true,"type":"featuresets"}},"featuresets":{"experimental":true,"*":{"type":"featureset"}},"featureset":{"experimental":true,"selectors":{"type":"array","value":"selector"}},"selector":{"experimental":true,"layer":{"type":"string","required":true},"properties":{"type":"selectorProperty","required":false},"featureNamespace":{"type":"string","required":false}},"selectorProperty":{"experimental":true,"*":{"type":"*"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{"experimental":true}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant","experimental":true},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant","experimental":true}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1},"default":"ground","experimental":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]},"property-type":"data-constant"},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Ds(g){return g instanceof Number||g instanceof String||g instanceof Boolean?g.valueOf():g}function fi(g){if(Array.isArray(g))return g.map(fi);if(g instanceof Object&&!(g instanceof Number||g instanceof String||g instanceof Boolean)){const c={};for(const f in g)c[f]=fi(g[f]);return c}return Ds(g)}function Ys(g){if(g===!0||g===!1)return!0;if(!Array.isArray(g)||g.length===0)return!1;switch(g[0]){case"has":return g.length>=2&&g[1]!=="$id"&&g[1]!=="$type";case"in":return g.length>=3&&(typeof g[1]!="string"||Array.isArray(g[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return g.length!==3||Array.isArray(g[1])||Array.isArray(g[2]);case"any":case"all":for(const c of g.slice(1))if(!Ys(c)&&typeof c!="boolean")return!1;return!0;default:return!0}}function ts(g,c="",f=null,v="fill"){if(g==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Ys(g)||(g=lf(g));const S=g;let x=!0;try{x=function(N){if(!ac(N))return N;let G=fi(N);return Bo(G),G=Do(G),G}(S)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(S,null,2)}
        `)}const A=At[`filter_${v}`],D=yd(x,A,c,f);let U=null;if(D.result==="error")throw new Error(D.value.map(N=>`${N.key}: ${N.message}`).join(", "));U=(N,G,z)=>D.value.evaluate(N,G,{},z);let H=null,R=null;if(x!==S){const N=yd(S,A,c,f);if(N.result==="error")throw new Error(N.value.map(G=>`${G.key}: ${G.message}`).join(", "));H=(G,z,V,X,K)=>N.value.evaluate(G,z,{},V,void 0,void 0,X,K),R=!Yh(N.value.expression)}return{filter:U,dynamicFilter:H||void 0,needGeometry:af(x),needFeature:!!R}}function Do(g){if(!Array.isArray(g))return g;const c=function(f){if(ko.has(f[0])){for(let v=1;v<f.length;v++)if(ac(f[v]))return!0}return f}(g);return c===!0?c:c.map(f=>Do(f))}function Bo(g){let c=!1;const f=[];if(g[0]==="case"){for(let v=1;v<g.length-1;v+=2)c=c||ac(g[v]),f.push(g[v+1]);f.push(g[g.length-1])}else if(g[0]==="match"){c=c||ac(g[1]);for(let v=2;v<g.length-1;v+=2)f.push(g[v+1]);f.push(g[g.length-1])}else if(g[0]==="step"){c=c||ac(g[1]);for(let v=1;v<g.length-1;v+=2)f.push(g[v+1])}c&&(g.length=0,g.push("any",...f));for(let v=1;v<g.length;v++)Bo(g[v])}function ac(g){if(!Array.isArray(g))return!1;if((c=g[0])==="pitch"||c==="distance-from-center")return!0;var c;for(let f=1;f<g.length;f++)if(ac(g[f]))return!0;return!1}const ko=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Kp(g,c){return g<c?-1:g>c?1:0}function af(g){if(!Array.isArray(g))return!1;if(g[0]==="within"||g[0]==="distance")return!0;for(let c=1;c<g.length;c++)if(af(g[c]))return!0;return!1}function lf(g){if(!g)return!0;const c=g[0];return g.length<=1?c!=="any":c==="=="?Cd(g[1],g[2],"=="):c==="!="?cf(Cd(g[1],g[2],"==")):c==="<"||c===">"||c==="<="||c===">="?Cd(g[1],g[2],c):c==="any"?(f=g.slice(1),["any"].concat(f.map(lf))):c==="all"?["all"].concat(g.slice(1).map(lf)):c==="none"?["all"].concat(g.slice(1).map(lf).map(cf)):c==="in"?Ku(g[1],g.slice(2)):c==="!in"?cf(Ku(g[1],g.slice(2))):c==="has"?Zo(g[1]):c!=="!has"||cf(Zo(g[1]));var f}function Cd(g,c,f){switch(g){case"$type":return[`filter-type-${f}`,c];case"$id":return[`filter-id-${f}`,c];default:return[`filter-${f}`,g,c]}}function Ku(g,c){if(c.length===0)return!1;switch(g){case"$type":return["filter-type-in",["literal",c]];case"$id":return["filter-id-in",["literal",c]];default:return c.length>200&&!c.some(f=>typeof f!=typeof c[0])?["filter-in-large",g,["literal",c.sort(Kp)]]:["filter-in-small",g,["literal",c]]}}function Zo(g){switch(g){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",g]}}function cf(g){return["!",g]}const Ju="";function uf(g,c){return c?`${g}${Ju}${c}`:g}const Ka="-transition",e_=new Set(["fill","line","background","hillshade","raster"]);class Gs extends zu{constructor(c,f,v,S,x){if(super(),this.id=c.id,this.fqid=uf(this.id,v),this.type=c.type,this.scope=v,this.lut=S,this.options=x,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,c.type!=="custom"&&(this.metadata=c.metadata,this.minzoom=c.minzoom,this.maxzoom=c.maxzoom,c.type!=="background"&&c.type!=="sky"&&c.type!=="slot"&&(this.source=c.source,this.sourceLayer=c["source-layer"],this.filter=c.filter),c.slot&&(this.slot=c.slot),f.layout&&(this._unevaluatedLayout=new Qv(f.layout,this.scope,x),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),f.paint)){this._transitionablePaint=new Zp(f.paint,this.scope,x);for(const A in c.paint)this.setPaintProperty(A,c.paint[A]);for(const A in c.layout)this.setLayoutProperty(A,c.layout[A]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Yu(f.paint)}}onAdd(c){}onRemove(c){}isDraped(c){return!this.is3D()&&e_.has(this.type)}getLayoutProperty(c){return c==="visibility"?this.visibility:this._unevaluatedLayout.getValue(c)}setLayoutProperty(c,f){if(this.type==="custom"&&c==="visibility")return void(this.visibility=f);const v=this._unevaluatedLayout;v._properties.properties[c]&&(v.setValue(c,f),this.configDependencies=new Set([...this.configDependencies,...v.configDependencies]),c==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(c){return or(c,Ka)?this._transitionablePaint.getTransition(c.slice(0,-11)):this._transitionablePaint.getValue(c)}setPaintProperty(c,f){const v=this._transitionablePaint,S=v._properties.properties;if(or(c,Ka)){const N=c.slice(0,-11);return S[N]&&v.setTransition(N,f||void 0),!1}if(!S[c])return!1;const x=v._values[c],A=x.value.isDataDriven(),D=x.value;v.setValue(c,f),this.configDependencies=new Set([...this.configDependencies,...v.configDependencies]),this._handleSpecialPaintPropertyUpdate(c);const U=v._values[c].value,H=U.isDataDriven(),R=or(c,"pattern")||c==="line-dasharray";return H||A||R||this._handleOverridablePaintPropertyUpdate(c,D,U)}_handleSpecialPaintPropertyUpdate(c){}getProgramIds(){return null}getDefaultProgramParams(c,f,v){return null}_handleOverridablePaintPropertyUpdate(c,f,v){return!1}isHidden(c){return!!(this.minzoom&&c<this.minzoom)||!!(this.maxzoom&&c>=this.maxzoom)||this.visibility==="none"}updateTransitions(c){this._transitioningPaint=this._transitionablePaint.transitioned(c,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(c,f){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(c,void 0,f)),this.paint=this._transitioningPaint.possiblyEvaluate(c,void 0,f)}serialize(){return Hr({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(c,f)=>!(c===void 0||f==="layout"&&!Object.keys(c).length||f==="paint"&&!Object.keys(c).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const c in this.paint._values){const f=this.paint.get(c);if(f instanceof Zu&&Vp(f.property.specification)&&(f.value.kind==="source"||f.value.kind==="composite")&&f.value.isStateDependent)return!0}return!1}compileFilter(c){this._filterCompiled||(this._featureFilter=ts(this.filter,this.scope,c),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(c){this._stats&&(c.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(c){}queryIntersectsFeature(c,f,v,S,x,A,D,U,H){}queryIntersectsMatchingFeature(c,f,v,S){}}const kg={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class El{constructor(c,f){this._structArray=c,this._pos1=f*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ki{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(c,f){return c._trim(),f&&(c.isTransferred=!0,f.add(c.arrayBuffer)),{length:c.length,arrayBuffer:c.arrayBuffer}}static deserialize(c){const f=Object.create(this.prototype);return f.arrayBuffer=c.arrayBuffer,f.length=c.length,f.capacity=c.arrayBuffer.byteLength/f.bytesPerElement,f._refreshViews(),f}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(c){this.reserve(c),this.length=c}reserve(c){if(c>this.capacity){this.capacity=Math.max(c,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const f=this.uint8;this._refreshViews(),f&&this.uint8.set(f)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...c){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...c){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Qr(g,c=1){let f=0,v=0;return{members:g.map(S=>{const x=kg[S.type].BYTES_PER_ELEMENT,A=f=Og(f,Math.max(c,x)),D=S.components||1;return v=Math.max(v,x),f+=x*D,{name:S.name,type:S.type,components:D,offset:A}}),size:Og(f,Math.max(v,c)),alignment:c}}function Og(g,c){return Math.ceil(g/c)*c}class lc extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,f){const v=this.length;return this.resize(v+1),this.emplace(v,c,f)}emplace(c,f,v){const S=2*c;return this.int16[S+0]=f,this.int16[S+1]=v,c}}lc.prototype.bytesPerElement=4,Fn(lc,"StructArrayLayout2i4");class hf extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,f,v){const S=this.length;return this.resize(S+1),this.emplace(S,c,f,v)}emplace(c,f,v,S){const x=3*c;return this.int16[x+0]=f,this.int16[x+1]=v,this.int16[x+2]=S,c}}hf.prototype.bytesPerElement=6,Fn(hf,"StructArrayLayout3i6");class Ks extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,f,v,S){const x=this.length;return this.resize(x+1),this.emplace(x,c,f,v,S)}emplace(c,f,v,S,x){const A=4*c;return this.int16[A+0]=f,this.int16[A+1]=v,this.int16[A+2]=S,this.int16[A+3]=x,c}}Ks.prototype.bytesPerElement=8,Fn(Ks,"StructArrayLayout4i8");class cc extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,f,v,S,x){const A=this.length;return this.resize(A+1),this.emplace(A,c,f,v,S,x)}emplace(c,f,v,S,x,A){const D=5*c;return this.int16[D+0]=f,this.int16[D+1]=v,this.int16[D+2]=S,this.int16[D+3]=x,this.int16[D+4]=A,c}}cc.prototype.bytesPerElement=10,Fn(cc,"StructArrayLayout5i10");class Ja extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,f,v,S,x,A,D){const U=this.length;return this.resize(U+1),this.emplace(U,c,f,v,S,x,A,D)}emplace(c,f,v,S,x,A,D,U){const H=6*c,R=12*c,N=3*c;return this.int16[H+0]=f,this.int16[H+1]=v,this.uint8[R+4]=S,this.uint8[R+5]=x,this.uint8[R+6]=A,this.uint8[R+7]=D,this.float32[N+2]=U,c}}Ja.prototype.bytesPerElement=12,Fn(Ja,"StructArrayLayout2i4ub1f12");class Il extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,f,v,S){const x=this.length;return this.resize(x+1),this.emplace(x,c,f,v,S)}emplace(c,f,v,S,x){const A=4*c;return this.float32[A+0]=f,this.float32[A+1]=v,this.float32[A+2]=S,this.float32[A+3]=x,c}}Il.prototype.bytesPerElement=16,Fn(Il,"StructArrayLayout4f16");class lo extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,f,v){const S=this.length;return this.resize(S+1),this.emplace(S,c,f,v)}emplace(c,f,v,S){const x=3*c;return this.float32[x+0]=f,this.float32[x+1]=v,this.float32[x+2]=S,c}}lo.prototype.bytesPerElement=12,Fn(lo,"StructArrayLayout3f12");class Vc extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,f,v,S,x){const A=this.length;return this.resize(A+1),this.emplace(A,c,f,v,S,x)}emplace(c,f,v,S,x,A){const D=6*c,U=3*c;return this.uint16[D+0]=f,this.uint16[D+1]=v,this.uint16[D+2]=S,this.uint16[D+3]=x,this.float32[U+2]=A,c}}Vc.prototype.bytesPerElement=12,Fn(Vc,"StructArrayLayout4ui1f12");class xu extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,f,v,S){const x=this.length;return this.resize(x+1),this.emplace(x,c,f,v,S)}emplace(c,f,v,S,x){const A=4*c;return this.uint16[A+0]=f,this.uint16[A+1]=v,this.uint16[A+2]=S,this.uint16[A+3]=x,c}}xu.prototype.bytesPerElement=8,Fn(xu,"StructArrayLayout4ui8");class Ed extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,f,v,S,x,A){const D=this.length;return this.resize(D+1),this.emplace(D,c,f,v,S,x,A)}emplace(c,f,v,S,x,A,D){const U=6*c;return this.int16[U+0]=f,this.int16[U+1]=v,this.int16[U+2]=S,this.int16[U+3]=x,this.int16[U+4]=A,this.int16[U+5]=D,c}}Ed.prototype.bytesPerElement=12,Fn(Ed,"StructArrayLayout6i12");class t_ extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,f,v,S,x,A,D,U,H,R,N,G){const z=this.length;return this.resize(z+1),this.emplace(z,c,f,v,S,x,A,D,U,H,R,N,G)}emplace(c,f,v,S,x,A,D,U,H,R,N,G,z){const V=12*c;return this.int16[V+0]=f,this.int16[V+1]=v,this.int16[V+2]=S,this.int16[V+3]=x,this.uint16[V+4]=A,this.uint16[V+5]=D,this.uint16[V+6]=U,this.uint16[V+7]=H,this.int16[V+8]=R,this.int16[V+9]=N,this.int16[V+10]=G,this.int16[V+11]=z,c}}t_.prototype.bytesPerElement=24,Fn(t_,"StructArrayLayout4i4ui4i24");class Gc extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,f,v,S,x,A){const D=this.length;return this.resize(D+1),this.emplace(D,c,f,v,S,x,A)}emplace(c,f,v,S,x,A,D){const U=10*c,H=5*c;return this.int16[U+0]=f,this.int16[U+1]=v,this.int16[U+2]=S,this.float32[H+2]=x,this.float32[H+3]=A,this.float32[H+4]=D,c}}Gc.prototype.bytesPerElement=20,Fn(Gc,"StructArrayLayout3i3f20");class Fg extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(c){const f=this.length;return this.resize(f+1),this.emplace(f,c)}emplace(c,f){return this.uint32[1*c+0]=f,c}}Fg.prototype.bytesPerElement=4,Fn(Fg,"StructArrayLayout1ul4");class bu extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,f){const v=this.length;return this.resize(v+1),this.emplace(v,c,f)}emplace(c,f,v){const S=2*c;return this.uint16[S+0]=f,this.uint16[S+1]=v,c}}bu.prototype.bytesPerElement=4,Fn(bu,"StructArrayLayout2ui4");class Qu extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,f,v,S,x,A,D,U,H,R,N,G,z){const V=this.length;return this.resize(V+1),this.emplace(V,c,f,v,S,x,A,D,U,H,R,N,G,z)}emplace(c,f,v,S,x,A,D,U,H,R,N,G,z,V){const X=20*c,K=10*c;return this.int16[X+0]=f,this.int16[X+1]=v,this.int16[X+2]=S,this.int16[X+3]=x,this.int16[X+4]=A,this.float32[K+3]=D,this.float32[K+4]=U,this.float32[K+5]=H,this.float32[K+6]=R,this.int16[X+14]=N,this.uint32[K+8]=G,this.uint16[X+18]=z,this.uint16[X+19]=V,c}}Qu.prototype.bytesPerElement=40,Fn(Qu,"StructArrayLayout5i4f1i1ul2ui40");class fl extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,f,v,S,x,A,D){const U=this.length;return this.resize(U+1),this.emplace(U,c,f,v,S,x,A,D)}emplace(c,f,v,S,x,A,D,U){const H=8*c;return this.int16[H+0]=f,this.int16[H+1]=v,this.int16[H+2]=S,this.int16[H+4]=x,this.int16[H+5]=A,this.int16[H+6]=D,this.int16[H+7]=U,c}}fl.prototype.bytesPerElement=16,Fn(fl,"StructArrayLayout3i2i2i16");class ya extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,f,v,S,x){const A=this.length;return this.resize(A+1),this.emplace(A,c,f,v,S,x)}emplace(c,f,v,S,x,A){const D=4*c,U=8*c;return this.float32[D+0]=f,this.float32[D+1]=v,this.float32[D+2]=S,this.int16[U+6]=x,this.int16[U+7]=A,c}}ya.prototype.bytesPerElement=16,Fn(ya,"StructArrayLayout2f1f2i16");class ff extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,f,v,S,x,A){const D=this.length;return this.resize(D+1),this.emplace(D,c,f,v,S,x,A)}emplace(c,f,v,S,x,A,D){const U=20*c,H=5*c;return this.uint8[U+0]=f,this.uint8[U+1]=v,this.float32[H+1]=S,this.float32[H+2]=x,this.float32[H+3]=A,this.float32[H+4]=D,c}}ff.prototype.bytesPerElement=20,Fn(ff,"StructArrayLayout2ub4f20");class bo extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,f,v){const S=this.length;return this.resize(S+1),this.emplace(S,c,f,v)}emplace(c,f,v,S){const x=3*c;return this.uint16[x+0]=f,this.uint16[x+1]=v,this.uint16[x+2]=S,c}}bo.prototype.bytesPerElement=6,Fn(bo,"StructArrayLayout3ui6");class Id extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(c,f,v,S,x,A,D,U,H,R,N,G,z,V,X,K,ee,ce,he,ne,de){const ge=this.length;return this.resize(ge+1),this.emplace(ge,c,f,v,S,x,A,D,U,H,R,N,G,z,V,X,K,ee,ce,he,ne,de)}emplace(c,f,v,S,x,A,D,U,H,R,N,G,z,V,X,K,ee,ce,he,ne,de,ge){const Me=30*c,Be=15*c,Oe=60*c;return this.int16[Me+0]=f,this.int16[Me+1]=v,this.int16[Me+2]=S,this.float32[Be+2]=x,this.float32[Be+3]=A,this.uint16[Me+8]=D,this.uint16[Me+9]=U,this.uint32[Be+5]=H,this.uint32[Be+6]=R,this.uint32[Be+7]=N,this.uint16[Me+16]=G,this.uint16[Me+17]=z,this.uint16[Me+18]=V,this.float32[Be+10]=X,this.float32[Be+11]=K,this.uint8[Oe+48]=ee,this.uint8[Oe+49]=ce,this.uint8[Oe+50]=he,this.uint32[Be+13]=ne,this.int16[Me+28]=de,this.uint8[Oe+58]=ge,c}}Id.prototype.bytesPerElement=60,Fn(Id,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class n_ extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(c,f,v,S,x,A,D,U,H,R,N,G,z,V,X,K,ee,ce,he,ne,de,ge,Me,Be,Oe,Ie,Ye,ze,Qe,lt,ut,ht){const mt=this.length;return this.resize(mt+1),this.emplace(mt,c,f,v,S,x,A,D,U,H,R,N,G,z,V,X,K,ee,ce,he,ne,de,ge,Me,Be,Oe,Ie,Ye,ze,Qe,lt,ut,ht)}emplace(c,f,v,S,x,A,D,U,H,R,N,G,z,V,X,K,ee,ce,he,ne,de,ge,Me,Be,Oe,Ie,Ye,ze,Qe,lt,ut,ht,mt){const Et=20*c,vt=40*c,Ut=80*c;return this.float32[Et+0]=f,this.float32[Et+1]=v,this.int16[vt+4]=S,this.int16[vt+5]=x,this.int16[vt+6]=A,this.int16[vt+7]=D,this.int16[vt+8]=U,this.int16[vt+9]=H,this.int16[vt+10]=R,this.int16[vt+11]=N,this.int16[vt+12]=G,this.uint16[vt+13]=z,this.uint16[vt+14]=V,this.uint16[vt+15]=X,this.uint16[vt+16]=K,this.uint16[vt+17]=ee,this.uint16[vt+18]=ce,this.uint16[vt+19]=he,this.uint16[vt+20]=ne,this.uint16[vt+21]=de,this.uint16[vt+22]=ge,this.uint16[vt+23]=Me,this.uint16[vt+24]=Be,this.uint16[vt+25]=Oe,this.uint16[vt+26]=Ie,this.uint16[vt+27]=Ye,this.uint32[Et+14]=ze,this.float32[Et+15]=Qe,this.float32[Et+16]=lt,this.float32[Et+17]=ut,this.float32[Et+18]=ht,this.uint8[Ut+76]=mt,c}}n_.prototype.bytesPerElement=80,Fn(n_,"StructArrayLayout2f9i15ui1ul4f1ub80");class Rd extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c){const f=this.length;return this.resize(f+1),this.emplace(f,c)}emplace(c,f){return this.float32[1*c+0]=f,c}}Rd.prototype.bytesPerElement=4,Fn(Rd,"StructArrayLayout1f4");class Hc extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,f,v,S,x){const A=this.length;return this.resize(A+1),this.emplace(A,c,f,v,S,x)}emplace(c,f,v,S,x,A){const D=5*c;return this.float32[D+0]=f,this.float32[D+1]=v,this.float32[D+2]=S,this.float32[D+3]=x,this.float32[D+4]=A,c}}Hc.prototype.bytesPerElement=20,Fn(Hc,"StructArrayLayout5f20");class Ng extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,f,v,S,x,A,D){const U=this.length;return this.resize(U+1),this.emplace(U,c,f,v,S,x,A,D)}emplace(c,f,v,S,x,A,D,U){const H=7*c;return this.float32[H+0]=f,this.float32[H+1]=v,this.float32[H+2]=S,this.float32[H+3]=x,this.float32[H+4]=A,this.float32[H+5]=D,this.float32[H+6]=U,c}}Ng.prototype.bytesPerElement=28,Fn(Ng,"StructArrayLayout7f28");class uc extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,f,v,S){const x=this.length;return this.resize(x+1),this.emplace(x,c,f,v,S)}emplace(c,f,v,S,x){const A=6*c;return this.uint32[3*c+0]=f,this.uint16[A+2]=v,this.uint16[A+3]=S,this.uint16[A+4]=x,c}}uc.prototype.bytesPerElement=12,Fn(uc,"StructArrayLayout1ul3ui12");class r_ extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c){const f=this.length;return this.resize(f+1),this.emplace(f,c)}emplace(c,f){return this.uint16[1*c+0]=f,c}}r_.prototype.bytesPerElement=2,Fn(r_,"StructArrayLayout1ui2");class hc extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,f){const v=this.length;return this.resize(v+1),this.emplace(v,c,f)}emplace(c,f,v){const S=2*c;return this.float32[S+0]=f,this.float32[S+1]=v,c}}hc.prototype.bytesPerElement=8,Fn(hc,"StructArrayLayout2f8");class Pd extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,f,v,S,x,A,D,U,H,R,N,G,z,V,X,K){const ee=this.length;return this.resize(ee+1),this.emplace(ee,c,f,v,S,x,A,D,U,H,R,N,G,z,V,X,K)}emplace(c,f,v,S,x,A,D,U,H,R,N,G,z,V,X,K,ee){const ce=16*c;return this.float32[ce+0]=f,this.float32[ce+1]=v,this.float32[ce+2]=S,this.float32[ce+3]=x,this.float32[ce+4]=A,this.float32[ce+5]=D,this.float32[ce+6]=U,this.float32[ce+7]=H,this.float32[ce+8]=R,this.float32[ce+9]=N,this.float32[ce+10]=G,this.float32[ce+11]=z,this.float32[ce+12]=V,this.float32[ce+13]=X,this.float32[ce+14]=K,this.float32[ce+15]=ee,c}}Pd.prototype.bytesPerElement=64,Fn(Pd,"StructArrayLayout16f64");class la extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,f,v,S,x,A,D){const U=this.length;return this.resize(U+1),this.emplace(U,c,f,v,S,x,A,D)}emplace(c,f,v,S,x,A,D,U){const H=10*c,R=5*c;return this.uint16[H+0]=f,this.uint16[H+1]=v,this.uint16[H+2]=S,this.uint16[H+3]=x,this.float32[R+2]=A,this.float32[R+3]=D,this.float32[R+4]=U,c}}la.prototype.bytesPerElement=20,Fn(la,"StructArrayLayout4ui3f20");class zg extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c){const f=this.length;return this.resize(f+1),this.emplace(f,c)}emplace(c,f){return this.int16[1*c+0]=f,c}}zg.prototype.bytesPerElement=2,Fn(zg,"StructArrayLayout1i2");class Jp extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(c){const f=this.length;return this.resize(f+1),this.emplace(f,c)}emplace(c,f){return this.uint8[1*c+0]=f,c}}Jp.prototype.bytesPerElement=1,Fn(Jp,"StructArrayLayout1ub1");class Lx extends El{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Lx.prototype.size=40;class Ug extends Qu{get(c){return new Lx(this,c)}}Fn(Ug,"CollisionBoxArray");class Ld extends El{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(c){this._structArray.uint8[this._pos1+49]=c}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(c){this._structArray.uint8[this._pos1+50]=c}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(c){this._structArray.uint32[this._pos4+13]=c}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(c){this._structArray.uint8[this._pos1+58]=c}}Ld.prototype.size=60;class Vg extends Id{get(c){return new Ld(this,c)}}Fn(Vg,"PlacedSymbolArray");class Dx extends El{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(c){this._structArray.uint32[this._pos4+14]=c}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(c){this._structArray.float32[this._pos4+18]=c}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}Dx.prototype.size=80;class Qa extends n_{get(c){return new Dx(this,c)}}Fn(Qa,"SymbolInstanceArray");class Gg extends Rd{getoffsetX(c){return this.float32[1*c+0]}}Fn(Gg,"GlyphOffsetArray");class Hg extends lc{getx(c){return this.int16[2*c+0]}gety(c){return this.int16[2*c+1]}}Fn(Hg,"SymbolLineVertexArray");class wu extends El{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}wu.prototype.size=12;class Qp extends uc{get(c){return new wu(this,c)}}Fn(Qp,"FeatureIndexArray");class eh extends bu{geta_centroid_pos0(c){return this.uint16[2*c+0]}geta_centroid_pos1(c){return this.uint16[2*c+1]}}Fn(eh,"FillExtrusionCentroidArray");class em extends El{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}em.prototype.size=6;class tm extends hf{get(c){return new em(this,c)}}Fn(tm,"FillExtrusionWallArray");const i_=Qr([{name:"a_pos",components:2,type:"Int16"}],4),Iw=Qr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class xs{constructor(c=[]){this.segments=c}_prepareSegment(c,f,v,S){let x=this.segments[this.segments.length-1];return c>xs.MAX_VERTEX_ARRAY_LENGTH&&Lt(`Max vertices per segment is ${xs.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${c}`),(!x||x.vertexLength+c>xs.MAX_VERTEX_ARRAY_LENGTH||x.sortKey!==S)&&(x={vertexOffset:f,primitiveOffset:v,vertexLength:0,primitiveLength:0},S!==void 0&&(x.sortKey=S),this.segments.push(x)),x}prepareSegment(c,f,v,S){return this._prepareSegment(c,f.length,v.length,S)}get(){return this.segments}destroy(){for(const c of this.segments)for(const f in c.vaos)c.vaos[f].destroy()}static simpleSegment(c,f,v,S){return new xs([{vertexOffset:c,primitiveOffset:f,vertexLength:v,primitiveLength:S,vaos:{},sortKey:0}])}}function s_(g,c){return 256*(g=jt(Math.floor(g),0,255))+jt(Math.floor(c),0,255)}xs.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Fn(xs,"SegmentVector");const Bx=Qr([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),kx=Qr([{name:"a_dash",components:4,type:"Uint16"}]);class df{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(c,f,v,S){this.ids.push(Ox(c)),this.positions.push(f,v,S)}eachPosition(c,f){const v=Ox(c);let S=0,x=this.ids.length-1;for(;S<x;){const A=S+x>>1;this.ids[A]>=v?x=A:S=A+1}for(;this.ids[S]===v;)f(this.positions[3*S],this.positions[3*S+1],this.positions[3*S+2]),S++}static serialize(c,f){const v=new Float64Array(c.ids),S=new Uint32Array(c.positions);return Dd(v,S,0,v.length-1),f&&(f.add(v.buffer),f.add(S.buffer)),{ids:v,positions:S}}static deserialize(c){const f=new df;let v;f.ids=c.ids,f.positions=c.positions;for(const S of f.ids)S!==v&&f.uniqueIds.push(S),v=S;return f.indexed=!0,f}}function Ox(g){const c=+g;return!isNaN(c)&&Number.MIN_SAFE_INTEGER<=c&&c<=Number.MAX_SAFE_INTEGER?c:Xo(String(g))}function Dd(g,c,f,v){for(;f<v;){const S=g[f+v>>1];let x=f-1,A=v+1;for(;;){do x++;while(g[x]<S);do A--;while(g[A]>S);if(x>=A)break;L(g,x,A),L(c,3*x,3*A),L(c,3*x+1,3*A+1),L(c,3*x+2,3*A+2)}A-f<v-A?(Dd(g,c,f,A),f=A+1):(Dd(g,c,A+1,v),v=A)}}function L(g,c,f){const v=g[c];g[c]=g[f],g[f]=v}Fn(df,"FeaturePositionMap");class O{constructor(c){this.gl=c.gl,this.initialized=!1}fetchUniformLocation(c,f){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(c,f),this.initialized=!0),!!this.location}set(c,f,v){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Y extends O{constructor(c){super(c),this.current=0}set(c,f,v){this.fetchUniformLocation(c,f)&&this.current!==v&&(this.current=v,this.gl.uniform1i(this.location,v))}}class re extends O{constructor(c){super(c),this.current=0}set(c,f,v){this.fetchUniformLocation(c,f)&&this.current!==v&&(this.current=v,this.gl.uniform1f(this.location,v))}}class pe extends O{constructor(c){super(c),this.current=[0,0]}set(c,f,v){this.fetchUniformLocation(c,f)&&(v[0]===this.current[0]&&v[1]===this.current[1]||(this.current=v,this.gl.uniform2f(this.location,v[0],v[1])))}}class Te extends O{constructor(c){super(c),this.current=[0,0,0]}set(c,f,v){this.fetchUniformLocation(c,f)&&(v[0]===this.current[0]&&v[1]===this.current[1]&&v[2]===this.current[2]||(this.current=v,this.gl.uniform3f(this.location,v[0],v[1],v[2])))}}class ft extends O{constructor(c){super(c),this.current=[0,0,0,0]}set(c,f,v){this.fetchUniformLocation(c,f)&&(v[0]===this.current[0]&&v[1]===this.current[1]&&v[2]===this.current[2]&&v[3]===this.current[3]||(this.current=v,this.gl.uniform4f(this.location,v[0],v[1],v[2],v[3])))}}class Ot extends O{constructor(c){super(c),this.current=vr.transparent.toRenderColor(null)}set(c,f,v){this.fetchUniformLocation(c,f)&&(v.r===this.current.r&&v.g===this.current.g&&v.b===this.current.b&&v.a===this.current.a||(this.current=v,this.gl.uniform4f(this.location,v.r,v.g,v.b,v.a)))}}const vn=new Float32Array(16);class Wn extends O{constructor(c){super(c),this.current=vn}set(c,f,v){if(this.fetchUniformLocation(c,f)){if(v[12]!==this.current[12]||v[0]!==this.current[0])return this.current=v,void this.gl.uniformMatrix4fv(this.location,!1,v);for(let S=1;S<16;S++)if(v[S]!==this.current[S]){this.current=v,this.gl.uniformMatrix4fv(this.location,!1,v);break}}}}const br=new Float32Array(9),oi=new Float32Array(4);class zr extends O{constructor(c){super(c),this.current=oi}set(c,f,v){if(this.fetchUniformLocation(c,f)){for(let S=0;S<4;S++)if(v[S]!==this.current[S]){this.current=v,this.gl.uniformMatrix2fv(this.location,!1,v);break}}}}function fs(g){return[s_(255*g.r,255*g.g),s_(255*g.b,255*g.a)]}class Ir{constructor(c,f,v,S){this.value=c,this.uniformNames=f.map(x=>`u_${x}`),this.type=v,this.context=S}setUniform(c,f,v,S,x){const A=S.constantOr(this.value);f.set(c,x,A instanceof vr?A.toRenderColor(this.context.lut):A)}getBinding(c,f){return this.type==="color"?new Ot(c):new re(c)}}class co{constructor(c,f){this.uniformNames=f.map(v=>`u_${v}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(c){this.pixelRatio=c.pixelRatio||1,this.pattern=c.tl.concat(c.br)}setUniform(c,f,v,S,x){const A=x==="u_pattern"||x==="u_dash"?this.pattern:x==="u_pixel_ratio"?this.pixelRatio:null;A&&f.set(c,x,A)}getBinding(c,f){return f==="u_pattern"||f==="u_dash"?new ft(c):new re(c)}}class uo{constructor(c,f,v,S){this.expression=c,this.type=v,this.maxValue=0,this.paintVertexAttributes=f.map(x=>({name:`a_${x}`,type:"Float32",components:v==="color"?2:1,offset:0})),this.paintVertexArray=new S}populatePaintArray(c,f,v,S,x,A,D){const U=this.paintVertexArray.length,H=this.expression.evaluate(new hs(0,{brightness:A}),f,{},x,S,D);this.paintVertexArray.resize(c),this._setPaintValue(U,c,H,this.context)}updatePaintArray(c,f,v,S,x,A,D){const U=this.expression.evaluate({zoom:0,brightness:D},v,S,void 0,x);this._setPaintValue(c,f,U,this.context)}_setPaintValue(c,f,v,S){if(this.type==="color"){const x=fs(v.toRenderColor(S.lut));for(let A=c;A<f;A++)this.paintVertexArray.emplace(A,x[0],x[1])}else{for(let x=c;x<f;x++)this.paintVertexArray.emplace(x,v);this.maxValue=Math.max(this.maxValue,Math.abs(v))}}upload(c){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=c.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Xt{constructor(c,f,v,S,x,A){this.expression=c,this.uniformNames=f.map(D=>`u_${D}_t`),this.type=v,this.useIntegerZoom=S,this.context=x,this.maxValue=0,this.paintVertexAttributes=f.map(D=>({name:`a_${D}`,type:"Float32",components:v==="color"?4:2,offset:0})),this.paintVertexArray=new A}populatePaintArray(c,f,v,S,x,A,D){const U=this.expression.evaluate(new hs(this.context.zoom,{brightness:A}),f,{},x,S,D),H=this.expression.evaluate(new hs(this.context.zoom+1,{brightness:A}),f,{},x,S,D),R=this.paintVertexArray.length;this.paintVertexArray.resize(c),this._setPaintValue(R,c,U,H,this.context)}updatePaintArray(c,f,v,S,x,A,D){const U=this.expression.evaluate({zoom:this.context.zoom,brightness:D},v,S,void 0,x),H=this.expression.evaluate({zoom:this.context.zoom+1,brightness:D},v,S,void 0,x);this._setPaintValue(c,f,U,H,this.context)}_setPaintValue(c,f,v,S,x){if(this.type==="color"){const A=fs(v.toRenderColor(x.lut)),D=fs(v.toRenderColor(x.lut));for(let U=c;U<f;U++)this.paintVertexArray.emplace(U,A[0],A[1],D[0],D[1])}else{for(let A=c;A<f;A++)this.paintVertexArray.emplace(A,v,S);this.maxValue=Math.max(this.maxValue,Math.abs(v),Math.abs(S))}}upload(c){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=c.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(c,f,v,S,x){const A=this.useIntegerZoom?Math.floor(v.zoom):v.zoom,D=jt(this.expression.interpolationFactor(A,this.context.zoom,this.context.zoom+1),0,1);f.set(c,x,D)}getBinding(c,f){return new re(c)}}class Nt{constructor(c,f,v,S,x){this.expression=c,this.layerId=x,this.paintVertexAttributes=(v==="array"?kx:Bx).members;for(let A=0;A<f.length;++A);this.paintVertexArray=new S}populatePaintArray(c,f,v,S){const x=this.paintVertexArray.length;this.paintVertexArray.resize(c),this._setPaintValues(x,c,f.patterns&&f.patterns[this.layerId],v)}updatePaintArray(c,f,v,S,x,A,D){this._setPaintValues(c,f,v.patterns&&v.patterns[this.layerId],A)}_setPaintValues(c,f,v,S){if(!S||!v)return;const x=S[v];if(!x)return;const{tl:A,br:D,pixelRatio:U}=x;for(let H=c;H<f;H++)this.paintVertexArray.emplace(H,A[0],A[1],D[0],D[1],U)}upload(c){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=c.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class on{constructor(c,f,v=()=>!0){this.binders={},this._buffers=[],this.context=f;const S=[];for(const x in c.paint._values){const A=c.paint.get(x);if(!v(x)||!(A instanceof Zu&&Vp(A.property.specification)))continue;const D=mi(x,c.type),U=A.value,H=A.property.specification.type,R=!!A.property.useIntegerZoom,N=x==="line-dasharray"||x.endsWith("pattern"),G=x==="line-dasharray"&&c.layout.get("line-cap").value.kind!=="constant";if(U.kind!=="constant"||G)if(U.kind==="source"||G||N){const z=b(x,H,"source");this.binders[x]=N?new Nt(U,D,H,z,c.id):new uo(U,D,H,z),S.push(`/a_${x}`)}else{const z=b(x,H,"composite");this.binders[x]=new Xt(U,D,H,R,f,z),S.push(`/z_${x}`)}else this.binders[x]=N?new co(U.value,D):new Ir(U.value,D,H,f),S.push(`/u_${x}`)}this.cacheKey=S.sort().join("")}getMaxValue(c){const f=this.binders[c];return f instanceof uo||f instanceof Xt?f.maxValue:0}populatePaintArrays(c,f,v,S,x,A,D){for(const U in this.binders){const H=this.binders[U];H.context=this.context,(H instanceof uo||H instanceof Xt||H instanceof Nt)&&H.populatePaintArray(c,f,v,S,x,A,D)}}setConstantPatternPositions(c){for(const f in this.binders){const v=this.binders[f];v instanceof co&&v.setConstantPatternPositions(c)}}updatePaintArrays(c,f,v,S,x,A,D,U){let H=!1;const R=Object.keys(c),N=R.length!==0,G=N?R:f.uniqueIds;this.context.lut=x.lut;for(const z in this.binders){const V=this.binders[z];if(V.context=this.context,(V instanceof uo||V instanceof Xt||V instanceof Nt)&&(V.expression.isStateDependent===!0||V.expression.isLightConstant===!1)){const X=x.paint.get(z);V.expression=X.value;for(const K of G){const ee=c[K.toString()];f.eachPosition(K,(ce,he,ne)=>{const de=S.feature(ce);V.updatePaintArray(he,ne,de,ee,A,D,U)})}if(!N)for(const K of v.uniqueIds){const ee=c[K.toString()];v.eachPosition(K,(ce,he,ne)=>{const de=S.feature(ce);V.updatePaintArray(he,ne,de,ee,A,D,U)})}H=!0}}return H}defines(){const c=[];for(const f in this.binders){const v=this.binders[f];(v instanceof Ir||v instanceof co)&&c.push(...v.uniformNames.map(S=>`#define HAS_UNIFORM_${S}`))}return c}getBinderAttributes(){const c=[];for(const f in this.binders){const v=this.binders[f];if(v instanceof uo||v instanceof Xt||v instanceof Nt)for(let S=0;S<v.paintVertexAttributes.length;S++)c.push(v.paintVertexAttributes[S].name)}return c}getBinderUniforms(){const c=[];for(const f in this.binders){const v=this.binders[f];if(v instanceof Ir||v instanceof co||v instanceof Xt)for(const S of v.uniformNames)c.push(S)}return c}getPaintVertexBuffers(){return this._buffers}getUniforms(c){const f=[];for(const v in this.binders){const S=this.binders[v];if(S instanceof Ir||S instanceof co||S instanceof Xt)for(const x of S.uniformNames)f.push({name:x,property:v,binding:S.getBinding(c,x)})}return f}setUniforms(c,f,v,S,x){for(const{name:A,property:D,binding:U}of v)this.binders[D].setUniform(c,U,x,S.get(D),A)}updatePaintBuffers(){this._buffers=[];for(const c in this.binders){const f=this.binders[c];(f instanceof uo||f instanceof Xt||f instanceof Nt)&&f.paintVertexBuffer&&this._buffers.push(f.paintVertexBuffer)}}upload(c){for(const f in this.binders){const v=this.binders[f];(v instanceof uo||v instanceof Xt||v instanceof Nt)&&v.upload(c)}this.updatePaintBuffers()}destroy(){for(const c in this.binders){const f=this.binders[c];(f instanceof uo||f instanceof Xt||f instanceof Nt)&&f.destroy()}}}class rr{constructor(c,f,v=()=>!0){this.programConfigurations={};for(const S of c)this.programConfigurations[S.id]=new on(S,f,v);this.needsUpload=!1,this._featureMap=new df,this._featureMapWithoutIds=new df,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(c,f,v,S,x,A,D,U){for(const H in this.programConfigurations)this.programConfigurations[H].populatePaintArrays(c,f,S,x,A,D,U);f.id!==void 0?this._featureMap.add(f.id,v,this._bufferOffset,c):(this._featureMapWithoutIds.add(this._idlessCounter,v,this._bufferOffset,c),this._idlessCounter+=1),this._bufferOffset=c,this.needsUpload=!0}updatePaintArrays(c,f,v,S,x,A){for(const D of v)this.needsUpload=this.programConfigurations[D.id].updatePaintArrays(c,this._featureMap,this._featureMapWithoutIds,f,D,S,x,A||0)||this.needsUpload}get(c){return this.programConfigurations[c]}upload(c){if(this.needsUpload){for(const f in this.programConfigurations)this.programConfigurations[f].upload(c);this.needsUpload=!1}}destroy(){for(const c in this.programConfigurations)this.programConfigurations[c].destroy()}}const Rr={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function mi(g,c){return Rr[g]||[g.replace(`${c}-`,"").replace(/-/g,"_")]}const ai={"line-pattern":{source:Vc,composite:Vc},"fill-pattern":{source:Vc,composite:Vc},"fill-extrusion-pattern":{source:Vc,composite:Vc},"line-dasharray":{source:xu,composite:xu}},Fi={color:{source:hc,composite:Il},number:{source:Rd,composite:hc}};function b(g,c,f){const v=ai[g];return v&&v[f]||Fi[c][f]}Fn(Ir,"ConstantBinder"),Fn(co,"PatternConstantBinder"),Fn(uo,"SourceExpressionBinder"),Fn(Nt,"PatternCompositeBinder"),Fn(Xt,"CompositeExpressionBinder"),Fn(on,"ProgramConfiguration",{omit:["_buffers"]}),Fn(rr,"ProgramConfigurationSet");const u=yn/Math.PI/2,p=5,w=6,E=16383,P=64,F=[P,32,16],W=-u,$=u;function J(g,c,f,v=u){return f=sn(f),[g*Math.sin(f)*v,-c*v,g*Math.cos(f)*v]}function Q(g,c,f){return J(Math.cos(sn(g)),Math.sin(sn(g)),c,f)}const oe=63710088e-1,le=2*Math.PI*oe;class ue{constructor(c,f){if(isNaN(c)||isNaN(f))throw new Error(`Invalid LngLat object: (${c}, ${f})`);if(this.lng=+c,this.lat=+f,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ue(Un(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(c){const f=Math.PI/180,v=this.lat*f,S=c.lat*f,x=Math.sin(v)*Math.sin(S)+Math.cos(v)*Math.cos(S)*Math.cos((c.lng-this.lng)*f);return oe*Math.acos(Math.min(x,1))}toBounds(c=0){const f=360*c/40075017,v=f/Math.cos(Math.PI/180*this.lat);return new ve({lng:this.lng-v,lat:this.lat-f},{lng:this.lng+v,lat:this.lat+f})}toEcef(c){return Q(this.lat,this.lng,u+c*u/oe)}static convert(c){if(c instanceof ue)return c;if(Array.isArray(c)&&(c.length===2||c.length===3))return new ue(Number(c[0]),Number(c[1]));if(!Array.isArray(c)&&typeof c=="object"&&c!==null)return new ue(Number("lng"in c?c.lng:c.lon),Number(c.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class ve{constructor(c,f){if(c)if(f)this.setSouthWest(c).setNorthEast(f);else if(c.length===4){const v=c;this.setSouthWest([v[0],v[1]]).setNorthEast([v[2],v[3]])}else{const v=c;this.setSouthWest(v[0]).setNorthEast(v[1])}}setNorthEast(c){return this._ne=c instanceof ue?new ue(c.lng,c.lat):ue.convert(c),this}setSouthWest(c){return this._sw=c instanceof ue?new ue(c.lng,c.lat):ue.convert(c),this}extend(c){const f=this._sw,v=this._ne;let S,x;if(c instanceof ue)S=c,x=c;else{if(!(c instanceof ve))return Array.isArray(c)?c.length===4||c.every(Array.isArray)?this.extend(ve.convert(c)):this.extend(ue.convert(c)):typeof c=="object"&&c!==null&&c.hasOwnProperty("lat")&&(c.hasOwnProperty("lon")||c.hasOwnProperty("lng"))?this.extend(ue.convert(c)):this;if(S=c._sw,x=c._ne,!S||!x)return this}return f||v?(f.lng=Math.min(S.lng,f.lng),f.lat=Math.min(S.lat,f.lat),v.lng=Math.max(x.lng,v.lng),v.lat=Math.max(x.lat,v.lat)):(this._sw=new ue(S.lng,S.lat),this._ne=new ue(x.lng,x.lat)),this}getCenter(){return new ue((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new ue(this.getWest(),this.getNorth())}getSouthEast(){return new ue(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(c){const{lng:f,lat:v}=ue.convert(c);let S=this._sw.lng<=f&&f<=this._ne.lng;return this._sw.lng>this._ne.lng&&(S=this._sw.lng>=f&&f>=this._ne.lng),this._sw.lat<=v&&v<=this._ne.lat&&S}static convert(c){if(c)return c instanceof ve?c:new ve(c)}}const _e=0,be=25.5;function we(g){return le*Math.cos(g*Math.PI/180)}function ke(g){return(180+g)/360}function Ne(g){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+g*Math.PI/360)))/360}function De(g,c){return g/we(c)}function je(g){return 360*g-180}function Ge(g){return 360/Math.PI*Math.atan(Math.exp((180-360*g)*Math.PI/180))-90}function et(g,c){return g*we(Ge(c))}const Ke=85.051129;function tt(g){return Math.cos(sn(jt(g,-Ke,Ke)))}function ct(g,c){const f=jt(c,_e,be),v=Math.pow(2,f);return tt(g)*le/(512*v)}function st(g){return 1/Math.cos(g*Math.PI/180)}function rt(g,c=0){const f=Math.exp(Math.PI*(1-(g.y+c/yn)/(1<<g.z)*2));return 80150034*f/(f*f+1)/yn/(1<<g.z)}class xt{constructor(c,f,v=0){this.x=+c,this.y=+f,this.z=+v}static fromLngLat(c,f=0){const v=ue.convert(c);return new xt(ke(v.lng),Ne(v.lat),De(f,v.lat))}toLngLat(){return new ue(je(this.x),Ge(this.y))}toAltitude(){return et(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/le*st(Ge(this.y))}}function Ft(g,c,f,v,S,x,A,D,U){const H=(c+v)/2,R=(f+S)/2,N=new St(H,R);D(N),function(G,z,V,X,K,ee){const ce=V-K,he=X-ee;return Math.abs((X-z)*ce-(V-G)*he)/Math.hypot(ce,he)}(N.x,N.y,x.x,x.y,A.x,A.y)>=U?(Ft(g,c,f,H,R,x,N,D,U),Ft(g,H,R,v,S,N,A,D,U)):g.push(A)}function Zt(g,c,f){let v=g[0],S=v.x,x=v.y;c(v);const A=[v];for(let D=1;D<g.length;D++){const U=g[D],{x:H,y:R}=U;c(U),Ft(A,S,x,H,R,v,U,c,f),S=H,x=R,v=U}return A}function kt(g,c,f,v){if(v(c,f)){const S=c.add(f)._mult(.5);kt(g,c,S,v),kt(g,S,f,v)}else g.push(f)}function hn(g,c){let f=g[0];const v=[f];for(let S=1;S<g.length;S++){const x=g[S];kt(v,f,x,c),f=x}return v}const bt=Math.pow(2,14)-1,Wt=-bt-1;function Vt(g,c){const f=Math.round(g.x*c),v=Math.round(g.y*c);return g.x=jt(f,Wt,bt),g.y=jt(v,Wt,bt),(f<g.x||f>g.x+1||v<g.y||v>g.y+1)&&Lt("Geometry exceeds allowed extent, reduce your vector tile buffer size"),g}function fn(g,c,f){const v=g.loadGeometry(),S=g.extent,x=yn/S;if(c&&f&&f.projection.isReprojectedInTileSpace){const A=1<<c.z,{scale:D,x:U,y:H,projection:R}=f,N=G=>{const z=je((c.x+G.x/S)/A),V=Ge((c.y+G.y/S)/A),X=R.project(z,V);G.x=(X.x*D-U)*S,G.y=(X.y*D-H)*S};for(let G=0;G<v.length;G++)if(g.type!==1)v[G]=Zt(v[G],N,1);else{const z=[];for(const V of v[G])V.x<0||V.x>=S||V.y<0||V.y>=S||(N(V),z.push(V));v[G]=z}}for(const A of v)for(const D of A)Vt(D,x);return v}function pn(g,c){return{type:g.type,id:g.id,properties:g.properties,geometry:c?fn(g):[]}}function qt(g,c,f,v,S){g.emplaceBack(2*c+(v+1)/2,2*f+(S+1)/2)}function en(g,c,f){g.emplaceBack(c.x,c.y,c.z,f[0]*16384,f[1]*16384,f[2]*16384)}class er{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(f=>f.fqid),this.index=c.index,this.hasPattern=!1,this.projection=c.projection,this.layoutVertexArray=new lc,this.indexArray=new bo,this.segments=new xs,this.programConfigurations=new rr(c.layers,{zoom:c.zoom,lut:c.lut}),this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id)}updateFootprints(c,f){}populate(c,f,v,S){const x=this.layers[0],A=[];let D=null;x.type==="circle"&&(D=x.layout.get("circle-sort-key"));for(const{feature:H,id:R,index:N,sourceLayerIndex:G}of c){const z=this.layers[0]._featureFilter.needGeometry,V=pn(H,z);if(!this.layers[0]._featureFilter.filter(new hs(this.zoom),V,v))continue;const X=D?D.evaluate(V,{},v):void 0,K={id:R,properties:H.properties,type:H.type,sourceLayerIndex:G,index:N,geometry:z?V.geometry:fn(H,v,S),patterns:{},sortKey:X};A.push(K)}D&&A.sort((H,R)=>H.sortKey-R.sortKey);let U=null;S.projection.name==="globe"&&(this.globeExtVertexArray=new Ed,U=S.projection);for(const H of A){const{geometry:R,index:N,sourceLayerIndex:G}=H,z=c[N].feature;this.addFeature(H,R,N,f.availableImages,v,U,f.brightness),f.featureIndex.insert(z,R,N,G,this.index)}}update(c,f,v,S,x){const A=Object.keys(c).length!==0;A&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(c,f,A?this.stateDependentLayers:this.layers,v,S,x)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,i_.members),this.indexBuffer=c.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=c.createVertexBuffer(this.globeExtVertexArray,Iw.members))),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(c,f,v,S,x,A,D){for(const U of f)for(const H of U){const R=H.x,N=H.y;if(R<0||R>=yn||N<0||N>=yn)continue;if(A){const V=A.projectTilePoint(R,N,x),X=A.upVector(x,R,N),K=this.globeExtVertexArray;en(K,V,X),en(K,V,X),en(K,V,X),en(K,V,X)}const G=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,c.sortKey),z=G.vertexLength;qt(this.layoutVertexArray,R,N,-1,-1),qt(this.layoutVertexArray,R,N,1,-1),qt(this.layoutVertexArray,R,N,1,1),qt(this.layoutVertexArray,R,N,-1,1),this.indexArray.emplaceBack(z,z+1,z+2),this.indexArray.emplaceBack(z,z+2,z+3),G.vertexLength+=4,G.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,v,{},S,x,D)}}function xn(g,c){for(let f=0;f<g.length;f++)if(ns(c,g[f]))return!0;for(let f=0;f<c.length;f++)if(ns(g,c[f]))return!0;return!!ur(g,c)}function Dn(g,c,f){return!!ns(g,c)||!!Br(c,g,f)}function yr(g,c){if(g.length===1)return Ni(c,g[0]);for(let f=0;f<c.length;f++){const v=c[f];for(let S=0;S<v.length;S++)if(ns(g,v[S]))return!0}for(let f=0;f<g.length;f++)if(Ni(c,g[f]))return!0;for(let f=0;f<c.length;f++)if(ur(g,c[f]))return!0;return!1}function qn(g,c,f){if(g.length>1){if(ur(g,c))return!0;for(let v=0;v<c.length;v++)if(Br(c[v],g,f))return!0}for(let v=0;v<g.length;v++)if(Br(g[v],c,f))return!0;return!1}function ur(g,c){if(g.length===0||c.length===0)return!1;for(let f=0;f<g.length-1;f++){const v=g[f],S=g[f+1];for(let x=0;x<c.length-1;x++)if(Ur(v,S,c[x],c[x+1]))return!0}return!1}function Ur(g,c,f,v){return Kt(g,f,v)!==Kt(c,f,v)&&Kt(g,c,f)!==Kt(g,c,v)}function Br(g,c,f){const v=f*f;if(c.length===1)return g.distSqr(c[0])<v;for(let S=1;S<c.length;S++)if(Mi(g,c[S-1],c[S])<v)return!0;return!1}function Mi(g,c,f){const v=c.distSqr(f);if(v===0)return g.distSqr(c);const S=((g.x-c.x)*(f.x-c.x)+(g.y-c.y)*(f.y-c.y))/v;return g.distSqr(S<0?c:S>1?f:f.sub(c)._mult(S)._add(c))}function Ni(g,c){let f,v,S,x=!1;for(let A=0;A<g.length;A++){f=g[A];for(let D=0,U=f.length-1;D<f.length;U=D++)v=f[D],S=f[U],v.y>c.y!=S.y>c.y&&c.x<(S.x-v.x)*(c.y-v.y)/(S.y-v.y)+v.x&&(x=!x)}return x}function ns(g,c){let f=!1;for(let v=0,S=g.length-1;v<g.length;S=v++){const x=g[v],A=g[S];x.y>c.y!=A.y>c.y&&c.x<(A.x-x.x)*(c.y-x.y)/(A.y-x.y)+x.x&&(f=!f)}return f}function jc(g,c,f,v,S){for(const A of g)if(c<=A.x&&f<=A.y&&v>=A.x&&S>=A.y)return!0;const x=[new St(c,f),new St(c,S),new St(v,S),new St(v,f)];if(g.length>2){for(const A of x)if(ns(g,A))return!0}for(let A=0;A<g.length-1;A++)if(Js(g[A],g[A+1],x))return!0;return!1}function Js(g,c,f){const v=f[0],S=f[2];if(g.x<v.x&&c.x<v.x||g.x>S.x&&c.x>S.x||g.y<v.y&&c.y<v.y||g.y>S.y&&c.y>S.y)return!1;const x=Kt(g,c,f[0]);return x!==Kt(g,c,f[1])||x!==Kt(g,c,f[2])||x!==Kt(g,c,f[3])}function Yr(g,c,f,v,S,x){let A=c.y-g.y,D=g.x-c.x;if(x=x||0){const U=A*A+D*D;if(U===0)return!0;const H=Math.sqrt(U);A/=H,D/=H}return!((f.x-g.x)*A+(f.y-g.y)*D-x<0||(v.x-g.x)*A+(v.y-g.y)*D-x<0||(S.x-g.x)*A+(S.y-g.y)*D-x<0)}function Oi(g,c,f,v,S,x,A){return!(Yr(g,c,v,S,x,A)||Yr(c,f,v,S,x,A)||Yr(f,g,v,S,x,A)||Yr(v,S,g,c,f,A)||Yr(S,x,g,c,f,A)||Yr(x,v,g,c,f,A))}function bs(g,c,f){const v=c.paint.get(g).value;return v.kind==="constant"?v.value:f.programConfigurations.get(c.id).getMaxValue(g)}function Pi(g){return Math.sqrt(g[0]*g[0]+g[1]*g[1])}function kr(g,c,f,v,S){if(!c[0]&&!c[1])return g;const x=St.convert(c)._mult(S);f==="viewport"&&x._rotate(-v);const A=[];for(let D=0;D<g.length;D++)A.push(g[D].sub(x));return A}function di(g,c,f,v){const S=St.convert(g)._mult(v);return c==="viewport"&&S._rotate(-f),S}let Si,Fs;Fn(er,"CircleBucket",{omit:["layers"]});var Qs,si={exports:{}},Oo=(Qs||(Qs=1,function(g,c){(function(f){function v(x,A,D){var U=S(256*x,256*(A=Math.pow(2,D)-A-1),D),H=S(256*(x+1),256*(A+1),D);return U[0]+","+U[1]+","+H[0]+","+H[1]}function S(x,A,D){var U=2*Math.PI*6378137/256/Math.pow(2,D);return[x*U-2*Math.PI*6378137/2,A*U-2*Math.PI*6378137/2]}f.getURL=function(x,A,D,U,H,R){return R=R||{},x+"?"+["bbox="+v(D,U,H),"format="+(R.format||"image/png"),"service="+(R.service||"WMS"),"version="+(R.version||"1.1.1"),"request="+(R.request||"GetMap"),"srs="+(R.srs||"EPSG:3857"),"width="+(R.width||256),"height="+(R.height||256),"layers="+A].join("&")},f.getTileBBox=v,f.getMercCoords=S,Object.defineProperty(f,"__esModule",{value:!0})})(c)}(0,si.exports)),si.exports);class Yo{constructor(c,f,v){this.z=c,this.x=f,this.y=v,this.key=dl(0,c,c,f,v)}equals(c){return this.z===c.z&&this.x===c.x&&this.y===c.y}url(c,f){const v=Oo.getTileBBox(this.x,this.y,this.z),S=function(x,A,D){let U,H="";for(let R=x;R>0;R--)U=1<<R-1,H+=(A&U?1:0)+(D&U?2:0);return H}(this.z,this.x,this.y);return c[(this.x+this.y)%c.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(f==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",S).replace("{bbox-epsg-3857}",v)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Fo{constructor(c,f){this.wrap=c,this.canonical=f,this.key=dl(c,f.z,f.z,f.x,f.y)}}class Zi{constructor(c,f,v,S,x){this.overscaledZ=c,this.wrap=f,this.canonical=new Yo(v,+S,+x),this.key=f===0&&c===v?this.canonical.key:dl(f,c,v,S,x)}equals(c){return this.overscaledZ===c.overscaledZ&&this.wrap===c.wrap&&this.canonical.equals(c.canonical)}scaledTo(c){const f=this.canonical.z-c;return c>this.canonical.z?new Zi(c,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Zi(c,this.wrap,c,this.canonical.x>>f,this.canonical.y>>f)}calculateScaledKey(c,f=!0){if(this.overscaledZ===c&&f)return this.key;if(c>this.canonical.z)return dl(this.wrap*+f,c,this.canonical.z,this.canonical.x,this.canonical.y);{const v=this.canonical.z-c;return dl(this.wrap*+f,c,c,this.canonical.x>>v,this.canonical.y>>v)}}isChildOf(c){if(c.wrap!==this.wrap)return!1;const f=this.canonical.z-c.canonical.z;return c.overscaledZ===0||c.overscaledZ<this.overscaledZ&&c.canonical.z<this.canonical.z&&c.canonical.x===this.canonical.x>>f&&c.canonical.y===this.canonical.y>>f}children(c){if(this.overscaledZ>=c)return[new Zi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const f=this.canonical.z+1,v=2*this.canonical.x,S=2*this.canonical.y;return[new Zi(f,this.wrap,f,v,S),new Zi(f,this.wrap,f,v+1,S),new Zi(f,this.wrap,f,v,S+1),new Zi(f,this.wrap,f,v+1,S+1)]}isLessThan(c){return this.wrap<c.wrap||!(this.wrap>c.wrap)&&(this.overscaledZ<c.overscaledZ||!(this.overscaledZ>c.overscaledZ)&&(this.canonical.x<c.canonical.x||!(this.canonical.x>c.canonical.x)&&this.canonical.y<c.canonical.y))}wrapped(){return new Zi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(c){return new Zi(this.overscaledZ,c,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Fo(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function dl(g,c,f,v,S){const x=1<<Math.min(f,22);let A=x*(S%x)+v%x;return g&&f<22&&(A+=x*x*((g<0?-2*g-1:2*g)%(1<<2*(22-f)))),16*(32*A+f)+(c-f)}const pl=[g=>{let c=g.canonical.x-1,f=g.wrap;return c<0&&(c=(1<<g.canonical.z)-1,f--),new Zi(g.overscaledZ,f,g.canonical.z,c,g.canonical.y)},g=>{let c=g.canonical.x+1,f=g.wrap;return c===1<<g.canonical.z&&(c=0,f++),new Zi(g.overscaledZ,f,g.canonical.z,c,g.canonical.y)},g=>new Zi(g.overscaledZ,g.wrap,g.canonical.z,g.canonical.x,(g.canonical.y===0?1<<g.canonical.z:g.canonical.y)-1),g=>new Zi(g.overscaledZ,g.wrap,g.canonical.z,g.canonical.x,g.canonical.y===(1<<g.canonical.z)-1?0:g.canonical.y+1)];Fn(Yo,"CanonicalTileID"),Fn(Zi,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Wc=Qr([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:fc}=Wc,Rl=Qr([{name:"a_pos_3",components:3,type:"Int16"}]);var Xc=Qr([{name:"a_pos",type:"Int16",components:2}]);class pf{constructor(c,f){this.pos=c,this.dir=f}intersectsPlane(c,f,v){const S=Pe.vec3.dot(f,this.dir);if(Math.abs(S)<1e-6)return!1;const x=((c[0]-this.pos[0])*f[0]+(c[1]-this.pos[1])*f[1]+(c[2]-this.pos[2])*f[2])/S;return v[0]=this.pos[0]+this.dir[0]*x,v[1]=this.pos[1]+this.dir[1]*x,v[2]=this.pos[2]+this.dir[2]*x,!0}closestPointOnSphere(c,f,v){if(Pe.vec3.equals(this.pos,c)||f===0)return v[0]=v[1]=v[2]=0,!1;const[S,x,A]=this.dir,D=this.pos[0]-c[0],U=this.pos[1]-c[1],H=this.pos[2]-c[2],R=S*S+x*x+A*A,N=2*(D*S+U*x+H*A),G=N*N-4*R*(D*D+U*U+H*H-f*f);if(G<0){const z=Math.max(-N/2,0),V=D+S*z,X=U+x*z,K=H+A*z,ee=Math.hypot(V,X,K);return v[0]=V*f/ee,v[1]=X*f/ee,v[2]=K*f/ee,!1}{const z=(-N-Math.sqrt(G))/(2*R);if(z<0){const V=Math.hypot(D,U,H);return v[0]=D*f/V,v[1]=U*f/V,v[2]=H*f/V,!1}return v[0]=D+S*z,v[1]=U+x*z,v[2]=H+A*z,!0}}}class Bd{constructor(c,f,v,S,x){this.TL=c,this.TR=f,this.BR=v,this.BL=S,this.horizon=x}static fromInvProjectionMatrix(c,f,v){const S=[-1,1,1],x=[1,1,1],A=[1,-1,1],D=[-1,-1,1],U=Pe.vec3.transformMat4(S,S,c),H=Pe.vec3.transformMat4(x,x,c),R=Pe.vec3.transformMat4(A,A,c),N=Pe.vec3.transformMat4(D,D,c);return new Bd(U,H,R,N,f/v)}}function th(g,c,f){let v=1/0,S=-1/0;const x=[];for(const A of g){Pe.vec3.sub(x,A,c);const D=Pe.vec3.dot(x,f);v=Math.min(v,D),S=Math.max(S,D)}return[v,S]}function jg(g,c){let f=!0;for(let v=0;v<g.planes.length;v++){const S=g.planes[v];let x=0;for(let A=0;A<c.length;A++)x+=Pe.vec3.dot(S,c[A])+S[3]>=0;if(x===0)return 0;x!==c.length&&(f=!1)}return f?2:1}function Wg(g,c){for(const f of g.projections){const v=th(c,g.points[0],f.axis);if(f.projection[1]<v[0]||f.projection[0]>v[1])return 0}return 1}function Fx(g,c){let f=0;const v=[0,0,0,0];for(let S=0;S<g.length;S++)v[0]=g[S][0],v[1]=g[S][1],v[2]=g[S][2],v[3]=1,Pe.vec4.dot(v,c)>=0&&f++;return f}class Xg{constructor(c,f){this.points=c||new Array(8).fill([0,0,0]),this.planes=f||new Array(6).fill([0,0,0,0]),this.bounds=Yi.fromPoints(this.points),this.projections=[],this.frustumEdges=[Pe.vec3.sub([],this.points[2],this.points[3]),Pe.vec3.sub([],this.points[0],this.points[3]),Pe.vec3.sub([],this.points[4],this.points[0]),Pe.vec3.sub([],this.points[5],this.points[1]),Pe.vec3.sub([],this.points[6],this.points[2]),Pe.vec3.sub([],this.points[7],this.points[3])];for(const v of this.frustumEdges){const S=[0,-v[2],v[1]],x=[v[2],0,-v[0]];this.projections.push({axis:S,projection:th(this.points,this.points[0],S)}),this.projections.push({axis:x,projection:th(this.points,this.points[0],x)})}}static fromInvProjectionMatrix(c,f,v,S){const x=Math.pow(2,v),A=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(H=>{const R=Pe.vec4.transformMat4([],H,c),N=1/R[3]/f*x;return Pe.vec4.mul(R,R,[N,N,S?1/R[3]:N,N])}),D=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(H=>{const R=Pe.vec3.sub([],A[H[0]],A[H[1]]),N=Pe.vec3.sub([],A[H[2]],A[H[1]]),G=Pe.vec3.normalize([],Pe.vec3.cross([],R,N)),z=-Pe.vec3.dot(G,A[H[1]]);return G.concat(z)}),U=[];for(let H=0;H<A.length;H++)U.push([A[H][0],A[H][1],A[H][2]]);return new Xg(U,D)}intersectsPrecise(c,f,v){for(let S=0;S<f.length;S++)if(!Fx(c,f[S]))return 0;for(let S=0;S<this.planes.length;S++)if(!Fx(c,this.planes[S]))return 0;for(const S of v)for(const x of this.frustumEdges){const A=Pe.vec3.cross([],S,x),D=Pe.vec3.length(A);if(D===0)continue;Pe.vec3.scale(A,A,1/D);const U=th(this.points,this.points[0],A),H=th(c,this.points[0],A);if(U[0]>H[1]||H[0]>U[1])return 0}return 1}containsPoint(c){for(const f of this.planes){const v=f[3];if(Pe.vec3.dot([f[0],f[1],f[2]],c)+v<0)return!1}return!0}}class Yi{static fromPoints(c){const f=[1/0,1/0,1/0],v=[-1/0,-1/0,-1/0];for(const S of c)Pe.vec3.min(f,f,S),Pe.vec3.max(v,v,S);return new Yi(f,v)}static fromTileIdAndHeight(c,f,v){const S=1<<c.canonical.z,x=c.canonical.x,A=c.canonical.y;return new Yi([x/S,A/S,f],[(x+1)/S,(A+1)/S,v])}static applyTransform(c,f){const v=c.getCorners();for(let S=0;S<v.length;++S)Pe.vec3.transformMat4(v[S],v[S],f);return Yi.fromPoints(v)}static applyTransformFast(c,f){const v=[f[12],f[13],f[14]],S=[...v];for(let x=0;x<3;x++)for(let A=0;A<3;A++){const D=f[4*A+x],U=D*c.min[A],H=D*c.max[A];v[x]+=Math.min(U,H),S[x]+=Math.max(U,H)}return new Yi(v,S)}static projectAabbCorners(c,f){const v=c.getCorners();for(let S=0;S<v.length;++S)Pe.vec3.transformMat4(v[S],v[S],f);return v}constructor(c,f){this.min=c,this.max=f,this.center=Pe.vec3.scale([],Pe.vec3.add([],this.min,this.max),.5)}quadrant(c){const f=[c%2==0,c<2],v=Pe.vec3.clone(this.min),S=Pe.vec3.clone(this.max);for(let x=0;x<f.length;x++)v[x]=f[x]?this.min[x]:this.center[x],S[x]=f[x]?this.center[x]:this.max[x];return S[2]=this.max[2],new Yi(v,S)}distanceX(c){return Math.max(Math.min(this.max[0],c[0]),this.min[0])-c[0]}distanceY(c){return Math.max(Math.min(this.max[1],c[1]),this.min[1])-c[1]}distanceZ(c){return Math.max(Math.min(this.max[2],c[2]),this.min[2])-c[2]}getCorners(){const c=this.min,f=this.max;return[[c[0],c[1],c[2]],[f[0],c[1],c[2]],[f[0],f[1],c[2]],[c[0],f[1],c[2]],[c[0],c[1],f[2]],[f[0],c[1],f[2]],[f[0],f[1],f[2]],[c[0],f[1],f[2]]]}intersects(c){return this.intersectsAabb(c.bounds)?jg(c,this.getCorners()):0}intersectsFlat(c){return this.intersectsAabb(c.bounds)?jg(c,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(c,f){return f||this.intersects(c)?Wg(c,this.getCorners()):0}intersectsPreciseFlat(c,f){return f||this.intersectsFlat(c)?Wg(c,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(c){for(let f=0;f<3;++f)if(this.min[f]>c.max[f]||c.min[f]>this.max[f])return!1;return!0}intersectsAabbXY(c){return!(this.min[0]>c.max[0]||c.min[0]>this.max[0]||this.min[1]>c.max[1]||c.min[1]>this.max[1])}encapsulate(c){for(let f=0;f<3;f++)this.min[f]=Math.min(this.min[f],c.min[f]),this.max[f]=Math.max(this.max[f],c.max[f])}encapsulatePoint(c){for(let f=0;f<3;f++)this.min[f]=Math.min(this.min[f],c[f]),this.max[f]=Math.max(this.max[f],c[f])}closestPoint(c){return[Math.max(Math.min(this.max[0],c[0]),this.min[0]),Math.max(Math.min(this.max[1],c[1]),this.min[1]),Math.max(Math.min(this.max[2],c[2]),this.min[2])]}}function nm(g){return g*u/oe}Fn(Yi,"Aabb");const n3=[new Yi([W,W,W],[$,$,$]),new Yi([W,W,W],[0,0,$]),new Yi([0,W,W],[$,0,$]),new Yi([W,0,W],[0,$,$]),new Yi([0,0,W],[$,$,$])];function hM(g,c,f,v=!0){const S=Pe.vec3.scale([],g._camera.position,g.worldSize),x=[c,f,1,1];Pe.vec4.transformMat4(x,x,g.pixelMatrixInverse),Pe.vec4.scale(x,x,1/x[3]);const A=Pe.vec3.sub([],x,S),D=Pe.vec3.normalize([],A),U=g.globeMatrix,H=[U[12],U[13],U[14]],R=Pe.vec3.sub([],H,S),N=Pe.vec3.length(R),G=Pe.vec3.normalize([],R),z=g.worldSize/(2*Math.PI),V=Pe.vec3.dot(G,D),X=Math.asin(z/N);if(X<Math.acos(V)){if(!v)return null;const Ye=[],ze=[];Pe.vec3.scale(Ye,D,N/V),Pe.vec3.normalize(ze,Pe.vec3.sub(ze,Ye,R)),Pe.vec3.normalize(D,Pe.vec3.add(D,R,Pe.vec3.scale(D,ze,Math.tan(X)*N)))}const K=[];new pf(S,D).closestPointOnSphere(H,z,K);const ee=Pe.vec3.normalize([],ui(U,0)),ce=Pe.vec3.normalize([],ui(U,1)),he=Pe.vec3.normalize([],ui(U,2)),ne=Pe.vec3.dot(ee,K),de=Pe.vec3.dot(ce,K),ge=Pe.vec3.dot(he,K),Me=ot(Math.asin(-de/z));let Be=ot(Math.atan2(ne,ge));Be=g.center.lng+function(Ye,ze){const Qe=(ze-Ye+180)%360-180;return Qe<-180?Qe+360:Qe}(g.center.lng,Be);const Oe=ke(Be),Ie=jt(Ne(Me),0,1);return new xt(Oe,Ie)}class kce{constructor(c,f,v){this.a=Pe.vec3.sub([],c,v),this.b=Pe.vec3.sub([],f,v),this.center=v;const S=Pe.vec3.normalize([],this.a),x=Pe.vec3.normalize([],this.b);this.angle=Math.acos(Pe.vec3.dot(S,x))}}function r3(g,c){if(g.angle===0)return null;let f;return f=g.a[c]===0?1/g.angle*.5*Math.PI:1/g.angle*Math.atan(g.b[c]/g.a[c]/Math.sin(g.angle)-1/Math.tan(g.angle)),f<0||f>1?null:function(v,S,x,A){const D=Math.sin(x);return v*(Math.sin((1-A)*x)/D)+S*(Math.sin(A*x)/D)}(g.a[c],g.b[c],g.angle,jt(f,0,1))+g.center[c]}function kd(g){if(g.z<=1)return n3[g.z+2*g.y+g.x];const c=i3(fM(g));return Yi.fromPoints(c)}function rm(g,c,f){return Pe.vec3.scale(g,g,1-f),Pe.vec3.scaleAndAdd(g,g,c,f)}function t9(g,c,f){for(const v of g)Pe.vec3.transformMat4(v,v,c),Pe.vec3.scale(v,v,f)}function n9(g,c,f,v){const S=c/g.worldSize,x=g.globeMatrix;if(f.z<=1){const Oe=kd(f).getCorners();return t9(Oe,x,S),Yi.fromPoints(Oe)}const A=fM(f,v),D=i3(A,u+nm(g._tileCoverLift));t9(D,x,S);const U=Number.MAX_VALUE,H=[-U,-U,-U],R=[U,U,U];if(A.contains(g.center)){for(const Ye of D)Pe.vec3.min(R,R,Ye),Pe.vec3.max(H,H,Ye);H[2]=0;const Oe=g.point,Ie=[Oe.x*S,Oe.y*S,0];return Pe.vec3.min(R,R,Ie),Pe.vec3.max(H,H,Ie),new Yi(R,H)}if(g._tileCoverLift>0){for(const Oe of D)Pe.vec3.min(R,R,Oe),Pe.vec3.max(H,H,Oe);return new Yi(R,H)}const N=[x[12]*S,x[13]*S,x[14]*S],G=A.getCenter(),z=jt(g.center.lat,-Ke,Ke),V=jt(G.lat,-Ke,Ke),X=ke(g.center.lng),K=Ne(z);let ee=X-ke(G.lng);const ce=K-Ne(V);ee>.5?ee-=1:ee<-.5&&(ee+=1);let he=0;if(Math.abs(ee)>Math.abs(ce))he=ee>=0?1:3;else{he=ce>=0?0:2;const Oe=[x[4]*S,x[5]*S,x[6]*S],Ie=-Math.sin(sn(ce>=0?A.getSouth():A.getNorth()))*u;Pe.vec3.scaleAndAdd(N,N,Oe,Ie)}const ne=D[he],de=D[(he+1)%4],ge=new kce(ne,de,N),Me=[r3(ge,0)||ne[0],r3(ge,1)||ne[1],r3(ge,2)||ne[2]],Be=$g(g.zoom);if(Be>0){const Oe=function({x:Ye,y:ze,z:Qe},lt,ut,ht,mt){const Et=1/(1<<Qe);let vt=Ye*Et,Ut=vt+Et,Yt=ze*Et,Dt=Yt+Et,Rn=0;const bn=(vt+Ut)/2-ht;return bn>.5?Rn=-1:bn<-.5&&(Rn=1),vt=((vt+Rn)*lt-(ht*=lt))*ut+ht,Ut=((Ut+Rn)*lt-ht)*ut+ht,Yt=(Yt*lt-(mt*=lt))*ut+mt,Dt=(Dt*lt-mt)*ut+mt,[[vt,Dt,0],[Ut,Dt,0],[Ut,Yt,0],[vt,Yt,0]]}(f,c,g._pixelsPerMercatorPixel,X,K);for(let Ye=0;Ye<D.length;Ye++)rm(D[Ye],Oe[Ye],Be);const Ie=Pe.vec3.add([],Oe[he],Oe[(he+1)%4]);Pe.vec3.scale(Ie,Ie,.5),rm(Me,Ie,Be)}for(const Oe of D)Pe.vec3.min(R,R,Oe),Pe.vec3.max(H,H,Oe);return R[2]=Math.min(ne[2],de[2]),Pe.vec3.min(R,R,Me),Pe.vec3.max(H,H,Me),new Yi(R,H)}function fM({x:g,y:c,z:f},v=!1){const S=1/(1<<f),x=new ue(je(g*S),c===(1<<f)-1&&v?-90:Ge((c+1)*S)),A=new ue(je((g+1)*S),c===0&&v?90:Ge(c*S));return new ve(x,A)}function i3(g,c=u){const f=sn(g.getNorth()),v=sn(g.getSouth()),S=Math.cos(f),x=Math.cos(v),A=Math.sin(f),D=Math.sin(v),U=g.getWest(),H=g.getEast();return[J(x,D,U,c),J(x,D,H,c),J(S,A,H,c),J(S,A,U,c)]}function Rw(g,c,f,v){const S=1<<f.z,x=(g/yn+f.x)/S;return Q(Ge((c/yn+f.y)/S),je(x),v)}function dM({min:g,max:c}){return E/Math.max(c[0]-g[0],c[1]-g[1],c[2]-g[2])}const r9=new Float64Array(16);function pM(g){const c=dM(g),f=Pe.mat4.fromScaling(r9,[c,c,c]);return Pe.mat4.translate(f,f,Pe.vec3.negate([],g.min))}function s3(g){const c=Pe.mat4.fromTranslation(r9,g.min),f=1/dM(g);return Pe.mat4.scale(c,c,[f,f,f])}function o3(g){const c=yn/(2*Math.PI);return g/(2*Math.PI)/c}function i9(g,c){return yn/(512*Math.pow(2,g))*dM(kd(c))}function s9(g,c,f,v,S){const x=o3(f),A=[g,c,-f/(2*Math.PI)],D=Pe.mat4.identity(new Float64Array(16));return Pe.mat4.translate(D,D,A),Pe.mat4.scale(D,D,[x,x,x]),Pe.mat4.rotateX(D,D,sn(-S)),Pe.mat4.rotateY(D,D,sn(-v)),D}function $g(g){return mr(p,w,g)}function o9(g,c){const f=Q(c.lat,c.lng),v=function(x){const A=Q(x._center.lat,x._center.lng),D=Pe.vec3.fromValues(0,1,0);let U=Pe.vec3.cross([],D,A);const H=Pe.mat4.fromRotation([],-x.angle,A);U=Pe.vec3.transformMat4(U,U,H),Pe.mat4.fromRotation(H,-x._pitch,U);const R=Pe.vec3.normalize([],A);return Pe.vec3.scale(R,R,nm(x.cameraToCenterDistance/x.pixelsPerMeter)),Pe.vec3.transformMat4(R,R,H),Pe.vec3.add([],A,R)}(g),S=Pe.vec3.subtract([],v,f);return Pe.vec3.angle(S,f)}function a3(g,c){return o9(g,c)>Math.PI/2*1.01}const a9=sn(85),Oce=Math.cos(a9),Fce=Math.sin(a9),Nce=Pe.mat4.create(),l9=g=>{const c=[];return g.paint.get("circle-pitch-alignment")==="map"&&c.push("PITCH_WITH_MAP"),g.paint.get("circle-pitch-scale")==="map"&&c.push("SCALE_WITH_MAP"),c};function c9(g,c,f,v,S,x,A,D,U){if(x&&g.queryGeometry.isAboveHorizon)return!1;x&&(U*=g.pixelToTileUnitsFactor);const H=g.tileID.canonical,R=f.projection.upVectorScale(H,f.center.lat,f.worldSize).metersToTile;for(const N of c)for(const G of N){const z=G.add(D),V=S&&f.elevation?f.elevation.exaggeration()*S.getElevationAt(z.x,z.y,!0):0,X=f.projection.projectTilePoint(z.x,z.y,H);if(V>0){const he=f.projection.upVector(H,z.x,z.y);X.x+=he[0]*R*V,X.y+=he[1]*R*V,X.z+=he[2]*R*V}const K=x?z:zce(X.x,X.y,X.z,v),ee=x?g.tilespaceRays.map(he=>Vce(he,V)):g.queryGeometry.screenGeometry,ce=Pe.vec4.transformMat4([],[X.x,X.y,X.z,1],v);if(!A&&x?U*=ce[3]/f.cameraToCenterDistance:A&&!x&&(U*=f.cameraToCenterDistance/ce[3]),x){const he=Ge((G.y/yn+H.y)/(1<<H.z));U/=f.projection.pixelsPerMeter(he,1)/De(1,he)}if(Dn(ee,K,U))return!0}return!1}function zce(g,c,f,v){const S=Pe.vec4.transformMat4([],[g,c,f,1],v);return new St(S[0]/S[3],S[1]/S[3])}const u9=Pe.vec3.fromValues(0,0,0),Uce=Pe.vec3.fromValues(0,0,1);function Vce(g,c){const f=Pe.vec3.create();return u9[2]=c,g.intersectsPlane(u9,Uce,f),new St(f[0],f[1])}class h9 extends er{}let f9,d9,p9,m9;function g9(g,{width:c,height:f},v,S){if(S){if(S instanceof Uint8ClampedArray)S=new Uint8Array(S.buffer);else if(S.length!==c*f*v)throw new RangeError("mismatched image size")}else S=new Uint8Array(c*f*v);return g.width=c,g.height=f,g.data=S,g}function v9(g,c,f){const{width:v,height:S}=c;v===g.width&&S===g.height||(l3(g,c,{x:0,y:0},{x:0,y:0},{width:Math.min(g.width,v),height:Math.min(g.height,S)},f,null),g.width=v,g.height=S,g.data=c.data)}function l3(g,c,f,v,S,x,A,D){if(S.width===0||S.height===0)return c;if(S.width>g.width||S.height>g.height||f.x>g.width-S.width||f.y>g.height-S.height)throw new RangeError("out of range source coordinates for image copy");if(S.width>c.width||S.height>c.height||v.x>c.width-S.width||v.y>c.height-S.height)throw new RangeError("out of range destination coordinates for image copy");const U=g.data,H=c.data,R=x===4&&D;for(let N=0;N<S.height;N++){const G=((f.y+N)*g.width+f.x)*x,z=((v.y+N)*c.width+v.x)*x;if(R)for(let V=0;V<S.width;V++){const X=G+V*x+3,K=z+V*x;H[K+0]=255,H[K+1]=255,H[K+2]=255,H[K+3]=U[X]}else if(A)for(let V=0;V<S.width;V++){const X=G+V*x,K=z+V*x,ee=U[X+3],ce=new vr(U[X+0]/255*ee,U[X+1]/255*ee,U[X+2]/255*ee,ee).toRenderColor(A).toArray();H[K+0]=ce[0],H[K+1]=ce[1],H[K+2]=ce[2],H[K+3]=ce[3]}else for(let V=0;V<S.width*x;V++)H[z+V]=U[G+V]}return c}Fn(h9,"HeatmapBucket",{omit:["layers"]});class qg{constructor(c,f){g9(this,c,1,f)}resize(c){v9(this,new qg(c),1)}clone(){return new qg({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(c,f,v,S,x){l3(c,f,v,S,x,1,null)}}class ml{constructor(c,f){g9(this,c,4,f)}resize(c){v9(this,new ml(c),4)}replace(c,f){f?this.data.set(c):this.data=c instanceof Uint8ClampedArray?new Uint8Array(c.buffer):c}clone(){return new ml({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(c,f,v,S,x,A,D){l3(c,f,v,S,x,4,A,D)}}class _9{constructor(c,f){this.width=c.width,this.height=c.height,this.data=f instanceof Uint8Array?new Float32Array(f.buffer):f}}function Pw(g){const c={},f=g.resolution||256,v=g.clips?g.clips.length:1,S=g.image||new ml({width:f,height:v}),x=(A,D,U)=>{c[g.evaluationKey]=U;const H=g.expression.evaluate(c);H&&(S.data[A+D+0]=Math.floor(255*H.r/H.a),S.data[A+D+1]=Math.floor(255*H.g/H.a),S.data[A+D+2]=Math.floor(255*H.b/H.a),S.data[A+D+3]=Math.floor(255*H.a))};if(g.clips)for(let A=0,D=0;A<v;++A,D+=4*f)for(let U=0,H=0;U<f;U++,H+=4){const R=U/(f-1),{start:N,end:G}=g.clips[A];x(D,H,N*(1-R)+G*R)}else for(let A=0,D=0;A<f;A++,D+=4)x(0,D,A/(f-1));return S}Fn(qg,"AlphaImage"),Fn(ml,"RGBAImage");const Gce=Qr([{name:"a_pos",components:2,type:"Int16"}],4),{members:Hce}=Gce;function Lw(g,c,f=2){const v=c&&c.length,S=v?c[0]*f:g.length;let x=y9(g,0,S,f,!0);const A=[];if(!x||x.next===x.prev)return A;let D,U,H;if(v&&(x=function(R,N,G,z){const V=[];for(let X=0,K=N.length;X<K;X++){const ee=y9(R,N[X]*z,X<K-1?N[X+1]*z:R.length,z,!1);ee===ee.next&&(ee.steiner=!0),V.push(Kce(ee))}V.sort(qce);for(let X=0;X<V.length;X++)G=Zce(V[X],G);return G}(g,c,x,f)),g.length>80*f){D=1/0,U=1/0;let R=-1/0,N=-1/0;for(let G=f;G<S;G+=f){const z=g[G],V=g[G+1];z<D&&(D=z),V<U&&(U=V),z>R&&(R=z),V>N&&(N=V)}H=Math.max(R-D,N-U),H=H!==0?32767/H:0}return Dw(x,A,f,D,U,H,0),A}function y9(g,c,f,v,S){let x;if(S===function(A,D,U,H){let R=0;for(let N=D,G=U-H;N<U;N+=H)R+=(A[G]-A[N])*(A[N+1]+A[G+1]),G=N;return R}(g,c,f,v)>0)for(let A=c;A<f;A+=v)x=w9(A/v|0,g[A],g[A+1],x);else for(let A=f-v;A>=c;A-=v)x=w9(A/v|0,g[A],g[A+1],x);return x&&mM(x,x.next)&&(kw(x),x=x.next),x}function o_(g,c){if(!g)return g;c||(c=g);let f,v=g;do if(f=!1,v.steiner||!mM(v,v.next)&&No(v.prev,v,v.next)!==0)v=v.next;else{if(kw(v),v=c=v.prev,v===v.next)break;f=!0}while(f||v!==c);return c}function Dw(g,c,f,v,S,x,A){if(!g)return;!A&&x&&function(U,H,R,N){let G=U;do G.z===0&&(G.z=c3(G.x,G.y,H,R,N)),G.prevZ=G.prev,G.nextZ=G.next,G=G.next;while(G!==U);G.prevZ.nextZ=null,G.prevZ=null,function(z){let V,X=1;do{let K,ee=z;z=null;let ce=null;for(V=0;ee;){V++;let he=ee,ne=0;for(let ge=0;ge<X&&(ne++,he=he.nextZ,he);ge++);let de=X;for(;ne>0||de>0&&he;)ne!==0&&(de===0||!he||ee.z<=he.z)?(K=ee,ee=ee.nextZ,ne--):(K=he,he=he.nextZ,de--),ce?ce.nextZ=K:z=K,K.prevZ=ce,ce=K;ee=he}ce.nextZ=null,X*=2}while(V>1)}(G)}(g,v,S,x);let D=g;for(;g.prev!==g.next;){const U=g.prev,H=g.next;if(x?Wce(g,v,S,x):jce(g))c.push(U.i,g.i,H.i),kw(g),g=H.next,D=H.next;else if((g=H)===D){A?A===1?Dw(g=Xce(o_(g),c),c,f,v,S,x,2):A===2&&$ce(g,c,f,v,S,x):Dw(o_(g),c,f,v,S,x,1);break}}}function jce(g){const c=g.prev,f=g,v=g.next;if(No(c,f,v)>=0)return!1;const S=c.x,x=f.x,A=v.x,D=c.y,U=f.y,H=v.y,R=S<x?S<A?S:A:x<A?x:A,N=D<U?D<H?D:H:U<H?U:H,G=S>x?S>A?S:A:x>A?x:A,z=D>U?D>H?D:H:U>H?U:H;let V=v.next;for(;V!==c;){if(V.x>=R&&V.x<=G&&V.y>=N&&V.y<=z&&Nx(S,D,x,U,A,H,V.x,V.y)&&No(V.prev,V,V.next)>=0)return!1;V=V.next}return!0}function Wce(g,c,f,v){const S=g.prev,x=g,A=g.next;if(No(S,x,A)>=0)return!1;const D=S.x,U=x.x,H=A.x,R=S.y,N=x.y,G=A.y,z=D<U?D<H?D:H:U<H?U:H,V=R<N?R<G?R:G:N<G?N:G,X=D>U?D>H?D:H:U>H?U:H,K=R>N?R>G?R:G:N>G?N:G,ee=c3(z,V,c,f,v),ce=c3(X,K,c,f,v);let he=g.prevZ,ne=g.nextZ;for(;he&&he.z>=ee&&ne&&ne.z<=ce;){if(he.x>=z&&he.x<=X&&he.y>=V&&he.y<=K&&he!==S&&he!==A&&Nx(D,R,U,N,H,G,he.x,he.y)&&No(he.prev,he,he.next)>=0||(he=he.prevZ,ne.x>=z&&ne.x<=X&&ne.y>=V&&ne.y<=K&&ne!==S&&ne!==A&&Nx(D,R,U,N,H,G,ne.x,ne.y)&&No(ne.prev,ne,ne.next)>=0))return!1;ne=ne.nextZ}for(;he&&he.z>=ee;){if(he.x>=z&&he.x<=X&&he.y>=V&&he.y<=K&&he!==S&&he!==A&&Nx(D,R,U,N,H,G,he.x,he.y)&&No(he.prev,he,he.next)>=0)return!1;he=he.prevZ}for(;ne&&ne.z<=ce;){if(ne.x>=z&&ne.x<=X&&ne.y>=V&&ne.y<=K&&ne!==S&&ne!==A&&Nx(D,R,U,N,H,G,ne.x,ne.y)&&No(ne.prev,ne,ne.next)>=0)return!1;ne=ne.nextZ}return!0}function Xce(g,c){let f=g;do{const v=f.prev,S=f.next.next;!mM(v,S)&&x9(v,f,f.next,S)&&Bw(v,S)&&Bw(S,v)&&(c.push(v.i,f.i,S.i),kw(f),kw(f.next),f=g=S),f=f.next}while(f!==g);return o_(f)}function $ce(g,c,f,v,S,x){let A=g;do{let D=A.next.next;for(;D!==A.prev;){if(A.i!==D.i&&Jce(A,D)){let U=b9(A,D);return A=o_(A,A.next),U=o_(U,U.next),Dw(A,c,f,v,S,x,0),void Dw(U,c,f,v,S,x,0)}D=D.next}A=A.next}while(A!==g)}function qce(g,c){return g.x-c.x}function Zce(g,c){const f=function(S,x){let A=x;const D=S.x,U=S.y;let H,R=-1/0;do{if(U<=A.y&&U>=A.next.y&&A.next.y!==A.y){const X=A.x+(U-A.y)*(A.next.x-A.x)/(A.next.y-A.y);if(X<=D&&X>R&&(R=X,H=A.x<A.next.x?A:A.next,X===D))return H}A=A.next}while(A!==x);if(!H)return null;const N=H,G=H.x,z=H.y;let V=1/0;A=H;do{if(D>=A.x&&A.x>=G&&D!==A.x&&Nx(U<z?D:R,U,G,z,U<z?R:D,U,A.x,A.y)){const X=Math.abs(U-A.y)/(D-A.x);Bw(A,S)&&(X<V||X===V&&(A.x>H.x||A.x===H.x&&Yce(H,A)))&&(H=A,V=X)}A=A.next}while(A!==N);return H}(g,c);if(!f)return c;const v=b9(f,g);return o_(v,v.next),o_(f,f.next)}function Yce(g,c){return No(g.prev,g,c.prev)<0&&No(c.next,g,g.next)<0}function c3(g,c,f,v,S){return(g=1431655765&((g=858993459&((g=252645135&((g=16711935&((g=(g-f)*S|0)|g<<8))|g<<4))|g<<2))|g<<1))|(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-v)*S|0)|c<<8))|c<<4))|c<<2))|c<<1))<<1}function Kce(g){let c=g,f=g;do(c.x<f.x||c.x===f.x&&c.y<f.y)&&(f=c),c=c.next;while(c!==g);return f}function Nx(g,c,f,v,S,x,A,D){return(S-A)*(c-D)>=(g-A)*(x-D)&&(g-A)*(v-D)>=(f-A)*(c-D)&&(f-A)*(x-D)>=(S-A)*(v-D)}function Jce(g,c){return g.next.i!==c.i&&g.prev.i!==c.i&&!function(f,v){let S=f;do{if(S.i!==f.i&&S.next.i!==f.i&&S.i!==v.i&&S.next.i!==v.i&&x9(S,S.next,f,v))return!0;S=S.next}while(S!==f);return!1}(g,c)&&(Bw(g,c)&&Bw(c,g)&&function(f,v){let S=f,x=!1;const A=(f.x+v.x)/2,D=(f.y+v.y)/2;do S.y>D!=S.next.y>D&&S.next.y!==S.y&&A<(S.next.x-S.x)*(D-S.y)/(S.next.y-S.y)+S.x&&(x=!x),S=S.next;while(S!==f);return x}(g,c)&&(No(g.prev,g,c.prev)||No(g,c.prev,c))||mM(g,c)&&No(g.prev,g,g.next)>0&&No(c.prev,c,c.next)>0)}function No(g,c,f){return(c.y-g.y)*(f.x-c.x)-(c.x-g.x)*(f.y-c.y)}function mM(g,c){return g.x===c.x&&g.y===c.y}function x9(g,c,f,v){const S=vM(No(g,c,f)),x=vM(No(g,c,v)),A=vM(No(f,v,g)),D=vM(No(f,v,c));return S!==x&&A!==D||!(S!==0||!gM(g,f,c))||!(x!==0||!gM(g,v,c))||!(A!==0||!gM(f,g,v))||!(D!==0||!gM(f,c,v))}function gM(g,c,f){return c.x<=Math.max(g.x,f.x)&&c.x>=Math.min(g.x,f.x)&&c.y<=Math.max(g.y,f.y)&&c.y>=Math.min(g.y,f.y)}function vM(g){return g>0?1:g<0?-1:0}function Bw(g,c){return No(g.prev,g,g.next)<0?No(g,c,g.next)>=0&&No(g,g.prev,c)>=0:No(g,c,g.prev)<0||No(g,g.next,c)<0}function b9(g,c){const f=u3(g.i,g.x,g.y),v=u3(c.i,c.x,c.y),S=g.next,x=c.prev;return g.next=c,c.prev=g,f.next=S,S.prev=f,v.next=f,f.prev=v,x.next=v,v.prev=x,v}function w9(g,c,f,v){const S=u3(g,c,f);return v?(S.next=v.next,S.prev=v,v.next.prev=S,v.next=S):(S.prev=S,S.next=S),S}function kw(g){g.next.prev=g.prev,g.prev.next=g.next,g.prevZ&&(g.prevZ.nextZ=g.nextZ),g.nextZ&&(g.nextZ.prevZ=g.prevZ)}function u3(g,c,f){return{i:g,x:c,y:f,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function _M(g,c){const f=g.length;if(f<=1)return[g];const v=[];let S,x;for(let A=0;A<f;A++){const D=un(g[A]);D!==0&&(g[A].area=Math.abs(D),x===void 0&&(x=D<0),x===D<0?(S&&v.push(S),S=[g[A]]):S.push(g[A]))}if(S&&v.push(S),c>1)for(let A=0;A<v.length;A++)v[A].length<=c||(Dv(v[A],c,1,v[A].length-1,Qce),v[A]=v[A].slice(0,c));return v}function Qce(g,c){return c.area-g.area}function h3(g,c,f){const v=f.patternDependencies;let S=!1;for(const x of c){const A=x.paint.get(`${g}-pattern`);A.isConstant()||(S=!0);const D=A.constantOr(null);D&&(S=!0,v[D]=!0)}return S}function f3(g,c,f,v,S){const x=S.patternDependencies;for(const A of c){const D=A.paint.get(`${g}-pattern`).value;if(D.kind!=="constant"){let U=D.evaluate({zoom:v},f,{},S.availableImages);U=U&&U.name?U.name:U,x[U]=!0,f.patterns[A.id]=U}}return f}class d3{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(f=>f.fqid),this.index=c.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new lc,this.indexArray=new bo,this.indexArray2=new bu,this.programConfigurations=new rr(c.layers,{zoom:c.zoom,lut:c.lut}),this.segments=new xs,this.segments2=new xs,this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id),this.projection=c.projection}updateFootprints(c,f){}populate(c,f,v,S){this.hasPattern=h3("fill",this.layers,f);const x=this.layers[0].layout.get("fill-sort-key"),A=[];for(const{feature:D,id:U,index:H,sourceLayerIndex:R}of c){const N=this.layers[0]._featureFilter.needGeometry,G=pn(D,N);if(!this.layers[0]._featureFilter.filter(new hs(this.zoom),G,v))continue;const z=x?x.evaluate(G,{},v,f.availableImages):void 0,V={id:U,properties:D.properties,type:D.type,sourceLayerIndex:R,index:H,geometry:N?G.geometry:fn(D,v,S),patterns:{},sortKey:z};A.push(V)}x&&A.sort((D,U)=>D.sortKey-U.sortKey);for(const D of A){const{geometry:U,index:H,sourceLayerIndex:R}=D;if(this.hasPattern){const N=f3("fill",this.layers,D,this.zoom,f);this.patternFeatures.push(N)}else this.addFeature(D,U,H,v,{},f.availableImages,f.brightness);f.featureIndex.insert(c[H].feature,U,H,R,this.index)}}update(c,f,v,S,x){const A=Object.keys(c).length!==0;A&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(c,f,A?this.stateDependentLayers:this.layers,v,S,x)}addFeatures(c,f,v,S,x,A){for(const D of this.patternFeatures)this.addFeature(D,D.geometry,D.index,f,v,S,A)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,Hce),this.indexBuffer=c.createIndexBuffer(this.indexArray),this.indexBuffer2=c.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(c,f,v,S,x,A=[],D){for(const U of _M(f,500)){let H=0;for(const X of U)H+=X.length;const R=this.segments.prepareSegment(H,this.layoutVertexArray,this.indexArray),N=R.vertexLength,G=[],z=[];for(const X of U){if(X.length===0)continue;X!==U[0]&&z.push(G.length/2);const K=this.segments2.prepareSegment(X.length,this.layoutVertexArray,this.indexArray2),ee=K.vertexLength;this.layoutVertexArray.emplaceBack(X[0].x,X[0].y),this.indexArray2.emplaceBack(ee+X.length-1,ee),G.push(X[0].x),G.push(X[0].y);for(let ce=1;ce<X.length;ce++)this.layoutVertexArray.emplaceBack(X[ce].x,X[ce].y),this.indexArray2.emplaceBack(ee+ce-1,ee+ce),G.push(X[ce].x),G.push(X[ce].y);K.vertexLength+=X.length,K.primitiveLength+=X.length}const V=Lw(G,z);for(let X=0;X<V.length;X+=3)this.indexArray.emplaceBack(N+V[X],N+V[X+1],N+V[X+2]);R.vertexLength+=H,R.primitiveLength+=V.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,v,x,A,S,D)}}let S9,A9,T9,M9;Fn(d3,"FillBucket",{omit:["layers","patternFeatures"]});class p3{constructor(c,f,v,S){if(this.triangleCount=f.length/3,this.min=new St(0,0),this.max=new St(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||c.length===0)return;const[x,A]=[c[0].clone(),c[0].clone()];for(let N=1;N<c.length;++N){const G=c[N];x.x=Math.min(x.x,G.x),x.y=Math.min(x.y,G.y),A.x=Math.max(A.x,G.x),A.y=Math.max(A.y,G.y)}if(S){const N=Math.ceil(Math.max(A.x-x.x,A.y-x.y)/S);v=Math.max(v,N)}if(v===0)return;this.min=x,this.max=A;const D=this.max.sub(this.min);D.x=Math.max(D.x,1),D.y=Math.max(D.y,1);const U=Math.max(D.x,D.y)/v;this.cellsX=Math.max(1,Math.ceil(D.x/U)),this.cellsY=Math.max(1,Math.ceil(D.y/U)),this.xScale=1/U,this.yScale=1/U;const H=[];for(let N=0;N<this.triangleCount;N++){const G=c[f[3*N+0]].sub(this.min),z=c[f[3*N+1]].sub(this.min),V=c[f[3*N+2]].sub(this.min),X=Od(Math.floor(Math.min(G.x,z.x,V.x)),this.xScale,this.cellsX),K=Od(Math.floor(Math.max(G.x,z.x,V.x)),this.xScale,this.cellsX),ee=Od(Math.floor(Math.min(G.y,z.y,V.y)),this.yScale,this.cellsY),ce=Od(Math.floor(Math.max(G.y,z.y,V.y)),this.yScale,this.cellsY),he=new St(0,0),ne=new St(0,0),de=new St(0,0),ge=new St(0,0);for(let Me=ee;Me<=ce;++Me){he.y=ne.y=Me*U,de.y=ge.y=(Me+1)*U;for(let Be=X;Be<=K;++Be)he.x=de.x=Be*U,ne.x=ge.x=(Be+1)*U,(Oi(G,z,V,he,ne,ge)||Oi(G,z,V,he,ge,de))&&H.push({cellIdx:Me*this.cellsX+Be,triIdx:N})}}if(H.length===0)return;H.sort((N,G)=>N.cellIdx-G.cellIdx||N.triIdx-G.triIdx);let R=0;for(;R<H.length;){const N=H[R].cellIdx,G={start:this.payload.length,len:0};for(;R<H.length&&H[R].cellIdx===N;)++G.len,this.payload.push(H[R++].triIdx);this.cells[N]=G}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(c,f){if(this.triangleCount===0||this.cells.length===0||c.x>this.max.x||this.min.x>c.x||c.y>this.max.y||this.min.y>c.y)return;const v=Od(c.x-this.min.x,this.xScale,this.cellsX),S=Od(c.y-this.min.y,this.yScale,this.cellsY),x=this.cells[S*this.cellsX+v];if(x){this._lazyInitLookup();for(let A=0;A<x.len;A++){const D=this.payload[x.start+A],U=Math.floor(D/8),H=1<<D%8;if(!(this.lookup[U]&H)&&(this.lookup[U]|=H,f.push(D),f.length===this.triangleCount))return}}}query(c,f,v){if(this.triangleCount===0||this.cells.length===0||c.x>this.max.x||this.min.x>f.x||c.y>this.max.y||this.min.y>f.y)return;this._lazyInitLookup();const S=Od(c.x-this.min.x,this.xScale,this.cellsX),x=Od(f.x-this.min.x,this.xScale,this.cellsX),A=Od(c.y-this.min.y,this.yScale,this.cellsY),D=Od(f.y-this.min.y,this.yScale,this.cellsY);for(let U=A;U<=D;U++)for(let H=S;H<=x;H++){const R=this.cells[U*this.cellsX+H];if(R)for(let N=0;N<R.len;N++){const G=this.payload[R.start+N],z=Math.floor(G/8),V=1<<G%8;if(!(this.lookup[z]&V)&&(this.lookup[z]|=V,v.push(G),v.length===this.triangleCount))return}}}}function Od(g,c,f){return Math.max(0,Math.min(f-1,Math.floor(g*c)))}Fn(p3,"TriangleGridIndex");class C9{constructor(c){this.zoom=c.zoom,this.layers=c.layers,this.layerIds=this.layers.map(f=>f.fqid),this.index=c.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id),this.footprints=[]}updateFootprints(c,f){for(const v of this.footprints)f.push({footprint:v,id:c})}populate(c,f,v,S){const x=[];for(const{feature:A,id:D,index:U,sourceLayerIndex:H}of c){const R=this.layers[0]._featureFilter.needGeometry,N=pn(A,R);if(!this.layers[0]._featureFilter.filter(new hs(this.zoom),N,v))continue;const G={id:D,properties:A.properties,type:A.type,sourceLayerIndex:H,index:U,geometry:R?N.geometry:fn(A,v,S),patterns:{}};x.push(G)}for(const A of x){const{geometry:D,index:U,sourceLayerIndex:H}=A;this.addFeature(A,D,U,v,{},f.availableImages,f.brightness),f.featureIndex.insert(c[U].feature,D,U,H,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(c){}update(c,f,v,S,x){}destroy(){}addFeature(c,f,v,S,x,A=[],D){for(const U of _M(f,2)){const H=[],R=[],N=[],G=new St(1/0,1/0),z=new St(-1/0,-1/0);for(const K of U)if(K.length!==0){K!==U[0]&&N.push(R.length/2);for(let ee=0;ee<K.length;ee++)R.push(K[ee].x),R.push(K[ee].y),H.push(K[ee]),G.x=Math.min(G.x,K[ee].x),G.y=Math.min(G.y,K[ee].y),z.x=Math.max(z.x,K[ee].x),z.y=Math.max(z.y,K[ee].y)}const V=Lw(R,N),X=new p3(H,V,8,256);this.footprints.push({vertices:H,indices:V,grid:X,min:G,max:z})}}}Fn(C9,"ClipBucket",{omit:["layers"]});const eue=Qr([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),tue=Qr([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),nue=Qr([{name:"a_centroid_pos",components:2,type:"Uint16"}]),rue=Qr([{name:"a_join_normal_inside",components:3,type:"Int16"}]),iue=Qr([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),sue=Qr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:oue}=eue;var m3,E9,g3,I9,v3,R9,P9,yM={};function L9(){if(E9)return m3;E9=1;var g=cn();function c(S,x,A,D,U){this.properties={},this.extent=A,this.type=0,this._pbf=S,this._geometry=-1,this._keys=D,this._values=U,S.readFields(f,this,x)}function f(S,x,A){S==1?x.id=A.readVarint():S==2?function(D,U){for(var H=D.readVarint()+D.pos;D.pos<H;){var R=U._keys[D.readVarint()],N=U._values[D.readVarint()];U.properties[R]=N}}(A,x):S==3?x.type=A.readVarint():S==4&&(x._geometry=A.pos)}function v(S){for(var x,A,D=0,U=0,H=S.length,R=H-1;U<H;R=U++)D+=((A=S[R]).x-(x=S[U]).x)*(x.y+A.y);return D}return m3=c,c.types=["Unknown","Point","LineString","Polygon"],c.prototype.loadGeometry=function(){var S=this._pbf;S.pos=this._geometry;for(var x,A=S.readVarint()+S.pos,D=1,U=0,H=0,R=0,N=[];S.pos<A;){if(U<=0){var G=S.readVarint();D=7&G,U=G>>3}if(U--,D===1||D===2)H+=S.readSVarint(),R+=S.readSVarint(),D===1&&(x&&N.push(x),x=[]),x.push(new g(H,R));else{if(D!==7)throw new Error("unknown command "+D);x&&x.push(x[0].clone())}}return x&&N.push(x),N},c.prototype.bbox=function(){var S=this._pbf;S.pos=this._geometry;for(var x=S.readVarint()+S.pos,A=1,D=0,U=0,H=0,R=1/0,N=-1/0,G=1/0,z=-1/0;S.pos<x;){if(D<=0){var V=S.readVarint();A=7&V,D=V>>3}if(D--,A===1||A===2)(U+=S.readSVarint())<R&&(R=U),U>N&&(N=U),(H+=S.readSVarint())<G&&(G=H),H>z&&(z=H);else if(A!==7)throw new Error("unknown command "+A)}return[R,G,N,z]},c.prototype.toGeoJSON=function(S,x,A){var D,U,H=this.extent*Math.pow(2,A),R=this.extent*S,N=this.extent*x,G=this.loadGeometry(),z=c.types[this.type];function V(ee){for(var ce=0;ce<ee.length;ce++){var he=ee[ce];ee[ce]=[360*(he.x+R)/H-180,360/Math.PI*Math.atan(Math.exp((180-360*(he.y+N)/H)*Math.PI/180))-90]}}switch(this.type){case 1:var X=[];for(D=0;D<G.length;D++)X[D]=G[D][0];V(G=X);break;case 2:for(D=0;D<G.length;D++)V(G[D]);break;case 3:for(G=function(ee){var ce=ee.length;if(ce<=1)return[ee];for(var he,ne,de=[],ge=0;ge<ce;ge++){var Me=v(ee[ge]);Me!==0&&(ne===void 0&&(ne=Me<0),ne===Me<0?(he&&de.push(he),he=[ee[ge]]):he.push(ee[ge]))}return he&&de.push(he),de}(G),D=0;D<G.length;D++)for(U=0;U<G[D].length;U++)V(G[D][U])}G.length===1?G=G[0]:z="Multi"+z;var K={type:"Feature",geometry:{type:z,coordinates:G},properties:this.properties};return"id"in this&&(K.id=this.id),K},m3}function D9(){if(I9)return g3;I9=1;var g=L9();function c(v,S){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=v,this._keys=[],this._values=[],this._features=[],v.readFields(f,this,S),this.length=this._features.length}function f(v,S,x){v===15?S.version=x.readVarint():v===1?S.name=x.readString():v===5?S.extent=x.readVarint():v===2?S._features.push(x.pos):v===3?S._keys.push(x.readString()):v===4&&S._values.push(function(A){for(var D=null,U=A.readVarint()+A.pos;A.pos<U;){var H=A.readVarint()>>3;D=H===1?A.readString():H===2?A.readFloat():H===3?A.readDouble():H===4?A.readVarint64():H===5?A.readVarint():H===6?A.readSVarint():H===7?A.readBoolean():null}return D}(x))}return g3=c,c.prototype.feature=function(v){if(v<0||v>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[v];var S=this._pbf.readVarint()+this._pbf.pos;return new g(this._pbf,S,this.extent,this._keys,this._values)},g3}function B9(){return P9||(P9=1,yM.VectorTile=function(){if(R9)return v3;R9=1;var g=D9();function c(f,v,S){if(f===3){var x=new g(S,S.readVarint()+S.pos);x.length&&(v[x.name]=x)}}return v3=function(f,v){this.layers=f.readFields(c,{},v)},v3}(),yM.VectorTileFeature=L9(),yM.VectorTileLayer=D9()),yM}var zx=B9();class a_ extends St{constructor(c,f,v){super(c,f),this.z=v}}class k9 extends a_{constructor(c,f,v,S){super(c,f,v),this.w=S}}function xM(g,c,f,v){const S=[],x=v===0?(A,D,U,H,R,N)=>{A.push(new St(N,U+(N-D)/(H-D)*(R-U)))}:(A,D,U,H,R,N)=>{A.push(new St(D+(N-U)/(R-U)*(H-D),N))};for(const A of g){const D=[];for(const U of A){if(U.length<=2)continue;const H=[];for(let G=0;G<U.length-1;G++){const z=U[G].x,V=U[G].y,X=U[G+1].x,K=U[G+1].y,ee=v===0?z:V,ce=v===0?X:K;ee<c?ce>c&&x(H,z,V,X,K,c):ee>f?ce<f&&x(H,z,V,X,K,f):H.push(U[G]),ce<c&&ee>=c&&x(H,z,V,X,K,c),ce>f&&ee<=f&&x(H,z,V,X,K,f)}let R=U[U.length-1];const N=v===0?R.x:R.y;N>=c&&N<=f&&H.push(R),H.length&&(R=H[H.length-1],H[0].x===R.x&&H[0].y===R.y||H.push(H[0]),D.push(H))}D.length&&S.push(D)}return S}function O9(g,c,f,v){const S=f==="x"?"y":"x",x=(v-g[f])/(c[f]-g[f]);g[S]=g[S]+(c[S]-g[S])*x,g[f]=v,g.hasOwnProperty("z")&&(g.z=cr(g.z,c.z,x)),g.hasOwnProperty("w")&&(g.w=cr(g.w,c.w,x))}function F9(g,c,f,v){const S=f,x=v;for(const A of["x","y"]){let D=g,U=c;D[A]>=U[A]&&(D=c,U=g),D[A]<S&&U[A]>S&&O9(D,U,A,S),D[A]<x&&U[A]>x&&O9(U,D,A,x)}}const bM=Number.MAX_SAFE_INTEGER;function N9(g,c,f,v){return g.order<c||g.order===bM||!(g.clipMask&f)||function(S,x){return x.length!==0&&x.find(A=>A===S)===void 0}(v,g.clipScope)}function wM(g,c){return g.x-c.x||g.y-c.y}function z9(g,c){return wM(g.min,c.min)===0&&wM(g.max,c.max)===0}function _3(g,c){return!(g.min.x>c.max.x||g.max.x<c.min.x||g.min.y>c.max.y||g.max.y<c.min.y)}function y3(g,c){if(g.length!==c.length)return!1;for(let f=0;f<g.length;f++)if(g[f].sourceId!==c[f].sourceId||!z9(g[f],c[f])||g[f].order!==c[f].order||g[f].clipMask!==c[f].clipMask||!Jt(g[f].clipScope,c[f].clipScope))return!1;return!0}function U9(g,c,f){const v=1/yn,S=1/(1<<f.canonical.z),x=(c.x*v+f.canonical.x)*S+f.wrap,A=(c.y*v+f.canonical.y)*S;return{min:new St((g.x*v+f.canonical.x)*S+f.wrap,(g.y*v+f.canonical.y)*S),max:new St(x,A)}}function aue(g,c,f){const v=1<<f.canonical.z,S=((c.x-f.wrap)*v-f.canonical.x)*yn,x=(c.y*v-f.canonical.y)*yn;return{min:new St(((g.x-f.wrap)*v-f.canonical.x)*yn,(g.y*v-f.canonical.y)*yn),max:new St(S,x)}}function V9(g,c,f,v,S,x,A){const D=g.indices,U=g.vertices,H=[];for(let R=v;R<v+S;R+=3){const N=c[f[R+0]+x],G=c[f[R+1]+x],z=c[f[R+2]+x],V=Math.min(N.x,G.x,z.x),X=Math.max(N.x,G.x,z.x),K=Math.min(N.y,G.y,z.y),ee=Math.max(N.y,G.y,z.y);H.length=0,g.grid.query(new St(V,K),new St(X,ee),H);for(let ce=0;ce<H.length;ce++){const he=H[ce];if(Oi(U[D[3*he+0]],U[D[3*he+1]],U[D[3*he+2]],N,G,z,A))return!0}}return!1}function G9(g,c,f,v){if(!g||!f)return!1;let S=g.vertices;if(!c.canonical.equals(v.canonical)||c.wrap!==v.wrap){if(f.vertices.length<g.vertices.length)return G9(f,v,g,c);const x=c.canonical,A=v.canonical,D=Math.pow(2,A.z-x.z);S=g.vertices.map(U=>new St((U.x+x.x*yn)*D-A.x*yn,(U.y+x.y*yn)*D-A.y*yn))}return V9(f,S,g.indices,0,g.indices.length,0,0)}function H9(g,c,f,v){const S=Math.pow(2,v.z-f.z);return new St((g+f.x*yn)*S-v.x*yn,(c+f.y*yn)*S-v.y*yn)}function j9(g,c){const f=[];c.grid.queryPoint(g,f);const v=c.indices,S=c.vertices;for(let x=0;x<f.length;x++){const A=f[x];if(ns([S[v[3*A+0]],S[v[3*A+1]],S[v[3*A+2]]],g))return!0}return!1}const x3=[new St(0,0),new St(yn,0),new St(yn,yn),new St(0,yn)];function W9(g,c){const f=[];let v=[];if(!c||g.length<2)return[g];if(g.length===2)return Js(g[0],g[1],x3)?[g]:[];for(let S=0;S<g.length+2;S++){const x=g[S%g.length],A=g[(S+1)%g.length],D=Js(S===0?g[g.length-1]:g[(S-1)%g.length],x,x3),U=Js(x,A,x3),H=D||U;H&&v.push(x),H&&U||v.length>0&&(v.length>1&&f.push(v),v=[])}return v.length>1&&f.push(v),f}const b3=zx.VectorTileFeature.types,lue=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],cue=["fill-extrusion-flood-light-ground-radius"],uue=Math.pow(2,13),hue=Math.pow(2,15)-1,X9=new St(0,1),Zg=2147483648;function Ow(g,c,f,v,S,x,A,D){g.emplaceBack((c<<1)+A,(f<<1)+x,(Math.floor(v*uue)<<1)+S,Math.round(D))}function Fw(g,c,f){g.emplaceBack(c.x*yn,c.y*yn,f?1:0)}function SM(g,c,f,v,S,x){g.emplaceBack(c.x,c.y,(f.x<<1)+v,(f.y<<1)+S,x)}function Nw(g,c,f){g.emplaceBack(c.x,c.y,c.z,f[0]*16384,f[1]*16384,f[2]*16384)}class $9{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class q9{constructor(){this.centroidXY=new St(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new St(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new St(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new St(this.max.x-this.min.x,this.max.y-this.min.y)}}class Z9{constructor(){this.acc=new St(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(c,f){c.min.x===Number.MAX_VALUE&&(c.min.x=c.max.x=f.x,c.min.y=c.max.y=f.y)}appendEdge(c,f,v){this.accCount++,this.acc._add(f);let S=!!this.borders;f.x<c.min.x?(c.min.x=f.x,S=!0):f.x>c.max.x&&(c.max.x=f.x,S=!0),f.y<c.min.y?(c.min.y=f.y,S=!0):f.y>c.max.y&&(c.max.y=f.y,S=!0),((f.x===0||f.x===yn)&&f.x===v.x)!=((f.y===0||f.y===yn)&&f.y===v.y)&&this.processBorderOverlap(f,v),S&&this.checkBorderIntersection(f,v)}checkBorderIntersection(c,f){f.x<0!=c.x<0&&this.addBorderIntersection(0,cr(f.y,c.y,(0-f.x)/(c.x-f.x))),f.x>yn!=c.x>yn&&this.addBorderIntersection(1,cr(f.y,c.y,(yn-f.x)/(c.x-f.x))),f.y<0!=c.y<0&&this.addBorderIntersection(2,cr(f.x,c.x,(0-f.y)/(c.y-f.y))),f.y>yn!=c.y>yn&&this.addBorderIntersection(3,cr(f.x,c.x,(yn-f.y)/(c.y-f.y)))}addBorderIntersection(c,f){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const v=this.borders[c];f<v[0]&&(v[0]=f),f>v[1]&&(v[1]=f)}processBorderOverlap(c,f){if(c.x===f.x){if(c.y===f.y)return;const v=c.x===0?0:1;this.addBorderIntersection(v,f.y),this.addBorderIntersection(v,c.y)}else{const v=c.y===0?2:3;this.addBorderIntersection(v,f.x),this.addBorderIntersection(v,c.x)}}centroid(){return this.accCount===0?new St(0,0):new St(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((c,f)=>c+ +(f[0]!==Number.MAX_VALUE),0):0}}function Y9(g,c){const f=g.add(c)._unit(),v=jt(g.x*f.x+g.y*f.y,-1,1);var S,x,A;return A=Math.acos(v),Math.min(4,Math.max(-4,Math.tan(A)))/4*hue*((S=g).x*(x=c).y-S.y*x.x<0?-1:1)}const fue=[g=>g.x<0,g=>g.x>yn,g=>g.y<0,g=>g.y>yn];function due(g,c,f,v){const S=[4];if(v===0)return S;f._mult(v);const x=g.sub(f),A=c.sub(f),D=[g,c,x,A];for(let U=0;U<4;U++)for(const H of D)if(fue[U](H)){S.push(U);break}return S}class K9{constructor(c){this.vertexArray=new cc,this.indexArray=new bo,this.programConfigurations=new rr(c.layers,{zoom:c.zoom,lut:c.lut},f=>cue.includes(f)),this._segments=new xs,this.hiddenByLandmarkVertexArray=new Jp,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new xs}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(c,f,v,S=!1){const x=c.length;if(x>2){let A=Math.max(0,this._segments.get().length-1);const D=this._segments._prepareSegment(4*x,this.vertexArray.length,2*this._segmentToGroundQuads[A].length);let U;A!==this._segments.get().length-1&&(A++,this._segmentToGroundQuads[A]=[],this._segmentToRegionTriCounts[A]=[0,0,0,0,0]);{const H=c[0],R=c[1];U=Y9(H.sub(c[x-1])._perp()._unit(),R.sub(H)._perp()._unit())}for(let H=0;H<x;H++){const R=H===x-1?0:H+1,N=c[H],G=c[R],z=c[R===x-1?0:R+1],V=G.sub(N)._perp()._unit(),X=Y9(V,z.sub(G)._perp()._unit()),K=U,ee=X;if(w3(N,G,f)||S&&e7(N,f)&&e7(G,f)){U=X;continue}const ce=D.vertexLength;SM(this.vertexArray,N,G,1,1,K),SM(this.vertexArray,N,G,1,0,K),SM(this.vertexArray,N,G,0,1,ee),SM(this.vertexArray,N,G,0,0,ee),D.vertexLength+=4;const he=due(N,G,V,v);for(const ne of he)this._segmentToGroundQuads[A].push({id:ce,region:ne}),this._segmentToRegionTriCounts[A][ne]+=2,D.primitiveLength+=2;U=X}}}prepareBorderSegments(){if(!this.hasData())return;const c=this._segments.get(),f=c.length;for(let v=0;v<f;v++)this._segmentToGroundQuads[v].sort((S,x)=>S.region-x.region);for(let v=0;v<f;v++){const S=this._segmentToGroundQuads[v],x=c[v],A=this._segmentToRegionTriCounts[v];A.reduce((U,H)=>U+H,0);let D=0;for(let U=0;U<=4;U++){const H=A[U];if(H!==0){let R=this.regionSegments[U];R||(R=this.regionSegments[U]=new xs);const N={vertexOffset:x.vertexOffset,primitiveOffset:x.primitiveOffset+D,vertexLength:x.vertexLength,primitiveLength:H};R.get().push(N)}D+=H}for(let U=0;U<S.length;U++){const H=S[U].id;this.indexArray.emplaceBack(H,H+1,H+3),this.indexArray.emplaceBack(H,H+3,H+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(c,f,v,S,x,A){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,c,f,v,S,x,A)}upload(c){this.hasData()&&(this.vertexBuffer=c.createVertexBuffer(this.vertexArray,tue.members),this.indexBuffer=c.createIndexBuffer(this.indexArray))}uploadPaintProperties(c){this.hasData()&&this.programConfigurations.upload(c)}update(c,f,v,S,x,A){this.hasData()&&this.programConfigurations.updatePaintArrays(c,f,v,S,x,A)}updateHiddenByLandmark(c){if(!this.hasData())return;const f=c.groundVertexCount+c.groundVertexArrayOffset;if(c.groundVertexCount===0)return;const v=c.flags&Zg?1:0;for(let S=c.groundVertexArrayOffset;S<f;++S)this.hiddenByLandmarkVertexArray.emplace(S,v);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(c){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=c.createVertexBuffer(this.hiddenByLandmarkVertexArray,iue.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let c=0;c<=4;c++){const f=this.regionSegments[c];f&&f.destroy()}}}}class AM{constructor(c){this.zoom=c.zoom,this.canonical=c.canonical,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(f=>f.fqid),this.index=c.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=c.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new bo,this.footprintVertices=new lc,this.footprintSegments=[],this.layoutVertexArray=new Ks,this.centroidVertexArray=new eh,this.wallVertexArray=new tm,this.indexArray=new bo,this.programConfigurations=new rr(c.layers,{zoom:c.zoom,lut:c.lut},f=>lue.includes(f)),this.segments=new xs,this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id),this.groundEffect=new K9(c),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(c,f){}populate(c,f,v,S){this.features=[],this.hasPattern=h3("fill-extrusion",this.layers,f),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=rt(v),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:x,id:A,index:D,sourceLayerIndex:U}of c){const H=this.layers[0]._featureFilter.needGeometry,R=pn(x,H);if(!this.layers[0]._featureFilter.filter(new hs(this.zoom),R,v))continue;const N={id:A,sourceLayerIndex:U,index:D,geometry:H?R.geometry:fn(x,v,S),properties:x.properties,type:x.type,patterns:{}},G=this.layoutVertexArray.length,z=b3[N.type]==="Polygon";if(this.hasPattern)this.features.push(f3("fill-extrusion",this.layers,N,this.zoom,f));else if(this.wallMode)for(const V of N.geometry)for(const X of W9(V,z))this.addFeature(N,[X],D,v,{},f.availableImages,S,f.brightness);else this.addFeature(N,N.geometry,D,v,{},f.availableImages,S,f.brightness);f.featureIndex.insert(x,N.geometry,D,U,this.index,G)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(c,f,v,S,x,A){for(const D of this.features){const U=b3[D.type]==="Polygon",{geometry:H}=D;if(this.wallMode)for(const R of H)for(const N of W9(R,U))this.addFeature(D,[N],D.index,f,v,S,x,A);else this.addFeature(D,H,D.index,f,v,S,x,A)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(c,f,v,S,x){const A=Object.keys(c).length!==0;if(A&&!this.stateDependentLayers.length)return;const D=A?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(c,f,D,v,S,x),this.groundEffect.update(c,f,D,v,S,x)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,oue),this.indexBuffer=c.createIndexBuffer(this.indexArray),this.wallVertexBuffer=c.createVertexBuffer(this.wallVertexArray,rue.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=c.createVertexBuffer(this.layoutVertexExtArray,sue.members,!0)),this.groundEffect.upload(c)),this.groundEffect.uploadPaintProperties(c),this.programConfigurations.upload(c),this.uploaded=!0}uploadCentroid(c){this.groundEffect.uploadHiddenByLandmark(c),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=c.createVertexBuffer(this.centroidVertexArray,nue.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(c,f,v,S,x,A,D,U){const H=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(c,{})/this.tileToMeter,R=[new St(0,0),new St(yn,yn)],N=D.projection,G=N.name==="globe",z=this.wallMode||b3[c.type]==="Polygon",V=new Z9;V.centroidDataIndex=this.centroidData.length;const X=new q9,K=this.layers[0].paint.get("fill-extrusion-base").evaluate(c,{},S)<=0,ee=this.layers[0].paint.get("fill-extrusion-height").evaluate(c,{},S);let ce;if(X.height=ee,X.vertexArrayOffset=this.layoutVertexArray.length,X.groundVertexArrayOffset=this.groundEffect.vertexArray.length,G&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Ed),this.wallMode){if(G)return void Lt("Non zero fill-extrusion-line-width is not yet supported on globe.");if(f.length!==1)return;ce=function(Ie){const Ye=Ie[0].x===Ie[Ie.length-1].x&&Ie[0].y===Ie[Ie.length-1].y;(function(dn){let tn=0;const nr=dn.length;for(let In=0;In<nr;In++)tn+=(dn[(In+1)%nr].x-dn[In].x)*(dn[(In+1)%nr].y+dn[In].y);return tn>=0})(Ie)||(Ie=Ie.reverse());const Qe={geometry:[],joinNormals:[],indices:[]},lt=[],ut=[],ht=[];let mt=Ie.length;if(mt<(Ye?3:2))return Qe;for(;mt>=2&&Ie[mt-1].equals(Ie[mt-2]);)mt--;let Et,vt,Ut,Yt,Dt,Rn=0;for(;Rn<mt-1&&Ie[Rn].equals(Ie[Rn+1]);)Rn++;Ye&&(Et=Ie[mt-2],Dt=Ie[Rn].sub(Et)._unit()._perp());for(let dn=Rn;dn<mt;dn++){if(Ut=dn===mt-1?Ye?Ie[Rn+1]:void 0:Ie[dn+1],Ut&&Ie[dn].equals(Ut))continue;Dt&&(Yt=Dt),Et&&(vt=Et),Et=Ie[dn],Dt=Ut?Ut.sub(Et)._unit()._perp():Yt,Yt=Yt||Dt;let tn=Yt.add(Dt);tn.x===0&&tn.y===0||tn._unit();const nr=tn.x*Dt.x+tn.y*Dt.y,In=nr!==0?1/nr:1/0,Nn=Yt.x*Dt.y-Yt.y*Dt.x>0;let wr="miter";const Or=2;wr==="miter"&&In>Or&&(wr="bevel"),wr==="bevel"&&(In>100&&(wr="flipbevel"),In<Or&&(wr="miter"));const Pr=(Lr,jr,Wr,zi)=>{const Ai=new St(Lr.x,Lr.y),Tr=new St(Lr.x,Lr.y);Ai.x+=jr.x*zi,Ai.y+=jr.y*zi,Tr.x-=jr.x*Math.max(Wr,1),Tr.y-=jr.y*Math.max(Wr,1),ht.push(jr),lt.push(Ai),ut.push(Tr)};if(wr==="miter")tn._mult(In),Pr(Et,tn,0,0);else if(wr==="flipbevel")tn=Dt.mult(-1),Pr(Et,tn,0,0),Pr(Et,tn.mult(-1),0,0);else{const Lr=-Math.sqrt(In*In-1),jr=Nn?Lr:0,Wr=Nn?0:Lr;vt&&Pr(Et,Yt,jr,Wr),Ut&&Pr(Et,Dt,jr,Wr)}}Qe.geometry=[...lt,...ut.reverse(),lt[0]],Qe.joinNormals=[...ht,...ht.reverse(),ht[ht.length-1]];const bn=Qe.geometry.length-1;for(let dn=0;dn<bn/2;dn++)if(dn+1<bn/2){let tn=dn,nr=dn+1,In=bn-1-dn,Nn=bn-2-dn;tn=tn===0?bn-1:tn-1,nr=nr===0?bn-1:nr-1,In=In===0?bn-1:In-1,Nn=Nn===0?bn-1:Nn-1,Qe.indices.push(In),Qe.indices.push(nr),Qe.indices.push(tn),Qe.indices.push(In),Qe.indices.push(Nn),Qe.indices.push(nr)}return Qe}(f[0]),f=[ce.geometry]}const he=(Ie,Ye)=>Ie<(Ye.length-1)/2||Ie===Ye.length-1,ne=this.wallMode?[f]:_M(f,500);for(let Ie=ne.length-1;Ie>=0;Ie--){const Ye=ne[Ie];(Ye.length===0||(de=Ye[0]).every(ze=>ze.x<=0)||de.every(ze=>ze.x>=yn)||de.every(ze=>ze.y<=0)||de.every(ze=>ze.y>=yn))&&ne.splice(Ie,1)}var de;let ge;if(G)ge=i7(ne,R,S);else{ge=[];for(const Ie of ne)ge.push({polygon:Ie,bounds:R})}const Me=z?this.edgeRadius:0,Be=Me>0&&this.zoom<17,Oe=(Ie,Ye)=>{if(Ie.length===0)return!1;const ze=Ie[Ie.length-1];return Ye.x===ze.x&&Ye.y===ze.y};for(const{polygon:Ie,bounds:Ye}of ge){let ze=0,Qe=0;for(const mt of Ie)z&&!mt[0].equals(mt[mt.length-1])&&mt.push(mt[0]),Qe+=z?mt.length-1:mt.length;const lt=this.segments.prepareSegment((z?5:4)*Qe,this.layoutVertexArray,this.indexArray);X.footprintSegIdx<0&&(X.footprintSegIdx=this.footprintSegments.length),X.polygonSegIdx<0&&(X.polygonSegIdx=this.polygonSegments.length);const ut={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},ht=new $9;if(ht.vertexOffset=this.footprintVertices.length,ht.indexOffset=3*this.footprintIndices.length,ht.ringIndices=[],z){const mt=[],Et=[];ze=lt.vertexLength;for(let Ut=0;Ut<Ie.length;Ut++){const Yt=Ie[Ut];Yt.length&&Ut!==0&&Et.push(mt.length/2);const Dt=[];let Rn,bn;Rn=Yt[1].sub(Yt[0])._perp()._unit(),ht.ringIndices.push(Yt.length-1);for(let dn=1;dn<Yt.length;dn++){const tn=Yt[dn],nr=Yt[dn===Yt.length-1?1:dn+1],In=tn.clone();if(Me){bn=nr.sub(tn)._perp()._unit();const Nn=Rn.add(bn)._unit(),wr=Me*Math.min(4,1/(Rn.x*Nn.x+Rn.y*Nn.y));In.x+=wr*Nn.x,In.y+=wr*Nn.y,In.x=Math.round(In.x),In.y=Math.round(In.y),Rn=bn}if(!K||Me!==0&&!Be||Oe(Dt,In)||Dt.push(In),Ow(this.layoutVertexArray,In.x,In.y,0,0,1,1,0),this.wallMode){const Nn=he(dn,Yt);Fw(this.wallVertexArray,ce.joinNormals[dn],!Nn)}lt.vertexLength++,this.footprintVertices.emplaceBack(tn.x,tn.y),mt.push(tn.x,tn.y),G&&Nw(this.layoutVertexExtArray,N.projectTilePoint(In.x,In.y,S),N.upVector(S,In.x,In.y))}K&&(Me===0||Be)&&(Dt.length!==0&&Oe(Dt,Dt[0])&&Dt.pop(),this.groundEffect.addData(Dt,Ye,H))}const vt=this.wallMode?ce.indices:Lw(mt,Et);for(let Ut=0;Ut<vt.length;Ut+=3)this.footprintIndices.emplaceBack(ht.vertexOffset+vt[Ut+0],ht.vertexOffset+vt[Ut+1],ht.vertexOffset+vt[Ut+2]),this.indexArray.emplaceBack(ze+vt[Ut],ze+vt[Ut+2],ze+vt[Ut+1]),lt.primitiveLength++;ht.indexCount+=vt.length,ht.vertexCount+=this.footprintVertices.length-ht.vertexOffset}for(let mt=0;mt<Ie.length;mt++){const Et=Ie[mt];V.startRing(X,Et[0]);let vt=Et.length>4&&t7(Et[Et.length-2],Et[0],Et[1]),Ut=Me?pue(Et[Et.length-2],Et[0],Et[1],Me):0;const Yt=[];let Dt,Rn,bn;Rn=Et[1].sub(Et[0])._perp()._unit();let dn=!0;for(let tn=1,nr=0;tn<Et.length;tn++){let In=Et[tn-1],Nn=Et[tn];const wr=Et[tn===Et.length-1?1:tn+1];if(V.appendEdge(X,Nn,In),w3(Nn,In,Ye)){Me&&(Rn=wr.sub(Nn)._perp()._unit(),dn=!dn);continue}const Or=Nn.sub(In)._perp(),Pr=Or.x/(Math.abs(Or.x)+Math.abs(Or.y)),Lr=Or.y>0?1:0,jr=In.dist(Nn);if(nr+jr>32768&&(nr=0),Me){bn=wr.sub(Nn)._perp()._unit();let Tr=Q9(In,Nn,wr,J9(Rn,bn),Me);isNaN(Tr)&&(Tr=0);const gi=Nn.sub(In)._unit();In=In.add(gi.mult(Ut))._round(),Nn=Nn.add(gi.mult(-Tr))._round(),Ut=Tr,Rn=bn,K&&this.zoom>=17&&(Oe(Yt,In)||Yt.push(In),Oe(Yt,Nn)||Yt.push(Nn))}const Wr=lt.vertexLength,zi=Et.length>4&&t7(In,Nn,wr);let Ai=n7(nr,vt,dn);if(Ow(this.layoutVertexArray,In.x,In.y,Pr,Lr,0,0,Ai),Ow(this.layoutVertexArray,In.x,In.y,Pr,Lr,0,1,Ai),this.wallMode){const Tr=he(tn-1,Et),gi=ce.joinNormals[tn-1];Fw(this.wallVertexArray,gi,Tr),Fw(this.wallVertexArray,gi,Tr)}if(nr+=jr,Ai=n7(nr,zi,!dn),vt=zi,Ow(this.layoutVertexArray,Nn.x,Nn.y,Pr,Lr,0,0,Ai),Ow(this.layoutVertexArray,Nn.x,Nn.y,Pr,Lr,0,1,Ai),this.wallMode){const Tr=he(tn,Et),gi=ce.joinNormals[tn];Fw(this.wallVertexArray,gi,Tr),Fw(this.wallVertexArray,gi,Tr)}if(lt.vertexLength+=4,this.indexArray.emplaceBack(Wr+0,Wr+1,Wr+2),this.indexArray.emplaceBack(Wr+1,Wr+3,Wr+2),lt.primitiveLength+=2,Me){const Tr=ze+(tn===1?Et.length-2:tn-2),gi=tn===1?ze:Tr+1;if(this.indexArray.emplaceBack(Wr+1,Tr,Wr+3),this.indexArray.emplaceBack(Tr,gi,Wr+3),lt.primitiveLength+=2,Dt===void 0&&(Dt=Wr),!w3(wr,Et[tn],Ye)){const xi=tn===Et.length-1?Dt:lt.vertexLength;this.indexArray.emplaceBack(Wr+2,Wr+3,xi),this.indexArray.emplaceBack(Wr+3,xi+1,xi),this.indexArray.emplaceBack(Wr+3,gi,xi+1),lt.primitiveLength+=3}dn=!dn}if(G){const Tr=this.layoutVertexExtArray,gi=N.projectTilePoint(In.x,In.y,S),xi=N.projectTilePoint(Nn.x,Nn.y,S),rs=N.upVector(S,In.x,In.y),Hs=N.upVector(S,Nn.x,Nn.y);Nw(Tr,gi,rs),Nw(Tr,gi,rs),Nw(Tr,xi,Hs),Nw(Tr,xi,Hs)}}z&&(ze+=Et.length-1),K&&Me&&this.zoom>=17&&(Yt.length!==0&&Oe(Yt,Yt[0])&&Yt.pop(),this.groundEffect.addData(Yt,Ye,H,Me>0))}this.footprintSegments.push(ht),ut.triangleCount=this.indexArray.length-ut.triangleArrayOffset,this.polygonSegments.push(ut),++X.footprintSegLen,++X.polygonSegLen}if(X.vertexCount=this.layoutVertexArray.length-X.vertexArrayOffset,X.groundVertexCount=this.groundEffect.vertexArray.length-X.groundVertexArrayOffset,X.vertexCount!==0){if(X.centroidXY=V.borders?X9:this.encodeCentroid(V,X),this.centroidData.push(X),V.borders){this.featuresOnBorder.push(V);const Ie=this.featuresOnBorder.length-1;for(let Ye=0;Ye<V.borders.length;Ye++)V.borders[Ye][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Ye].push(Ie)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,v,x,A,S,U),this.groundEffect.addPaintPropertiesData(c,v,x,A,S,U),this.maxHeight=Math.max(this.maxHeight,ee)}}sortBorders(){for(let c=0;c<this.borderFeatureIndices.length;c++)this.borderFeatureIndices[c].sort((f,v)=>this.featuresOnBorder[f].borders[c][0]-this.featuresOnBorder[v].borders[c][0])}splitToSubtiles(){const c=[];for(let D=0;D<this.centroidData.length;D++){const U=this.centroidData[D],H=+(U.min.y+U.max.y>yn),R=2*H+(+(U.min.x+U.max.x>yn)^H);for(let N=0;N<U.polygonSegLen;N++){const G=U.polygonSegIdx+N;c.push({centroidIdx:D,subtile:R,polygonSegmentIdx:G,triangleSegmentIdx:this.polygonSegments[G].triangleSegIdx})}}const f=new bo;c.sort((D,U)=>D.triangleSegmentIdx===U.triangleSegmentIdx?D.subtile-U.subtile:D.triangleSegmentIdx-U.triangleSegmentIdx);let v=0,S=0,x=0;for(const D of c){if(D.triangleSegmentIdx!==v)break;x++}const A=c.length;for(;S!==c.length;){v=c[S].triangleSegmentIdx;let D=0,U=S,H=S;for(let R=U;R<x&&c[R].subtile===D;R++)H++;for(;U!==x;){const R=c[U];D=R.subtile;const N=this.centroidData[R.centroidIdx].min.clone(),G=this.centroidData[R.centroidIdx].max.clone(),z={vertexOffset:this.segments.segments[v].vertexOffset,primitiveOffset:f.length,vertexLength:this.segments.segments[v].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let V=U;V<H;V++){const X=c[V],K=this.polygonSegments[X.polygonSegmentIdx],ee=this.centroidData[X.centroidIdx].min,ce=this.centroidData[X.centroidIdx].max,he=this.indexArray.uint16;for(let ne=K.triangleArrayOffset;ne<K.triangleArrayOffset+K.triangleCount;ne++)f.emplaceBack(he[3*ne],he[3*ne+1],he[3*ne+2]);z.primitiveLength+=K.triangleCount,N.x=Math.min(N.x,ee.x),N.y=Math.min(N.y,ee.y),G.x=Math.max(G.x,ce.x),G.y=Math.max(G.y,ce.y)}z.primitiveLength>0&&this.triangleSubSegments.push({segment:z,min:N,max:G}),U=H;for(let V=U;V<x&&c[V].subtile===c[U].subtile;V++)H++}S=x;for(let R=S;R<A&&c[R].triangleSegmentIdx===c[S].triangleSegmentIdx;R++)x++}f._trim(),this.indexArray=f}getVisibleSegments(c,f,v){const S=new xs;if(this.wallMode){for(const X of this.triangleSubSegments)S.segments.push(X.segment);return S}let x=0,A=0;const D=1<<c.canonical.z;if(f){const X=f.getMinMaxForTile(c);X&&(x=X.min,A=X.max)}A+=this.maxHeight;const U=c.toUnwrapped();let H;const R=[U.canonical.x/D+U.wrap,U.canonical.y/D],N=[(U.canonical.x+1)/D+U.wrap,(U.canonical.y+1)/D],G=(X,K,ee)=>[X[0]*(1-ee[0])+K[0]*ee[0],X[1]*(1-ee[1])+K[1]*ee[1]],z=[],V=[];for(const X of this.triangleSubSegments){z[0]=X.min.x/yn,z[1]=X.min.y/yn,V[0]=X.max.x/yn,V[1]=X.max.y/yn;const K=G(R,N,z),ee=G(R,N,V);if(new Yi([K[0],K[1],x],[ee[0],ee[1],A]).intersectsPrecise(v)===0){H&&(S.segments.push(H),H=void 0);continue}const ce=X.segment;H&&H.vertexOffset!==ce.vertexOffset&&(S.segments.push(H),H=void 0),H?(H.vertexLength+=ce.vertexLength,H.primitiveLength+=ce.primitiveLength):H={vertexOffset:ce.vertexOffset,primitiveLength:ce.primitiveLength,vertexLength:ce.vertexLength,primitiveOffset:ce.primitiveOffset,sortKey:void 0,vaos:{}}}return H&&S.segments.push(H),S}encodeCentroid(c,f){const v=c.centroid(),S=f.span(),x=Math.min(7,Math.round(S.x*this.tileToMeter/10)),A=Math.min(7,Math.round(S.y*this.tileToMeter/10));return new St(jt(v.x,1,yn-1)<<3|x,jt(v.y,1,yn-1)<<3|A)}encodeBorderCentroid(c){if(!c.borders)return new St(0,0);const f=c.borders,v=Number.MAX_VALUE;if(f[0][0]!==v||f[1][0]!==v){const S=f[0][0]!==v?0:1;return new St(6|(f[0][0]!==v?0:65528),(f[S][0]+f[S][1])/2<<3|6)}{const S=f[2][0]!==v?2:3;return new St((f[S][0]+f[S][1])/2<<3|6,6|(f[2][0]!==v?0:65528))}}showCentroid(c){const f=this.centroidData[c.centroidDataIndex];f.flags&=Zg,f.centroidXY.x=0,f.centroidXY.y=0,this.writeCentroidToBuffer(f)}writeCentroidToBuffer(c){this.groundEffect.updateHiddenByLandmark(c);const f=c.vertexArrayOffset,v=c.vertexCount+c.vertexArrayOffset,S=c.flags&Zg?X9:c.centroidXY,x=this.centroidVertexArray.geta_centroid_pos0(f);if(this.centroidVertexArray.geta_centroid_pos1(f)!==S.y||x!==S.x){for(let A=f;A<v;++A)this.centroidVertexArray.emplace(A,S.x,S.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const c of this.centroidData)this.writeCentroidToBuffer(c)}updateReplacement(c,f,v){if(f.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=f.updateTime;const S=f.getReplacementRegionsForTile(c.toUnwrapped());if(y3(this.activeReplacements,S))return;if(this.activeReplacements=S,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const A of this.centroidData)A.flags&=2147483647;const x=[];for(const A of this.activeReplacements){if(A.order<v)continue;const D=Math.pow(2,A.footprintTileId.canonical.z-c.canonical.z);for(const U of this.centroidData)if(!(U.flags&Zg||A.min.x>U.max.x||U.min.x>A.max.x||A.min.y>U.max.y||U.min.y>A.max.y))for(let H=0;H<U.footprintSegLen;H++){const R=this.footprintSegments[U.footprintSegIdx+H];if(x.length=0,mue(this.footprintVertices,R.vertexOffset,R.vertexCount,A.footprintTileId.canonical,c.canonical,x),V9(A.footprint,x,this.footprintIndices.uint16,R.indexOffset,R.indexCount,-R.vertexOffset,-D)){U.flags|=Zg;break}}}for(const A of this.centroidData)this.writeCentroidToBuffer(A);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(c,f,v){let S=!1;for(let x=0;x<v.footprintSegLen;x++){const A=this.footprintSegments[v.footprintSegIdx+x];let D=0;for(const U of A.ringIndices){for(let H=D,R=U+D-1;H<U+D;R=H++){const N=this.footprintVertices.int16[2*(H+A.vertexOffset)+0],G=this.footprintVertices.int16[2*(H+A.vertexOffset)+1],z=this.footprintVertices.int16[2*(R+A.vertexOffset)+1];G>f!=z>f&&c<(this.footprintVertices.int16[2*(R+A.vertexOffset)+0]-N)*(f-G)/(z-G)+N&&(S=!S)}D=U}}return S}getHeightAtTileCoord(c,f){let v=Number.NEGATIVE_INFINITY,S=!0;const x=4*(c+yn)*yn+(f+yn);if(this.partLookup.hasOwnProperty(x)){const A=this.partLookup[x];return A?{height:A.height,hidden:!!(A.flags&Zg)}:void 0}for(const A of this.centroidData)c>A.max.x||A.min.x>c||f>A.max.y||A.min.y>f||this.footprintContainsPoint(c,f,A)&&A&&A.height>v&&(v=A.height,this.partLookup[x]=A,S=!!(A.flags&Zg));if(v!==Number.NEGATIVE_INFINITY)return{height:v,hidden:S};this.partLookup[x]=void 0}}function J9(g,c){const f=g.add(c)._unit();return g.x*f.x+g.y*f.y}function pue(g,c,f,v){const S=c.sub(g)._perp()._unit(),x=f.sub(c)._perp()._unit();return Q9(g,c,f,J9(S,x),v)}function Q9(g,c,f,v,S){const x=Math.sqrt(1-v*v);return Math.min(g.dist(c)/3,c.dist(f)/3,S*x/v)}function w3(g,c,f){return g.x<f[0].x&&c.x<f[0].x||g.x>f[1].x&&c.x>f[1].x||g.y<f[0].y&&c.y<f[0].y||g.y>f[1].y&&c.y>f[1].y}function e7(g,c){return g.x<c[0].x||g.x>c[1].x||g.y<c[0].y||g.y>c[1].y}function t7(g,c,f){if(g.x<0||g.x>=yn||c.x<0||c.x>=yn||f.x<0||f.x>=yn)return!1;const v=f.sub(c),S=v.perp(),x=g.sub(c);return(v.x*x.x+v.y*x.y)/Math.sqrt((v.x*v.x+v.y*v.y)*(x.x*x.x+x.y*x.y))>-.866&&S.x*x.x+S.y*x.y<0}function n7(g,c,f){const v=c?2|g:-3&g;return f?1|v:-2&v}function r7(){const g=Math.PI/32,c=Math.tan(g),f=oe;return f*Math.sqrt(1+2*c*c)-f}function i7(g,c,f){const v=1<<f.z,S=je(f.x/v),x=je((f.x+1)/v),A=Ge(f.y/v),D=Ge((f.y+1)/v);return function(U,H,R,N,G=0,z){const V=[];if(!U.length||!R||!N)return V;const X=(ge,Me)=>{for(const Be of ge)V.push({polygon:Be,bounds:Me})},K=Math.ceil(Math.log2(R)),ee=Math.ceil(Math.log2(N)),ce=K-ee,he=[];for(let ge=0;ge<Math.abs(ce);ge++)he.push(ce>0?0:1);for(let ge=0;ge<Math.min(K,ee);ge++)he.push(0),he.push(1);let ne=U;if(ne=xM(ne,H[0].y-G,H[1].y+G,1),ne=xM(ne,H[0].x-G,H[1].x+G,0),!ne.length)return V;const de=[];for(he.length?de.push({polygons:ne,bounds:H,depth:0}):X(ne,H);de.length;){const ge=de.pop(),Me=ge.depth,Be=he[Me],Oe=ge.bounds[0],Ie=ge.bounds[1],Ye=Be===0?Oe.x:Oe.y,ze=Be===0?Ie.x:Ie.y,Qe=z?z(Be,Ye,ze):.5*(Ye+ze),lt=xM(ge.polygons,Ye-G,Qe+G,Be),ut=xM(ge.polygons,Qe-G,ze+G,Be);if(lt.length){const ht=[Oe,new St(Be===0?Qe:Ie.x,Be===1?Qe:Ie.y)];he.length>Me+1?de.push({polygons:lt,bounds:ht,depth:Me+1}):X(lt,ht)}if(ut.length){const ht=[new St(Be===0?Qe:Oe.x,Be===1?Qe:Oe.y),Ie];he.length>Me+1?de.push({polygons:ut,bounds:ht,depth:Me+1}):X(ut,ht)}}return V}(g,c,Math.ceil((x-S)/11.25),Math.ceil((A-D)/11.25),1,(U,H,R)=>{if(U===0)return .5*(H+R);{const N=Ge((f.y+H/yn)/v);return(Ne(.5*(Ge((f.y+R/yn)/v)+N))*v-f.y)*yn}})}function mue(g,c,f,v,S,x){const A=Math.pow(2,v.z-S.z);for(let D=0;D<f;D++){let U=g.int16[2*(D+c)+0],H=g.int16[2*(D+c)+1];U=(U+S.x*yn)*A-v.x*yn,H=(H+S.y*yn)*A-v.y*yn,x.push(new St(U,H))}}let s7,o7;function zw(g,c){return g.x*c.x+g.y*c.y}function a7(g,c){if(g.length===1){let f=0;const v=c[f++];let S;for(;!S||v.equals(S);)if(S=c[f++],!S)return 1/0;for(;f<c.length;f++){const x=c[f],A=g[0],D=S.sub(v),U=x.sub(v),H=A.sub(v),R=zw(D,D),N=zw(D,U),G=zw(U,U),z=zw(H,D),V=zw(H,U),X=R*G-N*N,K=(G*z-N*V)/X,ee=(R*V-N*z)/X,ce=v.z*(1-K-ee)+S.z*K+x.z*ee;if(isFinite(ce))return ce}return 1/0}{let f=1/0;for(const v of c)f=Math.min(f,v.z);return f}}function l7(g,c,f,v,S,x,A,D){const U=A*S.getElevationAt(g,c,!0,!0),H=x[0]!==0,R=H?x[1]===0?A*(x[0]/7-450):A*function(N,G,z){const V=Math.floor(G[0]/8),X=Math.floor(G[1]/8),K=10*(G[0]-8*V),ee=10*(G[1]-8*X),ce=N.getElevationAt(V,X,!0,!0),he=N.getMeterToDEM(z),ne=Math.floor(.5*(K*he-1)),de=Math.floor(.5*(ee*he-1)),ge=N.tileCoordToPixel(V,X),Me=2*ne+1,Be=2*de+1,Oe=function(ut,ht,mt,Et,vt){return[ut.getElevationAtPixel(ht,mt,!0),ut.getElevationAtPixel(ht+vt,mt,!0),ut.getElevationAtPixel(ht,mt+vt,!0),ut.getElevationAtPixel(ht+Et,mt+vt,!0)]}(N,ge.x-ne,ge.y-de,Me,Be),Ie=Math.abs(Oe[0]-Oe[1]),Ye=Math.abs(Oe[2]-Oe[3]),ze=Math.abs(Oe[0]-Oe[2])+Math.abs(Oe[1]-Oe[3]),Qe=Math.min(.25,.5*he*(Ie+Ye)/Me),lt=Math.min(.25,.5*he*ze/Be);return ce+Math.max(Qe*K,lt*ee)}(S,x,D):U;return{base:U+(f===0)?-1:f,top:H?Math.max(R+v,U+f+2):U+v}}Fn(AM,"FillExtrusionBucket",{omit:["layers","features"]}),Fn(q9,"PartData"),Fn($9,"FootprintSegment"),Fn(Z9,"BorderCentroidData"),Fn(K9,"GroundEffect");const gue=Qr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),vue=Qr([{name:"a_z_offset",components:1,type:"Float32"}],4),{members:_ue}=gue,yue=Qr([{name:"a_packed",components:4,type:"Float32"}]),{members:xue}=yue,bue=Qr([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:wue}=bue;class c7{constructor(c,f){this.width=c,this.height=f,this.nextRow=0,this.image=new qg({width:c,height:f}),this.positions={},this.uploaded=!1}getDash(c,f){const v=this.getKey(c,f);return this.positions[v]}trim(){const c=this.width,f=this.height=ci(this.nextRow);this.image.resize({width:c,height:f})}getKey(c,f){return c.join(",")+f}getDashRanges(c,f,v){const S=[];let x=c.length%2==1?-c[c.length-1]*v:0,A=c[0]*v,D=!0;S.push({left:x,right:A,isDash:D,zeroLength:c[0]===0});let U=c[0];for(let H=1;H<c.length;H++){D=!D;const R=c[H];x=U*v,U+=R,A=U*v,S.push({left:x,right:A,isDash:D,zeroLength:R===0})}return S}addRoundDash(c,f,v){const S=f/2;for(let x=-v;x<=v;x++){const A=this.width*(this.nextRow+v+x);let D=0,U=c[D];for(let H=0;H<this.width;H++){H/U.right>1&&(U=c[++D]);const R=Math.abs(H-U.left),N=Math.abs(H-U.right),G=Math.min(R,N);let z;const V=x/v*(S+1);if(U.isDash){const X=S-Math.abs(V);z=Math.sqrt(G*G+X*X)}else z=S-Math.sqrt(G*G+V*V);this.image.data[A+H]=Math.max(0,Math.min(255,z+128))}}}addRegularDash(c,f){for(let U=c.length-1;U>=0;--U){const H=c[U],R=c[U+1];H.zeroLength?c.splice(U,1):R&&R.isDash===H.isDash&&(R.left=H.left,c.splice(U,1))}const v=c[0],S=c[c.length-1];v.isDash===S.isDash&&(v.left=S.left-this.width,S.right=v.right+this.width);const x=this.width*this.nextRow;let A=0,D=c[A];for(let U=0;U<this.width;U++){U/D.right>1&&(D=c[++A]);const H=Math.abs(U-D.left),R=Math.abs(U-D.right),N=Math.min(H,R);this.image.data[x+U]=Math.max(0,Math.min(255,(D.isDash?N:-N)+f+128))}}addDash(c,f){const v=this.getKey(c,f);if(this.positions[v])return this.positions[v];const S=f==="round",x=S?7:0,A=2*x+1;if(this.nextRow+A>this.height)return Lt("LineAtlas out of space"),null;c.length===0&&c.push(1);let D=0;for(let R=0;R<c.length;R++)c[R]<0&&(Lt("Negative value is found in line dasharray, replacing values with 0"),c[R]=0),D+=c[R];if(D!==0){const R=this.width/D,N=this.getDashRanges(c,this.width,R);S?this.addRoundDash(N,R,x):this.addRegularDash(N,f==="square"?.5*R:0)}const U=this.nextRow+x;this.nextRow+=A;const H={tl:[U,x],br:[D,0]};return this.positions[v]=H,H}}Fn(c7,"LineAtlas");const Sue=zx.VectorTileFeature.types,Aue=Math.cos(Math.PI/180*37.5),Tue=Math.cos(Math.PI/180*5);class S3{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(f=>f.fqid),this.index=c.index,this.projection=c.projection,this.hasPattern=!1,this.hasZOffset=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(f=>{this.gradients[f.id]={}}),this.layoutVertexArray=new Ja,this.layoutVertexArray2=new Il,this.patternVertexArray=new lo,this.indexArray=new bo,this.programConfigurations=new rr(c.layers,{zoom:c.zoom,lut:c.lut}),this.segments=new xs,this.maxLineLength=0,this.zOffsetVertexArray=new Rd,this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id),this.tessellationStep=c.tessellationStep?c.tessellationStep:yn/64}updateFootprints(c,f){}populate(c,f,v,S){this.hasPattern=h3("line",this.layers,f);const x=this.layers[0].layout.get("line-sort-key"),A=this.layers[0].layout.get("line-z-offset");this.hasZOffset=!A.isConstant()||!!A.constantOr(0);const D=[];for(const{feature:N,id:G,index:z,sourceLayerIndex:V}of c){const X=this.layers[0]._featureFilter.needGeometry,K=pn(N,X);if(!this.layers[0]._featureFilter.filter(new hs(this.zoom),K,v))continue;const ee=x?x.evaluate(K,{},v):void 0,ce={id:G,properties:N.properties,type:N.type,sourceLayerIndex:V,index:z,geometry:X?K.geometry:fn(N,v,S),patterns:{},sortKey:ee};D.push(ce)}x&&D.sort((N,G)=>N.sortKey-G.sortKey);const{lineAtlas:U,featureIndex:H}=f,R=this.addConstantDashes(U);for(const N of D){const{geometry:G,index:z,sourceLayerIndex:V}=N;if(R&&this.addFeatureDashes(N,U),this.hasPattern){const X=f3("line",this.layers,N,this.zoom,f);this.patternFeatures.push(X)}else this.addFeature(N,G,z,v,U.positions,f.availableImages,f.brightness);H.insert(c[z].feature,G,z,V,this.index)}}addConstantDashes(c){let f=!1;for(const v of this.layers){const S=v.paint.get("line-dasharray").value,x=v.layout.get("line-cap").value;if(S.kind!=="constant"||x.kind!=="constant")f=!0;else{const A=x.value,D=S.value;if(!D)continue;c.addDash(D,A)}}return f}addFeatureDashes(c,f){const v=this.zoom;for(const S of this.layers){const x=S.paint.get("line-dasharray").value,A=S.layout.get("line-cap").value;if(x.kind==="constant"&&A.kind==="constant")continue;let D,U;if(x.kind==="constant"){if(D=x.value,!D)continue}else D=x.evaluate({zoom:v},c);U=A.kind==="constant"?A.value:A.evaluate({zoom:v},c),f.addDash(D,U),c.patterns[S.id]=f.getKey(D,U)}}update(c,f,v,S,x){const A=Object.keys(c).length!==0;A&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(c,f,A?this.stateDependentLayers:this.layers,v,S,x)}addFeatures(c,f,v,S,x,A){for(const D of this.patternFeatures)this.addFeature(D,D.geometry,D.index,f,v,S,A)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=c.createVertexBuffer(this.layoutVertexArray2,xue)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=c.createVertexBuffer(this.patternVertexArray,wue)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=c.createVertexBuffer(this.zOffsetVertexArray,vue.members,!0)),this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,_ue),this.indexBuffer=c.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(c){if(c.properties&&c.properties.hasOwnProperty("mapbox_clip_start")&&c.properties.hasOwnProperty("mapbox_clip_end"))return{start:+c.properties.mapbox_clip_start,end:+c.properties.mapbox_clip_end}}addFeature(c,f,v,S,x,A,D){const U=this.layers[0].layout,H=U.get("line-join").evaluate(c,{}),R=U.get("line-cap").evaluate(c,{}),N=U.get("line-miter-limit"),G=U.get("line-round-limit");this.lineClips=this.lineFeatureClips(c);for(const z of f)this.addLine(z,c,S,H,R,N,G);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,v,x,A,S,D)}addLine(c,f,v,S,x,A,D){this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.currentVertex=void 0;const U={zoom:this.zoom,lineProgress:void 0},H=this.layers[0].layout,R=S==="none";if(this.patternJoinNone=this.hasPattern&&R,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ge=0;ge<c.length-1;ge++)this.totalDistance+=c[ge].dist(c[ge+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const N=Sue[f.type]==="Polygon";let G=c.length;for(;G>=2&&c[G-1].equals(c[G-2]);)G--;let z=0;for(;z<G-1&&c[z].equals(c[z+1]);)z++;if(G<(N?3:2))return;S==="bevel"&&(A=1.05);const V=this.overscaling<=16?15*yn/(512*this.overscaling):0,X=this.segments.prepareSegment(10*G,this.layoutVertexArray,this.indexArray);let K,ee,ce,he,ne,de;this.e1=this.e2=-1,N&&(K=c[G-2],ne=c[z].sub(K)._unit()._perp());for(let ge=z;ge<G;ge++){if(ce=ge===G-1?N?c[z+1]:void 0:c[ge+1],ce&&c[ge].equals(ce))continue;if(ne&&(he=ne),K&&(ee=K),K=c[ge],this.hasZOffset){const ht=H.get("line-z-offset").value;if(ht.kind==="constant")de=ht.value;else{if(this.lineClips){const mt=this.totalDistance/(this.lineClips.end-this.lineClips.start);U.lineProgress=(mt*this.lineClips.start+this.distance+(ee?ee.dist(K):0))/mt}else Lt(`line-z-offset evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`),U.lineProgress=0;de=ht.evaluate(U,f)}de=de||0}ne=ce?ce.sub(K)._unit()._perp():he,he=he||ne;const Me=ee&&ce;let Be=Me?S:N||R?"butt":x;const Oe=he.x*ne.x+he.y*ne.y;if(R){const ht=function(mt){if(mt.patternJoinNone){const Et=mt.segmentPoints.length/2,vt=mt.lineSoFar-mt.segmentStart;for(let Ut=0;Ut<Et;++Ut){const Yt=mt.segmentPoints[2*Ut+1],Dt=Math.round(mt.segmentPoints[2*Ut])+.5+.25*Yt;mt.patternVertexArray.emplaceBack(Dt,vt,mt.segmentStart),mt.patternVertexArray.emplaceBack(Dt,vt,mt.segmentStart)}mt.segmentPoints.length=0}mt.e1=mt.e2=-1};if(Me&&Oe<Tue){this.updateDistance(ee,K),this.addCurrentVertex(K,he,1,1,X,de),ht(this),this.addCurrentVertex(K,ne,-1,-1,X,de);continue}if(ee){if(!ce){this.updateDistance(ee,K),this.addCurrentVertex(K,he,1,1,X,de),ht(this);continue}Be="miter"}}let Ie=he.add(ne);Ie.x===0&&Ie.y===0||Ie._unit();const Ye=Ie.x*ne.x+Ie.y*ne.y,ze=Ye!==0?1/Ye:1/0,Qe=2*Math.sqrt(2-2*Ye),lt=Ye<Aue&&ee&&ce,ut=he.x*ne.y-he.y*ne.x>0;if(lt&&ge>z){const ht=K.dist(ee);if(ht>2*V){const mt=K.sub(K.sub(ee)._mult(V/ht)._round());this.updateDistance(ee,mt),this.addCurrentVertex(mt,he,0,0,X,de),ee=mt}}if(Me&&Be==="round"&&(ze<D?Be="miter":ze<=2&&(Be="fakeround")),Be==="miter"&&ze>A&&(Be="bevel"),Be==="bevel"&&(ze>2&&(Be="flipbevel"),ze<A&&(Be="miter")),ee&&this.updateDistance(ee,K),Be==="miter")Ie._mult(ze),this.addCurrentVertex(K,Ie,0,0,X,de);else if(Be==="flipbevel"){if(ze>100)Ie=ne.mult(-1);else{const ht=ze*he.add(ne).mag()/he.sub(ne).mag();Ie._perp()._mult(ht*(ut?-1:1))}this.addCurrentVertex(K,Ie,0,0,X,de),this.addCurrentVertex(K,Ie.mult(-1),0,0,X,de)}else if(Be==="bevel"||Be==="fakeround"){const ht=-Math.sqrt(ze*ze-1),mt=ut?ht:0,Et=ut?0:ht;if(ee&&this.addCurrentVertex(K,he,mt,Et,X,de),Be==="fakeround"){const vt=Math.round(180*Qe/Math.PI/20);for(let Ut=1;Ut<vt;Ut++){let Yt=Ut/vt;if(Yt!==.5){const Rn=Yt-.5;Yt+=Yt*Rn*(Yt-1)*((1.0904+Oe*(Oe*(3.55645-1.43519*Oe)-3.2452))*Rn*Rn+(.848013+Oe*(.215638*Oe-1.06021)))}const Dt=ne.sub(he)._mult(Yt)._add(he)._unit()._mult(ut?-1:1);this.addHalfVertex(K,Dt.x,Dt.y,!1,ut,0,X,de)}}ce&&this.addCurrentVertex(K,ne,-mt,-Et,X,de)}else Be==="butt"?this.addCurrentVertex(K,Ie,0,0,X,de):Be==="square"?(ee||this.addCurrentVertex(K,Ie,-1,-1,X,de),this.addCurrentVertex(K,Ie,0,0,X,de),ee&&this.addCurrentVertex(K,Ie,1,1,X,de)):Be==="round"&&(ee&&(this.addCurrentVertex(K,he,0,0,X,de),this.addCurrentVertex(K,he,1,1,X,de,!0)),ce&&(this.addCurrentVertex(K,ne,-1,-1,X,de,!0),this.addCurrentVertex(K,ne,0,0,X,de)));if(lt&&ge<G-1){const ht=K.dist(ce);if(ht>2*V){const mt=K.add(ce.sub(K)._mult(V/ht)._round());this.updateDistance(K,mt),this.addCurrentVertex(mt,ne,0,0,X,de),K=mt}}}}addVerticesTo(c,f,v,S,x,A,D,U,H,R){const N=(f.w-c.w)/this.tessellationStep|0;if(N>1){this.lineSoFar=c.w;const G=(f.x-c.x)/N,z=(f.y-c.y)/N,V=(f.z-c.z)/N,X=(f.w-c.w)/N;for(let K=1;K<N;++K)c.x+=G,c.y+=z,c.z+=V,this.lineSoFar+=X,this.addHalfVertex(c,v,S,R,!1,D,H,c.z),this.addHalfVertex(c,x,A,R,!0,-U,H,c.z)}this.lineSoFar=f.w,this.addHalfVertex(f,v,S,R,!1,D,H,f.z),this.addHalfVertex(f,x,A,R,!0,-U,H,f.z)}addCurrentVertex(c,f,v,S,x,A,D=!1){const U=f.x+f.y*v,H=f.y-f.x*v,R=f.y*S-f.x,N=-f.y-f.x*S;if(A!=null){const z=yn+10,V=A,X=new k9(c.x,c.y,V,this.lineSoFar),K=u7(c,-10,z),ee=this.lineSoFar;if(this.currentVertex)if(K){const ce=this.currentVertexIsOutside,he=this.currentVertex,ne=new k9(c.x,c.y,V,this.lineSoFar);F9(he,ne,-10,z),u7(ne,-10,z)||(ce&&(this.e1=this.e2=-1,this.lineSoFar=he.w,this.addHalfVertex(he,U,H,D,!1,v,x,he.z),this.addHalfVertex(he,R,N,D,!0,-S,x,he.z)),this.addVerticesTo(he,ne,U,H,R,N,v,S,x,D))}else{const ce=this.currentVertex;this.currentVertexIsOutside&&(F9(ce,X,-10,z),this.e1=this.e2=-1,this.lineSoFar=ce.w,this.addHalfVertex(ce,U,H,D,!1,v,x,ce.z),this.addHalfVertex(ce,R,N,D,!0,-S,x,ce.z)),this.addVerticesTo(ce,X,U,H,R,N,v,S,x,D)}else K||(this.addHalfVertex(c,U,H,D,!1,v,x,A),this.addHalfVertex(c,R,N,D,!0,-S,x,A));this.currentVertex=X,this.currentVertexIsOutside=K,this.lineSoFar=ee}else this.addHalfVertex(c,U,H,D,!1,v,x,A),this.addHalfVertex(c,R,N,D,!0,-S,x,A)}addHalfVertex({x:c,y:f},v,S,x,A,D,U,H){this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),A||this.segmentPoints.push(this.lineSoFar-this.segmentStart,D)),this.layoutVertexArray.emplaceBack((c<<1)+(x?1:0),(f<<1)+(A?1:0),Math.round(63*v)+128,Math.round(63*S)+128,1+(D===0?0:D<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const R=U.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,R),U.primitiveLength++),A?this.e2=R:this.e1=R,H!=null&&this.zOffsetVertexArray.emplaceBack(H)}updateScaledDistance(){if(this.lineClips){const c=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=c*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(c,f){this.distance+=c.dist(f),this.updateScaledDistance()}}function u7(g,c,f){return g.x<c||g.x>f||g.y<c||g.y>f}let h7,f7;function d7(g,c,f){return c*(yn/(g.tileSize*Math.pow(2,f-g.tileID.overscaledZ)))}function p7(g,c){return 1/d7(g,1,c.tileZoom)}function m7(g,c,f,v){return g.translatePosMatrix(v||c.tileID.projMatrix,c,f.paint.get("line-translate"),f.paint.get("line-translate-anchor"))}Fn(S3,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const g7=g=>{const c=[];v7(g)&&c.push("RENDER_LINE_DASH"),g.paint.get("line-gradient")&&c.push("RENDER_LINE_GRADIENT");const f=g.paint.get("line-trim-offset");f[0]===0&&f[1]===0||c.push("RENDER_LINE_TRIM_OFFSET"),g.paint.get("line-border-width").constantOr(1)!==0&&c.push("RENDER_LINE_BORDER");const v=g.layout.get("line-join").constantOr("miter")==="none",S=!!g.paint.get("line-pattern").constantOr(1);return v&&S&&c.push("LINE_JOIN_NONE"),c};function v7(g){const c=g.paint.get("line-dasharray").value;return c.value||c.kind!=="constant"}let A3;const _7=()=>A3||(A3={layout:h7||(h7=new Hi({"line-cap":new Kn(At.layout_line["line-cap"]),"line-join":new Kn(At.layout_line["line-join"]),"line-miter-limit":new gn(At.layout_line["line-miter-limit"]),"line-round-limit":new gn(At.layout_line["line-round-limit"]),"line-sort-key":new Kn(At.layout_line["line-sort-key"]),"line-z-offset":new Kn(At.layout_line["line-z-offset"]),visibility:new gn(At.layout_line.visibility)})),paint:f7||(f7=new Hi({"line-opacity":new Kn(At.paint_line["line-opacity"]),"line-color":new Kn(At.paint_line["line-color"]),"line-translate":new gn(At.paint_line["line-translate"]),"line-translate-anchor":new gn(At.paint_line["line-translate-anchor"]),"line-width":new Kn(At.paint_line["line-width"]),"line-gap-width":new Kn(At.paint_line["line-gap-width"]),"line-offset":new Kn(At.paint_line["line-offset"]),"line-blur":new Kn(At.paint_line["line-blur"]),"line-dasharray":new Kn(At.paint_line["line-dasharray"]),"line-pattern":new Kn(At.paint_line["line-pattern"]),"line-gradient":new oc(At.paint_line["line-gradient"]),"line-trim-offset":new gn(At.paint_line["line-trim-offset"]),"line-trim-fade-range":new gn(At.paint_line["line-trim-fade-range"]),"line-trim-color":new gn(At.paint_line["line-trim-color"]),"line-emissive-strength":new gn(At.paint_line["line-emissive-strength"]),"line-border-width":new Kn(At.paint_line["line-border-width"]),"line-border-color":new Kn(At.paint_line["line-border-color"]),"line-occlusion-opacity":new gn(At.paint_line["line-occlusion-opacity"])}))},A3);class Mue extends Kn{possiblyEvaluate(c,f){return f=new hs(Math.floor(f.zoom),{now:f.now,fadeDuration:f.fadeDuration,transition:f.transition}),super.possiblyEvaluate(c,f)}evaluate(c,f,v,S){return f=Sr({},f,{zoom:Math.floor(f.zoom)}),super.evaluate(c,f,v,S)}}let Uw;function y7(g,c){return c>0?c+2*g:g}const Cue=Qr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Eue=Qr([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Iue=Qr([{name:"a_projected_pos",components:4,type:"Float32"}],4);Qr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Rue=Qr([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),Pue=Qr([{name:"a_texb",components:2,type:"Uint16"}]),Lue=Qr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),Due=Qr([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Qr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const x7=Qr([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Bue=Qr([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Qr([{name:"triangle",components:3,type:"Uint16"}]),Qr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Qr([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),Qr([{type:"Float32",name:"offsetX"}]),Qr([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Fa=24;const mf=128;function T3(g,c){const{expression:f}=c;if(f.kind==="constant")return{kind:"constant",layoutSize:f.evaluate(new hs(g+1))};if(f.kind==="source")return{kind:"source"};{const{zoomStops:v,interpolationType:S}=f;let x=0;for(;x<v.length&&v[x]<=g;)x++;x=Math.max(0,x-1);let A=x;for(;A<v.length&&v[A]<g+1;)A++;A=Math.min(v.length-1,A);const D=v[x],U=v[A];return f.kind==="composite"?{kind:"composite",minZoom:D,maxZoom:U,interpolationType:S}:{kind:"camera",minZoom:D,maxZoom:U,minSize:f.evaluate(new hs(D)),maxSize:f.evaluate(new hs(U)),interpolationType:S}}}function TM(g,{uSize:c,uSizeT:f},{lowerSize:v,upperSize:S}){return g.kind==="source"?v/mf:g.kind==="composite"?cr(v/mf,S/mf,f):c}function Ux(g,c){let f=0,v=0;if(g.kind==="constant")v=g.layoutSize;else if(g.kind!=="source"){const{interpolationType:S,minZoom:x,maxZoom:A}=g,D=S?jt(ul.interpolationFactor(S,c,x,A),0,1):0;g.kind==="camera"?v=cr(g.minSize,g.maxSize,D):f=D}return{uSizeT:f,uSize:v}}var kue=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:mf,evaluateSizeForFeature:TM,evaluateSizeForZoom:Ux,getSizeData:T3});function Oue(g,c,f){return g.sections.forEach(v=>{v.text=function(S,x,A){const D=x.layout.get("text-transform").evaluate(A,{});return D==="uppercase"?S=S.toLocaleUpperCase():D==="lowercase"&&(S=S.toLocaleLowerCase()),Oa.applyArabicShaping&&(S=Oa.applyArabicShaping(S)),S}(v.text,c,f)}),g}const Vw={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function Fue(g){return g==="︶"||g==="﹈"||g==="︸"||g==="﹄"||g==="﹂"||g==="︾"||g==="︼"||g==="︺"||g==="︘"||g==="﹀"||g==="︐"||g==="︓"||g==="︔"||g==="｀"||g==="￣"||g==="︑"||g==="︒"}function Nue(g){return g==="︵"||g==="﹇"||g==="︷"||g==="﹃"||g==="﹁"||g==="︽"||g==="︻"||g==="︹"||g==="︗"||g==="︿"}var b7,M3,w7,C3={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function zue(){return b7||(b7=1,C3.read=function(g,c,f,v,S){var x,A,D=8*S-v-1,U=(1<<D)-1,H=U>>1,R=-7,N=f?S-1:0,G=f?-1:1,z=g[c+N];for(N+=G,x=z&(1<<-R)-1,z>>=-R,R+=D;R>0;x=256*x+g[c+N],N+=G,R-=8);for(A=x&(1<<-R)-1,x>>=-R,R+=v;R>0;A=256*A+g[c+N],N+=G,R-=8);if(x===0)x=1-H;else{if(x===U)return A?NaN:1/0*(z?-1:1);A+=Math.pow(2,v),x-=H}return(z?-1:1)*A*Math.pow(2,x-v)},C3.write=function(g,c,f,v,S,x){var A,D,U,H=8*x-S-1,R=(1<<H)-1,N=R>>1,G=S===23?Math.pow(2,-24)-Math.pow(2,-77):0,z=v?0:x-1,V=v?1:-1,X=c<0||c===0&&1/c<0?1:0;for(c=Math.abs(c),isNaN(c)||c===1/0?(D=isNaN(c)?1:0,A=R):(A=Math.floor(Math.log(c)/Math.LN2),c*(U=Math.pow(2,-A))<1&&(A--,U*=2),(c+=A+N>=1?G/U:G*Math.pow(2,1-N))*U>=2&&(A++,U/=2),A+N>=R?(D=0,A=R):A+N>=1?(D=(c*U-1)*Math.pow(2,S),A+=N):(D=c*Math.pow(2,N-1)*Math.pow(2,S),A=0));S>=8;g[f+z]=255&D,z+=V,D/=256,S-=8);for(A=A<<S|D,H+=S;H>0;g[f+z]=255&A,z+=V,A/=256,H-=8);g[f+z-V]|=128*X}),C3}function S7(){if(w7)return M3;w7=1,M3=c;var g=zue();function c(ne){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(ne)?ne:new Uint8Array(ne||0),this.pos=0,this.type=0,this.length=this.buf.length}c.Varint=0,c.Fixed64=1,c.Bytes=2,c.Fixed32=5;var f=4294967296,v=1/f,S=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function x(ne){return ne.type===c.Bytes?ne.readVarint()+ne.pos:ne.pos+1}function A(ne,de,ge){return ge?4294967296*de+(ne>>>0):4294967296*(de>>>0)+(ne>>>0)}function D(ne,de,ge){var Me=de<=16383?1:de<=2097151?2:de<=268435455?3:Math.floor(Math.log(de)/(7*Math.LN2));ge.realloc(Me);for(var Be=ge.pos-1;Be>=ne;Be--)ge.buf[Be+Me]=ge.buf[Be]}function U(ne,de){for(var ge=0;ge<ne.length;ge++)de.writeVarint(ne[ge])}function H(ne,de){for(var ge=0;ge<ne.length;ge++)de.writeSVarint(ne[ge])}function R(ne,de){for(var ge=0;ge<ne.length;ge++)de.writeFloat(ne[ge])}function N(ne,de){for(var ge=0;ge<ne.length;ge++)de.writeDouble(ne[ge])}function G(ne,de){for(var ge=0;ge<ne.length;ge++)de.writeBoolean(ne[ge])}function z(ne,de){for(var ge=0;ge<ne.length;ge++)de.writeFixed32(ne[ge])}function V(ne,de){for(var ge=0;ge<ne.length;ge++)de.writeSFixed32(ne[ge])}function X(ne,de){for(var ge=0;ge<ne.length;ge++)de.writeFixed64(ne[ge])}function K(ne,de){for(var ge=0;ge<ne.length;ge++)de.writeSFixed64(ne[ge])}function ee(ne,de){return(ne[de]|ne[de+1]<<8|ne[de+2]<<16)+16777216*ne[de+3]}function ce(ne,de,ge){ne[ge]=de,ne[ge+1]=de>>>8,ne[ge+2]=de>>>16,ne[ge+3]=de>>>24}function he(ne,de){return(ne[de]|ne[de+1]<<8|ne[de+2]<<16)+(ne[de+3]<<24)}return c.prototype={destroy:function(){this.buf=null},readFields:function(ne,de,ge){for(ge=ge||this.length;this.pos<ge;){var Me=this.readVarint(),Be=Me>>3,Oe=this.pos;this.type=7&Me,ne(Be,de,this),this.pos===Oe&&this.skip(Me)}return de},readMessage:function(ne,de){return this.readFields(ne,de,this.readVarint()+this.pos)},readFixed32:function(){var ne=ee(this.buf,this.pos);return this.pos+=4,ne},readSFixed32:function(){var ne=he(this.buf,this.pos);return this.pos+=4,ne},readFixed64:function(){var ne=ee(this.buf,this.pos)+ee(this.buf,this.pos+4)*f;return this.pos+=8,ne},readSFixed64:function(){var ne=ee(this.buf,this.pos)+he(this.buf,this.pos+4)*f;return this.pos+=8,ne},readFloat:function(){var ne=g.read(this.buf,this.pos,!0,23,4);return this.pos+=4,ne},readDouble:function(){var ne=g.read(this.buf,this.pos,!0,52,8);return this.pos+=8,ne},readVarint:function(ne){var de,ge,Me=this.buf;return de=127&(ge=Me[this.pos++]),ge<128?de:(de|=(127&(ge=Me[this.pos++]))<<7,ge<128?de:(de|=(127&(ge=Me[this.pos++]))<<14,ge<128?de:(de|=(127&(ge=Me[this.pos++]))<<21,ge<128?de:function(Be,Oe,Ie){var Ye,ze,Qe=Ie.buf;if(Ye=(112&(ze=Qe[Ie.pos++]))>>4,ze<128||(Ye|=(127&(ze=Qe[Ie.pos++]))<<3,ze<128)||(Ye|=(127&(ze=Qe[Ie.pos++]))<<10,ze<128)||(Ye|=(127&(ze=Qe[Ie.pos++]))<<17,ze<128)||(Ye|=(127&(ze=Qe[Ie.pos++]))<<24,ze<128)||(Ye|=(1&(ze=Qe[Ie.pos++]))<<31,ze<128))return A(Be,Ye,Oe);throw new Error("Expected varint not more than 10 bytes")}(de|=(15&(ge=Me[this.pos]))<<28,ne,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var ne=this.readVarint();return ne%2==1?(ne+1)/-2:ne/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var ne=this.readVarint()+this.pos,de=this.pos;return this.pos=ne,ne-de>=12&&S?function(ge,Me,Be){return S.decode(ge.subarray(Me,Be))}(this.buf,de,ne):function(ge,Me,Be){for(var Oe="",Ie=Me;Ie<Be;){var Ye,ze,Qe,lt=ge[Ie],ut=null,ht=lt>239?4:lt>223?3:lt>191?2:1;if(Ie+ht>Be)break;ht===1?lt<128&&(ut=lt):ht===2?(192&(Ye=ge[Ie+1]))==128&&(ut=(31&lt)<<6|63&Ye)<=127&&(ut=null):ht===3?(ze=ge[Ie+2],(192&(Ye=ge[Ie+1]))==128&&(192&ze)==128&&((ut=(15&lt)<<12|(63&Ye)<<6|63&ze)<=2047||ut>=55296&&ut<=57343)&&(ut=null)):ht===4&&(ze=ge[Ie+2],Qe=ge[Ie+3],(192&(Ye=ge[Ie+1]))==128&&(192&ze)==128&&(192&Qe)==128&&((ut=(15&lt)<<18|(63&Ye)<<12|(63&ze)<<6|63&Qe)<=65535||ut>=1114112)&&(ut=null)),ut===null?(ut=65533,ht=1):ut>65535&&(ut-=65536,Oe+=String.fromCharCode(ut>>>10&1023|55296),ut=56320|1023&ut),Oe+=String.fromCharCode(ut),Ie+=ht}return Oe}(this.buf,de,ne)},readBytes:function(){var ne=this.readVarint()+this.pos,de=this.buf.subarray(this.pos,ne);return this.pos=ne,de},readPackedVarint:function(ne,de){if(this.type!==c.Bytes)return ne.push(this.readVarint(de));var ge=x(this);for(ne=ne||[];this.pos<ge;)ne.push(this.readVarint(de));return ne},readPackedSVarint:function(ne){if(this.type!==c.Bytes)return ne.push(this.readSVarint());var de=x(this);for(ne=ne||[];this.pos<de;)ne.push(this.readSVarint());return ne},readPackedBoolean:function(ne){if(this.type!==c.Bytes)return ne.push(this.readBoolean());var de=x(this);for(ne=ne||[];this.pos<de;)ne.push(this.readBoolean());return ne},readPackedFloat:function(ne){if(this.type!==c.Bytes)return ne.push(this.readFloat());var de=x(this);for(ne=ne||[];this.pos<de;)ne.push(this.readFloat());return ne},readPackedDouble:function(ne){if(this.type!==c.Bytes)return ne.push(this.readDouble());var de=x(this);for(ne=ne||[];this.pos<de;)ne.push(this.readDouble());return ne},readPackedFixed32:function(ne){if(this.type!==c.Bytes)return ne.push(this.readFixed32());var de=x(this);for(ne=ne||[];this.pos<de;)ne.push(this.readFixed32());return ne},readPackedSFixed32:function(ne){if(this.type!==c.Bytes)return ne.push(this.readSFixed32());var de=x(this);for(ne=ne||[];this.pos<de;)ne.push(this.readSFixed32());return ne},readPackedFixed64:function(ne){if(this.type!==c.Bytes)return ne.push(this.readFixed64());var de=x(this);for(ne=ne||[];this.pos<de;)ne.push(this.readFixed64());return ne},readPackedSFixed64:function(ne){if(this.type!==c.Bytes)return ne.push(this.readSFixed64());var de=x(this);for(ne=ne||[];this.pos<de;)ne.push(this.readSFixed64());return ne},skip:function(ne){var de=7&ne;if(de===c.Varint)for(;this.buf[this.pos++]>127;);else if(de===c.Bytes)this.pos=this.readVarint()+this.pos;else if(de===c.Fixed32)this.pos+=4;else{if(de!==c.Fixed64)throw new Error("Unimplemented type: "+de);this.pos+=8}},writeTag:function(ne,de){this.writeVarint(ne<<3|de)},realloc:function(ne){for(var de=this.length||16;de<this.pos+ne;)de*=2;if(de!==this.length){var ge=new Uint8Array(de);ge.set(this.buf),this.buf=ge,this.length=de}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(ne){this.realloc(4),ce(this.buf,ne,this.pos),this.pos+=4},writeSFixed32:function(ne){this.realloc(4),ce(this.buf,ne,this.pos),this.pos+=4},writeFixed64:function(ne){this.realloc(8),ce(this.buf,-1&ne,this.pos),ce(this.buf,Math.floor(ne*v),this.pos+4),this.pos+=8},writeSFixed64:function(ne){this.realloc(8),ce(this.buf,-1&ne,this.pos),ce(this.buf,Math.floor(ne*v),this.pos+4),this.pos+=8},writeVarint:function(ne){(ne=+ne||0)>268435455||ne<0?function(de,ge){var Me,Be;if(de>=0?(Me=de%4294967296|0,Be=de/4294967296|0):(Be=~(-de/4294967296),4294967295^(Me=~(-de%4294967296))?Me=Me+1|0:(Me=0,Be=Be+1|0)),de>=18446744073709552e3||de<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");ge.realloc(10),function(Oe,Ie,Ye){Ye.buf[Ye.pos++]=127&Oe|128,Oe>>>=7,Ye.buf[Ye.pos++]=127&Oe|128,Oe>>>=7,Ye.buf[Ye.pos++]=127&Oe|128,Oe>>>=7,Ye.buf[Ye.pos++]=127&Oe|128,Ye.buf[Ye.pos]=127&(Oe>>>=7)}(Me,0,ge),function(Oe,Ie){var Ye=(7&Oe)<<4;Ie.buf[Ie.pos++]|=Ye|((Oe>>>=3)?128:0),Oe&&(Ie.buf[Ie.pos++]=127&Oe|((Oe>>>=7)?128:0),Oe&&(Ie.buf[Ie.pos++]=127&Oe|((Oe>>>=7)?128:0),Oe&&(Ie.buf[Ie.pos++]=127&Oe|((Oe>>>=7)?128:0),Oe&&(Ie.buf[Ie.pos++]=127&Oe|((Oe>>>=7)?128:0),Oe&&(Ie.buf[Ie.pos++]=127&Oe)))))}(Be,ge)}(ne,this):(this.realloc(4),this.buf[this.pos++]=127&ne|(ne>127?128:0),ne<=127||(this.buf[this.pos++]=127&(ne>>>=7)|(ne>127?128:0),ne<=127||(this.buf[this.pos++]=127&(ne>>>=7)|(ne>127?128:0),ne<=127||(this.buf[this.pos++]=ne>>>7&127))))},writeSVarint:function(ne){this.writeVarint(ne<0?2*-ne-1:2*ne)},writeBoolean:function(ne){this.writeVarint(!!ne)},writeString:function(ne){ne=String(ne),this.realloc(4*ne.length),this.pos++;var de=this.pos;this.pos=function(Me,Be,Oe){for(var Ie,Ye,ze=0;ze<Be.length;ze++){if((Ie=Be.charCodeAt(ze))>55295&&Ie<57344){if(!Ye){Ie>56319||ze+1===Be.length?(Me[Oe++]=239,Me[Oe++]=191,Me[Oe++]=189):Ye=Ie;continue}if(Ie<56320){Me[Oe++]=239,Me[Oe++]=191,Me[Oe++]=189,Ye=Ie;continue}Ie=Ye-55296<<10|Ie-56320|65536,Ye=null}else Ye&&(Me[Oe++]=239,Me[Oe++]=191,Me[Oe++]=189,Ye=null);Ie<128?Me[Oe++]=Ie:(Ie<2048?Me[Oe++]=Ie>>6|192:(Ie<65536?Me[Oe++]=Ie>>12|224:(Me[Oe++]=Ie>>18|240,Me[Oe++]=Ie>>12&63|128),Me[Oe++]=Ie>>6&63|128),Me[Oe++]=63&Ie|128)}return Oe}(this.buf,ne,this.pos);var ge=this.pos-de;ge>=128&&D(de,ge,this),this.pos=de-1,this.writeVarint(ge),this.pos+=ge},writeFloat:function(ne){this.realloc(4),g.write(this.buf,ne,this.pos,!0,23,4),this.pos+=4},writeDouble:function(ne){this.realloc(8),g.write(this.buf,ne,this.pos,!0,52,8),this.pos+=8},writeBytes:function(ne){var de=ne.length;this.writeVarint(de),this.realloc(de);for(var ge=0;ge<de;ge++)this.buf[this.pos++]=ne[ge]},writeRawMessage:function(ne,de){this.pos++;var ge=this.pos;ne(de,this);var Me=this.pos-ge;Me>=128&&D(ge,Me,this),this.pos=ge-1,this.writeVarint(Me),this.pos+=Me},writeMessage:function(ne,de,ge){this.writeTag(ne,c.Bytes),this.writeRawMessage(de,ge)},writePackedVarint:function(ne,de){de.length&&this.writeMessage(ne,U,de)},writePackedSVarint:function(ne,de){de.length&&this.writeMessage(ne,H,de)},writePackedBoolean:function(ne,de){de.length&&this.writeMessage(ne,G,de)},writePackedFloat:function(ne,de){de.length&&this.writeMessage(ne,R,de)},writePackedDouble:function(ne,de){de.length&&this.writeMessage(ne,N,de)},writePackedFixed32:function(ne,de){de.length&&this.writeMessage(ne,z,de)},writePackedSFixed32:function(ne,de){de.length&&this.writeMessage(ne,V,de)},writePackedFixed64:function(ne,de){de.length&&this.writeMessage(ne,X,de)},writePackedSFixed64:function(ne,de){de.length&&this.writeMessage(ne,K,de)},writeBytesField:function(ne,de){this.writeTag(ne,c.Bytes),this.writeBytes(de)},writeFixed32Field:function(ne,de){this.writeTag(ne,c.Fixed32),this.writeFixed32(de)},writeSFixed32Field:function(ne,de){this.writeTag(ne,c.Fixed32),this.writeSFixed32(de)},writeFixed64Field:function(ne,de){this.writeTag(ne,c.Fixed64),this.writeFixed64(de)},writeSFixed64Field:function(ne,de){this.writeTag(ne,c.Fixed64),this.writeSFixed64(de)},writeVarintField:function(ne,de){this.writeTag(ne,c.Varint),this.writeVarint(de)},writeSVarintField:function(ne,de){this.writeTag(ne,c.Varint),this.writeSVarint(de)},writeStringField:function(ne,de){this.writeTag(ne,c.Bytes),this.writeString(de)},writeFloatField:function(ne,de){this.writeTag(ne,c.Fixed32),this.writeFloat(de)},writeDoubleField:function(ne,de){this.writeTag(ne,c.Fixed64),this.writeDouble(de)},writeBooleanField:function(ne,de){this.writeVarintField(ne,!!de)}},M3}var MM=h(S7());const E3=3;function Uue(g,c,f){c.glyphs=[],g===1&&f.readMessage(Vue,c)}function Vue(g,c,f){if(g===3){const{id:v,bitmap:S,width:x,height:A,left:D,top:U,advance:H}=f.readMessage(Gue,{});c.glyphs.push({id:v,bitmap:new qg({width:x+2*E3,height:A+2*E3},S),metrics:{width:x,height:A,left:D,top:U,advance:H}})}else g===4?c.ascender=f.readSVarint():g===5&&(c.descender=f.readSVarint())}function Gue(g,c,f){g===1?c.id=f.readVarint():g===2?c.bitmap=f.readBytes():g===3?c.width=f.readVarint():g===4?c.height=f.readVarint():g===5?c.left=f.readSVarint():g===6?c.top=f.readSVarint():g===7&&(c.advance=f.readVarint())}const A7=E3,Su={horizontal:1,vertical:2,horizontalOnly:3};class Gw{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(c,f){const v=new Gw;return v.scale=c||1,v.fontStack=f,v}static forImage(c){const f=new Gw;return f.imageName=c,f}}class Vx{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(c,f){const v=new Vx;for(let S=0;S<c.sections.length;S++){const x=c.sections[S];x.image?v.addImageSection(x):v.addTextSection(x,f)}return v}length(){return this.text.length}getSection(c){return this.sections[this.sectionIndex[c]]}getSections(){return this.sections}getSectionIndex(c){return this.sectionIndex[c]}getCodePoint(c){return this.text.codePointAt(c)}verticalizePunctuation(c){this.text=function(f,v){let S="";for(let x=0;x<f.length;x++){const A=f.charCodeAt(x+1)||null,D=f.charCodeAt(x-1)||null;S+=!v&&(A&&wd(A)&&!Vw[f[x+1]]||D&&wd(D)&&!Vw[f[x-1]])||!Vw[f[x]]?f[x]:Vw[f[x]]}return S}(this.text,c)}trim(){let c=0;for(let v=0;v<this.text.length&&CM[this.text.charCodeAt(v)];v++)c++;let f=this.text.length;for(let v=this.text.length-1;v>=0&&v>=c&&CM[this.text.charCodeAt(v)];v--)f--;this.text=this.text.substring(c,f),this.sectionIndex=this.sectionIndex.slice(c,f)}substring(c,f){const v=new Vx;return v.text=this.text.substring(c,f),v.sectionIndex=this.sectionIndex.slice(c,f),v.sections=this.sections,v}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((c,f)=>Math.max(c,this.sections[f].scale),0)}addTextSection(c,f){this.text+=c.text,this.sections.push(Gw.forText(c.scale,c.fontStack||f));const v=this.sections.length-1;for(let S=0;S<c.text.length;++S)this.sectionIndex.push(v)}addImageSection(c){const f=c.image?c.image.namePrimary:"";if(f.length===0)return void Lt("Can't add FormattedSection with an empty image.");const v=this.getNextImageSectionCharCode();v?(this.text+=String.fromCodePoint(v),this.sections.push(Gw.forImage(f)),this.sectionIndex.push(this.sections.length-1)):Lt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function I3(g,c,f,v,S,x,A,D,U,H,R,N,G,z,V){const X=Vx.fromFeature(g,S);N===Su.vertical&&X.verticalizePunctuation(G);let K=[];const ee=function(ge,Me,Be,Oe,Ie,Ye){if(!ge)return[];const ze=[],Qe=function(mt,Et,vt,Ut,Yt,Dt){let Rn=0;for(let bn=0;bn<mt.length();bn++){const dn=mt.getSection(bn);Rn+=T7(mt.getCodePoint(bn),dn,Ut,Yt,Et,Dt)}return Rn/Math.max(1,Math.ceil(Rn/vt))}(ge,Me,Be,Oe,Ie,Ye),lt=ge.text.indexOf("​")>=0;let ut=0;for(let mt=0;mt<ge.length();mt++){const Et=ge.getSection(mt),vt=ge.getCodePoint(mt);if(CM[vt]||(ut+=T7(vt,Et,Oe,Ie,Me,Ye)),mt<ge.length()-1){const Ut=!((ht=vt)<11904||!(Yn["Bopomofo Extended"](ht)||Yn.Bopomofo(ht)||Yn["CJK Compatibility Forms"](ht)||Yn["CJK Compatibility Ideographs"](ht)||Yn["CJK Compatibility"](ht)||Yn["CJK Radicals Supplement"](ht)||Yn["CJK Strokes"](ht)||Yn["CJK Symbols and Punctuation"](ht)||Yn["CJK Unified Ideographs Extension A"](ht)||Yn["CJK Unified Ideographs"](ht)||Yn["Enclosed CJK Letters and Months"](ht)||Yn["Halfwidth and Fullwidth Forms"](ht)||Yn.Hiragana(ht)||Yn["Ideographic Description Characters"](ht)||Yn["Kangxi Radicals"](ht)||Yn["Katakana Phonetic Extensions"](ht)||Yn.Katakana(ht)||Yn["Vertical Forms"](ht)||Yn["Yi Radicals"](ht)||Yn["Yi Syllables"](ht)));(Hue[vt]||Ut||Et.imageName)&&ze.push(C7(mt+1,ut,Qe,ze,jue(vt,ge.getCodePoint(mt+1),Ut&&lt),!1))}}var ht;return E7(C7(ge.length(),ut,Qe,ze,0,!0))}(X,H,x,c,v,z),{processBidirectionalText:ce,processStyledBidirectionalText:he}=Oa;if(ce&&X.sections.length===1){const ge=ce(X.toString(),ee);for(const Me of ge){const Be=new Vx;Be.text=Me,Be.sections=X.sections;for(let Oe=0;Oe<Me.length;Oe++)Be.sectionIndex.push(0);K.push(Be)}}else if(he){const ge=he(X.text,X.sectionIndex,ee);for(const Me of ge){const Be=new Vx;Be.text=Me[0],Be.sectionIndex=Me[1],Be.sections=X.sections,K.push(Be)}}else K=function(ge,Me){const Be=[],Oe=ge.text;let Ie=0;for(const Ye of Me)Be.push(ge.substring(Ie,Ye)),Ie=Ye;return Ie<Oe.length&&Be.push(ge.substring(Ie,Oe.length)),Be}(X,ee);const ne=[],de={positionedLines:ne,text:X.toString(),top:R[1],bottom:R[1],left:R[0],right:R[0],writingMode:N,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ge,Me,Be,Oe,Ie,Ye,ze,Qe,lt,ut,ht,mt){let Et=0,vt=0,Ut=0;const Yt=Qe==="right"?1:Qe==="left"?0:.5;let Dt=!1;for(const In of Ie){const Nn=In.getSections();for(const wr of Nn){if(wr.imageName)continue;const Or=Me[wr.fontStack];if(Or&&(Dt=Or.ascender!==void 0&&Or.descender!==void 0,!Dt))break}if(!Dt)break}let Rn=0;for(const In of Ie){In.trim();const Nn=In.getMaxScale(),wr=(Nn-1)*Fa,Or={positionedGlyphs:[],lineOffset:0};ge.positionedLines[Rn]=Or;const Pr=Or.positionedGlyphs;let Lr=0;if(!In.length()){vt+=Ye,++Rn;continue}let jr=0,Wr=0;for(let Ai=0;Ai<In.length();Ai++){const Tr=In.getSection(Ai),gi=In.getSectionIndex(Ai),xi=In.getCodePoint(Ai);let rs=Tr.scale,Hs=null,fo=null,js=null,Bs=Fa,ca=0;const wo=!(lt===Su.horizontal||!ht&&!qp(xi)||ht&&(CM[xi]||(bn=xi,Yn.Arabic(bn)||Yn["Arabic Supplement"](bn)||Yn["Arabic Extended-A"](bn)||Yn["Arabic Presentation Forms-A"](bn)||Yn["Arabic Presentation Forms-B"](bn))));if(Tr.imageName){const Na=Oe[Tr.imageName];if(!Na)continue;js=Tr.imageName,ge.iconsInText=ge.iconsInText||!0,fo=Na.paddedRect;const Ki=Na.displaySize;rs=rs*Fa/mt,Hs={width:Ki[0],height:Ki[1],left:0,top:-A7,advance:wo?Ki[1]:Ki[0],localGlyph:!1},ca=Dt?-Hs.height*rs:Nn*Fa-17-Ki[1]*rs,Bs=Hs.advance;const dc=(wo?Ki[0]:Ki[1])*rs-Fa*Nn;dc>0&&dc>Lr&&(Lr=dc)}else{const Na=Be[Tr.fontStack];if(!Na)continue;Na[xi]&&(fo=Na[xi]);const Ki=Me[Tr.fontStack];if(!Ki)continue;const dc=Ki.glyphs[xi];if(!dc)continue;if(Hs=dc.metrics,Bs=xi!==8203?Fa:0,Dt){const xf=Ki.ascender!==void 0?Math.abs(Ki.ascender):0,rh=Ki.descender!==void 0?Math.abs(Ki.descender):0,ih=(xf+rh)*rs;jr<ih&&(jr=ih,Wr=(xf-rh)/2*rs),ca=-xf*rs}else ca=(Nn-rs)*Fa-17}wo?(ge.verticalizable=!0,Pr.push({glyph:xi,imageName:js,x:Et,y:vt+ca,vertical:wo,scale:rs,localGlyph:Hs.localGlyph,fontStack:Tr.fontStack,sectionIndex:gi,metrics:Hs,rect:fo}),Et+=Bs*rs+ut):(Pr.push({glyph:xi,imageName:js,x:Et,y:vt+ca,vertical:wo,scale:rs,localGlyph:Hs.localGlyph,fontStack:Tr.fontStack,sectionIndex:gi,metrics:Hs,rect:fo}),Et+=Hs.advance*rs+ut)}Pr.length!==0&&(Ut=Math.max(Et-ut,Ut),Dt?I7(Pr,Yt,Lr,Wr,Ye*Nn/2):I7(Pr,Yt,Lr,0,Ye/2)),Et=0;const zi=Ye*Nn+Lr;Or.lineOffset=Math.max(Lr,wr),vt+=zi,++Rn}var bn;const dn=vt,{horizontalAlign:tn,verticalAlign:nr}=R3(ze);(function(In,Nn,wr,Or,Pr,Lr){const jr=(Nn-wr)*Pr,Wr=-Lr*Or;for(const zi of In)for(const Ai of zi.positionedGlyphs)Ai.x+=jr,Ai.y+=Wr})(ge.positionedLines,Yt,tn,nr,Ut,dn),ge.top+=-nr*dn,ge.bottom=ge.top+dn,ge.left+=-tn*Ut,ge.right=ge.left+Ut,ge.hasBaseline=Dt}(de,c,f,v,K,A,D,U,N,H,G,V),!function(ge){for(const Me of ge)if(Me.positionedGlyphs.length!==0)return!1;return!0}(ne)&&de}const CM={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Hue={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function T7(g,c,f,v,S,x){if(c.imageName){const A=v[c.imageName];return A?A.displaySize[0]*c.scale*Fa/x+S:0}{const A=f[c.fontStack],D=A&&A.glyphs[g];return D?D.metrics.advance*c.scale+S:0}}function M7(g,c,f,v){const S=Math.pow(g-c,2);return v?g<c?S/2:2*S:S+Math.abs(f)*f}function jue(g,c,f){let v=0;return g===10&&(v-=1e4),f&&(v+=150),g!==40&&g!==65288||(v+=50),c!==41&&c!==65289||(v+=50),v}function C7(g,c,f,v,S,x){let A=null,D=M7(c,f,S,x);for(const U of v){const H=M7(c-U.x,f,S,x)+U.badness;H<=D&&(A=U,D=H)}return{index:g,x:c,priorBreak:A,badness:D}}function E7(g){return g?E7(g.priorBreak).concat(g.index):[]}function R3(g){let c=.5,f=.5;switch(g){case"right":case"top-right":case"bottom-right":c=1;break;case"left":case"top-left":case"bottom-left":c=0}switch(g){case"bottom":case"bottom-right":case"bottom-left":f=1;break;case"top":case"top-right":case"top-left":f=0}return{horizontalAlign:c,verticalAlign:f}}function I7(g,c,f,v,S){if(!(c||f||v||S))return;const x=g.length-1,A=g[x],D=(A.x+A.metrics.advance*A.scale)*c;for(let U=0;U<=x;U++)g[U].x-=D,g[U].y+=f+v+S}function Wue(g,c,f,v){const{horizontalAlign:S,verticalAlign:x}=R3(v),A=f[0]-g.displaySize[0]*S,D=f[1]-g.displaySize[1]*x;return{imagePrimary:g,imageSecondary:c,top:D,bottom:D+g.displaySize[1],left:A,right:A+g.displaySize[0]}}function R7(g,c,f,v,S,x){const A=g.imagePrimary;let D;if(A.content){const K=A.content,ee=A.pixelRatio||1;D=[K[0]/ee,K[1]/ee,A.displaySize[0]-K[2]/ee,A.displaySize[1]-K[3]/ee]}const U=c.left*x,H=c.right*x;let R,N,G,z;f==="width"||f==="both"?(z=S[0]+U-v[3],N=S[0]+H+v[1]):(z=S[0]+(U+H-A.displaySize[0])/2,N=z+A.displaySize[0]);const V=c.top*x,X=c.bottom*x;return f==="height"||f==="both"?(R=S[1]+V-v[0],G=S[1]+X+v[2]):(R=S[1]+(V+X-A.displaySize[1])/2,G=R+A.displaySize[1]),{imagePrimary:A,imageSecondary:void 0,top:R,right:N,bottom:G,left:z,collisionPadding:D}}class im extends St{constructor(c,f,v,S,x){super(c,f),this.angle=S,this.z=v,x!==void 0&&(this.segment=x)}clone(){return new im(this.x,this.y,this.z,this.angle,this.segment)}}function P7(g,c,f,v,S){if(c.segment===void 0)return!0;let x=c,A=c.segment+1,D=0;for(;D>-f/2;){if(A--,A<0)return!1;D-=g[A].dist(x),x=g[A]}D+=g[A].dist(g[A+1]),A++;const U=[];let H=0;for(;D<f/2;){const R=g[A],N=g[A+1];if(!N)return!1;let G=g[A-1].angleTo(R)-R.angleTo(N);for(G=Math.abs((G+3*Math.PI)%(2*Math.PI)-Math.PI),U.push({distance:D,angleDelta:G}),H+=G;D-U[0].distance>v;)H-=U.shift().angleDelta;if(H>S)return!1;A++,D+=R.dist(N)}return!0}function L7(g){let c=0;for(let f=0;f<g.length-1;f++)c+=g[f].dist(g[f+1]);return c}function D7(g,c,f){return g?.6*c*f:0}function B7(g,c){return Math.max(g?g.right-g.left:0,c?c.right-c.left:0)}function Xue(g,c,f,v,S,x){const A=D7(f,S,x),D=B7(f,v)*x;let U=0;const H=L7(g)/2;for(let R=0;R<g.length-1;R++){const N=g[R],G=g[R+1],z=N.dist(G);if(U+z>H){const V=(H-U)/z,X=cr(N.x,G.x,V),K=cr(N.y,G.y,V),ee=new im(X,K,0,G.angleTo(N),R);return!A||P7(g,ee,D,A,c)?ee:void 0}U+=z}}function $ue(g,c,f,v,S,x,A,D,U){const H=D7(v,x,A),R=B7(v,S),N=R*A,G=g[0].x===0||g[0].x===U||g[0].y===0||g[0].y===U;return c-N<c/4&&(c=N+c/4),k7(g,G?c/2*D%c:(R/2+2*x)*A*D%c,c,H,f,N,G,!1,U)}function k7(g,c,f,v,S,x,A,D,U){const H=x/2,R=L7(g);let N=0,G=c-f,z=[];for(let V=0;V<g.length-1;V++){const X=g[V],K=g[V+1],ee=X.dist(K),ce=K.angleTo(X);for(;G+f<N+ee;){G+=f;const he=(G-N)/ee,ne=cr(X.x,K.x,he),de=cr(X.y,K.y,he);if(ne>=0&&ne<U&&de>=0&&de<U&&G-H>=0&&G+H<=R){const ge=new im(ne,de,0,ce,V);v&&!P7(g,ge,x,v,S)||z.push(ge)}}N+=ee}return D||z.length||A||(z=k7(g,N/2,f,v,S,x,A,!0,U)),z}function O7(g,c,f,v,S){const x=[];for(let A=0;A<g.length;A++){const D=g[A];let U;for(let H=0;H<D.length-1;H++){let R=D[H],N=D[H+1];R.x<c&&N.x<c||(R.x<c?R=new St(c,R.y+(c-R.x)/(N.x-R.x)*(N.y-R.y))._round():N.x<c&&(N=new St(c,R.y+(c-R.x)/(N.x-R.x)*(N.y-R.y))._round()),R.y<f&&N.y<f||(R.y<f?R=new St(R.x+(f-R.y)/(N.y-R.y)*(N.x-R.x),f)._round():N.y<f&&(N=new St(R.x+(f-R.y)/(N.y-R.y)*(N.x-R.x),f)._round()),R.x>=v&&N.x>=v||(R.x>=v?R=new St(v,R.y+(v-R.x)/(N.x-R.x)*(N.y-R.y))._round():N.x>=v&&(N=new St(v,R.y+(v-R.x)/(N.x-R.x)*(N.y-R.y))._round()),R.y>=S&&N.y>=S||(R.y>=S?R=new St(R.x+(S-R.y)/(N.y-R.y)*(N.x-R.x),S)._round():N.y>=S&&(N=new St(R.x+(S-R.y)/(N.y-R.y)*(N.x-R.x),S)._round()),U&&R.equals(U[U.length-1])||(U=[R],x.push(U)),U.push(N)))))}}return x}function F7(g){let c=0,f=0;for(const A of g)c+=A.w*A.h,f=Math.max(f,A.w);g.sort((A,D)=>D.h-A.h);const v=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(c/.95)),f),h:1/0}];let S=0,x=0;for(const A of g)for(let D=v.length-1;D>=0;D--){const U=v[D];if(!(A.w>U.w||A.h>U.h)){if(A.x=U.x,A.y=U.y,x=Math.max(x,A.y+A.h),S=Math.max(S,A.x+A.w),A.w===U.w&&A.h===U.h){const H=v.pop();D<v.length&&(v[D]=H)}else A.h===U.h?(U.x+=A.w,U.w-=A.w):A.w===U.w?(U.y+=A.h,U.h-=A.h):(v.push({x:U.x+A.w,y:U.y,w:U.w-A.w,h:A.h}),U.y+=A.h,U.h-=A.h);break}}return{w:S,h:x,fill:c/(S*x)||0}}Fn(im,"Anchor");const Hw=1;class P3{constructor(c,{pixelRatio:f,version:v,stretchX:S,stretchY:x,content:A},D){this.paddedRect=c,this.pixelRatio=f,this.stretchX=S,this.stretchY=x,this.content=A,this.version=v,this.padding=D}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.pixelRatio,(this.paddedRect.h-2*this.padding)/this.pixelRatio]}}class N7{constructor(c,f,v){const S={},x={};this.haveRenderCallbacks=[];const A=[];this.addImages(c,S,Hw,A),this.addImages(f,x,2,A);const{w:D,h:U}=F7(A),H=new ml({width:D||1,height:U||1});for(const R in c){const N=c[R],G=S[R].paddedRect;ml.copy(N.data,H,{x:0,y:0},{x:G.x+Hw,y:G.y+Hw},N.data,v,N.sdf)}for(const R in f){const N=f[R],G=x[R].paddedRect;let z=x[R].padding;const V=G.x+z,X=G.y+z,K=N.data.width,ee=N.data.height;z=z>1?z-1:z,ml.copy(N.data,H,{x:0,y:0},{x:V,y:X},N.data,v),ml.copy(N.data,H,{x:0,y:ee-z},{x:V,y:X-z},{width:K,height:z},v),ml.copy(N.data,H,{x:0,y:0},{x:V,y:X+ee},{width:K,height:z},v),ml.copy(N.data,H,{x:K-z,y:0},{x:V-z,y:X},{width:z,height:ee},v),ml.copy(N.data,H,{x:0,y:0},{x:V+K,y:X},{width:z,height:ee},v),ml.copy(N.data,H,{x:K-z,y:ee-z},{x:V-z,y:X-z},{width:z,height:z},v),ml.copy(N.data,H,{x:0,y:ee-z},{x:V+K,y:X-z},{width:z,height:z},v),ml.copy(N.data,H,{x:0,y:0},{x:V+K,y:X+ee},{width:z,height:z},v),ml.copy(N.data,H,{x:K-z,y:0},{x:V-z,y:X+ee},{width:z,height:z},v)}this.image=H,this.iconPositions=S,this.patternPositions=x}addImages(c,f,v,S){for(const x in c){const A=c[x],D={x:0,y:0,w:A.data.width+2*v,h:A.data.height+2*v};S.push(D),f[x]=new P3(D,A,v),A.hasRenderCallback&&this.haveRenderCallbacks.push(x)}}patchUpdatedImages(c,f,v){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(S=>c.hasImage(S,v)),c.dispatchRenderCallbacks(this.haveRenderCallbacks,v);for(const S in c.getUpdatedImages(v))this.patchUpdatedImage(this.iconPositions[S],c.getImage(S,v),f),this.patchUpdatedImage(this.patternPositions[S],c.getImage(S,v),f)}patchUpdatedImage(c,f,v){if(!c||!f||c.version===f.version)return;c.version=f.version;const[S,x]=c.tl;v.update(f.data,{position:{x:S,y:x}})}}Fn(P3,"ImagePosition"),Fn(N7,"ImageAtlas");const jw=1e20;function z7(g,c,f,v,S,x,A,D,U){for(let H=c;H<c+v;H++)U7(g,f*x+H,x,S,A,D,U);for(let H=f;H<f+S;H++)U7(g,H*x+c,1,v,A,D,U)}function U7(g,c,f,v,S,x,A){x[0]=0,A[0]=-jw,A[1]=jw,S[0]=g[c];for(let D=1,U=0,H=0;D<v;D++){S[D]=g[c+D*f];const R=D*D;do{const N=x[U];H=(S[D]-S[N]+R-N*N)/(D-N)/2}while(H<=A[U]&&--U>-1);U++,x[U]=D,A[U]=H,A[U+1]=jw}for(let D=0,U=0;D<v;D++){for(;A[U+1]<D;)U++;const H=x[U],R=D-H;g[c+D*f]=S[H]+R*R}}const gf=2,L3={none:0,ideographs:1,all:2};class Gx{constructor(c,f,v){this.requestManager=c,this.localGlyphMode=f,this.localFontFamily=v,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(c,f){this.urls[f]=c}getGlyphs(c,f,v){const S=[],x=this.urls[f]||nt.GLYPHS_URL;for(const A in c)for(const D of c[A])S.push({stack:A,id:D});tr(S,({stack:A,id:D},U)=>{let H=this.entries[A];H||(H=this.entries[A]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let R=H.glyphs[D];if(R!==void 0)return void U(null,{stack:A,id:D,glyph:R});if(R=this._tinySDF(H,A,D),R)return H.glyphs[D]=R,void U(null,{stack:A,id:D,glyph:R});const N=Math.floor(D/256);if(256*N>65535)return void U(new Error("glyphs > 65535 not supported"));if(H.ranges[N])return void U(null,{stack:A,id:D,glyph:R});let G=H.requests[N];G||(G=H.requests[N]=[],Gx.loadGlyphRange(A,N,x,this.requestManager,(z,V)=>{if(V){H.ascender=V.ascender,H.descender=V.descender;for(const X in V.glyphs)this._doesCharSupportLocalGlyph(+X)||(H.glyphs[+X]=V.glyphs[+X]);H.ranges[N]=!0}for(const X of G)X(z,V);delete H.requests[N]})),G.push((z,V)=>{z?U(z):V&&U(null,{stack:A,id:D,glyph:V.glyphs[D]||null})})},(A,D)=>{if(A)v(A);else if(D){const U={};for(const{stack:H,id:R,glyph:N}of D)U[H]===void 0&&(U[H]={}),U[H].glyphs===void 0&&(U[H].glyphs={}),U[H].glyphs[R]=N&&{id:N.id,bitmap:N.bitmap.clone(),metrics:N.metrics},U[H].ascender=this.entries[H].ascender,U[H].descender=this.entries[H].descender;v(null,U)}})}_doesCharSupportLocalGlyph(c){return this.localGlyphMode!==L3.none&&(this.localGlyphMode===L3.all?!!this.localFontFamily:!!this.localFontFamily&&(Yn["CJK Unified Ideographs"](c)||Yn["Hangul Syllables"](c)||Yn.Hiragana(c)||Yn.Katakana(c)||Yn["CJK Symbols and Punctuation"](c)||Yn["CJK Unified Ideographs Extension A"](c)||Yn["CJK Unified Ideographs Extension B"](c)))}_tinySDF(c,f,v){const S=this.localFontFamily;if(!S||!this._doesCharSupportLocalGlyph(v))return;let x=c.tinySDF;if(!x){let X="400";/bold/i.test(f)?X="900":/medium/i.test(f)?X="500":/light/i.test(f)&&(X="200"),x=c.tinySDF=new Gx.TinySDF({fontFamily:S,fontWeight:X,fontSize:24*gf,buffer:3*gf,radius:8*gf}),x.fontWeight=X}if(this.localGlyphs[x.fontWeight][v])return this.localGlyphs[x.fontWeight][v];const A=String.fromCodePoint(v),{data:D,width:U,height:H,glyphWidth:R,glyphHeight:N,glyphLeft:G,glyphTop:z,glyphAdvance:V}=x.draw(A);return this.localGlyphs[x.fontWeight][v]={id:v,bitmap:new qg({width:U,height:H},D),metrics:{width:R/gf,height:N/gf,left:G/gf,top:z/gf-27,advance:V/gf,localGlyph:!0}}}}Gx.loadGlyphRange=function(g,c,f,v,S){const x=256*c,A=x+255,D=v.transformRequest(v.normalizeGlyphsURL(f).replace("{fontstack}",g).replace("{range}",`${x}-${A}`),qi.Glyphs);Ps(D,(U,H)=>{if(U)S(U);else if(H){const R={},N=function(G){return new MM(G).readFields(Uue,{})}(H);for(const G of N.glyphs)R[G.id]=G;S(null,{glyphs:R,ascender:N.ascender,descender:N.descender})}})},Gx.TinySDF=class{constructor({fontSize:g=24,buffer:c=3,radius:f=8,cutoff:v=.25,fontFamily:S="sans-serif",fontWeight:x="normal",fontStyle:A="normal"}={}){this.buffer=c,this.cutoff=v,this.radius=f;const D=this.size=g+4*c,U=this._createCanvas(D),H=this.ctx=U.getContext("2d",{willReadFrequently:!0});H.font=`${A} ${x} ${g}px ${S}`,H.textBaseline="alphabetic",H.textAlign="left",H.fillStyle="black",this.gridOuter=new Float64Array(D*D),this.gridInner=new Float64Array(D*D),this.f=new Float64Array(D),this.z=new Float64Array(D+1),this.v=new Uint16Array(D)}_createCanvas(g){const c=document.createElement("canvas");return c.width=c.height=g,c}draw(g){const{width:c,actualBoundingBoxAscent:f,actualBoundingBoxDescent:v,actualBoundingBoxLeft:S,actualBoundingBoxRight:x}=this.ctx.measureText(g),A=Math.ceil(f),D=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(x-S))),U=Math.min(this.size-this.buffer,A+Math.ceil(v)),H=D+2*this.buffer,R=U+2*this.buffer,N=Math.max(H*R,0),G=new Uint8ClampedArray(N),z={data:G,width:H,height:R,glyphWidth:D,glyphHeight:U,glyphTop:A,glyphLeft:0,glyphAdvance:c};if(D===0||U===0)return z;const{ctx:V,buffer:X,gridInner:K,gridOuter:ee}=this;V.clearRect(X,X,D,U),V.fillText(g,X,X+A);const ce=V.getImageData(X,X,D,U);ee.fill(jw,0,N),K.fill(0,0,N);for(let he=0;he<U;he++)for(let ne=0;ne<D;ne++){const de=ce.data[4*(he*D+ne)+3]/255;if(de===0)continue;const ge=(he+X)*H+ne+X;if(de===1)ee[ge]=0,K[ge]=jw;else{const Me=.5-de;ee[ge]=Me>0?Me*Me:0,K[ge]=Me<0?Me*Me:0}}z7(ee,0,0,H,R,H,this.f,this.v,this.z),z7(K,X,X,D,U,H,this.f,this.v,this.z);for(let he=0;he<N;he++){const ne=Math.sqrt(ee[he])-Math.sqrt(K[he]);G[he]=Math.round(255-255*(ne/this.radius+this.cutoff))}return z}};const Yg=Hw;function V7(g,c,f,v){const S=[],x=g.imagePrimary,A=x.pixelRatio,D=x.paddedRect.w-2*Yg,U=x.paddedRect.h-2*Yg,H=g.right-g.left,R=g.bottom-g.top,N=x.stretchX||[[0,D]],G=x.stretchY||[[0,U]],z=(Ye,ze)=>Ye+ze[1]-ze[0],V=N.reduce(z,0),X=G.reduce(z,0),K=D-V,ee=U-X;let ce=0,he=V,ne=0,de=X,ge=0,Me=K,Be=0,Oe=ee;if(x.content&&v){const Ye=x.content;ce=EM(N,0,Ye[0]),ne=EM(G,0,Ye[1]),he=EM(N,Ye[0],Ye[2]),de=EM(G,Ye[1],Ye[3]),ge=Ye[0]-ce,Be=Ye[1]-ne,Me=Ye[2]-Ye[0]-he,Oe=Ye[3]-Ye[1]-de}const Ie=(Ye,ze,Qe,lt)=>{const ut=IM(Ye.stretch-ce,he,H,g.left),ht=RM(Ye.fixed-ge,Me,Ye.stretch,V),mt=IM(ze.stretch-ne,de,R,g.top),Et=RM(ze.fixed-Be,Oe,ze.stretch,X),vt=IM(Qe.stretch-ce,he,H,g.left),Ut=RM(Qe.fixed-ge,Me,Qe.stretch,V),Yt=IM(lt.stretch-ne,de,R,g.top),Dt=RM(lt.fixed-Be,Oe,lt.stretch,X),Rn=new St(ut,mt),bn=new St(vt,mt),dn=new St(vt,Yt),tn=new St(ut,Yt),nr=new St(ht/A,Et/A),In=new St(Ut/A,Dt/A),Nn=c*Math.PI/180;if(Nn){const Wr=Math.sin(Nn),zi=Math.cos(Nn),Ai=[zi,-Wr,Wr,zi];Rn._matMult(Ai),bn._matMult(Ai),tn._matMult(Ai),dn._matMult(Ai)}const wr=Ye.stretch+Ye.fixed,Or=Qe.stretch+Qe.fixed,Pr=ze.stretch+ze.fixed,Lr=lt.stretch+lt.fixed,jr=g.imageSecondary;return{tl:Rn,tr:bn,bl:tn,br:dn,texPrimary:{x:x.paddedRect.x+Yg+wr,y:x.paddedRect.y+Yg+Pr,w:Or-wr,h:Lr-Pr},texSecondary:jr?{x:jr.paddedRect.x+Yg+wr,y:jr.paddedRect.y+Yg+Pr,w:Or-wr,h:Lr-Pr}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:nr,pixelOffsetBR:In,minFontScaleX:Me/A/H,minFontScaleY:Oe/A/R,isSDF:f}};if(v&&(x.stretchX||x.stretchY)){const Ye=G7(N,K,V),ze=G7(G,ee,X);for(let Qe=0;Qe<Ye.length-1;Qe++){const lt=Ye[Qe],ut=Ye[Qe+1];for(let ht=0;ht<ze.length-1;ht++)S.push(Ie(lt,ze[ht],ut,ze[ht+1]))}}else S.push(Ie({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:D+1},{fixed:0,stretch:U+1}));return S}function EM(g,c,f){let v=0;for(const S of g)v+=Math.max(c,Math.min(f,S[1]))-Math.max(c,Math.min(f,S[0]));return v}function G7(g,c,f){const v=[{fixed:-Yg,stretch:0}];for(const[S,x]of g){const A=v[v.length-1];v.push({fixed:S-A.stretch,stretch:A.stretch}),v.push({fixed:S-A.stretch,stretch:A.stretch+(x-S)})}return v.push({fixed:c+Yg,stretch:f}),v}function IM(g,c,f,v){return g/c*f+v}function RM(g,c,f,v){return g-c*f/v}function que(g,c,f,v){const S=c+g.positionedLines[v].lineOffset;return v===0?f+S/2:f+(S+(c+g.positionedLines[v-1].lineOffset))/2}function Zue(g,c=1,f=!1){let v=1/0,S=1/0,x=-1/0,A=-1/0;const D=g[0];for(let z=0;z<D.length;z++){const V=D[z];(!z||V.x<v)&&(v=V.x),(!z||V.y<S)&&(S=V.y),(!z||V.x>x)&&(x=V.x),(!z||V.y>A)&&(A=V.y)}const U=Math.min(x-v,A-S);let H=U/2;const R=new Wh([],Yue);if(U===0)return new St(v,S);for(let z=v;z<x;z+=U)for(let V=S;V<A;V+=U)R.push(new Hx(z+H,V+H,H,g));let N=function(z){let V=0,X=0,K=0;const ee=z[0];for(let ce=0,he=ee.length,ne=he-1;ce<he;ne=ce++){const de=ee[ce],ge=ee[ne],Me=de.x*ge.y-ge.x*de.y;X+=(de.x+ge.x)*Me,K+=(de.y+ge.y)*Me,V+=3*Me}return new Hx(X/V,K/V,0,z)}(g),G=R.length;for(;R.length;){const z=R.pop();(z.d>N.d||!N.d)&&(N=z,f&&console.log("found best %d after %d probes",Math.round(1e4*z.d)/1e4,G)),z.max-N.d<=c||(H=z.h/2,R.push(new Hx(z.p.x-H,z.p.y-H,H,g)),R.push(new Hx(z.p.x+H,z.p.y-H,H,g)),R.push(new Hx(z.p.x-H,z.p.y+H,H,g)),R.push(new Hx(z.p.x+H,z.p.y+H,H,g)),G+=4)}return f&&(console.log(`num probes: ${G}`),console.log(`best distance: ${N.d}`)),N.p}function Yue(g,c){return c.max-g.max}class Hx{constructor(c,f,v,S){this.p=new St(c,f),this.h=v,this.d=function(x,A){let D=!1,U=1/0;for(let H=0;H<A.length;H++){const R=A[H];for(let N=0,G=R.length,z=G-1;N<G;z=N++){const V=R[N],X=R[z];V.y>x.y!=X.y>x.y&&x.x<(X.x-V.x)*(x.y-V.y)/(X.y-V.y)+V.x&&(D=!D),U=Math.min(U,Mi(x,V,X))}}return(D?1:-1)*Math.sqrt(U)}(this.p,S),this.max=this.d+this.h*Math.SQRT2}}const D3=Number.POSITIVE_INFINITY,Kue=Math.sqrt(2);function H7(g,[c,f]){let v=0,S=0;if(f===D3){c<0&&(c=0);const x=c/Kue;switch(g){case"top-right":case"top-left":S=x-7;break;case"bottom-right":case"bottom-left":S=7-x;break;case"bottom":S=7-c;break;case"top":S=c-7}switch(g){case"top-right":case"bottom-right":v=-x;break;case"top-left":case"bottom-left":v=x;break;case"left":v=c;break;case"right":v=-c}}else{switch(c=Math.abs(c),f=Math.abs(f),g){case"top-right":case"top-left":case"top":S=f-7;break;case"bottom-right":case"bottom-left":case"bottom":S=7-f}switch(g){case"top-right":case"bottom-right":case"right":v=-c;break;case"top-left":case"bottom-left":case"left":v=c}}return[v,S]}function B3(g){switch(g){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Jue(g,c,f,v,S,x,A,D,U,H,R,N,G,z,V){let X=x.textMaxSize.evaluate(c,{},N);X===void 0&&(X=A);const K=g.layers[0].layout,ee=K.get("icon-offset").evaluate(c,{},N),ce=W7(f.horizontal)||f.vertical,he=G.name==="globe",ne=Fa,de=A/ne,ge=g.tilePixelRatio*X/ne,Me=(ut=g.overscaling,g.zoom>18&&ut>2&&(ut>>=1),Math.max(yn/(512*ut),1)*K.get("symbol-spacing")),Be=K.get("text-padding")*g.tilePixelRatio,Oe=K.get("icon-padding")*g.tilePixelRatio,Ie=sn(K.get("text-max-angle")),Ye=K.get("text-rotation-alignment")==="map"&&K.get("symbol-placement")!=="point",ze=K.get("icon-rotation-alignment")==="map"&&K.get("symbol-placement")!=="point",Qe=K.get("symbol-placement"),lt=Me/2;var ut;const ht=K.get("icon-text-fit").evaluate(c,{},N),mt=K.get("icon-text-fit-padding").evaluate(c,{},N),Et=ht!=="none";let vt;g.hasAnyIconTextFit===!1&&Et&&(g.hasAnyIconTextFit=!0),v&&Et&&(g.allowVerticalPlacement&&f.vertical&&(vt=R7(v,f.vertical,ht,mt,ee,de)),ce&&(v=R7(v,ce,ht,mt,ee,de)));const Ut=(Yt,Dt,Rn)=>{if(Dt.x<0||Dt.x>=yn||Dt.y<0||Dt.y>=yn)return;let bn=null;if(he){const{x:dn,y:tn,z:nr}=G.projectTilePoint(Dt.x,Dt.y,Rn);bn={anchor:new im(dn,tn,nr,0,void 0),up:G.upVector(Rn,Dt.x,Dt.y)}}(function(dn,tn,nr,In,Nn,wr,Or,Pr,Lr,jr,Wr,zi,Ai,Tr,gi,xi,rs,Hs,fo,js,Bs,ca,wo,Na,Ki,dc,xf){const rh=dn.addToLineVertexArray(tn,In);let ih,h_,t0,f_,l2,fG,dG,pG=0,mG=0,gG=0,vG=0,c4=-1,u4=-1;const Fd={};let _G=Xo("");const d_=nr?nr.anchor:tn,h4=Lr.layout.get("icon-text-fit").evaluate(Bs,{},Ki)!=="none";let f4=0,d4=0;if(Lr._unevaluatedLayout.getValue("text-radial-offset")===void 0?[f4,d4]=Lr.layout.get("text-offset").evaluate(Bs,{},Ki).map($c=>$c*Fa):(f4=Lr.layout.get("text-radial-offset").evaluate(Bs,{},Ki)*Fa,d4=D3),dn.allowVerticalPlacement&&Nn.vertical){const $c=Nn.vertical;if(gi)fG=k3($c),Pr&&(dG=k3(Pr));else{const qc=Lr.layout.get("text-rotate").evaluate(Bs,{},Ki)+90;t0=PM(jr,d_,tn,Wr,zi,Ai,$c,Tr,qc,xi),Pr&&(f_=PM(jr,d_,tn,Wr,zi,Ai,Pr,Hs,qc))}}if(wr){const $c=Lr.layout.get("icon-rotate").evaluate(Bs,{},Ki),qc=V7(wr,$c,wo,h4),Kx=Pr?V7(Pr,$c,wo,h4):void 0;h_=PM(jr,d_,tn,Wr,zi,Ai,wr,Hs,$c),pG=4*qc.length;const yG=dn.iconSizeData;let p_=null;yG.kind==="source"?(p_=[mf*Lr.layout.get("icon-size").evaluate(Bs,{},Ki)],p_[0]>Kg&&Lt(`${dn.layerIds[0]}: Value for "icon-size" is >= ${Ww}. Reduce your "icon-size".`)):yG.kind==="composite"&&(p_=[mf*ca.compositeIconSizes[0].evaluate(Bs,{},Ki),mf*ca.compositeIconSizes[1].evaluate(Bs,{},Ki)],(p_[0]>Kg||p_[1]>Kg)&&Lt(`${dn.layerIds[0]}: Value for "icon-size" is >= ${Ww}. Reduce your "icon-size".`)),dn.addSymbols(dn.icon,qc,p_,js,fo,Bs,!1,nr,tn,rh.lineStartIndex,rh.lineLength,-1,Na,Ki,dc,xf),c4=dn.icon.placedSymbolArray.length-1,Kx&&(mG=4*Kx.length,dn.addSymbols(dn.icon,Kx,p_,js,fo,Bs,Su.vertical,nr,tn,rh.lineStartIndex,rh.lineLength,-1,Na,Ki,dc,xf),u4=dn.icon.placedSymbolArray.length-1)}for(const $c in Nn.horizontal){const qc=Nn.horizontal[$c];ih||(_G=Xo(qc.text),gi?l2=k3(qc):ih=PM(jr,d_,tn,Wr,zi,Ai,qc,Tr,Lr.layout.get("text-rotate").evaluate(Bs,{},Ki),xi));const Kx=qc.positionedLines.length===1;if(gG+=j7(dn,nr,tn,qc,Or,Lr,gi,Bs,xi,rh,Nn.vertical?Su.horizontal:Su.horizontalOnly,Kx?Object.keys(Nn.horizontal):[$c],Fd,c4,ca,Na,Ki,dc),Kx)break}Nn.vertical&&(vG+=j7(dn,nr,tn,Nn.vertical,Or,Lr,gi,Bs,xi,rh,Su.vertical,["vertical"],Fd,u4,ca,Na,Ki,dc));let n0=-1;const p4=($c,qc)=>$c?Math.max($c,qc):qc;n0=p4(l2,n0),n0=p4(fG,n0),n0=p4(dG,n0);const dfe=n0>-1?1:0;dn.glyphOffsetArray.length>=65535&&Lt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Bs.sortKey!==void 0&&dn.addToSortKeyRanges(dn.symbolInstances.length,Bs.sortKey),dn.symbolInstances.emplaceBack(tn.x,tn.y,d_.x,d_.y,d_.z,Fd.right>=0?Fd.right:-1,Fd.center>=0?Fd.center:-1,Fd.left>=0?Fd.left:-1,Fd.vertical>=0?Fd.vertical:-1,c4,u4,_G,ih!==void 0?ih:dn.collisionBoxArray.length,ih!==void 0?ih+1:dn.collisionBoxArray.length,t0!==void 0?t0:dn.collisionBoxArray.length,t0!==void 0?t0+1:dn.collisionBoxArray.length,h_!==void 0?h_:dn.collisionBoxArray.length,h_!==void 0?h_+1:dn.collisionBoxArray.length,f_||dn.collisionBoxArray.length,f_?f_+1:dn.collisionBoxArray.length,Wr,gG,vG,pG,mG,dfe,0,f4,d4,n0,0,h4?1:0)})(g,Dt,bn,Yt,f,v,S,vt,g.layers[0],g.collisionBoxArray,c.index,c.sourceLayerIndex,g.index,Be,Ye,U,0,Oe,ze,ee,c,x,H,R,N,z,V)};if(Qe==="line")for(const Yt of O7(c.geometry,0,0,yn,yn)){const Dt=$ue(Yt,Me,Ie,f.vertical||ce,v,ne,ge,g.overscaling,yn);for(const Rn of Dt)ce&&Que(g,ce.text,lt,Rn)||Ut(Yt,Rn,N)}else if(Qe==="line-center"){for(const Yt of c.geometry)if(Yt.length>1){const Dt=Xue(Yt,Ie,f.vertical||ce,v,ne,ge);Dt&&Ut(Yt,Dt,N)}}else if(c.type==="Polygon")for(const Yt of _M(c.geometry,0)){const Dt=Zue(Yt,16);Ut(Yt[0],new im(Dt.x,Dt.y,0,0,void 0),N)}else if(c.type==="LineString")for(const Yt of c.geometry)Ut(Yt,new im(Yt[0].x,Yt[0].y,0,0,void 0),N);else if(c.type==="Point")for(const Yt of c.geometry)for(const Dt of Yt)Ut([Dt],new im(Dt.x,Dt.y,0,0,void 0),N)}const Ww=255,Kg=Ww*mf;function j7(g,c,f,v,S,x,A,D,U,H,R,N,G,z,V,X,K,ee){const ce=function(de,ge,Me,Be,Oe,Ie,Ye,ze){const Qe=[];if(ge.positionedLines.length===0)return Qe;const lt=Be.layout.get("text-rotate").evaluate(Ie,{})*Math.PI/180,ut=function(Ut){const Yt=Ut[0],Dt=Ut[1],Rn=Yt*Dt;return Rn>0?[Yt,-Dt]:Rn<0?[-Yt,Dt]:Yt===0?[Dt,Yt]:[Dt,-Yt]}(Me);let ht=Math.abs(ge.top-ge.bottom);for(const Ut of ge.positionedLines)ht-=Ut.lineOffset;const mt=ge.positionedLines.length,Et=ht/mt;let vt=ge.top-Me[1];for(let Ut=0;Ut<mt;++Ut){const Yt=ge.positionedLines[Ut];vt=que(ge,Et,vt,Ut);for(const Dt of Yt.positionedGlyphs){if(!Dt.rect)continue;const Rn=Dt.rect||{};let bn=A7+1,dn=!0,tn=1,nr=0;if(Dt.imageName){const js=Ye[Dt.imageName];if(!js)continue;if(js.sdf){Lt("SDF images are not supported in formatted text and will be ignored.");continue}dn=!1,tn=js.pixelRatio,bn=Hw/tn}const In=(Oe||ze)&&Dt.vertical,Nn=Dt.metrics.advance*Dt.scale/2,wr=Dt.metrics,Or=Dt.rect;if(Or===null)continue;ze&&ge.verticalizable&&(nr=Dt.imageName?Nn-Dt.metrics.width*Dt.scale/2:0);const Pr=Oe?[Dt.x+Nn,Dt.y]:[0,0];let Lr=[0,0],jr=[0,0],Wr=!1;Oe||(In?(jr=[Dt.x+Nn+ut[0],Dt.y+ut[1]-nr],Wr=!0):Lr=[Dt.x+Nn+Me[0],Dt.y+Me[1]-nr]);const zi=Or.w*Dt.scale/(tn*(Dt.localGlyph?gf:1)),Ai=Or.h*Dt.scale/(tn*(Dt.localGlyph?gf:1));let Tr,gi,xi,rs;if(In){const js=Dt.y-vt,Bs=new St(-Nn,Nn-js),ca=-Math.PI/2,wo=new St(...jr);Tr=new St(-Nn+Lr[0],Lr[1]),Tr._rotateAround(ca,Bs)._add(wo),Tr.x+=-js+Nn,Tr.y-=(wr.left-bn)*Dt.scale;const Na=Dt.imageName?wr.advance*Dt.scale:Fa*Dt.scale,Ki=String.fromCodePoint(Dt.glyph);Fue(Ki)?Tr.x+=(1-bn)*Dt.scale:Nue(Ki)?Tr.x+=Na-wr.height*Dt.scale+(-bn-1)*Dt.scale:Tr.x+=Dt.imageName||wr.width+2*bn===Or.w&&wr.height+2*bn===Or.h?(Na-Ai)/2:(Na-(wr.height+2*bn)*Dt.scale)/2,gi=new St(Tr.x,Tr.y-zi),xi=new St(Tr.x+Ai,Tr.y),rs=new St(Tr.x+Ai,Tr.y-zi)}else{const js=(wr.left-bn)*Dt.scale-Nn+Lr[0],Bs=(-wr.top-bn)*Dt.scale+Lr[1],ca=js+zi,wo=Bs+Ai;Tr=new St(js,Bs),gi=new St(ca,Bs),xi=new St(js,wo),rs=new St(ca,wo)}if(lt){let js;js=Oe?new St(0,0):Wr?new St(ut[0],ut[1]):new St(Me[0],Me[1]),Tr._rotateAround(lt,js),gi._rotateAround(lt,js),xi._rotateAround(lt,js),rs._rotateAround(lt,js)}const Hs=new St(0,0),fo=new St(0,0);Qe.push({tl:Tr,tr:gi,bl:xi,br:rs,texPrimary:Rn,texSecondary:void 0,writingMode:ge.writingMode,glyphOffset:Pr,sectionIndex:Dt.sectionIndex,isSDF:dn,pixelOffsetTL:Hs,pixelOffsetBR:fo,minFontScaleX:0,minFontScaleY:0})}}return Qe}(0,v,U,x,A,D,S,g.allowVerticalPlacement),he=g.textSizeData;let ne=null;he.kind==="source"?(ne=[mf*x.layout.get("text-size").evaluate(D,{},K)],ne[0]>Kg&&Lt(`${g.layerIds[0]}: Value for "text-size" is >= ${Ww}. Reduce your "text-size".`)):he.kind==="composite"&&(ne=[mf*V.compositeTextSizes[0].evaluate(D,{},K),mf*V.compositeTextSizes[1].evaluate(D,{},K)],(ne[0]>Kg||ne[1]>Kg)&&Lt(`${g.layerIds[0]}: Value for "text-size" is >= ${Ww}. Reduce your "text-size".`)),g.addSymbols(g.text,ce,ne,U,A,D,R,c,f,H.lineStartIndex,H.lineLength,z,X,K,ee,!1);for(const de of N)G[de]=g.text.placedSymbolArray.length-1;return 4*ce.length}function W7(g){for(const c in g)return g[c];return null}function PM(g,c,f,v,S,x,A,D,U,H){let R=A.top,N=A.bottom,G=A.left,z=A.right;const V=A.collisionPadding;if(V&&(G-=V[0],R-=V[1],z+=V[2],N+=V[3]),U){const X=new St(G,R),K=new St(z,R),ee=new St(G,N),ce=new St(z,N),he=sn(U);let ne=new St(0,0);H&&(ne=new St(H[0],H[1])),X._rotateAround(he,ne),K._rotateAround(he,ne),ee._rotateAround(he,ne),ce._rotateAround(he,ne),G=Math.min(X.x,K.x,ee.x,ce.x),z=Math.max(X.x,K.x,ee.x,ce.x),R=Math.min(X.y,K.y,ee.y,ce.y),N=Math.max(X.y,K.y,ee.y,ce.y)}return g.emplaceBack(c.x,c.y,c.z,f.x,f.y,G,R,z,N,D,v,S,x),g.length-1}function k3(g){g.collisionPadding&&(g.top-=g.collisionPadding[1],g.bottom+=g.collisionPadding[3]);const c=g.bottom-g.top;return c>0?Math.max(10,c):null}function Que(g,c,f,v){const S=g.compareText;if(c in S){const x=S[c];for(let A=x.length-1;A>=0;A--)if(v.dist(x[A])<f)return!0}else S[c]=[];return S[c].push(v),!1}function X7(g,c){const f=g.fovAboveCenter,v=g.elevation?g.elevation.getMinElevationBelowMSL()*c:0,S=(g._camera.position[2]*g.worldSize-v)/Math.cos(g._pitch),x=Math.sin(f)*S/Math.sin(Math.max(Math.PI/2-g._pitch-f,.01));let A=Math.sin(g._pitch)*x+S;const D=S*(1/g._horizonShift);return g.elevation&&g.elevation.exaggeration()!==0||(A*=1+Math.max(g.zoom-17,0)),Math.min(1.01*A,D)}function Xw(g,c){if(!c.isReprojectedInTileSpace)return{scale:1<<g.z,x:g.x,y:g.y,x2:g.x+1,y2:g.y+1,projection:c};const f=Math.pow(2,-g.z),v=g.x*f,S=(g.x+1)*f,x=g.y*f,A=(g.y+1)*f,D=je(v),U=je(S),H=Ge(x),R=Ge(A),N=c.project(D,H),G=c.project(U,H),z=c.project(U,R),V=c.project(D,R);let X=Math.min(N.x,G.x,z.x,V.x),K=Math.min(N.y,G.y,z.y,V.y),ee=Math.max(N.x,G.x,z.x,V.x),ce=Math.max(N.y,G.y,z.y,V.y);const he=f/16;function ne(ge,Me,Be,Oe,Ie,Ye){const ze=(Be+Ie)/2,Qe=(Oe+Ye)/2,lt=c.project(je(ze),Ge(Qe)),ut=Math.max(0,X-lt.x,K-lt.y,lt.x-ee,lt.y-ce);X=Math.min(X,lt.x),ee=Math.max(ee,lt.x),K=Math.min(K,lt.y),ce=Math.max(ce,lt.y),ut>he&&(ne(ge,lt,Be,Oe,ze,Qe),ne(lt,Me,ze,Qe,Ie,Ye))}ne(N,G,v,x,S,x),ne(G,z,S,x,S,A),ne(z,V,S,A,v,A),ne(V,N,v,A,v,x),X-=he,K-=he,ee+=he,ce+=he;const de=1/Math.max(ee-X,ce-K);return{scale:de,x:X*de,y:K*de,x2:ee*de,y2:ce*de,projection:c}}function $7(g,{x:c,y:f},v=0){return new St(((c-v)*g.scale-g.x)*yn,(f*g.scale-g.y)*yn)}const ehe=Pe.mat4.identity(new Float32Array(16));class Jg{constructor(c){this.spec=c,this.name=c.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(c,f){return{x:0,y:0,z:0}}unproject(c,f){return new ue(0,0)}projectTilePoint(c,f,v){return{x:c,y:f,z:0}}locationPoint(c,f,v=!0){return c._coordinatePoint(c.locationCoordinate(f),v)}pixelsPerMeter(c,f){return De(1,c)*f}pixelSpaceConversion(c,f,v){return 1}farthestPixelDistance(c){return X7(c,c.pixelsPerMeter)}pointCoordinate(c,f,v,S){const x=c.horizonLineFromTop(!1),A=new St(f,Math.max(x,v));return c.rayIntersectionCoordinate(c.pointRayIntersection(A,S))}pointCoordinate3D(c,f,v){const S=new St(f,v);if(c.elevation)return c.elevation.pointCoordinate(S);{const x=this.pointCoordinate(c,S.x,S.y,0);return[x.x,x.y,x.z]}}isPointAboveHorizon(c,f){if(c.elevation&&c.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(c,f.x,f.y);const v=c.horizonLineFromTop();return f.y<v}createInversionMatrix(c,f){return ehe}createTileMatrix(c,f,v){let S,x,A;const D=v.canonical,U=Pe.mat4.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const H=Xw(D,this);S=1,x=H.x+v.wrap*H.scale,A=H.y,Pe.mat4.scale(U,U,[S/H.scale,S/H.scale,c.pixelsPerMeter/f])}else S=f/c.zoomScale(D.z),x=(D.x+Math.pow(2,D.z)*v.wrap)*S,A=D.y*S;return Pe.mat4.translate(U,U,[x,A,0]),Pe.mat4.scale(U,U,[S/yn,S/yn,1]),U}upVector(c,f,v){return[0,0,1]}upVectorScale(c,f,v){return{metersToTile:1}}}class the extends Jg{constructor(c){super(c),this.range=[4,7],this.center=c.center||[-96,37.5];const[f,v]=this.parallels=c.parallels||[29.5,45.5],S=Math.sin(sn(f));this.n=(S+Math.sin(sn(v)))/2,this.c=1+S*(2*this.n-S),this.r0=Math.sqrt(this.c)/this.n}project(c,f){const{n:v,c:S,r0:x}=this,A=sn(c-this.center[0]),D=sn(f),U=Math.sqrt(S-2*v*Math.sin(D))/v;return{x:U*Math.sin(A*v),y:U*Math.cos(A*v)-x,z:0}}unproject(c,f){const{n:v,c:S,r0:x}=this,A=x+f;let D=Math.atan2(c,Math.abs(A))*Math.sign(A);A*v<0&&(D-=Math.PI*Math.sign(c)*Math.sign(A));const U=sn(this.center[0])*v;D=Un(D,-Math.PI-U,Math.PI-U);const H=jt(ot(D/v)+this.center[0],-180,180),R=Math.asin(jt((S-(c*c+A*A)*v*v)/(2*v),-1,1)),N=jt(ot(R),-Ke,Ke);return new ue(H,N)}}const $w=1.340264,qw=-.081106,Zw=893e-6,Yw=.003796,LM=Math.sqrt(3)/2;class nhe extends Jg{project(c,f){f=f/180*Math.PI,c=c/180*Math.PI;const v=Math.asin(LM*Math.sin(f)),S=v*v,x=S*S*S;return{x:.5*(c*Math.cos(v)/(LM*($w+3*qw*S+x*(7*Zw+9*Yw*S)))/Math.PI+.5),y:1-.5*(v*($w+qw*S+x*(Zw+Yw*S))/Math.PI+1),z:0}}unproject(c,f){c=(2*c-.5)*Math.PI;let v=f=(2*(1-f)-1)*Math.PI,S=v*v,x=S*S*S;for(let R,N,G,z=0;z<12&&(N=v*($w+qw*S+x*(Zw+Yw*S))-f,G=$w+3*qw*S+x*(7*Zw+9*Yw*S),R=N/G,v=jt(v-R,-Math.PI/3,Math.PI/3),S=v*v,x=S*S*S,!(Math.abs(R)<1e-12));++z);const A=LM*c*($w+3*qw*S+x*(7*Zw+9*Yw*S))/Math.cos(v),D=Math.asin(Math.sin(v)/LM),U=jt(180*A/Math.PI,-180,180),H=jt(180*D/Math.PI,-Ke,Ke);return new ue(U,H)}}class rhe extends Jg{constructor(c){super(c),this.wrap=!0,this.supportsWorldCopies=!0}project(c,f){return{x:.5+c/360,y:.5-f/360,z:0}}unproject(c,f){const v=360*(c-.5),S=jt(360*(.5-f),-Ke,Ke);return new ue(v,S)}}const jx=Math.PI/2;function DM(g){return Math.tan((jx+g)/2)}class ihe extends Jg{constructor(c){super(c),this.center=c.center||[0,30];const[f,v]=this.parallels=c.parallels||[30,30];let S=sn(f),x=sn(v);this.southernCenter=S+x<0,this.southernCenter&&(S=-S,x=-x);const A=Math.cos(S),D=DM(S);this.n=S===x?Math.sin(S):Math.log(A/Math.cos(x))/Math.log(DM(x)/D),this.f=A*Math.pow(DM(S),this.n)/this.n}project(c,f){f=sn(f),this.southernCenter&&(f=-f),c=sn(c-this.center[0]);const v=1e-6,{n:S,f:x}=this;x>0?f<-jx+v&&(f=-jx+v):f>jx-v&&(f=jx-v);const A=x/Math.pow(DM(f),S);let D=A*Math.sin(S*c),U=x-A*Math.cos(S*c);return D=.5*(D/Math.PI+.5),U=.5*(U/Math.PI+.5),{x:D,y:this.southernCenter?U:1-U,z:0}}unproject(c,f){c=(2*c-.5)*Math.PI,this.southernCenter&&(f=1-f),f=(2*(1-f)-.5)*Math.PI;const{n:v,f:S}=this,x=S-f,A=Math.sign(x),D=Math.sign(v)*Math.sqrt(c*c+x*x);let U=Math.atan2(c,Math.abs(x))*A;x*v<0&&(U-=Math.PI*Math.sign(c)*A);const H=jt(ot(U/v)+this.center[0],-180,180),R=jt(ot(2*Math.atan(Math.pow(S/D,1/v))-jx),-Ke,Ke);return new ue(H,this.southernCenter?-R:R)}}class q7 extends Jg{constructor(c){super(c),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(c,f){return{x:ke(c),y:Ne(f),z:0}}unproject(c,f){const v=je(c),S=Ge(f);return new ue(v,S)}}const Z7=sn(Ke);class she extends Jg{project(c,f){const v=(f=sn(f))*f,S=v*v;return{x:.5*((c=sn(c))*(.8707-.131979*v+S*(S*(.003971*v-.001529*S)-.013791))/Math.PI+.5),y:1-.5*(f*(1.007226+v*(.015085+S*(.028874*v-.044475-.005916*S)))/Math.PI+1),z:0}}unproject(c,f){c=(2*c-.5)*Math.PI;let v=f=(2*(1-f)-1)*Math.PI,S=25,x=0,A=v*v;do{A=v*v;const H=A*A;x=(v*(1.007226+A*(.015085+H*(.028874*A-.044475-.005916*H)))-f)/(1.007226+A*(.045255+H*(.259866*A-.311325-.005916*11*H))),v=jt(v-x,-Z7,Z7)}while(Math.abs(x)>1e-6&&--S>0);A=v*v;const D=jt(ot(c/(.8707+A*(A*(A*A*A*(.003971-.001529*A)-.013791)-.131979))),-180,180),U=ot(v);return new ue(D,U)}}const Y7=sn(Ke);class ohe extends Jg{project(c,f){f=sn(f),c=sn(c);const v=Math.cos(f),S=2/Math.PI,x=Math.acos(v*Math.cos(c/2)),A=Math.sin(x)/x,D=.5*(c*S+2*v*Math.sin(c/2)/A)||0,U=.5*(f+Math.sin(f)/A)||0;return{x:.5*(D/Math.PI+.5),y:1-.5*(U/Math.PI+1),z:0}}unproject(c,f){let v=c=(2*c-.5)*Math.PI,S=f=(2*(1-f)-1)*Math.PI,x=25;const A=1e-6;let D=0,U=0;do{const H=Math.cos(S),R=Math.sin(S),N=2*R*H,G=R*R,z=H*H,V=Math.cos(v/2),X=Math.sin(v/2),K=2*V*X,ee=X*X,ce=1-z*V*V,he=ce?1/ce:0,ne=ce?Math.acos(H*V)*Math.sqrt(1/ce):0,de=.5*(2*ne*H*X+2*v/Math.PI)-c,ge=.5*(ne*R+S)-f,Me=.5*he*(z*ee+ne*H*V*G)+1/Math.PI,Be=he*(K*N/4-ne*R*X),Oe=.125*he*(N*X-ne*R*z*K),Ie=.5*he*(G*V+ne*ee*H)+.5,Ye=Be*Oe-Ie*Me;D=(ge*Be-de*Ie)/Ye,U=(de*Oe-ge*Me)/Ye,v=jt(v-D,-Math.PI,Math.PI),S=jt(S-U,-Y7,Y7)}while((Math.abs(D)>A||Math.abs(U)>A)&&--x>0);return new ue(ot(v),ot(S))}}class K7 extends Jg{constructor(c){super(c),this.center=c.center||[0,0],this.parallels=c.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(sn(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(c,f){const{scale:v,cosPhi:S}=this;return{x:sn(c)*S*v+.5,y:-Math.sin(sn(f))/S*v+.5,z:0}}unproject(c,f){const{scale:v,cosPhi:S}=this,x=-(f-.5)/v,A=jt(ot((c-.5)/v)/S,-180,180),D=Math.asin(jt(x*S,-1,1)),U=jt(ot(D),-Ke,Ke);return new ue(A,U)}}class ahe extends q7{constructor(c){super(c),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(c,f,v){const S=Rw(c,f,v),x=pM(kd(v));return Pe.vec3.transformMat4(S,S,x),{x:S[0],y:S[1],z:S[2]}}locationPoint(c,f){const v=Q(f.lat,f.lng),S=Pe.vec3.normalize([],v),x=c.elevation?c.elevation.getAtPointOrZero(c.locationCoordinate(f),c._centerAltitude):c._centerAltitude,A=De(1,0)*yn*x;Pe.vec3.scaleAndAdd(v,v,S,A);const D=Pe.mat4.identity(new Float64Array(16));return Pe.mat4.multiply(D,c.pixelMatrix,c.globeMatrix),Pe.vec3.transformMat4(v,v,D),new St(v[0],v[1])}pixelsPerMeter(c,f){return De(1,0)*f}pixelSpaceConversion(c,f,v){const S=De(1,c)*f,x=cr(De(1,45)*f,S,v);return this.pixelsPerMeter(c,f)/x}createTileMatrix(c,f,v){const S=s3(kd(v.canonical));return Pe.mat4.multiply(new Float64Array(16),c.globeMatrix,S)}createInversionMatrix(c,f){const{center:v}=c,S=pM(kd(f));return Pe.mat4.rotateY(S,S,sn(v.lng)),Pe.mat4.rotateX(S,S,sn(v.lat)),Pe.mat4.scale(S,S,[c._pixelsPerMercatorPixel,c._pixelsPerMercatorPixel,1]),Float32Array.from(S)}pointCoordinate(c,f,v,S){return hM(c,f,v,!0)||new xt(0,0)}pointCoordinate3D(c,f,v){const S=this.pointCoordinate(c,f,v,0);return[S.x,S.y,S.z]}isPointAboveHorizon(c,f){return!hM(c,f.x,f.y,!1)}farthestPixelDistance(c){const f=function(S,x){const A=S.cameraToCenterDistance,D=S._centerAltitude*x,U=S._camera,H=S._camera.forward(),R=Pe.vec3.add([],Pe.vec3.scale([],H,-A),[0,0,D]),N=S.worldSize/(2*Math.PI),G=[0,0,-N],z=S.width/S.height,V=Math.tan(S.fovAboveCenter),X=Pe.vec3.scale([],U.up(),V),K=Pe.vec3.scale([],U.right(),V*z),ee=Pe.vec3.normalize([],Pe.vec3.add([],Pe.vec3.add([],H,X),K)),ce=[];let he;if(new pf(R,ee).closestPointOnSphere(G,N,ce)){const ne=Pe.vec3.add([],ce,G),de=Pe.vec3.sub([],ne,R);he=Math.cos(S.fovAboveCenter)*Pe.vec3.length(de)}else{const ne=Pe.vec3.sub([],R,G),de=Pe.vec3.sub([],G,R);Pe.vec3.normalize(de,de);const ge=Pe.vec3.length(ne)-N;he=Math.sqrt(ge*(ge+2*N));const Me=Math.acos(he/(N+ge))-Math.acos(Pe.vec3.dot(H,de));he*=Math.cos(Me)}return 1.01*he}(c,this.pixelsPerMeter(c.center.lat,c.worldSize)),v=$g(c.zoom);if(v>0){const S=X7(c,De(1,c.center.lat)*c.worldSize),x=c.worldSize/(2*Math.PI),A=Math.max(c.width,c.height)/c.worldSize*Math.PI;return cr(f,S+x*(1-Math.cos(A)),Math.pow(v,10))}return f}upVector(c,f,v){return Rw(f,v,c,1)}upVectorScale(c){return{metersToTile:nm(dM(kd(c)))}}}function J7(g){const c=g.parallels,f=!!c&&Math.abs(c[0]+c[1])<.01;switch(g.name){case"mercator":return new q7(g);case"equirectangular":return new rhe(g);case"naturalEarth":return new she(g);case"equalEarth":return new nhe(g);case"winkelTripel":return new ohe(g);case"albers":return f?new K7(g):new the(g);case"lambertConformalConic":return f?new K7(g):new ihe(g);case"globe":return new ahe(g)}throw new Error(`Invalid projection name: ${g.name}`)}const lhe=zx.VectorTileFeature.types,che=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function BM(g,c,f,v,S,x,A,D,U,H,R,N,G){const z=D?Math.min(Kg,Math.round(D[0])):0,V=D?Math.min(Kg,Math.round(D[1])):0;g.emplaceBack(c,f,Math.round(32*v),Math.round(32*S),x,A,(z<<1)+(U?1:0),V,16*H,16*R,256*N,256*G)}function kM(g,c,f){g.emplaceBack(c,f)}function OM(g,c,f,v,S,x,A){g.emplaceBack(c,f,v,S,x,A)}function FM(g,c,f,v,S){g.emplaceBack(c,f,v,S),g.emplaceBack(c,f,v,S),g.emplaceBack(c,f,v,S),g.emplaceBack(c,f,v,S)}function uhe(g){for(const c of g.sections)if(Rx(c.text))return!0;return!1}class O3{constructor(c){this.layoutVertexArray=new t_,this.indexArray=new bo,this.programConfigurations=c,this.segments=new xs,this.dynamicLayoutVertexArray=new Il,this.opacityVertexArray=new Fg,this.placedSymbolArray=new Vg,this.iconTransitioningVertexArray=new bu,this.globeExtVertexArray=new Gc,this.zOffsetVertexArray=new Rd}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(c,f,v,S,x){this.isEmpty()||(v&&(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,Cue.members),this.indexBuffer=c.createIndexBuffer(this.indexArray,f),this.dynamicLayoutVertexBuffer=c.createVertexBuffer(this.dynamicLayoutVertexArray,Iue.members,!0),this.opacityVertexBuffer=c.createVertexBuffer(this.opacityVertexArray,che,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=c.createVertexBuffer(this.iconTransitioningVertexArray,Pue.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=c.createVertexBuffer(this.globeExtVertexArray,Eue.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||x)&&(this.zOffsetVertexBuffer=c.createVertexBuffer(this.zOffsetVertexArray,Rue.members,!0)),this.opacityVertexBuffer.itemSize=1),(v||S)&&this.programConfigurations.upload(c))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Fn(O3,"SymbolBuffers");class F3{constructor(c,f,v){this.layoutVertexArray=new c,this.layoutAttributes=f,this.indexArray=new v,this.segments=new xs,this.collisionVertexArray=new ff,this.collisionVertexArrayExt=new Il}upload(c){this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=c.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=c.createVertexBuffer(this.collisionVertexArray,Lue.members,!0),this.collisionVertexBufferExt=c.createVertexBuffer(this.collisionVertexArrayExt,Due.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Fn(F3,"CollisionBuffers");class NM{constructor(c){this.collisionBoxArray=c.collisionBoxArray,this.zoom=c.zoom,this.lut=c.lut,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(A=>A.fqid),this.index=c.index,this.pixelRatio=c.pixelRatio,this.sourceLayerIndex=c.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Pe.mat4.identity([]),this.placementViewportMatrix=Pe.mat4.identity([]);const f=this.layers[0]._unevaluatedLayout._values;this.textSizeData=T3(this.zoom,f["text-size"]),this.iconSizeData=T3(this.zoom,f["icon-size"]);const v=this.layers[0].layout,S=v.get("symbol-sort-key"),x=v.get("symbol-z-order");this.canOverlap=v.get("text-allow-overlap")||v.get("icon-allow-overlap")||v.get("text-ignore-placement")||v.get("icon-ignore-placement"),this.sortFeaturesByKey=x!=="viewport-y"&&S.constantOr(1)!==void 0,this.sortFeaturesByY=(x==="viewport-y"||x==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=v.get("text-writing-mode").map(A=>Su[A]),this.stateDependentLayerIds=this.layers.filter(A=>A.isStateDependent()).map(A=>A.id),this.sourceID=c.sourceID,this.projection=c.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=v.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new O3(new rr(this.layers,{zoom:this.zoom,lut:this.lut},c=>c.startsWith("text")||c.startsWith("symbol"))),this.icon=new O3(new rr(this.layers,{zoom:this.zoom,lut:this.lut},c=>c.startsWith("icon")||c.startsWith("symbol"))),this.glyphOffsetArray=new Gg,this.lineVertexArray=new Hg,this.symbolInstances=new Qa}calculateGlyphDependencies(c,f,v,S,x){for(let A=0;A<c.length;A++){const D=c.codePointAt(A);if(D===void 0)break;if(f[D]=!0,S&&x&&D<=65535){const U=Vw[c.charAt(A)];U&&(f[U.charCodeAt(0)]=!0)}}}updateFootprints(c,f){}updateReplacement(c,f){if(f.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=f.updateTime;const v=f.getReplacementRegionsForTile(c.toUnwrapped(),!0);return!y3(this.activeReplacements,v)&&(this.activeReplacements=v,!0)}populate(c,f,v,S){const x=this.layers[0],A=x.layout,D=this.projection.name==="globe",U=A.get("text-font"),H=A.get("text-field"),R=A.get("icon-image"),N=(H.value.kind!=="constant"||H.value.value instanceof Po&&!H.value.value.isEmpty()||H.value.value.toString().length>0)&&(U.value.kind!=="constant"||U.value.value.length>0),G=R.value.kind!=="constant"||!!R.value.value||Object.keys(R.parameters).length>0,z=A.get("symbol-sort-key");if(this.features=[],!N&&!G)return;const V=f.iconDependencies,X=f.glyphDependencies,K=f.availableImages,ee=new hs(this.zoom);for(const{feature:ce,id:he,index:ne,sourceLayerIndex:de}of c){const ge=x._featureFilter.needGeometry,Me=pn(ce,ge);if(!x._featureFilter.filter(ee,Me,v))continue;if(ge||(Me.geometry=fn(ce,v,S)),D&&ce.type!==1&&v.z<=5){const Ye=Me.geometry,ze=.98078528056,Qe=(lt,ut)=>{const ht=Rw(lt.x,lt.y,v,1),mt=Rw(ut.x,ut.y,v,1);return Pe.vec3.dot(ht,mt)<ze};for(let lt=0;lt<Ye.length;lt++)Ye[lt]=hn(Ye[lt],Qe)}let Be,Oe;if(N){const Ye=x.getValueAndResolveTokens("text-field",Me,v,K),ze=Po.factory(Ye);uhe(ze)&&(this.hasRTLText=!0),(!this.hasRTLText||Dg()==="unavailable"||this.hasRTLText&&Oa.isParsed())&&(Be=Oue(ze,x,Me))}if(G){const Ye=x.getValueAndResolveTokens("icon-image",Me,v,K);Oe=Ye instanceof $o?Ye:$o.fromString(Ye)}if(!Be&&!Oe)continue;const Ie=this.sortFeaturesByKey?z.evaluate(Me,{},v):void 0;if(this.features.push({id:he,text:Be,icon:Oe,index:ne,sourceLayerIndex:de,geometry:Me.geometry,properties:ce.properties,type:lhe[ce.type],sortKey:Ie}),Oe&&(V[Oe.namePrimary]=!0,Oe.nameSecondary&&(V[Oe.nameSecondary]=!0)),Be){const Ye=U.evaluate(Me,{},v).join(","),ze=A.get("text-rotation-alignment")==="map"&&A.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Su.vertical)>=0;for(const Qe of Be.sections)if(Qe.image)V[Qe.image.namePrimary]=!0;else{const lt=Uc(Be.toString()),ut=Qe.fontStack||Ye,ht=X[ut]=X[ut]||{};this.calculateGlyphDependencies(Qe.text,ht,ze,this.allowVerticalPlacement,lt)}}}A.get("symbol-placement")==="line"&&(this.features=function(ce){const he={},ne={},de=[];let ge=0;function Me(Ye){de.push(ce[Ye]),ge++}function Be(Ye,ze,Qe){const lt=ne[Ye];return delete ne[Ye],ne[ze]=lt,de[lt].geometry[0].pop(),de[lt].geometry[0]=de[lt].geometry[0].concat(Qe[0]),lt}function Oe(Ye,ze,Qe){const lt=he[ze];return delete he[ze],he[Ye]=lt,de[lt].geometry[0].shift(),de[lt].geometry[0]=Qe[0].concat(de[lt].geometry[0]),lt}function Ie(Ye,ze,Qe){const lt=Qe?ze[0][ze[0].length-1]:ze[0][0];return`${Ye}:${lt.x}:${lt.y}`}for(let Ye=0;Ye<ce.length;Ye++){const ze=ce[Ye],Qe=ze.geometry,lt=ze.text?ze.text.toString():null;if(!lt){Me(Ye);continue}const ut=Ie(lt,Qe),ht=Ie(lt,Qe,!0);if(ut in ne&&ht in he&&ne[ut]!==he[ht]){const mt=Oe(ut,ht,Qe),Et=Be(ut,ht,de[mt].geometry);delete he[ut],delete ne[ht],ne[Ie(lt,de[Et].geometry,!0)]=Et,de[mt].geometry=null}else ut in ne?Be(ut,ht,Qe):ht in he?Oe(ut,ht,Qe):(Me(Ye),he[ut]=ge-1,ne[ht]=ge-1)}return de.filter(Ye=>Ye.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ce,he)=>ce.sortKey-he.sortKey)}update(c,f,v,S,x){const A=Object.keys(c).length!==0;if(A&&!this.stateDependentLayers.length)return;const D=A?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(c,f,D,v,S,x),this.icon.programConfigurations.updatePaintArrays(c,f,D,v,S,x)}updateZOffset(){const c=(x,A,D)=>{v+=A,v>x.length&&x.resize(v);for(let U=-A;U<0;U++)x.emplace(U+v,D)},f=(x,A,D)=>{S+=A,S>x.length&&x.resize(S);for(let U=-A;U<0;U++)x.emplace(U+S,D)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let v=0,S=0;for(let x=0;x<this.symbolInstances.length;x++){const A=this.symbolInstances.get(x),{numHorizontalGlyphVertices:D,numVerticalGlyphVertices:U,numIconVertices:H}=A,R=A.zOffset,N=H>0;if((D>0||U>0)&&(c(this.text.zOffsetVertexArray,D,R),c(this.text.zOffsetVertexArray,U,R)),N){const{placedIconSymbolIndex:G,verticalPlacedIconSymbolIndex:z}=A;G>=0&&f(this.icon.zOffsetVertexArray,H,R),z>=0&&f(this.icon.zOffsetVertexArray,A.numVerticalIconVertices,R)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(c){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(c),this.iconCollisionBox.upload(c)),this.text.upload(c,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(c,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=J7(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(c,f){const v=this.lineVertexArray.length;if(c.segment!==void 0)for(const{x:S,y:x}of f)this.lineVertexArray.emplaceBack(S,x);return{lineStartIndex:v,lineLength:this.lineVertexArray.length-v}}addSymbols(c,f,v,S,x,A,D,U,H,R,N,G,z,V,X,K){const ee=c.indexArray,ce=c.layoutVertexArray,he=c.globeExtVertexArray,ne=c.segments.prepareSegment(4*f.length,ce,ee,this.canOverlap?A.sortKey:void 0),de=this.glyphOffsetArray.length,ge=ne.vertexLength,Me=this.allowVerticalPlacement&&D===Su.vertical?Math.PI/2:0,Be=A.text&&A.text.sections;for(let Ie=0;Ie<f.length;Ie++){const{tl:Ye,tr:ze,bl:Qe,br:lt,texPrimary:ut,texSecondary:ht,pixelOffsetTL:mt,pixelOffsetBR:Et,minFontScaleX:vt,minFontScaleY:Ut,glyphOffset:Yt,isSDF:Dt,sectionIndex:Rn}=f[Ie],bn=ne.vertexLength,dn=Yt[1];if(BM(ce,H.x,H.y,Ye.x,dn+Ye.y,ut.x,ut.y,v,Dt,mt.x,mt.y,vt,Ut),BM(ce,H.x,H.y,ze.x,dn+ze.y,ut.x+ut.w,ut.y,v,Dt,Et.x,mt.y,vt,Ut),BM(ce,H.x,H.y,Qe.x,dn+Qe.y,ut.x,ut.y+ut.h,v,Dt,mt.x,Et.y,vt,Ut),BM(ce,H.x,H.y,lt.x,dn+lt.y,ut.x+ut.w,ut.y+ut.h,v,Dt,Et.x,Et.y,vt,Ut),U){const{x:tn,y:nr,z:In}=U.anchor,[Nn,wr,Or]=U.up;OM(he,tn,nr,In,Nn,wr,Or),OM(he,tn,nr,In,Nn,wr,Or),OM(he,tn,nr,In,Nn,wr,Or),OM(he,tn,nr,In,Nn,wr,Or),FM(c.dynamicLayoutVertexArray,tn,nr,In,Me)}else FM(c.dynamicLayoutVertexArray,H.x,H.y,H.z,Me);if(K){const tn=ht||ut;kM(c.iconTransitioningVertexArray,tn.x,tn.y),kM(c.iconTransitioningVertexArray,tn.x+tn.w,tn.y),kM(c.iconTransitioningVertexArray,tn.x,tn.y+tn.h),kM(c.iconTransitioningVertexArray,tn.x+tn.w,tn.y+tn.h)}ee.emplaceBack(bn,bn+1,bn+2),ee.emplaceBack(bn+1,bn+2,bn+3),ne.vertexLength+=4,ne.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Yt[0]),Ie!==f.length-1&&Rn===f[Ie+1].sectionIndex||c.programConfigurations.populatePaintArrays(ce.length,A,A.index,{},z,V,X,Be&&Be[Rn])}const Oe=U?U.anchor:H;c.placedSymbolArray.emplaceBack(Oe.x,Oe.y,Oe.z,H.x,H.y,de,this.glyphOffsetArray.length-de,ge,R,N,H.segment,v?v[0]:0,v?v[1]:0,S[0],S[1],D,0,!1,0,G,0)}_commitLayoutVertex(c,f,v,S,x,A,D){c.emplaceBack(f,v,S,x,A,Math.round(D.x),Math.round(D.y))}_addCollisionDebugVertices(c,f,v,S,x,A,D){const U=v.segments.prepareSegment(4,v.layoutVertexArray,v.indexArray),H=U.vertexLength,R=D.tileAnchorX,N=D.tileAnchorY;for(let z=0;z<4;z++)v.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(v.collisionVertexArrayExt,f,c.padding,D.zOffset),this._commitLayoutVertex(v.layoutVertexArray,S,x,A,R,N,new St(c.x1,c.y1)),this._commitLayoutVertex(v.layoutVertexArray,S,x,A,R,N,new St(c.x2,c.y1)),this._commitLayoutVertex(v.layoutVertexArray,S,x,A,R,N,new St(c.x2,c.y2)),this._commitLayoutVertex(v.layoutVertexArray,S,x,A,R,N,new St(c.x1,c.y2)),U.vertexLength+=4;const G=v.indexArray;G.emplaceBack(H,H+1),G.emplaceBack(H+1,H+2),G.emplaceBack(H+2,H+3),G.emplaceBack(H+3,H),U.primitiveLength+=4}_addTextDebugCollisionBoxes(c,f,v,S,x,A){for(let D=S;D<x;D++){const U=v.get(D),H=this.getSymbolInstanceTextSize(c,A,f,D);this._addCollisionDebugVertices(U,H,this.textCollisionBox,U.projectedAnchorX,U.projectedAnchorY,U.projectedAnchorZ,A)}}_addIconDebugCollisionBoxes(c,f,v,S,x,A){for(let D=S;D<x;D++){const U=v.get(D),H=this.getSymbolInstanceIconSize(c,f,A.placedIconSymbolIndex);this._addCollisionDebugVertices(U,H,this.iconCollisionBox,U.projectedAnchorX,U.projectedAnchorY,U.projectedAnchorZ,A)}}generateCollisionDebugBuffers(c,f){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new F3(fl,x7.members,bu),this.iconCollisionBox=new F3(fl,x7.members,bu);const v=Ux(this.iconSizeData,c),S=Ux(this.textSizeData,c);for(let x=0;x<this.symbolInstances.length;x++){const A=this.symbolInstances.get(x);this._addTextDebugCollisionBoxes(S,c,f,A.textBoxStartIndex,A.textBoxEndIndex,A),this._addTextDebugCollisionBoxes(S,c,f,A.verticalTextBoxStartIndex,A.verticalTextBoxEndIndex,A),this._addIconDebugCollisionBoxes(v,c,f,A.iconBoxStartIndex,A.iconBoxEndIndex,A),this._addIconDebugCollisionBoxes(v,c,f,A.verticalIconBoxStartIndex,A.verticalIconBoxEndIndex,A)}}getSymbolInstanceTextSize(c,f,v,S){const x=this.text.placedSymbolArray.get(f.rightJustifiedTextSymbolIndex>=0?f.rightJustifiedTextSymbolIndex:f.centerJustifiedTextSymbolIndex>=0?f.centerJustifiedTextSymbolIndex:f.leftJustifiedTextSymbolIndex>=0?f.leftJustifiedTextSymbolIndex:f.verticalPlacedTextSymbolIndex>=0?f.verticalPlacedTextSymbolIndex:S),A=TM(this.textSizeData,c,x)/Fa;return this.tilePixelRatio*A}getSymbolInstanceIconSize(c,f,v){const S=this.icon.placedSymbolArray.get(v),x=TM(this.iconSizeData,c,S);return this.tilePixelRatio*x}_commitDebugCollisionVertexUpdate(c,f,v,S){c.emplaceBack(f,-v,-v,S),c.emplaceBack(f,v,-v,S),c.emplaceBack(f,v,v,S),c.emplaceBack(f,-v,v,S)}_updateTextDebugCollisionBoxes(c,f,v,S,x,A){for(let D=S;D<x;D++){const U=v.get(D),H=this.getSymbolInstanceTextSize(c,A,f,D);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,H,U.padding,A.zOffset)}}_updateIconDebugCollisionBoxes(c,f,v,S,x,A){for(let D=S;D<x;D++){const U=v.get(D),H=this.getSymbolInstanceIconSize(c,f,A.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,H,U.padding,A.zOffset)}}updateCollisionDebugBuffers(c,f){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const v=Ux(this.iconSizeData,c),S=Ux(this.textSizeData,c);for(let x=0;x<this.symbolInstances.length;x++){const A=this.symbolInstances.get(x);this._updateTextDebugCollisionBoxes(S,c,f,A.textBoxStartIndex,A.textBoxEndIndex,A),this._updateTextDebugCollisionBoxes(S,c,f,A.verticalTextBoxStartIndex,A.verticalTextBoxEndIndex,A),this._updateIconDebugCollisionBoxes(v,c,f,A.iconBoxStartIndex,A.iconBoxEndIndex,A),this._updateIconDebugCollisionBoxes(v,c,f,A.verticalIconBoxStartIndex,A.verticalIconBoxEndIndex,A)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(c,f,v,S,x,A,D,U,H){const R={};if(f<v){const{x1:N,y1:G,x2:z,y2:V,padding:X,projectedAnchorX:K,projectedAnchorY:ee,projectedAnchorZ:ce,tileAnchorX:he,tileAnchorY:ne,featureIndex:de}=c.get(f);R.textBox={x1:N,y1:G,x2:z,y2:V,padding:X,projectedAnchorX:K,projectedAnchorY:ee,projectedAnchorZ:ce,tileAnchorX:he,tileAnchorY:ne},R.textFeatureIndex=de}if(S<x){const{x1:N,y1:G,x2:z,y2:V,padding:X,projectedAnchorX:K,projectedAnchorY:ee,projectedAnchorZ:ce,tileAnchorX:he,tileAnchorY:ne,featureIndex:de}=c.get(S);R.verticalTextBox={x1:N,y1:G,x2:z,y2:V,padding:X,projectedAnchorX:K,projectedAnchorY:ee,projectedAnchorZ:ce,tileAnchorX:he,tileAnchorY:ne},R.verticalTextFeatureIndex=de}if(A<D){const{x1:N,y1:G,x2:z,y2:V,padding:X,projectedAnchorX:K,projectedAnchorY:ee,projectedAnchorZ:ce,tileAnchorX:he,tileAnchorY:ne,featureIndex:de}=c.get(A);R.iconBox={x1:N,y1:G,x2:z,y2:V,padding:X,projectedAnchorX:K,projectedAnchorY:ee,projectedAnchorZ:ce,tileAnchorX:he,tileAnchorY:ne},R.iconFeatureIndex=de}if(U<H){const{x1:N,y1:G,x2:z,y2:V,padding:X,projectedAnchorX:K,projectedAnchorY:ee,projectedAnchorZ:ce,tileAnchorX:he,tileAnchorY:ne,featureIndex:de}=c.get(U);R.verticalIconBox={x1:N,y1:G,x2:z,y2:V,padding:X,projectedAnchorX:K,projectedAnchorY:ee,projectedAnchorZ:ce,tileAnchorX:he,tileAnchorY:ne},R.verticalIconFeatureIndex=de}return R}deserializeCollisionBoxes(c){this.collisionArrays=[];for(let f=0;f<this.symbolInstances.length;f++){const v=this.symbolInstances.get(f);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(c,v.textBoxStartIndex,v.textBoxEndIndex,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v.iconBoxStartIndex,v.iconBoxEndIndex,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(c,f){const v=c.placedSymbolArray.get(f),S=v.vertexStartIndex+4*v.numGlyphs;for(let x=v.vertexStartIndex;x<S;x+=4)c.indexArray.emplaceBack(x,x+1,x+2),c.indexArray.emplaceBack(x+1,x+2,x+3)}getSortedSymbolIndexes(c){if(this.sortedAngle===c&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const f=Math.sin(c),v=Math.cos(c),S=[],x=[],A=[];for(let D=0;D<this.symbolInstances.length;++D){A.push(D);const U=this.symbolInstances.get(D);S.push(0|Math.round(f*U.tileAnchorX+v*U.tileAnchorY)),x.push(U.featureIndex)}return A.sort((D,U)=>S[D]-S[U]||x[U]-x[D]),A}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let c=0;c<this.symbolInstances.length;++c)this.symbolInstanceIndexesSortedZOffset.push(c)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((c,f)=>this.symbolInstances.get(f).zOffset-this.symbolInstances.get(c).zOffset)}addToSortKeyRanges(c,f){const v=this.sortKeyRanges[this.sortKeyRanges.length-1];v&&v.sortKey===f?v.symbolInstanceEnd=c+1:this.sortKeyRanges.push({sortKey:f,symbolInstanceStart:c,symbolInstanceEnd:c+1})}sortFeatures(c){if(this.sortFeaturesByY&&this.sortedAngle!==c&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(c),this.sortedAngle=c,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const f of this.symbolInstanceIndexes){const v=this.symbolInstances.get(f);this.featureSortOrder.push(v.featureIndex);const{rightJustifiedTextSymbolIndex:S,centerJustifiedTextSymbolIndex:x,leftJustifiedTextSymbolIndex:A,verticalPlacedTextSymbolIndex:D,placedIconSymbolIndex:U,verticalPlacedIconSymbolIndex:H}=v;S>=0&&this.addIndicesForPlacedSymbol(this.text,S),x>=0&&x!==S&&this.addIndicesForPlacedSymbol(this.text,x),A>=0&&A!==x&&A!==S&&this.addIndicesForPlacedSymbol(this.text,A),D>=0&&this.addIndicesForPlacedSymbol(this.text,D),U>=0&&this.addIndicesForPlacedSymbol(this.icon,U),H>=0&&this.addIndicesForPlacedSymbol(this.icon,H)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Q7,eV,N3;Fn(NM,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),NM.addDynamicAttributes=FM;class tV{constructor(c){this.type=c.property.overrides?c.property.overrides.runtimeType:Kl,this.defaultValue=c}evaluate(c){if(c.formattedSection){const f=this.defaultValue.property.overrides;if(f&&f.hasOverride(c.formattedSection))return f.getOverride(c.formattedSection)}return c.feature&&c.featureState?this.defaultValue.evaluate(c.feature,c.featureState):this.defaultValue.property.specification.default}eachChild(c){this.defaultValue.isConstant()||c(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Fn(tV,"FormatSectionOverride",{omit:["defaultValue"]});const z3=()=>N3||(N3={layout:Q7||(Q7=new Hi({"symbol-placement":new gn(At.layout_symbol["symbol-placement"]),"symbol-spacing":new gn(At.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new gn(At.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Kn(At.layout_symbol["symbol-sort-key"]),"symbol-z-order":new gn(At.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new gn(At.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new gn(At.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new gn(At.layout_symbol["icon-ignore-placement"]),"icon-optional":new gn(At.layout_symbol["icon-optional"]),"icon-rotation-alignment":new gn(At.layout_symbol["icon-rotation-alignment"]),"icon-size":new Kn(At.layout_symbol["icon-size"]),"icon-text-fit":new Kn(At.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Kn(At.layout_symbol["icon-text-fit-padding"]),"icon-image":new Kn(At.layout_symbol["icon-image"]),"icon-rotate":new Kn(At.layout_symbol["icon-rotate"]),"icon-padding":new gn(At.layout_symbol["icon-padding"]),"icon-keep-upright":new gn(At.layout_symbol["icon-keep-upright"]),"icon-offset":new Kn(At.layout_symbol["icon-offset"]),"icon-anchor":new Kn(At.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new gn(At.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new gn(At.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new gn(At.layout_symbol["text-rotation-alignment"]),"text-field":new Kn(At.layout_symbol["text-field"]),"text-font":new Kn(At.layout_symbol["text-font"]),"text-size":new Kn(At.layout_symbol["text-size"]),"text-max-width":new Kn(At.layout_symbol["text-max-width"]),"text-line-height":new Kn(At.layout_symbol["text-line-height"]),"text-letter-spacing":new Kn(At.layout_symbol["text-letter-spacing"]),"text-justify":new Kn(At.layout_symbol["text-justify"]),"text-radial-offset":new Kn(At.layout_symbol["text-radial-offset"]),"text-variable-anchor":new gn(At.layout_symbol["text-variable-anchor"]),"text-anchor":new Kn(At.layout_symbol["text-anchor"]),"text-max-angle":new gn(At.layout_symbol["text-max-angle"]),"text-writing-mode":new gn(At.layout_symbol["text-writing-mode"]),"text-rotate":new Kn(At.layout_symbol["text-rotate"]),"text-padding":new gn(At.layout_symbol["text-padding"]),"text-keep-upright":new gn(At.layout_symbol["text-keep-upright"]),"text-transform":new Kn(At.layout_symbol["text-transform"]),"text-offset":new Kn(At.layout_symbol["text-offset"]),"text-allow-overlap":new gn(At.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new gn(At.layout_symbol["text-ignore-placement"]),"text-optional":new gn(At.layout_symbol["text-optional"]),visibility:new gn(At.layout_symbol.visibility)})),paint:eV||(eV=new Hi({"icon-opacity":new Kn(At.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Kn(At.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Kn(At.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Kn(At.paint_symbol["text-emissive-strength"]),"icon-color":new Kn(At.paint_symbol["icon-color"]),"icon-halo-color":new Kn(At.paint_symbol["icon-halo-color"]),"icon-halo-width":new Kn(At.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Kn(At.paint_symbol["icon-halo-blur"]),"icon-translate":new gn(At.paint_symbol["icon-translate"]),"icon-translate-anchor":new gn(At.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Kn(At.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Kn(At.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Kn(At.paint_symbol["text-occlusion-opacity"]),"text-color":new Kn(At.paint_symbol["text-color"],{runtimeType:zs,getOverride:g=>g.textColor,hasOverride:g=>!!g.textColor}),"text-halo-color":new Kn(At.paint_symbol["text-halo-color"]),"text-halo-width":new Kn(At.paint_symbol["text-halo-width"]),"text-halo-blur":new Kn(At.paint_symbol["text-halo-blur"]),"text-translate":new gn(At.paint_symbol["text-translate"]),"text-translate-anchor":new gn(At.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new gn(At.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new gn(At.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new gn(At.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new gn(At.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Kn(At.paint_symbol["symbol-z-offset"]),"symbol-elevation-reference":new gn(At.paint_symbol["symbol-elevation-reference"])}))},N3);class zM extends Gs{constructor(c,f,v,S){super(c,z3(),f,v,S),this._colorAdjustmentMatrix=Pe.mat4.identity([]),this.hasInitialOcclusionOpacityProperties=c.paint!==void 0&&("icon-occlusion-opacity"in c.paint||"text-occlusion-opacity"in c.paint)}recalculate(c,f){super.recalculate(c,f),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const v=this.layout.get("text-writing-mode");if(v){const S=[];for(const x of v)S.indexOf(x)<0&&S.push(x);this.layout._values["text-writing-mode"]=S}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(c,f,v,S){return this._saturation===c&&this._contrast===f&&this._brightnessMin===v&&this._brightnessMax===S||(this._colorAdjustmentMatrix=function(x,A,D,U){x=We(x),A=Ce(A);const H=Pe.mat4.create(),R=x/3,N=1-2*R,G=[N,R,R,0,R,N,R,0,R,R,N,0,0,0,0,1],z=.5-.5*A,V=U-D;return Pe.mat4.multiply(H,[V,0,0,0,0,V,0,0,0,0,V,0,D,D,D,1],[A,0,0,0,0,A,0,0,0,0,A,0,z,z,z,1]),Pe.mat4.multiply(H,H,G),H}(c,f,v,S),this._saturation=c,this._contrast=f,this._brightnessMin=v,this._brightnessMax=S),this._colorAdjustmentMatrix}getValueAndResolveTokens(c,f,v,S){const x=this.layout.get(c).evaluate(f,{},v,S),A=this._unevaluatedLayout._values[c];return A.isDataDriven()||_d(A.value)||!x?x:function(D,U){return U.replace(/{([^{}]+)}/g,(H,R)=>R in D?String(D[R]):"")}(f.properties,x)}createBucket(c){return new NM(c)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const c of z3().paint.overridableProperties){if(!zM.hasPaintOverride(this.layout,c))continue;const f=this.paint.get(c),v=new tV(f),S=new jp(v,f.property.specification,this.scope,this.options);let x=null;x=f.value.kind==="constant"||f.value.kind==="source"?new Rg("source",S):new hl("composite",S,f.value.zoomStops,f.value._interpolationType),this.paint._values[c]=new Zu(f.property,x,f.parameters)}}_handleOverridablePaintPropertyUpdate(c,f,v){return!(!this.layout||f.isDataDriven()||v.isDataDriven())&&zM.hasPaintOverride(this.layout,c)}static hasPaintOverride(c,f){const v=c.get("text-field"),S=z3().paint.properties[f];let x=!1;const A=D=>{for(const U of D)if(S.overrides&&S.overrides.hasOverride(U))return void(x=!0)};if(v.value.kind==="constant"&&v.value.value instanceof Po)A(v.value.value.sections);else if(v.value.kind==="source"){const D=H=>{x||(H instanceof ll&&Ls(H.value)===Xa?A(H.value.sections):H instanceof Pa?A(H.sections):H.eachChild(D))},U=v.value;U._styleExpression&&D(U._styleExpression.expression)}return x}getProgramIds(){return["symbol"]}getDefaultProgramParams(c,f,v){return{config:new on(this,{zoom:f,lut:v}),overrideFog:!1}}}let nV,rV,iV,sV;var U3=Qr([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function V3(g){switch(g){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function G3(g){switch(g){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class H3{constructor(c,f,v,S){this.context=c,this.format=v,this.useMipmap=S&&S.useMipmap,this.texture=c.gl.createTexture(),this.update(f,{premultiply:S&&S.premultiply})}update(c,f){const v=c&&c instanceof HTMLVideoElement&&c.width===0?c.videoWidth:c.width,S=c&&c instanceof HTMLVideoElement&&c.height===0?c.videoHeight:c.height,{context:x}=this,{gl:A}=x,{x:D,y:U}=f&&f.position?f.position:{x:0,y:0},H=Math.max(D+v,this.size?this.size[0]:0),R=Math.max(U+S,this.size?this.size[1]:0);!this.size||this.size[0]===H&&this.size[1]===R||(A.bindTexture(A.TEXTURE_2D,null),A.deleteTexture(this.texture),this.texture=A.createTexture(),this.size=null),A.bindTexture(A.TEXTURE_2D,this.texture),x.pixelStoreUnpackFlipY.set(!1),x.pixelStoreUnpack.set(1),x.pixelStoreUnpackPremultiplyAlpha.set(this.format===A.RGBA8&&(!f||f.premultiply!==!1));const N=c instanceof HTMLImageElement||c instanceof HTMLCanvasElement||c instanceof HTMLVideoElement||c instanceof ImageData||ImageBitmap&&c instanceof ImageBitmap;if(!this.size&&H>0&&R>0){const G=this.useMipmap?Math.floor(Math.log2(Math.max(H,R)))+1:1;A.texStorage2D(A.TEXTURE_2D,G,this.format,H,R),this.size=[H,R]}if(this.size)if(N)A.texSubImage2D(A.TEXTURE_2D,0,D,U,V3(this.format),G3(this.format),c);else{const G=c.data;G&&A.texSubImage2D(A.TEXTURE_2D,0,D,U,v,S,V3(this.format),G3(this.format),G)}this.useMipmap&&A.generateMipmap(A.TEXTURE_2D)}bind(c,f,v=!1){const{context:S}=this,{gl:x}=S;x.bindTexture(x.TEXTURE_2D,this.texture),c!==this.minFilter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,c),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,this.useMipmap&&!v?c===x.NEAREST?x.NEAREST_MIPMAP_NEAREST:x.LINEAR_MIPMAP_LINEAR:c),this.minFilter=c),f!==this.wrapS&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,f),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,f),this.wrapS=f)}bindExtraParam(c,f,v,S){const{context:x}=this,{gl:A}=x;A.bindTexture(A.TEXTURE_2D,this.texture),f!==this.magFilter&&(A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MAG_FILTER,f),this.magFilter=f),c!==this.minFilter&&(A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MIN_FILTER,this.useMipmap?c===A.NEAREST?A.NEAREST_MIPMAP_NEAREST:A.LINEAR_MIPMAP_LINEAR:c),this.minFilter=c),v!==this.wrapS&&(A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_S,v),this.wrapS=v),S!==this.wrapT&&(A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_T,S),this.wrapT=S)}destroy(){const{gl:c}=this.context;c.deleteTexture(this.texture),this.texture=null}}class UM{constructor(c,f){this.context=c,this.texture=f}bind(c,f){const{context:v}=this,{gl:S}=v;S.bindTexture(S.TEXTURE_2D,this.texture),c!==this.minFilter&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MAG_FILTER,c),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MIN_FILTER,c),this.minFilter=c),f!==this.wrapS&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_S,f),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_T,f),this.wrapS=f)}}function VM(g,c,f,v,S,x,A,D){const U=[g,c,1,f,v,1,S,x,1],H=[A,D,1],R=Pe.mat3.adjoint([],U),[N,G,z]=Pe.vec3.transformMat3(H,H,R);return Pe.mat3.multiply(U,U,[N,0,0,0,G,0,0,0,z])}function oV(g,c,f,v,S,x,A,D){const U=function(H,R,N,G,z,V,X,K){const ee=VM(0,0,1,0,1,1,0,1),ce=VM(H,R,N,G,z,V,X,K),he=Pe.mat3.adjoint([],ee);return Pe.mat3.multiply(ce,ce,he)}(g,c,f,v,S,x,A,D);return[U[2]/U[8]/yn,U[5]/U[8]/yn]}function GM(g){return[g[0],Math.min(Math.max(g[1],-Ke),Ke)]}class aV extends zu{constructor(c,f,v,S){super(),this.id=c,this.dispatcher=v,this.coordinates=f.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(S),this.options=f,this._dirty=!1}load(c,f){if(this._loaded=f||!1,this.fire(new Yl("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return c&&(this.coordinates=c),this._loaded=!0,void this._finishLoading();this._imageRequest=Ss(this.map._requestManager.transformRequest(this.url,qi.Image),(v,S)=>{this._imageRequest=null,this._loaded=!0,v?this.fire(new wp(v)):S&&(this.image=S instanceof HTMLImageElement?Cn.getImageData(S):S,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,c&&(this.coordinates=c),this._finishLoading())})}loaded(){return this._loaded}updateImage(c){return c.url?(this._imageRequest&&c.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=c.url,this.load(c.coordinates,this._loaded),this):this}setTexture(c){if(!(c.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new UM(this.map.painter.context,c.handle),this.width=c.dimensions[0],this.height=c.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Yl("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(c){this.map=c,this.load()}onRemove(c){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof UM||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(c){if(this.coordinates=c,this._boundsArray=void 0,this._unsupportedCoords=!1,!c.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let f=c[0][1],v=c[0][1];for(const x of c)x[1]>v&&(v=x[1]),x[1]<f&&(f=x[1]);const S=(v+f)/2;if(S>Ke?this.onNorthPole=!0:S<-Ke&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const x=c.map(xt.fromLngLat);this.tileID=function(A){let D=1/0,U=1/0,H=-1/0,R=-1/0;for(const X of A)D=Math.min(D,X.x),U=Math.min(U,X.y),H=Math.max(H,X.x),R=Math.max(R,X.y);const N=Math.max(H-D,R-U),G=Math.max(0,Math.floor(-Math.log(N)/Math.LN2)),z=Math.pow(2,G);let V=Math.floor((D+H)/2*z);return V>1&&(V-=1),new Yo(G,V,Math.floor((U+R)/2*z))}(x),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Yl("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(c){for(const ee in this.tiles){const ce=this.tiles[ee];ce.state!=="loaded"&&(ce.state="loaded",ce.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const f=Xw(new Yo(0,0,0),this.map.transform.projection),v=[f.projection.project(this.coordinates[0][0],this.coordinates[0][1]),f.projection.project(this.coordinates[1][0],this.coordinates[1][1]),f.projection.project(this.coordinates[2][0],this.coordinates[2][1]),f.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(ee){const ce=ee[1].x-ee[0].x,he=ee[1].y-ee[0].y,ne=ee[2].x-ee[1].x,de=ee[2].y-ee[1].y,ge=ee[3].x-ee[2].x,Me=ee[3].y-ee[2].y,Be=ee[0].x-ee[3].x,Oe=ee[0].y-ee[3].y,Ie=ce*de-ne*he,Ye=ne*Me-ge*de,ze=ge*Oe-Be*Me,Qe=Be*he-ce*Oe;return Ie>0&&Ye>0&&ze>0&&Qe>0||Ie<0&&Ye<0&&ze<0&&Qe<0}(v))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const S=Xw(this.tileID,this.map.transform.projection),[x,A,D,U]=this.coordinates.map(ee=>{const ce=S.projection.project(ee[0],ee[1]);return $7(S,ce)._round()});this.perspectiveTransform=oV(x.x,x.y,A.x,A.y,D.x,D.y,U.x,U.y);const H=this._boundsArray=new Ks;H.emplaceBack(x.x,x.y,0,0),H.emplaceBack(A.x,A.y,yn,0),H.emplaceBack(U.x,U.y,0,yn),H.emplaceBack(D.x,D.y,yn,yn),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=c.createVertexBuffer(H,U3.members),this.boundsSegments=xs.simpleSegment(0,0,4,2);const R=[],N=[GM((G=this.coordinates)[0]),GM(G[1]),GM(G[2]),GM(G[3])];var G;const[z,V,X,K]=function(ee){let ce=ee[0][0],he=ce,ne=ee[0][1],de=ne;for(let ge=1;ge<ee.length;ge++)ee[ge][0]<ce?ce=ee[ge][0]:ee[ge][0]>he&&(he=ee[ge][0]),ee[ge][1]<ne?ne=ee[ge][1]:ee[ge][1]>de&&(de=ee[ge][1]);return[ce,ne,he-ce,de-ne]}(N);{const ee=new Ks,[ce,he,ne,de]=function(mt){let Et=mt[0].x,vt=Et,Ut=mt[0].y,Yt=Ut;for(let Dt=1;Dt<mt.length;Dt++)mt[Dt].x<Et?Et=mt[Dt].x:mt[Dt].x>vt&&(vt=mt[Dt].x),mt[Dt].y<Ut?Ut=mt[Dt].y:mt[Dt].y>Yt&&(Yt=mt[Dt].y);return[Et,Ut,vt-Et,Yt-Ut]}(v),ge=mt=>[(mt.x-ce)/ne,(mt.y-he)/de],[Me,Be,Oe,Ie]=v.map(ge),Ye=function(mt,Et,vt,Ut,Yt,Dt,Rn,bn){const dn=VM(0,0,1,0,1,1,0,1),tn=VM(mt,Et,vt,Ut,Yt,Dt,Rn,bn),nr=Pe.mat3.adjoint([],tn);return Pe.mat3.multiply(dn,dn,nr)}(Me[0],Me[1],Be[0],Be[1],Oe[0],Oe[1],Ie[0],Ie[1]);this.elevatedGlobePerspectiveTransform=oV(Me[0],Me[1],Be[0],Be[1],Oe[0],Oe[1],Ie[0],Ie[1]);const ze=(mt,Et)=>{R.push(mt.lng);const vt=Math.round((mt.lng-z)/X*yn),Ut=Math.round((mt.lat-V)/K*yn),Yt=ge(Et),Dt=Pe.vec3.transformMat3([],[Yt[0],Yt[1],1],Ye),Rn=Math.round(Dt[0]/Dt[2]*yn),bn=Math.round(Dt[1]/Dt[2]*yn);ee.emplaceBack(vt,Ut,Rn,bn)},Qe=v[3].x-v[0].x,lt=v[3].y-v[0].y,ut=v[2].x-v[1].x,ht=v[2].y-v[1].y;for(let mt=0;mt<65;mt++){const Et=mt/64,vt=[v[0].x+Et*Qe,v[0].y+Et*lt],Ut=[v[1].x+Et*ut,v[1].y+Et*ht],Yt=Ut[0]-vt[0],Dt=Ut[1]-vt[1];for(let Rn=0;Rn<65;Rn++){const bn=Rn/64,dn={x:vt[0]+Yt*bn,y:vt[1]+Dt*bn,z:0};ze(f.projection.unproject(dn.x,dn.y),dn)}}this.elevatedGlobeVertexBuffer=c.createVertexBuffer(ee,U3.members)}{this.maxLongitudeTriangleSize=0;let ee=[],ce=new bo;const he=(ne,de,ge)=>{ce.emplaceBack(ne,de,ge);const Me=R[ne],Be=R[de],Oe=R[ge],Ie=Math.min(Math.min(Me,Be),Oe),Ye=Math.max(Math.max(Me,Be),Oe)-Ie;Ye>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Ye),ee.push(Ie+Ye/2)};for(let ne=0;ne<64;ne++)for(let de=0;de<64;de++){const ge=65*ne+de,Me=ge+1,Be=ge+65,Oe=Be+1;he(ge,Be,Me),he(Me,Be,Oe)}[ee,ce]=function(ne,de){const ge=Array.from({length:ne.length},(Oe,Ie)=>Ie);ge.sort((Oe,Ie)=>ne[Oe]-ne[Ie]);const Me=[],Be=new bo;for(let Oe=0;Oe<ge.length;Oe++){const Ie=ge[Oe];Me.push(ne[Ie]);const Ye=3*Ie,ze=Ye+1;Be.emplaceBack(de.uint16[Ye],de.uint16[ze],de.uint16[ze+1])}return[Me,Be]}(ee,ce),this.elevatedGlobeTrianglesCenterLongitudes=ee,this.elevatedGlobeIndexBuffer=c.createIndexBuffer(ce)}this.elevatedGlobeSegments=xs.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,X/yn,0,K/yn,0,0,V,z,0])}prepare(){const c=Object.keys(this.tiles).length!==0;if(this.tileID&&!c)return;const f=this.map.painter.context,v=f.gl;!this._dirty||this.texture instanceof UM||(this.texture?this.texture.update(this.image):(this.texture=new H3(f,this.image,v.RGBA8),this.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE)),this._dirty=!1),c&&this._prepareData(f)}loadTile(c,f){this.tileID&&this.tileID.equals(c.tileID.canonical)?(this.tiles[String(c.tileID.wrap)]=c,c.buckets={},f(null)):(c.state="errored",f(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(c){const f=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!f)return null;const v=this.elevatedGlobeTrianglesCenterLongitudes;let S=(x=c+180)+360*Math.round((v[0]-x)/360);var x;const A=new xs,D=(N,G)=>{A.segments.push({vertexOffset:0,primitiveOffset:N,vertexLength:f.segments[0].vertexLength,primitiveLength:G,sortKey:void 0,vaos:{}})},U=.51*this.maxLongitudeTriangleSize;if(Math.abs(v[0]-S)<=U){const N=xe(v,0,v.length,S+U);return N===v.length||D(N,Tt(v,N+1,v.length,S+360-U)-N),A}S<v[0]&&(S+=360);const H=Tt(v,0,v.length,S-U);if(H===v.length)return D(0,v.length),A;D(0,H-0);const R=xe(v,H+1,v.length,S+U);return R!==v.length&&D(R,v.length-R),A}}const hhe=(Math.pow(256,2)-1)/16907520;class lV extends Gs{constructor(c,f,v,S){super(c,{layout:iV||(iV=new Hi({visibility:new gn(At.layout_raster.visibility)})),paint:sV||(sV=new Hi({"raster-opacity":new gn(At.paint_raster["raster-opacity"]),"raster-color":new oc(At.paint_raster["raster-color"]),"raster-color-mix":new gn(At.paint_raster["raster-color-mix"]),"raster-color-range":new gn(At.paint_raster["raster-color-range"]),"raster-hue-rotate":new gn(At.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new gn(At.paint_raster["raster-brightness-min"]),"raster-brightness-max":new gn(At.paint_raster["raster-brightness-max"]),"raster-saturation":new gn(At.paint_raster["raster-saturation"]),"raster-contrast":new gn(At.paint_raster["raster-contrast"]),"raster-resampling":new gn(At.paint_raster["raster-resampling"]),"raster-fade-duration":new gn(At.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new gn(At.paint_raster["raster-emissive-strength"]),"raster-array-band":new gn(At.paint_raster["raster-array-band"]),"raster-elevation":new gn(At.paint_raster["raster-elevation"])}))},f,v,S),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(c){return!(c&&c._source instanceof aV&&(c._source.onNorthPole||c._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(c){c!=="raster-color"&&c!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(c){if(!this.hasColorMap()||!this._curRampRange)return;const f=this._transitionablePaint._values["raster-color"].value.expression,[v,S]=c||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(v)&&isNaN(S)||v===this._curRampRange[0]&&S===this._curRampRange[1]||(this.colorRamp=Pw({expression:f,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:v,end:S}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[v,S])}}let cV,uV,hV,fV,dV;class pV extends Gs{constructor(c,f,v,S){super(c,{layout:cV||(cV=new Hi({visibility:new gn(At["layout_raster-particle"].visibility)})),paint:uV||(uV=new Hi({"raster-particle-array-band":new gn(At["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new gn(At["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new oc(At["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new gn(At["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new gn(At["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new gn(At["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new gn(At["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new gn(At["paint_raster-particle"]["raster-particle-elevation"])}))},f,v,S),this._updateColorRamp(),this.lastInvalidatedAt=Cn.now()}onRemove(c){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(c){return!1}_handleSpecialPaintPropertyUpdate(c){c!=="raster-particle-color"&&c!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),c==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const c=this._transitionablePaint._values["raster-particle-color"].value.expression,f=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Pw({expression:c,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:f}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Cn.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class fhe extends Gs{constructor(c,f){super(c,{},f,null),this.implementation=c,c.slot&&(this.slot=c.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(c){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(c){this.implementation.onAdd&&this.implementation.onAdd(c,c.painter.context.gl)}onRemove(c){this.implementation.onRemove&&this.implementation.onRemove(c,c.painter.context.gl)}}function j3(g,c,f){const v=[0,0,1],S=Pe.quat.identity([]);return Pe.quat.rotateY(S,S,f?-sn(g)+Math.PI:sn(g)),Pe.quat.rotateX(S,S,-sn(c)),Pe.vec3.transformQuat(v,v,S),Pe.vec3.normalize(v,v)}function mV(g,c){const f=HM(g.projection,g.zoom,g.width,g.height),v=function(x,A,D,U,H){const R=new ue(D.lng-180*Qg,D.lat),N=new ue(D.lng+180*Qg,D.lat),G=x.project(R.lng,R.lat),z=x.project(N.lng,N.lat),V=-Math.atan2(z.y-G.y,z.x-G.x),X=xt.fromLngLat(D);X.y=jt(X.y,-1+Qg,1-Qg);const K=X.toLngLat(),ee=x.project(K.lng,K.lat),ce=xt.fromLngLat(K);ce.x+=Qg;const he=ce.toLngLat(),ne=x.project(he.lng,he.lat),de=vV(ne.x-ee.x,ne.y-ee.y,V),ge=xt.fromLngLat(K);ge.y+=Qg;const Me=ge.toLngLat(),Be=x.project(Me.lng,Me.lat),Oe=vV(Be.x-ee.x,Be.y-ee.y,V),Ie=Math.abs(de.x)/Math.abs(Oe.y),Ye=Pe.mat4.identity([]);Pe.mat4.rotateZ(Ye,Ye,-V*(1-(H?0:U)));const ze=Pe.mat4.identity([]);return Pe.mat4.scale(ze,ze,[1,1-(1-Ie)*U,1]),ze[4]=-Oe.x/Oe.y*U,Pe.mat4.rotateZ(ze,ze,V),Pe.mat4.multiply(ze,Ye,ze),ze}(g.projection,0,g.center,f,c),S=gV(g);return Pe.mat4.scale(v,v,[S,S,1]),v}function gV(g){const c=g.projection,f=HM(g.projection,g.zoom,g.width,g.height),v=W3(c,g.center),S=W3(c,ue.convert(c.center));return Math.pow(2,v*f+(1-f)*S)}function HM(g,c,f,v,S=1/0){const x=g.range;if(!x)return 0;const A=Math.min(S,Math.max(f,v)),D=Math.log(A/1024)/Math.LN2;return mr(x[0]+D,x[1]+D,c)}const Qg=1/4e4;function W3(g,c){const f=jt(c.lat,-Ke,Ke),v=new ue(c.lng-180*Qg,f),S=new ue(c.lng+180*Qg,f),x=g.project(v.lng,f),A=g.project(S.lng,f),D=xt.fromLngLat(v),U=xt.fromLngLat(S),H=A.x-x.x,R=A.y-x.y,N=U.x-D.x,G=U.y-D.y,z=Math.sqrt((N*N+G*G)/(H*H+R*R));return Math.log(z)/Math.LN2}function vV(g,c,f){const v=Math.cos(f),S=Math.sin(f);return{x:g*v-c*S,y:g*S+c*v}}function _V(g,c,f){Pe.mat4.identity(g),Pe.mat4.rotateZ(g,g,sn(c[2])),Pe.mat4.rotateX(g,g,sn(c[0])),Pe.mat4.rotateY(g,g,sn(c[1])),Pe.mat4.scale(g,g,f),Pe.mat4.multiply(g,g,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function jM(g,c,f,v,S,x,A,D){const U=[f[0]-c[0],f[1]-c[1],0],H=[v[0]-c[0],v[1]-c[1],0];if(Pe.vec3.length(U)<1e-12||Pe.vec3.length(H)<1e-12)return Pe.quat.identity(g);const R=Pe.vec3.cross([],U,H);Pe.vec3.normalize(R,R),Pe.vec3.subtract(H,v,c),U[2]=(x-S)*D,H[2]=(A-S)*D;const N=U;return Pe.vec3.cross(N,U,H),Pe.vec3.normalize(N,N),Pe.quat.rotationTo(g,R,N)}function X3(g,c,f=!1){const v=$g(c.zoom),S=function(x,A,D){const U=A.worldSize,H=[x[12],x[13],x[14]],R=Ge(H[1]/U),N=je(H[0]/U),G=Pe.mat4.identity([]),z=De(1,R)*U,V=De(1,0)*U*ct(R,A.zoom),X=1/o3(U);let K=V*X;if(D){const ne=HM(A.projection,A.zoom,A.width,A.height,1024);K=X*A.projection.pixelSpaceConversion(A.center.lat,U,ne)}const ee=Q(R,N);Pe.vec3.add(ee,ee,Pe.vec3.scale([],Pe.vec3.normalize([],ee),z*K*H[2]));const ce=function(ne){const de=[ne[0],ne[1],ne[2]];let ge=[0,1,0];const Me=Pe.vec3.cross([],ge,de);return Pe.vec3.cross(ge,de,Me),Pe.vec3.squaredLength(ge)===0&&(ge=[0,1,0],Pe.vec3.cross(Me,de,ge)),Pe.vec3.normalize(Me,Me),Pe.vec3.normalize(ge,ge),Pe.vec3.normalize(de,de),[Me[0],Me[1],Me[2],0,ge[0],ge[1],ge[2],0,de[0],de[1],de[2],0,ne[0],ne[1],ne[2],1]}(ee);Pe.mat4.scale(G,G,[K,K,K*z]),Pe.mat4.translate(G,G,[-H[0],-H[1],-H[2]]);const he=Pe.mat4.multiply([],A.globeMatrix,ce);return Pe.mat4.multiply(he,he,G),Pe.mat4.multiply(he,he,x),he}(g,c,f);if(v>0){const x=function(A,D){const U=D.worldSize,H=De(1,0)*U*ct(D.center.lat,D.zoom)/o3(U),R=De(1,D.center.lat)*U,N=Pe.mat4.identity([]);return Pe.mat4.rotateY(N,N,sn(D.center.lng)),Pe.mat4.rotateX(N,N,sn(D.center.lat)),Pe.mat4.translate(N,N,[0,0,u]),Pe.mat4.scale(N,N,[H,H,H*R]),Pe.mat4.translate(N,N,[D.point.x-.5*U,D.point.y-.5*U,0]),Pe.mat4.multiply(N,N,A),Pe.mat4.multiply(N,D.globeMatrix,N)}(g,c);return function(A,D,U){const H=(V,X,K)=>{const ee=Pe.vec3.length(V),ce=Pe.vec3.length(X),he=rm(V,X,K);return Pe.vec3.scale(he,he,1/Pe.vec3.length(he)*cr(ee,ce,K))},R=H([A[0],A[1],A[2]],[D[0],D[1],D[2]],U),N=H([A[4],A[5],A[6]],[D[4],D[5],D[6]],U),G=H([A[8],A[9],A[10]],[D[8],D[9],D[10]],U),z=rm([A[12],A[13],A[14]],[D[12],D[13],D[14]],U);return[R[0],R[1],R[2],0,N[0],N[1],N[2],0,G[0],G[1],G[2],0,z[0],z[1],z[2],1]}(S,x,v)}return S}function yV(g,c,f,v){const S=Yi.projectAabbCorners(v,f);let x=Number.MAX_VALUE,A=-1;for(let H=0;H<S.length;++H){const R=S[H];R[0]=(.5*R[0]+.5)*c.width,R[1]=(.5-.5*R[1])*c.height,R[2]<x&&(A=H,x=R[2])}const D=H=>new St(S[H][0],S[H][1]);let U;switch(A){case 0:case 6:U=[D(1),D(5),D(4),D(7),D(3),D(2),D(1)];break;case 1:case 7:U=[D(0),D(4),D(5),D(6),D(2),D(3),D(0)];break;case 3:case 5:U=[D(1),D(0),D(4),D(7),D(6),D(2),D(1)];break;default:U=[D(1),D(5),D(6),D(7),D(3),D(0),D(1)]}if(xn(g,U))return x}const dhe=Qr([{name:"a_pos_3f",components:3,type:"Float32"}]),phe=Qr([{name:"a_color_3f",components:3,type:"Float32"}]),mhe=Qr([{name:"a_color_4f",components:4,type:"Float32"}]),ghe=Qr([{name:"a_uv_2f",components:2,type:"Float32"}]),vhe=Qr([{name:"a_normal_3f",components:3,type:"Float32"}]),_he=Qr([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),yhe=Qr([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),xV={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class WM{constructor(c,f,v,S){this.message=(c?`${c}: `:"")+v,S&&(this.identifier=S),f!=null&&f.__line__&&(this.line=f.__line__)}}function bV(g,c){const f=g.indexOf("://")===-1;try{return new URL(g,f&&c?"http://example.com":void 0),!0}catch{return!1}}class wV{constructor(c,f){this.feature=c,this.instancedDataOffset=f,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class SV{constructor(){this.instancedDataArray=new Pd,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class $3{constructor(c){this.zoom=c.zoom,this.canonical=c.canonical,this.layers=c.layers,this.layerIds=this.layers.map(f=>f.fqid),this.projection=c.projection,this.index=c.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(c,f){}populate(c,f,v,S){this.tileToMeter=rt(v);const x=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:A,id:D,index:U,sourceLayerIndex:H}of c){const R=D??(A.properties&&A.properties.hasOwnProperty("id")?A.properties.id:void 0),N=pn(A,x);if(!this.layers[0]._featureFilter.filter(new hs(this.zoom),N,v))continue;const G={id:R,sourceLayerIndex:H,index:U,geometry:x?N.geometry:fn(A,v,S),properties:A.properties,type:A.type,patterns:{}},z=this.addFeature(G,G.geometry,N);z&&f.featureIndex.insert(A,G.geometry,U,H,this.index,this.instancesPerModel[z].instancedDataArray.length,yn/32)}this.lookup=null}update(c,f,v,S){for(const x in this.instancesPerModel){const A=this.instancesPerModel[x];for(const D in c)A.idToFeaturesIndex.hasOwnProperty(D)&&(this.evaluate(A.features[A.idToFeaturesIndex[D]],c[D],A,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let c=!1;for(const f in this.instancesPerModel){const v=this.instancesPerModel[f];for(const S of v.features){const x=this.layers[0],A=S.feature,D=this.canonical,U=x.paint.get("model-rotation").evaluate(A,{},D),H=x.paint.get("model-scale").evaluate(A,{},D),R=x.paint.get("model-translation").evaluate(A,{},D);Pe.vec3.exactEquals(S.rotation,U)&&Pe.vec3.exactEquals(S.scale,H)&&Pe.vec3.exactEquals(S.translation,R)||(this.evaluate(S,S.featureStates,v,!0),c=!0)}}return c}updateReplacement(c,f,v,S){if(f.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=f.updateTime;const x=f.getReplacementRegionsForTile(c.toUnwrapped(),!0);if(y3(this.activeReplacements,x))return!1;this.activeReplacements=x;let A=!1;for(const D in this.instancesPerModel){const U=this.instancesPerModel[D],H=U.instancedDataArray;for(const R of U.features){const N=R.instancedDataOffset,G=R.instancedDataCount;for(let z=0;z<G;z++){const V=16*(z+N);let X=H.float32[V+0];const K=X>yn;X=K?X-yn:X;const ee=Math.floor(X),ce=H.float32[V+1];let he=!1;for(const ne of this.activeReplacements)if(!N9(ne,v,xV.Model,S)&&!(ne.min.x>ee||ee>ne.max.x||ne.min.y>ce||ce>ne.max.y)&&(he=j9(H9(ee,ce,c.canonical,ne.footprintTileId.canonical),ne.footprint),he))break;H.float32[V]=he?X+yn:X,A=A||he!==K}}}return A}isEmpty(){for(const c in this.instancesPerModel)if(this.instancesPerModel[c].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(c){if(!this.uploaded)for(const f in this.instancesPerModel){const v=this.instancesPerModel[f];v.instancedDataArray.length<0||v.instancedDataArray.length===0||(v.instancedDataBuffer?v.instancedDataBuffer.updateData(v.instancedDataArray):v.instancedDataBuffer=c.createVertexBuffer(v.instancedDataArray,_he.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const f in this.instancesPerModel){const v=this.instancesPerModel[f];v.instancedDataArray.length!==0&&v.instancedDataBuffer&&v.instancedDataBuffer.destroy()}const c=this.layers[0].modelManager;if(c&&this.modelUris)for(const f of this.modelUris)c.removeModel(f,"")}addFeature(c,f,v){const S=this.layers[0],x=S.layout.get("model-id").evaluate(v,{},this.canonical);if(!x)return Lt(`modelId is not evaluated for layer ${S.id} and it is not going to get rendered.`),x;bV(x,!1)&&(this.modelUris.includes(x)||this.modelUris.push(x)),this.instancesPerModel[x]||(this.instancesPerModel[x]=new SV);const A=this.instancesPerModel[x],D=A.instancedDataArray,U=new wV(v,D.length);for(const H of f)for(const R of H){if(R.x<0||R.x>=yn||R.y<0||R.y>=yn)continue;const N=(this.lookupDim-1)/yn,G=this.lookupDim*(R.y*N|0)+R.x*N|0;if(this.lookup){if(this.lookup[G]!==0)continue;this.lookup[G]=1}this.instanceCount++;const z=D.length;D.resize(z+1),A.instancesEvaluatedElevation.push(0),D.float32[16*z]=R.x,D.float32[16*z+1]=R.y}return U.instancedDataCount=A.instancedDataArray.length-U.instancedDataOffset,U.instancedDataCount>0&&(c.id&&(A.idToFeaturesIndex[c.id]=A.features.length),A.features.push(U),this.evaluate(U,{},A,!1)),x}getModelUris(){return this.modelUris}evaluate(c,f,v,S){const x=this.layers[0],A=c.feature,D=this.canonical,U=c.rotation=x.paint.get("model-rotation").evaluate(A,f,D),H=c.scale=x.paint.get("model-scale").evaluate(A,f,D),R=c.translation=x.paint.get("model-translation").evaluate(A,f,D),N=x.paint.get("model-color").evaluate(A,f,D);N.a=x.paint.get("model-color-mix-intensity").evaluate(A,f,D);const G=[];this.maxVerticalOffset<R[2]&&(this.maxVerticalOffset=R[2]),this.maxScale=Math.max(Math.max(this.maxScale,H[0]),Math.max(H[1],H[2])),_V(G,U,H);const z=Math.round(100*N.a)+N.b/1.05;for(let V=0;V<c.instancedDataCount;++V){const X=c.instancedDataOffset+V,K=16*X,ee=v.instancedDataArray.float32;let ce=0;S&&(ce=ee[K+6]-v.instancesEvaluatedElevation[X]);const he=0|ee[K+1];ee[K]=(0|ee[K])+N.r/1.05,ee[K+1]=he+N.g/1.05,ee[K+2]=z,ee[K+3]=1/(D.z>10?this.tileToMeter:rt(D,he)),ee[K+4]=R[0],ee[K+5]=R[1],ee[K+6]=R[2]+ce,ee[K+7]=G[0],ee[K+8]=G[1],ee[K+9]=G[2],ee[K+10]=G[4],ee[K+11]=G[5],ee[K+12]=G[6],ee[K+13]=G[8],ee[K+14]=G[9],ee[K+15]=G[10],v.instancesEvaluatedElevation[X]=R[2]}}}let AV,TV;Fn($3,"ModelBucket",{omit:["layers"]}),Fn(SV,"PerModelAttributes"),Fn(wV,"ModelFeature");const l_=64,Wx={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function MV(g,c,f,v,S,x,A,D,U,H=!1){const R=f.zoom,N=f.project(v),G=ct(v.lat,R),z=1/G;Pe.mat4.identity(g),Pe.mat4.translate(g,g,[N.x+A[0]*z,N.y+A[1]*z,A[2]]);let V=1,X=1;const K=f.worldSize;if(H){if(f.projection.name==="mercator"){let ne=0;f.elevation&&(ne=f.elevation.getAtPointOrZero(new xt(N.x/K,N.y/K),0));const de=Pe.vec4.transformMat4([],[N.x,N.y,ne,1],f.projMatrix)[3]/f.cameraToCenterDistance;V=de,X=de*ct(f.center.lat,R)}else if(f.projection.name==="globe"){const ne=X3(g,f),de=Pe.mat4.multiply([],f.projMatrix,ne),ge=[0,0,0,1];Pe.vec4.transformMat4(ge,ge,de);const Me=ge[3]/f.cameraToCenterDistance,Be=$g(R),Oe=f.projection.pixelsPerMeter(v.lat,K)*ct(v.lat,R),Ie=f.projection.pixelsPerMeter(f.center.lat,K)*ct(f.center.lat,R);V=Me/cr(Oe,tt(f.center.lat),Be),X=Me*G/Oe,V*=Ie,X*=Ie}}else V=z;Pe.mat4.scale(g,g,[V,V,X]);const ee=[...g],ce=c.orientation,he=[];if(_V(he,[ce[0]+S[0],ce[1]+S[1],ce[2]+S[2]],x),Pe.mat4.multiply(g,ee,he),D&&f.elevation){let ne=0;const de=[];if(U&&f.elevation){ne=function(Be,Oe,Ie,Ye,ze){const Qe=Oe.elevation;if(!Qe)return 0;const lt=Yi.projectAabbCorners(Ie,Ye),ut=De(1,ze.lat)*Oe.worldSize,ht=function(nr,In){const Nn=[0,0,1],wr=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Or of wr){const Pr=nr[Or.corners[0]],Lr=nr[Or.corners[1]],jr=nr[Or.corners[2]],Wr=[Lr[0]-Pr[0],Lr[1]-Pr[1],In*(Lr[2]-Pr[2])],zi=Pe.vec3.cross(Wr,Wr,[jr[0]-Pr[0],jr[1]-Pr[1],In*(jr[2]-Pr[2])]);Pe.vec3.normalize(zi,zi),Or.dotProductWithUp=Pe.vec3.dot(zi,Nn)}return wr.sort((Or,Pr)=>Or.dotProductWithUp-Pr.dotProductWithUp),wr[0].corners}(lt,ut),mt=lt[ht[0]],Et=lt[ht[1]],vt=lt[ht[2]],Ut=lt[ht[3]],Yt=Qe.getAtPointOrZero(new xt(mt[0]/Oe.worldSize,mt[1]/Oe.worldSize),0),Dt=Qe.getAtPointOrZero(new xt(Et[0]/Oe.worldSize,Et[1]/Oe.worldSize),0),Rn=Qe.getAtPointOrZero(new xt(vt[0]/Oe.worldSize,vt[1]/Oe.worldSize),0),bn=Qe.getAtPointOrZero(new xt(Ut[0]/Oe.worldSize,Ut[1]/Oe.worldSize),0),dn=(Yt+bn)/2,tn=(Dt+Rn)/2;return dn>tn?Dt<Rn?jM(Be,Et,Ut,mt,Dt,bn,Yt,ut):jM(Be,vt,mt,Ut,Rn,Yt,bn,ut):Yt<bn?jM(Be,mt,Et,vt,Yt,Dt,Rn,ut):jM(Be,Ut,vt,Et,bn,Rn,Dt,ut),Math.max(dn,tn)}(de,f,c.aabb,g,v);const ge=Pe.mat4.fromQuat([],de),Me=Pe.mat4.multiply([],ge,he);Pe.mat4.multiply(g,ee,Me)}else ne=f.elevation.getAtPointOrZero(new xt(N.x/K,N.y/K),0);ne!==0&&(g[14]+=ne)}}function Kw(g,c,f=!1){g.uploaded||(g.gfxTexture=new H3(c,g.image,f?c.gl.R8:c.gl.RGBA8,{useMipmap:g.sampler.minFilter>=c.gl.NEAREST_MIPMAP_NEAREST}),g.uploaded=!0,g.image=null)}function xhe(g,c,f){g.indexBuffer=c.createIndexBuffer(g.indexArray,!1,!0),g.vertexBuffer=c.createVertexBuffer(g.vertexArray,dhe.members,!1,!0),g.normalArray&&(g.normalBuffer=c.createVertexBuffer(g.normalArray,vhe.members,!1,!0)),g.texcoordArray&&(g.texcoordBuffer=c.createVertexBuffer(g.texcoordArray,ghe.members,!1,!0)),g.colorArray&&(g.colorBuffer=c.createVertexBuffer(g.colorArray,(g.colorArray.bytesPerElement===12?phe:mhe).members,!1,!0)),g.featureArray&&(g.pbrBuffer=c.createVertexBuffer(g.featureArray,yhe.members,!0)),g.segments=xs.simpleSegment(0,0,g.vertexArray.length,g.indexArray.length);const v=g.material;v.pbrMetallicRoughness.baseColorTexture&&Kw(v.pbrMetallicRoughness.baseColorTexture,c),v.pbrMetallicRoughness.metallicRoughnessTexture&&Kw(v.pbrMetallicRoughness.metallicRoughnessTexture,c),v.normalTexture&&Kw(v.normalTexture,c),v.occlusionTexture&&Kw(v.occlusionTexture,c,f),v.emissionTexture&&Kw(v.emissionTexture,c)}function q3(g,c,f){if(g.meshes)for(const v of g.meshes)xhe(v,c,f);if(g.children)for(const v of g.children)q3(v,c,f)}function XM(g){if(g.meshes)for(const c of g.meshes)c.indexArray.destroy(),c.vertexArray.destroy(),c.colorArray&&c.colorArray.destroy(),c.normalArray&&c.normalArray.destroy(),c.texcoordArray&&c.texcoordArray.destroy(),c.featureArray&&c.featureArray.destroy();if(g.children)for(const c of g.children)XM(c)}function Z3(g){if(g.meshes)for(const f of g.meshes)f.vertexBuffer&&(f.vertexBuffer.destroy(),f.indexBuffer.destroy(),f.normalBuffer&&f.normalBuffer.destroy(),f.texcoordBuffer&&f.texcoordBuffer.destroy(),f.colorBuffer&&f.colorBuffer.destroy(),f.pbrBuffer&&f.pbrBuffer.destroy(),f.segments.destroy(),f.material&&((c=f.material).pbrMetallicRoughness.baseColorTexture&&c.pbrMetallicRoughness.baseColorTexture.gfxTexture&&c.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),c.pbrMetallicRoughness.metallicRoughnessTexture&&c.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&c.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),c.normalTexture&&c.normalTexture.gfxTexture&&c.normalTexture.gfxTexture.destroy(),c.emissionTexture&&c.emissionTexture.gfxTexture&&c.emissionTexture.gfxTexture.destroy(),c.occlusionTexture&&c.occlusionTexture.gfxTexture&&c.occlusionTexture.gfxTexture.destroy()));var c;if(g.children)for(const f of g.children)Z3(f)}class Xx{constructor(c,f,v){this._demTile=c,this._dem=this._demTile.dem,this._scale=f,this._offset=v}static create(c,f,v){const S=v||c.findDEMTileFor(f);if(!S||!S.dem)return;const x=S.dem,A=S.tileID,D=1<<f.canonical.z-A.canonical.z;return new Xx(S,x.dim/yn/D,[(f.canonical.x/D-A.canonical.x)*x.dim,(f.canonical.y/D-A.canonical.y)*x.dim])}tileCoordToPixel(c,f){const v=f*this._scale+this._offset[1],S=Math.floor(c*this._scale+this._offset[0]),x=Math.floor(v);return new St(S,x)}getElevationAt(c,f,v,S){const x=c*this._scale+this._offset[0],A=f*this._scale+this._offset[1],D=Math.floor(x),U=Math.floor(A),H=this._dem;return S=!!S,v?cr(cr(H.get(D,U,S),H.get(D,U+1,S),A-U),cr(H.get(D+1,U,S),H.get(D+1,U+1,S),A-U),x-D):H.get(D,U,S)}getElevationAtPixel(c,f,v){return this._dem.get(c,f,!!v)}getMeterToDEM(c){return(1<<this._demTile.tileID.canonical.z)*De(1,c)*this._dem.stride}}const Y3=new Float32Array(262144),c_=new Uint8Array(262144);function CV(g){let c=0;if(g.meshes)for(const f of g.meshes)c=Math.max(c,f.aabb.max[2]);if(g.children)for(const f of g.children)c=Math.max(c,CV(f));return c}function EV(g,c,f){if(g.meshes)for(const v of g.meshes)v.aabb.min[0]!==1/0&&f.insert(c,v.aabb.min[0],v.aabb.min[1],v.aabb.max[0],v.aabb.max[1]);if(g.children)for(const v of g.children)EV(v,c,f)}const IV=["","wall","door","roof","window","lamp","logo"];class RV{constructor(c){this.node=c,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:c.id,geometry:[],properties:{height:CV(c)}},this.aabb=this._getLocalBounds()}_getLocalBounds(){if(!this.node.meshes)return new Yi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let c=0;const f=new Yi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const v of this.node.meshes)this.node.lightMeshIndex!==c&&(v.transformedAabb=Yi.applyTransformFast(v.aabb,this.node.matrix),f.encapsulate(v.transformedAabb)),c++;this.aabb=f}return this.aabb}}class $M{constructor(c,f,v,S,x,A){this.id=f,this.modelTraits|=Wx.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,v&&(this.modelTraits|=Wx.HasMapboxMeshFeatures),S&&(this.modelTraits|=Wx.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=x,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const D of c)this.nodesInfo.push(new RV(D)),EV(D,A.featureIndexArray.length,A.grid),A.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,A.bucketLayerIDs.length-1,0)}updateFootprints(c,f){for(const v of this.getNodesInfo()){const S=v.node;S.footprint&&f.push({footprint:S.footprint,id:c})}}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(c){if(!this.needsUpload)return;const f=this.getNodesInfo();for(const v of f){const S=v.node;this.uploaded?this.updatePbrBuffer(S):q3(S,c,!0)}for(const v of f)XM(v.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(c){let f=!1;if(!c.meshes)return f;for(const v of c.meshes)v.pbrBuffer&&(v.pbrBuffer.updateData(v.featureArray),f=!0);return f}needsReEvaluation(c,f,v){const S=c.transform.projectionOptions,x=c.style.getBrightness(),A=this.brightness!==x;return!!(!this.uploaded||this.dirty||S.name!==this.projection.name||Jw(v.paint.get("model-color").value,A)||Jw(v.paint.get("model-color-mix-intensity").value,A)||Jw(v.paint.get("model-roughness").value,A)||Jw(v.paint.get("model-emissive-strength").value,A)||Jw(v.paint.get("model-height-based-emissive-strength-multiplier").value,A))&&(this.projection=S,this.brightness=x,!0)}evaluateScale(c,f){if(c.transform.zoom===this.zoom)return;this.zoom=c.transform.zoom;const v=this.getNodesInfo(),S=this.id.canonical;for(const x of v){const A=x.feature;x.evaluatedScale=f.paint.get("model-scale").evaluate(A,{},S)}}evaluate(c){const f=this.getNodesInfo();for(const v of f){if(!v.node.meshes)continue;const S=v.feature,x=v.node.meshes&&v.node.meshes[0].featureData,A=v.evaluatedColor[2],D=v.evaluatedRMEA[2],U=this.id.canonical;if(v.hasTranslucentParts=!1,x){for(let H=0;H<IV.length;H++){const R=IV[H];R.length&&(S.properties.part=R);const N=c.paint.get("model-color").evaluate(S,{},U).toRenderColor(null),G=c.paint.get("model-color-mix-intensity").evaluate(S,{},U);v.evaluatedColor[H]=[N.r,N.g,N.b,G],v.evaluatedRMEA[H][0]=c.paint.get("model-roughness").evaluate(S,{},U),v.evaluatedRMEA[H][2]=c.paint.get("model-emissive-strength").evaluate(S,{},U),v.evaluatedRMEA[H][3]=N.a,v.emissionHeightBasedParams[H]=c.paint.get("model-height-based-emissive-strength-multiplier").evaluate(S,{},U),!v.hasTranslucentParts&&N.a<1&&(v.hasTranslucentParts=!0)}delete S.properties.part,whe(v,A!==v.evaluatedColor[2]||D!==v.evaluatedRMEA[2],this.modelTraits)}else v.evaluatedRMEA[0][2]=c.paint.get("model-emissive-strength").evaluate(S,{},U);v.evaluatedScale=c.paint.get("model-scale").evaluate(S,{},U),this.updatePbrBuffer(v.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(c,f,v,S){const x=c.findDEMTileFor(v);if(x&&(x.tileID.canonical!==this.terrainTile||f!==this.terrainExaggeration)){if(x.dem&&x.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=x.tileID.overscaledZ;const A=Xx.create(c,v,x);if(!A)return;this.modelTraits&Wx.HasMapboxMeshFeatures&&this.updateDEM(c,A,v,S);for(const D of this.getNodesInfo()){const U=D.node;if(!U.footprint||!U.footprint.vertices||!U.footprint.vertices.length)continue;const H=U.footprint.vertices;let R=A.getElevationAt(H[0].x,H[0].y,!0,!0);for(let N=1;N<H.length;N++)R=Math.min(R,A.getElevationAt(H[N].x,H[N].y,!0,!0));U.elevation=R}}this.terrainTile=x.tileID.canonical,this.terrainExaggeration=f}}updateDEM(c,f,v,S){let x=f._dem._modifiedForSources[S];if(x===void 0&&(f._dem._modifiedForSources[S]=[],x=f._dem._modifiedForSources[S]),x.includes(v.canonical))return;const A=f._dem.dim;x.push(v.canonical);let D=!1;for(const U of this.getNodesInfo()){const H=U.node;if(!H.footprint||!H.footprint.grid)continue;const R=H.footprint.grid,N=f.tileCoordToPixel(R.min.x,R.min.y),G=f.tileCoordToPixel(R.max.x,R.max.y),z=Math.min(Math.min(A-G.y,N.x),Math.min(N.y,A-G.x));if(z<0)continue;const V=jt(z,2,5);let X=Math.max(0,N.x-V),K=Math.max(0,N.y-V),ee=Math.min(G.x+V,A-1),ce=Math.min(G.y+V,A-1);for(let ge=K;ge<=ce;++ge)for(let Me=X;Me<=ee;++Me)c_[ge*A+Me]=255;let he=0,ne=0;for(let ge=0;ge<R.cellsY;++ge)for(let Me=0;Me<R.cellsX;++Me){if(!R.cells[ge*R.cellsX+Me])continue;const Be=f.tileCoordToPixel(R.min.x+Me/R.xScale,R.min.y+ge/R.yScale),Oe=f.tileCoordToPixel(R.min.x+(Me+1)/R.xScale,R.min.y+(ge+1)/R.yScale);for(let Ie=Be.y;Ie<=Math.min(Oe.y+1,A-1);++Ie)for(let Ye=Be.x;Ye<=Math.min(Oe.x+1,A-1);++Ye)c_[Ie*A+Ye]===255&&(c_[Ie*A+Ye]=0,he+=f.getElevationAtPixel(Ye,Ie),ne++)}const de=he/ne;X=Math.max(1,N.x-V),K=Math.max(1,N.y-V),ee=Math.min(G.x+V,A-2),ce=Math.min(G.y+V,A-2),D=!0;for(let ge=K;ge<=ce;++ge)for(let Me=X;Me<=ee;++Me)c_[ge*A+Me]===0&&(Y3[ge*A+Me]=f._dem.set(Me,ge,de));for(let ge=1;ge<V;++ge){X=Math.max(1,N.x-ge),K=Math.max(1,N.y-ge),ee=Math.min(G.x+ge,A-2),ce=Math.min(G.y+ge,A-2);for(let Me=K;Me<=ce;++Me)for(let Be=X;Be<=ee;++Be){const Oe=Me*A+Be;if(c_[Oe]===255){let Ie=0,Ye=0,ze=-1,Qe=-1;for(let lt=-1;lt<=1;++lt)for(let ut=-1;ut<=1;++ut){const ht=(Me+lt)*A+Be+ut;if(c_[ht]>=ge)continue;const mt=Y3[ht],Et=Math.abs(mt);Et>Ye&&(Ie=mt,Ye=Et,ze=ut,Qe=lt)}if(Ye>.1){const lt=1-(ge+.5*Math.abs(ze*Qe))/V;let ut=f._dem.get(Be,Me)+Ie*lt;const ht=f._dem.get(Be+ze,Me+Qe),mt=f._dem.get(Be-ze,Me-Qe,!0);(ut-ht)*(ut-mt)>0&&(ut=(ht+mt)/2),Y3[Oe]=f._dem.set(Be,Me,ut),c_[Oe]=ge}}}}}D&&(f._demTile.needsDEMTextureUpload=!0,f._dem._timestamp=Cn.now())}getNodesInfo(){return this.nodesInfo}destroy(){const c=this.getNodesInfo();for(const f of c)XM(f.node),Z3(f.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(c,f){if(f.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=f.updateTime;const v=f.getReplacementRegionsForTile(c.toUnwrapped()),S=this.getNodesInfo();for(let x=0;x<this.nodesInfo.length;x++){const A=S[x].node;S[x].hiddenByReplacement=!!A.footprint&&!v.find(D=>D.footprint===A.footprint)}}getHeightAtTileCoord(c,f){const v=this.getNodesInfo(),S=[],x=[0,0,0],A=Pe.mat4.identity([]);for(let D=0;D<this.nodesInfo.length;D++){const U=v[D],H=U.node.meshes[0],R=H.transformedAabb;if(c<R.min[0]||f<R.min[1]||c>R.max[0]||f>R.max[1])continue;if(U.node.hidden===!0)return{height:1/0,maxHeight:U.feature.properties.height,hidden:!1,verticalScale:U.evaluatedScale[2]};Pe.mat4.invert(A,U.node.matrix),x[0]=c,x[1]=f,Pe.vec3.transformMat4(x,x,A);const N=(x[0]-H.aabb.min[0])/(H.aabb.max[0]-H.aabb.min[0])*l_|0,G=Math.min(63,(x[1]-H.aabb.min[1])/(H.aabb.max[1]-H.aabb.min[1])*l_|0)*l_+Math.min(63,N),z=H.heightmap[G];if(!(z<0&&U.node.footprint))return U.hiddenByReplacement?void 0:{height:z,maxHeight:U.feature.properties.height,hidden:!1,verticalScale:U.evaluatedScale[2]};if(U.node.footprint.grid.query(new St(c,f),new St(c,f),S),S.length>0)return{height:void 0,maxHeight:U.feature.properties.height,hidden:U.hiddenByReplacement,verticalScale:U.evaluatedScale[2]}}}}function Jw(g,c){return!g.isLightConstant&&c}function bhe(g,c,f,v,S,x,A,D){let U=(61440&c|(61440&c)>>4)>>8,H=(3840&c|(3840&c)>>4)>>4,R=240&c|(240&c)>>4;f[3]>0&&(U=cr(U,255*f[0],f[3]),H=cr(H,255*f[1],f[3]),R=cr(R,255*f[2],f[3]));const N=U<<8|H,G=R<<8|Math.floor(255*v[3]),z=function(ge){const Me=jt(ge,0,2);return Math.min(Math.round(.5*Me*255),255)}(v[2])<<8|15*v[0]<<4|15*v[1],V=jt(S[0],0,1),X=jt(S[1],0,1),K=jt(S[2],0,1),ee=jt(S[3],0,1);let ce,he,ne,de;if(V!==X&&A!==x&&X!==V){const ge=A-x;he=1/(ge*(X-V)),ne=-(x+ge*V)/(ge*(X-V));const Me=jt(S[4],-1,1);de=Math.pow(10,Me),ce=255*K<<8|255*ee}else ce=65535,he=0,ne=1,de=1;if(g.emplaceBack(N,G,z,ce,he,ne,de),D){const ge=D.length;D.clear();for(let Me=0;Me<ge;Me++)D.emplaceBack(N,G,z,ce,he,ne,de)}}function whe(g,c,f){const v=g.node;let S=0;const x=f&Wx.HasMeshoptCompression;for(const A of v.meshes){if(v.lights&&v.lightMeshIndex===S||!A.featureData)continue;A.featureArray=new la,A.featureArray.reserve(A.featureData.length);let D=c;for(const U of A.featureData){const H=x?65535&U:U>>16&65535,R=x?U>>16&65535:65535&U,N=(15&R)<8?15&R:0,G=g.evaluatedRMEA[N],z=g.evaluatedColor[N],V=g.emissionHeightBasedParams[N];let X;if(D&&N===2&&v.lights&&(X=new la,X.resize(10*v.lights.length)),bhe(A.featureArray,H,z,G,V,A.aabb.min[2],A.aabb.max[2],X),X&&D){D=!1;const K=v.meshes[v.lightMeshIndex];K.featureArray=X,K.featureArray._trim()}}A.featureArray._trim(),S++}}function PV(g,c,f,v){const S=1<<g.z;c.lat=Ge((v/yn+g.y)/S),c.lng=je((f/yn+g.x)/S)}Fn($M,"Tiled3dModelBucket",{omit:["layers"]}),Fn(RV,"Tiled3dModelFeature");const She={circle:class extends Gs{constructor(g,c,f,v){super(g,{layout:Si||(Si=new Hi({"circle-sort-key":new Kn(At.layout_circle["circle-sort-key"]),visibility:new gn(At.layout_circle.visibility)})),paint:Fs||(Fs=new Hi({"circle-radius":new Kn(At.paint_circle["circle-radius"]),"circle-color":new Kn(At.paint_circle["circle-color"]),"circle-blur":new Kn(At.paint_circle["circle-blur"]),"circle-opacity":new Kn(At.paint_circle["circle-opacity"]),"circle-translate":new gn(At.paint_circle["circle-translate"]),"circle-translate-anchor":new gn(At.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new gn(At.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new gn(At.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Kn(At.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Kn(At.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Kn(At.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new gn(At.paint_circle["circle-emissive-strength"])}))},c,f,v)}createBucket(g){return new er(g)}queryRadius(g){const c=g;return bs("circle-radius",this,c)+bs("circle-stroke-width",this,c)+Pi(this.paint.get("circle-translate"))}queryIntersectsFeature(g,c,f,v,S,x,A,D){const U=di(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),x.angle,g.pixelToTileUnitsFactor),H=this.paint.get("circle-radius").evaluate(c,f)+this.paint.get("circle-stroke-width").evaluate(c,f);return c9(g,v,x,A,D,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",U,H)}getProgramIds(){return["circle"]}getDefaultProgramParams(g,c,f){const v=l9(this);return{config:new on(this,{zoom:c,lut:f}),defines:v,overrideFog:!1}}},heatmap:class extends Gs{createBucket(g){return new h9(g)}constructor(g,c,f,v){super(g,{layout:f9||(f9=new Hi({visibility:new gn(At.layout_heatmap.visibility)})),paint:d9||(d9=new Hi({"heatmap-radius":new Kn(At.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Kn(At.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new gn(At.paint_heatmap["heatmap-intensity"]),"heatmap-color":new oc(At.paint_heatmap["heatmap-color"]),"heatmap-opacity":new gn(At.paint_heatmap["heatmap-opacity"])}))},c,f,v),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(g){g==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Pw({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(g){return bs("heatmap-radius",this,g)}queryIntersectsFeature(g,c,f,v,S,x,A,D){const U=this.paint.get("heatmap-radius").evaluate(c,f);return c9(g,v,x,A,D,!0,!0,new St(0,0),U)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(g,c,f){return g==="heatmap"?{config:new on(this,{zoom:c,lut:f}),overrideFog:!1}:{}}},hillshade:class extends Gs{constructor(g,c,f,v){super(g,{layout:p9||(p9=new Hi({visibility:new gn(At.layout_hillshade.visibility)})),paint:m9||(m9=new Hi({"hillshade-illumination-direction":new gn(At.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new gn(At.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new gn(At.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new gn(At.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new gn(At.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new gn(At.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new gn(At.paint_hillshade["hillshade-emissive-strength"])}))},c,f,v)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(g,c,f){return{overrideFog:!1}}},fill:class extends Gs{constructor(g,c,f,v){super(g,{layout:S9||(S9=new Hi({"fill-sort-key":new Kn(At.layout_fill["fill-sort-key"]),visibility:new gn(At.layout_fill.visibility)})),paint:A9||(A9=new Hi({"fill-antialias":new gn(At.paint_fill["fill-antialias"]),"fill-opacity":new Kn(At.paint_fill["fill-opacity"]),"fill-color":new Kn(At.paint_fill["fill-color"]),"fill-outline-color":new Kn(At.paint_fill["fill-outline-color"]),"fill-translate":new gn(At.paint_fill["fill-translate"]),"fill-translate-anchor":new gn(At.paint_fill["fill-translate-anchor"]),"fill-pattern":new Kn(At.paint_fill["fill-pattern"]),"fill-emissive-strength":new gn(At.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Kn(At.paint_fill["fill-z-offset"])}))},c,f,v)}getProgramIds(){const g=this.paint.get("fill-pattern"),c=g&&g.constantOr(1),f=[c?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&f.push(c&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),f}getDefaultProgramParams(g,c,f){return{config:new on(this,{zoom:c,lut:f}),overrideFog:!1}}recalculate(g,c){super.recalculate(g,c);const f=this.paint._values["fill-outline-color"];f.value.kind==="constant"&&f.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(g){return new d3(g)}queryRadius(){return Pi(this.paint.get("fill-translate"))}queryIntersectsFeature(g,c,f,v,S,x){return!g.queryGeometry.isAboveHorizon&&yr(kr(g.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),x.angle,g.pixelToTileUnitsFactor),v)}isTileClipped(){return!0}is3D(){return this.paint.get("fill-z-offset").constantOr(1)!==0}},"fill-extrusion":class extends Gs{constructor(g,c,f,v){super(g,{layout:s7||(s7=new Hi({visibility:new gn(At["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new gn(At["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:o7||(o7=new Hi({"fill-extrusion-opacity":new gn(At["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Kn(At["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new gn(At["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new gn(At["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Kn(At["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Kn(At["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Kn(At["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new gn(At["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new gn(At["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new gn(At["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new gn(At["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new gn(At["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new gn(At["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new gn(At["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new gn(At["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Kn(At["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Kn(At["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new gn(At["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new gn(At["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new gn(At["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new gn(At["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Kn(At["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Kn(At["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new gn(At["paint_fill-extrusion"]["fill-extrusion-cast-shadows"])}))},c,f,v),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(g){return new AM(g)}queryRadius(){return Pi(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(g,c,f,v,S,x,A,D,U){const H=di(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),x.angle,g.pixelToTileUnitsFactor),R=this.paint.get("fill-extrusion-height").evaluate(c,f),N=this.paint.get("fill-extrusion-base").evaluate(c,f),G=[0,0],z=D&&x.elevation,V=x.elevation?x.elevation.exaggeration():1,X=g.tile.getBucket(this);if(z&&X instanceof AM){const ne=X.centroidVertexArray,de=U+1;de<ne.length&&(G[0]=ne.geta_centroid_pos0(de),G[1]=ne.geta_centroid_pos1(de))}if(G[0]===0&&G[1]===1)return!1;x.projection.name==="globe"&&(v=i7([v],[new St(0,0),new St(yn,yn)],g.tileID.canonical).map(ne=>ne.polygon).flat());const K=z?D:null,[ee,ce]=function(ne,de,ge,Me,Be,Oe,Ie,Ye,ze,Qe,lt){return ne.projection.name==="globe"?function(ut,ht,mt,Et,vt,Ut,Yt,Dt,Rn,bn,dn){const tn=[],nr=[],In=ut.projection.upVectorScale(dn,ut.center.lat,ut.worldSize).metersToTile,Nn=[0,0,0,1],wr=[0,0,0,1],Or=(Lr,jr,Wr,zi)=>{Lr[0]=jr,Lr[1]=Wr,Lr[2]=zi,Lr[3]=1},Pr=r7();mt>0&&(mt+=Pr),Et+=Pr;for(const Lr of ht){const jr=[],Wr=[];for(const zi of Lr){const Ai=zi.x+vt.x,Tr=zi.y+vt.y,gi=ut.projection.projectTilePoint(Ai,Tr,dn),xi=ut.projection.upVector(dn,zi.x,zi.y);let rs=mt,Hs=Et;if(Yt){const fo=l7(Ai,Tr,mt,Et,Yt,Dt,Rn,bn);rs+=fo.base,Hs+=fo.top}mt!==0?Or(Nn,gi.x+xi[0]*In*rs,gi.y+xi[1]*In*rs,gi.z+xi[2]*In*rs):Or(Nn,gi.x,gi.y,gi.z),Or(wr,gi.x+xi[0]*In*Hs,gi.y+xi[1]*In*Hs,gi.z+xi[2]*In*Hs),Pe.vec3.transformMat4(Nn,Nn,Ut),Pe.vec3.transformMat4(wr,wr,Ut),jr.push(new a_(Nn[0],Nn[1],Nn[2])),Wr.push(new a_(wr[0],wr[1],wr[2]))}tn.push(jr),nr.push(Wr)}return[tn,nr]}(ne,de,ge,Me,Be,Oe,Ie,Ye,ze,Qe,lt):Ie?function(ut,ht,mt,Et,vt,Ut,Yt,Dt,Rn){const bn=[],dn=[],tn=[0,0,0,1];for(const nr of ut){const In=[],Nn=[];for(const wr of nr){const Or=wr.x+Et.x,Pr=wr.y+Et.y,Lr=l7(Or,Pr,ht,mt,Ut,Yt,Dt,Rn);tn[0]=Or,tn[1]=Pr,tn[2]=Lr.base,tn[3]=1,Pe.vec4.transformMat4(tn,tn,vt),tn[3]=Math.max(tn[3],1e-5);const jr=new a_(tn[0]/tn[3],tn[1]/tn[3],tn[2]/tn[3]);tn[0]=Or,tn[1]=Pr,tn[2]=Lr.top,tn[3]=1,Pe.vec4.transformMat4(tn,tn,vt),tn[3]=Math.max(tn[3],1e-5);const Wr=new a_(tn[0]/tn[3],tn[1]/tn[3],tn[2]/tn[3]);In.push(jr),Nn.push(Wr)}bn.push(In),dn.push(Nn)}return[bn,dn]}(de,ge,Me,Be,Oe,Ie,Ye,ze,Qe):function(ut,ht,mt,Et,vt){const Ut=[],Yt=[],Dt=vt[8]*ht,Rn=vt[9]*ht,bn=vt[10]*ht,dn=vt[11]*ht,tn=vt[8]*mt,nr=vt[9]*mt,In=vt[10]*mt,Nn=vt[11]*mt;for(const wr of ut){const Or=[],Pr=[];for(const Lr of wr){const jr=Lr.x+Et.x,Wr=Lr.y+Et.y,zi=vt[0]*jr+vt[4]*Wr+vt[12],Ai=vt[1]*jr+vt[5]*Wr+vt[13],Tr=vt[2]*jr+vt[6]*Wr+vt[14],gi=vt[3]*jr+vt[7]*Wr+vt[15],xi=zi+Dt,rs=Ai+Rn,Hs=Tr+bn,fo=Math.max(gi+dn,1e-5),js=zi+tn,Bs=Ai+nr,ca=Tr+In,wo=Math.max(gi+Nn,1e-5);Or.push(new a_(xi/fo,rs/fo,Hs/fo)),Pr.push(new a_(js/wo,Bs/wo,ca/wo))}Ut.push(Or),Yt.push(Pr)}return[Ut,Yt]}(de,ge,Me,Be,Oe)}(x,v,N,R,H,A,K,G,V,x.center.lat,g.tileID.canonical),he=g.queryGeometry;return function(ne,de,ge){let Me=1/0;yr(ge,de)&&(Me=a7(ge,de[0]));for(let Be=0;Be<de.length;Be++){const Oe=de[Be],Ie=ne[Be];for(let Ye=0;Ye<Oe.length-1;Ye++){const ze=Oe[Ye],Qe=[ze,Oe[Ye+1],Ie[Ye+1],Ie[Ye],ze];xn(ge,Qe)&&(Me=Math.min(Me,a7(ge,Qe)))}}return Me!==1/0&&Me}(ee,ce,he.isPointQuery()?he.screenBounds:he.screenGeometry)}},line:class extends Gs{constructor(g,c,f,v){const S=_7();super(g,S,c,f,v),S.layout&&(this.layout=new Yu(S.layout)),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(g){if(g==="line-gradient"){const c=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=c._styleExpression&&c._styleExpression.expression instanceof md,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(g,c){super.recalculate(g,c),this.paint._values["line-floorwidth"]=(()=>{if(Uw)return Uw;const f=_7();return Uw=new Mue(f.paint.properties["line-width"].specification),Uw.useIntegerZoom=!0,Uw})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,g)}createBucket(g){return new S3(g)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(g,c,f){const v=g7(this);return{config:new on(this,{zoom:c,lut:f}),defines:v,overrideFog:!1}}queryRadius(g){const c=g,f=y7(bs("line-width",this,c),bs("line-gap-width",this,c)),v=bs("line-offset",this,c);return f/2+Math.abs(v)+Pi(this.paint.get("line-translate"))}queryIntersectsFeature(g,c,f,v,S,x){if(g.queryGeometry.isAboveHorizon)return!1;const A=kr(g.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),x.angle,g.pixelToTileUnitsFactor),D=g.pixelToTileUnitsFactor/2*y7(this.paint.get("line-width").evaluate(c,f),this.paint.get("line-gap-width").evaluate(c,f)),U=this.paint.get("line-offset").evaluate(c,f);return U&&(v=function(H,R){const N=[],G=new St(0,0);for(let z=0;z<H.length;z++){const V=H[z],X=[];for(let K=0;K<V.length;K++){const ee=V[K],ce=V[K+1],he=K===0?G:ee.sub(V[K-1])._unit()._perp(),ne=K===V.length-1?G:ce.sub(ee)._unit()._perp(),de=he._add(ne)._unit();de._mult(1/(de.x*ne.x+de.y*ne.y)),X.push(de._mult(R)._add(ee))}N.push(X)}return N}(v,U*g.pixelToTileUnitsFactor)),function(H,R,N){for(let G=0;G<R.length;G++){const z=R[G];if(H.length>=3){for(let V=0;V<z.length;V++)if(ns(H,z[V]))return!0}if(qn(H,z,N))return!0}return!1}(A,v,D)}isTileClipped(){return!0}isDraped(g){const c=this.layout.get("line-z-offset");return c.isConstant()&&!c.constantOr(0)}},symbol:zM,background:class extends Gs{constructor(g,c,f,v){super(g,{layout:nV||(nV=new Hi({visibility:new gn(At.layout_background.visibility)})),paint:rV||(rV=new Hi({"background-pitch-alignment":new gn(At.paint_background["background-pitch-alignment"]),"background-color":new gn(At.paint_background["background-color"]),"background-pattern":new gn(At.paint_background["background-pattern"]),"background-opacity":new gn(At.paint_background["background-opacity"]),"background-emissive-strength":new gn(At.paint_background["background-emissive-strength"])}))},c,f,v)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(g,c,f){return{overrideFog:!1}}is3D(){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:lV,"raster-particle":pV,sky:class extends Gs{constructor(g,c,f,v){super(g,{layout:hV||(hV=new Hi({visibility:new gn(At.layout_sky.visibility)})),paint:fV||(fV=new Hi({"sky-type":new gn(At.paint_sky["sky-type"]),"sky-atmosphere-sun":new gn(At.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new gn(At.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new gn(At.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new gn(At.paint_sky["sky-gradient-radius"]),"sky-gradient":new oc(At.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new gn(At.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new gn(At.paint_sky["sky-atmosphere-color"]),"sky-opacity":new gn(At.paint_sky["sky-opacity"])}))},c,f,v),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(g){g==="sky-gradient"?this._updateColorRamp():g!=="sky-atmosphere-sun"&&g!=="sky-atmosphere-halo-color"&&g!=="sky-atmosphere-color"&&g!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Pw({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(g){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const c=g.style.light.properties.get("position");return this._lightPosition.azimuthal!==c.azimuthal||this._lightPosition.polar!==c.polar}return!1}getCenter(g,c){if(this.paint.get("sky-type")==="atmosphere"){const v=this.paint.get("sky-atmosphere-sun"),S=!v,x=g.style.light,A=x.properties.get("position");return S&&x.properties.get("anchor")==="viewport"&&Lt("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),S?j3(A.azimuthal,90-A.polar,c):j3(v[0],90-v[1],c)}const f=this.paint.get("sky-gradient-center");return j3(f[0],90-f[1],c)}isSky(){return!0}markSkyboxValid(g){this._skyboxInvalidated=!1,this._lightPosition=g.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const g=this.paint.get("sky-type");return g==="atmosphere"?["skyboxCapture","skybox"]:g==="gradient"?["skyboxGradient"]:null}},slot:class extends Gs{constructor(g,c,f,v){super(g,{paint:dV||(dV=new Hi({}))},c,null)}},model:class extends Gs{constructor(g,c,f,v){super(g,{layout:AV||(AV=new Hi({visibility:new gn(At.layout_model.visibility),"model-id":new Kn(At.layout_model["model-id"])})),paint:TV||(TV=new Hi({"model-opacity":new gn(At.paint_model["model-opacity"]),"model-rotation":new Kn(At.paint_model["model-rotation"]),"model-scale":new Kn(At.paint_model["model-scale"]),"model-translation":new Kn(At.paint_model["model-translation"]),"model-color":new Kn(At.paint_model["model-color"]),"model-color-mix-intensity":new Kn(At.paint_model["model-color-mix-intensity"]),"model-type":new gn(At.paint_model["model-type"]),"model-cast-shadows":new gn(At.paint_model["model-cast-shadows"]),"model-receive-shadows":new gn(At.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new gn(At.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Kn(At.paint_model["model-emissive-strength"]),"model-roughness":new Kn(At.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Kn(At.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new gn(At.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new gn(At.paint_model["model-front-cutoff"])}))},c,f,v),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(g){return new $3(g)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(g){return g instanceof $M?yn-1:0}queryIntersectsFeature(g,c,f,v,S,x){if(!this.modelManager)return!1;const A=this.modelManager,D=g.tile.getBucket(this);if(!(D&&D instanceof $3))return!1;const U=D;for(const H in U.instancesPerModel){const R=U.instancesPerModel[H],N=c.id!==void 0?c.id:c.properties&&c.properties.hasOwnProperty("id")?c.properties.id:void 0;if(R.idToFeaturesIndex.hasOwnProperty(N)){const G=R.features[R.idToFeaturesIndex[N]],z=A.getModel(H,this.scope);if(!z)return!1;let V=Pe.mat4.create();const X=new ue(0,0),K=U.canonical;let ee=Number.MAX_VALUE;for(let ce=0;ce<G.instancedDataCount;++ce){const he=16*(G.instancedDataOffset+ce),ne=R.instancedDataArray.float32,de=[ne[he+4],ne[he+5],ne[he+6]];PV(K,X,ne[he],0|ne[he+1]),MV(V,z,x,X,G.rotation,G.scale,de,!1,!1,!1),x.projection.name==="globe"&&(V=X3(V,x));const ge=Pe.mat4.multiply([],x.projMatrix,V),Me=g.queryGeometry,Be=yV(Me.isPointQuery()?Me.screenBounds:Me.screenGeometry,x,ge,z.aabb);Be!=null&&(ee=Math.min(Be,ee))}return ee!==Number.MAX_VALUE&&ee}}return!1}_handleOverridablePaintPropertyUpdate(g,c,f){return!(!this.layout||c.isDataDriven()||f.isDataDriven()||g!=="model-color"&&g!=="model-color-mix-intensity"&&g!=="model-rotation"&&g!=="model-scale"&&g!=="model-translation"&&g!=="model-emissive-strength")}_isPropertyZoomDependent(g){const c=this._transitionablePaint._values[g];return c!=null&&c.value!=null&&c.value.expression!=null&&c.value.expression instanceof hl}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(g,c,f,v){const S=g.tile,x=S.getBucket(this);let A=null,D=Number.MAX_VALUE;if(!(x&&x instanceof $M))return{queryFeature:A,intersectionZ:D};const U=x.getNodesInfo()[c];if(U.hiddenByReplacement||!U.node.meshes||!f.filter(new hs(S.tileID.overscaledZ),U.feature,S.tileID.canonical))return{queryFeature:A,intersectionZ:D};const H=U.node,R=v.calculatePosMatrix(S.tileID.toUnwrapped(),v.worldSize),N=U.evaluatedScale;let G=0;v.elevation&&H.elevation&&(G=H.elevation*v.elevation.exaggeration()),Pe.mat4.translate(R,R,[(H.anchor?H.anchor[0]:0)*(N[0]-1),(H.anchor?H.anchor[1]:0)*(N[1]-1),G]),Pe.mat4.scale(R,R,N),Pe.mat4.multiply(R,R,H.matrix);const z=g.queryGeometry,V=z.isPointQuery()?z.screenBounds:z.screenGeometry,X=function(ee){const ce=Pe.mat4.multiply([],R,ee.matrix),he=Pe.mat4.multiply(ce,v.expandedFarZProjMatrix,ce);for(let ne=0;ne<ee.meshes.length;++ne){const de=ee.meshes[ne];if(ne===ee.lightMeshIndex)continue;const ge=yV(V,v,he,de.aabb);ge!=null&&(D=Math.min(ge,D))}if(ee.children)for(const ne of ee.children)X(ne)};if(X(H),D===Number.MAX_VALUE)return{queryFeature:A,intersectionZ:D};const K=new ue(0,0);return PV(S.tileID.canonical,K,U.node.anchor[0],U.node.anchor[1]),A={type:"Feature",geometry:{type:"Point",coordinates:[K.lng,K.lat]},properties:U.feature.properties,id:U.feature.id,state:{},layer:this.serialize()},{queryFeature:A,intersectionZ:D}}},clip:class extends Gs{constructor(g,c,f,v){super(g,{layout:T9||(T9=new Hi({"clip-layer-types":new gn(At.layout_clip["clip-layer-types"]),"clip-layer-scope":new gn(At.layout_clip["clip-layer-scope"])})),paint:M9||(M9=new Hi({}))},c,f,v)}recalculate(g,c){super.recalculate(g,c)}createBucket(g){return new C9(g)}isTileClipped(){return!0}is3D(){return!0}}};class Ahe{constructor(c){this._callback=c,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class The{constructor(){this.tasks={},this.taskQueue=[],Fr(["process"],this),this.invoker=new Ahe(this.process),this.nextId=0}add(c,f){const v=this.nextId++,S=function({type:x,isSymbolTile:A,zoom:D}){return D=D||0,x==="message"?0:x!=="maybePrepare"||A?x!=="parseTile"||A?x==="parseTile"&&A?300-D:x==="maybePrepare"&&A?400-D:500:200-D:100-D}(f);if(S===0){try{c()}finally{}return null}return this.tasks[v]={fn:c,metadata:f,priority:S,id:v},this.taskQueue.push(v),this.invoker.trigger(),{cancel:()=>{delete this.tasks[v]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(v=>!!this.tasks[v]),!this.taskQueue.length)return;const c=this.pick();if(c===null)return;const f=this.tasks[c];if(delete this.tasks[c],this.taskQueue.length&&this.invoker.trigger(),!f)return;f.fn()}finally{}}pick(){let c=null,f=1/0;for(let S=0;S<this.taskQueue.length;S++){const x=this.tasks[this.taskQueue[S]];x.priority<f&&(f=x.priority,c=S)}if(c===null)return null;const v=this.taskQueue[c];return this.taskQueue.splice(c,1),v}remove(){this.invoker.remove()}}class LV{constructor(c,f,v){this.target=c,this.parent=f,this.mapId=v,this.callbacks={},this.cancelCallbacks={},Fr(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new The}send(c,f,v,S,x=!1,A){const D=Math.round(1e18*Math.random()).toString(36).substring(0,10);v&&(v.metadata=A,this.callbacks[D]=v);const U=new Set;return this.target.postMessage({id:D,type:c,hasCallback:!!v,targetMapId:S,mustQueue:x,sourceMapId:this.mapId,data:_a(f,U)},U),{cancel:()=>{v&&delete this.callbacks[D],this.target.postMessage({id:D,type:"<cancel>",targetMapId:S,sourceMapId:this.mapId})}}}receive(c){const f=c.data,v=f.id;if(v&&(!f.targetMapId||this.mapId===f.targetMapId))if(f.type==="<cancel>"){const S=this.cancelCallbacks[v];delete this.cancelCallbacks[v],S&&S.cancel()}else if(f.mustQueue||Ar()){const S=this.callbacks[v],x=this.scheduler.add(()=>this.processTask(v,f),S&&S.metadata||{type:"message"});x&&(this.cancelCallbacks[v]=x)}else this.processTask(v,f)}processTask(c,f){if(delete this.cancelCallbacks[c],f.type==="<response>"){const v=this.callbacks[c];delete this.callbacks[c],v&&(f.error?v(qu(f.error)):v(null,qu(f.data)))}else{const v=new Set,S=f.hasCallback?(A,D)=>{this.target.postMessage({id:c,type:"<response>",sourceMapId:this.mapId,error:A?_a(A):null,data:_a(D,v)},v)}:A=>{},x=qu(f.data);if(this.parent[f.type])this.parent[f.type](f.sourceMapId,x,S);else if(this.parent.getWorkerSource){const A=f.type.split(".");this.parent.getWorkerSource(f.sourceMapId,A[0],x.source,x.scope)[A[1]](x,S)}else S(new Error(`Could not find function ${f.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class $x{constructor(c,f){this.workerPool=c,this.actors=[],this.currentActor=0,this.id=ir();const v=this.workerPool.acquire(this.id);for(let S=0;S<v.length;S++){const x=new $x.Actor(v[S],f,this.id);x.name=`Worker ${S}`,this.actors.push(x)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(c,f,v){tr(this.actors,(S,x)=>{S.send(c,f,x)},v=v||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(c=>{c.remove()}),this.actors=[],this.workerPool.release(this.id)}}$x.Actor=LV;class DV{constructor(c){this.size=c,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(c,f){const v=this.toIdx(c,f);return{min:this.minimums[v],max:this.maximums[v]}}isLeaf(c,f){return this.leaves[this.toIdx(c,f)]}toIdx(c,f){return f*this.size+c}}function BV(g,c,f,v){let S=0,x=Number.MAX_VALUE;for(let A=0;A<3;A++)if(Math.abs(v[A])<1e-15){if(f[A]<g[A]||f[A]>c[A])return null}else{const D=1/v[A];let U=(g[A]-f[A])*D,H=(c[A]-f[A])*D;if(U>H){const R=U;U=H,H=R}if(U>S&&(S=U),H<x&&(x=H),S>x)return null}return S}function kV(g,c,f,v,S,x,A,D,U,H,R){const N=v-g,G=S-c,z=x-f,V=A-g,X=D-c,K=U-f,ee=R[1]*K-R[2]*X,ce=R[2]*V-R[0]*K,he=R[0]*X-R[1]*V,ne=N*ee+G*ce+z*he;if(Math.abs(ne)<1e-15)return null;const de=1/ne,ge=H[0]-g,Me=H[1]-c,Be=H[2]-f,Oe=(ge*ee+Me*ce+Be*he)*de;if(Oe<0||Oe>1)return null;const Ie=Me*z-Be*G,Ye=Be*N-ge*z,ze=ge*G-Me*N,Qe=(R[0]*Ie+R[1]*Ye+R[2]*ze)*de;return Qe<0||Oe+Qe>1?null:(V*Ie+X*Ye+K*ze)*de}function OV(g,c,f){return(g-c)/(f-c)}function FV(g,c,f,v,S,x,A,D,U){const H=1<<f,R=x-v,N=A-S,G=(g+1)/H*R+v,z=(c+0)/H*N+S,V=(c+1)/H*N+S;D[0]=(g+0)/H*R+v,D[1]=z,U[0]=G,U[1]=V}class NV{constructor(c){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=c,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const f=function(x){const A=Math.ceil(Math.log2(x.dim/8)),D=[];let U=Math.ceil(Math.pow(2,A));const H=1/U,R=(z,V,X,K,ee)=>{const ce=K?1:0,he=(z+1)*X-ce,ne=V*X,de=(V+1)*X-ce;ee[0]=z*X,ee[1]=ne,ee[2]=he,ee[3]=de};let N=new DV(U);const G=[];for(let z=0;z<U*U;z++){R(z%U,Math.floor(z/U),H,!1,G);const V=e0(G[0],G[1],x),X=e0(G[2],G[1],x),K=e0(G[2],G[3],x),ee=e0(G[0],G[3],x);N.minimums.push(Math.min(V,X,K,ee)),N.maximums.push(Math.max(V,X,K,ee)),N.leaves.push(1)}for(D.push(N),U/=2;U>=1;U/=2){const z=D[D.length-1];N=new DV(U);for(let V=0;V<U*U;V++){R(V%U,Math.floor(V/U),2,!0,G);const X=z.getElevation(G[0],G[1]),K=z.getElevation(G[2],G[1]),ee=z.getElevation(G[2],G[3]),ce=z.getElevation(G[0],G[3]),he=z.isLeaf(G[0],G[1]),ne=z.isLeaf(G[2],G[1]),de=z.isLeaf(G[2],G[3]),ge=z.isLeaf(G[0],G[3]),Me=Math.min(X.min,K.min,ee.min,ce.min),Be=Math.max(X.max,K.max,ee.max,ce.max),Oe=he&&ne&&de&&ge;N.maximums.push(Be),N.minimums.push(Me),N.leaves.push(Be-Me<=5&&Oe?1:0)}D.push(N)}return D}(this.dem),v=f.length-1,S=f[v];this._addNode(S.minimums[0],S.maximums[0],S.leaves[0]),this._construct(f,0,0,v,0)}raycastRoot(c,f,v,S,x,A,D=1){return BV([c,f,-100],[v,S,this.maximums[0]*D],x,A)}raycast(c,f,v,S,x,A,D=1){if(!this.nodeCount)return null;const U=this.raycastRoot(c,f,v,S,x,A,D);if(U==null)return null;const H=[],R=[],N=[],G=[],z=[{idx:0,t:U,nodex:0,nodey:0,depth:0}];for(;z.length>0;){const{idx:V,t:X,nodex:K,nodey:ee,depth:ce}=z.pop();if(this.leaves[V]){FV(K,ee,ce,c,f,v,S,N,G);const ne=1<<ce,de=(K+0)/ne,ge=(K+1)/ne,Me=(ee+0)/ne,Be=(ee+1)/ne,Oe=e0(de,Me,this.dem)*D,Ie=e0(ge,Me,this.dem)*D,Ye=e0(ge,Be,this.dem)*D,ze=e0(de,Be,this.dem)*D,Qe=kV(N[0],N[1],Oe,G[0],N[1],Ie,G[0],G[1],Ye,x,A),lt=kV(G[0],G[1],Ye,N[0],G[1],ze,N[0],N[1],Oe,x,A),ut=Math.min(Qe!==null?Qe:Number.MAX_VALUE,lt!==null?lt:Number.MAX_VALUE);if(ut!==Number.MAX_VALUE)return ut;{const ht=Pe.vec3.scaleAndAdd([],x,A,X);if(zV(Oe,Ie,ze,Ye,OV(ht[0],N[0],G[0]),OV(ht[1],N[1],G[1]))>=ht[2])return X}continue}let he=0;for(let ne=0;ne<this._siblingOffset.length;ne++){FV((K<<1)+this._siblingOffset[ne][0],(ee<<1)+this._siblingOffset[ne][1],ce+1,c,f,v,S,N,G),N[2]=-100,G[2]=this.maximums[this.childOffsets[V]+ne]*D;const de=BV(N,G,x,A);if(de!=null){const ge=de;H[ne]=ge;let Me=!1;for(let Be=0;Be<he&&!Me;Be++)ge>=H[R[Be]]&&(R.splice(Be,0,ne),Me=!0);Me||(R[he]=ne),he++}}for(let ne=0;ne<he;ne++){const de=R[ne];z.push({idx:this.childOffsets[V]+de,t:H[de],nodex:(K<<1)+this._siblingOffset[de][0],nodey:(ee<<1)+this._siblingOffset[de][1],depth:ce+1})}}return null}_addNode(c,f,v){return this.minimums.push(c),this.maximums.push(f),this.leaves.push(v),this.childOffsets.push(0),this.nodeCount++}_construct(c,f,v,S,x){if(c[S].isLeaf(f,v)===1)return;this.childOffsets[x]||(this.childOffsets[x]=this.nodeCount);const A=S-1,D=c[A];let U=0,H=0;for(let R=0;R<this._siblingOffset.length;R++){const N=2*f+this._siblingOffset[R][0],G=2*v+this._siblingOffset[R][1],z=D.getElevation(N,G),V=D.isLeaf(N,G),X=this._addNode(z.min,z.max,V);V&&(U|=1<<R),H||(H=X)}for(let R=0;R<this._siblingOffset.length;R++)U&1<<R||this._construct(c,2*f+this._siblingOffset[R][0],2*v+this._siblingOffset[R][1],A,H+R)}}function zV(g,c,f,v,S,x){return cr(cr(g,f,x),cr(c,v,x),S)}function e0(g,c,f){const v=f.dim,S=jt(g*v-.5,0,v-1),x=jt(c*v-.5,0,v-1),A=Math.floor(S),D=Math.floor(x),U=Math.min(A+1,v-1),H=Math.min(D+1,v-1);return zV(f.get(A,D),f.get(U,D),f.get(A,H),f.get(U,H),S-A,x-D)}const Mhe={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function Che(g,c,f){return(256*g*256+256*c+f)/10-1e4}function Ehe(g,c,f){return 256*g+c+f/256-32768}class qM{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(c,f,v,S=!1){if(this.uid=c,f.height!==f.width)throw new RangeError("DEM tiles must be square");if(v&&v!=="mapbox"&&v!=="terrarium")return void Lt(`"${v}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=f.height;const x=this.dim=f.height-2,A=new Uint32Array(f.data.buffer);if(this.pixels=new Uint8Array(f.data.buffer),this.floatView=new Float32Array(f.data.buffer),this.borderReady=S,this._modifiedForSources={},!S){for(let U=0;U<x;U++)A[this._idx(-1,U)]=A[this._idx(0,U)],A[this._idx(x,U)]=A[this._idx(x-1,U)],A[this._idx(U,-1)]=A[this._idx(U,0)],A[this._idx(U,x)]=A[this._idx(U,x-1)];A[this._idx(-1,-1)]=A[this._idx(0,0)],A[this._idx(x,-1)]=A[this._idx(x-1,0)],A[this._idx(-1,x)]=A[this._idx(0,x-1)],A[this._idx(x,x)]=A[this._idx(x-1,x-1)]}const D=v==="terrarium"?Ehe:Che;for(let U=0;U<A.length;++U){const H=4*U;this.floatView[U]=D(this.pixels[H],this.pixels[H+1],this.pixels[H+2])}this._timestamp=Cn.now()}_buildQuadTree(){this._tree=new NV(this)}get(c,f,v=!1){v&&(c=jt(c,-1,this.dim),f=jt(f,-1,this.dim));const S=this._idx(c,f);return this.floatView[S]}set(c,f,v){const S=this._idx(c,f),x=this.floatView[S];return this.floatView[S]=v,v-x}static getUnpackVector(c){return Mhe[c]}_idx(c,f){if(c<-1||c>=this.dim+1||f<-1||f>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(f+1)*this.stride+(c+1)}static pack(c,f){const v=[0,0,0,0],S=qM.getUnpackVector(f);let x=Math.floor((c+S[3])/S[2]);return v[2]=x%256,x=Math.floor(x/256),v[1]=x%256,x=Math.floor(x/256),v[0]=x,v}getPixels(){return new _9({width:this.stride,height:this.stride},this.pixels)}backfillBorder(c,f,v){if(this.dim!==c.dim)throw new Error("dem dimension mismatch");let S=f*this.dim,x=f*this.dim+this.dim,A=v*this.dim,D=v*this.dim+this.dim;switch(f){case-1:S=x-1;break;case 1:x=S+1}switch(v){case-1:A=D-1;break;case 1:D=A+1}const U=-f*this.dim,H=-v*this.dim;for(let R=A;R<D;R++)for(let N=S;N<x;N++){const G=4*this._idx(N,R),z=4*this._idx(N+U,R+H);this.pixels[G+0]=c.pixels[z+0],this.pixels[G+1]=c.pixels[z+1],this.pixels[G+2]=c.pixels[z+2],this.pixels[G+3]=c.pixels[z+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function Ihe(g,c,f){g===1?c.header_length=f.readFixed32():g===2?c.x=f.readVarint():g===3?c.y=f.readVarint():g===4?c.z=f.readVarint():g===5&&c.layers.push(function(v,S){return v.readFields(Bhe,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},S)}(f,f.readVarint()+f.pos))}function Rhe(g,c,f){g===1?(c.delta_filter=function(v,S){return v.readFields(Phe,{block_size:0},S)}(f,f.readVarint()+f.pos),c.filter="delta_filter"):g===2?(f.readVarint(),c.filter="zigzag_filter"):g===3?(f.readVarint(),c.filter="bitshuffle_filter"):g===4&&(f.readVarint(),c.filter="byteshuffle_filter")}function Phe(g,c,f){g===1&&(c.block_size=f.readVarint())}function Lhe(g,c,f){g===1?(f.readVarint(),c.codec="gzip_data"):g===2?(f.readVarint(),c.codec="jpeg_image"):g===3?(f.readVarint(),c.codec="webp_image"):g===4&&(f.readVarint(),c.codec="png_image")}function Dhe(g,c,f){g===1?c.first_byte=f.readFixed64():g===2?c.last_byte=f.readFixed64():g===3?c.filters.push(function(v,S){return v.readFields(Rhe,{},S)}(f,f.readVarint()+f.pos)):g===4?c.codec=function(v,S){return v.readFields(Lhe,{},S)}(f,f.readVarint()+f.pos):g===5?c.deprecated_offset=f.readFloat():g===6?c.deprecated_scale=f.readFloat():g===7?c.bands.push(f.readString()):g===8?c.offset=f.readDouble():g===9&&(c.scale=f.readDouble())}function Bhe(g,c,f){g===1?c.version=f.readVarint():g===2?c.name=f.readString():g===3?c.units=f.readString():g===4?c.tilesize=f.readVarint():g===5?c.buffer=f.readVarint():g===6?c.pixel_format=f.readVarint():g===7&&c.data_index.push(function(v,S){return v.readFields(Dhe,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,deprecated_offset:0,deprecated_scale:0,bands:[]},S)}(f,f.readVarint()+f.pos))}function khe(g,c,f){if(g===2)(function(v,S,x){v.readFields(Ohe,x,S)})(f,f.readVarint()+f.pos,c);else if(g===3)throw new Error("Not implemented")}function Ohe(g,c,f){if(g===1){let v=0;const S=f.readVarint()+f.pos;for(;f.pos<S;)c[v++]=f.readVarint()}}Fn(qM,"DEMData"),Fn(NV,"DemMinMaxQuadTree",{omit:["dem"]});class Fhe{constructor(c){this.capacity=c,this.cache=new Map}get(c){if(!this.cache.has(c))return;const f=this.cache.get(c);return this.cache.delete(c),this.cache.set(c,f),f}put(c,f){this.cache.has(c)?this.cache.delete(c):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(c,f)}}function Nhe(g,c){if(c.length!==4)throw new Error(`Expected data of dimension 4 but got ${c.length}.`);let f=c[3];for(let v=2;v>=1;v--){const S=v===1?1:0,x=v===2?1:0;for(let A=0;A<c[0];A++){const D=c[1]*A;for(let U=S;U<c[1];U++){const H=c[2]*(U+D);for(let R=x;R<c[2];R++){const N=c[3]*(R+H);for(let G=0;G<c[3];G++){const z=N+G;g[z]+=g[z-f]}}}}f*=c[v]}return g}function zhe(g){for(let c=0,f=g.length;c<f;c++)g[c]=g[c]>>>1^-(1&g[c]);return g}function Uhe(g,c){switch(c){case"uint32":return g;case"uint16":for(let f=0;f<g.length;f+=2){const v=g[f],S=g[f+1];g[f]=(240&v)>>4|(61440&v)>>8|(240&S)<<4|61440&S,g[f+1]=15&v|(3840&v)>>4|(15&S)<<8|(3840&S)<<4}return g;case"uint8":for(let f=0;f<g.length;f+=4){const v=g[f],S=g[f+1],x=g[f+2],A=g[f+3];g[f+0]=(192&v)>>6|(192&S)>>4|(192&x)>>2|192&A,g[f+1]=(48&v)>>4|(48&S)>>2|48&x|(48&A)<<2,g[f+2]=(12&v)>>2|12&S|(12&x)<<2|(12&A)<<4,g[f+3]=3&v|(3&S)<<2|(3&x)<<4|(3&A)<<6}return g;default:throw new Error(`Invalid pixel format, "${c}"`)}}var Au=Uint8Array,Qw=Uint16Array,Vhe=Int32Array,UV=new Au([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),VV=new Au([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Ghe=new Au([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),GV=function(g,c){for(var f=new Qw(31),v=0;v<31;++v)f[v]=c+=1<<g[v-1];var S=new Vhe(f[30]);for(v=1;v<30;++v)for(var x=f[v];x<f[v+1];++x)S[x]=x-f[v]<<5|v;return{b:f,r:S}},HV=GV(UV,2),jV=HV.b,Hhe=HV.r;jV[28]=258,Hhe[258]=28;for(var jhe=GV(VV,0).b,WV=new Qw(32768),ho=0;ho<32768;++ho){var qx=(43690&ho)>>1|(21845&ho)<<1;WV[ho]=((65280&(qx=(61680&(qx=(52428&qx)>>2|(13107&qx)<<2))>>4|(3855&qx)<<4))>>8|(255&qx)<<8)>>1}var e2=function(g,c,f){for(var v=g.length,S=0,x=new Qw(c);S<v;++S)g[S]&&++x[g[S]-1];var A,D=new Qw(c);for(S=1;S<c;++S)D[S]=D[S-1]+x[S-1]<<1;A=new Qw(1<<c);var U=15-c;for(S=0;S<v;++S)if(g[S])for(var H=S<<4|g[S],R=c-g[S],N=D[g[S]-1]++<<R,G=N|(1<<R)-1;N<=G;++N)A[WV[N]>>U]=H;return A},t2=new Au(288);for(ho=0;ho<144;++ho)t2[ho]=8;for(ho=144;ho<256;++ho)t2[ho]=9;for(ho=256;ho<280;++ho)t2[ho]=7;for(ho=280;ho<288;++ho)t2[ho]=8;var XV=new Au(32);for(ho=0;ho<32;++ho)XV[ho]=5;var Whe=e2(t2,9),Xhe=e2(XV,5),K3=function(g){for(var c=g[0],f=1;f<g.length;++f)g[f]>c&&(c=g[f]);return c},vf=function(g,c,f){var v=c/8|0;return(g[v]|g[v+1]<<8)>>(7&c)&f},J3=function(g,c){var f=c/8|0;return(g[f]|g[f+1]<<8|g[f+2]<<16)>>(7&c)},$he=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],_f=function(g,c,f){var v=new Error(c||$he[g]);if(v.code=g,Error.captureStackTrace&&Error.captureStackTrace(v,_f),!f)throw v;return v},qhe=new Au(0),Zhe=typeof TextDecoder<"u"&&new TextDecoder;try{Zhe.decode(qhe,{stream:!0})}catch{}const Yhe={gzip_data:"gzip"};class nh extends Error{constructor(c){super(c),this.name="MRTError"}}const Khe={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},$V={uint32:1,uint16:2,uint8:4},Jhe={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let Q3;class e4{constructor(c=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=c}getLayer(c){const f=this.layers[c];if(!f)throw new nh(`Layer '${c}' not found`);return f}getHeaderLength(c){const f=new Uint8Array(c),v=new DataView(c);if(f[0]!==13)throw new nh("File is not a valid MRT.");return v.getUint32(1,!0)}parseHeader(c){const f=new Uint8Array(c),v=this.getHeaderLength(c);if(f.length<v)throw new nh(`Expected header with length >= ${v} but got buffer of length ${f.length}`);const S=function(x,A){return x.readFields(Ihe,{header_length:0,x:0,y:0,z:0,layers:[]},void 0)}(new Q3(f.subarray(0,v)));if(!isNaN(this.x)&&(this.x!==S.x||this.y!==S.y||this.z!==S.z))throw new nh(`Invalid attempt to parse header ${S.z}/${S.x}/${S.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=S.x,this.y=S.y,this.z=S.z;for(const x of S.layers)this.layers[x.name]=new Qhe(x,{cacheSize:this._cacheSize});return this}createDecodingTask(c){const f=[],v=this.getLayer(c.layerName);for(let S of c.blockIndices){const x=v.dataIndex[S],A=x.first_byte-c.firstByte,D=x.last_byte-c.firstByte;if(v._blocksInProgress.has(S))continue;const U={layerName:v.name,firstByte:A,lastByte:D,pixelFormat:v.pixelFormat,blockIndex:S,blockShape:[x.bands.length].concat(v.bandShape),buffer:v.buffer,codec:x.codec.codec,filters:x.filters.map(H=>H.filter)};v._blocksInProgress.add(S),f.push(U)}return new qV(f,()=>{f.forEach(S=>v._blocksInProgress.delete(S.blockIndex))},(S,x)=>{if(f.forEach(A=>v._blocksInProgress.delete(A.blockIndex)),S)throw S;x.forEach(A=>{this.getLayer(A.layerName).processDecodedData(A)})})}}class Qhe{constructor({version:c,name:f,units:v,tilesize:S,pixel_format:x,buffer:A,data_index:D},U){if(this.version=c,this.version!==1)throw new nh(`Cannot parse raster layer encoded with MRT version ${c}`);this.name=f,this.units=v,this.tileSize=S,this.buffer=A,this.pixelFormat=Khe[x],this.dataIndex=D,this.bandShape=[S+2*A,S+2*A,$V[this.pixelFormat]],this._decodedBlocks=new Fhe(U?U.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return $V[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:c})=>c).flat()}processDecodedData(c){const f=c.blockIndex.toString();this._decodedBlocks.get(f)||this._decodedBlocks.put(f,c.data)}getBlockForBand(c){let f=0;switch(typeof c){case"string":for(const[v,S]of this.dataIndex.entries()){for(const[x,A]of S.bands.entries())if(A===c)return{bandIndex:f+x,blockIndex:v,blockBandIndex:x};f+=S.bands.length}break;case"number":for(const[v,S]of this.dataIndex.entries()){if(c>=f&&c<f+S.bands.length)return{bandIndex:c,blockIndex:v,blockBandIndex:c-f};f+=S.bands.length}break;default:throw new nh(`Invalid band \`${JSON.stringify(c)}\`. Expected string or integer.`)}throw new nh(`Band not found: ${JSON.stringify(c)}`)}getDataRange(c){let f=1/0,v=-1/0;const S=[],x=new Set;for(const A of c){const{blockIndex:D}=this.getBlockForBand(A);if(D<0)throw new nh(`Invalid band: ${JSON.stringify(A)}`);const U=this.dataIndex[D];S.includes(D)||S.push(D),x.add(D),f=Math.min(f,U.first_byte),v=Math.max(v,U.last_byte)}if(x.size>this.cacheSize)throw new nh(`Number of blocks to decode (${x.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:f,lastByte:v,blockIndices:S}}hasBand(c){const{blockIndex:f}=this.getBlockForBand(c);return f>=0}hasDataForBand(c){const{blockIndex:f}=this.getBlockForBand(c);return f>=0&&!!this._decodedBlocks.get(f.toString())}getBandView(c){const{blockIndex:f,blockBandIndex:v}=this.getBlockForBand(c),S=this._decodedBlocks.get(f.toString());if(!S)throw new nh(`Data for band ${JSON.stringify(c)} of layer "${this.name}" not decoded.`);const x=this.dataIndex[f],A=this.bandShape.reduce((H,R)=>H*R,1),D=v*A,U=S.subarray(D,D+A);return{data:U,bytes:new Uint8Array(U.buffer).subarray(U.byteOffset,U.byteOffset+U.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:x.offset!==0?x.offset:x.deprecated_offset,scale:x.scale!==0?x.scale:x.deprecated_scale}}}e4.setPbf=function(g){Q3=g};class qV{constructor(c,f,v){this.tasks=c,this._onCancel=f,this._onComplete=v,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(c,f){this._finalized||(this._onComplete(c,f),this._finalized=!0)}}e4.performDecoding=function(g,c){const f=new Uint8Array(g);return Promise.all(c.tasks.map(v=>{const{layerName:S,firstByte:x,lastByte:A,pixelFormat:D,blockShape:U,blockIndex:H,filters:R,codec:N}=v,G=f.subarray(x,A+1),z=new Uint32Array(U[0]*U[1]*U[2]);let V;if(N!=="gzip_data")throw new nh(`Unhandled codec: ${N}`);return V=function(X,K){if(!globalThis.DecompressionStream&&K==="gzip_data")return Promise.resolve(((ne=function(Me){Me[0]==31&&Me[1]==139&&Me[2]==8||_f(6,"invalid gzip data");var Be=Me[3],Oe=10;4&Be&&(Oe+=2+(Me[10]|Me[11]<<8));for(var Ie=(Be>>3&1)+(Be>>4&1);Ie>0;Ie-=!Me[Oe++]);return Oe+(2&Be)}(he=X))+8>he.length&&_f(6,"invalid gzip data"),function(Me,Be,Oe,Ie){var Ye=Me.length;if(!Ye||Be.f&&!Be.l)return Oe||new Au(0);var ze=!Oe,Qe=ze||Be.i!=2,lt=Be.i;ze&&(Oe=new Au(3*Ye));var ut,ht,mt=function(t0){var f_=Oe.length;if(t0>f_){var l2=new Au(Math.max(2*f_,t0));l2.set(Oe),Oe=l2}},Et=Be.f||0,vt=Be.p||0,Ut=Be.b||0,Yt=Be.l,Dt=Be.d,Rn=Be.m,bn=Be.n,dn=8*Ye;do{if(!Yt){Et=vf(Me,vt,1);var tn=vf(Me,vt+1,3);if(vt+=3,!tn){var nr=Me[(Tr=4+((vt+7)/8|0))-4]|Me[Tr-3]<<8,In=Tr+nr;if(In>Ye){lt&&_f(0);break}Qe&&mt(Ut+nr),Oe.set(Me.subarray(Tr,In),Ut),Be.b=Ut+=nr,Be.p=vt=8*In,Be.f=Et;continue}if(tn==1)Yt=Whe,Dt=Xhe,Rn=9,bn=5;else if(tn==2){var Nn=vf(Me,vt,31)+257,wr=vf(Me,vt+10,15)+4,Or=Nn+vf(Me,vt+5,31)+1;vt+=14;for(var Pr=new Au(Or),Lr=new Au(19),jr=0;jr<wr;++jr)Lr[Ghe[jr]]=vf(Me,vt+3*jr,7);vt+=3*wr;var Wr=K3(Lr),zi=(1<<Wr)-1,Ai=e2(Lr,Wr);for(jr=0;jr<Or;){var Tr,gi=Ai[vf(Me,vt,zi)];if(vt+=15&gi,(Tr=gi>>4)<16)Pr[jr++]=Tr;else{var xi=0,rs=0;for(Tr==16?(rs=3+vf(Me,vt,3),vt+=2,xi=Pr[jr-1]):Tr==17?(rs=3+vf(Me,vt,7),vt+=3):Tr==18&&(rs=11+vf(Me,vt,127),vt+=7);rs--;)Pr[jr++]=xi}}var Hs=Pr.subarray(0,Nn),fo=Pr.subarray(Nn);Rn=K3(Hs),bn=K3(fo),Yt=e2(Hs,Rn),Dt=e2(fo,bn)}else _f(1);if(vt>dn){lt&&_f(0);break}}Qe&&mt(Ut+131072);for(var js=(1<<Rn)-1,Bs=(1<<bn)-1,ca=vt;;ca=vt){var wo=(xi=Yt[J3(Me,vt)&js])>>4;if((vt+=15&xi)>dn){lt&&_f(0);break}if(xi||_f(2),wo<256)Oe[Ut++]=wo;else{if(wo==256){ca=vt,Yt=null;break}var Na=wo-254;wo>264&&(Na=vf(Me,vt,(1<<(xf=UV[jr=wo-257]))-1)+jV[jr],vt+=xf);var Ki=Dt[J3(Me,vt)&Bs],dc=Ki>>4;if(Ki||_f(3),vt+=15&Ki,fo=jhe[dc],dc>3){var xf=VV[dc];fo+=J3(Me,vt)&(1<<xf)-1,vt+=xf}if(vt>dn){lt&&_f(0);break}Qe&&mt(Ut+131072);var rh=Ut+Na;if(Ut<fo){var ih=0-fo,h_=Math.min(fo,rh);for(ih+Ut<0&&_f(3);Ut<h_;++Ut)Oe[Ut]=(void 0)[ih+Ut]}for(;Ut<rh;++Ut)Oe[Ut]=Oe[Ut-fo]}}Be.l=Yt,Be.p=ca,Be.b=Ut,Be.f=Et,Yt&&(Et=1,Be.m=Rn,Be.d=Dt,Be.n=bn)}while(!Et);return Ut!=Oe.length&&ze?(ut=Oe,((ht=Ut)==null||ht>ut.length)&&(ht=ut.length),new Au(ut.subarray(0,ht))):Oe.subarray(0,Ut)}(he.subarray(ne,-8),{i:2},new Au(((ee=he)[(ce=ee.length)-4]|ee[ce-3]<<8|ee[ce-2]<<16|ee[ce-1]<<24)>>>0))));var ee,ce,he,ne;const de=Yhe[K];if(!de)throw new Error(`Unhandled codec: ${K}`);const ge=new globalThis.DecompressionStream(de);return new Response(new Blob([X]).stream().pipeThrough(ge)).arrayBuffer().then(Me=>new Uint8Array(Me))}(G,N).then(X=>(function(K,ee){K.readFields(khe,ee)}(new Q3(X),z),new Jhe[D](z.buffer))),V.then(X=>{for(let K=R.length-1;K>=0;K--)switch(R[K]){case"delta_filter":Nhe(X,U);break;case"zigzag_filter":zhe(X);break;case"bitshuffle_filter":Uhe(X,D);break;default:throw new nh(`Unhandled filter "${R[K]}"`)}return{layerName:S,blockIndex:H,data:X}}).catch(X=>{throw X})}))},Fn(qV,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});var n2={workerUrl:"",workerClass:null,workerParams:void 0};const t4="mapboxgl_preloaded_worker_pool";class r2{constructor(){this.active={}}acquire(c){if(!this.workers)for(this.workers=[];this.workers.length<r2.workerCount;)this.workers.push(n2.workerClass!=null?new n2.workerClass:new self.Worker(n2.workerUrl,n2.workerParams));return this.active[c]=!0,this.workers.slice()}release(c){delete this.active[c],this.workers&&this.numActive()===0&&(this.workers.forEach(f=>{f.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[t4]}numActive(){return Object.keys(this.active).length}}let i2;function ZM(){return i2||(i2=new r2),i2}r2.workerCount=2;let s2,n4,yf,Zx,r4,Yx=null;function ZV(){return Ar()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:n4||nt.DRACO_URL}function YV(){if(Ar()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Zx)return Zx;const g=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Zx=WebAssembly.validate(g)?nt.MESHOPT_SIMD_URL:nt.MESHOPT_URL,Zx}const YM={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},efe={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},o2={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function KV(g,c,f){const v=f.json.bufferViews.length,S=f.buffers.length;c.bufferView=v,f.json.bufferViews[v]={buffer:S,byteLength:g.byteLength},f.buffers[S]=g}const i4="KHR_draco_mesh_compression";function tfe(g,c){const f=g.extensions&&g.extensions[i4];if(!f)return;const v=new yf.Decoder,S=tG(c,f.bufferView),x=new yf.Mesh;if(!v.DecodeArrayToMesh(S,S.byteLength,x))throw new Error("Failed to decode Draco mesh");const A=c.json.accessors[g.indices],D=YM[A.componentType],U=A.count*D.BYTES_PER_ELEMENT,H=yf._malloc(U);D===Uint16Array?v.GetTrianglesUInt16Array(x,U,H):v.GetTrianglesUInt32Array(x,U,H),KV(yf.memory.buffer.slice(H,H+U),A,c),yf._free(H);for(const R of Object.keys(f.attributes)){const N=v.GetAttributeByUniqueId(x,f.attributes[R]),G=c.json.accessors[g.attributes[R]],z=efe[G.componentType],V=G.count*o2[G.type]*YM[G.componentType].BYTES_PER_ELEMENT,X=yf._malloc(V);v.GetAttributeDataArrayForAllPoints(x,N,yf[z],V,X),KV(yf.memory.buffer.slice(X,X+V),G,c),yf._free(X)}v.destroy(),x.destroy(),delete g.extensions[i4]}const KM="EXT_meshopt_compression";function nfe(g,c){if(!g.extensions||!g.extensions[KM])return;const f=g.extensions[KM],v=new Uint8Array(c.buffers[f.buffer],f.byteOffset||0,f.byteLength||0),S=new Uint8Array(f.count*f.byteStride);r4.decodeGltfBuffer(S,f.count,f.byteStride,v,f.mode,f.filter),g.buffer=c.buffers.length,g.byteOffset=0,c.buffers[g.buffer]=S.buffer,delete g.extensions[KM]}const JV=1179937895,QV=new TextDecoder("utf8");function eG(g,c){return new URL(g,c).href}function rfe(g,c,f,v){return fetch(eG(g.uri,v)).then(S=>S.arrayBuffer()).then(S=>{c.buffers[f]=S})}function tG(g,c){const f=g.json.bufferViews[c];return new Uint8Array(g.buffers[f.buffer],f.byteOffset||0,f.byteLength)}function ife(g,c,f,v){if(g.uri){const S=eG(g.uri,v);return fetch(S).then(x=>x.blob()).then(x=>createImageBitmap(x)).then(x=>{c.images[f]=x})}if(g.bufferView!==void 0){const S=tG(c,g.bufferView),x=new Blob([S],{type:g.mimeType});return createImageBitmap(x).then(A=>{c.images[f]=A})}}function nG(g,c=0,f){const v={json:null,images:[],buffers:[]};if(new Uint32Array(g,c,1)[0]===JV){const R=new Uint32Array(g,c);let N=2;const G=(R[N++]>>2)-3,z=R[N++]>>2;if(N++,v.json=JSON.parse(QV.decode(R.subarray(N,N+z))),N+=z,N<G){const V=R[N++];N++;const X=c+(N<<2);v.buffers[0]=g.slice(X,X+V)}}else v.json=JSON.parse(QV.decode(new Uint8Array(g,c)));const{buffers:S,images:x,meshes:A,extensionsUsed:D,bufferViews:U}=v.json;let H=Promise.resolve();if(S){const R=[];for(let N=0;N<S.length;N++){const G=S[N];G.uri?R.push(rfe(G,v,N,f)):v.buffers[N]||(v.buffers[N]=null)}H=Promise.all(R)}return H.then(()=>{const R=[],N=D&&D.includes(i4),G=D&&D.includes(KM);if(N&&R.push(function(){if(!yf)return s2??(s2=function(z){let V,X=null;function K(){V=new Uint8Array(X.buffer)}function ee(){throw new Error("Unexpected Draco error.")}const ce={a:{a:ee,d:function(he,ne,de){return V.copyWithin(he,ne,ne+de)},c:function(he){const ne=V.length,de=Math.max(he>>>0,Math.ceil(1.2*ne)),ge=Math.ceil((de-ne)/65536);try{return X.grow(ge),K(),!0}catch{return!1}},b:ee}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(z,ce):z.then(he=>he.arrayBuffer()).then(he=>WebAssembly.instantiate(he,ce))).then(he=>{const{Rb:ne,Qb:de,P:ge,T:Me,X:Be,Ja:Oe,La:Ie,Qa:Ye,Va:ze,Wa:Qe,eb:lt,jb:ut,f:ht,e:mt,yb:Et,zb:vt,Ab:Ut,Bb:Yt,Db:Dt,Gb:Rn}=he.instance.exports;X=mt;const bn=(()=>{let dn=0,tn=0,nr=0,In=0;return Nn=>{nr&&(ne(In),ne(dn),tn+=nr,nr=dn=0),dn||(tn+=128,dn=de(tn));const wr=Nn.length+7&-8;let Or=dn;wr>=tn&&(nr=wr,Or=In=de(wr));for(let Pr=0;Pr<Nn.length;Pr++)V[Or+Pr]=Nn[Pr];return Or}})();return K(),ht(),{memory:mt,_free:ne,_malloc:de,Mesh:class{constructor(){this.ptr=ge()}destroy(){Me(this.ptr)}},Decoder:class{constructor(){this.ptr=Oe()}destroy(){ut(this.ptr)}DecodeArrayToMesh(dn,tn,nr){const In=bn(dn),Nn=Ie(this.ptr,In,tn,nr.ptr);return!!Be(Nn)}GetAttributeByUniqueId(dn,tn){return{ptr:Ye(this.ptr,dn.ptr,tn)}}GetTrianglesUInt16Array(dn,tn,nr){ze(this.ptr,dn.ptr,tn,nr)}GetTrianglesUInt32Array(dn,tn,nr){Qe(this.ptr,dn.ptr,tn,nr)}GetAttributeDataArrayForAllPoints(dn,tn,nr,In,Nn){lt(this.ptr,dn.ptr,tn.ptr,nr,In,Nn)}},DT_INT8:Et(),DT_UINT8:vt(),DT_INT16:Ut(),DT_UINT16:Yt(),DT_UINT32:Dt(),DT_FLOAT32:Rn()}})}(fetch(ZV())),s2.then(z=>{yf=z,s2=void 0}))}()),G&&R.push(function(){if(r4)return;const z=function(V){let X;const K=WebAssembly.instantiateStreaming(V,{}).then(he=>{X=he.instance,X.exports.__wasm_call_ctors()}),ee={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},ce={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:K,supported:!0,decodeGltfBuffer(he,ne,de,ge,Me,Be){(function(Oe,Ie,Ye,ze,Qe,lt,ut){const ht=Oe.exports.sbrk,mt=ze+3&-4,Et=ht(mt*Qe),vt=ht(lt.length),Ut=new Uint8Array(Oe.exports.memory.buffer);Ut.set(lt,vt);const Yt=Ie(Et,ze,Qe,vt,lt.length);if(Yt===0&&ut&&ut(Et,mt,Qe),Ye.set(Ut.subarray(Et,Et+ze*Qe)),ht(Et-ht(0)),Yt!==0)throw new Error(`Malformed buffer data: ${Yt}`)})(X,X.exports[ce[Me]],he,ne,de,ge,X.exports[ee[Be]])}}}(fetch(YV()));return z.ready.then(()=>{r4=z})}()),x)for(let z=0;z<x.length;z++)R.push(ife(x[z],v,z,f));return(R.length?Promise.all(R):Promise.resolve()).then(()=>{if(N&&A)for(const{primitives:z}of A)for(const V of z)tfe(V,v);if(G&&A&&U)for(const z of U)nfe(z,v);return v})})}function u_(g,c){const f=g.json.bufferViews[c.bufferView],v=YM[c.componentType];return new v(g.buffers[f.buffer],(c.byteOffset||0)+(f.byteOffset||0),c.count*(f.byteStride&&f.byteStride!==o2[c.type]*v.BYTES_PER_ELEMENT?f.byteStride/v.BYTES_PER_ELEMENT:o2[c.type]))}function s4(g,c,f,v){const S=YM[c.componentType],x=function(R){switch(R){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(S),A=g.json.bufferViews[c.bufferView],D=A.byteStride?A.byteStride/S.BYTES_PER_ELEMENT:o2[c.type],U=f.float32,H=U.length/f.capacity;for(let R=0,N=0;R<c.count*D;R+=D,N+=H)for(let G=0;G<H;G++)U[N+G]=v[R+G]*x;f._trim()}function sfe(g,c,f){const v=g.indices,S=g.attributes,x={};x.indexArray=new bo;const A=c.json.accessors[v],D=A.count/3;x.indexArray.reserve(D);const U=u_(c,A);for(let G=0;G<D;G++)x.indexArray.emplaceBack(U[3*G],U[3*G+1],U[3*G+2]);x.indexArray._trim(),x.vertexArray=new lo;const H=c.json.accessors[S.POSITION];x.vertexArray.reserve(H.count);const R=u_(c,H);for(let G=0;G<H.count;G++)x.vertexArray.emplaceBack(R[3*G],R[3*G+1],R[3*G+2]);if(x.vertexArray._trim(),x.aabb=new Yi(H.min,H.max),x.centroid=function(G,z){const V=[0,0,0],X=G.length;if(X>0){for(let K=0;K<X;K++){const ee=3*G[K];V[0]+=z[ee],V[1]+=z[ee+1],V[2]+=z[ee+2]}V[0]/=X,V[1]/=X,V[2]/=X}return V}(U,R),S.COLOR_0!==void 0){const G=c.json.accessors[S.COLOR_0],z=o2[G.type],V=u_(c,G);x.colorArray=z===3?new lo:new Il,x.colorArray.resize(G.count),s4(c,G,x.colorArray,V)}if(S.NORMAL!==void 0){x.normalArray=new lo;const G=c.json.accessors[S.NORMAL];x.normalArray.resize(G.count);const z=u_(c,G);s4(c,G,x.normalArray,z)}if(S.TEXCOORD_0!==void 0&&f.length>0){x.texcoordArray=new hc;const G=c.json.accessors[S.TEXCOORD_0];x.texcoordArray.resize(G.count);const z=u_(c,G);s4(c,G,x.texcoordArray,z)}if(S._FEATURE_ID_RGBA4444!==void 0){const G=c.json.accessors[S._FEATURE_ID_RGBA4444];c.json.extensionsUsed&&c.json.extensionsUsed.includes("EXT_meshopt_compression")&&(x.featureData=u_(c,G))}S._FEATURE_RGBA4444!==void 0&&(x.featureData=new Uint32Array(u_(c,c.json.accessors[S._FEATURE_RGBA4444]).buffer));const N=g.material;return x.material=function(G,z){const{emissiveFactor:V=[0,0,0],alphaMode:X="OPAQUE",alphaCutoff:K=.5,normalTexture:ee,occlusionTexture:ce,emissiveTexture:he,doubleSided:ne}=G,{baseColorFactor:de=[1,1,1,1],metallicFactor:ge=1,roughnessFactor:Me=1,baseColorTexture:Be,metallicRoughnessTexture:Oe}=G.pbrMetallicRoughness||{},Ie=ce?z[ce.index]:void 0;if(ce&&ce.extensions&&ce.extensions.KHR_texture_transform&&Ie){const Ye=ce.extensions.KHR_texture_transform;Ie.offsetScale=[Ye.offset[0],Ye.offset[1],Ye.scale[0],Ye.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new vr(...de),metallicFactor:ge,roughnessFactor:Me,baseColorTexture:Be?z[Be.index]:void 0,metallicRoughnessTexture:Oe?z[Oe.index]:void 0},doubleSided:ne,emissiveFactor:V,alphaMode:X,alphaCutoff:K,normalTexture:ee?z[ee.index]:void 0,occlusionTexture:Ie,emissionTexture:he?z[he.index]:void 0,defined:G.defined===void 0}}(N!==void 0?c.json.materials[N]:{defined:!1},f),x}function rG(g,c,f){const{matrix:v,rotation:S,translation:x,scale:A,mesh:D,extras:U,children:H}=g,R={};if(R.matrix=v||Pe.mat4.fromRotationTranslationScale([],S||[0,0,0,1],x||[0,0,0],A||[1,1,1]),D!==void 0){R.meshes=f[D];const N=R.anchor=[0,0];for(const G of R.meshes){const{min:z,max:V}=G.aabb;N[0]+=z[0]+V[0],N[1]+=z[1]+V[1]}N[0]=Math.floor(N[0]/R.meshes.length/2),N[1]=Math.floor(N[1]/R.meshes.length/2)}if(U&&(U.id&&(R.id=U.id),U.lights&&(R.lights=function(N){if(!N.length)return[];const G=function(ee){const ce=atob(ee),he=new Uint8Array(ce.length);for(let ne=0;ne<ce.length;ne++)he[ne]=ce.codePointAt(ne);return he}(N),z=[],V=G.length/24,X=new Uint16Array(G.buffer),K=new Float32Array(G.buffer);for(let ee=0;ee<V;ee++){const ce=X[2*ee*6]/30,he=X[2*ee*6+1]/30,ne=X[2*ee*6+10]/100,de=K[6*ee+1],ge=K[6*ee+2],Me=K[6*ee+3],Be=K[6*ee+4],Oe=Me-de,Ie=Be-ge,Ye=Math.hypot(Oe,Ie);z.push({pos:[de+.5*Oe,ge+.5*Ie,he],normal:[Ie/Ye,-Oe/Ye,0],width:Ye,height:ce,depth:ne,points:[de,ge,Me,Be]})}return z}(U.lights))),H){const N=[];for(const G of H)N.push(rG(c.json.nodes[G],c,f));R.children=N}return R}function ofe(g){if(g.vertices.length===0||g.indices.length===0)return null;const c=new p3(g.vertices,g.indices,8,256),[f,v]=[c.min.clone(),c.max.clone()];return{vertices:g.vertices,indices:g.indices,grid:c,min:f,max:v}}function afe(g){if(!g.extras||!g.extras.ground)return null;const c=g.extras.ground;if(!c||!Array.isArray(c)||c.length===0)return null;const f=c[0];if(!f||!Array.isArray(f)||f.length===0)return null;const v=[];for(const A of f){if(!Array.isArray(A)||A.length!==2)continue;const D=A[0],U=A[1];typeof D=="number"&&typeof U=="number"&&v.push(new St(D,U))}if(v.length<3)return null;v.length>1&&v[v.length-1].equals(v[0])&&v.pop();let S=0;for(let A=0;A<v.length;A++){const D=v[A],U=v[(A+1)%v.length],H=v[(A+2)%v.length];S+=(D.x-U.x)*(H.y-U.y)-(H.x-U.x)*(D.y-U.y)}S>0&&v.reverse();const x=Lw(v.flatMap(A=>[A.x,A.y]),[]);return x.length===0?null:{vertices:v,indices:x}}function lfe(g,c){const f=[],v=[];let S=0;const x=[];for(const A of g){S=f.length;const D=A.vertexArray.float32,U=A.indexArray.uint16;for(let H=0;H<A.vertexArray.length;H++)x[0]=D[3*H+0],x[1]=D[3*H+1],x[2]=D[3*H+2],Pe.vec3.transformMat4(x,x,c),f.push(new St(x[0],x[1]));for(let H=0;H<3*A.indexArray.length;H++)v.push(U[H]+S)}if(v.length%3!=0)return null;for(let A=0;A<v.length;A+=3){const D=f[v[A+0]],U=f[v[A+1]],H=f[v[A+2]];(D.x-U.x)*(H.y-U.y)-(H.x-U.x)*(D.y-U.y)>0&&([v[A+1],v[A+2]]=[v[A+2],v[A+1]])}return{vertices:f,indices:v}}function iG(g){const c=function(U,H){const R=[],N=WebGL2RenderingContext;if(U.json.textures)for(const G of U.json.textures){const z={magFilter:N.LINEAR,minFilter:N.NEAREST,wrapS:N.REPEAT,wrapT:N.REPEAT};G.sampler!==void 0&&Object.assign(z,U.json.samplers[G.sampler]),R.push({image:H[G.source],sampler:z,uploaded:!1})}return R}(g,g.images),f=function(U,H){const R=[];for(const N of U.json.meshes){const G=[];for(const z of N.primitives)G.push(sfe(z,U,H));R.push(G)}return R}(g,c),{scenes:v,scene:S,nodes:x}=g.json,A=v?v[S||0].nodes:x,D=[];for(const U of A)D.push(rG(x[U],g,f));return function(U,H,R){const N={},G=new Set;for(let z=0;z<U.length;z++){const V=R[H[z]];if(!V.extras)continue;const X=V.extras["mapbox:footprint:version"],K=V.extras["mapbox:footprint:id"];(X||K)&&G.add(z),X==="1.0.0"&&K&&(N[K]=z)}for(let z=0;z<U.length;z++){if(G.has(z))continue;const V=U[z],X=R[H[z]];if(!X.extras)continue;let K=null;V.id in N&&(K=lfe(U[N[V.id]].meshes,V.matrix)),K||(K=afe(X)),K&&(V.footprint=ofe(K))}if(G.size>0){const z=Array.from(G.values()).sort((V,X)=>V-X);for(let V=z.length-1;V>=0;V--)U.splice(z[V],1)}}(D,A,g.json.nodes),D}function cfe(g){g.heightmap=new Float32Array(4096),g.heightmap.fill(-1);const c=g.vertexArray.float32,f=g.aabb.min[0]-1,v=g.aabb.min[1]-1,S=l_/(g.aabb.max[0]-f+2),x=l_/(g.aabb.max[1]-v+2);for(let A=0;A<c.length;A+=3){const D=c[A+2],U=(c[A+0]-f)*S|0,H=(c[A+1]-v)*x|0;D>g.heightmap[H*l_+U]&&(g.heightmap[H*l_+U]=D)}}function ufe(g,c){const f={};f.indexArray=new bo,f.indexArray.reserve(4*g.length),f.vertexArray=new lo,f.vertexArray.reserve(10*g.length),f.colorArray=new Il,f.vertexArray.reserve(10*g.length);let v=0;for(const A of g){const D=Math.min(10,Math.max(4,1.3*A.height))*c,U=[-A.normal[1],A.normal[0],0],H=Math.min(.29,.1*A.width/A.depth),R=A.width-2*A.depth*c*(H+.01),N=Pe.vec3.scaleAndAdd([],A.pos,U,R/2),G=Pe.vec3.scaleAndAdd([],A.pos,U,-R/2),z=[N[0],N[1],N[2]+A.height],V=[G[0],G[1],G[2]+A.height],X=Pe.vec3.scaleAndAdd([],A.normal,U,H);Pe.vec3.scale(X,X,D);const K=Pe.vec3.scaleAndAdd([],A.normal,U,-H);Pe.vec3.scale(K,K,D),Pe.vec3.add(X,N,X),Pe.vec3.add(K,G,K),N[2]+=.1,G[2]+=.1,f.vertexArray.emplaceBack(X[0],X[1],X[2]),f.vertexArray.emplaceBack(K[0],K[1],K[2]),f.vertexArray.emplaceBack(N[0],N[1],N[2]),f.vertexArray.emplaceBack(G[0],G[1],G[2]),f.vertexArray.emplaceBack(z[0],z[1],z[2]),f.vertexArray.emplaceBack(V[0],V[1],V[2]),f.vertexArray.emplaceBack(N[0],N[1],N[2]),f.vertexArray.emplaceBack(G[0],G[1],G[2]),f.vertexArray.emplaceBack(X[0],X[1],X[2]),f.vertexArray.emplaceBack(K[0],K[1],K[2]);const ee=R/D/2;f.colorArray.emplaceBack(-ee-H,-1,ee,.8),f.colorArray.emplaceBack(ee+H,-1,ee,.8),f.colorArray.emplaceBack(-ee,0,ee,1.3),f.colorArray.emplaceBack(ee,0,ee,1.3),f.colorArray.emplaceBack(ee+H,-.8,ee,.7),f.colorArray.emplaceBack(ee+H,-.8,ee,.7),f.colorArray.emplaceBack(0,0,ee,1.3),f.colorArray.emplaceBack(0,0,ee,1.3),f.colorArray.emplaceBack(ee+H,-1.2,ee,.8),f.colorArray.emplaceBack(ee+H,-1.2,ee,.8),f.indexArray.emplaceBack(6+v,4+v,8+v),f.indexArray.emplaceBack(7+v,9+v,5+v),f.indexArray.emplaceBack(0+v,1+v,2+v),f.indexArray.emplaceBack(1+v,3+v,2+v),v+=10}const S={defined:!0,emissiveFactor:[0,0,0]},x={};return x.baseColorFactor=vr.white,S.pbrMetallicRoughness=x,f.material=S,f.aabb=new Yi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),f}class sG{constructor(c){this._stringToNumber={},this._numberToString=[];for(let f=0;f<c.length;f++){const v=c[f];this._stringToNumber[v]=f,this._numberToString[f]=v}}encode(c){return this._stringToNumber[c]}decode(c){return this._numberToString[c]}}const hfe=["id","tile","layer","source","sourceLayer","state"];class oG{constructor(c,f,v,S,x){this.type="Feature",this._vectorTileFeature=c,this._z=f,this._x=v,this._y=S,this.properties=c.properties,this.id=x}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(c){this._geometry=c}toJSON(){const c={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const f of hfe)this[f]!==void 0&&(c[f]=this[f]);return c}}class aG{constructor(c,f){this.tileID=c,this.x=c.canonical.x,this.y=c.canonical.y,this.z=c.canonical.z,this.grid=new zc(yn,16,0),this.featureIndexArray=new Qp,this.promoteId=f,this.is3DTile=!1}insert(c,f,v,S,x,A=0,D=0){const U=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(v,S,x,A);const H=this.grid;for(let R=0;R<f.length;R++){const N=f[R],G=[1/0,1/0,-1/0,-1/0];for(let z=0;z<N.length;z++){const V=N[z];G[0]=Math.min(G[0],V.x),G[1]=Math.min(G[1],V.y),G[2]=Math.max(G[2],V.x),G[3]=Math.max(G[3],V.y)}D!==0&&(G[0]-=D,G[1]-=D,G[2]+=D,G[3]+=D),G[0]<yn&&G[1]<yn&&G[2]>=0&&G[3]>=0&&H.insert(U,G[0],G[1],G[2],G[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new zx.VectorTile(new MM(this.rawTileData)).layers,this.sourceLayerCoder=new sG(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const c in this.vtLayers)this.vtFeatures[c]=[]}return this.vtLayers}query(c,f,v,S){this.loadVTLayers();const x=c.params||{},A=ts(x.filter),D=c.tileResult,U=c.transform,H=D.bufferedTilespaceBounds,R=this.grid.query(H.min.x,H.min.y,H.max.x,H.max.y,(V,X,K,ee)=>jc(D.bufferedTilespaceGeometry,V,X,K,ee));R.sort(ffe);let N=null;U.elevation&&R.length>0&&(N=Xx.create(U.elevation,this.tileID));const G={};let z;for(let V=0;V<R.length;V++){const X=R[V];if(X===z)continue;z=X;const K=this.featureIndexArray.get(X);let ee=null;if(this.is3DTile){const ce=this.bucketLayerIDs[0][0],he=f[ce];if(he.type!=="model")continue;const{queryFeature:ne,intersectionZ:de}=he.queryIntersectsMatchingFeature(D,K.featureIndex,A,U);ne&&this.appendToResult(G,ce,K.featureIndex,ne,de)}else this.loadMatchingFeature(G,K,A,x.layers,x.availableImages,f,v,S,(ce,he,ne,de=0)=>(ee||(ee=fn(ce,this.tileID.canonical,c.tileTransform)),he.queryIntersectsFeature(D,ce,ne,ee,this.z,c.transform,c.pixelPosMatrix,N,de)))}return G}loadMatchingFeature(c,f,v,S,x,A,D,U,H){const{featureIndex:R,bucketIndex:N,sourceLayerIndex:G,layoutVertexArrayOffset:z}=f,V=this.bucketLayerIDs[N];if(S&&!function(ce,he){for(let ne=0;ne<ce.length;ne++)if(he.indexOf(ce[ne])>=0)return!0;return!1}(S,V))return;const X=this.sourceLayerCoder.decode(G),K=this.vtLayers[X].feature(R);if(v.needGeometry){const ce=pn(K,!0);if(!v.filter(new hs(this.tileID.overscaledZ),ce,this.tileID.canonical))return}else if(!v.filter(new hs(this.tileID.overscaledZ),K))return;const ee=this.getId(K,X);for(let ce=0;ce<V.length;ce++){const he=V[ce];if(S&&S.indexOf(he)<0)continue;const ne=A[he];if(!ne)continue;let de={};ee!==void 0&&U&&(de=U.getState(ne.sourceLayer||"_geojsonTileLayer",ee));const ge=!H||H(K,ne,de,z);if(!ge)continue;const Me=new oG(K,this.z,this.x,this.y,ee),Be=Sr({},D[he]);Be.paint=lG(Be.paint,ne.paint,K,de,x),Be.layout=lG(Be.layout,ne.layout,K,de,x),Me.layer=Be,this.appendToResult(c,he,R,Me,ge)}}appendToResult(c,f,v,S,x){let A=c[f];A===void 0&&(A=c[f]=[]),A.push({featureIndex:v,feature:S,intersectionZ:x})}lookupSymbolFeatures(c,f,v,S,x,A,D,U){const H={};this.loadVTLayers();const R=ts(x);for(const N of c)this.loadMatchingFeature(H,{bucketIndex:v,sourceLayerIndex:S,featureIndex:N,layoutVertexArrayOffset:0},R,A,D,U,f);return H}loadFeature(c){const{featureIndex:f,sourceLayerIndex:v}=c;this.loadVTLayers();const S=this.sourceLayerCoder.decode(v),x=this.vtFeatures[S];if(x[f])return x[f];const A=this.vtLayers[S].feature(f);return x[f]=A,A}hasLayer(c){for(const f of this.bucketLayerIDs)for(const v of f)if(c===v)return!0;return!1}getId(c,f){let v=c.id;if(this.promoteId){const S=typeof this.promoteId=="string"?this.promoteId:this.promoteId[f];S!=null&&(v=c.properties[S]),typeof v=="boolean"&&(v=Number(v))}return v}}function lG(g,c,f,v,S){return Nr(g,(x,A)=>{const D=c instanceof Yu?c.get(A):null;return D&&D.evaluate?D.evaluate(f,v,S):D})}function ffe(g,c){return c-g}Fn(aG,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const cG=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class o4{static from(c){if(!(c instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[f,v]=new Uint8Array(c,0,2);if(f!==219)throw new Error("Data does not appear to be in a KDBush format.");const S=v>>4;if(S!==1)throw new Error(`Got v${S} data when expected v1.`);const x=cG[15&v];if(!x)throw new Error("Unrecognized array type.");const[A]=new Uint16Array(c,2,1),[D]=new Uint32Array(c,4,1);return new o4(D,A,x,c)}constructor(c,f=64,v=Float64Array,S){if(isNaN(c)||c<0)throw new Error(`Unpexpected numItems value: ${c}.`);this.numItems=+c,this.nodeSize=Math.min(Math.max(+f,2),65535),this.ArrayType=v,this.IndexArrayType=c<65536?Uint16Array:Uint32Array;const x=cG.indexOf(this.ArrayType),A=2*c*this.ArrayType.BYTES_PER_ELEMENT,D=c*this.IndexArrayType.BYTES_PER_ELEMENT,U=(8-D%8)%8;if(x<0)throw new Error(`Unexpected typed array class: ${v}.`);S&&S instanceof ArrayBuffer?(this.data=S,this.ids=new this.IndexArrayType(this.data,8,c),this.coords=new this.ArrayType(this.data,8+D+U,2*c),this._pos=2*c,this._finished=!0):(this.data=new ArrayBuffer(8+A+D+U),this.ids=new this.IndexArrayType(this.data,8,c),this.coords=new this.ArrayType(this.data,8+D+U,2*c),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+x]),new Uint16Array(this.data,2,1)[0]=f,new Uint32Array(this.data,4,1)[0]=c)}add(c,f){const v=this._pos>>1;return this.ids[v]=v,this.coords[this._pos++]=c,this.coords[this._pos++]=f,v}finish(){const c=this._pos>>1;if(c!==this.numItems)throw new Error(`Added ${c} items when expected ${this.numItems}.`);return a4(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(c,f,v,S){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:x,coords:A,nodeSize:D}=this,U=[0,x.length-1,0],H=[];for(;U.length;){const R=U.pop()||0,N=U.pop()||0,G=U.pop()||0;if(N-G<=D){for(let K=G;K<=N;K++){const ee=A[2*K],ce=A[2*K+1];ee>=c&&ee<=v&&ce>=f&&ce<=S&&H.push(x[K])}continue}const z=G+N>>1,V=A[2*z],X=A[2*z+1];V>=c&&V<=v&&X>=f&&X<=S&&H.push(x[z]),(R===0?c<=V:f<=X)&&(U.push(G),U.push(z-1),U.push(1-R)),(R===0?v>=V:S>=X)&&(U.push(z+1),U.push(N),U.push(1-R))}return H}within(c,f,v){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:S,coords:x,nodeSize:A}=this,D=[0,S.length-1,0],U=[],H=v*v;for(;D.length;){const R=D.pop()||0,N=D.pop()||0,G=D.pop()||0;if(N-G<=A){for(let K=G;K<=N;K++)hG(x[2*K],x[2*K+1],c,f)<=H&&U.push(S[K]);continue}const z=G+N>>1,V=x[2*z],X=x[2*z+1];hG(V,X,c,f)<=H&&U.push(S[z]),(R===0?c-v<=V:f-v<=X)&&(D.push(G),D.push(z-1),D.push(1-R)),(R===0?c+v>=V:f+v>=X)&&(D.push(z+1),D.push(N),D.push(1-R))}return U}}function a4(g,c,f,v,S,x){if(S-v<=f)return;const A=v+S>>1;uG(g,c,A,v,S,x),a4(g,c,f,v,A-1,1-x),a4(g,c,f,A+1,S,1-x)}function uG(g,c,f,v,S,x){for(;S>v;){if(S-v>600){const H=S-v+1,R=f-v+1,N=Math.log(H),G=.5*Math.exp(2*N/3),z=.5*Math.sqrt(N*G*(H-G)/H)*(R-H/2<0?-1:1);uG(g,c,f,Math.max(v,Math.floor(f-R*G/H+z)),Math.min(S,Math.floor(f+(H-R)*G/H+z)),x)}const A=c[2*f+x];let D=v,U=S;for(a2(g,c,v,f),c[2*S+x]>A&&a2(g,c,v,S);D<U;){for(a2(g,c,D,U),D++,U--;c[2*D+x]<A;)D++;for(;c[2*U+x]>A;)U--}c[2*v+x]===A?a2(g,c,v,U):(U++,a2(g,c,U,S)),U<=f&&(v=U+1),f<=U&&(S=U-1)}}function a2(g,c,f,v){l4(g,f,v),l4(c,2*f,2*v),l4(c,2*f+1,2*v+1)}function l4(g,c,f){const v=g[c];g[c]=g[f],g[f]=v}function hG(g,c,f,v){const S=g-f,x=c-v;return S*S+x*x}o.$=Zp,o.A=class extends WM{},o.B=du,o.C=ld,o.D=Ds,o.E=zu,o.F=Cg,o.G=Vp,o.H=$v,o.I=P3,o.J=_d,o.K=fi,o.L=Yv,o.M=yd,o.N=Tl,o.O=rc,o.P=St,o.Q=Yh,o.R=qi,o.S=La,o.T=H3,o.U=Ap,o.V=WM,o.W=Ys,o.X=Gp,o.Y=Mg,o.Z=function(g){const c=g.value;let f=[];if(!c)return f;const v=du(c);return v!=="string"?(f=f.concat([new WM(g.key,c,`string expected, "${v}" found`)]),f):(bV(c,!0)||(f=f.concat([new WM(g.key,c,`invalid url "${c}"`)])),f)},o._=At,o.a=function(g){return nt.API_CDN_URL_REGEX.test(g)},o.a$=r_,o.a0=Hi,o.a1=gn,o.a2=class{constructor(g){this.specification=g}possiblyEvaluate(g,c){return En(g.expression.evaluate(c))}interpolate(g,c,f){return{x:cr(g.x,c.x,f),y:cr(g.y,c.y,f),z:cr(g.z,c.z,f),azimuthal:cr(g.azimuthal,c.azimuthal,f),polar:cr(g.polar,c.polar,f)}}},o.a3=hs,o.a4=hl,o.a5=xt,o.a6=Pe,o.a7=mr,o.a8=Yu,o.a9=$g,o.aA=Zi,o.aB=lV,o.aC=pV,o.aD=aV,o.aE=function(g,c){const f=document.createElement("video");f.muted=!0,f.onloadstart=function(){c(null,f)};for(let v=0;v<g.length;v++){const S=document.createElement("source");us(g[v])||(f.crossOrigin="Anonymous"),S.src=g[v],f.appendChild(S)}return{cancel:()=>{}}},o.aF=UM,o.aG=function(g){return fetch(g).then(c=>c.arrayBuffer()).then(c=>nG(c,0,g))},o.aH=iG,o.aI=class{constructor(g,c,f,v){this.id=g,this.position=c!=null?new ue(c[0],c[1]):new ue(0,0),this.orientation=f??[0,0,0],this.nodes=v,this.uploaded=!1,this.aabb=new Yi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(g,c){if(Pe.mat4.multiply(g.matrix,c,g.matrix),g.meshes)for(const f of g.meshes){const v=Yi.applyTransformFast(f.aabb,g.matrix);this.aabb.encapsulate(v)}if(g.children)for(const f of g.children)this._applyTransformations(f,g.matrix)}computeBoundsAndApplyParent(){const g=Pe.mat4.identity([]);for(const c of this.nodes)this._applyTransformations(c,g)}computeModelMatrix(g,c,f,v,S,x,A=!1){MV(this.matrix,this,g.transform,this.position,c,f,v,S,x,A)}upload(g){if(!this.uploaded){for(const c of this.nodes)q3(c,g);for(const c of this.nodes)XM(c);this.uploaded=!0}}destroy(){for(const g of this.nodes)Z3(g)}},o.aJ=Fr,o.aK=Xw,o.aL=je,o.aM=Ge,o.aN=Ks,o.aO=bo,o.aP=ir,o.aQ=Ug,o.aR=NM,o.aS=function(){Oa.isLoading()||Oa.isLoaded()||Dg()!=="deferred"||Bg()},o.aT=ts,o.aU=pn,o.aV=oG,o.aW=Gr,o.aX=S3,o.aY=d3,o.aZ=fn,o.a_=lc,o.aa=cr,o.ab=yn,o.ac=ad,o.ad=class{constructor(g){this.specification=g}possiblyEvaluate(g,c){return function([f,v]){const S=En([1,f,v]);return{x:S.x,y:S.y,z:S.z}}(g.expression.evaluate(c))}interpolate(g,c,f){return{x:cr(g.x,c.x,f),y:cr(g.y,c.y,f),z:cr(g.z,c.z,f)}}},o.ae=function(g,c,f=0,v=!0){const S=new St(f,f),x=g.sub(S),A=c.add(S),D=[x,new St(A.x,x.y),A,new St(x.x,A.y)];return v&&D.push(x.clone()),D},o.af=function(g,c){const f=[];for(let v=0;v<g.length;v++){const S=Un(v-1,-1,g.length-1),x=Un(v+1,-1,g.length-1),A=g[v],D=g[x],U=g[S].sub(A).unit(),H=D.sub(A).unit(),R=H.angleWithSep(U.x,U.y),N=U.add(H).unit().mult(-1*c/Math.sin(R/2));f.push(A.add(N))}return f},o.ag=$7,o.ah=jc,o.ai=function(g,c,f=0){return Pe.vec3.fromValues(((c.x-f)*g.scale-g.x)*yn,(c.y*g.scale-g.y)*yn,et(c.z,c.y))},o.aj=pf,o.ak=d7,o.al=function(g){let c=1/0,f=1/0,v=-1/0,S=-1/0;for(const x of g)c=Math.min(c,x.x),f=Math.min(f,x.y),v=Math.max(v,x.x),S=Math.max(S,x.y);return{min:new St(c,f),max:new St(v,S)}},o.am=ke,o.an=ns,o.ao=Zt,o.ap=jt,o.aq=u,o.ar=function(g,c){const f={};for(let v=0;v<c.length;v++){const S=c[v];S in g&&(f[S]=g[S])}return f},o.as=ve,o.at=Ne,o.au=class{constructor(g){this.entries={},this.scheduler=g}request(g,c,f,v){const S=this.entries[g]=this.entries[g]||{callbacks:[]};if(S.result){const[x,A]=S.result;return this.scheduler?this.scheduler.add(()=>{v(x,A)},c):v(x,A),()=>{}}return S.callbacks.push(v),S.cancel||(S.cancel=f((x,A)=>{S.result=[x,A];for(const D of S.callbacks)this.scheduler?this.scheduler.add(()=>{D(x,A)},c):D(x,A);setTimeout(()=>delete this.entries[g],3e3)})),()=>{S.result||(S.callbacks=S.callbacks.filter(x=>x!==v),S.callbacks.length||(S.cancel(),delete this.entries[g]))}}},o.av=uf,o.aw=function(g,c,f){const v=JSON.stringify(g.request);return g.data&&(this.deduped.entries[v]={result:[null,g.data]}),this.deduped.request(v,{type:"parseTile",isSymbolTile:g.isSymbolTile,zoom:g.tileZoom},S=>{const x=Ps(g.request,(A,D,U,H)=>{A?S(A):D&&S(null,{vectorTile:f?void 0:new zx.VectorTile(new MM(D)),rawData:D,cacheControl:U,expires:H})});return()=>{x.cancel(),S()}},c)},o.ax=function(g){gr++,gr>It&&(g.getActor().send("enforceCacheSizeLimit",Ct),gr=0)},o.ay=Mn,o.az=function(g){return g<=1?1:Math.pow(2,Math.floor(Math.log(g)/Math.LN2))},o.b=function(g){return nt.API_FONTS_REGEX.test(g)},o.b$=function(g){const{x:c,y:f}=g.point,{lng:v,lat:S}=g._center;return s9(c,f,g.worldSize,v,S)},o.b0=Xc,o.b1=xs,o.b2=Lw,o.b3=U3,o.b4=function(g,c){const f=$g(c.zoom);if(f===0)return kd(g);const v=fM(g),S=i3(v),x=ke(v.getWest())*c.worldSize,A=ke(v.getEast())*c.worldSize,D=Ne(v.getNorth())*c.worldSize,U=Ne(v.getSouth())*c.worldSize,H=[x,D,0],R=[A,D,0],N=[x,U,0],G=[A,U,0],z=Pe.mat4.invert([],c.globeMatrix);return Pe.vec3.transformMat4(H,H,z),Pe.vec3.transformMat4(R,R,z),Pe.vec3.transformMat4(N,N,z),Pe.vec3.transformMat4(G,G,z),S[0]=rm(S[0],N,f),S[1]=rm(S[1],G,f),S[2]=rm(S[2],R,f),S[3]=rm(S[3],H,f),Yi.fromPoints(S)},o.b5=pM,o.b6=Rw,o.b7=rm,o.b8=hf,o.b9=Rl,o.bA=Un,o.bB=sn,o.bC=ui,o.bD=De,o.bE=function(g,c,f){g[4*c+0]=f[0],g[4*c+1]=f[1],g[4*c+2]=f[2],g[4*c+3]=f[3]},o.bF=Wn,o.bG=pe,o.bH=Te,o.bI=re,o.bJ=Y,o.bK=ue,o.bL=J7,o.bM=Fo,o.bN=Xg,o.bO=gV,o.bP=Yo,o.bQ=n9,o.bR=function(g,c,f,v,S,x,A,D,U){if(U.name==="globe")return n9(g,c,new Yo(f,v,S),!1);const H=Xw({z:f,x:v,y:S},U);return new Yi([(x+H.x/H.scale)*c,c*(H.y/H.scale),A],[(x+H.x2/H.scale)*c,c*(H.y2/H.scale),D])},o.bS=function(g,c,f){let v=0;for(let S=0;S<2;++S)g[S]>0&&(v+=(g[S]-0)*(g[S]-0)),c[S]<0&&(v+=(0-c[S])*(0-c[S]));return v},o.bT=Ke,o.bU=w,o.bV=function(g){const c=Pe.mat4.identity(new Float64Array(16));Pe.mat4.multiply(c,g.pixelMatrix,g.globeMatrix);const f=[0,W,0],v=[0,$,0];return Pe.vec3.transformMat4(f,f,c),Pe.vec3.transformMat4(v,v,c),[f[0]>0&&f[0]<=g.width&&f[1]>0&&f[1]<=g.height&&!a3(g,new ue(g.center.lat,90)),v[0]>0&&v[0]<=g.width&&v[1]>0&&v[1]<=g.height&&!a3(g,new ue(g.center.lat,-90))]},o.bW=function(g,c){const{scale:f}=g.tileTransform,v=f*yn/(g.tileSize*Math.pow(2,c.zoom-g.tileID.overscaledZ+g.tileID.canonical.z));return Pe.mat2.scale(new Float32Array(4),c.inverseAdjustmentMatrix,[v,v])},o.bX=HM,o.bY=mV,o.bZ=function(g){const c=mV(g,!0);return Pe.mat2.invert([],[c[0],c[1],c[4],c[5]])},o.b_=Bd,o.ba=e4,o.bb=MM,o.bc=Ps,o.bd=function(g){const c=[];for(const f in g)c.push(g[f]);return c},o.be=function(g,c){const f=[];for(const v in g)v in c||f.push(v);return f},o.bf=tr,o.bg=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.bh=Jt,o.bi=function(g,c){const{x:f,y:v}=g.point,S=s9(f,v,g.worldSize/g._pixelsPerMercatorPixel,0,0);return Pe.mat4.multiply(S,S,s3(kd(c)))},o.bj=Ux,o.bk=Su,o.bl=TM,o.bm=function(g,c,f,v,S){const x=5*c+2;g.float32[x+0]=f,g.float32[x+1]=v,g.float32[x+2]=S},o.bn=FM,o.bo=O7,o.bp=xn,o.bq=Fa,o.br=N9,o.bs=xV,o.bt=H9,o.bu=j9,o.bv=B3,o.bw=H7,o.bx=R3,o.by=o4,o.bz=vr,o.c=pt,o.c$=pl,o.c0=ot,o.c1=dl,o.c2=p,o.c3=function(g){const c=Math.round((g+45+360)%360/90)%4;return Ue[c]},o.c4=45,o.c5=we,o.c6=ft,o.c7=function(g,c,f){const v=Math.sqrt(g*g+c*c+f*f),S=v>0?Math.acos(f/v)*Vn:0;let x=g!==0||c!==0?Math.atan2(-c,-g)*Vn+90:0;return x<0&&(x+=360),[v,x,S]},o.c8=rt,o.c9=Yi,o.cA=function(g){const c=Ke-5;g=jt(g,-c,c)/c*90;const f=Math.pow(Math.abs(Math.sin(sn(g))),3);return Math.round(f*(F.length-1))},o.cB=function(g,c,f,v){const S=c.getNorth(),x=c.getSouth(),A=c.getWest(),D=c.getEast(),U=1<<g.z,H=D-A,R=S-x,N=H/P,G=-R/F[f],z=[0,N,0,G,0,0,S,A,0];if(g.z>0){const V=180/v;Pe.mat3.multiply(z,z,[V/H+1,0,0,0,V/R+1,0,-.5*V/N,.5*V/G,1])}return z[2]=U,z[5]=g.x,z[8]=g.y,z},o.cC=kd,o.cD=function(g,c,f){const v=Pe.mat4.identity(new Float64Array(16)),S=(c/(1<<g)-.5)*Math.PI*2;return Pe.mat4.rotateY(v,f.globeMatrix,S),Float32Array.from(v)},o.cE=class{isDataAvailableAtPoint(g){const c=this._source();if(this.isUsingMockSource()||!c||g.y<0||g.y>1)return!1;const f=c.getSource().maxzoom,v=1<<f,S=Math.floor(g.x),x=Math.floor((g.x-S)*v),A=Math.floor(g.y*v),D=this.findDEMTileFor(new Zi(f,S,f,x,A));return!(!D||!D.dem)}getAtPointOrZero(g,c=0){return this.getAtPoint(g,c)||0}getAtPoint(g,c,f=!0){if(this.isUsingMockSource())return null;c==null&&(c=null);const v=this._source();if(!v||g.y<0||g.y>1)return c;const S=v.getSource().maxzoom,x=1<<S,A=Math.floor(g.x),D=g.x-A,U=new Zi(S,A,S,Math.floor(D*x),Math.floor(g.y*x)),H=this.findDEMTileFor(U);if(!H||!H.dem)return c;const R=H.dem,N=1<<H.tileID.canonical.z,G=(D*N-H.tileID.canonical.x)*R.dim,z=(g.y*N-H.tileID.canonical.y)*R.dim,V=Math.floor(G),X=Math.floor(z);return(f?this.exaggeration():1)*cr(cr(R.get(V,X),R.get(V,X+1),z-X),cr(R.get(V+1,X),R.get(V+1,X+1),z-X),G-V)}getAtTileOffset(g,c,f){const v=1<<g.canonical.z;return this.getAtPointOrZero(new xt(g.wrap+(g.canonical.x+c/yn)/v,(g.canonical.y+f/yn)/v))}getAtTileOffsetFunc(g,c,f,v){return S=>{const x=this.getAtTileOffset(g,S.x,S.y),A=v.upVector(g.canonical,S.x,S.y),D=v.upVectorScale(g.canonical,c,f).metersToTile;return Pe.vec3.scale(A,A,x*D),A}}getForTilePoints(g,c,f,v){if(this.isUsingMockSource())return!1;const S=Xx.create(this,g,v);return!!S&&(c.forEach(x=>{x[2]=this.exaggeration()*S.getElevationAt(x[0],x[1],f)}),!0)}getMinMaxForTile(g){if(this.isUsingMockSource())return null;const c=this.findDEMTileFor(g);if(!c||!c.dem)return null;const f=c.dem.tree,v=c.tileID,S=1<<g.canonical.z-v.canonical.z;let x=g.canonical.x/S-v.canonical.x,A=g.canonical.y/S-v.canonical.y,D=0;for(let U=0;U<g.canonical.z-v.canonical.z&&!f.leaves[D];U++){x*=2,A*=2;const H=2*Math.floor(A)+Math.floor(x);D=f.childOffsets[D]+H,x%=1,A%=1}return{min:this.exaggeration()*f.minimums[D],max:this.exaggeration()*f.maximums[D]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(g,c,f){throw new Error("Pure virtual method called.")}pointCoordinate(g){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(g){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const g=this.visibleDemTiles;if(g.length===0)return null;let c=!1,f=Number.MAX_VALUE,v=Number.MIN_VALUE;for(const S of g){const x=this.getMinMaxForTile(S.tileID);x&&(f=Math.min(f,x.min),v=Math.max(v,x.max),c=!0)}return c?{min:f,max:v}:null}},o.cF=_9,o.cG=nm,o.cH=function(g,c){return[Math.pow(g[0],2.2)*c,Math.pow(g[1],2.2)*c,Math.pow(g[2],2.2)*c]},o.cI=i9,o.cJ=We,o.cK=Ce,o.cL=256,o.cM=function(g,c){const f=[0,0,0],v=pM(kd(c.canonical));return Pe.vec3.transformMat4(f,f,v),Pe.vec3.transformMat4(f,f,g),f},o.cN=g=>({u_camera_to_center_distance:new re(g),u_extrude_scale:new zr(g),u_device_pixel_ratio:new re(g),u_matrix:new Wn(g),u_inv_rot_matrix:new Wn(g),u_merc_center:new pe(g),u_tile_id:new Te(g),u_zoom_transition:new re(g),u_up_dir:new Te(g),u_emissive_strength:new re(g)}),o.cO=g=>({u_matrix:new Wn(g),u_pixels_to_tile_units:new zr(g),u_device_pixel_ratio:new re(g),u_units_to_pixels:new pe(g),u_dash_image:new Y(g),u_gradient_image:new Y(g),u_image_height:new re(g),u_texsize:new pe(g),u_tile_units_to_pixels:new re(g),u_alpha_discard_threshold:new re(g),u_trim_offset:new pe(g),u_trim_fade_range:new pe(g),u_trim_color:new ft(g),u_emissive_strength:new re(g)}),o.cP=g=>({u_matrix:new Wn(g),u_texsize:new pe(g),u_pixels_to_tile_units:new zr(g),u_device_pixel_ratio:new re(g),u_image:new Y(g),u_units_to_pixels:new pe(g),u_tile_units_to_pixels:new re(g),u_alpha_discard_threshold:new re(g),u_trim_offset:new pe(g)}),o.cQ=ya,o.cR=Bue,o.cS=kue,o.cT=l9,o.cU=(g,c,f,v,S,x)=>{const A=g.transform,D=A.projection.name==="globe";let U;if(x.paint.get("circle-pitch-alignment")==="map")if(D){const R=i9(A.zoom,c.canonical)*A._pixelsPerMercatorPixel;U=Float32Array.from([R,0,0,R])}else U=A.calculatePixelsToTileUnitsMatrix(f);else U=new Float32Array([A.pixelsToGLUnits[0],0,0,A.pixelsToGLUnits[1]]);const H={u_camera_to_center_distance:g.transform.getCameraToCenterDistance(A.projection),u_matrix:g.translatePosMatrix(c.projMatrix,f,x.paint.get("circle-translate"),x.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Cn.devicePixelRatio,u_extrude_scale:U,u_inv_rot_matrix:Nce,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:x.paint.get("circle-emissive-strength")};if(D){H.u_inv_rot_matrix=v,H.u_merc_center=S,H.u_tile_id=[c.canonical.x,c.canonical.y,1<<c.canonical.z],H.u_zoom_transition=$g(A.zoom);const R=S[0]*yn,N=S[1]*yn;H.u_up_dir=A.projection.upVector(new Yo(0,0,0),R,N)}return H},o.cV=g7,o.cW=(g,c,f,v,S,x)=>{const A=g.transform;return{u_matrix:m7(g,c,f,v),u_texsize:c.imageAtlasTexture?c.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:A.calculatePixelsToTileUnitsMatrix(c),u_device_pixel_ratio:S,u_image:0,u_tile_units_to_pixels:p7(c,A),u_units_to_pixels:[1/A.pixelsToGLUnits[0],1/A.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:x}},o.cX=(g,c,f,v,S,x,A)=>{const D=g.transform,U=D.calculatePixelsToTileUnitsMatrix(c);return{u_matrix:m7(g,c,f,v),u_pixels_to_tile_units:U,u_device_pixel_ratio:x,u_units_to_pixels:[1/D.pixelsToGLUnits[0],1/D.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:S,u_texsize:v7(f)&&c.lineAtlasTexture?c.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:p7(c,g.transform),u_alpha_discard_threshold:0,u_trim_offset:A,u_trim_fade_range:f.paint.get("line-trim-fade-range"),u_trim_color:f.paint.get("line-trim-color").toRenderColor(f.lut).toArray01(),u_emissive_strength:f.paint.get("line-emissive-strength")}},o.cY=ci,o.cZ=Pw,o.c_=r7,o.ca=En,o.cb=function(g){return[Math.pow(g[0],1/2.2),Math.pow(g[1],1/2.2),Math.pow(g[2],1/2.2)]},o.cc=function(g){return g({pluginStatus:ao,pluginURL:sc}),Lg.on("pluginStateChange",g),g},o.cd=$x,o.ce=ZM,o.cf=Gx,o.cg=L3,o.ch=gs,o.ci=Px,o.cj=yt,o.ck=Xo,o.cl=_i,o.cm=function(g){const c=g.indexOf(Ju);return c>=0?g.slice(0,c):g},o.cn=function(g){return g.indexOf(Ju)>=0},o.co=function(g){const c=g.indexOf(Ju);return c>=0?g.slice(c+1):""},o.cp=function(g){const c=[],f=g.id;return f===void 0&&c.push({message:`layers.${f}: missing required property "id"`}),g.render===void 0&&c.push({message:`layers.${f}: missing required method "render"`}),g.renderingMode&&g.renderingMode!=="2d"&&g.renderingMode!=="3d"&&c.push({message:`layers.${f}: property "renderingMode" must be either "2d" or "3d"`}),c},o.cq=function(g,c,f,v){return g.type==="custom"?new fhe(g,c):new She[g.type](g,c,f,v)},o.cr=Hr,o.cs=Lg,o.ct=Wo,o.cu=Ot,o.cv=class extends O{constructor(g){super(g),this.current=br}set(g,c,f){if(this.fetchUniformLocation(g,c)){for(let v=0;v<9;v++)if(f[v]!==this.current[v]){this.current=f,this.gl.uniformMatrix3fv(this.location,!1,f);break}}}},o.cw=$t,o.cx=function(g,c,f){const v=$g(f.zoom),S=g.style.map._antialias,x=c.options.extStandardDerivativesForceOff||g.terrain&&g.terrain.exaggeration()>0;return v===0&&!S&&!x},o.cy=function(g){const c=g.pixelsPerMeter,f=c/De(1,g.center.lat),v=Pe.mat4.identity(new Float64Array(16));return Pe.mat4.translate(v,v,[g.point.x,g.point.y,0]),Pe.mat4.scale(v,v,[f,f,c]),Float32Array.from(v)},o.cz=fM,o.d=function(g){return nt.API_TILEJSON_REGEX.test(g)},o.d$=h,o.d0=AM,o.d1=Zg,o.d2=450,o.d3=7,o.d4=hhe,o.d5=Qr,o.d6=zg,o.d7=256,o.d8=s3,o.d9=lo,o.dA=o9,o.dB=function(g){const c=[0,0,0],f=Pe.mat4.identity(new Float64Array(16));return Pe.mat4.multiply(f,g.pixelMatrix,g.globeMatrix),Pe.vec3.transformMat4(c,c,f),new St(c[0],c[1])},o.dC=function(g,c,f=!1){if(ao===Sd||ao===rf||ao===Ad)throw new Error("setRTLTextPlugin cannot be called multiple times.");sc=Cn.resolveURL(g),ao=Sd,sf=c,Jv(),f||Bg()},o.dD=Dg,o.dE=function(){ZM().acquire(t4)},o.dF=function(){const g=i2;g&&(g.isPreloaded()&&g.numActive()===1?(g.release(t4),i2=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},o.dG=r2,o.dH=function(g){const c=Xn();if(!c)return;const f=c.delete(Mt);g&&f.catch(g).then(()=>g())},o.dI=n2,o.dJ=ZV,o.dK=function(g){n4=Cn.resolveURL(g),Yx||(Yx=new $x(ZM(),new zu)),Yx.broadcast("setDracoUrl",n4)},o.dL=YV,o.dM=function(g){Zx=Cn.resolveURL(g),Yx||(Yx=new $x(ZM(),new zu)),Yx.broadcast("setMeshoptUrl",Zx)},o.dN=Fn,o.dO=qg,o.dP=gf,o.dQ=sG,o.dR=aG,o.dS=c7,o.dT=Nr,o.dU=N7,o.dV=function(g,c,f,v,S,x,A,D,U,H,R){g.createArrays(),g.tilePixelRatio=yn/(512*g.overscaling),g.compareText={},g.iconsNeedLinear=!1;const N=g.layers[0].layout,G=g.layers[0]._unevaluatedLayout._values,z={};if(g.textSizeData.kind==="composite"){const{minZoom:ee,maxZoom:ce}=g.textSizeData;z.compositeTextSizes=[G["text-size"].possiblyEvaluate(new hs(ee),D),G["text-size"].possiblyEvaluate(new hs(ce),D)]}if(g.iconSizeData.kind==="composite"){const{minZoom:ee,maxZoom:ce}=g.iconSizeData;z.compositeIconSizes=[G["icon-size"].possiblyEvaluate(new hs(ee),D),G["icon-size"].possiblyEvaluate(new hs(ce),D)]}z.layoutTextSize=G["text-size"].possiblyEvaluate(new hs(U+1),D),z.layoutIconSize=G["icon-size"].possiblyEvaluate(new hs(U+1),D),z.textMaxSize=G["text-size"].possiblyEvaluate(new hs(18),D);const V=N.get("text-rotation-alignment")==="map"&&N.get("symbol-placement")!=="point",X=N.get("text-size");let K=!1;for(const ee of g.features)if(ee.icon&&ee.icon.nameSecondary){K=!0;break}for(const ee of g.features){const ce=N.get("text-font").evaluate(ee,{},D).join(","),he=X.evaluate(ee,{},D),ne=z.layoutTextSize.evaluate(ee,{},D),de=(z.layoutIconSize.evaluate(ee,{},D),{horizontal:{},vertical:void 0}),ge=ee.text;let Me,Be=[0,0];if(ge){const Ye=ge.toString(),ze=N.get("text-letter-spacing").evaluate(ee,{},D)*Fa,Qe=N.get("text-line-height").evaluate(ee,{},D)*Fa,lt=$p(Ye)?ze:0,ut=N.get("text-anchor").evaluate(ee,{},D),ht=N.get("text-variable-anchor");if(!ht){const Yt=N.get("text-radial-offset").evaluate(ee,{},D);Be=Yt?H7(ut,[Yt*Fa,D3]):N.get("text-offset").evaluate(ee,{},D).map(Dt=>Dt*Fa)}let mt=V?"center":N.get("text-justify").evaluate(ee,{},D);const Et=N.get("symbol-placement")==="point",vt=Et?N.get("text-max-width").evaluate(ee,{},D)*Fa:1/0,Ut=Yt=>{g.allowVerticalPlacement&&Uc(Ye)&&(de.vertical=I3(ge,c,f,S,ce,vt,Qe,ut,Yt,lt,Be,Su.vertical,!0,ne,he))};if(!V&&ht){const Yt=mt==="auto"?ht.map(Rn=>B3(Rn)):[mt];let Dt=!1;for(let Rn=0;Rn<Yt.length;Rn++){const bn=Yt[Rn];if(!de.horizontal[bn])if(Dt)de.horizontal[bn]=de.horizontal[0];else{const dn=I3(ge,c,f,S,ce,vt,Qe,"center",bn,lt,Be,Su.horizontal,!1,ne,he);dn&&(de.horizontal[bn]=dn,Dt=dn.positionedLines.length===1)}}Ut("left")}else{if(mt==="auto"&&(mt=B3(ut)),Et||N.get("text-writing-mode").indexOf("horizontal")>=0||!Uc(Ye)){const Yt=I3(ge,c,f,S,ce,vt,Qe,ut,mt,lt,Be,Su.horizontal,!1,ne,he);Yt&&(de.horizontal[mt]=Yt)}Ut(Et?"left":mt)}}let Oe=!1;if(ee.icon&&ee.icon.namePrimary){const Ye=v[ee.icon.namePrimary];Ye&&(Me=Wue(S[ee.icon.namePrimary],ee.icon.nameSecondary?S[ee.icon.nameSecondary]:void 0,N.get("icon-offset").evaluate(ee,{},D),N.get("icon-anchor").evaluate(ee,{},D)),Oe=Ye.sdf,g.sdfIcons===void 0?g.sdfIcons=Ye.sdf:g.sdfIcons!==Ye.sdf&&Lt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ye.pixelRatio!==g.pixelRatio||N.get("icon-rotate").constantOr(1)!==0)&&(g.iconsNeedLinear=!0))}const Ie=W7(de.horizontal)||de.vertical;g.iconsInText||(g.iconsInText=!!Ie&&Ie.iconsInText),(Ie||Me)&&Jue(g,ee,de,Me,v,z,ne,0,Be,Oe,A,D,H,R,K)}x&&g.generateCollisionDebugBuffers(U,g.collisionBoxArray)},o.dW=zx,o.dX=qM,o.dY=cn,o.dZ=B9,o.d_=S7,o.da=Hc,o.db=Ng,o.dc=function(g,c,f,v,S){return jt((g-c)/(f-c)*(S-v)+v,v,S)},o.dd=$u,o.de=ct,o.df=class{constructor(g,c,f,v){this.context=g,this.format=v,this.size=f,this.texture=g.gl.createTexture();const[S,x,A]=this.size,{gl:D}=g;D.bindTexture(D.TEXTURE_3D,this.texture),g.pixelStoreUnpackFlipY.set(!1),g.pixelStoreUnpack.set(1),g.pixelStoreUnpackPremultiplyAlpha.set(!1),D.texImage3D(D.TEXTURE_3D,0,this.format,S,x,A,0,V3(this.format),G3(this.format),c.data)}bind(g,c){const{context:f}=this,{gl:v}=f;v.bindTexture(v.TEXTURE_3D,this.texture),g!==this.minFilter&&(v.texParameteri(v.TEXTURE_3D,v.TEXTURE_MAG_FILTER,g),v.texParameteri(v.TEXTURE_3D,v.TEXTURE_MIN_FILTER,g),this.minFilter=g),c!==this.wrapS&&(v.texParameteri(v.TEXTURE_3D,v.TEXTURE_WRAP_S,c),v.texParameteri(v.TEXTURE_3D,v.TEXTURE_WRAP_T,c),this.wrapS=c)}destroy(){const{gl:g}=this.context;g.deleteTexture(this.texture),this.texture=null}},o.dg=X3,o.dh=[1,1,1],o.di=Xx,o.dj=Wx,o.dk=bu,o.dl=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new St(1/0,1/0),max:new St(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(g,c=!1){const f=U9(new St(0,0),new St(yn,yn),g),v=[];if(c&&!_3(f,this._globalClipBounds))return v;for(const S of this._activeRegions){if(S.hiddenByOverlap||!_3(f,S))continue;const x=aue(S.min,S.max,g);v.push({min:x.min,max:x.max,sourceId:this._sourceIds[S.priority],footprint:S.footprint,footprintTileId:S.tileId,order:S.order,clipMask:S.clipMask,clipScope:S.clipScope})}return v}setSources(g){this._setSources(g.map(c=>({getSourceId:()=>c.cache.id,getFootprints:()=>{const f=[];for(const v of c.cache.getVisibleCoordinates()){const S=c.cache.getTile(v).buckets[c.layer];S&&S.updateFootprints(v.toUnwrapped(),f)}return f},getOrder:()=>c.order,getClipMask:()=>c.clipMask,getClipScope:()=>c.clipScope})))}_addSource(g){const c=g.getFootprints();if(c.length===0)return;const f=g.getOrder(),v=g.getClipMask(),S=g.getClipScope();for(const x of c){if(!x.footprint)continue;const A=U9(x.footprint.min,x.footprint.max,x.id);this._activeRegions.push({min:A.min,max:A.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:x.id,footprint:x.footprint,order:f,clipMask:v,clipScope:S})}this._sourceIds.push(g.getSourceId())}_computeReplacement(){this._activeRegions.sort((c,f)=>c.priority-f.priority||wM(c.min,f.min)||wM(c.max,f.max)||c.order-f.order||c.clipMask-f.clipMask||function(v,S){const x=(A,D)=>A+D;return v.length-S.length||v.reduce(x,"").localeCompare(S.reduce(x,""))}(c.clipScope,f.clipScope));let g=this._activeRegions.length!==this._prevRegions.length;if(!g){let c=0;for(;!g&&c!==this._activeRegions.length;){const f=this._activeRegions[c],v=this._prevRegions[c];g=f.priority!==v.priority||!z9(f,v)||f.order!==v.order||f.clipMask!==v.clipMask||!Jt(f.clipScope,v.clipScope),++c}}if(g){++this._updateTime;for(const f of this._activeRegions)f.order!==bM&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,f.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,f.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,f.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,f.max.y));const c=f=>{const v=this._activeRegions;if(f>=v.length)return f;const S=v[f].priority;for(;f<v.length&&v[f].priority===S;)++f;return f};if(this._sourceIds.length>1){let f=0,v=c(f);for(;f!==v;){let S=f;const x=f;for(;S!==v;){const A=this._activeRegions[S];A.hiddenByOverlap=!1;for(let D=0;D<x;D++){const U=this._activeRegions[D];if(!U.hiddenByOverlap&&A.order===bM&&_3(A,U)&&(A.hiddenByOverlap=G9(A.footprint,A.tileId,U.footprint,U.tileId),A.hiddenByOverlap))break}++S}f=v,v=c(f)}}}}_setSources(g){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let c=g.length-1;c>=0;c--)this._addSource(g[c]);this._computeReplacement()}},o.dm=class{constructor(g){this._createGrid(g),this._createPoles(g)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const g of this._poleSegments)g.destroy();for(const g of this._gridSegments)g.withSkirts.destroy(),g.withoutSkirts.destroy()}_fillGridMeshWithLods(g,c){const f=new lc,v=new bo,S=[],x=g+1+2,A=c[0]+1,D=c[0]+1+(1+c.length),U=(H,R,N)=>{let G=H===x-1?H-2:H===0?H:H-1;return G+=N?24575:0,[G,R]};for(let H=0;H<x;++H)f.emplaceBack(...U(H,0,!0));for(let H=0;H<A;++H)for(let R=0;R<x;++R)f.emplaceBack(...U(R,H,(R===0||R===x-1)&&!0));for(let H=0;H<c.length;++H){const R=c[H];for(let N=0;N<x;++N)f.emplaceBack(...U(N,R,!0))}for(let H=0;H<c.length;++H){const R=v.length,N=c[H]+1+2,G=new bo;for(let X=0;X<N-1;X++){const K=X===N-2,ee=K?x*(D-c.length+H-X):x;for(let ce=0;ce<x-1;ce++){const he=X*x+ce;X===0||K||ce===0||ce===x-2?(G.emplaceBack(he+1,he,he+ee),G.emplaceBack(he+ee,he+ee+1,he+1)):(v.emplaceBack(he+1,he,he+ee),v.emplaceBack(he+ee,he+ee+1,he+1))}}const z=xs.simpleSegment(0,R,f.length,v.length-R);for(let X=0;X<G.uint16.length;X+=3)v.emplaceBack(G.uint16[X],G.uint16[X+1],G.uint16[X+2]);const V=xs.simpleSegment(0,R,f.length,v.length-R);S.push({withoutSkirts:z,withSkirts:V})}return{vertices:f,indices:v,segments:S}}_createGrid(g){const c=this._fillGridMeshWithLods(P,F);this._gridSegments=c.segments,this._gridBuffer=g.createVertexBuffer(c.vertices,Xc.members),this._gridIndexBuffer=g.createIndexBuffer(c.indices,!0)}_createPoles(g){const c=new bo;for(let A=0;A<=P;A++)c.emplaceBack(0,A+1,A+2);this._poleIndexBuffer=g.createIndexBuffer(c,!0);const f=new Hc,v=new Hc,S=new Hc,x=new Hc;this._poleSegments=[];for(let A=0,D=0;A<p;A++){const U=360/(1<<A);f.emplaceBack(0,-u,0,.5,0),v.emplaceBack(0,-u,0,.5,1),S.emplaceBack(0,-u,0,.5,.5),x.emplaceBack(0,-u,0,.5,.5);for(let H=0;H<=P;H++){let R=H/P,N=0;const G=cr(0,U,R),[z,V,X]=J(Oce,Fce,G,u);f.emplaceBack(z,V,X,R,N),v.emplaceBack(z,V,X,R,1-N);const K=sn(G);R=.5+.5*Math.sin(K),N=.5+.5*Math.cos(K),S.emplaceBack(z,V,X,R,N),x.emplaceBack(z,V,X,R,1-N)}this._poleSegments.push(xs.simpleSegment(D,0,66,64)),D+=66}this._poleNorthVertexBuffer=g.createVertexBuffer(f,fc,!1),this._poleSouthVertexBuffer=g.createVertexBuffer(v,fc,!1),this._texturedPoleNorthVertexBuffer=g.createVertexBuffer(S,fc,!1),this._texturedPoleSouthVertexBuffer=g.createVertexBuffer(x,fc,!1)}getGridBuffers(g,c){return[this._gridBuffer,this._gridIndexBuffer,c?this._gridSegments[g].withSkirts:this._gridSegments[g].withoutSkirts]}getPoleBuffers(g,c){return[c?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,c?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[g]]}},o.dn=bM,o.dp=An,o.dq=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},o.dr=Sn,o.ds=st,o.dt=Q,o.du=function([g,c,f]){const v=Math.hypot(g,c,f),S=Math.atan2(g,f),x=.5*Math.PI-Math.acos(-c/v);return new ue(ot(S),ot(x))},o.dv=W3,o.dw=oe,o.dx=function(g){const c=g.navigator?g.navigator.userAgent:null;return!!function(f){if(Rs==null){const v=f.navigator?f.navigator.userAgent:null;Rs=!!f.safari||!(!v||!(/\b(iPad|iPhone|iPod)\b/.test(v)||v.match("Safari")&&!v.match("Chrome")))}return Rs}(g)&&c&&(c.match("Version/15.4")||c.match("Version/15.5")||c.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},o.dy=function(g,c){Ct=g,It=c},o.dz=a3,o.e=nt,o.e0=function(g){let c=0;if(new Uint32Array(g,0,1)[0]!==JV){const f=new Uint32Array(g,0,7),[,,v,S,x,A]=f;c=f.byteLength+S+x+A+x,(v!==g.byteLength||c>=g.byteLength)&&Lt("Invalid b3dm header information.")}return nG(g,c)},o.e1=function(g,c){const f=iG(g);for(const v of f){for(const S of v.meshes)cfe(S);v.lights&&(v.lightMeshIndex=v.meshes.length,v.meshes.push(ufe(v.lights,c)))}return f},o.e2=$M,o.e3=LV,o.e4=Oa,o.e5=function(g){lr(),_n!=null&&_n.then(c=>{c.keys().then(f=>{for(let v=0;v<f.length-g;v++)c.delete(f[v])})})},o.f=function(g){return g.indexOf("mapbox:")===0},o.g=function(g,c){return Wo(Sr(g,{method:"GET"}),c)},o.h=Je,o.i=function(g){return nt.API_STYLE_REGEX.test(g)&&!pt(g)},o.j=function(g){return decodeURIComponent(atob(g).split("").map(c=>"%"+("00"+c.charCodeAt(0).toString(16)).slice(-2)).join(""))},o.k=function(g){return btoa(encodeURIComponent(g).replace(/%([0-9A-F]{2})/g,(c,f)=>String.fromCharCode(+("0x"+f))))},o.l=Sr,o.m=dr,o.n=function(g,c){return Wo(Sr(g,{type:"json"}),c)},o.o=Ss,o.p=function(g,c){return Wo(Sr(g,{method:"POST"}),c)},o.q=Cn,o.r=ml,o.s=function(g){try{const c=self[g];return c.setItem("_mapbox_test_",1),c.removeItem("_mapbox_test_"),!0}catch{return!1}},o.t=wp,o.u=function(){return function g(c){return c?(c^Math.random()*(16>>c/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,g)}()},o.v=function(g){return!!g&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(g)},o.w=Lt,o.x=Yl,o.y=2,o.z=F7}),a(["./shared"],function(o){function h(Tt){const xe=Tt?Tt.url.toString():void 0;return xe?performance.getEntriesByName(xe):[]}function d(Tt){if(typeof Tt=="number"||typeof Tt=="boolean"||typeof Tt=="string"||Tt==null)return JSON.stringify(Tt);if(Array.isArray(Tt)){let Ce="[";for(const We of Tt)Ce+=`${d(We)},`;return`${Ce}]`}let xe="{";for(const Ce of Object.keys(Tt).sort())xe+=`${Ce}:${d(Tt[Ce])},`;return`${xe}}`}function m(Tt){let xe="";for(const Ce of o.bg)xe+=`/${d(Tt[Ce])}`;return xe}class _{constructor(xe){this.keyCache={},this._layers={},this._layerConfigs={},xe&&this.replace(xe)}replace(xe,Ce){this._layerConfigs={},this._layers={},this.update(xe,[],Ce)}update(xe,Ce,We){this._options=We;for(const Je of xe)this._layerConfigs[Je.id]=Je,(this._layers[Je.id]=o.cq(Je,this.scope,null,this._options)).compileFilter(We),this.keyCache[Je.id]&&delete this.keyCache[Je.id];for(const Je of Ce)delete this.keyCache[Je],delete this._layerConfigs[Je],delete this._layers[Je];this.familiesBySource={};const nt=function(Je,pt){const Rt={};for(let Pt=0;Pt<Je.length;Pt++){const zt=pt&&pt[Je[Pt].id]||m(Je[Pt]);pt&&(pt[Je[Pt].id]=zt);let Bt=Rt[zt];Bt||(Bt=Rt[zt]=[]),Bt.push(Je[Pt])}const gt=[];for(const Pt in Rt)gt.push(Rt[Pt]);return gt}(o.bd(this._layerConfigs),this.keyCache);for(const Je of nt){const pt=Je.map(ln=>this._layers[ln.id]),Rt=pt[0];if(Rt.visibility==="none")continue;const gt=Rt.source||"";let Pt=this.familiesBySource[gt];Pt||(Pt=this.familiesBySource[gt]={});const zt=Rt.sourceLayer||"_geojsonTileLayer";let Bt=Pt[zt];Bt||(Bt=Pt[zt]=[]),Bt.push(pt)}}}const y=1*o.dP;class T{constructor(xe){const Ce={},We=[];for(const Rt in xe){const gt=xe[Rt],Pt=Ce[Rt]={};for(const zt in gt.glyphs){const Bt=gt.glyphs[+zt];if(!Bt||Bt.bitmap.width===0||Bt.bitmap.height===0)continue;const ln=Bt.metrics.localGlyph?y:1,Mn={x:0,y:0,w:Bt.bitmap.width+2*ln,h:Bt.bitmap.height+2*ln};We.push(Mn),Pt[zt]=Mn}}const{w:nt,h:Je}=o.z(We),pt=new o.dO({width:nt||1,height:Je||1});for(const Rt in xe){const gt=xe[Rt];for(const Pt in gt.glyphs){const zt=gt.glyphs[+Pt];if(!zt||zt.bitmap.width===0||zt.bitmap.height===0)continue;const Bt=Ce[Rt][Pt],ln=zt.metrics.localGlyph?y:1;o.dO.copy(zt.bitmap,pt,{x:0,y:0},{x:Bt.x+ln,y:Bt.y+ln},zt.bitmap)}}this.image=pt,this.positions=Ce}}o.dN(T,"GlyphAtlas");class I{constructor(xe){this.tileID=new o.aA(xe.tileID.overscaledZ,xe.tileID.wrap,xe.tileID.canonical.z,xe.tileID.canonical.x,xe.tileID.canonical.y),this.tileZoom=xe.tileZoom,this.uid=xe.uid,this.zoom=xe.zoom,this.lut=xe.lut,this.canonical=xe.tileID.canonical,this.pixelRatio=xe.pixelRatio,this.tileSize=xe.tileSize,this.source=xe.source,this.scope=xe.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=xe.showCollisionBoxes,this.collectResourceTiming=!!xe.collectResourceTiming,this.promoteId=xe.promoteId,this.isSymbolTile=xe.isSymbolTile,this.tileTransform=o.aK(xe.tileID.canonical,xe.projection),this.projection=xe.projection,this.brightness=xe.brightness,this.extraShadowCaster=!!xe.extraShadowCaster,this.tessellationStep=xe.tessellationStep}parse(xe,Ce,We,nt,Je){this.status="parsing",this.data=xe,this.collisionBoxArray=new o.aQ;const pt=new o.dQ(Object.keys(xe.layers).sort()),Rt=new o.dR(this.tileID,this.promoteId);Rt.bucketLayerIDs=[];const gt={},Pt=new o.dS(256,256),zt={featureIndex:Rt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:Pt,availableImages:We,brightness:this.brightness},Bt=Ce.familiesBySource[this.source];for(const Ct in Bt){const It=xe.layers[Ct];if(!It)continue;let wn=!1,_n=!1,zn=!1;for(const gr of Bt[Ct])gr[0].type==="symbol"?wn=!0:_n=!0,gr[0].is3D()&&gr[0].type!=="model"&&(zn=!0);if(this.extraShadowCaster&&!zn||this.isSymbolTile===!0&&!wn||this.isSymbolTile===!1&&!_n)continue;It.version===1&&o.w(`Vector tile source "${this.source}" layer "${Ct}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Xn=pt.encode(Ct),lr=[];for(let gr=0;gr<It.length;gr++){const dr=It.feature(gr),hi=Rt.getId(dr,Ct);lr.push({feature:dr,id:hi,index:gr,sourceLayerIndex:Xn})}for(const gr of Bt[Ct]){const dr=gr[0];(!this.extraShadowCaster||dr.is3D()&&dr.type!=="model")&&(this.isSymbolTile!==void 0&&dr.type==="symbol"!==this.isSymbolTile||dr.minzoom&&this.zoom<Math.floor(dr.minzoom)||dr.maxzoom&&this.zoom>=dr.maxzoom||dr.visibility!=="none"&&(C(gr,this.zoom,zt.brightness,We),(gt[dr.id]=dr.createBucket({index:Rt.bucketLayerIDs.length,layers:gr,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Xn,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(lr,zt,this.tileID.canonical,this.tileTransform),Rt.bucketLayerIDs.push(gr.map(hi=>hi.id))))}}let ln,Mn,Cn,Ve;Pt.trim();const yt={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Mt=()=>{if(ln)return this.status="done",Je(ln);if(this.extraShadowCaster)this.status="done",Je(null,{buckets:o.bd(gt).filter(Ct=>!Ct.isEmpty()),featureIndex:Rt,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:zt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Mn&&Cn&&Ve){const Ct=new T(Mn),It=new o.dU(Cn,Ve,this.lut);for(const wn in gt){const _n=gt[wn];_n instanceof o.aR?(C(_n.layers,this.zoom,zt.brightness,We),o.dV(_n,Mn,Ct.positions,Cn,It.iconPositions,this.showCollisionBoxes,We,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):_n.hasPattern&&(_n instanceof o.aX||_n instanceof o.aY||_n instanceof o.d0)&&(C(_n.layers,this.zoom,zt.brightness,We),_n.addFeatures(zt,this.tileID.canonical,It.patternPositions,We,this.tileTransform,this.brightness))}this.status="done",Je(null,{buckets:o.bd(gt).filter(wn=>!wn.isEmpty()),featureIndex:Rt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ct.image,lineAtlas:Pt,imageAtlas:It,brightness:zt.brightness})}};if(!this.extraShadowCaster){const Ct=o.dT(zt.glyphDependencies,_n=>Object.keys(_n).map(Number));Object.keys(Ct).length?nt.send("getGlyphs",{uid:this.uid,stacks:Ct,scope:this.scope},(_n,zn)=>{ln||(ln=_n,Mn=zn,Mt())},void 0,!1,yt):Mn={};const It=Object.keys(zt.iconDependencies);It.length?nt.send("getImages",{icons:It,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(_n,zn)=>{ln||(ln=_n,Cn=zn,Mt())},void 0,!1,yt):Cn={};const wn=Object.keys(zt.patternDependencies);wn.length?nt.send("getImages",{icons:wn,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(_n,zn)=>{ln||(ln=_n,Ve=zn,Mt())},void 0,!1,yt):Ve={}}Mt()}}function C(Tt,xe,Ce,We){const nt=new o.a3(xe,{brightness:Ce});for(const Je of Tt)Je.recalculate(nt,We)}class M extends o.E{constructor(xe,Ce,We,nt,Je,pt){super(),this.actor=xe,this.layerIndex=Ce,this.availableImages=We,this.loadVectorData=Je||o.aw,this.loading={},this.loaded={},this.deduped=new o.au(xe.scheduler),this.isSpriteLoaded=nt,this.scheduler=xe.scheduler,this.brightness=pt}loadTile(xe,Ce){const We=xe.uid,nt=xe&&xe.request,Je=nt&&nt.collectResourceTiming,pt=this.loading[We]=new I(xe);pt.abort=this.loadVectorData(xe,(Rt,gt)=>{const Pt=!this.loading[We];if(delete this.loading[We],Pt||Rt||!gt)return pt.status="done",Pt||(this.loaded[We]=pt),Ce(Rt);const zt=gt.rawData,Bt={};gt.expires&&(Bt.expires=gt.expires),gt.cacheControl&&(Bt.cacheControl=gt.cacheControl),pt.vectorTile=gt.vectorTile||new o.dW.VectorTile(new o.bb(zt));const ln=()=>{pt.parse(pt.vectorTile,this.layerIndex,this.availableImages,this.actor,(Mn,Cn)=>{if(Mn||!Cn)return Ce(Mn);const Ve={};if(Je){const yt=h(nt);yt.length>0&&(Ve.resourceTiming=JSON.parse(JSON.stringify(yt)))}Ce(null,o.l({rawTileData:zt.slice(0)},Cn,Bt,Ve))})};this.isSpriteLoaded?ln():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(ln,{type:"parseTile",isSymbolTile:xe.isSymbolTile,zoom:xe.tileZoom}):ln()}),this.loaded=this.loaded||{},this.loaded[We]=pt})}reloadTile(xe,Ce){const We=this.loaded,nt=xe.uid;if(We&&We[nt]){const Je=We[nt];Je.showCollisionBoxes=xe.showCollisionBoxes,Je.projection=xe.projection,Je.brightness=xe.brightness,Je.tileTransform=o.aK(xe.tileID.canonical,xe.projection),Je.extraShadowCaster=xe.extraShadowCaster,Je.lut=xe.lut;const pt=(Rt,gt)=>{const Pt=Je.reloadCallback;Pt&&(delete Je.reloadCallback,Je.parse(Je.vectorTile,this.layerIndex,this.availableImages,this.actor,Pt)),Ce(Rt,gt)};Je.status==="parsing"?Je.reloadCallback=pt:Je.status==="done"&&(Je.vectorTile?Je.parse(Je.vectorTile,this.layerIndex,this.availableImages,this.actor,pt):pt())}else Ce(null,void 0)}abortTile(xe,Ce){const We=xe.uid,nt=this.loading[We];nt&&(nt.abort&&nt.abort(),delete this.loading[We]),Ce()}removeTile(xe,Ce){const We=this.loaded,nt=xe.uid;We&&We[nt]&&delete We[nt],Ce()}}class B{loadTile(xe,Ce){const{uid:We,encoding:nt,rawImageData:Je,padding:pt}=xe,Rt=ImageBitmap&&Je instanceof ImageBitmap?this.getImageData(Je,pt):Je;Ce(null,new o.dX(We,Rt,nt,pt<1))}getImageData(xe,Ce){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(xe.width,xe.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=xe.width,this.offscreenCanvas.height=xe.height,this.offscreenCanvasContext.drawImage(xe,0,0,xe.width,xe.height);const We=this.offscreenCanvasContext.getImageData(-Ce,-Ce,xe.width+2*Ce,xe.height+2*Ce);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),We}}o.ba.setPbf(o.bb);class k{decodeRasterArray({task:xe,buffer:Ce},We){o.ba.performDecoding(Ce,xe).then(nt=>{We(null,nt)},nt=>{We(nt)})}}const j=o.dW.VectorTileFeature.prototype.toGeoJSON;class q{constructor(xe){this._feature=xe,this.extent=o.ab,this.type=xe.type,this.properties=xe.tags,"id"in xe&&!isNaN(xe.id)&&(this.id=parseInt(xe.id,10))}loadGeometry(){if(this._feature.type===1){const xe=[];for(const Ce of this._feature.geometry)xe.push([new o.P(Ce[0],Ce[1])]);return xe}{const xe=[];for(const Ce of this._feature.geometry){const We=[];for(const nt of Ce)We.push(new o.P(nt[0],nt[1]));xe.push(We)}return xe}}toGeoJSON(xe,Ce,We){return j.call(this,xe,Ce,We)}}class Z{constructor(xe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.ab,this.length=xe.length,this._features=xe}feature(xe){return new q(this._features[xe])}}const te=64/4096,ie=128;class se{constructor(){this.features=new Map}clear(){this.features.clear()}load(xe=[],Ce){for(const We of xe){const nt=We.id;if(nt==null)continue;let Je=this.features.get(nt);Je&&this.updateCache(Je,Ce),We.geometry?(Je=fe(We),this.updateCache(Je,Ce),this.features.set(nt,Je)):this.features.delete(nt),this.updateCache(Je,Ce)}}updateCache(xe,Ce){for(const{canonical:We,uid:nt}of Object.values(Ce)){const{z:Je,x:pt,y:Rt}=We;ae(xe,Math.pow(2,Je),pt,Rt)&&delete Ce[nt]}}getTile(xe,Ce,We){const nt=Math.pow(2,xe),Je=[];for(const pt of this.features.values())ae(pt,nt,Ce,We)&&Je.push(qe(pt,nt,Ce,We));return{features:Je}}getFeatures(){return[...this.features.values()]}}function ae({minX:Tt,minY:xe,maxX:Ce,maxY:We},nt,Je,pt){return Tt<(Je+1+te)/nt&&xe<(pt+1+te)/nt&&Ce>(Je-te)/nt&&We>(pt-te)/nt}function fe(Tt){const{id:xe,geometry:Ce,properties:We}=Tt;if(!Ce)return;if(Ce.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:nt,coordinates:Je}=Ce,pt={id:xe,type:1,geometry:[],tags:We,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Rt=pt.geometry;if(nt==="Point")Se(Je,Rt,pt);else if(nt==="MultiPoint")for(const gt of Je)Se(gt,Rt,pt);else if(nt==="LineString")pt.type=2,Ee(Je,Rt,pt);else if(nt==="MultiLineString")pt.type=2,Re(Je,Rt,pt);else if(nt==="Polygon")pt.type=3,Re(Je,Rt,pt,!0);else{if(nt!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");pt.type=3;for(const gt of Je)Re(gt,Rt,pt,!0)}return pt}function Se([Tt,xe],Ce,We){const nt=o.am(Tt);let Je=o.at(xe);Je=Je<0?0:Je>1?1:Je,Ce.push(nt,Je),We.minX=Math.min(We.minX,nt),We.minY=Math.min(We.minY,Je),We.maxX=Math.max(We.maxX,nt),We.maxY=Math.max(We.maxY,Je)}function Ee(Tt,xe,Ce,We=!1,nt=!1){const Je=[];for(const pt of Tt)Se(pt,Je,Ce);xe.push(Je),We&&function(pt,Rt){let gt=0;for(let Pt=0,zt=pt.length,Bt=zt-2;Pt<zt;Bt=Pt,Pt+=2)gt+=(pt[Pt]-pt[Bt])*(pt[Pt+1]+pt[Bt+1]);if(gt>0===Rt)for(let Pt=0,zt=pt.length;Pt<zt/2;Pt+=2){const Bt=pt[Pt],ln=pt[Pt+1];pt[Pt]=pt[zt-2-Pt],pt[Pt+1]=pt[zt-1-Pt],pt[zt-2-Pt]=Bt,pt[zt-1-Pt]=ln}}(Je,nt)}function Re(Tt,xe,Ce,We=!1){for(let nt=0;nt<Tt.length;nt++)Ee(Tt[nt],xe,Ce,We,nt===0)}function qe(Tt,xe,Ce,We){const{id:nt,type:Je,geometry:pt,tags:Rt}=Tt,gt=[];if(Je===1)(function(Pt,zt,Bt,ln,Mn){for(let Cn=0;Cn<Pt.length;Cn+=2){const Ve=Math.round(o.ab*(Pt[Cn+0]*zt-Bt)),yt=Math.round(o.ab*(Pt[Cn+1]*zt-ln));Mn.push([Ve,yt])}})(pt,xe,Ce,We,gt);else for(const Pt of pt)Le(Pt,xe,Ce,We,gt);return{id:nt,type:Je,geometry:gt,tags:Rt}}function Le(Tt,xe,Ce,We,nt){const Je=-ie,pt=o.ab+ie;let Rt;for(let gt=0;gt<Tt.length-2;gt+=2){let Pt=Math.round(o.ab*(Tt[gt+0]*xe-Ce)),zt=Math.round(o.ab*(Tt[gt+1]*xe-We)),Bt=Math.round(o.ab*(Tt[gt+2]*xe-Ce)),ln=Math.round(o.ab*(Tt[gt+3]*xe-We));const Mn=Bt-Pt,Cn=ln-zt;Pt<Je&&Bt<Je||(Pt<Je?(zt+=Math.round(Cn*((Je-Pt)/Mn)),Pt=Je):Bt<Je&&(ln=zt+Math.round(Cn*((Je-Pt)/Mn)),Bt=Je),zt<Je&&ln<Je||(zt<Je?(Pt+=Math.round(Mn*((Je-zt)/Cn)),zt=Je):ln<Je&&(Bt=Pt+Math.round(Mn*((Je-zt)/Cn)),ln=Je),Pt>=pt&&Bt>=pt||(Pt>=pt?(zt+=Math.round(Cn*((pt-Pt)/Mn)),Pt=pt):Bt>=pt&&(ln=zt+Math.round(Cn*((pt-Pt)/Mn)),Bt=pt),zt>=pt&&ln>=pt||(zt>=pt?(Pt+=Math.round(Mn*((pt-zt)/Cn)),zt=pt):ln>=pt&&(Bt=Pt+Math.round(Mn*((pt-zt)/Cn)),ln=pt),Rt&&Pt===Rt[Rt.length-1][0]&&zt===Rt[Rt.length-1][1]||(Rt=[[Pt,zt]],nt.push(Rt)),Rt.push([Bt,ln])))))}}var dt,ye,Xe,He={exports:{}},_t=function(){if(Xe)return He.exports;Xe=1;var Tt=o.d_(),xe=function(){if(ye)return dt;ye=1;var zt=o.dY(),Bt=o.dZ().VectorTileFeature;function ln(Cn,Ve){this.options=Ve||{},this.features=Cn,this.length=Cn.length}function Mn(Cn,Ve){this.id=typeof Cn.id=="number"?Cn.id:void 0,this.type=Cn.type,this.rawGeometry=Cn.type===1?[Cn.geometry]:Cn.geometry,this.properties=Cn.tags,this.extent=Ve||4096}return dt=ln,ln.prototype.feature=function(Cn){return new Mn(this.features[Cn],this.options.extent)},Mn.prototype.loadGeometry=function(){var Cn=this.rawGeometry;this.geometry=[];for(var Ve=0;Ve<Cn.length;Ve++){for(var yt=Cn[Ve],Mt=[],Ct=0;Ct<yt.length;Ct++)Mt.push(new zt(yt[Ct][0],yt[Ct][1]));this.geometry.push(Mt)}return this.geometry},Mn.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Cn=this.geometry,Ve=1/0,yt=-1/0,Mt=1/0,Ct=-1/0,It=0;It<Cn.length;It++)for(var wn=Cn[It],_n=0;_n<wn.length;_n++){var zn=wn[_n];Ve=Math.min(Ve,zn.x),yt=Math.max(yt,zn.x),Mt=Math.min(Mt,zn.y),Ct=Math.max(Ct,zn.y)}return[Ve,Mt,yt,Ct]},Mn.prototype.toGeoJSON=Bt.prototype.toGeoJSON,dt}();function Ce(zt){var Bt=new Tt;return function(ln,Mn){for(var Cn in ln.layers)Mn.writeMessage(3,We,ln.layers[Cn])}(zt,Bt),Bt.finish()}function We(zt,Bt){var ln;Bt.writeVarintField(15,zt.version||1),Bt.writeStringField(1,zt.name||""),Bt.writeVarintField(5,zt.extent||4096);var Mn={keys:[],values:[],keycache:{},valuecache:{}};for(ln=0;ln<zt.length;ln++)Mn.feature=zt.feature(ln),Bt.writeMessage(2,nt,Mn);var Cn=Mn.keys;for(ln=0;ln<Cn.length;ln++)Bt.writeStringField(3,Cn[ln]);var Ve=Mn.values;for(ln=0;ln<Ve.length;ln++)Bt.writeMessage(4,Pt,Ve[ln])}function nt(zt,Bt){var ln=zt.feature;ln.id!==void 0&&Bt.writeVarintField(1,ln.id),Bt.writeMessage(2,Je,zt),Bt.writeVarintField(3,ln.type),Bt.writeMessage(4,gt,ln)}function Je(zt,Bt){var ln=zt.feature,Mn=zt.keys,Cn=zt.values,Ve=zt.keycache,yt=zt.valuecache;for(var Mt in ln.properties){var Ct=ln.properties[Mt],It=Ve[Mt];if(Ct!==null){It===void 0&&(Mn.push(Mt),Ve[Mt]=It=Mn.length-1),Bt.writeVarint(It);var wn=typeof Ct;wn!=="string"&&wn!=="boolean"&&wn!=="number"&&(Ct=JSON.stringify(Ct));var _n=wn+":"+Ct,zn=yt[_n];zn===void 0&&(Cn.push(Ct),yt[_n]=zn=Cn.length-1),Bt.writeVarint(zn)}}}function pt(zt,Bt){return(Bt<<3)+(7&zt)}function Rt(zt){return zt<<1^zt>>31}function gt(zt,Bt){for(var ln=zt.loadGeometry(),Mn=zt.type,Cn=0,Ve=0,yt=ln.length,Mt=0;Mt<yt;Mt++){var Ct=ln[Mt],It=1;Mn===1&&(It=Ct.length),Bt.writeVarint(pt(1,It));for(var wn=Mn===3?Ct.length-1:Ct.length,_n=0;_n<wn;_n++){_n===1&&Mn!==1&&Bt.writeVarint(pt(2,wn-1));var zn=Ct[_n].x-Cn,Xn=Ct[_n].y-Ve;Bt.writeVarint(Rt(zn)),Bt.writeVarint(Rt(Xn)),Cn+=zn,Ve+=Xn}Mn===3&&Bt.writeVarint(pt(7,1))}}function Pt(zt,Bt){var ln=typeof zt;ln==="string"?Bt.writeStringField(1,zt):ln==="boolean"?Bt.writeBooleanField(7,zt):ln==="number"&&(zt%1!=0?Bt.writeDoubleField(3,zt):zt<0?Bt.writeSVarintField(6,zt):Bt.writeVarintField(5,zt))}return He.exports=Ce,He.exports.fromVectorTileJs=Ce,He.exports.fromGeojsonVt=function(zt,Bt){Bt=Bt||{};var ln={};for(var Mn in zt)ln[Mn]=new xe(zt[Mn].features,Bt),ln[Mn].name=Mn,ln[Mn].version=Bt.version,ln[Mn].extent=Bt.extent;return Ce({layers:ln})},He.exports.GeoJSONWrapper=xe,He.exports}(),wt=o.d$(_t);const Gt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Tt=>Tt},at=Math.fround||(Ht=new Float32Array(1),Tt=>(Ht[0]=+Tt,Ht[0]));var Ht;const Qt=3,rn=5,jn=6;class Bn{constructor(xe){this.options=Object.assign(Object.create(Gt),xe),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(xe){const{log:Ce,minZoom:We,maxZoom:nt}=this.options;Ce&&console.time("total time");const Je=`prepare ${xe.length} points`;Ce&&console.time(Je),this.points=xe;const pt=[];for(let gt=0;gt<xe.length;gt++){const Pt=xe[gt];if(!Pt.geometry)continue;const[zt,Bt]=Pt.geometry.coordinates,ln=at($e(zt)),Mn=at(mn(Bt));pt.push(ln,Mn,1/0,gt,-1,1),this.options.reduce&&pt.push(0)}let Rt=this.trees[nt+1]=this._createTree(pt);Ce&&console.timeEnd(Je);for(let gt=nt;gt>=We;gt--){const Pt=+Date.now();Rt=this.trees[gt]=this._createTree(this._cluster(Rt,gt)),Ce&&console.log("z%d: %d clusters in %dms",gt,Rt.numItems,+Date.now()-Pt)}return Ce&&console.timeEnd("total time"),this}getClusters(xe,Ce){let We=((xe[0]+180)%360+360)%360-180;const nt=Math.max(-90,Math.min(90,xe[1]));let Je=xe[2]===180?180:((xe[2]+180)%360+360)%360-180;const pt=Math.max(-90,Math.min(90,xe[3]));if(xe[2]-xe[0]>=360)We=-180,Je=180;else if(We>Je){const Bt=this.getClusters([We,nt,180,pt],Ce),ln=this.getClusters([-180,nt,Je,pt],Ce);return Bt.concat(ln)}const Rt=this.trees[this._limitZoom(Ce)],gt=Rt.range($e(We),mn(pt),$e(Je),mn(nt)),Pt=Rt.data,zt=[];for(const Bt of gt){const ln=this.stride*Bt;zt.push(Pt[ln+rn]>1?Tn(Pt,ln,this.clusterProps):this.points[Pt[ln+Qt]])}return zt}getChildren(xe){const Ce=this._getOriginId(xe),We=this._getOriginZoom(xe),nt="No cluster with the specified id.",Je=this.trees[We];if(!Je)throw new Error(nt);const pt=Je.data;if(Ce*this.stride>=pt.length)throw new Error(nt);const Rt=this.options.radius/(this.options.extent*Math.pow(2,We-1)),gt=Je.within(pt[Ce*this.stride],pt[Ce*this.stride+1],Rt),Pt=[];for(const zt of gt){const Bt=zt*this.stride;pt[Bt+4]===xe&&Pt.push(pt[Bt+rn]>1?Tn(pt,Bt,this.clusterProps):this.points[pt[Bt+Qt]])}if(Pt.length===0)throw new Error(nt);return Pt}getLeaves(xe,Ce,We){const nt=[];return this._appendLeaves(nt,xe,Ce=Ce||10,We=We||0,0),nt}getTile(xe,Ce,We){const nt=this.trees[this._limitZoom(xe)],Je=Math.pow(2,xe),{extent:pt,radius:Rt}=this.options,gt=Rt/pt,Pt=(We-gt)/Je,zt=(We+1+gt)/Je,Bt={features:[]};return this._addTileFeatures(nt.range((Ce-gt)/Je,Pt,(Ce+1+gt)/Je,zt),nt.data,Ce,We,Je,Bt),Ce===0&&this._addTileFeatures(nt.range(1-gt/Je,Pt,1,zt),nt.data,Je,We,Je,Bt),Ce===Je-1&&this._addTileFeatures(nt.range(0,Pt,gt/Je,zt),nt.data,-1,We,Je,Bt),Bt.features.length?Bt:null}getClusterExpansionZoom(xe){let Ce=this._getOriginZoom(xe)-1;for(;Ce<=this.options.maxZoom;){const We=this.getChildren(xe);if(Ce++,We.length!==1)break;xe=We[0].properties.cluster_id}return Ce}_appendLeaves(xe,Ce,We,nt,Je){const pt=this.getChildren(Ce);for(const Rt of pt){const gt=Rt.properties;if(gt&&gt.cluster?Je+gt.point_count<=nt?Je+=gt.point_count:Je=this._appendLeaves(xe,gt.cluster_id,We,nt,Je):Je<nt?Je++:xe.push(Rt),xe.length===We)break}return Je}_createTree(xe){const Ce=new o.by(xe.length/this.stride|0,this.options.nodeSize,Float32Array);for(let We=0;We<xe.length;We+=this.stride)Ce.add(xe[We],xe[We+1]);return Ce.finish(),Ce.data=xe,Ce}_addTileFeatures(xe,Ce,We,nt,Je,pt){for(const Rt of xe){const gt=Rt*this.stride,Pt=Ce[gt+rn]>1;let zt,Bt,ln;if(Pt)zt=Pe(Ce,gt,this.clusterProps),Bt=Ce[gt],ln=Ce[gt+1];else{const Ve=this.points[Ce[gt+Qt]];zt=Ve.properties;const[yt,Mt]=Ve.geometry.coordinates;Bt=$e(yt),ln=mn(Mt)}const Mn={type:1,geometry:[[Math.round(this.options.extent*(Bt*Je-We)),Math.round(this.options.extent*(ln*Je-nt))]],tags:zt};let Cn;Cn=Pt||this.options.generateId?Ce[gt+Qt]:this.points[Ce[gt+Qt]].id,Cn!==void 0&&(Mn.id=Cn),pt.features.push(Mn)}}_limitZoom(xe){return Math.max(this.options.minZoom,Math.min(Math.floor(+xe),this.options.maxZoom+1))}_cluster(xe,Ce){const{radius:We,extent:nt,reduce:Je,minPoints:pt}=this.options,Rt=We/(nt*Math.pow(2,Ce)),gt=xe.data,Pt=[],zt=this.stride;for(let Bt=0;Bt<gt.length;Bt+=zt){if(gt[Bt+2]<=Ce)continue;gt[Bt+2]=Ce;const ln=gt[Bt],Mn=gt[Bt+1],Cn=xe.within(gt[Bt],gt[Bt+1],Rt),Ve=gt[Bt+rn];let yt=Ve;for(const Mt of Cn){const Ct=Mt*zt;gt[Ct+2]>Ce&&(yt+=gt[Ct+rn])}if(yt>Ve&&yt>=pt){let Mt,Ct=ln*Ve,It=Mn*Ve,wn=-1;const _n=(Bt/zt<<5)+(Ce+1)+this.points.length;for(const zn of Cn){const Xn=zn*zt;if(gt[Xn+2]<=Ce)continue;gt[Xn+2]=Ce;const lr=gt[Xn+rn];Ct+=gt[Xn]*lr,It+=gt[Xn+1]*lr,gt[Xn+4]=_n,Je&&(Mt||(Mt=this._map(gt,Bt,!0),wn=this.clusterProps.length,this.clusterProps.push(Mt)),Je(Mt,this._map(gt,Xn)))}gt[Bt+4]=_n,Pt.push(Ct/yt,It/yt,1/0,_n,-1,yt),Je&&Pt.push(wn)}else{for(let Mt=0;Mt<zt;Mt++)Pt.push(gt[Bt+Mt]);if(yt>1)for(const Mt of Cn){const Ct=Mt*zt;if(!(gt[Ct+2]<=Ce)){gt[Ct+2]=Ce;for(let It=0;It<zt;It++)Pt.push(gt[Ct+It])}}}}return Pt}_getOriginId(xe){return xe-this.points.length>>5}_getOriginZoom(xe){return(xe-this.points.length)%32}_map(xe,Ce,We){if(xe[Ce+rn]>1){const pt=this.clusterProps[xe[Ce+jn]];return We?Object.assign({},pt):pt}const nt=this.points[xe[Ce+Qt]].properties,Je=this.options.map(nt);return We&&Je===nt?Object.assign({},Je):Je}}function Tn(Tt,xe,Ce){return{type:"Feature",id:Tt[xe+Qt],properties:Pe(Tt,xe,Ce),geometry:{type:"Point",coordinates:[(We=Tt[xe],360*(We-.5)),cn(Tt[xe+1])]}};var We}function Pe(Tt,xe,Ce){const We=Tt[xe+rn],nt=We>=1e4?`${Math.round(We/1e3)}k`:We>=1e3?Math.round(We/100)/10+"k":We,Je=Tt[xe+jn],pt=Je===-1?{}:Object.assign({},Ce[Je]);return Object.assign(pt,{cluster:!0,cluster_id:Tt[xe+Qt],point_count:We,point_count_abbreviated:nt})}function $e(Tt){return Tt/360+.5}function mn(Tt){const xe=Math.sin(Tt*Math.PI/180),Ce=.5-.25*Math.log((1+xe)/(1-xe))/Math.PI;return Ce<0?0:Ce>1?1:Ce}function cn(Tt){const xe=(180-360*Tt)*Math.PI/180;return 360*Math.atan(Math.exp(xe))/Math.PI-90}function St(Tt,xe,Ce,We){let nt=We;const Je=xe+(Ce-xe>>1);let pt,Rt=Ce-xe;const gt=Tt[xe],Pt=Tt[xe+1],zt=Tt[Ce],Bt=Tt[Ce+1];for(let ln=xe+3;ln<Ce;ln+=3){const Mn=Jt(Tt[ln],Tt[ln+1],gt,Pt,zt,Bt);if(Mn>nt)pt=ln,nt=Mn;else if(Mn===nt){const Cn=Math.abs(ln-Je);Cn<Rt&&(pt=ln,Rt=Cn)}}nt>We&&(pt-xe>3&&St(Tt,xe,pt,We),Tt[pt+2]=nt,Ce-pt>3&&St(Tt,pt,Ce,We))}function Jt(Tt,xe,Ce,We,nt,Je){let pt=nt-Ce,Rt=Je-We;if(pt!==0||Rt!==0){const gt=((Tt-Ce)*pt+(xe-We)*Rt)/(pt*pt+Rt*Rt);gt>1?(Ce=nt,We=Je):gt>0&&(Ce+=pt*gt,We+=Rt*gt)}return pt=Tt-Ce,Rt=xe-We,pt*pt+Rt*Rt}function kn(Tt,xe,Ce,We){const nt={id:Tt??null,type:xe,geometry:Ce,tags:We,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(xe==="Point"||xe==="MultiPoint"||xe==="LineString")Vn(nt,Ce);else if(xe==="Polygon")Vn(nt,Ce[0]);else if(xe==="MultiLineString")for(const Je of Ce)Vn(nt,Je);else if(xe==="MultiPolygon")for(const Je of Ce)Vn(nt,Je[0]);return nt}function Vn(Tt,xe){for(let Ce=0;Ce<xe.length;Ce+=3)Tt.minX=Math.min(Tt.minX,xe[Ce]),Tt.minY=Math.min(Tt.minY,xe[Ce+1]),Tt.maxX=Math.max(Tt.maxX,xe[Ce]),Tt.maxY=Math.max(Tt.maxY,xe[Ce+1])}function sn(Tt,xe,Ce,We){if(!xe.geometry)return;const nt=xe.geometry.coordinates;if(nt&&nt.length===0)return;const Je=xe.geometry.type,pt=Math.pow(Ce.tolerance/((1<<Ce.maxZoom)*Ce.extent),2);let Rt=[],gt=xe.id;if(Ce.promoteId?gt=xe.properties[Ce.promoteId]:Ce.generateId&&(gt=We||0),Je==="Point")ot(nt,Rt);else if(Je==="MultiPoint")for(const Pt of nt)ot(Pt,Rt);else if(Je==="LineString")Ue(nt,Rt,pt,!1);else if(Je==="MultiLineString"){if(Ce.lineMetrics){for(const Pt of nt)Rt=[],Ue(Pt,Rt,pt,!1),Tt.push(kn(gt,"LineString",Rt,xe.properties));return}$t(nt,Rt,pt,!1)}else if(Je==="Polygon")$t(nt,Rt,pt,!0);else{if(Je!=="MultiPolygon"){if(Je==="GeometryCollection"){for(const Pt of xe.geometry.geometries)sn(Tt,{id:gt,geometry:Pt,properties:xe.properties},Ce,We);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Pt of nt){const zt=[];$t(Pt,zt,pt,!0),Rt.push(zt)}}Tt.push(kn(gt,Je,Rt,xe.properties))}function ot(Tt,xe){xe.push(An(Tt[0]),Sn(Tt[1]),0)}function Ue(Tt,xe,Ce,We){let nt,Je,pt=0;for(let gt=0;gt<Tt.length;gt++){const Pt=An(Tt[gt][0]),zt=Sn(Tt[gt][1]);xe.push(Pt,zt,0),gt>0&&(pt+=We?(nt*zt-Pt*Je)/2:Math.sqrt(Math.pow(Pt-nt,2)+Math.pow(zt-Je,2))),nt=Pt,Je=zt}const Rt=xe.length-3;xe[2]=1,St(xe,0,Rt,Ce),xe[Rt+2]=1,xe.size=Math.abs(pt),xe.start=0,xe.end=xe.size}function $t(Tt,xe,Ce,We){for(let nt=0;nt<Tt.length;nt++){const Je=[];Ue(Tt[nt],Je,Ce,We),xe.push(Je)}}function An(Tt){return Tt/360+.5}function Sn(Tt){const xe=Math.sin(Tt*Math.PI/180),Ce=.5-.25*Math.log((1+xe)/(1-xe))/Math.PI;return Ce<0?0:Ce>1?1:Ce}function jt(Tt,xe,Ce,We,nt,Je,pt,Rt){if(We/=xe,Je>=(Ce/=xe)&&pt<We)return Tt;if(pt<Ce||Je>=We)return null;const gt=[];for(const Pt of Tt){const zt=Pt.geometry;let Bt=Pt.type;const ln=nt===0?Pt.minX:Pt.minY,Mn=nt===0?Pt.maxX:Pt.maxY;if(ln>=Ce&&Mn<We){gt.push(Pt);continue}if(Mn<Ce||ln>=We)continue;let Cn=[];if(Bt==="Point"||Bt==="MultiPoint")mr(zt,Cn,Ce,We,nt);else if(Bt==="LineString")Un(zt,Cn,Ce,We,nt,!1,Rt.lineMetrics);else if(Bt==="MultiLineString")Sr(zt,Cn,Ce,We,nt,!1);else if(Bt==="Polygon")Sr(zt,Cn,Ce,We,nt,!0);else if(Bt==="MultiPolygon")for(const Ve of zt){const yt=[];Sr(Ve,yt,Ce,We,nt,!0),yt.length&&Cn.push(yt)}if(Cn.length){if(Rt.lineMetrics&&Bt==="LineString"){for(const Ve of Cn)gt.push(kn(Pt.id,Bt,Ve,Pt.tags));continue}Bt!=="LineString"&&Bt!=="MultiLineString"||(Cn.length===1?(Bt="LineString",Cn=Cn[0]):Bt="MultiLineString"),Bt!=="Point"&&Bt!=="MultiPoint"||(Bt=Cn.length===3?"Point":"MultiPoint"),gt.push(kn(Pt.id,Bt,Cn,Pt.tags))}}return gt.length?gt:null}function mr(Tt,xe,Ce,We,nt){for(let Je=0;Je<Tt.length;Je+=3){const pt=Tt[Je+nt];pt>=Ce&&pt<=We&&Ln(xe,Tt[Je],Tt[Je+1],Tt[Je+2])}}function Un(Tt,xe,Ce,We,nt,Je,pt){let Rt=tr(Tt);const gt=nt===0?ir:ci;let Pt,zt,Bt=Tt.start;for(let yt=0;yt<Tt.length-3;yt+=3){const Mt=Tt[yt],Ct=Tt[yt+1],It=Tt[yt+2],wn=Tt[yt+3],_n=Tt[yt+4],zn=nt===0?Mt:Ct,Xn=nt===0?wn:_n;let lr=!1;pt&&(Pt=Math.sqrt(Math.pow(Mt-wn,2)+Math.pow(Ct-_n,2))),zn<Ce?Xn>Ce&&(zt=gt(Rt,Mt,Ct,wn,_n,Ce),pt&&(Rt.start=Bt+Pt*zt)):zn>We?Xn<We&&(zt=gt(Rt,Mt,Ct,wn,_n,We),pt&&(Rt.start=Bt+Pt*zt)):Ln(Rt,Mt,Ct,It),Xn<Ce&&zn>=Ce&&(zt=gt(Rt,Mt,Ct,wn,_n,Ce),lr=!0),Xn>We&&zn<=We&&(zt=gt(Rt,Mt,Ct,wn,_n,We),lr=!0),!Je&&lr&&(pt&&(Rt.end=Bt+Pt*zt),xe.push(Rt),Rt=tr(Tt)),pt&&(Bt+=Pt)}let ln=Tt.length-3;const Mn=Tt[ln],Cn=Tt[ln+1],Ve=nt===0?Mn:Cn;Ve>=Ce&&Ve<=We&&Ln(Rt,Mn,Cn,Tt[ln+2]),ln=Rt.length-3,Je&&ln>=3&&(Rt[ln]!==Rt[0]||Rt[ln+1]!==Rt[1])&&Ln(Rt,Rt[0],Rt[1],Rt[2]),Rt.length&&xe.push(Rt)}function tr(Tt){const xe=[];return xe.size=Tt.size,xe.start=Tt.start,xe.end=Tt.end,xe}function Sr(Tt,xe,Ce,We,nt,Je){for(const pt of Tt)Un(pt,xe,Ce,We,nt,Je,!1)}function Ln(Tt,xe,Ce,We){Tt.push(xe,Ce,We)}function ir(Tt,xe,Ce,We,nt,Je){const pt=(Je-xe)/(We-xe);return Ln(Tt,Je,Ce+(nt-Ce)*pt,1),pt}function ci(Tt,xe,Ce,We,nt,Je){const pt=(Je-Ce)/(nt-Ce);return Ln(Tt,xe+(We-xe)*pt,Je,1),pt}function Fr(Tt,xe){const Ce=[];for(let We=0;We<Tt.length;We++){const nt=Tt[We],Je=nt.type;let pt;if(Je==="Point"||Je==="MultiPoint"||Je==="LineString")pt=or(nt.geometry,xe);else if(Je==="MultiLineString"||Je==="Polygon"){pt=[];for(const Rt of nt.geometry)pt.push(or(Rt,xe))}else if(Je==="MultiPolygon"){pt=[];for(const Rt of nt.geometry){const gt=[];for(const Pt of Rt)gt.push(or(Pt,xe));pt.push(gt)}}Ce.push(kn(nt.id,Je,pt,nt.tags))}return Ce}function or(Tt,xe){const Ce=[];Ce.size=Tt.size,Tt.start!==void 0&&(Ce.start=Tt.start,Ce.end=Tt.end);for(let We=0;We<Tt.length;We+=3)Ce.push(Tt[We]+xe,Tt[We+1],Tt[We+2]);return Ce}function Nr(Tt,xe){if(Tt.transformed)return Tt;const Ce=1<<Tt.z,We=Tt.x,nt=Tt.y;for(const Je of Tt.features){const pt=Je.geometry,Rt=Je.type;if(Je.geometry=[],Rt===1)for(let gt=0;gt<pt.length;gt+=2)Je.geometry.push(Hr(pt[gt],pt[gt+1],xe,Ce,We,nt));else for(let gt=0;gt<pt.length;gt++){const Pt=[];for(let zt=0;zt<pt[gt].length;zt+=2)Pt.push(Hr(pt[gt][zt],pt[gt][zt+1],xe,Ce,We,nt));Je.geometry.push(Pt)}}return Tt.transformed=!0,Tt}function Hr(Tt,xe,Ce,We,nt,Je){return[Math.round(Ce*(Tt*We-nt)),Math.round(Ce*(xe*We-Je))]}function _i(Tt,xe,Ce,We,nt){const Je=xe===nt.maxZoom?0:nt.tolerance/((1<<xe)*nt.extent),pt={features:[],numPoints:0,numSimplified:0,numFeatures:Tt.length,source:null,x:Ce,y:We,z:xe,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Rt of Tt)Fe(pt,Rt,Je,nt);return pt}function Fe(Tt,xe,Ce,We){const nt=xe.geometry,Je=xe.type,pt=[];if(Tt.minX=Math.min(Tt.minX,xe.minX),Tt.minY=Math.min(Tt.minY,xe.minY),Tt.maxX=Math.max(Tt.maxX,xe.maxX),Tt.maxY=Math.max(Tt.maxY,xe.maxY),Je==="Point"||Je==="MultiPoint")for(let Rt=0;Rt<nt.length;Rt+=3)pt.push(nt[Rt],nt[Rt+1]),Tt.numPoints++,Tt.numSimplified++;else if(Je==="LineString")Lt(pt,nt,Tt,Ce,!1,!1);else if(Je==="MultiLineString"||Je==="Polygon")for(let Rt=0;Rt<nt.length;Rt++)Lt(pt,nt[Rt],Tt,Ce,Je==="Polygon",Rt===0);else if(Je==="MultiPolygon")for(let Rt=0;Rt<nt.length;Rt++){const gt=nt[Rt];for(let Pt=0;Pt<gt.length;Pt++)Lt(pt,gt[Pt],Tt,Ce,!0,Pt===0)}if(pt.length){let Rt=xe.tags||null;if(Je==="LineString"&&We.lineMetrics){Rt={};for(const Pt in xe.tags)Rt[Pt]=xe.tags[Pt];Rt.mapbox_clip_start=nt.start/nt.size,Rt.mapbox_clip_end=nt.end/nt.size}const gt={geometry:pt,type:Je==="Polygon"||Je==="MultiPolygon"?3:Je==="LineString"||Je==="MultiLineString"?2:1,tags:Rt};xe.id!==null&&(gt.id=xe.id),Tt.features.push(gt)}}function Lt(Tt,xe,Ce,We,nt,Je){const pt=We*We;if(We>0&&xe.size<(nt?pt:We))return void(Ce.numPoints+=xe.length/3);const Rt=[];for(let gt=0;gt<xe.length;gt+=3)(We===0||xe[gt+2]>pt)&&(Ce.numSimplified++,Rt.push(xe[gt],xe[gt+1])),Ce.numPoints++;nt&&function(gt,Pt){let zt=0;for(let Bt=0,ln=gt.length,Mn=ln-2;Bt<ln;Mn=Bt,Bt+=2)zt+=(gt[Bt]-gt[Mn])*(gt[Bt+1]+gt[Mn+1]);if(zt>0===Pt)for(let Bt=0,ln=gt.length;Bt<ln/2;Bt+=2){const Mn=gt[Bt],Cn=gt[Bt+1];gt[Bt]=gt[ln-2-Bt],gt[Bt+1]=gt[ln-1-Bt],gt[ln-2-Bt]=Mn,gt[ln-1-Bt]=Cn}}(Rt,Je),Tt.push(Rt)}const Kt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class un{constructor(xe,Ce){const We=(Ce=this.options=function(Je,pt){for(const Rt in pt)Je[Rt]=pt[Rt];return Je}(Object.create(Kt),Ce)).debug;if(We&&console.time("preprocess data"),Ce.maxZoom<0||Ce.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Ce.promoteId&&Ce.generateId)throw new Error("promoteId and generateId cannot be used together.");let nt=function(Je,pt){const Rt=[];if(Je.type==="FeatureCollection")for(let gt=0;gt<Je.features.length;gt++)sn(Rt,Je.features[gt],pt,gt);else sn(Rt,Je.type==="Feature"?Je:{geometry:Je},pt);return Rt}(xe,Ce);this.tiles={},this.tileCoords=[],We&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Ce.indexMaxZoom,Ce.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),nt=function(Je,pt){const Rt=pt.buffer/pt.extent;let gt=Je;const Pt=jt(Je,1,-1-Rt,Rt,0,-1,2,pt),zt=jt(Je,1,1-Rt,2+Rt,0,-1,2,pt);return(Pt||zt)&&(gt=jt(Je,1,-Rt,1+Rt,0,-1,2,pt)||[],Pt&&(gt=Fr(Pt,1).concat(gt)),zt&&(gt=gt.concat(Fr(zt,-1)))),gt}(nt,Ce),nt.length&&this.splitTile(nt,0,0,0),We&&(nt.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(xe,Ce,We,nt,Je,pt,Rt){const gt=[xe,Ce,We,nt],Pt=this.options,zt=Pt.debug;for(;gt.length;){nt=gt.pop(),We=gt.pop(),Ce=gt.pop(),xe=gt.pop();const Bt=1<<Ce,ln=En(Ce,We,nt);let Mn=this.tiles[ln];if(!Mn&&(zt>1&&console.time("creation"),Mn=this.tiles[ln]=_i(xe,Ce,We,nt,Pt),this.tileCoords.push({z:Ce,x:We,y:nt}),zt)){zt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Ce,We,nt,Mn.numFeatures,Mn.numPoints,Mn.numSimplified),console.timeEnd("creation"));const lr=`z${Ce}`;this.stats[lr]=(this.stats[lr]||0)+1,this.total++}if(Mn.source=xe,Je==null){if(Ce===Pt.indexMaxZoom||Mn.numPoints<=Pt.indexMaxPoints)continue}else{if(Ce===Pt.maxZoom||Ce===Je)continue;if(Je!=null){const lr=Je-Ce;if(We!==pt>>lr||nt!==Rt>>lr)continue}}if(Mn.source=null,xe.length===0)continue;zt>1&&console.time("clipping");const Cn=.5*Pt.buffer/Pt.extent,Ve=.5-Cn,yt=.5+Cn,Mt=1+Cn;let Ct=null,It=null,wn=null,_n=null,zn=jt(xe,Bt,We-Cn,We+yt,0,Mn.minX,Mn.maxX,Pt),Xn=jt(xe,Bt,We+Ve,We+Mt,0,Mn.minX,Mn.maxX,Pt);xe=null,zn&&(Ct=jt(zn,Bt,nt-Cn,nt+yt,1,Mn.minY,Mn.maxY,Pt),It=jt(zn,Bt,nt+Ve,nt+Mt,1,Mn.minY,Mn.maxY,Pt),zn=null),Xn&&(wn=jt(Xn,Bt,nt-Cn,nt+yt,1,Mn.minY,Mn.maxY,Pt),_n=jt(Xn,Bt,nt+Ve,nt+Mt,1,Mn.minY,Mn.maxY,Pt),Xn=null),zt>1&&console.timeEnd("clipping"),gt.push(Ct||[],Ce+1,2*We,2*nt),gt.push(It||[],Ce+1,2*We,2*nt+1),gt.push(wn||[],Ce+1,2*We+1,2*nt),gt.push(_n||[],Ce+1,2*We+1,2*nt+1)}}getTile(xe,Ce,We){xe=+xe,Ce=+Ce,We=+We;const nt=this.options,{extent:Je,debug:pt}=nt;if(xe<0||xe>24)return null;const Rt=1<<xe,gt=En(xe,Ce=Ce+Rt&Rt-1,We);if(this.tiles[gt])return Nr(this.tiles[gt],Je);pt>1&&console.log("drilling down to z%d-%d-%d",xe,Ce,We);let Pt,zt=xe,Bt=Ce,ln=We;for(;!Pt&&zt>0;)zt--,Bt>>=1,ln>>=1,Pt=this.tiles[En(zt,Bt,ln)];return Pt&&Pt.source?(pt>1&&(console.log("found parent tile z%d-%d-%d",zt,Bt,ln),console.time("drilling down")),this.splitTile(Pt.source,zt,Bt,ln,xe,Ce,We),pt>1&&console.timeEnd("drilling down"),this.tiles[gt]?Nr(this.tiles[gt],Je):null):null}}function En(Tt,xe,Ce){return 32*((1<<Tt)*Ce+xe)+Tt}function Ar(Tt,xe){const Ce=Tt.tileID.canonical;if(!this._geoJSONIndex)return void xe(null,null);const We=this._geoJSONIndex.getTile(Ce.z,Ce.x,Ce.y);if(!We)return void xe(null,null);const nt=new Z(We.features);let Je=wt(nt);Je.byteOffset===0&&Je.byteLength===Je.buffer.byteLength||(Je=new Uint8Array(Je)),xe(null,{vectorTile:nt,rawData:Je.buffer})}class Gr extends M{constructor(xe,Ce,We,nt,Je,pt){super(xe,Ce,We,nt,Ar,pt),Je&&(this.loadGeoJSON=Je),this._dynamicIndex=new se}loadData(xe,Ce){const We=xe&&xe.request,nt=We&&We.collectResourceTiming;this.loadGeoJSON(xe,(Je,pt)=>{if(Je||!pt)return Ce(Je);if(typeof pt!="object")return Ce(new Error(`Input data given to '${xe.source}' is not a valid GeoJSON object.`));{try{if(xe.filter){const gt=o.M(xe.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(gt.result==="error")throw new Error(gt.value.map(Pt=>`${Pt.key}: ${Pt.message}`).join(", "));pt.features=pt.features.filter(Pt=>gt.value.evaluate({zoom:0},Pt))}xe.dynamic?(pt.type==="Feature"&&(pt={type:"FeatureCollection",features:[pt]}),xe.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(pt.features,this.loaded),xe.cluster&&(pt.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=xe.cluster?new Bn(function({superclusterOptions:gt,clusterProperties:Pt}){if(!Pt||!gt)return gt;const zt={},Bt={},ln={accumulated:null,zoom:0},Mn={properties:null},Cn=Object.keys(Pt);for(const Ve of Cn){const[yt,Mt]=Pt[Ve],Ct=o.M(Mt),It=o.M(typeof yt=="string"?[yt,["accumulated"],["get",Ve]]:yt);zt[Ve]=Ct.value,Bt[Ve]=It.value}return gt.map=Ve=>{Mn.properties=Ve;const yt={};for(const Mt of Cn)yt[Mt]=zt[Mt].evaluate(ln,Mn);return yt},gt.reduce=(Ve,yt)=>{Mn.properties=yt;for(const Mt of Cn)ln.accumulated=Ve[Mt],Ve[Mt]=Bt[Mt].evaluate(ln,Mn)},gt}(xe)).load(pt.features):xe.dynamic?this._dynamicIndex:function(gt,Pt){return new un(gt,Pt)}(pt,xe.geojsonVtOptions)}catch(gt){return Ce(gt)}const Rt={};if(nt){const gt=h(We);gt&&(Rt.resourceTiming={},Rt.resourceTiming[xe.source]=JSON.parse(JSON.stringify(gt)))}Ce(null,Rt)}})}reloadTile(xe,Ce){const We=this.loaded;return We&&We[xe.uid]?xe.partial?Ce(null,void 0):super.reloadTile(xe,Ce):this.loadTile(xe,Ce)}loadGeoJSON(xe,Ce){if(xe.request)o.n(xe.request,Ce);else{if(typeof xe.data!="string")return Ce(new Error(`Input data given to '${xe.source}' is not a valid GeoJSON object.`));try{return Ce(null,JSON.parse(xe.data))}catch{return Ce(new Error(`Input data given to '${xe.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(xe,Ce){try{Ce(null,this._geoJSONIndex.getClusterExpansionZoom(xe.clusterId))}catch(We){Ce(We)}}getClusterChildren(xe,Ce){try{Ce(null,this._geoJSONIndex.getChildren(xe.clusterId))}catch(We){Ce(We)}}getClusterLeaves(xe,Ce){try{Ce(null,this._geoJSONIndex.getLeaves(xe.clusterId,xe.limit,xe.offset))}catch(We){Ce(We)}}}class cs{constructor(xe,Ce){this.tileID=new o.aA(xe.tileID.overscaledZ,xe.tileID.wrap,xe.tileID.canonical.z,xe.tileID.canonical.x,xe.tileID.canonical.y),this.tileZoom=xe.tileZoom,this.uid=xe.uid,this.zoom=xe.zoom,this.canonical=xe.tileID.canonical,this.pixelRatio=xe.pixelRatio,this.tileSize=xe.tileSize,this.source=xe.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=xe.projection,this.brightness=Ce}parse(xe,Ce,We,nt){this.status="parsing";const Je=new o.aA(We.tileID.overscaledZ,We.tileID.wrap,We.tileID.canonical.z,We.tileID.canonical.x,We.tileID.canonical.y),pt={},Rt=Ce.familiesBySource[We.source],gt=new o.dR(Je,We.promoteId);return gt.bucketLayerIDs=[],gt.is3DTile=!0,o.e0(xe).then(Pt=>{if(!Pt)return nt(new Error("Could not parse tile"));const zt=o.e1(Pt,1/o.c8(We.tileID.canonical)),Bt=Pt.json.extensionsUsed&&Pt.json.extensionsUsed.includes("MAPBOX_mesh_features")||Pt.json.asset.extras&&Pt.json.asset.extras.MAPBOX_mesh_features,ln=Pt.json.extensionsUsed&&Pt.json.extensionsUsed.includes("EXT_meshopt_compression"),Mn=new o.a3(this.zoom,{brightness:this.brightness});for(const Cn in Rt)for(const Ve of Rt[Cn]){const yt=Ve[0];gt.bucketLayerIDs.push(Ve.map(Ct=>Ct.id)),yt.recalculate(Mn,[]);const Mt=new o.e2(zt,Je,Bt,ln,this.brightness,gt);Bt||(Mt.needsUpload=!0),pt[yt.fqid]=Mt,Mt.evaluate(yt)}this.status="done",nt(null,{buckets:pt,featureIndex:gt})}).catch(Pt=>nt(new Error(Pt.message)))}}class Rs{constructor(xe,Ce,We,nt,Je,pt){this.actor=xe,this.layerIndex=Ce,this.brightness=pt,this.loading={},this.loaded={}}loadTile(xe,Ce){const We=xe.uid,nt=this.loading[We]=new cs(xe,this.brightness);o.bc(xe.request,(Je,pt)=>{const Rt=!this.loading[We];return delete this.loading[We],Rt||Je?(nt.status="done",Rt||(this.loaded[We]=nt),Ce(Je)):pt&&pt.byteLength!==0?void nt.parse(pt,this.layerIndex,xe,(gt,Pt)=>{nt.status="done",this.loaded=this.loaded||{},this.loaded[We]=nt,gt||!Pt?Ce(gt):Ce(null,Pt)}):(nt.status="done",this.loaded[We]=nt,Ce())})}reloadTile(xe,Ce){const We=this.loaded,nt=xe.uid;if(We&&We[nt]){const Je=We[nt];Je.projection=xe.projection,Je.brightness=xe.brightness;const pt=(Rt,gt)=>{Je.reloadCallback&&(delete Je.reloadCallback,this.loadTile(xe,Ce)),Ce(Rt,gt)};Je.status==="parsing"?Je.reloadCallback=pt:Je.status==="done"&&this.loadTile(xe,Ce)}}abortTile(xe,Ce){const We=xe.uid;this.loading[We]&&delete this.loading[We],Ce()}removeTile(xe,Ce){const We=this.loaded,nt=xe.uid;We&&We[nt]&&delete We[nt],Ce()}}class ui{constructor(xe){this.self=xe,this.actor=new o.e3(xe,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=o.bL({name:"mercator"}),this.workerSourceTypes={vector:M,geojson:Gr,"batched-model":Rs},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(Ce,We)=>{if(this.workerSourceTypes[Ce])throw new Error(`Worker source with name "${Ce}" already registered.`);this.workerSourceTypes[Ce]=We},this.self.registerRTLTextPlugin=Ce=>{if(o.e4.isParsed())throw new Error("RTL text plugin already registered.");o.e4.applyArabicShaping=Ce.applyArabicShaping,o.e4.processBidirectionalText=Ce.processBidirectionalText,o.e4.processStyledBidirectionalText=Ce.processStyledBidirectionalText}}clearCaches(xe,Ce,We){delete this.layerIndexes[xe],delete this.availableImages[xe],delete this.workerSources[xe],delete this.demWorkerSources[xe],delete this.rasterArrayWorkerSource,We()}checkIfReady(xe,Ce,We){We()}setReferrer(xe,Ce){this.referrer=Ce}spriteLoaded(xe,{scope:Ce,isLoaded:We}){if(this.isSpriteLoaded[xe]||(this.isSpriteLoaded[xe]={}),this.isSpriteLoaded[xe][Ce]=We,this.workerSources[xe]&&this.workerSources[xe][Ce])for(const nt in this.workerSources[xe][Ce]){const Je=this.workerSources[xe][Ce][nt];for(const pt in Je){const Rt=Je[pt];Rt instanceof M&&(Rt.isSpriteLoaded=We,Rt.fire(new o.x("isSpriteLoaded")))}}}setImages(xe,{scope:Ce,images:We},nt){if(this.availableImages[xe]||(this.availableImages[xe]={}),this.availableImages[xe][Ce]=We,this.workerSources[xe]&&this.workerSources[xe][Ce]){for(const Je in this.workerSources[xe][Ce]){const pt=this.workerSources[xe][Ce][Je];for(const Rt in pt)pt[Rt].availableImages=We}nt()}else nt()}setProjection(xe,Ce){this.projections[xe]=o.bL(Ce)}setBrightness(xe,Ce,We){this.brightness=Ce,We()}setLayers(xe,Ce,We){this.getLayerIndex(xe,Ce.scope).replace(Ce.layers,Ce.options),We()}updateLayers(xe,Ce,We){this.getLayerIndex(xe,Ce.scope).update(Ce.layers,Ce.removedIds,Ce.options),We()}loadTile(xe,Ce,We){Ce.projection=this.projections[xe]||this.defaultProjection,this.getWorkerSource(xe,Ce.type,Ce.source,Ce.scope).loadTile(Ce,We)}loadDEMTile(xe,Ce,We){this.getDEMWorkerSource(xe,Ce.source,Ce.scope).loadTile(Ce,We)}decodeRasterArray(xe,Ce,We){this.getRasterArrayWorkerSource().decodeRasterArray(Ce,We)}reloadTile(xe,Ce,We){Ce.projection=this.projections[xe]||this.defaultProjection,this.getWorkerSource(xe,Ce.type,Ce.source,Ce.scope).reloadTile(Ce,We)}abortTile(xe,Ce,We){this.getWorkerSource(xe,Ce.type,Ce.source,Ce.scope).abortTile(Ce,We)}removeTile(xe,Ce,We){this.getWorkerSource(xe,Ce.type,Ce.source,Ce.scope).removeTile(Ce,We)}removeSource(xe,Ce,We){if(!(this.workerSources[xe]&&this.workerSources[xe][Ce.scope]&&this.workerSources[xe][Ce.scope][Ce.type]&&this.workerSources[xe][Ce.scope][Ce.type][Ce.source]))return;const nt=this.workerSources[xe][Ce.scope][Ce.type][Ce.source];delete this.workerSources[xe][Ce.scope][Ce.type][Ce.source],nt.removeSource!==void 0?nt.removeSource(Ce,We):We()}loadWorkerSource(xe,Ce,We){try{this.self.importScripts(Ce.url),We()}catch(nt){We(nt.toString())}}syncRTLPluginState(xe,Ce,We){try{o.e4.setState(Ce);const nt=o.e4.getPluginURL();if(o.e4.isLoaded()&&!o.e4.isParsed()&&nt!=null){this.self.importScripts(nt);const Je=o.e4.isParsed();We(Je?void 0:new Error(`RTL Text Plugin failed to import scripts from ${nt}`),Je)}}catch(nt){We(nt.toString())}}setDracoUrl(xe,Ce){this.dracoUrl=Ce}getAvailableImages(xe,Ce){this.availableImages[xe]||(this.availableImages[xe]={});let We=this.availableImages[xe][Ce];return We||(We=[]),We}getLayerIndex(xe,Ce){this.layerIndexes[xe]||(this.layerIndexes[xe]={});let We=this.layerIndexes[xe][Ce];return We||(We=this.layerIndexes[xe][Ce]=new _,We.scope=Ce),We}getWorkerSource(xe,Ce,We,nt){return this.workerSources[xe]||(this.workerSources[xe]={}),this.workerSources[xe][nt]||(this.workerSources[xe][nt]={}),this.workerSources[xe][nt][Ce]||(this.workerSources[xe][nt][Ce]={}),this.isSpriteLoaded[xe]||(this.isSpriteLoaded[xe]={}),this.workerSources[xe][nt][Ce][We]||(this.workerSources[xe][nt][Ce][We]=new this.workerSourceTypes[Ce]({send:(Je,pt,Rt,gt,Pt,zt)=>{this.actor.send(Je,pt,Rt,xe,Pt,zt)},scheduler:this.actor.scheduler},this.getLayerIndex(xe,nt),this.getAvailableImages(xe,nt),this.isSpriteLoaded[xe][nt],void 0,this.brightness)),this.workerSources[xe][nt][Ce][We]}getDEMWorkerSource(xe,Ce,We){return this.demWorkerSources[xe]||(this.demWorkerSources[xe]={}),this.demWorkerSources[xe][We]||(this.demWorkerSources[xe][We]={}),this.demWorkerSources[xe][We][Ce]||(this.demWorkerSources[xe][We][Ce]=new B),this.demWorkerSources[xe][We][Ce]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new k),this.rasterArrayWorkerSource}enforceCacheSizeLimit(xe,Ce){o.e5(Ce)}getWorkerPerformanceMetrics(xe,Ce,We){We(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new ui(self)),ui}),a(["./shared"],function(o){var h="3.7.0";const d={create:"create",load:"load",fullLoad:"fullLoad"},m={mark(b){performance.mark(b)},measure(b,u,p){performance.measure(b,u,p)}};function _(b){const u=b.name.split("?")[0];return o.a(u)&&u.includes("mapbox-gl.js")?"javascript":o.a(u)&&u.includes("mapbox-gl.css")?"css":o.b(u)?"fontRange":o.c(u)?"sprite":o.i(u)?"style":o.d(u)?"tilejson":"other"}var y,T={},I=function(){if(y)return T;function b(w){return!u(w)}function u(w){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var P,F,W=new Blob([""],{type:"text/javascript"}),$=URL.createObjectURL(W);try{F=new Worker($),P=!0}catch{P=!1}return F&&F.terminate(),URL.revokeObjectURL($),P}()?function(){var P=document.createElement("canvas");P.width=P.height=1;var F=P.getContext("2d");if(!F)return!1;var W=F.getImageData(0,0,1,1);return W&&W.width===P.width}()?(p[E=w&&w.failIfMajorPerformanceCaveat]===void 0&&(p[E]=function(P){var F,W=function($){var J=document.createElement("canvas"),Q=Object.create(b.webGLContextAttributes);return Q.failIfMajorPerformanceCaveat=$,J.getContext("webgl2",Q)}(P);if(!W)return!1;try{F=W.createShader(W.VERTEX_SHADER)}catch{return!1}return!(!F||W.isContextLost())&&(W.shaderSource(F,"void main() {}"),W.compileShader(F),W.getShaderParameter(F,W.COMPILE_STATUS)===!0)}(E)),p[E]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var E}y=1,T.supported=b,T.notSupportedReason=u;var p={};return b.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},T}();function C(b,u,p){const w=document.createElement(b);return u!=null&&(w.className=u),p&&p.appendChild(w),w}function M(b,u,p){const w=document.createElementNS("http://www.w3.org/2000/svg",b);for(const E of Object.keys(u))w.setAttributeNS(null,E,String(u[E]));return p&&p.appendChild(w),w}const B=typeof document<"u"?document.documentElement&&document.documentElement.style:null,k=B&&B.userSelect!==void 0?"userSelect":"WebkitUserSelect";let j;function q(){B&&k&&(j=B[k],B[k]="none")}function Z(){B&&k&&(B[k]=j)}function te(b){b.preventDefault(),b.stopPropagation(),window.removeEventListener("click",te,!0)}function ie(){window.addEventListener("click",te,!0),window.setTimeout(()=>{window.removeEventListener("click",te,!0)},0)}function se(b,u){const p=b.getBoundingClientRect();return Se(b,p,u)}function ae(b,u){const p=b.getBoundingClientRect(),w=[];for(let E=0;E<u.length;E++)w.push(Se(b,p,u[E]));return w}function fe(b){return window.InstallTrigger!==void 0&&b.button===2&&b.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:b.button}function Se(b,u,p){const w=b.offsetWidth===u.width?1:b.offsetWidth/u.width;return new o.P((p.clientX-u.left)*w,(p.clientY-u.top)*w)}const Ee="01",Re="NO_ACCESS_TOKEN";class qe{constructor(u,p,w){this._transformRequestFn=u,this._customAccessToken=p,this._silenceAuthErrors=!!w,this._createSkuToken()}_createSkuToken(){const u=function(){let p="";for(let w=0;w<10;w++)p+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ee,p].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=u.token,this._skuTokenExpiresAt=u.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(u,p){return this._transformRequestFn&&this._transformRequestFn(u,p)||{url:u}}normalizeStyleURL(u,p){if(!o.f(u))return u;const w=dt(u);return w.params.push(`sdk=js-${h}`),w.path=`/styles/v1${w.path}`,this._makeAPIURL(w,this._customAccessToken||p)}normalizeGlyphsURL(u,p){if(!o.f(u))return u;const w=dt(u);return w.path=`/fonts/v1${w.path}`,this._makeAPIURL(w,this._customAccessToken||p)}normalizeModelURL(u,p){if(!o.f(u))return u;const w=dt(u);return w.path=`/models/v1${w.path}`,this._makeAPIURL(w,this._customAccessToken||p)}normalizeSourceURL(u,p,w,E){if(!o.f(u))return u;const P=dt(u);return P.path=`/v4/${P.authority}.json`,P.params.push("secure"),w&&P.params.push(`language=${w}`),E&&P.params.push(`worldview=${E}`),this._makeAPIURL(P,this._customAccessToken||p)}normalizeSpriteURL(u,p,w,E){const P=dt(u);return o.f(u)?(P.path=`/styles/v1${P.path}/sprite${p}${w}`,this._makeAPIURL(P,this._customAccessToken||E)):(P.path+=`${p}${w}`,ye(P))}normalizeTileURL(u,p,w){if(this._isSkuTokenExpired()&&this._createSkuToken(),u&&!o.f(u))return u;const E=dt(u);E.path=E.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${p||w&&E.authority!=="raster"&&w===512?"@2x":""}${o.m.supported?".webp":"$1"}`),E.authority==="raster"?E.path=`/${o.e.RASTER_URL_PREFIX}${E.path}`:E.authority==="rasterarrays"?E.path=`/${o.e.RASTERARRAYS_URL_PREFIX}${E.path}`:E.authority==="3dtiles"?E.path=`/${o.e.TILES3D_URL_PREFIX}${E.path}`:(E.path=E.path.replace(/^.+\/v4\//,"/"),E.path=`/${o.e.TILE_URL_VERSION}${E.path}`);const P=this._customAccessToken||function(F){for(const W of F){const $=W.match(/^access_token=(.*)$/);if($)return $[1]}return null}(E.params)||o.e.ACCESS_TOKEN;return o.e.REQUIRE_ACCESS_TOKEN&&P&&this._skuToken&&E.params.push(`sku=${this._skuToken}`),this._makeAPIURL(E,P)}canonicalizeTileURL(u,p){const w=dt(u);if(!w.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!w.path.match(/\.[\w]+$/))return u;let E="mapbox://";w.path.match(/^\/raster\/v1\//)?E+=`raster/${w.path.replace(`/${o.e.RASTER_URL_PREFIX}/`,"")}`:w.path.match(/^\/rasterarrays\/v1\//)?E+=`rasterarrays/${w.path.replace(`/${o.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:E+=`tiles/${w.path.replace(`/${o.e.TILE_URL_VERSION}/`,"")}`;let P=w.params;return p&&(P=P.filter(F=>!F.match(/^access_token=/))),P.length&&(E+=`?${P.join("&")}`),E}canonicalizeTileset(u,p){const w=!!p&&o.f(p),E=[];for(const P of u.tiles||[])o.h(P)?E.push(this.canonicalizeTileURL(P,w)):E.push(P);return E}_makeAPIURL(u,p){const w="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",E=dt(o.e.API_URL);if(u.protocol=E.protocol,u.authority=E.authority,u.protocol==="http"){const P=u.params.indexOf("secure");P>=0&&u.params.splice(P,1)}if(E.path!=="/"&&(u.path=`${E.path}${u.path}`),!o.e.REQUIRE_ACCESS_TOKEN)return ye(u);if(p=p||o.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!p)throw new Error(`An API access token is required to use Mapbox GL. ${w}`);if(p[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${w}`)}return u.params=u.params.filter(P=>P.indexOf("access_token")===-1),u.params.push(`access_token=${p||""}`),ye(u)}}const Le=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function dt(b){const u=b.match(Le);if(!u)throw new Error("Unable to parse URL object");return{protocol:u[1],authority:u[2],path:u[3]||"/",params:u[4]?u[4].split("&"):[]}}function ye(b){const u=b.params.length?`?${b.params.join("&")}`:"";return`${b.protocol}://${b.authority}${b.path}${u}`}const Xe="mapbox.eventData";function He(b){if(!b)return null;const u=b.split(".");if(!u||u.length!==3)return null;try{return JSON.parse(o.j(u[1]))}catch{return null}}class _t{constructor(u){this.type=u,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(u){const p=He(o.e.ACCESS_TOKEN);let w="";return w=p&&p.u?o.k(p.u):o.e.ACCESS_TOKEN||"",u?`${Xe}.${u}:${w}`:`${Xe}:${w}`}fetchEventData(){const u=o.s("localStorage"),p=this.getStorageKey(),w=this.getStorageKey("uuid");if(u)try{const E=localStorage.getItem(p);E&&(this.eventData=JSON.parse(E));const P=localStorage.getItem(w);P&&(this.anonId=P)}catch{o.w("Unable to read from LocalStorage")}}saveEventData(){const u=o.s("localStorage"),p=this.getStorageKey(),w=this.getStorageKey("uuid"),E=this.anonId;if(u&&E)try{localStorage.setItem(w,E),Object.keys(this.eventData).length>=1&&localStorage.setItem(p,JSON.stringify(this.eventData))}catch{o.w("Unable to write to LocalStorage")}}processRequests(u){}postEvent(u,p,w,E){if(!o.e.EVENTS_URL)return;const P=dt(o.e.EVENTS_URL);P.params.push(`access_token=${E||o.e.ACCESS_TOKEN||""}`);const F={event:this.type,created:new Date(u).toISOString()},W=p?o.l(F,p):F,$={url:ye(P),headers:{"Content-Type":"text/plain"},body:JSON.stringify([W])};this.pendingRequest=o.p($,J=>{this.pendingRequest=null,w(J),this.saveEventData(),this.processRequests(E)})}queueRequest(u,p){this.queue.push(u),this.processRequests(p)}}const wt=new class extends _t{constructor(b){super("appUserTurnstile"),this._customAccessToken=b}postTurnstileEvent(b,u){o.e.EVENTS_URL&&o.e.ACCESS_TOKEN&&Array.isArray(b)&&b.some(p=>o.f(p)||o.h(p))&&this.queueRequest(Date.now(),u)}processRequests(b){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const u=He(o.e.ACCESS_TOKEN),p=u?u.u:o.e.ACCESS_TOKEN;let w=p!==this.eventData.tokenU;o.v(this.anonId)||(this.anonId=o.u(),w=!0);const E=this.queue.shift();if(this.eventData.lastSuccess){const P=new Date(this.eventData.lastSuccess),F=new Date(E),W=(E-this.eventData.lastSuccess)/864e5;w=w||W>=1||W<-1||P.getDate()!==F.getDate()}else w=!0;w?this.postEvent(E,{sdkIdentifier:"mapbox-gl-js",sdkVersion:h,skuId:Ee,"enabled.telemetry":!1,userId:this.anonId},P=>{P||(this.eventData.lastSuccess=E,this.eventData.tokenU=p)},b):this.processRequests()}},Gt=wt.postTurnstileEvent.bind(wt),at=new class extends _t{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(b,u,p,w){this.skuToken=u,this.errorCb=w,o.e.EVENTS_URL&&(p||o.e.ACCESS_TOKEN?this.queueRequest({id:b,timestamp:Date.now()},p):this.errorCb(new Error(Re)))}processRequests(b){if(this.pendingRequest||this.queue.length===0)return;const{id:u,timestamp:p}=this.queue.shift();u&&this.success[u]||(this.anonId||this.fetchEventData(),o.v(this.anonId)||(this.anonId=o.u()),this.postEvent(p,{sdkIdentifier:"mapbox-gl-js",sdkVersion:h,skuId:Ee,skuToken:this.skuToken,userId:this.anonId},w=>{w?this.errorCb(w):u&&(this.success[u]=!0)},b))}remove(){this.errorCb=null}},Ht=at.postMapLoadEvent.bind(at),Qt=new class extends _t{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(b){let u=this.mapInstanceIdMap.get(b);return u||(u=o.u(),this.mapInstanceIdMap.set(b,u)),u}getEventId(b){const u=this.eventIdPerMapInstanceMap.get(b)||0;return this.eventIdPerMapInstanceMap.set(b,u+1),u}postStyleLoadEvent(b,u){const{map:p,style:w,importedStyles:E}=u;if(!o.e.EVENTS_URL||!b&&!o.e.ACCESS_TOKEN)return;const P=this.getMapInstanceId(p),F={mapInstanceId:P,eventId:this.getEventId(P),style:w};E.length&&(F.importedStyles=E),this.queueRequest({timestamp:Date.now(),payload:F},b)}processRequests(b){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:u,payload:p}=this.queue.shift();this.postEvent(u,p,()=>{},b)}},rn=Qt.postStyleLoadEvent.bind(Qt),jn=new class extends _t{constructor(){super("gljs.performance")}postPerformanceEvent(b,u){o.e.EVENTS_URL&&(b||o.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:u},b)}processRequests(b){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:u,performanceData:p}=this.queue.shift(),w=function(E){const P=performance.getEntriesByType("resource"),F=performance.getEntriesByType("mark"),W=function(ue){const ve={};if(ue){for(const _e in ue)if(_e!=="other")for(const be of ue[_e]){const we=`${_e}ResolveRangeMin`,ke=`${_e}ResolveRangeMax`,Ne=`${_e}RequestCount`,De=`${_e}RequestCachedCount`;ve[we]=Math.min(ve[we]||1/0,be.startTime),ve[ke]=Math.max(ve[ke]||-1/0,be.responseEnd);const je=Ge=>{ve[Ge]===void 0&&(ve[Ge]=0),++ve[Ge]};be.transferSize!==void 0&&be.transferSize===0&&je(De),je(Ne)}}return ve}(function(ue,ve){const _e={};if(ue)for(const be of ue){const we=ve(be);_e[we]===void 0&&(_e[we]=[]),_e[we].push(be)}return _e}(P,_)),$=window.devicePixelRatio,J=navigator.connection||navigator.mozConnection||navigator.webkitConnection,Q=J?J.effectiveType:void 0,oe={counters:[],metadata:[],attributes:[]},le=(ue,ve,_e)=>{_e!=null&&ue.push({name:ve,value:_e.toString()})};for(const ue in W)le(oe.counters,ue,W[ue]);if(E.interactionRange[0]!==1/0&&E.interactionRange[1]!==-1/0&&(le(oe.counters,"interactionRangeMin",E.interactionRange[0]),le(oe.counters,"interactionRangeMax",E.interactionRange[1])),F)for(const ue of Object.keys(d)){const ve=d[ue],_e=F.find(be=>be.name===ve);_e&&le(oe.counters,ve,_e.startTime)}return le(oe.counters,"visibilityHidden",E.visibilityHidden),le(oe.attributes,"style",function(ue){if(ue)for(const ve of ue){const _e=ve.name.split("?")[0];if(o.i(_e)){const be=_e.split("/").slice(-2);if(be.length===2)return`mapbox://styles/${be[0]}/${be[1]}`}}}(P)),le(oe.attributes,"terrainEnabled",E.terrainEnabled?"true":"false"),le(oe.attributes,"fogEnabled",E.fogEnabled?"true":"false"),le(oe.attributes,"projection",E.projection),le(oe.attributes,"zoom",E.zoom),le(oe.metadata,"devicePixelRatio",$),le(oe.metadata,"connectionEffectiveType",Q),le(oe.metadata,"navigatorUserAgent",navigator.userAgent),le(oe.metadata,"screenWidth",window.screen.width),le(oe.metadata,"screenHeight",window.screen.height),le(oe.metadata,"windowWidth",window.innerWidth),le(oe.metadata,"windowHeight",window.innerHeight),le(oe.metadata,"mapWidth",E.width/$),le(oe.metadata,"mapHeight",E.height/$),le(oe.metadata,"webglRenderer",E.renderer),le(oe.metadata,"webglVendor",E.vendor),le(oe.metadata,"sdkVersion",h),le(oe.metadata,"sdkIdentifier","mapbox-gl-js"),oe}(p);for(const E of w.metadata);for(const E of w.counters);for(const E of w.attributes);this.postEvent(u,w,()=>{},b)}},Bn=jn.postPerformanceEvent.bind(jn),Tn=new class extends _t{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(b,u,p,w){if(!o.e.API_URL||!o.e.SESSION_PATH)return;const E=dt(o.e.API_URL+o.e.SESSION_PATH);E.params.push(`sku=${u||""}`),E.params.push(`access_token=${w||o.e.ACCESS_TOKEN||""}`);const P={url:ye(E),headers:{"Content-Type":"text/plain"}};this.pendingRequest=o.g(P,F=>{this.pendingRequest=null,p(F),this.saveEventData(),this.processRequests(w)})}getSessionAPI(b,u,p,w){this.skuToken=u,this.errorCb=w,o.e.SESSION_PATH&&o.e.API_URL&&(p||o.e.ACCESS_TOKEN?this.queueRequest({id:b,timestamp:Date.now()},p):this.errorCb(new Error(Re)))}processRequests(b){if(this.pendingRequest||this.queue.length===0)return;const{id:u,timestamp:p}=this.queue.shift();u&&this.success[u]||this.getSession(p,this.skuToken,w=>{w?this.errorCb(w):u&&(this.success[u]=!0)},b)}remove(){this.errorCb=null}},Pe=Tn.getSessionAPI.bind(Tn),$e=new Set;function mn(b,u){u?$e.add(b):$e.delete(b)}class cn{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(u,p){this._updatedSourceCaches[u]=p,this.setDirty()}discardSourceCacheUpdate(u){delete this._updatedSourceCaches[u]}updateLayer(u){const p=u.scope;this._updatedLayers[p]=this._updatedLayers[p]||new Set,this._updatedLayers[p].add(u.id),this.setDirty()}removeLayer(u){const p=u.scope;this._removedLayers[p]=this._removedLayers[p]||{},this._updatedLayers[p]=this._updatedLayers[p]||new Set,this._removedLayers[p][u.id]=u,this._updatedLayers[p].delete(u.id),this._updatedPaintProps.delete(u.fqid),this.setDirty()}getRemovedLayer(u){return this._removedLayers[u.scope]?this._removedLayers[u.scope][u.id]:null}discardLayerRemoval(u){this._removedLayers[u.scope]&&delete this._removedLayers[u.scope][u.id]}getLayerUpdatesByScope(){const u={};for(const p in this._updatedLayers)u[p]=u[p]||{},u[p].updatedIds=Array.from(this._updatedLayers[p].values());for(const p in this._removedLayers)u[p]=u[p]||{},u[p].removedIds=Object.keys(this._removedLayers[p]);return u}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(u){this._updatedPaintProps.add(u.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(u){this._updatedImages.add(u),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}function St(b){const{userImage:u}=b;return!!(u&&u.render&&u.render())&&(b.data.replace(new Uint8Array(u.data.buffer)),!0)}class Jt extends o.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(u){this.images[u]={},this.loaded[u]=!1,this.updatedImages[u]={},this.patterns[u]={},this.callbackDispatchedThisFrame[u]={},this.atlasImage[u]=new o.r({width:1,height:1})}isLoaded(){for(const u in this.loaded)if(!this.loaded[u])return!1;return!0}setLoaded(u,p){if(this.loaded[p]!==u&&(this.loaded[p]=u,u)){for(const{ids:w,callback:E}of this.requestors)this._notify(w,p,E);this.requestors=[]}}hasImage(u,p){return!!this.getImage(u,p)}getImage(u,p){return this.images[p][u]}addImage(u,p,w){this._validate(u,w)&&(this.images[p][u]=w)}_validate(u,p){let w=!0;return this._validateStretch(p.stretchX,p.data&&p.data.width)||(this.fire(new o.t(new Error(`Image "${u}" has invalid "stretchX" value`))),w=!1),this._validateStretch(p.stretchY,p.data&&p.data.height)||(this.fire(new o.t(new Error(`Image "${u}" has invalid "stretchY" value`))),w=!1),this._validateContent(p.content,p)||(this.fire(new o.t(new Error(`Image "${u}" has invalid "content" value`))),w=!1),w}_validateStretch(u,p){if(!u)return!0;let w=0;for(const E of u){if(E[0]<w||E[1]<E[0]||p<E[1])return!1;w=E[1]}return!0}_validateContent(u,p){return!(u&&(u.length!==4||u[0]<0||p.data.width<u[0]||u[1]<0||p.data.height<u[1]||u[2]<0||p.data.width<u[2]||u[3]<0||p.data.height<u[3]||u[2]<u[0]||u[3]<u[1]))}updateImage(u,p,w){w.version=this.images[p][u].version+1,this.images[p][u]=w,this.updatedImages[p][u]=!0}removeImage(u,p){const w=this.images[p][u];delete this.images[p][u],delete this.patterns[p][u],w.userImage&&w.userImage.onRemove&&w.userImage.onRemove()}listImages(u){return Object.keys(this.images[u])}getImages(u,p,w){let E=!0;const P=!!this.loaded[p];if(!P)for(const F of u)this.images[p][F]||(E=!1);P||E?this._notify(u,p,w):this.requestors.push({ids:u,scope:p,callback:w})}getUpdatedImages(u){return this.updatedImages[u]}_notify(u,p,w){const E={};for(const P of u){this.images[p][P]||this.fire(new o.x("styleimagemissing",{id:P}));const F=this.images[p][P];F?E[P]={data:F.data.clone(),pixelRatio:F.pixelRatio,sdf:F.sdf,version:F.version,stretchX:F.stretchX,stretchY:F.stretchY,content:F.content,hasRenderCallback:!!(F.userImage&&F.userImage.render)}:o.w(`Image "${P}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}w(null,E)}getPixelSize(u){const{width:p,height:w}=this.atlasImage[u];return{width:p,height:w}}getPattern(u,p,w){const E=this.patterns[p][u],P=this.getImage(u,p);if(!P)return null;if(E&&E.position.version===P.version)return E.position;if(E)E.position.version=P.version;else{const F={w:P.data.width+2*o.y,h:P.data.height+2*o.y,x:0,y:0},W=new o.I(F,P,o.y);this.patterns[p][u]={bin:F,position:W}}return this._updatePatternAtlas(p,w),this.patterns[p][u].position}bind(u,p){const w=u.gl;let E=this.atlasTexture[p];E?this.dirty&&(E.update(this.atlasImage[p]),this.dirty=!1):(E=new o.T(u,this.atlasImage[p],w.RGBA8),this.atlasTexture[p]=E),E.bind(w.LINEAR,w.CLAMP_TO_EDGE)}_updatePatternAtlas(u,p){const w=[];for(const W in this.patterns[u])w.push(this.patterns[u][W].bin);const{w:E,h:P}=o.z(w),F=this.atlasImage[u];F.resize({width:E||1,height:P||1});for(const W in this.patterns[u]){const{bin:$,position:J}=this.patterns[u][W];let Q=J.padding;const oe=$.x+Q,le=$.y+Q,ue=this.images[u][W].data,ve=ue.width,_e=ue.height;Q=Q>1?Q-1:Q,o.r.copy(ue,F,{x:0,y:0},{x:oe,y:le},{width:ve,height:_e},p),o.r.copy(ue,F,{x:0,y:_e-Q},{x:oe,y:le-Q},{width:ve,height:Q},p),o.r.copy(ue,F,{x:0,y:0},{x:oe,y:le+_e},{width:ve,height:Q},p),o.r.copy(ue,F,{x:ve-Q,y:0},{x:oe-Q,y:le},{width:Q,height:_e},p),o.r.copy(ue,F,{x:0,y:0},{x:oe+ve,y:le},{width:Q,height:_e},p),o.r.copy(ue,F,{x:ve-Q,y:_e-Q},{x:oe-Q,y:le-Q},{width:Q,height:Q},p),o.r.copy(ue,F,{x:0,y:_e-Q},{x:oe+ve,y:le-Q},{width:Q,height:Q},p),o.r.copy(ue,F,{x:0,y:0},{x:oe+ve,y:le+_e},{width:Q,height:Q},p),o.r.copy(ue,F,{x:ve-Q,y:0},{x:oe-Q,y:le+_e},{width:Q,height:Q},p)}this.dirty=!0}beginFrame(){for(const u in this.images)this.callbackDispatchedThisFrame[u]={}}dispatchRenderCallbacks(u,p){for(const w of u){if(this.callbackDispatchedThisFrame[p][w])continue;this.callbackDispatchedThisFrame[p][w]=!0;const E=this.images[p][w];St(E)&&this.updateImage(w,p,E)}}}function kn(b){const u=b.key,p=b.value,w=b.valueSpec||{},E=b.objectElementValidators||{},P=b.style,F=b.styleSpec;let W=[];const $=o.B(p);if($!=="object")return[new o.V(u,p,`object expected, ${$} found`)];for(const J in p){const Q=J.split(".")[0];let oe;E[Q]?oe=E[Q]:w[Q]?oe=Lt:E["*"]?oe=E["*"]:w["*"]&&(oe=Lt),oe?W=W.concat(oe({key:(u&&`${u}.`)+J,value:p[J],valueSpec:w[Q]||w["*"],style:P,styleSpec:F,object:p,objectKey:J},p)):W.push(new o.A(u,p[J],`unknown property "${J}"`))}for(const J in w)E[J]||w[J].required&&w[J].default===void 0&&p[J]===void 0&&W.push(new o.V(u,p,`missing required property "${J}"`));return W}function Vn(b){const u=b.value,p=b.valueSpec,w=b.style,E=b.styleSpec,P=b.key,F=b.arrayElementValidator||Lt;if(o.B(u)!=="array")return[new o.V(P,u,`array expected, ${o.B(u)} found`)];if(p.length&&u.length!==p.length)return[new o.V(P,u,`array length ${p.length} expected, length ${u.length} found`)];if(p["min-length"]&&u.length<p["min-length"])return[new o.V(P,u,`array length at least ${p["min-length"]} expected, length ${u.length} found`)];let W={type:p.value,values:p.values,minimum:p.minimum,maximum:p.maximum,function:void 0};E.$version<7&&(W.function=p.function),o.B(p.value)==="object"&&(W=p.value);let $=[];for(let J=0;J<u.length;J++)$=$.concat(F({array:u,arrayIndex:J,value:u[J],valueSpec:W,style:w,styleSpec:E,key:`${P}[${J}]`},!0));return $}function sn(b){const u=b.key,p=b.value,w=b.valueSpec;let E=o.B(p);if(E==="number"&&p!=p&&(E="NaN"),E!=="number")return[new o.V(u,p,`number expected, ${E} found`)];if("minimum"in w){let P=w.minimum;if(o.B(w.minimum)==="array"&&(P=w.minimum[b.arrayIndex]),p<P)return[new o.V(u,p,`${p} is less than the minimum value ${P}`)]}if("maximum"in w){let P=w.maximum;if(o.B(w.maximum)==="array"&&(P=w.maximum[b.arrayIndex]),p>P)return[new o.V(u,p,`${p} is greater than the maximum value ${P}`)]}return[]}function ot(b){const u=b.valueSpec,p=o.D(b.value.type);let w,E,P,F={};const W=p!=="categorical"&&b.value.property===void 0,$=!W,J=o.B(b.value.stops)==="array"&&o.B(b.value.stops[0])==="array"&&o.B(b.value.stops[0][0])==="object",Q=kn({key:b.key,value:b.value,valueSpec:b.styleSpec.function,style:b.style,styleSpec:b.styleSpec,objectElementValidators:{stops:function(ue){if(p==="identity")return[new o.V(ue.key,ue.value,'identity function may not have a "stops" property')];let ve=[];const _e=ue.value;return ve=ve.concat(Vn({key:ue.key,value:_e,valueSpec:ue.valueSpec,style:ue.style,styleSpec:ue.styleSpec,arrayElementValidator:oe})),o.B(_e)==="array"&&_e.length===0&&ve.push(new o.V(ue.key,_e,"array must have at least one stop")),ve},default:function(ue){return Lt({key:ue.key,value:ue.value,valueSpec:u,style:ue.style,styleSpec:ue.styleSpec})}}});return p==="identity"&&W&&Q.push(new o.V(b.key,b.value,'missing required property "property"')),p==="identity"||b.value.stops||Q.push(new o.V(b.key,b.value,'missing required property "stops"')),p==="exponential"&&b.valueSpec.expression&&!o.F(b.valueSpec)&&Q.push(new o.V(b.key,b.value,"exponential functions not supported")),b.styleSpec.$version>=8&&($&&!o.G(b.valueSpec)?Q.push(new o.V(b.key,b.value,"property functions not supported")):W&&!o.H(b.valueSpec)&&Q.push(new o.V(b.key,b.value,"zoom functions not supported"))),p!=="categorical"&&!J||b.value.property!==void 0||Q.push(new o.V(b.key,b.value,'"property" property is required')),Q;function oe(ue){let ve=[];const _e=ue.value,be=ue.key;if(o.B(_e)!=="array")return[new o.V(be,_e,`array expected, ${o.B(_e)} found`)];if(_e.length!==2)return[new o.V(be,_e,`array length 2 expected, length ${_e.length} found`)];if(J){if(o.B(_e[0])!=="object")return[new o.V(be,_e,`object expected, ${o.B(_e[0])} found`)];if(_e[0].zoom===void 0)return[new o.V(be,_e,"object stop key must have zoom")];if(_e[0].value===void 0)return[new o.V(be,_e,"object stop key must have value")];const we=o.D(_e[0].zoom);if(typeof we!="number")return[new o.V(be,_e[0].zoom,"stop zoom values must be numbers")];if(P&&P>we)return[new o.V(be,_e[0].zoom,"stop zoom values must appear in ascending order")];we!==P&&(P=we,E=void 0,F={}),ve=ve.concat(kn({key:`${be}[0]`,value:_e[0],valueSpec:{zoom:{}},style:ue.style,styleSpec:ue.styleSpec,objectElementValidators:{zoom:sn,value:le}}))}else ve=ve.concat(le({key:`${be}[0]`,value:_e[0],valueSpec:{},style:ue.style,styleSpec:ue.styleSpec},_e));return o.J(o.K(_e[1]))?ve.concat([new o.V(`${be}[1]`,_e[1],"expressions are not allowed in function stops.")]):ve.concat(Lt({key:`${be}[1]`,value:_e[1],valueSpec:u,style:ue.style,styleSpec:ue.styleSpec}))}function le(ue,ve){const _e=o.B(ue.value),be=o.D(ue.value),we=ue.value!==null?ue.value:ve;if(w){if(_e!==w)return[new o.V(ue.key,we,`${_e} stop domain type must match previous stop domain type ${w}`)]}else w=_e;if(_e!=="number"&&_e!=="string"&&_e!=="boolean"&&typeof be!="number"&&typeof be!="string"&&typeof be!="boolean")return[new o.V(ue.key,we,"stop domain value must be a number, string, or boolean")];if(_e!=="number"&&p!=="categorical"){let ke=`number expected, ${_e} found`;return o.G(u)&&p===void 0&&(ke+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new o.V(ue.key,we,ke)]}return p!=="categorical"||_e!=="number"||typeof be=="number"&&isFinite(be)&&Math.floor(be)===be?p!=="categorical"&&_e==="number"&&typeof be=="number"&&typeof E=="number"&&E!==void 0&&be<E?[new o.V(ue.key,we,"stop domain values must appear in ascending order")]:(E=be,p==="categorical"&&be in F?[new o.V(ue.key,we,"stop domain values must be unique")]:(F[be]=!0,[])):[new o.V(ue.key,we,`integer expected, found ${String(be)}`)]}}function Ue(b){const u=(b.expressionContext==="property"?o.L:o.M)(o.K(b.value),b.valueSpec);if(u.result==="error")return u.value.map(w=>new o.V(`${b.key}${w.key}`,b.value,w.message));const p=u.value.expression||u.value._styleExpression.expression;if(b.expressionContext==="property"&&b.propertyKey==="text-font"&&!p.outputDefined())return[new o.V(b.key,b.value,`Invalid data expression for "${b.propertyKey}". Output values must be contained as literals within the expression.`)];if(b.expressionContext==="property"&&b.propertyType==="layout"&&!o.N(p))return[new o.V(b.key,b.value,'"feature-state" data expressions are not supported with layout properties.')];if(b.expressionContext==="filter")return $t(p,b);if(b.expressionContext&&b.expressionContext.indexOf("cluster")===0){if(!o.O(p,["zoom","feature-state"]))return[new o.V(b.key,b.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(b.expressionContext==="cluster-initial"&&!o.Q(p))return[new o.V(b.key,b.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function $t(b,u){const p=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(u.valueSpec&&u.valueSpec.expression)for(const E of u.valueSpec.expression.parameters)p.delete(E);if(p.size===0)return[];const w=[];return b instanceof o.S&&p.has(b.name)?[new o.V(u.key,u.value,`["${b.name}"] expression is not supported in a filter for a ${u.object.type} layer with id: ${u.object.id}`)]:(b.eachChild(E=>{w.push(...$t(E,u))}),w)}function An(b){const u=b.key,p=b.value,w=b.valueSpec,E=[];return Array.isArray(w.values)?w.values.indexOf(o.D(p))===-1&&E.push(new o.V(u,p,`expected one of [${w.values.join(", ")}], ${JSON.stringify(p)} found`)):Object.keys(w.values).indexOf(o.D(p))===-1&&E.push(new o.V(u,p,`expected one of [${Object.keys(w.values).join(", ")}], ${JSON.stringify(p)} found`)),E}function Sn(b){return o.W(o.K(b.value))?Ue(o.C({},b,{expressionContext:"filter",valueSpec:b.styleSpec[`filter_${b.layerType||"fill"}`]})):jt(b)}function jt(b){const u=b.value,p=b.key;if(o.B(u)!=="array")return[new o.V(p,u,`array expected, ${o.B(u)} found`)];const w=b.styleSpec;let E,P=[];if(u.length<1)return[new o.V(p,u,"filter array must have at least 1 element")];switch(P=P.concat(An({key:`${p}[0]`,value:u[0],valueSpec:w.filter_operator,style:b.style,styleSpec:b.styleSpec})),o.D(u[0])){case"<":case"<=":case">":case">=":u.length>=2&&o.D(u[1])==="$type"&&P.push(new o.V(p,u,`"$type" cannot be use with operator "${u[0]}"`));case"==":case"!=":u.length!==3&&P.push(new o.V(p,u,`filter array for operator "${u[0]}" must have 3 elements`));case"in":case"!in":u.length>=2&&(E=o.B(u[1]),E!=="string"&&P.push(new o.V(`${p}[1]`,u[1],`string expected, ${E} found`)));for(let F=2;F<u.length;F++)E=o.B(u[F]),o.D(u[1])==="$type"?P=P.concat(An({key:`${p}[${F}]`,value:u[F],valueSpec:w.geometry_type,style:b.style,styleSpec:b.styleSpec})):E!=="string"&&E!=="number"&&E!=="boolean"&&P.push(new o.V(`${p}[${F}]`,u[F],`string, number, or boolean expected, ${E} found`));break;case"any":case"all":case"none":for(let F=1;F<u.length;F++)P=P.concat(jt({key:`${p}[${F}]`,value:u[F],style:b.style,styleSpec:b.styleSpec}));break;case"has":case"!has":E=o.B(u[1]),u.length!==2?P.push(new o.V(p,u,`filter array for "${u[0]}" operator must have 2 elements`)):E!=="string"&&P.push(new o.V(`${p}[1]`,u[1],`string expected, ${E} found`))}return P}function mr(b,u){const p=b.key,w=b.style,E=b.layer,P=b.styleSpec,F=b.value,W=b.objectKey,$=P[`${u}_${b.layerType}`];if(!$)return[];const J=W.match(/^(.*)-transition$/);if(u==="paint"&&J&&$[J[1]]&&$[J[1]].transition)return Lt({key:p,value:F,valueSpec:P.transition,style:w,styleSpec:P});const Q=b.valueSpec||$[W];if(!Q)return[new o.A(p,F,`unknown property "${W}"`)];let oe;if(o.B(F)==="string"&&o.G(Q)&&!Q.tokens&&(oe=/^{([^}]+)}$/.exec(F))){const ue=`\`{ "type": "identity", "property": ${oe?JSON.stringify(oe[1]):'"_"'} }\``;return[new o.V(p,F,`"${W}" does not support interpolation syntax
Use an identity property function instead: ${ue}.`)]}const le=[];if(b.layerType==="symbol")W!=="text-field"||!w||w.glyphs||w.imports||le.push(new o.V(p,F,'use of "text-field" requires a style "glyphs" property')),W==="text-font"&&o.X(o.K(F))&&o.D(F.type)==="identity"&&le.push(new o.V(p,F,'"text-font" does not support identity functions'));else if(b.layerType==="model"&&u==="paint"&&E&&E.layout&&E.layout.hasOwnProperty("model-id")&&o.G(Q)&&(o.Y(Q)||o.H(Q))){const ue=o.L(o.K(F),Q),ve=ue.value.expression||ue.value._styleExpression.expression;ve&&!o.O(ve,["measure-light"])&&(W==="model-emissive-strength"&&o.Q(ve)&&o.N(ve)||le.push(new o.V(p,F,`${W} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return le.concat(Lt({key:b.key,value:F,valueSpec:Q,style:w,styleSpec:P,expressionContext:"property",propertyType:u,propertyKey:W}))}function Un(b){return mr(b,"paint")}function tr(b){return mr(b,"layout")}function Sr(b){let u=[];const p=b.value,w=b.key,E=b.style,P=b.styleSpec;p.type||p.ref||u.push(new o.V(w,p,'either "type" or "ref" is required'));let F=o.D(p.type);const W=o.D(p.ref);if(p.id){const $=o.D(p.id);for(let J=0;J<b.arrayIndex;J++){const Q=E.layers[J];o.D(Q.id)===$&&u.push(new o.V(w,p.id,`duplicate layer id "${p.id}", previously used at line ${Q.id.__line__}`))}}if("ref"in p){let $;["type","source","source-layer","filter","layout"].forEach(J=>{J in p&&u.push(new o.V(w,p[J],`"${J}" is prohibited for ref layers`))}),E.layers.forEach(J=>{o.D(J.id)===W&&($=J)}),$?$.ref?u.push(new o.V(w,p.ref,"ref cannot reference another ref layer")):F=o.D($.type):typeof W=="string"&&u.push(new o.V(w,p.ref,`ref layer "${W}" not found`))}else if(F!=="background"&&F!=="sky"&&F!=="slot")if(p.source){const $=E.sources&&E.sources[p.source],J=$&&o.D($.type);$?J==="vector"&&F==="raster"?u.push(new o.V(w,p.source,`layer "${p.id}" requires a raster source`)):J==="raster"&&F!=="raster"?u.push(new o.V(w,p.source,`layer "${p.id}" requires a vector source`)):J!=="vector"||p["source-layer"]?J==="raster-dem"&&F!=="hillshade"?u.push(new o.V(w,p.source,"raster-dem source can only be used with layer type 'hillshade'.")):J!=="raster-array"||["raster","raster-particle"].includes(F)?F!=="line"||!p.paint||!p.paint["line-gradient"]&&!p.paint["line-trim-offset"]||J==="geojson"&&$.lineMetrics?F==="raster-particle"&&J!=="raster-array"&&u.push(new o.V(w,p.source,`layer "${p.id}" requires a 'raster-array' source.`)):u.push(new o.V(w,p,`layer "${p.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):u.push(new o.V(w,p.source,"raster-array source can only be used with layer type 'raster'.")):u.push(new o.V(w,p,`layer "${p.id}" must specify a "source-layer"`)):u.push(new o.V(w,p.source,`source "${p.source}" not found`))}else u.push(new o.V(w,p,'missing required property "source"'));return u=u.concat(kn({key:w,value:p,valueSpec:P.layer,style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Lt({key:`${w}.type`,value:p.type,valueSpec:P.layer.type,style:b.style,styleSpec:b.styleSpec,object:p,objectKey:"type"}),filter:$=>Sn(o.C({layerType:F},$)),layout:$=>kn({layer:p,key:$.key,value:$.value,valueSpec:{},style:$.style,styleSpec:$.styleSpec,objectElementValidators:{"*":J=>tr(o.C({layerType:F},J))}}),paint:$=>kn({layer:p,key:$.key,value:$.value,valueSpec:{},style:$.style,styleSpec:$.styleSpec,objectElementValidators:{"*":J=>Un(o.C({layerType:F,layer:p},J))}})}})),u}function Ln(b){const u=b.value,p=b.key,w=o.B(u);return w!=="string"?[new o.V(p,u,`string expected, ${w} found`)]:[]}const ir={promoteId:function({key:b,value:u}){if(o.B(u)==="string")return Ln({key:b,value:u});{const p=[];for(const w in u)p.push(...Ln({key:`${b}.${w}`,value:u[w]}));return p}}};function ci(b){const u=b.value,p=b.key,w=b.styleSpec,E=b.style;if(!u.type)return[new o.V(p,u,'"type" is required')];const P=o.D(u.type);let F=[];switch(["vector","raster","raster-dem","raster-array"].includes(P)&&(u.url||u.tiles||F.push(new o.A(p,u,'Either "url" or "tiles" is required.'))),P){case"vector":case"raster":case"raster-dem":case"raster-array":return F=F.concat(kn({key:p,value:u,valueSpec:w[`source_${P.replace("-","_")}`],style:b.style,styleSpec:w,objectElementValidators:ir})),F;case"geojson":if(F=kn({key:p,value:u,valueSpec:w.source_geojson,style:E,styleSpec:w,objectElementValidators:ir}),u.cluster)for(const W in u.clusterProperties){const[$,J]=u.clusterProperties[W],Q=typeof $=="string"?[$,["accumulated"],["get",W]]:$;F.push(...Ue({key:`${p}.${W}.map`,value:J,expressionContext:"cluster-map"})),F.push(...Ue({key:`${p}.${W}.reduce`,value:Q,expressionContext:"cluster-reduce"}))}return F;case"video":return kn({key:p,value:u,valueSpec:w.source_video,style:E,styleSpec:w});case"image":return kn({key:p,value:u,valueSpec:w.source_image,style:E,styleSpec:w});case"canvas":return[new o.V(p,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return An({key:`${p}.type`,value:u.type,valueSpec:{values:Fr(w)},style:E,styleSpec:w})}}function Fr(b){return b.source.reduce((u,p)=>{const w=b[p];return w.type.type==="enum"&&(u=u.concat(Object.keys(w.type.values))),u},[])}function or(b){const u=b.value,p=b.styleSpec,w=p.light,E=b.style;let P=[];const F=o.B(u);if(u===void 0)return P;if(F!=="object")return P=P.concat([new o.V("light",u,`object expected, ${F} found`)]),P;for(const W in u){const $=W.match(/^(.*)-transition$/);P=P.concat($&&w[$[1]]&&w[$[1]].transition?Lt({key:W,value:u[W],valueSpec:p.transition,style:E,styleSpec:p}):w[W]?Lt({key:W,value:u[W],valueSpec:w[W],style:E,styleSpec:p}):[new o.V(W,u[W],`unknown property "${W}"`)])}return P}function Nr(b){const u=b.value;let p=[];if(!u)return p;const w=o.B(u);if(w!=="object")return p=p.concat([new o.V("light-3d",u,`object expected, ${w} found`)]),p;const E=b.styleSpec,P=E["light-3d"],F=b.key,W=b.style,$=b.style.lights;for(const oe of["type","id"])if(!(oe in u))return p=p.concat([new o.V("light-3d",u,`missing property ${oe} on light`)]),p;if(u.type&&$)for(let oe=0;oe<b.arrayIndex;oe++){const le=o.D(u.type),ue=$[oe];o.D(ue.type)===le&&p.push(new o.V(F,u.id,`duplicate light type "${u.type}", previously defined at line ${ue.id.__line__}`))}const J=`properties_light_${u.type}`;if(!(J in E))return p=p.concat([new o.V("light-3d",u,`Invalid light type ${u.type}`)]),p;const Q=E[J];for(const oe in u)if(oe==="properties"){const le=u[oe],ue=o.B(le);if(ue!=="object")return p=p.concat([new o.V("properties",le,`object expected, ${ue} found`)]),p;for(const ve in le)p=p.concat(Q[ve]?Lt({key:ve,value:le[ve],valueSpec:Q[ve],style:W,styleSpec:E}):[new o.A(b.key,le[ve],`unknown property "${ve}"`)])}else{const le=oe.match(/^(.*)-transition$/);p=p.concat(le&&P[le[1]]&&P[le[1]].transition?Lt({key:oe,value:u[oe],valueSpec:E.transition,style:W,styleSpec:E}):P[oe]?Lt({key:oe,value:u[oe],valueSpec:P[oe],style:W,styleSpec:E}):[new o.A(oe,u[oe],`unknown property "${oe}"`)])}return p}function Hr(b){const u=b.value,p=b.key,w=b.style,E=b.styleSpec,P=E.terrain;let F=[];const W=o.B(u);if(u===void 0||W==="null")return F;if(W!=="object")return F=F.concat([new o.V("terrain",u,`object expected, ${W} found`)]),F;for(const $ in u){const J=$.match(/^(.*)-transition$/);F=F.concat(J&&P[J[1]]&&P[J[1]].transition?Lt({key:$,value:u[$],valueSpec:E.transition,style:w,styleSpec:E}):P[$]?Lt({key:$,value:u[$],valueSpec:P[$],style:w,styleSpec:E}):[new o.A($,u[$],`unknown property "${$}"`)])}if(u.source){const $=w.sources&&w.sources[u.source],J=$&&o.D($.type);$?J!=="raster-dem"&&F.push(new o.V(p,u.source,`terrain cannot be used with a source of type ${String(J)}, it only be used with a "raster-dem" source type`)):F.push(new o.V(p,u.source,`source "${u.source}" not found`))}else F.push(new o.V(p,u,'terrain is missing required property "source"'));return F}function _i(b){const u=b.value,p=b.style,w=b.styleSpec,E=w.fog;let P=[];const F=o.B(u);if(u===void 0)return P;if(F!=="object")return P=P.concat([new o.V("fog",u,`object expected, ${F} found`)]),P;for(const W in u){const $=W.match(/^(.*)-transition$/);P=P.concat($&&E[$[1]]&&E[$[1]].transition?Lt({key:W,value:u[W],valueSpec:w.transition,style:p,styleSpec:w}):E[W]?Lt({key:W,value:u[W],valueSpec:E[W],style:p,styleSpec:w}):[new o.A(W,u[W],`unknown property "${W}"`)])}return P}const Fe={"*":()=>[],array:Vn,boolean:function(b){const u=b.value,p=b.key,w=o.B(u);return w!=="boolean"?[new o.V(p,u,`boolean expected, ${w} found`)]:[]},number:sn,color:function(b){const u=b.key,p=b.value,w=o.B(p);return w!=="string"?[new o.V(u,p,`color expected, ${w} found`)]:o.U.parseCSSColor(p)===null?[new o.V(u,p,`color expected, "${p}" found`)]:[]},enum:An,filter:Sn,function:ot,layer:Sr,object:kn,source:ci,model:o.Z,light:or,"light-3d":Nr,terrain:Hr,fog:_i,string:Ln,formatted:function(b){return Ln(b).length===0?[]:Ue(b)},resolvedImage:function(b){return Ln(b).length===0?[]:Ue(b)},projection:function(b){const u=b.value,p=b.styleSpec,w=p.projection,E=b.style;let P=[];const F=o.B(u);if(F==="object")for(const W in u)P=P.concat(Lt({key:W,value:u[W],valueSpec:w[W],style:E,styleSpec:p}));else F!=="string"&&(P=P.concat([new o.V("projection",u,`object or string expected, ${F} found`)]));return P},import:function(b){const{value:u,styleSpec:p}=b,{data:w,...E}=u;Object.defineProperty(E,"__line__",{value:u.__line__,enumerable:!1});let P=kn(o.C({},b,{value:E,valueSpec:p.import}));return o.D(E.id)===""&&P.push(new o.V(`${b.key}.id`,E,"import id can't be an empty string")),w&&(P=P.concat(un(w,p,{key:`${b.key}.data`}))),P}};function Lt(b,u=!1){const p=b.value,w=b.valueSpec,E=b.styleSpec;if(w.expression&&o.X(o.D(p)))return ot(b);if(w.expression&&o.J(o.K(p)))return Ue(b);if(w.type&&Fe[w.type]){const P=Fe[w.type](b);return u===!0&&P.length>0&&o.B(b.value)==="array"?Ue(b):P}return kn(o.C({},b,{valueSpec:w.type?E[w.type]:w}))}function Kt(b){const u=b.value,p=b.key,w=Ln(b);return w.length||(u.indexOf("{fontstack}")===-1&&w.push(new o.V(p,u,'"glyphs" url must include a "{fontstack}" token')),u.indexOf("{range}")===-1&&w.push(new o.V(p,u,'"glyphs" url must include a "{range}" token'))),w}function un(b,u=o._,p={}){return Lt({key:p.key||"",value:b,valueSpec:u.$root,styleSpec:u,style:b,objectElementValidators:{glyphs:Kt,"*":()=>[]}})}function En(b,u=o._){return Je(un(b,u))}const Ar=b=>Je(ci(b)),Gr=b=>Je(or(b)),cs=b=>Je(Nr(b)),Rs=b=>Je(Hr(b)),ui=b=>Je(_i(b)),Tt=b=>Je(Sr(b)),xe=b=>Je(Sn(b)),Ce=b=>Je(Un(b)),We=b=>Je(tr(b)),nt=b=>Je(o.Z(b));function Je(b){return b.slice().sort((u,p)=>u.line&&p.line?u.line-p.line:0)}function pt(b,u){let p=!1;if(u&&u.length)for(const w of u)w instanceof o.A?o.w(w.message):(b.fire(new o.t(new Error(w.message))),p=!0);return p}let Rt;class gt extends o.E{constructor(u,p="flat"){super(),this._transitionable=new o.$(Rt||(Rt=new o.a0({anchor:new o.a1(o._.light.anchor),position:new o.a2(o._.light.position),color:new o.a1(o._.light.color),intensity:new o.a1(o._.light.intensity)}))),this.setLight(u,p),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(u,p,w={}){this._validate(Gr,u,w)||(this._transitionable.setTransitionOrValue(u),this.id=p)}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}_validate(u,p,w){return(!w||w.validate!==!1)&&pt(this,u.call(En,o.l({value:p,style:{glyphs:!0,sprite:!0},styleSpec:o._})))}}const Pt=new o.a0({source:new o.a1(o._.terrain.source),exaggeration:new o.a1(o._.terrain.exaggeration)});let zt=class extends o.E{constructor(b,u,p,w){super(),this.scope=p,this._transitionable=new o.$(Pt,p,w),this._transitionable.setTransitionOrValue(b,w),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=u}get(){return this._transitionable.serialize()}set(b,u){this._transitionable.setTransitionOrValue(b,u)}updateTransitions(b){this._transitioning=this._transitionable.transitioned(b,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(b){this.properties=this._transitioning.possiblyEvaluate(b)}getExaggeration(b){return this._transitioning.possiblyEvaluate(new o.a3(b)).get("exaggeration")}isZoomDependent(){const b=this._transitionable._values.exaggeration;return b!=null&&b.value!=null&&b.value.expression!=null&&b.value.expression instanceof o.a4}};const Bt=45,ln=65,Mn=.05;function Cn(b,u,p,w){const E=o.a7(Bt,ln,p),[P,F]=Ve(b,w);let W=1-Math.min(1,Math.exp((u-P)/(F-P)*-6));return W*=W*W,W=Math.min(1,1.00747*W),W*E*b.alpha}function Ve(b,u){const p=.5/Math.tan(.5*u);return[b.range[0]+p,b.range[1]+p]}function yt(b,u,p,w,E){const P=o.a6.vec3.transformMat4([],[u,p,w],E.mercatorFogMatrix);return Cn(b,o.a6.vec3.length(P),E.pitch,E._fov)}function Mt(b,u,p,w,E,P,F){const W=[[p,w,0],[E,w,0],[E,P,0],[p,P,0]];let $=Number.MAX_VALUE,J=-Number.MAX_VALUE;for(const Q of W){const oe=o.a6.vec3.transformMat4([],Q,u),le=o.a6.vec3.length(oe);$=Math.min($,le),J=Math.max(J,le)}return[Cn(b,$,F.pitch,F._fov),Cn(b,J,F.pitch,F._fov)]}const Ct=new o.a0({range:new o.a1(o._.fog.range),color:new o.a1(o._.fog.color),"high-color":new o.a1(o._.fog["high-color"]),"space-color":new o.a1(o._.fog["space-color"]),"horizon-blend":new o.a1(o._.fog["horizon-blend"]),"star-intensity":new o.a1(o._.fog["star-intensity"]),"vertical-range":new o.a1(o._.fog["vertical-range"])});class It extends o.E{constructor(u,p,w,E){super(),this._transitionable=new o.$(Ct,w,new Map(E)),this.set(u,E),this._transitioning=this._transitionable.untransitioned(),this._transform=p,this.properties=new o.a8(Ct),this.scope=w}get state(){const u=this._transform,p=u.projection.name==="globe",w=o.a9(u.zoom),E=this.properties.get("range"),P=[.5,3];return{range:p?[o.aa(P[0],E[0],w),o.aa(P[1],E[1],w)]:E,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(u,p,w={}){if(this._validate(ui,u,w))return;const E=o.l({},u);for(const P of Object.keys(o._.fog))E[P]===void 0&&(E[P]=o._.fog[P].default);this._options=E,this._transitionable.setTransitionOrValue(this._options,p)}getOpacity(u){if(!this._transform.projection.supportsFog)return 0;const p=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:o.a7(Bt,ln,u))*p.a}getOpacityAtLatLng(u,p){return this._transform.projection.supportsFog?function(w,E,P){const F=o.a5.fromLngLat(E),W=P.elevation?P.elevation.getAtPointOrZero(F):0;return yt(w,F.x,F.y,W,P)}(this.state,u,p):0}getOpacityForTile(u){if(!this._transform.projection.supportsFog)return[1,1];const p=this._transform.calculateFogTileMatrix(u.toUnwrapped());return Mt(this.state,p,0,0,o.ab,o.ab,this._transform)}getOpacityForBounds(u,p,w,E,P){return this._transform.projection.supportsFog?Mt(this.state,u,p,w,E,P,this._transform):[1,1]}getFovAdjustedRange(u){return this._transform.projection.supportsFog?Ve(this.state,u):[0,1]}isVisibleOnFrustum(u){if(!this._transform.projection.supportsFog)return!1;const p=[4,5,6,7];for(const w of p){const E=u.points[w];let P;if(E[2]>=0)P=E;else{const F=u.points[w-4];P=o.ac(F,E,F[2]/(F[2]-E[2]))}if(yt(this.state,P[0],P[1],0,this._transform)>=Mn)return!0}return!1}updateConfig(u){this._transitionable.setTransitionOrValue(this._options,new Map(u))}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}_validate(u,p,w){return(!w||w.validate!==!1)&&pt(this,u.call(En,o.l({value:p,style:{glyphs:!0,sprite:!0},styleSpec:o._})))}}class wn extends o.E{constructor(u,p,w,E){super(),this.scope=w,this._options=u,this.properties=new o.a8(p),this._transitionable=new o.$(p,w,new Map(E)),this._transitionable.setTransitionOrValue(u.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(u){this._transitionable.setTransitionOrValue(this._options.properties,new Map(u))}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(u,p){this._options=u,this._transitionable.setTransitionOrValue(u.properties,p)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}let _n,zn;class Xn{constructor(u,p,w,E){this.screenBounds=u,this.cameraPoint=p,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=w,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,E)}static createFromScreenPoints(u,p){let w,E;if(u instanceof o.P||typeof u[0]=="number"){const P=o.P.convert(u);w=[P],E=p.isPointAboveHorizon(P)}else{const P=o.P.convert(u[0]),F=o.P.convert(u[1]);w=[P,F],E=o.ae(P,F).every(W=>p.isPointAboveHorizon(W))}return new Xn(w,p.getCameraPoint(),E,p)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(u){return o.ae(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],u)}bufferedCameraGeometry(u){const p=this.screenBounds[0],w=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],E=o.ae(p,w,0,!1);return this.cameraPoint.y>w.y&&(this.cameraPoint.x>p.x&&this.cameraPoint.x<w.x?E.splice(3,0,this.cameraPoint):this.cameraPoint.x>=w.x?E[2]=this.cameraPoint:this.cameraPoint.x<=p.x&&(E[3]=this.cameraPoint)),o.af(E,u)}bufferedCameraGeometryGlobe(u){const p=this.screenBounds[0],w=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],E=o.ae(p,w,u),P=this.cameraPoint.clone();switch(3*((P.y>p.y)+(P.y>w.y))+((P.x>p.x)+(P.x>w.x))){case 0:E[0]=P,E[4]=P.clone();break;case 1:E.splice(1,0,P);break;case 2:E[1]=P;break;case 3:E.splice(4,0,P);break;case 5:E.splice(2,0,P);break;case 6:E[3]=P;break;case 7:E.splice(3,0,P);break;case 8:E[2]=P}return E}containsTile(u,p,w,E=0){const P=u.queryPadding/p._pixelsPerMercatorPixel+1,F=w?this._bufferedCameraMercator(P,p):this._bufferedScreenMercator(P,p);let W=u.tileID.wrap+(F.unwrapped?E:0);const $=F.polygon.map(be=>o.ag(u.tileTransform,be,W));if(!o.ah($,0,0,o.ab,o.ab))return;W=u.tileID.wrap+(this.screenGeometryMercator.unwrapped?E:0);const J=this.screenGeometryMercator.polygon.map(be=>o.ai(u.tileTransform,be,W)),Q=J.map(be=>new o.P(be[0],be[1])),oe=p.getFreeCameraOptions().position||new o.a5(0,0,0),le=o.ai(u.tileTransform,oe,W),ue=J.map(be=>{const we=o.a6.vec3.sub(be,be,le);return o.a6.vec3.normalize(we,we),new o.aj(le,we)}),ve=o.ak(u,1,p.zoom)*p._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:Q,tilespaceRays:ue,bufferedTilespaceGeometry:$,bufferedTilespaceBounds:(_e=o.al($),_e.min.x=o.ap(_e.min.x,0,o.ab),_e.min.y=o.ap(_e.min.y,0,o.ab),_e.max.x=o.ap(_e.max.x,0,o.ab),_e.max.y=o.ap(_e.max.y,0,o.ab),_e),tile:u,tileID:u.tileID,pixelToTileUnitsFactor:ve};var _e}_bufferedScreenMercator(u,p){const w=dr(u);if(this._screenRaycastCache[w])return this._screenRaycastCache[w];{let E;return E=p.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(u),p):{polygon:this.bufferedScreenGeometry(u).map(P=>p.pointCoordinate3D(P)),unwrapped:!0},this._screenRaycastCache[w]=E,E}}_bufferedCameraMercator(u,p){const w=dr(u);if(this._cameraRaycastCache[w])return this._cameraRaycastCache[w];{let E;return E=p.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(u),p):{polygon:this.bufferedCameraGeometry(u).map(P=>p.pointCoordinate3D(P)),unwrapped:!0},this._cameraRaycastCache[w]=E,E}}_projectAndResample(u,p){const w=function(P,F){const W=o.a6.mat4.multiply([],F.pixelMatrix,F.globeMatrix),$=[0,-o.aq,0,1],J=[0,o.aq,0,1],Q=[0,0,0,1];o.a6.vec4.transformMat4($,$,W),o.a6.vec4.transformMat4(J,J,W),o.a6.vec4.transformMat4(Q,Q,W);const oe=new o.P($[0]/$[3],$[1]/$[3]),le=new o.P(J[0]/J[3],J[1]/J[3]),ue=o.an(P,oe)&&$[3]<Q[3],ve=o.an(P,le)&&J[3]<Q[3];if(!ue&&!ve)return null;const _e=function(et,Ke,tt){for(let ct=1;ct<et.length;ct++){const st=gr(Ke.pointCoordinate3D(et[ct-1]).x),rt=gr(Ke.pointCoordinate3D(et[ct]).x);if(tt<0){if(st<rt)return{idx:ct,t:-st/(rt-1-st)}}else if(rt<st)return{idx:ct,t:(1-st)/(rt+1-st)}}return null}(P,F,ue?-1:1);if(!_e)return null;const{idx:be,t:we}=_e;let ke=be>1?lr(P.slice(0,be),F):[],Ne=be<P.length?lr(P.slice(be),F):[];ke=ke.map(et=>new o.P(gr(et.x),et.y)),Ne=Ne.map(et=>new o.P(gr(et.x),et.y));const De=[...ke];De.length===0&&De.push(Ne[Ne.length-1]);const je=o.aa(De[De.length-1].y,(Ne.length===0?ke[0]:Ne[0]).y,we);let Ge;return Ge=ue?[new o.P(0,je),new o.P(0,0),new o.P(1,0),new o.P(1,je)]:[new o.P(1,je),new o.P(1,1),new o.P(0,1),new o.P(0,je)],De.push(...Ge),Ne.length===0?De.push(ke[0]):De.push(...Ne),{polygon:De.map(et=>new o.a5(et.x,et.y)),unwrapped:!1}}(u,p);if(w)return w;const E=function(P,F){let W=!1,$=-1/0,J=0;for(let oe=0;oe<P.length-1;oe++)P[oe].x>$&&($=P[oe].x,J=oe);for(let oe=0;oe<P.length-1;oe++){const le=(J+oe)%(P.length-1),ue=P[le],ve=P[le+1];Math.abs(ue.x-ve.x)>.5&&(ue.x<ve.x?(ue.x+=1,le===0&&(P[P.length-1].x+=1)):(ve.x+=1,le+1===P.length-1&&(P[0].x+=1)),W=!0)}const Q=o.am(F.center.lng);return W&&Q<Math.abs(Q-1)&&P.forEach(oe=>{oe.x-=1}),{polygon:P,unwrapped:W}}(lr(u,p).map(P=>new o.P(gr(P.x),P.y)),p);return{polygon:E.polygon.map(P=>new o.a5(P.x,P.y)),unwrapped:E.unwrapped}}}function lr(b,u){return o.ao(b,p=>{const w=u.pointCoordinate3D(p);p.x=w.x,p.y=w.y},1/256)}function gr(b){return b<0?1+b%1:b%1}function dr(b){return 100*b|0}function hi(b,u,p,w,E){const P=function(W,$){if(W)return E(W);if($){if(b.url&&$.tiles&&b.tiles&&delete b.tiles,$.variants){if(!Array.isArray($.variants))return E(new Error("variants must be an array"));for(const Q of $.variants){if(Q==null||typeof Q!="object"||Q.constructor!==Object)return E(new Error("variant must be an object"));if(!Array.isArray(Q.capabilities))return E(new Error("capabilities must be an array"));if(Q.capabilities.length===1&&Q.capabilities[0]==="meshopt"){$=o.l($,Q);break}}}const J=o.ar(o.l($,b),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);$.vector_layers&&(J.vectorLayers=$.vector_layers,J.vectorLayerIds=J.vectorLayers.map(Q=>Q.id)),$.raster_layers&&(J.rasterLayers=$.raster_layers,J.rasterLayerIds=J.rasterLayers.map(Q=>Q.id)),J.tiles=u.canonicalizeTileset(J,b.url),E(null,J)}},F=function(W,$,J){if(!W)return null;if(!$&&!J)return W;J=J||W.worldview_default;const Q=Object.values(W.language||{});if(Q.length===0)return null;const oe=Object.values(W.worldview||{});if(oe.length===0)return null;const le=Q.every(ve=>ve===$),ue=oe.every(ve=>ve===J);return le&&ue?W:$ in(W.language_options||{})||J in(W.worldview_options||{})?null:W.language_options&&W.worldview_options?W:null}(b.data,p,w);return F?o.q.frame(()=>P(null,F)):b.url?o.n(u.transformRequest(u.normalizeSourceURL(b.url,null,p,w),o.R.Source),P):o.q.frame(()=>{const{data:W,...$}=b;P(null,$)})}class Bi{constructor(u,p,w){this.bounds=o.as.convert(this.validateBounds(u)),this.minzoom=p||0,this.maxzoom=w||24}validateBounds(u){return Array.isArray(u)&&u.length===4?[Math.max(-180,u[0]),Math.max(-90,u[1]),Math.min(180,u[2]),Math.min(90,u[3])]:[-180,-90,180,90]}contains(u){const p=Math.pow(2,u.z),w=Math.floor(o.am(this.bounds.getWest())*p),E=Math.floor(o.at(this.bounds.getNorth())*p),P=Math.ceil(o.am(this.bounds.getEast())*p),F=Math.ceil(o.at(this.bounds.getSouth())*p);return u.x>=w&&u.x<P&&u.y>=E&&u.y<F}}class Gi extends o.E{constructor(u,p,w,E){if(super(),this.id=u,this.dispatcher=w,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.l(this,o.ar(p,["url","scheme","tileSize","promoteId"])),this._options=o.l({type:"vector"},p),this._collectResourceTiming=!!p.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(E),this._tileWorkers={},this._deduped=new o.au}load(u){this._loaded=!1,this.fire(new o.x("dataloading",{dataType:"source"}));const p=Array.isArray(this.map._language)?this.map._language.join():this.map._language,w=this.map._worldview;this._tileJSONRequest=hi(this._options,this.map._requestManager,p,w,(E,P)=>{this._tileJSONRequest=null,this._loaded=!0,E?(p&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${p}`),w&&w.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${w}`),this.fire(new o.t(E))):P&&(o.l(this,P),P.bounds&&(this.tileBounds=new Bi(P.bounds,this.minzoom,this.maxzoom)),Gt(P.tiles,this.map._requestManager._customAccessToken),this.fire(new o.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.x("data",{dataType:"source",sourceDataType:"content"}))),u&&u(E)})}loaded(){return this._loaded}hasTile(u){return!this.tileBounds||this.tileBounds.contains(u.canonical)}onAdd(u){this.map=u,this.load()}reload(){this.cancelTileJSONRequest();const u=o.av(this.id,this.scope);this.load(()=>this.map.style.clearSource(u))}setTiles(u){return this._options.tiles=u,this.reload(),this}setUrl(u){return this.url=u,this._options.url=u,this.reload(),this}onRemove(u){this.cancelTileJSONRequest()}serialize(){return o.l({},this._options)}loadTile(u,p){const w=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme)),E=this.map._requestManager.transformRequest(w,o.R.Tile),P=this.map.style?this.map.style.getLut(this.scope):null,F={request:E,data:void 0,uid:u.uid,tileID:u.tileID,tileZoom:u.tileZoom,zoom:u.tileID.overscaledZ,lut:P?{image:P.image.clone()}:null,tileSize:this.tileSize*u.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:o.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:u.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:u.isExtraShadowCaster,tessellationStep:this.map._tessellationStep};if(F.request.collectResourceTiming=this._collectResourceTiming,u.actor&&u.state!=="expired")u.state==="loading"?u.reloadCallback=p:u.request=u.actor.send("reloadTile",F,W.bind(this));else if(u.actor=this._tileWorkers[w]=this._tileWorkers[w]||this.dispatcher.getActor(),this.dispatcher.ready)u.request=u.actor.send("loadTile",F,W.bind(this),void 0,!0);else{const $=o.aw.call({deduped:this._deduped},F,(J,Q)=>{J||!Q?W.call(this,J):(F.data={cacheControl:Q.cacheControl,expires:Q.expires,rawData:Q.rawData.slice(0)},u.actor&&u.actor.send("loadTile",F,W.bind(this),void 0,!0))},!0);u.request={cancel:$}}function W($,J){return delete u.request,u.aborted?p(null):$&&$.status!==404?p($):(J&&J.resourceTiming&&(u.resourceTiming=J.resourceTiming),this.map._refreshExpiredTiles&&J&&u.setExpiryData(J),u.loadVectorData(J,this.map.painter),o.ax(this.dispatcher),p(null),void(u.reloadCallback&&(this.loadTile(u,u.reloadCallback),u.reloadCallback=null)))}}abortTile(u){u.request&&(u.request.cancel(),delete u.request),u.actor&&u.actor.send("abortTile",{uid:u.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(u,p){u.actor&&u.actor.send("removeTile",{uid:u.uid,type:this.type,source:this.id,scope:this.scope}),u.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ws extends o.E{constructor(u,p,w,E){super(),this.id=u,this.dispatcher=w,this.setEventedParent(E),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.l({type:"raster"},p),o.l(this,o.ar(p,["url","scheme","tileSize"]))}load(u){this._loaded=!1,this.fire(new o.x("dataloading",{dataType:"source"})),this._tileJSONRequest=hi(this._options,this.map._requestManager,null,null,(p,w)=>{this._tileJSONRequest=null,this._loaded=!0,p?this.fire(new o.t(p)):w&&(o.l(this,w),w.bounds&&(this.tileBounds=new Bi(w.bounds,this.minzoom,this.maxzoom)),Gt(w.tiles),this.fire(new o.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.x("data",{dataType:"source",sourceDataType:"content"}))),u&&u(p)})}loaded(){return this._loaded}onAdd(u){this.map=u,this.load()}reload(){this.cancelTileJSONRequest();const u=o.av(this.id,this.scope);this.load(()=>this.map.style.clearSource(u))}setTiles(u){return this._options.tiles=u,this.reload(),this}setUrl(u){return this.url=u,this._options.url=u,this.reload(),this}onRemove(u){this.cancelTileJSONRequest()}serialize(){return o.l({},this._options)}hasTile(u){return!this.tileBounds||this.tileBounds.contains(u.canonical)}loadTile(u,p){const w=o.q.devicePixelRatio>=2,E=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme),w,this.tileSize);u.request=o.o(this.map._requestManager.transformRequest(E,o.R.Tile),(P,F,W,$)=>(delete u.request,u.aborted?(u.state="unloaded",p(null)):P?(u.state="errored",p(P)):F?(this.map._refreshExpiredTiles&&u.setExpiryData({cacheControl:W,expires:$}),u.setTexture(F,this.map.painter),u.state="loaded",o.ax(this.dispatcher),void p(null)):p(null)))}abortTile(u,p){u.request&&(u.request.cancel(),delete u.request),p&&p()}unloadTile(u,p){u.texture&&u.texture instanceof o.T?(u.destroy(!0),u.texture&&u.texture instanceof o.T&&this.map.painter.saveTileTexture(u.texture)):u.destroy(),p&&p()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Er extends ws{constructor(u,p,w,E){super(u,p,w,E),this.type="raster-array",this.maxzoom=22,this._options=o.l({type:"raster-array"},p)}triggerRepaint(u){const p=this.map.painter._terrain,w=this.map.style.getSourceCache(this.id);p&&p.enabled&&w&&p._clearRenderCacheForTile(w.id,u.tileID),this.map.triggerRepaint()}loadTile(u,p){const w=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),E=this.map._requestManager.transformRequest(w,o.R.Tile);u.requestParams=E,u.actor||(u.actor=this.dispatcher.getActor()),u.request=u.fetchHeader(void 0,(P,F,W,$)=>{if(delete u.request,u.aborted)return u.state="unloaded",p(null);if(P)return P.code===20?void 0:(u.state="errored",p(P));this.map._refreshExpiredTiles&&u.setExpiryData({cacheControl:W,expires:$}),u.state="empty",p(null)})}unloadTile(u,p){const w=u.texture;w&&w instanceof o.T?(u.destroy(!0),this.map.painter.saveTileTexture(w)):(u.destroy(),u.flushQueues(),u._isHeaderLoaded=!1,delete u._mrt,delete u.textureDescriptor),u.fbo&&(u.fbo.destroy(),delete u.fbo),delete u.request,delete u.requestParams,delete u.neighboringTiles,u.state="unloaded"}prepareTile(u,p,w){u._isHeaderLoaded&&(u.state!=="empty"&&(u.state="reloading"),u.fetchBand(p,w,(E,P)=>{if(E)return u.state="errored",this.fire(new o.t(E)),void this.triggerRepaint(u);P&&(u.setTexture(P,this.map.painter),u.state="loaded",this.triggerRepaint(u))}))}getInitialBand(u){if(!this.rasterLayers)return 0;const p=this.rasterLayers.find(({id:P})=>P===u),w=p&&p.fields,E=w&&w.bands&&w.bands;return E?E[0]:0}getTextureDescriptor(u,p,w){if(!u)return;const E=p.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!E)return;let P=null;p instanceof o.aB?P=p.paint.get("raster-array-band"):p instanceof o.aC&&(P=p.paint.get("raster-particle-array-band"));const F=P||this.getInitialBand(E);if(F!=null)if(u.textureDescriptor){if(!u.updateNeeded(E,F)||w)return Object.assign({},u.textureDescriptor,{texture:u.texture})}else this.prepareTile(u,E,F)}}const Qn={vector:Gi,raster:ws,"raster-dem":class extends ws{constructor(b,u,p,w){super(b,u,p,w),this.type="raster-dem",this.maxzoom=22,this._options=o.l({type:"raster-dem"},u),this.encoding=u.encoding||"mapbox"}loadTile(b,u){const p=this.map._requestManager.normalizeTileURL(b.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function w(E,P){E&&(b.state="errored",u(E)),P&&(b.dem=P,b.dem.onDeserialize(),b.needsHillshadePrepare=!0,b.needsDEMTextureUpload=!0,b.state="loaded",u(null))}b.request=o.o(this.map._requestManager.transformRequest(p,o.R.Tile),(function(E,P,F,W){if(delete b.request,b.aborted)b.state="unloaded",u(null);else if(E)b.state="errored",u(E);else if(P){this.map._refreshExpiredTiles&&b.setExpiryData({cacheControl:F,expires:W});const $=ImageBitmap&&P instanceof ImageBitmap&&o.ay(),J=1-(P.width-o.az(P.width))/2;J<1||b.neighboringTiles||(b.neighboringTiles=this._getNeighboringTiles(b.tileID));const Q=$?P:o.q.getImageData(P,J),oe={uid:b.uid,coord:b.tileID,source:this.id,scope:this.scope,rawImageData:Q,encoding:this.encoding,padding:J};b.actor&&b.state!=="expired"||(b.actor=this.dispatcher.getActor(),b.actor.send("loadDEMTile",oe,w.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(b){const u=b.canonical,p=Math.pow(2,u.z),w=(u.x-1+p)%p,E=u.x===0?b.wrap-1:b.wrap,P=(u.x+1+p)%p,F=u.x+1===p?b.wrap+1:b.wrap,W={};return W[new o.aA(b.overscaledZ,E,u.z,w,u.y).key]={backfilled:!1},W[new o.aA(b.overscaledZ,F,u.z,P,u.y).key]={backfilled:!1},u.y>0&&(W[new o.aA(b.overscaledZ,E,u.z,w,u.y-1).key]={backfilled:!1},W[new o.aA(b.overscaledZ,b.wrap,u.z,u.x,u.y-1).key]={backfilled:!1},W[new o.aA(b.overscaledZ,F,u.z,P,u.y-1).key]={backfilled:!1}),u.y+1<p&&(W[new o.aA(b.overscaledZ,E,u.z,w,u.y+1).key]={backfilled:!1},W[new o.aA(b.overscaledZ,b.wrap,u.z,u.x,u.y+1).key]={backfilled:!1},W[new o.aA(b.overscaledZ,F,u.z,P,u.y+1).key]={backfilled:!1}),W}},"raster-array":Er,geojson:class extends o.E{constructor(b,u,p,w){super(),this.id=b,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=p.getActor(),this.setEventedParent(w),this._data=u.data,this._options=o.l({},u),this._collectResourceTiming=u.collectResourceTiming,u.maxzoom!==void 0&&(this.maxzoom=u.maxzoom),u.minzoom!==void 0&&(this.minzoom=u.minzoom),u.type&&(this.type=u.type),u.attribution&&(this.attribution=u.attribution),this.promoteId=u.promoteId;const E=o.ab/this.tileSize;this.workerOptions=o.l({source:this.id,scope:this.scope,cluster:u.cluster||!1,geojsonVtOptions:{buffer:(u.buffer!==void 0?u.buffer:128)*E,tolerance:(u.tolerance!==void 0?u.tolerance:.375)*E,extent:o.ab,maxZoom:this.maxzoom,lineMetrics:u.lineMetrics||!1,generateId:u.generateId||!1},superclusterOptions:{maxZoom:u.clusterMaxZoom!==void 0?u.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,u.clusterMinPoints||2),extent:o.ab,radius:(u.clusterRadius!==void 0?u.clusterRadius:50)*E,log:!1,generateId:u.generateId||!1},clusterProperties:u.clusterProperties,filter:u.filter,dynamic:u.dynamic},u.workerOptions)}onAdd(b){this.map=b,this.setData(this._data)}setData(b){return this._data=b,this._updateWorkerData(),this}updateData(b){if(!this._options.dynamic)return this.fire(new o.t(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof b!="string"&&(b.type==="Feature"&&(b={type:"FeatureCollection",features:[b]}),b.type!=="FeatureCollection"))return this.fire(new o.t(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof b!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const u=new Map;for(const p of this._data.features)u.set(p.id,p);for(const p of b.features)u.set(p.id,p);this._data.features=[...u.values()]}else this._data=b;return this._updateWorkerData(!0),this}getClusterExpansionZoom(b,u){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:b,source:this.id,scope:this.scope},u),this}getClusterChildren(b,u){return this.actor.send("geojson.getClusterChildren",{clusterId:b,source:this.id,scope:this.scope},u),this}getClusterLeaves(b,u,p,w){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:b,limit:u,offset:p},w),this}_updateWorkerData(b=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.x("dataloading",{dataType:"source"})),this._loaded=!1;const u=o.l({append:b},this.workerOptions);u.scope=this.scope;const p=this._data;typeof p=="string"?(u.request=this.map._requestManager.transformRequest(o.q.resolveURL(p),o.R.Source),u.request.collectResourceTiming=this._collectResourceTiming):u.data=JSON.stringify(p),this._pendingLoad=this.actor.send(`${this.type}.loadData`,u,(w,E)=>{if(this._loaded=!0,this._pendingLoad=null,w)this.fire(new o.t(w));else{const P={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&E&&E.resourceTiming&&E.resourceTiming[this.id]&&(P.resourceTiming=E.resourceTiming[this.id]),b&&(this._partialReload=!0),this.fire(new o.x("data",P)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(b),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(b,u){const p=b.actor?"reloadTile":"loadTile";b.actor=this.actor;const w=this.map.style?this.map.style.getLut(this.scope):null,E=this._partialReload,P={type:this.type,uid:b.uid,tileID:b.tileID,tileZoom:b.tileZoom,zoom:b.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:w?{image:w.image.clone()}:null,scope:this.scope,pixelRatio:o.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,partial:E};b.request=this.actor.send(p,P,(F,W)=>E&&!W?(b.state="loaded",u(null)):(delete b.request,b.destroy(),b.aborted?u(null):F?u(F):(b.loadVectorData(W,this.map.painter,p==="reloadTile"),u(null))),void 0,p==="loadTile")}abortTile(b){b.request&&(b.request.cancel(),delete b.request),b.aborted=!0}unloadTile(b,u){this.actor.send("removeTile",{uid:b.uid,type:this.type,source:this.id,scope:this.scope}),b.destroy()}onRemove(b){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return o.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends o.aD{constructor(b,u,p,w){super(b,u,p,w),this.roundZoom=!0,this.type="video",this.options=u}load(){this._loaded=!1;const b=this.options;this.urls=[];for(const u of b.urls)this.urls.push(this.map._requestManager.transformRequest(u,o.R.Source).url);o.aE(this.urls,(u,p)=>{this._loaded=!0,u?this.fire(new o.t(u)):p&&(this.video=p,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(b){if(this.video){const u=this.video.seekable;b<u.start(0)||b>u.end(0)?this.fire(new o.t(new o.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${u.start(0)} and ${u.end(0)}-second mark.`))):this.video.currentTime=b}}getVideo(){return this.video}onAdd(b){this.map||(this.map=b,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const b=this.map.painter.context,u=b.gl;this.texture?this.video.paused||(this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE),u.texSubImage2D(u.TEXTURE_2D,0,0,0,u.RGBA,u.UNSIGNED_BYTE,this.video)):(this.texture=new o.T(b,this.video,u.RGBA8),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(b)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:o.aD,model:class extends o.E{constructor(b,u,p,w){super(),this.id=b,this.type="model",this.models=[],this._loaded=!1,this._options=u}load(){const b=[];for(const u in this._options.models){const p=this._options.models[u],w=o.aG(this.map._requestManager.transformRequest(p.uri,o.R.Model).url).then(E=>{if(!E)return;const P=o.aH(E),F=new o.aI(u,p.position,p.orientation,P);F.computeBoundsAndApplyParent(),this.models.push(F)}).catch(E=>{this.fire(new o.t(new Error(`Could not load model ${u} from ${p.uri}: ${E.message}`)))});b.push(w)}return Promise.allSettled(b).then(()=>{this._loaded=!0,this.fire(new o.x("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(u=>{this.fire(new o.t(new Error(`Could not load models: ${u.message}`)))})}onAdd(b){this.map=b,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(b,u){}serialize(){return{type:"model"}}},"batched-model":class extends o.E{constructor(b,u,p,w){super(),this.type="batched-model",this.id=b,this.tileSize=512,this._options=u,this.tiles=this._options.tiles,this.maxzoom=u.maxzoom||19,this.minzoom=u.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=p,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(w)}onAdd(b){this.map=b,this.load()}load(b){this._loaded=!1,this.fire(new o.x("dataloading",{dataType:"source"}));const u=Array.isArray(this.map._language)?this.map._language.join():this.map._language,p=this.map._worldview;this._tileJSONRequest=hi(this._options,this.map._requestManager,u,p,(w,E)=>{this._tileJSONRequest=null,this._loaded=!0,w?(u&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${u}`),p&&p.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${p}`),this.fire(new o.t(w))):E&&(o.l(this,E),E.bounds&&(this.tileBounds=new Bi(E.bounds,this.minzoom,this.maxzoom)),Gt(E.tiles,this.map._requestManager._customAccessToken),this.fire(new o.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.x("data",{dataType:"source",sourceDataType:"content"}))),b&&b(w)})}hasTransition(){return!1}hasTile(b){return!this.tileBounds||this.tileBounds.contains(b.canonical)}loaded(){return this._loaded}loadTile(b,u){const p=this.map._requestManager.normalizeTileURL(b.tileID.canonical.url(this.tiles,this.scheme)),w={request:this.map._requestManager.transformRequest(p,o.R.Tile),data:void 0,uid:b.uid,tileID:b.tileID,tileZoom:b.tileZoom,zoom:b.tileID.overscaledZ,tileSize:this.tileSize*b.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:b.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(b.actor&&b.state!=="expired")if(b.state==="loading")b.reloadCallback=u;else{if(b.buckets){const P=Object.values(b.buckets);for(const F of P)F.dirty=!0;return void(b.state="loaded")}b.request=b.actor.send("reloadTile",w,E.bind(this))}else b.actor=this.dispatcher.getActor(),b.request=b.actor.send("loadTile",w,E.bind(this),void 0,!0);function E(P,F){return b.aborted?u(null):P&&P.status!==404?u(P):(F&&(F.resourceTiming&&(b.resourceTiming=F.resourceTiming),this.map._refreshExpiredTiles&&b.setExpiryData(F),b.buckets={...b.buckets,...F.buckets},F.featureIndex&&(b.latestFeatureIndex=F.featureIndex)),b.state="loaded",void u(null))}}serialize(){return o.l({},this._options)}},canvas:class extends o.aD{constructor(b,u,p,w){super(b,u,p,w),u.coordinates?Array.isArray(u.coordinates)&&u.coordinates.length===4&&!u.coordinates.some(E=>!Array.isArray(E)||E.length!==2||E.some(P=>typeof P!="number"))||this.fire(new o.t(new o.V(`sources.${b}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.t(new o.V(`sources.${b}`,null,'missing required property "coordinates"'))),u.animate&&typeof u.animate!="boolean"&&this.fire(new o.t(new o.V(`sources.${b}`,null,'optional "animate" property must be a boolean value'))),u.canvas?typeof u.canvas=="string"||u.canvas instanceof HTMLCanvasElement||this.fire(new o.t(new o.V(`sources.${b}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.t(new o.V(`sources.${b}`,null,'missing required property "canvas"'))),this.options=u,this.animate=u.animate===void 0||u.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.t(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(b){this.map=b,this.load(),this.canvas&&this.animate&&this.play()}onRemove(b){this.pause()}prepare(){let b=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,b=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,b=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const u=this.map.painter.context;this.texture?!b&&!this._playing||this.texture instanceof o.aF||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.T(u,this.canvas,u.gl.RGBA8,{premultiply:!0}),this._prepareData(u)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const b of[this.canvas.width,this.canvas.height])if(isNaN(b)||b<=0)return!0;return!1}},custom:class extends o.E{constructor(b,u,p,w){super(),this.id=b,this.type="custom",this._dataType="raster",this._dispatcher=p,this._implementation=u,this.setEventedParent(w),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.t(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.t(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Bi(this._implementation.bounds,this.minzoom,this.maxzoom)),u.update=this._update.bind(this),u.clearTiles=this._clearTiles.bind(this),u.coveringTiles=this._coveringTiles.bind(this),o.l(this,o.ar(u,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.ar(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.x("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(b){this.map=b,this._loaded=!1,this.fire(new o.x("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(b),this.load()}onRemove(b){this._implementation.onRemove&&this._implementation.onRemove(b)}hasTile(b){if(this._implementation.hasTile){const{x:u,y:p,z:w}=b.canonical;return this._implementation.hasTile({x:u,y:p,z:w})}return!this.tileBounds||this.tileBounds.contains(b.canonical)}loadTile(b,u){const{x:p,y:w,z:E}=b.tileID.canonical,P=new AbortController;b.request=Promise.resolve(this._implementation.loadTile({x:p,y:w,z:E},{signal:P.signal})).then((function(F){return delete b.request,b.aborted?(b.state="unloaded",u(null)):F===void 0?(b.state="errored",u(null)):F===null?(this.loadTileData(b,{width:this.tileSize,height:this.tileSize,data:null}),b.state="loaded",u(null)):function(W){return W instanceof ImageData||W instanceof HTMLCanvasElement||W instanceof ImageBitmap||W instanceof HTMLImageElement}(F)?(this.loadTileData(b,F),b.state="loaded",void u(null)):(b.state="errored",u(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(F=>{F.code!==20&&(b.state="errored",u(F))}),b.request.cancel=()=>P.abort()}loadTileData(b,u){b.setTexture(u,this.map.painter)}unloadTile(b,u){if(b.texture&&b.texture instanceof o.T?(b.destroy(!0),b.texture&&b.texture instanceof o.T&&this.map.painter.saveTileTexture(b.texture)):b.destroy(),this._implementation.unloadTile){const{x:p,y:w,z:E}=b.tileID.canonical;this._implementation.unloadTile({x:p,y:w,z:E})}u&&u()}abortTile(b,u){b.request&&b.request.cancel&&(b.request.cancel(),delete b.request),u&&u()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(b=>({x:b.canonical.x,y:b.canonical.y,z:b.canonical.z}))}_clearTiles(){const b=o.av(this.id,this.scope);this.map.style.clearSource(b)}_update(){this.fire(new o.x("data",{dataType:"source",sourceDataType:"content"}))}}},qi=function(b,u,p,w){const E=new Qn[u.type](b,u,p,w);if(E.id!==b)throw new Error(`Expected Source id to be ${b} instead of ${E.id}`);return o.aJ(["load","abort","unload","serialize","prepare"],E),E};function qr(b,u){const p=o.a6.mat4.identity([]);return o.a6.mat4.scale(p,p,[.5*b.width,.5*-b.height,1]),o.a6.mat4.translate(p,p,[1,-1,0]),o.a6.mat4.multiply(p,p,b.calculateProjMatrix(u.toUnwrapped())),Float32Array.from(p)}function gs(b,u,p,w,E,P,F,W=!1){const $=b.tilesIn(w,F,W);$.sort(Ps);const J=[];for(const oe of $)J.push({wrappedTileID:oe.tile.tileID.wrapped().key,queryResults:oe.tile.queryRenderedFeatures(u,p,b._state,oe,E,P,qr(b.transform,oe.tile.tileID),W)});const Q=function(oe){const le={},ue={};for(const ve of oe){const _e=ve.queryResults,be=ve.wrappedTileID,we=ue[be]=ue[be]||{};for(const ke in _e){const Ne=_e[ke],De=we[ke]=we[ke]||{},je=le[ke]=le[ke]||[];for(const Ge of Ne)De[Ge.featureIndex]||(De[Ge.featureIndex]=!0,je.push(Ge))}}return le}(J);for(const oe in Q)Q[oe].forEach(le=>{const ue=le.feature,ve=ue.layer;ve&&ve.type!=="background"&&ve.type!=="sky"&&ve.type!=="slot"&&(ue.source=ve.source,ve["source-layer"]&&(ue.sourceLayer=ve["source-layer"]),ue.state=ue.id!==void 0?b.getFeatureState(ve["source-layer"],ue.id):{})});return Q}function Wo(b,u){const p=b.getRenderableIds().map(P=>b.getTileByID(P)),w=[],E={};for(let P=0;P<p.length;P++){const F=p[P],W=F.tileID.canonical.key;E[W]||(E[W]=!0,F.querySourceFeatures(w,u))}return w}function Ps(b,u){const p=b.tileID,w=u.tileID;return p.overscaledZ-w.overscaledZ||p.canonical.y-w.canonical.y||p.wrap-w.wrap||p.canonical.x-w.canonical.x}const us=32,Ri=33,so=new Uint16Array(8184);for(let b=0;b<2046;b++){let u=b+2,p=0,w=0,E=0,P=0,F=0,W=0;for(1&u?E=P=F=us:p=w=W=us;(u>>=1)>1;){const J=p+E>>1,Q=w+P>>1;1&u?(E=p,P=w,p=F,w=W):(p=E,w=P,E=F,P=W),F=J,W=Q}const $=4*b;so[$+0]=p,so[$+1]=w,so[$+2]=E,so[$+3]=P}const Ro=new Uint16Array(2178),Ss=new Uint8Array(1089),Dc=new Uint16Array(1089);function Ia(b){return b===0?-.03125:b===32?.03125:0}const sd={type:2,extent:o.ab,loadGeometry:()=>[[new o.P(0,0),new o.P(o.ab+1,0),new o.P(o.ab+1,o.ab+1),new o.P(0,o.ab+1),new o.P(0,0)]]};class Bc{constructor(u,p,w,E,P){this.tileID=u,this.uid=o.aP(),this.uses=0,this.tileSize=p,this.tileZoom=w,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=P,E&&E.style&&(this._lastUpdatedBrightness=E.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",E&&E.transform&&(this.projection=E.transform.projection)}registerFadeDuration(u){const p=u+this.timeAdded;p<o.q.now()||this.fadeEndTime&&p<this.fadeEndTime||(this.fadeEndTime=p)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=o.aK(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(u,p,w){if(this.unloadVectorData(),this.state="loaded",u){u.featureIndex&&(this.latestFeatureIndex=u.featureIndex,u.rawTileData?(this.latestRawTileData=u.rawTileData,this.latestFeatureIndex.rawTileData=u.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=u.collisionBoxArray,this.buckets=function(E,P){const F={};if(!P)return F;for(const W of E){const $=W.layerIds.map(J=>P.getLayer(J)).filter(Boolean);if($.length!==0){W.layers=$,W.stateDependentLayerIds&&(W.stateDependentLayers=W.stateDependentLayerIds.map(J=>$.filter(Q=>Q.id===J)[0]));for(const J of $)F[J.fqid]=W}}return F}(u.buckets,p.style),this.hasSymbolBuckets=!1;for(const E in this.buckets){const P=this.buckets[E];if(P instanceof o.aR){if(this.hasSymbolBuckets=!0,!w)break;P.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const E in this.buckets){const P=this.buckets[E];if(P instanceof o.aR&&P.hasRTLText){this.hasRTLText=!0,o.aS();break}}this.queryPadding=0;for(const E in this.buckets){const P=this.buckets[E],F=p.style.getOwnLayer(E);if(!F)continue;const W=F.queryRadius(P);this.queryPadding=Math.max(this.queryPadding,W)}u.imageAtlas&&(this.imageAtlas=u.imageAtlas),u.glyphAtlasImage&&(this.glyphAtlasImage=u.glyphAtlasImage),u.lineAtlas&&(this.lineAtlas=u.lineAtlas),this._lastUpdatedBrightness=u.brightness}else this.collisionBoxArray=new o.aQ}unloadVectorData(){if(this.hasData()){for(const u in this.buckets)this.buckets[u].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(u){return this.buckets[u.fqid]}upload(u){for(const E in this.buckets){const P=this.buckets[E];P.uploadPending()&&P.upload(u)}const p=u.gl,w=this.imageAtlas;if(w&&!w.uploaded){const E=!!Object.keys(w.patternPositions).length;this.imageAtlasTexture=new o.T(u,w.image,p.RGBA8,{useMipmap:E}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new o.T(u,this.glyphAtlasImage,p.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new o.T(u,this.lineAtlas.image,p.R8),this.lineAtlas.uploaded=!0)}prepare(u,p,w){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(u,this.imageAtlasTexture,w),!p||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const E=p.style.getBrightness();(this._lastUpdatedBrightness||E)&&(this._lastUpdatedBrightness&&E&&Math.abs(this._lastUpdatedBrightness-E)<.001||(this._lastUpdatedBrightness=E,this.updateBuckets(p)))}queryRenderedFeatures(u,p,w,E,P,F,W,$){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:E,pixelPosMatrix:W,transform:F,params:P,tileTransform:this.tileTransform},u,p,w):{}}querySourceFeatures(u,p){const w=this.latestFeatureIndex;if(!w||!w.rawTileData)return;const E=w.loadVTLayers(),P=p?p.sourceLayer:"",F=E._geojsonTileLayer||E[P];if(!F)return;const W=o.aT(p&&p.filter),{z:$,x:J,y:Q}=this.tileID.canonical,oe={z:$,x:J,y:Q};for(let le=0;le<F.length;le++){const ue=F.feature(le);if(W.needGeometry){const be=o.aU(ue,!0);if(!W.filter(new o.a3(this.tileID.overscaledZ),be,this.tileID.canonical))continue}else if(!W.filter(new o.a3(this.tileID.overscaledZ),ue))continue;const ve=w.getId(ue,P),_e=new o.aV(ue,$,J,Q,ve);_e.tile=oe,u.push(_e)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(u){const p=this.expirationTime;if(u.cacheControl){const w=o.aW(u.cacheControl);w["max-age"]&&(this.expirationTime=Date.now()+1e3*w["max-age"])}else u.expires&&(this.expirationTime=new Date(u.expires).getTime());if(this.expirationTime){const w=Date.now();let E=!1;if(this.expirationTime>w)E=!1;else if(p)if(this.expirationTime<p)E=!0;else{const P=this.expirationTime-p;P?this.expirationTime=w+Math.max(P,3e4):E=!0}else E=!0;E?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(u,p){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(u).length!==0&&p&&this.updateBuckets(p)}updateBuckets(u){if(!this.latestFeatureIndex)return;const p=this.latestFeatureIndex.loadVTLayers(),w=u.style.listImages(),E=u.style.getBrightness();for(const P in this.buckets){if(!u.style.hasLayer(P))continue;const F=this.buckets[P],W=F.layers[0].sourceLayer||"_geojsonTileLayer",$=p[W],J=u.style.getOwnSourceCache(F.layers[0].source);let Q={};J&&(Q=J._state.getState(W,void 0)),F.update(Q,$,w,this.imageAtlas&&this.imageAtlas.patternPositions||{},E),(F instanceof o.aX||F instanceof o.aY)&&u._terrain&&u._terrain.enabled&&J&&F.programConfigurations.needsUpload&&u._terrain._clearRenderCacheForTile(J.id,this.tileID);const oe=u&&u.style&&u.style.getOwnLayer(P);oe&&(this.queryPadding=Math.max(this.queryPadding,oe.queryRadius(F)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<o.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(u){this.symbolFadeHoldUntil=o.q.now()+u}setTexture(u,p){const w=p.context,E=w.gl;this.texture=this.texture||p.getTileTexture(u.width),this.texture&&this.texture instanceof o.T?this.texture.update(u):(this.texture=new o.T(w,u,E.RGBA8,{useMipmap:!0}),this.texture.bind(E.LINEAR,E.CLAMP_TO_EDGE))}setDependencies(u,p){const w={};for(const E of p)w[E]=!0;this.dependencies[u]=w}hasDependency(u,p){for(const w of u){const E=this.dependencies[w];if(E){for(const P of p)if(E[P])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(u,p){if(!p||p.name==="mercator"||this._tileDebugBuffer)return;const w=o.aZ(sd,this.tileID.canonical,this.tileTransform)[0],E=new o.a_,P=new o.a$;for(let F=0;F<w.length;F++){const{x:W,y:$}=w[F];E.emplaceBack(W,$),P.emplaceBack(F)}P.emplaceBack(0),this._tileDebugIndexBuffer=u.createIndexBuffer(P),this._tileDebugBuffer=u.createVertexBuffer(E,o.b0.members),this._tileDebugSegments=o.b1.simpleSegment(0,0,E.length,P.length)}_makeTileBoundsBuffers(u,p){if(this._tileBoundsBuffer||!p||p.name==="mercator")return;const w=o.aZ(sd,this.tileID.canonical,this.tileTransform)[0];let E,P;if(this.isRaster){const F=function(W,$){const J=o.aK(W,$),Q=Math.pow(2,W.z);for(let be=0;be<Ri;be++)for(let we=0;we<Ri;we++){const ke=o.aL((W.x+(we+Ia(we))/us)/Q),Ne=o.aM((W.y+(be+Ia(be))/us)/Q),De=$.project(ke,Ne),je=be*Ri+we;Ro[2*je+0]=Math.round((De.x*J.scale-J.x)*o.ab),Ro[2*je+1]=Math.round((De.y*J.scale-J.y)*o.ab)}Ss.fill(0),Dc.fill(0);for(let be=2045;be>=0;be--){const we=4*be,ke=so[we+0],Ne=so[we+1],De=so[we+2],je=so[we+3],Ge=ke+De>>1,et=Ne+je>>1,Ke=Ge+et-Ne,tt=et+ke-Ge,ct=Ne*Ri+ke,st=je*Ri+De,rt=et*Ri+Ge,xt=Math.hypot((Ro[2*ct+0]+Ro[2*st+0])/2-Ro[2*rt+0],(Ro[2*ct+1]+Ro[2*st+1])/2-Ro[2*rt+1])>=16;Ss[rt]=Ss[rt]||(xt?1:0),be<1022&&(Ss[rt]=Ss[rt]||Ss[(Ne+tt>>1)*Ri+(ke+Ke>>1)]||Ss[(je+tt>>1)*Ri+(De+Ke>>1)])}const oe=new o.aN,le=new o.aO;let ue=0;function ve(be,we){const ke=we*Ri+be;return Dc[ke]===0&&(oe.emplaceBack(Ro[2*ke+0],Ro[2*ke+1],be*o.ab/us,we*o.ab/us),Dc[ke]=++ue),Dc[ke]-1}function _e(be,we,ke,Ne,De,je){const Ge=be+ke>>1,et=we+Ne>>1;if(Math.abs(be-De)+Math.abs(we-je)>1&&Ss[et*Ri+Ge])_e(De,je,be,we,Ge,et),_e(ke,Ne,De,je,Ge,et);else{const Ke=ve(be,we),tt=ve(ke,Ne),ct=ve(De,je);le.emplaceBack(Ke,tt,ct)}}return _e(0,0,us,us,us,0),_e(us,us,0,0,0,us),{vertices:oe,indices:le}}(this.tileID.canonical,p);E=F.vertices,P=F.indices}else{E=new o.aN,P=new o.aO;for(const{x:W,y:$}of w)E.emplaceBack(W,$,0,0);const F=o.b2(E.int16,void 0,4);for(let W=0;W<F.length;W+=3)P.emplaceBack(F[W],F[W+1],F[W+2])}this._tileBoundsBuffer=u.createVertexBuffer(E,o.b3.members),this._tileBoundsIndexBuffer=u.createIndexBuffer(P),this._tileBoundsSegments=o.b1.simpleSegment(0,0,E.length,P.length)}_makeGlobeTileDebugBuffers(u,p){const w=p.projection;if(!w||w.name!=="globe"||p.freezeTileCoverage)return;const E=this.tileID.canonical,P=o.b4(E,p),F=o.b5(P),W=o.a9(p.zoom);let $;W>0&&($=o.a6.mat4.invert(new Float64Array(16),p.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(u,E,p,F,$,W),this._makeGlobeTileDebugTextBuffer(u,E,p,F,$,W)}_globePoint(u,p,w,E,P,F,W){let $=o.b6(u,p,w);if(F){const J=1<<w.z,Q=o.am(E.center.lng),oe=o.at(E.center.lat),le=(w.x+.5)/J-Q;let ue=0;le>.5?ue=-1:le<-.5&&(ue=1);let ve=(u/o.ab+w.x)/J+ue,_e=(p/o.ab+w.y)/J;ve=(ve-Q)*E._pixelsPerMercatorPixel+Q,_e=(_e-oe)*E._pixelsPerMercatorPixel+oe;const be=[ve*E.worldSize,_e*E.worldSize,0];o.a6.vec3.transformMat4(be,be,F),$=o.b7($,be,W)}return o.a6.vec3.transformMat4($,$,P)}_makeGlobeTileDebugBorderBuffer(u,p,w,E,P,F){const W=new o.a_,$=new o.a$,J=new o.b8,Q=(le,ue,ve,_e,be)=>{const we=(ve-le)/(be-1),ke=(_e-ue)/(be-1),Ne=W.length;for(let De=0;De<be;De++){const je=le+De*we,Ge=ue+De*ke;W.emplaceBack(je,Ge);const et=this._globePoint(je,Ge,p,w,E,P,F);J.emplaceBack(et[0],et[1],et[2]),$.emplaceBack(Ne+De)}},oe=o.ab;Q(0,0,oe,0,16),Q(oe,0,oe,oe,16),Q(oe,oe,0,oe,16),Q(0,oe,0,0,16),this._tileDebugIndexBuffer=u.createIndexBuffer($),this._tileDebugBuffer=u.createVertexBuffer(W,o.b0.members),this._globeTileDebugBorderBuffer=u.createVertexBuffer(J,o.b9.members),this._tileDebugSegments=o.b1.simpleSegment(0,0,W.length,$.length)}_makeGlobeTileDebugTextBuffer(u,p,w,E,P,F){const W=o.ab/4,$=new o.a_,J=new o.aO,Q=new o.b8,oe=25;J.reserve(32),$.reserve(oe),Q.reserve(oe);const le=(ue,ve)=>oe*ue+ve;for(let ue=0;ue<oe;ue++){const ve=ue*W;for(let _e=0;_e<oe;_e++){const be=_e*W;$.emplaceBack(be,ve);const we=this._globePoint(be,ve,p,w,E,P,F);Q.emplaceBack(we[0],we[1],we[2])}}for(let ue=0;ue<4;ue++)for(let ve=0;ve<4;ve++){const _e=le(ue,ve),be=le(ue,ve+1),we=le(ue+1,ve),ke=le(ue+1,ve+1);J.emplaceBack(_e,be,we),J.emplaceBack(we,be,ke)}this._tileDebugTextIndexBuffer=u.createIndexBuffer(J),this._tileDebugTextBuffer=u.createVertexBuffer($,o.b0.members),this._globeTileDebugTextBuffer=u.createVertexBuffer(Q,o.b9.members),this._tileDebugTextSegments=o.b1.simpleSegment(0,0,oe,32)}destroy(u=!1){for(const p in this.buckets)this.buckets[p].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!u&&this.texture&&this.texture instanceof o.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}o.ba.setPbf(o.bb);class rg extends Bc{constructor(u,p,w,E,P){super(u,p,w,E,P),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(u,p){const w=p.context,E=w.gl;this.texture=this.texture||p.getTileTexture(u.width),this.texture&&this.texture instanceof o.T?this.texture.update(u,{premultiply:!1}):this.texture=new o.T(w,u,E.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(u=16384,p){const w=this._mrt=new o.ba(30),E=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(u-1)}});return this.entireBuffer=null,this.request=o.bc(E,(P,F,W,$)=>{if(P)p(P);else try{const J=w.getHeaderLength(F);if(J>u)return void(this.request=this.fetchHeader(J,p));w.parseHeader(F),this._isHeaderLoaded=!0;let Q=0;for(const oe of Object.values(w.layers))Q=Math.max(Q,oe.dataIndex[oe.dataIndex.length-1].last_byte);F.byteLength>=Q&&(this.entireBuffer=F),p(null,this.entireBuffer||F,W,$)}catch(J){p(J)}}),this.request}fetchBand(u,p,w){const E=this._mrt;if(!this._isHeaderLoaded||!E)return void w(new Error("Tile header is not ready"));const P=this.actor;if(!P)return void w(new Error("Can't fetch tile band without an actor"));let F;const W=(oe,le)=>{F.complete(oe,le),oe?w(oe):(this.updateTextureDescriptor(u,p),w(null,this.textureDescriptor&&this.textureDescriptor.img))},$=(oe,le)=>{if(oe)return w(oe);const ue=P.send("decodeRasterArray",{buffer:le,task:F},W,void 0,!0);this._workQueue.push(()=>{ue&&ue.cancel(),F.cancel()})},J=E.getLayer(u);if(!J)return void w(new Error(`Unknown sourceLayer "${u}"`));if(J.hasDataForBand(p))return this.updateTextureDescriptor(u,p),void w(null,this.textureDescriptor?this.textureDescriptor.img:null);const Q=J.getDataRange([p]);if(F=E.createDecodingTask(Q),!F||F.tasks.length)if(this.flushQueues(),this.entireBuffer)$(null,this.entireBuffer.slice(Q.firstByte,Q.lastByte+1));else{const oe=Object.assign({},this.requestParams,{headers:{Range:`bytes=${Q.firstByte}-${Q.lastByte}`}}),le=o.bc(oe,$);this._fetchQueue.push(()=>{le.cancel(),F.cancel()})}else w(null)}updateNeeded(u,p){return(!this.textureDescriptor||this.textureDescriptor.band!==p||this.textureDescriptor.layer!==u)&&this.state!=="errored"}updateTextureDescriptor(u,p){if(!this._mrt)return;const w=this._mrt.getLayer(u);if(!w||!w.hasBand(p)||!w.hasDataForBand(p))return;const{bytes:E,tileSize:P,buffer:F,offset:W,scale:$}=w.getBandView(p),J=P+2*F,Q={data:E,width:J,height:J},oe=this.texture;oe&&oe instanceof o.T&&oe.update(Q,{premultiply:!1}),this.textureDescriptor={layer:u,band:p,img:Q,buffer:F,offset:W,tileSize:P,format:w.pixelFormat,mix:[$,256*$,65536*$,16777216*$]}}}class bp{constructor(u,p){this.max=u,this.onRemove=p,this.reset()}reset(){for(const u in this.data)for(const p of this.data[u])p.timeout&&clearTimeout(p.timeout),this.onRemove(p.value);return this.data={},this.order=[],this}add(u,p,w){const E=u.wrapped().key;this.data[E]===void 0&&(this.data[E]=[]);const P={value:p,timeout:void 0};if(w!==void 0&&(P.timeout=setTimeout(()=>{this.remove(u,P)},w)),this.data[E].push(P),this.order.push(E),this.order.length>this.max){const F=this._getAndRemoveByKey(this.order[0]);F&&this.onRemove(F)}return this}has(u){return u.wrapped().key in this.data}getAndRemove(u){return this.has(u)?this._getAndRemoveByKey(u.wrapped().key):null}_getAndRemoveByKey(u){const p=this.data[u].shift();return p.timeout&&clearTimeout(p.timeout),this.data[u].length===0&&delete this.data[u],this.order.splice(this.order.indexOf(u),1),p.value}getByKey(u){const p=this.data[u];return p?p[0].value:null}get(u){return this.has(u)?this.data[u.wrapped().key][0].value:null}remove(u,p){if(!this.has(u))return this;const w=u.wrapped().key,E=p===void 0?0:this.data[w].indexOf(p),P=this.data[w][E];return this.data[w].splice(E,1),P.timeout&&clearTimeout(P.timeout),this.data[w].length===0&&delete this.data[w],this.onRemove(P.value),this.order.splice(this.order.indexOf(w),1),this}setMaxSize(u){for(this.max=u;this.order.length>this.max;){const p=this._getAndRemoveByKey(this.order[0]);p&&this.onRemove(p)}return this}filter(u){const p=[];for(const w in this.data)for(const E of this.data[w])u(E.value)||p.push(E);for(const w of p)this.remove(w.value.tileID,w)}}class ig{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(u,p,w){const E=String(p);if(this.stateChanges[u]=this.stateChanges[u]||{},this.stateChanges[u][E]=this.stateChanges[u][E]||{},o.l(this.stateChanges[u][E],w),this.deletedStates[u]===null){this.deletedStates[u]={};for(const P in this.state[u])P!==E&&(this.deletedStates[u][P]=null)}else if(this.deletedStates[u]&&this.deletedStates[u][E]===null){this.deletedStates[u][E]={};for(const P in this.state[u][E])w[P]||(this.deletedStates[u][E][P]=null)}else for(const P in w)this.deletedStates[u]&&this.deletedStates[u][E]&&this.deletedStates[u][E][P]===null&&delete this.deletedStates[u][E][P]}removeFeatureState(u,p,w){if(this.deletedStates[u]===null)return;const E=String(p);if(this.deletedStates[u]=this.deletedStates[u]||{},w&&p!==void 0)this.deletedStates[u][E]!==null&&(this.deletedStates[u][E]=this.deletedStates[u][E]||{},this.deletedStates[u][E][w]=null);else if(p!==void 0)if(this.stateChanges[u]&&this.stateChanges[u][E])for(w in this.deletedStates[u][E]={},this.stateChanges[u][E])this.deletedStates[u][E][w]=null;else this.deletedStates[u][E]=null;else this.deletedStates[u]=null}getState(u,p){const w=this.state[u]||{},E=this.stateChanges[u]||{},P=this.deletedStates[u];if(P===null)return{};if(p!==void 0){const W=String(p),$=o.l({},w[W],E[W]);if(P){const J=P[p];if(J===null)return{};for(const Q in J)delete $[Q]}return $}const F=o.l({},w,E);if(P)for(const W in P)delete F[W];return F}initializeTileState(u,p){u.setFeatureState(this.state,p)}coalesceChanges(u,p){const w={};for(const E in this.stateChanges){this.state[E]=this.state[E]||{};const P={};for(const F in this.stateChanges[E])this.state[E][F]||(this.state[E][F]={}),o.l(this.state[E][F],this.stateChanges[E][F]),P[F]=this.state[E][F];w[E]=P}for(const E in this.deletedStates){this.state[E]=this.state[E]||{};const P={};if(this.deletedStates[E]===null)for(const F in this.state[E])P[F]={},this.state[E][F]={};else for(const F in this.deletedStates[E]){if(this.deletedStates[E][F]===null)this.state[E][F]={};else if(this.state[E][F])for(const W of Object.keys(this.deletedStates[E][F]))delete this.state[E][F][W];P[F]=this.state[E][F]}w[E]=w[E]||{},o.l(w[E],P)}if(this.stateChanges={},this.deletedStates={},Object.keys(w).length!==0)for(const E in u)u[E].setFeatureState(w,p)}}class Xo extends o.E{constructor(u,p,w){super(),this.id=u,this._onlySymbols=w,p.on("data",E=>{E.dataType==="source"&&E.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&E.dataType==="source"&&E.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),p.on("error",()=>{this._sourceErrored=!0}),this._source=p,this._tiles={},this._cache=new bp(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=p.minTileCacheSize,this._maxTileCacheSize=p.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new ig,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(u){this.map=u,this._minTileCacheSize=this._minTileCacheSize===void 0&&u?u._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&u?u._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const u in this._tiles){const p=this._tiles[u];if(p.state!=="loaded"&&p.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const u=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,u&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(u,p){return u.isSymbolTile=this._onlySymbols,u.isExtraShadowCaster=this._shadowCasterTiles[u.tileID.key],this._source.loadTile(u,p)}_unloadTile(u){if(this._source.unloadTile)return this._source.unloadTile(u)}_abortTile(u){if(this._source.abortTile)return this._source.abortTile(u)}serialize(){return this._source.serialize()}prepare(u){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const p in this._tiles){const w=this._tiles[p];w.upload(u),w.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return o.bd(this._tiles).map(u=>u.tileID).sort(Yl).map(u=>u.key)}getRenderableIds(u,p){const w=[];for(const E in this._tiles)this._isIdRenderable(+E,u,p)&&w.push(this._tiles[E]);return u?w.sort((E,P)=>{const F=E.tileID,W=P.tileID,$=new o.P(F.canonical.x,F.canonical.y)._rotate(this.transform.angle),J=new o.P(W.canonical.x,W.canonical.y)._rotate(this.transform.angle);return F.overscaledZ-W.overscaledZ||J.y-$.y||J.x-$.x}).map(E=>E.tileID.key):w.map(E=>E.tileID).sort(Yl).map(E=>E.key)}hasRenderableParent(u){const p=this.findLoadedParent(u,0);return!!p&&this._isIdRenderable(p.tileID.key)}_isIdRenderable(u,p,w){return this._tiles[u]&&this._tiles[u].hasData()&&!this._coveredTiles[u]&&(p||!this._tiles[u].holdingForFade())&&(w||!this._shadowCasterTiles[u])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const u in this._tiles)this._tiles[u].state!=="errored"&&this._reloadTile(+u,"reloading")}}_reloadTile(u,p){const w=this._tiles[u];w&&(w.state!=="loading"&&(w.state=p),this._loadTile(w,this._tileLoaded.bind(this,w,u,p)))}_tileLoaded(u,p,w,E){if(E)if(u.state="errored",E.status!==404)this._source.fire(new o.t(E,{tile:u}));else{if(this._source.fire(new o.x("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:u})),!(u.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const P=this.map.painter.terrain;this.update(this.transform,P.getScaledDemTileSize(),!0),P.resetTileLookupCache(this.id)}else this.update(this.transform)}else u.timeAdded=o.q.now(),w==="expired"&&(u.refreshedUponExpiration=!0),this._setTileReloadTimer(p,u),this._source.type==="raster-dem"&&u.dem&&this._backfillDEM(u),this._state.initializeTileState(u,this.map?this.map.painter:null),this._source.fire(new o.x("data",{dataType:"source",tile:u,coord:u.tileID,sourceCacheId:this.id}))}_backfillDEM(u){const p=this.getRenderableIds();for(let E=0;E<p.length;E++){const P=p[E];if(u.neighboringTiles&&u.neighboringTiles[P]){const F=this.getTileByID(P);w(u,F),w(F,u)}}function w(E,P){if(!E.dem||E.dem.borderReady)return;E.needsHillshadePrepare=!0,E.needsDEMTextureUpload=!0;let F=P.tileID.canonical.x-E.tileID.canonical.x;const W=P.tileID.canonical.y-E.tileID.canonical.y,$=Math.pow(2,E.tileID.canonical.z),J=P.tileID.key;F===0&&W===0||Math.abs(W)>1||(Math.abs(F)>1&&(Math.abs(F+$)===1?F+=$:Math.abs(F-$)===1&&(F-=$)),P.dem&&E.dem&&(E.dem.backfillBorder(P.dem,F,W),E.neighboringTiles&&E.neighboringTiles[J]&&(E.neighboringTiles[J].backfilled=!0)))}}getTile(u){return this.getTileByID(u.key)}getTileByID(u){return this._tiles[u]}_retainLoadedChildren(u,p,w,E){for(const P in this._tiles){let F=this._tiles[P];if(E[P]||!F.hasData()||F.tileID.overscaledZ<=p||F.tileID.overscaledZ>w)continue;let W=F.tileID;for(;F&&F.tileID.overscaledZ>p+1;){const J=F.tileID.scaledTo(F.tileID.overscaledZ-1);F=this._tiles[J.key],F&&F.hasData()&&(W=J)}let $=W;for(;$.overscaledZ>p;)if($=$.scaledTo($.overscaledZ-1),u[$.key]){E[W.key]=W;break}}}findLoadedParent(u,p){if(u.key in this._loadedParentTiles){const w=this._loadedParentTiles[u.key];return w&&w.tileID.overscaledZ>=p?w:null}for(let w=u.overscaledZ-1;w>=p;w--){const E=u.scaledTo(w),P=this._getLoadedTile(E);if(P)return P}}_getLoadedTile(u){const p=this._tiles[u.key];return p&&p.hasData()?p:this._cache.getByKey(this._source.reparseOverscaled?u.wrapped().key:u.canonical.key)}updateCacheSize(u,p){p=p||this._source.tileSize;const w=Math.ceil(u.width/p)+1,E=Math.ceil(u.height/p)+1,P=Math.floor(w*E*5),F=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,P):P,W=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,F):F;this._cache.setMaxSize(W)}handleWrapJump(u){const p=Math.round((u-(this._prevLng===void 0?u:this._prevLng))/360);if(this._prevLng=u,p){const w={};for(const E in this._tiles){const P=this._tiles[E];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+p),w[P.tileID.key]=P}this._tiles=w;for(const E in this._timers)clearTimeout(this._timers[E]),delete this._timers[E];for(const E in this._tiles)this._setTileReloadTimer(+E,this._tiles[E])}}update(u,p,w,E){if(this.transform=u,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!w)return;this.updateCacheSize(u,p),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const P=this._source.type==="batched-model";let F;if(this.used||this.usedForTerrain){if(this._source.tileID)F=u.getVisibleUnwrappedCoordinates(this._source.tileID).map(J=>new o.aA(J.canonical.z,J.wrap,J.canonical.z,J.canonical.x,J.canonical.y));else if(this.tileCoverLift!==0){const J=u.clone();J.tileCoverLift=this.tileCoverLift,F=J.coveringTiles({tileSize:p||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!w,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:P}),this._source.minzoom<=1&&u.projection.name==="globe"&&(F.push(new o.aA(1,0,1,0,0)),F.push(new o.aA(1,0,1,1,0)),F.push(new o.aA(1,0,1,0,1)),F.push(new o.aA(1,0,1,1,1)))}else if(F=u.coveringTiles({tileSize:p||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!w,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:P}),this._source.hasTile){const J=this._source.hasTile.bind(this._source);F=F.filter(Q=>J(Q))}}else F=[];if(F.length>0&&this.castsShadows&&E&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!wp(this._source.type)){const J=u.coveringZoomLevel({tileSize:p||this._source.tileSize,roundZoom:this._source.roundZoom&&!w}),Q=Math.min(J,this._source.maxzoom);if(P){const oe=u.extendTileCover(F,Q);for(const le of oe)F.push(le)}else{const oe=u.extendTileCover(F,Q,E);for(const le of oe)this._shadowCasterTiles[le.key]=!0,F.push(le)}}const W=this._updateRetainedTiles(F);if(wp(this._source.type)&&F.length!==0){const J={},Q={},oe=Object.keys(W);for(const ue of oe){const ve=W[ue],_e=this._tiles[ue];if(!_e||_e.fadeEndTime&&_e.fadeEndTime<=o.q.now())continue;const be=this.findLoadedParent(ve,Math.max(ve.overscaledZ-Xo.maxOverzooming,this._source.minzoom));be&&(this._addTile(be.tileID),J[be.tileID.key]=be.tileID),Q[ue]=ve}const le=F[F.length-1].overscaledZ;for(const ue in this._tiles){const ve=this._tiles[ue];if(W[ue]||!ve.hasData())continue;let _e=ve.tileID;for(;_e.overscaledZ>le;){_e=_e.scaledTo(_e.overscaledZ-1);const be=this._tiles[_e.key];if(be&&be.hasData()&&Q[_e.key]){W[ue]=ve.tileID;break}}}for(const ue in J)W[ue]||(this._coveredTiles[ue]=!0,W[ue]=J[ue])}for(const J in W)this._tiles[J].clearFadeHold();const $=o.be(this._tiles,W);for(const J of $){const Q=this._tiles[J];Q.hasSymbolBuckets&&!Q.holdingForFade()?Q.setHoldDuration(this.map._fadeDuration):Q.hasSymbolBuckets&&!Q.symbolFadeFinished()||this._removeTile(+J)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const u in this._tiles)this._tiles[u].holdingForFade()&&this._removeTile(+u)}_updateRetainedTiles(u){const p={};if(u.length===0)return p;const w={},E=u.reduce((J,Q)=>Math.min(J,Q.overscaledZ),1/0),P=u[0].overscaledZ,F=Math.max(P-Xo.maxOverzooming,this._source.minzoom),W=Math.max(P+Xo.maxUnderzooming,this._source.minzoom),$={};for(const J of u){const Q=this._addTile(J);p[J.key]=J,Q.hasData()||E<this._source.maxzoom&&($[J.key]=J)}this._retainLoadedChildren($,E,W,p);for(const J of u){let Q=this._tiles[J.key];if(Q.hasData())continue;if(J.canonical.z>=this._source.maxzoom){const le=J.children(this._source.maxzoom)[0],ue=this.getTile(le);if(ue&&ue.hasData()){p[le.key]=le;continue}}else{const le=J.children(this._source.maxzoom);if(p[le[0].key]&&p[le[1].key]&&p[le[2].key]&&p[le[3].key])continue}let oe=Q.wasRequested();for(let le=J.overscaledZ-1;le>=F;--le){const ue=J.scaledTo(le);if(w[ue.key]||(w[ue.key]=!0,Q=this.getTile(ue),!Q&&oe&&(Q=this._addTile(ue)),Q&&(p[ue.key]=ue,oe=Q.wasRequested(),Q.hasData())))break}}return p}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const u in this._tiles){const p=[];let w,E=this._tiles[u].tileID;for(;E.overscaledZ>0;){if(E.key in this._loadedParentTiles){w=this._loadedParentTiles[E.key];break}p.push(E.key);const P=E.scaledTo(E.overscaledZ-1);if(w=this._getLoadedTile(P),w)break;E=P}for(const P of p)this._loadedParentTiles[P]=w}}_addTile(u){let p=this._tiles[u.key];if(p)return p.isExtraShadowCaster!==!0||this._shadowCasterTiles[u.key]||this._reloadTile(u.key,"reloading"),p;p=this._cache.getAndRemove(u),p&&(this._setTileReloadTimer(u.key,p),p.tileID=u,this._state.initializeTileState(p,this.map?this.map.painter:null),this._cacheTimers[u.key]&&(clearTimeout(this._cacheTimers[u.key]),delete this._cacheTimers[u.key],this._setTileReloadTimer(u.key,p)));const w=!!p;if(!w){const E=this.map?this.map.painter:null,P=this._source.tileSize*u.overscaleFactor();p=this._source.type==="raster-array"?new rg(u,P,this.transform.tileZoom,E,this._isRaster):new Bc(u,P,this.transform.tileZoom,E,this._isRaster),this._loadTile(p,this._tileLoaded.bind(this,p,u.key,p.state))}return p?(p.uses++,this._tiles[u.key]=p,w||this._source.fire(new o.x("dataloading",{tile:p,coord:p.tileID,dataType:"source"})),p):null}_setTileReloadTimer(u,p){u in this._timers&&(clearTimeout(this._timers[u]),delete this._timers[u]);const w=p.getExpiryTimeout();w&&(this._timers[u]=setTimeout(()=>{this._reloadTile(u,"expired"),delete this._timers[u]},w))}_removeTile(u){const p=this._tiles[u];p&&(p.uses--,delete this._tiles[u],this._timers[u]&&(clearTimeout(this._timers[u]),delete this._timers[u]),p.uses>0||(p.hasData()&&p.state!=="reloading"||p.state==="empty"?this._cache.add(p.tileID,p,p.getExpiryTimeout()):(p.aborted=!0,this._abortTile(p),this._unloadTile(p))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const u in this._tiles)this._removeTile(+u);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(u,p,w){const E=[],P=this.transform;if(!P)return E;const F=P.projection.name==="globe",W=o.am(P.center.lng);for(const $ in this._tiles){const J=this._tiles[$];if(w&&J.clearQueryDebugViz(),J.holdingForFade())continue;let Q;if(F){const oe=J.tileID.canonical;if(oe.z===0){const le=[Math.abs(o.ap(W,...od(oe,-1))-W),Math.abs(o.ap(W,...od(oe,1))-W)];Q=[0,2*le.indexOf(Math.min(...le))-1]}else{const le=[Math.abs(o.ap(W,...od(oe,-1))-W),Math.abs(o.ap(W,...od(oe,0))-W),Math.abs(o.ap(W,...od(oe,1))-W)];Q=[le.indexOf(Math.min(...le))-1]}}else Q=[0];for(const oe of Q){const le=u.containsTile(J,P,p,oe);le&&E.push(le)}}return E}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(u){return this._getRenderableCoordinates(u)}_getRenderableCoordinates(u,p){const w=this.getRenderableIds(u,p).map(P=>this._tiles[P].tileID),E=this.transform.projection.name==="globe";for(const P of w)P.projMatrix=this.transform.calculateProjMatrix(P.toUnwrapped()),P.expandedProjMatrix=E?this.transform.calculateProjMatrix(P.toUnwrapped(),!1,!0):P.projMatrix;return w}sortCoordinatesByDistance(u){const p=u.slice(),w=this.transform._camera.position,E=this.transform._camera.forward(),P={};for(const F of p){const W=1/(1<<F.canonical.z);P[F.key]=((F.canonical.x+.5)*W+F.wrap-w[0])*E[0]+((F.canonical.y+.5)*W-w[1])*E[1]-w[2]*E[2]}return p.sort((F,W)=>P[F.key]-P[W.key]),p}hasTransition(){if(this._source.hasTransition())return!0;if(wp(this._source.type))for(const u in this._tiles){const p=this._tiles[u];if(p.fadeEndTime!==void 0&&p.fadeEndTime>=o.q.now())return!0}return!1}setFeatureState(u,p,w){this._state.updateState(u=u||"_geojsonTileLayer",p,w)}removeFeatureState(u,p,w){this._state.removeFeatureState(u=u||"_geojsonTileLayer",p,w)}getFeatureState(u,p){return this._state.getState(u=u||"_geojsonTileLayer",p)}setDependencies(u,p,w){const E=this._tiles[u];E&&E.setDependencies(p,w)}reloadTilesForDependencies(u,p){for(const w in this._tiles)this._tiles[w].hasDependency(u,p)&&this._reloadTile(+w,"reloading");this._cache.filter(w=>!w.hasDependency(u,p))}_preloadTiles(u,p){if(!this._sourceLoaded){const $=()=>{this._sourceLoaded&&(this._source.off("data",$),this._preloadTiles(u,p))};return void this._source.on("data",$)}const w=new Map,E=Array.isArray(u)?u:[u],P=this.map.painter.terrain,F=this.usedForTerrain&&P?P.getScaledDemTileSize():this._source.tileSize;for(const $ of E){const J=$.coveringTiles({tileSize:F,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const Q of J)w.set(Q.key,Q);this.usedForTerrain&&$.updateElevation(!1)}const W=Array.from(w.values());o.bf(W,($,J)=>{const Q=new Bc($,this._source.tileSize*$.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(Q,oe=>{this._source.type==="raster-dem"&&Q.dem&&this._backfillDEM(Q),J(oe,Q)})},p)}}function Yl(b,u){const p=Math.abs(2*b.wrap)-+(b.wrap<0),w=Math.abs(2*u.wrap)-+(u.wrap<0);return b.overscaledZ-u.overscaledZ||w-p||u.canonical.y-b.canonical.y||u.canonical.x-b.canonical.x}function wp(b){return b==="raster"||b==="image"||b==="video"||b==="custom"}function od(b,u){const p=1<<b.z;return[b.x/p+u,(b.x+1)/p+u]}Xo.maxOverzooming=10,Xo.maxUnderzooming=3;class Sp{constructor(u){this.style=u,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const u=!1,p=!1;for(const w in this.style._mergedLayers){const E=this.style._mergedLayers[w];if(E.type==="fill-extrusion")this.layers.push({layer:E,visible:u,visibilityChanged:p});else if(E.type==="model"){const P=this.style.getLayerSource(E);P&&P.type==="batched-model"&&this.layers.push({layer:E,visible:u,visibilityChanged:p})}}}onNewFrame(u){this.layersGotHidden=!1;for(const p of this.layers){const w=p.layer;let E=!1;w.type==="fill-extrusion"?E=!w.isHidden(u)&&w.paint.get("fill-extrusion-opacity")>0:w.type==="model"&&(E=!w.isHidden(u)&&w.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!E&&p.visible,p.visible=E}}updateZOffset(u,p){this.currentBuildingBuckets=[];for(const E of this.layers){const P=E.layer,F=this.style.getLayerSourceCache(P);let W=1;P.type==="fill-extrusion"&&(W=E.visible?P.paint.get("fill-extrusion-vertical-scale"):0);let $=F?F.getTile(p):null;if(!$&&F&&p.canonical.z>F.getSource().minzoom){let J=p.scaledTo(Math.min(F.getSource().maxzoom,p.overscaledZ-1));for(;J.overscaledZ>=F.getSource().minzoom&&($=F.getTile(J),!$&&J.overscaledZ!==0);)J=J.scaledTo(J.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:$?$.getBucket(P):null,tileID:$?$.tileID:p,verticalScale:W})}u.hasAnyZOffset=!1;let w=!1;for(let E=0;E<u.symbolInstances.length;E++){const P=u.symbolInstances.get(E),F=P.zOffset,W=this._getHeightAtTileOffset(p,P.tileAnchorX,P.tileAnchorY);P.zOffset=W!==Number.NEGATIVE_INFINITY?W:F,w||F===P.zOffset||(w=!0),u.hasAnyZOffset||P.zOffset===0||(u.hasAnyZOffset=!0)}w&&(u.zOffsetBuffersNeedUpload=!0,u.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(u,p,w,E){let P=p,F=w;if(u.canonical.z!==E.canonical.z){const W=E.canonical,$=1/(1<<u.canonical.z-W.z);P=(p+u.canonical.x*o.ab)*$-W.x*o.ab|0,F=(w+u.canonical.y*o.ab)*$-W.y*o.ab|0}return{tileX:P,tileY:F}}_getHeightAtTileOffset(u,p,w){let E,P;for(let F=0;F<this.layers.length;++F){if(this.layers[F].layer.type!=="fill-extrusion")continue;const{bucket:W,tileID:$,verticalScale:J}=this.currentBuildingBuckets[F];if(!W)continue;const{tileX:Q,tileY:oe}=this._mapCoordToOverlappingTile(u,p,w,$),le=W.getHeightAtTileCoord(Q,oe);le&&le.height!==void 0&&(le.hidden?E=le.height:P=Math.max(le.height*J,P||0))}if(P!==void 0)return P;for(let F=0;F<this.layers.length;++F){const W=this.layers[F];if(W.layer.type!=="model"||!W.visible)continue;const{bucket:$,tileID:J}=this.currentBuildingBuckets[F];if(!$)continue;const{tileX:Q,tileY:oe}=this._mapCoordToOverlappingTile(u,p,w,J),le=$.getHeightAtTileCoord(Q,oe);if(le&&!le.hidden)return le.height===void 0&&E!==void 0?Math.min(le.maxHeight,E)*le.verticalScale:le.height?le.height*le.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function zu(b,u){const p={};for(const w in b)w!=="ref"&&(p[w]=b[w]);return o.bg.forEach(w=>{w in u&&(p[w]=u[w])}),p}function Nh(b){b=b.slice();const u=Object.create(null);for(let p=0;p<b.length;p++)u[b[p].id]=b[p];for(let p=0;p<b.length;p++)"ref"in b[p]&&(b[p]=zu(b[p],u[b[p].ref]));return b}const ii={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function Ap(b,u,p){p.push({command:ii.addSource,args:[b,u[b]]})}function vr(b,u,p){u.push({command:ii.removeSource,args:[b]}),p[b]=!0}function xx(b,u,p,w){vr(b,p,w),Ap(b,u,p)}function cr(b,u,p){let w;for(w in b[p])if(b[p].hasOwnProperty(w)&&w!=="data"&&!o.bh(b[p][w],u[p][w]))return!1;for(w in u[p])if(u[p].hasOwnProperty(w)&&w!=="data"&&!o.bh(b[p][w],u[p][w]))return!1;return!0}function ad(b,u,p,w,E,P){let F;for(F in u=u||{},b=b||{})b.hasOwnProperty(F)&&(o.bh(b[F],u[F])||p.push({command:P,args:[w,F,u[F],E]}));for(F in u)u.hasOwnProperty(F)&&!b.hasOwnProperty(F)&&(o.bh(b[F],u[F])||p.push({command:P,args:[w,F,u[F],E]}))}function zh(b){return b.id}function ld(b,u){return b[u.id]=u,b}class ys{constructor(u,p){this.reset(u,p)}reset(u,p){this.points=u||[],this._distances=[0];for(let w=1;w<this.points.length;w++)this._distances[w]=this._distances[w-1]+this.points[w].dist(this.points[w-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(p||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(u){if(this.points.length===1)return this.points[0];u=o.ap(u,0,1);let p=1,w=this._distances[p];const E=u*this.paddedLength+this.padding;for(;w<E&&p<this._distances.length;)w=this._distances[++p];const P=p-1,F=this._distances[P],W=w-F,$=W>0?(E-F)/W:0;return this.points[P].mult(1-$).add(this.points[p].mult($))}}class cd{constructor(u,p,w){const E=this.boxCells=[],P=this.circleCells=[];this.xCellCount=Math.ceil(u/w),this.yCellCount=Math.ceil(p/w);for(let F=0;F<this.xCellCount*this.yCellCount;F++)E.push([]),P.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=u,this.height=p,this.xScale=this.xCellCount/u,this.yScale=this.yCellCount/p,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(u,p,w,E,P){this._forEachCell(p,w,E,P,this._insertBoxCell,this.boxUid++),this.boxKeys.push(u),this.bboxes.push(p),this.bboxes.push(w),this.bboxes.push(E),this.bboxes.push(P)}insertCircle(u,p,w,E){this._forEachCell(p-E,w-E,p+E,w+E,this._insertCircleCell,this.circleUid++),this.circleKeys.push(u),this.circles.push(p),this.circles.push(w),this.circles.push(E)}_insertBoxCell(u,p,w,E,P,F){this.boxCells[P].push(F)}_insertCircleCell(u,p,w,E,P,F){this.circleCells[P].push(F)}_query(u,p,w,E,P,F){if(w<0||u>this.width||E<0||p>this.height)return!P&&[];const W=[];if(u<=0&&p<=0&&this.width<=w&&this.height<=E){if(P)return!0;for(let $=0;$<this.boxKeys.length;$++)W.push({key:this.boxKeys[$],x1:this.bboxes[4*$],y1:this.bboxes[4*$+1],x2:this.bboxes[4*$+2],y2:this.bboxes[4*$+3]});for(let $=0;$<this.circleKeys.length;$++){const J=this.circles[3*$],Q=this.circles[3*$+1],oe=this.circles[3*$+2];W.push({key:this.circleKeys[$],x1:J-oe,y1:Q-oe,x2:J+oe,y2:Q+oe})}return F?W.filter(F):W}return this._forEachCell(u,p,w,E,this._queryCell,W,{hitTest:P,seenUids:{box:{},circle:{}}},F),P?W.length>0:W}_queryCircle(u,p,w,E,P){const F=u-w,W=u+w,$=p-w,J=p+w;if(W<0||F>this.width||J<0||$>this.height)return!E&&[];const Q=[];return this._forEachCell(F,$,W,J,this._queryCellCircle,Q,{hitTest:E,circle:{x:u,y:p,radius:w},seenUids:{box:{},circle:{}}},P),E?Q.length>0:Q}query(u,p,w,E,P){return this._query(u,p,w,E,!1,P)}hitTest(u,p,w,E,P){return this._query(u,p,w,E,!0,P)}hitTestCircle(u,p,w,E){return this._queryCircle(u,p,w,!0,E)}_queryCell(u,p,w,E,P,F,W,$){const J=W.seenUids,Q=this.boxCells[P];if(Q!==null){const le=this.bboxes;for(const ue of Q)if(!J.box[ue]){J.box[ue]=!0;const ve=4*ue;if(u<=le[ve+2]&&p<=le[ve+3]&&w>=le[ve+0]&&E>=le[ve+1]&&(!$||$(this.boxKeys[ue]))){if(W.hitTest)return F.push(!0),!0;F.push({key:this.boxKeys[ue],x1:le[ve],y1:le[ve+1],x2:le[ve+2],y2:le[ve+3]})}}}const oe=this.circleCells[P];if(oe!==null){const le=this.circles;for(const ue of oe)if(!J.circle[ue]){J.circle[ue]=!0;const ve=3*ue;if(this._circleAndRectCollide(le[ve],le[ve+1],le[ve+2],u,p,w,E)&&(!$||$(this.circleKeys[ue]))){if(W.hitTest)return F.push(!0),!0;{const _e=le[ve],be=le[ve+1],we=le[ve+2];F.push({key:this.circleKeys[ue],x1:_e-we,y1:be-we,x2:_e+we,y2:be+we})}}}}}_queryCellCircle(u,p,w,E,P,F,W,$){const J=W.circle,Q=W.seenUids,oe=this.boxCells[P];if(oe!==null){const ue=this.bboxes;for(const ve of oe)if(!Q.box[ve]){Q.box[ve]=!0;const _e=4*ve;if(this._circleAndRectCollide(J.x,J.y,J.radius,ue[_e+0],ue[_e+1],ue[_e+2],ue[_e+3])&&(!$||$(this.boxKeys[ve])))return F.push(!0),!0}}const le=this.circleCells[P];if(le!==null){const ue=this.circles;for(const ve of le)if(!Q.circle[ve]){Q.circle[ve]=!0;const _e=3*ve;if(this._circlesCollide(ue[_e],ue[_e+1],ue[_e+2],J.x,J.y,J.radius)&&(!$||$(this.circleKeys[ve])))return F.push(!0),!0}}}_forEachCell(u,p,w,E,P,F,W,$){const J=this._convertToXCellCoord(u),Q=this._convertToYCellCoord(p),oe=this._convertToXCellCoord(w),le=this._convertToYCellCoord(E);for(let ue=J;ue<=oe;ue++)for(let ve=Q;ve<=le;ve++)if(P.call(this,u,p,w,E,this.xCellCount*ve+ue,F,W,$))return}_convertToXCellCoord(u){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(u*this.xScale)))}_convertToYCellCoord(u){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(u*this.yScale)))}_circlesCollide(u,p,w,E,P,F){const W=E-u,$=P-p,J=w+F;return J*J>W*W+$*$}_circleAndRectCollide(u,p,w,E,P,F,W){const $=(F-E)/2,J=Math.abs(u-(E+$));if(J>$+w)return!1;const Q=(W-P)/2,oe=Math.abs(p-(P+Q));if(oe>Q+w)return!1;if(J<=$||oe<=Q)return!0;const le=J-$,ue=oe-Q;return le*le+ue*ue<=w*w}}const Kl={unknown:0,flipRequired:1,flipNotRequired:2},On=Math.tan(85*Math.PI/180);function ei(b,u,p,w,E,P,F){const W=o.a6.mat4.create();if(p)if(P.name==="globe"){const $=o.bi(E,u);o.a6.mat4.multiply(W,W,$)}else{const $=o.a6.mat2.invert([],F);W[0]=$[0],W[1]=$[1],W[4]=$[2],W[5]=$[3],w||o.a6.mat4.rotateZ(W,W,E.angle)}else o.a6.mat4.multiply(W,E.labelPlaneMatrix,b);return W}function Zr(b,u,p,w,E,P,F){const W=ei(b,u,p,w,E,P,F);return P.name==="globe"&&p||(W[2]=W[6]=W[10]=W[14]=0),W}function zs(b,u,p,w,E,P,F){if(p){if(P.name==="globe"){const W=ei(b,u,p,w,E,P,F);return o.a6.mat4.invert(W,W),o.a6.mat4.multiply(W,b,W),W}{const W=o.a6.mat4.clone(b),$=o.a6.mat4.identity([]);return $[0]=F[0],$[1]=F[1],$[4]=F[2],$[5]=F[3],o.a6.mat4.multiply(W,W,$),w||o.a6.mat4.rotateZ(W,W,-E.angle),W}}return E.glCoordMatrix}function ma(b,u,p,w){const E=[b,u,p,1];p?o.a6.vec4.transformMat4(E,E,w):sg(E,E,w);const P=E[3];return E[0]/=P,E[1]/=P,E[2]/=P,E}function ni(b,u){return Math.min(.5+b/u*.5,1.5)}function ol(b,u){const p=b[0]/b[3],w=b[1]/b[3];return p>=-u[0]&&p<=u[0]&&w>=-u[1]&&w<=u[1]}function Xa(b,u,p,w,E,P,F,W,$,J){const Q=p.transform,oe=w?b.textSizeData:b.iconSizeData,le=o.bj(oe,p.transform.zoom),ue=Q.projection.name==="globe",ve=[256/p.width*2+1,256/p.height*2+1],_e=w?b.text.dynamicLayoutVertexArray:b.icon.dynamicLayoutVertexArray;_e.clear();let be=null;ue&&(be=w?b.text.globeExtVertexArray:b.icon.globeExtVertexArray);const we=b.lineVertexArray,ke=w?b.text.placedSymbolArray:b.icon.placedSymbolArray,Ne=p.transform.width/p.transform.height;let De,je=!1;for(let Ge=0;Ge<ke.length;Ge++){const et=ke.get(Ge),{numGlyphs:Ke,writingMode:tt}=et;if(tt!==o.bk.vertical||je||De===o.bk.horizontal||(je=!0),De=tt,(et.hidden||tt===o.bk.vertical)&&!je){al(Ke,_e);continue}je=!1;const ct=new o.P(et.tileAnchorX,et.tileAnchorY);let{x:st,y:rt,z:xt}=Q.projection.projectTilePoint(ct.x,ct.y,J.canonical);if($){const[qt,en,er]=$(ct);st+=qt,rt+=en,xt+=er}const Ft=[st,rt,xt,1];if(o.a6.vec4.transformMat4(Ft,Ft,u),!ol(Ft,ve)){al(Ke,_e);continue}const Zt=Ft[3],kt=ni(p.transform.getCameraToCenterDistance(Q.projection),Zt),hn=o.bl(oe,le,et),bt=F?hn/kt:hn*kt,Wt=ma(st,rt,xt,E);if(Wt[3]<=0){al(Ke,_e);continue}let Vt={};const fn=F?null:$,pn=As(et,bt,!1,W,u,E,P,b.glyphOffsetArray,we,_e,be,Wt,ct,Vt,Ne,fn,Q.projection,J,F);je=pn.useVertical,fn&&pn.needsFlipping&&(Vt={}),(pn.notEnoughRoom||je||pn.needsFlipping&&As(et,bt,!0,W,u,E,P,b.glyphOffsetArray,we,_e,be,Wt,ct,Vt,Ne,fn,Q.projection,J,F).notEnoughRoom)&&al(Ke,_e)}w?(b.text.dynamicLayoutVertexBuffer.updateData(_e),be&&b.text.globeExtVertexBuffer&&b.text.globeExtVertexBuffer.updateData(be)):(b.icon.dynamicLayoutVertexBuffer.updateData(_e),be&&b.icon.globeExtVertexBuffer&&b.icon.globeExtVertexBuffer.updateData(be))}function fu(b,u,p,w,E,P,F,W,$,J,Q,oe,le,ue,ve,_e){const{lineStartIndex:be,glyphStartIndex:we,segment:ke}=W,Ne=we+W.numGlyphs,De=be+W.lineLength,je=u.getoffsetX(we),Ge=u.getoffsetX(Ne-1),et=ud(b*je,p,w,E,P,F,ke,be,De,$,J,Q,oe,le,!0,ue,ve,_e);if(!et)return null;const Ke=ud(b*Ge,p,w,E,P,F,ke,be,De,$,J,Q,oe,le,!0,ue,ve,_e);return Ke?{first:et,last:Ke}:null}function ia(b,u,p,w){return b===o.bk.horizontal&&Math.abs(w)>Math.abs(p)?{useVertical:!0}:b===o.bk.vertical?w>0?{needsFlipping:!0}:null:u!==Kl.unknown&&function(E,P){return E===0||Math.abs(P/E)>On}(p,w)?u===Kl.flipRequired?{needsFlipping:!0}:null:p<0?{needsFlipping:!0}:null}function As(b,u,p,w,E,P,F,W,$,J,Q,oe,le,ue,ve,_e,be,we,ke){const Ne=u/24,De=b.lineOffsetX*Ne,je=b.lineOffsetY*Ne,{lineStartIndex:Ge,glyphStartIndex:et,numGlyphs:Ke,segment:tt,writingMode:ct,flipState:st}=b,rt=Ge+b.lineLength,xt=Ft=>{if(Q){const[bt,Wt,Vt]=Ft.up,fn=J.length;o.bm(Q,fn+0,bt,Wt,Vt),o.bm(Q,fn+1,bt,Wt,Vt),o.bm(Q,fn+2,bt,Wt,Vt),o.bm(Q,fn+3,bt,Wt,Vt)}const[Zt,kt,hn]=Ft.point;o.bn(J,Zt,kt,hn,Ft.angle)};if(Ke>1){const Ft=fu(Ne,W,De,je,p,oe,le,b,$,P,ue,_e,!1,be,we,ke);if(!Ft)return{notEnoughRoom:!0};if(w&&!p){let[Zt,kt,hn]=Ft.first.point,[bt,Wt,Vt]=Ft.last.point;[Zt,kt]=ma(Zt,kt,hn,F),[bt,Wt]=ma(bt,Wt,Vt,F);const fn=ia(ct,st,(bt-Zt)*ve,Wt-kt);if(b.flipState=fn&&fn.needsFlipping?Kl.flipRequired:Kl.flipNotRequired,fn)return fn}xt(Ft.first);for(let Zt=et+1;Zt<et+Ke-1;Zt++){const kt=ud(Ne*W.getoffsetX(Zt),De,je,p,oe,le,tt,Ge,rt,$,P,ue,_e,!1,!1,be,we,ke);if(!kt)return J.length-=4*(Zt-et),{notEnoughRoom:!0};xt(kt)}xt(Ft.last)}else{if(w&&!p){const Zt=ma(le.x,le.y,0,E),kt=Ge+tt+1,hn=new o.P($.getx(kt),$.gety(kt)),bt=ma(hn.x,hn.y,0,E),Wt=bt[3]>0?bt:Ra(le,hn,Zt,1,E,void 0,be,we.canonical),Vt=ia(ct,st,(Wt[0]-Zt[0])*ve,Wt[1]-Zt[1]);if(b.flipState=Vt&&Vt.needsFlipping?Kl.flipRequired:Kl.flipNotRequired,Vt)return Vt}const Ft=ud(Ne*W.getoffsetX(et),De,je,p,oe,le,tt,Ge,rt,$,P,ue,_e,!1,!1,be,we,ke);if(!Ft)return{notEnoughRoom:!0};xt(Ft)}return{}}function bx(b,u,p,w,E){const{x:P,y:F,z:W}=w.projectTilePoint(b.x,b.y,u);if(!E)return ma(P,F,W,p);const[$,J,Q]=E(b);return ma(P+$,F+J,W+Q,p)}function Ra(b,u,p,w,E,P,F,W){const $=bx(b.sub(u)._unit()._add(b),W,E,F,P);return o.a6.vec3.sub($,p,$),o.a6.vec3.normalize($,$),o.a6.vec3.scaleAndAdd($,p,$,w)}function ud(b,u,p,w,E,P,F,W,$,J,Q,oe,le,ue,ve,_e,be,we){const ke=w?b-u:b+u;let Ne=ke>0?1:-1,De=0;w&&(Ne*=-1,De=Math.PI),Ne<0&&(De+=Math.PI);let je=W+F+(Ne>0?0:1)|0,Ge=E,et=E,Ke=0,tt=0;const ct=Math.abs(ke),st=[],rt=[];let xt=P,Ft=xt;const Zt=()=>Ra(Ft,xt,et,ct-Ke+1,Q,le,_e,be.canonical);for(;Ke+tt<=ct;){if(je+=Ne,je<W||je>=$)return null;if(et=Ge,Ft=xt,st.push(et),ue&&rt.push(Ft),xt=new o.P(J.getx(je),J.gety(je)),Ge=oe[je],!Ge){const en=bx(xt,be.canonical,Q,_e,le);Ge=en[3]>0?oe[je]=en:Zt()}Ke+=tt,tt=o.a6.vec3.distance(et,Ge)}ve&&le&&(oe[je]&&(Ge=Zt(),tt=o.a6.vec3.distance(et,Ge)),oe[je]=Ge);const kt=(ct-Ke)/tt,hn=xt.sub(Ft)._mult(kt)._add(Ft),bt=o.a6.vec3.sub([],Ge,et),Wt=o.a6.vec3.scaleAndAdd([],et,bt,kt);let Vt=[0,0,1],fn=bt[0],pn=bt[1];if(we&&(Vt=_e.upVector(be.canonical,hn.x,hn.y),Vt[0]!==0||Vt[1]!==0||Vt[2]!==1)){const en=[Vt[2],0,-Vt[0]],er=o.a6.vec3.cross([],Vt,en);o.a6.vec3.normalize(en,en),o.a6.vec3.normalize(er,er),fn=o.a6.vec3.dot(bt,en),pn=o.a6.vec3.dot(bt,er)}if(p){const en=o.a6.vec3.cross([],Vt,bt);o.a6.vec3.normalize(en,en),o.a6.vec3.scaleAndAdd(Wt,Wt,en,p*Ne)}const qt=De+Math.atan2(pn,fn);return st.push(Wt),ue&&rt.push(hn),{point:Wt,angle:qt,path:st,tilePath:rt,up:Vt}}function al(b,u){const p=u.length,w=p+4*b;u.resize(w),u.float32.fill(-1/0,4*p,4*w)}function sg(b,u,p){const w=u[0],E=u[1];return b[0]=p[0]*w+p[4]*E+p[12],b[1]=p[1]*w+p[5]*E+p[13],b[3]=p[3]*w+p[7]*E+p[15],b}const Us=100;class Po{constructor(u,p,w=new cd(u.width+200,u.height+200,25),E=new cd(u.width+200,u.height+200,25)){this.transform=u,this.grid=w,this.ignoredGrid=E,this.pitchfactor=Math.cos(u._pitch)*u.cameraToCenterDistance,this.screenRightBoundary=u.width+Us,this.screenBottomBoundary=u.height+Us,this.gridRightBoundary=u.width+200,this.gridBottomBoundary=u.height+200,this.fogState=p}placeCollisionBox(u,p,w,E,P,F,W,$){let J=w.projectedAnchorX,Q=w.projectedAnchorY,oe=w.projectedAnchorZ;const le=w.elevation,ue=w.tileID,ve=u.getProjection();if(le&&ue){const[Ge,et,Ke]=ve.upVector(ue.canonical,w.tileAnchorX,w.tileAnchorY),tt=ve.upVectorScale(ue.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;J+=Ge*le*tt,Q+=et*le*tt,oe+=Ke*le*tt}const _e=this.projectAndGetPerspectiveRatio(W,J,Q,oe,w.tileID,ve.name==="globe"||!!le||this.transform.pitch>0,ve),be=F*_e.perspectiveRatio,we=(w.x1*p+E.x-w.padding)*be+_e.point.x,ke=(w.y1*p+E.y-w.padding)*be+_e.point.y,Ne=(w.x2*p+E.x+w.padding)*be+_e.point.x,De=(w.y2*p+E.y+w.padding)*be+_e.point.y,je=_e.perspectiveRatio<=.55||_e.occluded;return!this.isInsideGrid(we,ke,Ne,De)||!P&&this.grid.hitTest(we,ke,Ne,De,$)||je?{box:[],offscreen:!1,occluded:_e.occluded}:{box:[we,ke,Ne,De],offscreen:this.isOffscreen(we,ke,Ne,De),occluded:!1}}placeCollisionCircles(u,p,w,E,P,F,W,$,J,Q,oe,le,ue,ve,_e){const be=[],we=this.transform.elevation,ke=u.getProjection(),Ne=we?we.getAtTileOffsetFunc(_e,this.transform.center.lat,this.transform.worldSize,ke):null,De=new o.P(w.tileAnchorX,w.tileAnchorY);let{x:je,y:Ge,z:et}=ke.projectTilePoint(De.x,De.y,_e.canonical);if(Ne){const[hn,bt,Wt]=Ne(De);je+=hn,Ge+=bt,et+=Wt}const Ke=ke.name==="globe",tt=this.projectAndGetPerspectiveRatio(W,je,Ge,et,_e,Ke||!!we||this.transform.pitch>0,ke),{perspectiveRatio:ct}=tt,st=(oe?F/ct:F*ct)/o.bq,rt=ma(je,Ge,et,$),xt=tt.signedDistanceFromCamera>0?fu(st,P,w.lineOffsetX*st,w.lineOffsetY*st,!1,rt,De,w,E,$,{},we&&!oe?Ne:null,oe&&!!we,ke,_e,oe):null;let Ft=!1,Zt=!1,kt=!0;if(xt&&!tt.occluded){const hn=.5*ue*ct+ve,bt=new o.P(-100,-100),Wt=new o.P(this.screenRightBoundary,this.screenBottomBoundary),Vt=new ys,{first:fn,last:pn}=xt,qt=fn.path.length;let en=[];for(let Dn=qt-1;Dn>=1;Dn--)en.push(fn.path[Dn]);for(let Dn=1;Dn<pn.path.length;Dn++)en.push(pn.path[Dn]);const er=2.5*hn;J&&(en=en.map(([Dn,yr,qn],ur)=>(Ne&&!Ke&&(qn=Ne(ur<qt-1?fn.tilePath[qt-1-ur]:pn.tilePath[ur-qt+2])[2]),ma(Dn,yr,qn,J))),en.some(Dn=>Dn[3]<=0)&&(en=[]));let xn=[];if(en.length>0){let Dn=1/0,yr=-1/0,qn=1/0,ur=-1/0;for(const Ur of en)Dn=Math.min(Dn,Ur[0]),qn=Math.min(qn,Ur[1]),yr=Math.max(yr,Ur[0]),ur=Math.max(ur,Ur[1]);yr>=bt.x&&Dn<=Wt.x&&ur>=bt.y&&qn<=Wt.y&&(xn=[en.map(Ur=>new o.P(Ur[0],Ur[1]))],(Dn<bt.x||yr>Wt.x||qn<bt.y||ur>Wt.y)&&(xn=o.bo(xn,bt.x,bt.y,Wt.x,Wt.y)))}for(const Dn of xn){Vt.reset(Dn,.25*hn);let yr=0;yr=Vt.length<=.5*hn?1:Math.ceil(Vt.paddedLength/er)+1;for(let qn=0;qn<yr;qn++){const ur=qn/Math.max(yr-1,1),Ur=Vt.lerp(ur),Br=Ur.x+Us,Mi=Ur.y+Us;be.push(Br,Mi,hn,0);const Ni=Br-hn,ns=Mi-hn,jc=Br+hn,Js=Mi+hn;if(kt=kt&&this.isOffscreen(Ni,ns,jc,Js),Zt=Zt||this.isInsideGrid(Ni,ns,jc,Js),!p&&this.grid.hitTestCircle(Br,Mi,hn,le)&&(Ft=!0,!Q))return{circles:[],offscreen:!1,collisionDetected:Ft,occluded:!1}}}}return{circles:!Q&&Ft||!Zt?[]:be,offscreen:kt,collisionDetected:Ft,occluded:tt.occluded}}queryRenderedSymbols(u){if(u.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const p=[];let w=1/0,E=1/0,P=-1/0,F=-1/0;for(const Q of u){const oe=new o.P(Q.x+Us,Q.y+Us);w=Math.min(w,oe.x),E=Math.min(E,oe.y),P=Math.max(P,oe.x),F=Math.max(F,oe.y),p.push(oe)}const W=this.grid.query(w,E,P,F).concat(this.ignoredGrid.query(w,E,P,F)),$={},J={};for(const Q of W){const oe=Q.key;if($[oe.bucketInstanceId]===void 0&&($[oe.bucketInstanceId]={}),$[oe.bucketInstanceId][oe.featureIndex])continue;const le=[new o.P(Q.x1,Q.y1),new o.P(Q.x2,Q.y1),new o.P(Q.x2,Q.y2),new o.P(Q.x1,Q.y2)];o.bp(p,le)&&($[oe.bucketInstanceId][oe.featureIndex]=!0,J[oe.bucketInstanceId]===void 0&&(J[oe.bucketInstanceId]=[]),J[oe.bucketInstanceId].push(oe.featureIndex))}return J}insertCollisionBox(u,p,w,E,P){(p?this.ignoredGrid:this.grid).insert({bucketInstanceId:w,featureIndex:E,collisionGroupID:P},u[0],u[1],u[2],u[3])}insertCollisionCircles(u,p,w,E,P){const F=p?this.ignoredGrid:this.grid,W={bucketInstanceId:w,featureIndex:E,collisionGroupID:P};for(let $=0;$<u.length;$+=4)F.insertCircle(W,u[$],u[$+1],u[$+2])}projectAndGetPerspectiveRatio(u,p,w,E,P,F,W){const $=[p,w,E,1];let J=!1;E||this.transform.pitch>0?(o.a6.vec4.transformMat4($,$,u),this.fogState&&P&&W.name!=="globe"&&(J=function(le,ue,ve,_e,be,we){const ke=we.calculateFogTileMatrix(be),Ne=[ue,ve,_e];return o.a6.vec3.transformMat4(Ne,Ne,ke),Cn(le,o.a6.vec3.length(Ne),we.pitch,we._fov)}(this.fogState,p,w,E,P.toUnwrapped(),this.transform)>.9)):sg($,$,u);const Q=$[3];return{point:new o.P(($[0]/Q+1)/2*this.transform.width+Us,(-$[1]/Q+1)/2*this.transform.height+Us),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(W)/Q*.5,1.5),signedDistanceFromCamera:Q,occluded:F&&$[2]>Q||J}}isOffscreen(u,p,w,E){return w<Us||u>=this.screenRightBoundary||E<Us||p>this.screenBottomBoundary}isInsideGrid(u,p,w,E){return w>=0&&u<this.gridRightBoundary&&E>=0&&p<this.gridBottomBoundary}getViewportMatrix(){const u=o.a6.mat4.identity([]);return o.a6.mat4.translate(u,u,[-100,-100,0]),u}}function $o(b,u,p){const w=u.createTileMatrix(b,b.worldSize,p.toUnwrapped());return o.a6.mat4.multiply(new Float32Array(16),b.projMatrix,w)}function Uh(b,u,p){if(u.projection.name===p.projection.name)return b.projMatrix;const w=p.clone();return w.setProjection(u.projection),$o(w,u.getProjection(),b)}function kc(b,u,p){return u.name===p.projection.name?b.projMatrix:$o(p,u,b)}class Ls{constructor(u,p,w,E){this.opacity=u?Math.max(0,Math.min(1,u.opacity+(u.placed?p:-p))):E&&w?1:0,this.placed=w}isHidden(){return this.opacity===0&&!this.placed}}class ga{constructor(u,p,w,E,P,F=!1){this.text=new Ls(u?u.text:null,p,w,P),this.icon=new Ls(u?u.icon:null,p,E,P),this.clipped=F}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ll{constructor(u,p,w,E=!1){this.text=u,this.icon=p,this.skipFade=w,this.clipped=E}}class $s{constructor(){this.invProjMatrix=o.a6.mat4.create(),this.viewportMatrix=o.a6.mat4.create(),this.circles=[]}}class Uu{constructor(u,p,w,E,P){this.bucketInstanceId=u,this.featureIndex=p,this.sourceLayerIndex=w,this.bucketIndex=E,this.tileID=P}}class qs{constructor(u){this.crossSourceCollisions=u,this.maxGroupID=0,this.collisionGroups={}}get(u){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[u]){const p=++this.maxGroupID;this.collisionGroups[u]={ID:p,predicate:w=>w.collisionGroupID===p}}return this.collisionGroups[u]}}function Pa(b,u,p,w,E){const{horizontalAlign:P,verticalAlign:F}=o.bx(b),W=-(P-.5)*u,$=-(F-.5)*p,J=o.bw(b,w);return new o.P(W+J[0]*E,$+J[1]*E)}function $a(b,u,p,w,E){const P=new o.P(b,u);return p&&P._rotate(w?E:-E),P}class du{constructor(u,p,w,E,P,F){this.transform=u.clone(),this.projection=u.projection.name,this.collisionIndex=new Po(this.transform,P),this.buildingIndex=F,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=p,this.retainedQueryData={},this.collisionGroups=new qs(w),this.collisionCircleArrays={},this.prevPlacement=E,E&&(E.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(u,p,w,E){const P=w.getBucket(p),F=w.latestFeatureIndex;if(!P||!F||p.fqid!==P.layerIds[0])return;const W=P.layers[0].layout,$=P.layers[0].paint,J=w.collisionBoxArray,Q=Math.pow(2,this.transform.zoom-w.tileID.overscaledZ),oe=w.tileSize/o.ab,le=w.tileID.toUnwrapped();this.transform.setProjection(P.projection);const ue=(ve=w.tileID,_e=P.getProjection(),be=this.transform,_e.name===this.projection?be.calculateProjMatrix(ve.toUnwrapped()):$o(be,_e,ve));var ve,_e,be;const we=W.get("text-pitch-alignment")==="map",ke=W.get("text-rotation-alignment")==="map";p.compileFilter();const Ne=p.dynamicFilter(),De=p.dynamicFilterNeedsFeature(),je=this.transform.calculatePixelsToTileUnitsMatrix(w),Ge=Zr(ue,w.tileID.canonical,we,ke,this.transform,P.getProjection(),je);let et=null;if(we){const ct=zs(ue,w.tileID.canonical,we,ke,this.transform,P.getProjection(),je);et=o.a6.mat4.multiply([],this.transform.labelPlaneMatrix,ct)}let Ke=null;Ne&&w.latestFeatureIndex&&(Ke={unwrappedTileID:le,dynamicFilter:Ne,dynamicFilterNeedsFeature:De}),this.retainedQueryData[P.bucketInstanceId]=new Uu(P.bucketInstanceId,F,P.sourceLayerIndex,P.index,w.tileID);const tt={bucket:P,layout:W,paint:$,posMatrix:ue,textLabelPlaneMatrix:Ge,labelToScreenMatrix:et,clippingData:Ke,scale:Q,textPixelRatio:oe,holdingForFade:w.holdingForFade(),collisionBoxArray:J,partiallyEvaluatedTextSize:o.bj(P.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:o.bj(P.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(P.sourceID),latestFeatureIndex:w.latestFeatureIndex};if(E)for(const ct of P.sortKeyRanges){const{sortKey:st,symbolInstanceStart:rt,symbolInstanceEnd:xt}=ct;u.push({sortKey:st,symbolInstanceStart:rt,symbolInstanceEnd:xt,parameters:tt})}else u.push({symbolInstanceStart:0,symbolInstanceEnd:P.symbolInstances.length,parameters:tt})}attemptAnchorPlacement(u,p,w,E,P,F,W,$,J,Q,oe,le,ue,ve,_e,be,we,ke){const{textOffset0:Ne,textOffset1:De,crossTileID:je}=le,Ge=[Ne,De],et=Pa(u,w,E,Ge,P),Ke=this.collisionIndex.placeCollisionBox(ve,P,p,$a(et.x,et.y,F,W,this.transform.angle),oe,$,J,Q.predicate);if(be){const tt=ve.getSymbolInstanceIconSize(ke,this.transform.zoom,le.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(ve,tt,be,$a(et.x,et.y,F,W,this.transform.angle),oe,$,J,Q.predicate).box.length===0)return}if(Ke.box.length>0){let tt;return this.prevPlacement&&this.prevPlacement.variableOffsets[je]&&this.prevPlacement.placements[je]&&this.prevPlacement.placements[je].text&&(tt=this.prevPlacement.variableOffsets[je].anchor),this.variableOffsets[je]={textOffset:Ge,width:w,height:E,anchor:u,textScale:P,prevAnchor:tt},this.markUsedJustification(ve,u,le,_e),ve.allowVerticalPlacement&&(this.markUsedOrientation(ve,_e,le),this.placedOrientations[je]=_e),{shift:et,placedGlyphBoxes:Ke}}}placeLayerBucketPart(u,p,w,E){const{bucket:P,layout:F,paint:W,posMatrix:$,textLabelPlaneMatrix:J,labelToScreenMatrix:Q,clippingData:oe,textPixelRatio:le,holdingForFade:ue,collisionBoxArray:ve,partiallyEvaluatedTextSize:_e,partiallyEvaluatedIconSize:be,collisionGroup:we,latestFeatureIndex:ke}=u.parameters,Ne=F.get("text-optional"),De=F.get("icon-optional"),je=F.get("text-allow-overlap"),Ge=F.get("icon-allow-overlap"),et=F.get("text-rotation-alignment")==="map",Ke=F.get("text-pitch-alignment")==="map",tt=F.get("symbol-z-elevate"),ct=W.get("symbol-z-offset"),st=W.get("symbol-elevation-reference")==="sea";this.transform.setProjection(P.projection);let rt=je&&(Ge||!P.hasIconData()||De),xt=Ge&&(je||!P.hasTextData()||Ne);const Ft=!ct.isConstant();!P.collisionArrays&&ve&&P.deserializeCollisionBoxes(ve),w&&E&&P.updateCollisionDebugBuffers(this.transform.zoom,ve);const Zt=(kt,hn,bt)=>{const{crossTileID:Wt,numVerticalGlyphVertices:Vt}=kt;let fn=null;if(oe&&oe.dynamicFilterNeedsFeature||Ft){const kr=this.retainedQueryData[P.bucketInstanceId];fn=ke.loadFeature({featureIndex:kt.featureIndex,bucketIndex:kr.bucketIndex,sourceLayerIndex:kr.sourceLayerIndex,layoutVertexArrayOffset:0})}if(oe&&!(0,oe.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},fn,this.retainedQueryData[P.bucketInstanceId].tileID.canonical,new o.P(kt.tileAnchorX,kt.tileAnchorY),this.transform.calculateDistanceTileData(oe.unwrappedTileID)))return this.placements[Wt]=new ll(!1,!1,!1,!0),void p.add(Wt);const pn=ct.evaluate(fn,{});if(p.has(Wt))return;if(ue)return void(this.placements[Wt]=new ll(!1,!1,!1));let qt=!1,en=!1,er=!0,xn=!1,Dn=!1,yr=null,qn={box:null,offscreen:null,occluded:null},ur={box:null,offscreen:null,occluded:null},Ur=null,Br=null,Mi=null,Ni=0,ns=0,jc=0;bt.textFeatureIndex?Ni=bt.textFeatureIndex:kt.useRuntimeCollisionCircles&&(Ni=kt.featureIndex),bt.verticalTextFeatureIndex&&(ns=bt.verticalTextFeatureIndex);const Js=kr=>{kr.tileID=this.retainedQueryData[P.bucketInstanceId].tileID;const di=this.transform.elevation;kr.elevation=st?pn:pn+(di?di.getAtTileOffset(kr.tileID,kr.tileAnchorX,kr.tileAnchorY):0),kr.elevation+=kt.zOffset},Yr=bt.textBox;if(Yr){Js(Yr);const kr=Si=>{let Fs=o.bk.horizontal;if(P.allowVerticalPlacement&&!Si&&this.prevPlacement){const Qs=this.prevPlacement.placedOrientations[Wt];Qs&&(this.placedOrientations[Wt]=Qs,Fs=Qs,this.markUsedOrientation(P,Fs,kt))}return Fs},di=(Si,Fs)=>{if(P.allowVerticalPlacement&&Vt>0&&bt.verticalTextBox){for(const Qs of P.writingModes)if(Qs===o.bk.vertical?(qn=Fs(),ur=qn):qn=Si(),qn&&qn.box&&qn.box.length)break}else qn=Si()};if(F.get("text-variable-anchor")){let Si=F.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Wt]){const si=this.prevPlacement.variableOffsets[Wt];Si.indexOf(si.anchor)>0&&(Si=Si.filter(Oo=>Oo!==si.anchor),Si.unshift(si.anchor))}const Fs=(si,Oo,Yo)=>{const Fo=P.getSymbolInstanceTextSize(_e,kt,this.transform.zoom,hn),Zi=(si.x2-si.x1)*Fo+2*si.padding,dl=(si.y2-si.y1)*Fo+2*si.padding,pl=kt.hasIconTextFit&&!Ge?Oo:null;pl&&Js(pl);let Wc={box:[],offscreen:!1,occluded:!1};const fc=je?2*Si.length:Si.length;for(let Rl=0;Rl<fc;++Rl){const Xc=this.attemptAnchorPlacement(Si[Rl%Si.length],si,Zi,dl,Fo,et,Ke,le,$,we,Rl>=Si.length,kt,hn,P,Yo,pl,_e,be);if(Xc&&(Wc=Xc.placedGlyphBoxes,Wc&&Wc.box&&Wc.box.length)){qt=!0,yr=Xc.shift;break}}return Wc};di(()=>Fs(Yr,bt.iconBox,o.bk.horizontal),()=>{const si=bt.verticalTextBox;return si&&Js(si),P.allowVerticalPlacement&&!(qn&&qn.box&&qn.box.length)&&Vt>0&&si?Fs(si,bt.verticalIconBox,o.bk.vertical):{box:null,offscreen:null,occluded:null}}),qn&&(qt=qn.box,er=qn.offscreen,xn=qn.occluded);const Qs=kr(!(!qn||!qn.box));if(!qt&&this.prevPlacement){const si=this.prevPlacement.variableOffsets[Wt];si&&(this.variableOffsets[Wt]=si,this.markUsedJustification(P,si.anchor,kt,Qs))}}else{const Si=(Fs,Qs)=>{const si=P.getSymbolInstanceTextSize(_e,kt,this.transform.zoom,hn),Oo=this.collisionIndex.placeCollisionBox(P,si,Fs,new o.P(0,0),je,le,$,we.predicate);return Oo&&Oo.box&&Oo.box.length&&(this.markUsedOrientation(P,Qs,kt),this.placedOrientations[Wt]=Qs),Oo};di(()=>Si(Yr,o.bk.horizontal),()=>{const Fs=bt.verticalTextBox;return P.allowVerticalPlacement&&Vt>0&&Fs?(Js(Fs),Si(Fs,o.bk.vertical)):{box:null,offscreen:null,occluded:null}}),kr(!!(qn&&qn.box&&qn.box.length))}}if(Ur=qn,qt=Ur&&Ur.box&&Ur.box.length>0,er=Ur&&Ur.offscreen,xn=Ur&&Ur.occluded,kt.useRuntimeCollisionCircles){const kr=P.text.placedSymbolArray.get(kt.centerJustifiedTextSymbolIndex>=0?kt.centerJustifiedTextSymbolIndex:kt.verticalPlacedTextSymbolIndex),di=o.bl(P.textSizeData,_e,kr),Si=F.get("text-padding");Br=this.collisionIndex.placeCollisionCircles(P,je,kr,P.lineVertexArray,P.glyphOffsetArray,di,$,J,Q,w,Ke,we.predicate,kt.collisionCircleDiameter*di/o.bq,Si,this.retainedQueryData[P.bucketInstanceId].tileID),qt=je||Br.circles.length>0&&!Br.collisionDetected,er=er&&Br.offscreen,xn=Br.occluded}if(bt.iconFeatureIndex&&(jc=bt.iconFeatureIndex),bt.iconBox){const kr=di=>{Js(di);const Si=kt.hasIconTextFit&&yr?$a(yr.x,yr.y,et,Ke,this.transform.angle):new o.P(0,0),Fs=P.getSymbolInstanceIconSize(be,this.transform.zoom,kt.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(P,Fs,di,Si,Ge,le,$,we.predicate)};ur&&ur.box&&ur.box.length&&bt.verticalIconBox?(Mi=kr(bt.verticalIconBox),en=Mi.box.length>0):(Mi=kr(bt.iconBox),en=Mi.box.length>0),er=er&&Mi.offscreen,Dn=Mi.occluded}const Oi=Ne||kt.numHorizontalGlyphVertices===0&&Vt===0,bs=De||kt.numIconVertices===0;if(Oi||bs?bs?Oi||(en=en&&qt):qt=en&&qt:en=qt=en&&qt,qt&&Ur&&Ur.box&&this.collisionIndex.insertCollisionBox(Ur.box,F.get("text-ignore-placement"),P.bucketInstanceId,ur&&ur.box&&ns?ns:Ni,we.ID),en&&Mi&&this.collisionIndex.insertCollisionBox(Mi.box,F.get("icon-ignore-placement"),P.bucketInstanceId,jc,we.ID),Br&&(qt&&this.collisionIndex.insertCollisionCircles(Br.circles,F.get("text-ignore-placement"),P.bucketInstanceId,Ni,we.ID),w)){const kr=P.bucketInstanceId;let di=this.collisionCircleArrays[kr];di===void 0&&(di=this.collisionCircleArrays[kr]=new $s);for(let Si=0;Si<Br.circles.length;Si+=4)di.circles.push(Br.circles[Si+0]),di.circles.push(Br.circles[Si+1]),di.circles.push(Br.circles[Si+2]),di.circles.push(Br.collisionDetected?1:0)}const Pi=P.projection.name!=="globe";rt=rt&&(Pi||!xn),xt=xt&&(Pi||!Dn),this.placements[Wt]=new ll(qt||rt,en||xt,er||P.justReloaded),p.add(Wt)};if(tt&&this.buildingIndex&&(this.buildingIndex.updateZOffset(P,this.retainedQueryData[P.bucketInstanceId].tileID),P.updateZOffset()),P.sortFeaturesByY){const kt=P.getSortedSymbolIndexes(this.transform.angle);for(let hn=kt.length-1;hn>=0;--hn){const bt=kt[hn];Zt(P.symbolInstances.get(bt),bt,P.collisionArrays[bt])}P.hasAnyZOffset&&o.w(`${P.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(P.hasAnyZOffset){const kt=P.getSortedIndexesByZOffset();for(let hn=0;hn<kt.length;++hn){const bt=kt[hn];Zt(P.symbolInstances.get(bt),bt,P.collisionArrays[bt])}}else for(let kt=u.symbolInstanceStart;kt<u.symbolInstanceEnd;kt++)Zt(P.symbolInstances.get(kt),kt,P.collisionArrays[kt]);if(w&&P.bucketInstanceId in this.collisionCircleArrays){const kt=this.collisionCircleArrays[P.bucketInstanceId];o.a6.mat4.invert(kt.invProjMatrix,$),kt.viewportMatrix=this.collisionIndex.getViewportMatrix()}P.justReloaded=!1}markUsedJustification(u,p,w,E){const{leftJustifiedTextSymbolIndex:P,centerJustifiedTextSymbolIndex:F,rightJustifiedTextSymbolIndex:W,verticalPlacedTextSymbolIndex:$,crossTileID:J}=w,Q=o.bv(p),oe=E===o.bk.vertical?$:Q==="left"?P:Q==="center"?F:Q==="right"?W:-1;P>=0&&(u.text.placedSymbolArray.get(P).crossTileID=oe>=0&&P!==oe?0:J),F>=0&&(u.text.placedSymbolArray.get(F).crossTileID=oe>=0&&F!==oe?0:J),W>=0&&(u.text.placedSymbolArray.get(W).crossTileID=oe>=0&&W!==oe?0:J),$>=0&&(u.text.placedSymbolArray.get($).crossTileID=oe>=0&&$!==oe?0:J)}markUsedOrientation(u,p,w){const E=p===o.bk.horizontal||p===o.bk.horizontalOnly?p:0,P=p===o.bk.vertical?p:0,{leftJustifiedTextSymbolIndex:F,centerJustifiedTextSymbolIndex:W,rightJustifiedTextSymbolIndex:$,verticalPlacedTextSymbolIndex:J}=w,Q=u.text.placedSymbolArray;F>=0&&(Q.get(F).placedOrientation=E),W>=0&&(Q.get(W).placedOrientation=E),$>=0&&(Q.get($).placedOrientation=E),J>=0&&(Q.get(J).placedOrientation=P)}commit(u){this.commitTime=u,this.zoomAtLastRecencyCheck=this.transform.zoom;const p=this.prevPlacement;let w=!1;this.prevZoomAdjustment=p?p.zoomAdjustment(this.transform.zoom):0;const E=p?p.symbolFadeChange(u):1,P=p?p.opacities:{},F=p?p.variableOffsets:{},W=p?p.placedOrientations:{};for(const $ in this.placements){const J=this.placements[$],Q=P[$];Q?(this.opacities[$]=new ga(Q,E,J.text,J.icon,null,J.clipped),w=w||J.text!==Q.text.placed||J.icon!==Q.icon.placed):(this.opacities[$]=new ga(null,E,J.text,J.icon,J.skipFade,J.clipped),w=w||J.text||J.icon)}for(const $ in P){const J=P[$];if(!this.opacities[$]){const Q=new ga(J,E,!1,!1);Q.isHidden()||(this.opacities[$]=Q,w=w||J.text.placed||J.icon.placed)}}for(const $ in F)this.variableOffsets[$]||!this.opacities[$]||this.opacities[$].isHidden()||(this.variableOffsets[$]=F[$]);for(const $ in W)this.placedOrientations[$]||!this.opacities[$]||this.opacities[$].isHidden()||(this.placedOrientations[$]=W[$]);w?this.lastPlacementChangeTime=u:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=p?p.lastPlacementChangeTime:u)}updateLayerOpacities(u,p,w,E){const P=new Set;for(const F of p){const W=F.getBucket(u);W&&F.latestFeatureIndex&&u.fqid===W.layerIds[0]&&(this.updateBucketOpacities(W,P,F,F.collisionBoxArray,w,E,F.tileID,u.scope),W.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(W,F.tileID),W.updateZOffset()))}}updateBucketOpacities(u,p,w,E,P,F,W,$){u.hasTextData()&&u.text.opacityVertexArray.clear(),u.hasIconData()&&u.icon.opacityVertexArray.clear(),u.hasIconCollisionBoxData()&&u.iconCollisionBox.collisionVertexArray.clear(),u.hasTextCollisionBoxData()&&u.textCollisionBox.collisionVertexArray.clear();const J=u.layers[0].layout,Q=u.layers[0].paint,oe=!!u.layers[0].dynamicFilter(),le=new ga(null,0,!1,!1,!0),ue=J.get("text-allow-overlap"),ve=J.get("icon-allow-overlap"),_e=J.get("text-variable-anchor"),be=J.get("text-rotation-alignment")==="map",we=J.get("text-pitch-alignment")==="map",ke=Q.get("symbol-z-offset"),Ne=Q.get("symbol-elevation-reference")==="sea",De=!ke.isConstant(),je=new ga(null,0,ue&&(ve||!u.hasIconData()||J.get("icon-optional")),ve&&(ue||!u.hasTextData()||J.get("text-optional")),!0);!u.collisionArrays&&E&&(u.hasIconCollisionBoxData()||u.hasTextCollisionBoxData())&&u.deserializeCollisionBoxes(E);const Ge=(Ke,tt,ct)=>{for(let st=0;st<tt/4;st++)Ke.opacityVertexArray.emplaceBack(ct)};let et=0;F&&u.updateReplacement(W,F);for(let Ke=0;Ke<u.symbolInstances.length;Ke++){const tt=u.symbolInstances.get(Ke),{numHorizontalGlyphVertices:ct,numVerticalGlyphVertices:st,crossTileID:rt,numIconVertices:xt,tileAnchorX:Ft,tileAnchorY:Zt}=tt;let kt=null;if(tt&&De){const xn=this.retainedQueryData[u.bucketInstanceId];kt=w.latestFeatureIndex.loadFeature({featureIndex:tt.featureIndex,bucketIndex:xn.bucketIndex,sourceLayerIndex:xn.sourceLayerIndex,layoutVertexArrayOffset:0})}const hn=ke.evaluate(kt,{}),bt=p.has(rt);let Wt=this.opacities[rt];bt?Wt=le:Wt||(Wt=je,this.opacities[rt]=Wt),p.add(rt);const Vt=ct>0||st>0,fn=xt>0,pn=this.placedOrientations[rt],qt=pn===o.bk.vertical,en=pn===o.bk.horizontal||pn===o.bk.horizontalOnly;!Vt&&!fn||Wt.isHidden()||et++;let er=!1;if((Vt||fn)&&F)for(const xn of u.activeReplacements){if(o.br(xn,P,o.bs.Symbol,$)||xn.min.x>Ft||Ft>xn.max.x||xn.min.y>Zt||Zt>xn.max.y)continue;const Dn=o.bt(Ft,Zt,W.canonical,xn.footprintTileId.canonical);if(er=o.bu(Dn,xn.footprint),er)break}if(Vt){const xn=er?pu:Gu(Wt.text);Ge(u.text,ct,qt?pu:xn),Ge(u.text,st,en?pu:xn);const Dn=Wt.text.isHidden(),{leftJustifiedTextSymbolIndex:yr,centerJustifiedTextSymbolIndex:qn,rightJustifiedTextSymbolIndex:ur,verticalPlacedTextSymbolIndex:Ur}=tt,Br=u.text.placedSymbolArray,Mi=Dn||qt?1:0;yr>=0&&(Br.get(yr).hidden=Mi),qn>=0&&(Br.get(qn).hidden=Mi),ur>=0&&(Br.get(ur).hidden=Mi),Ur>=0&&(Br.get(Ur).hidden=Dn||en?1:0);const Ni=this.variableOffsets[rt];Ni&&this.markUsedJustification(u,Ni.anchor,tt,pn);const ns=this.placedOrientations[rt];ns&&(this.markUsedJustification(u,"left",tt,ns),this.markUsedOrientation(u,ns,tt))}if(fn){const xn=er?pu:Gu(Wt.icon),{placedIconSymbolIndex:Dn,verticalPlacedIconSymbolIndex:yr}=tt,qn=u.icon.placedSymbolArray,ur=Wt.icon.isHidden()?1:0;Dn>=0&&(Ge(u.icon,xt,qt?pu:xn),qn.get(Dn).hidden=ur),yr>=0&&(Ge(u.icon,tt.numVerticalIconVertices,en?pu:xn),qn.get(yr).hidden=ur)}if(u.hasIconCollisionBoxData()||u.hasTextCollisionBoxData()){const xn=u.collisionArrays[Ke];if(xn){let Dn=new o.P(0,0),yr=!0;if(xn.textBox||xn.verticalTextBox){if(_e){const ur=this.variableOffsets[rt];ur?(Dn=Pa(ur.anchor,ur.width,ur.height,ur.textOffset,ur.textScale),be&&Dn._rotate(we?this.transform.angle:-this.transform.angle)):yr=!1}oe&&(yr=!Wt.clipped),xn.textBox&&Tp(u.textCollisionBox.collisionVertexArray,Wt.text.placed,!yr||qt,hn,Ne,Dn.x,Dn.y),xn.verticalTextBox&&Tp(u.textCollisionBox.collisionVertexArray,Wt.text.placed,!yr||en,hn,Ne,Dn.x,Dn.y)}const qn=yr&&!!(!en&&xn.verticalIconBox);xn.iconBox&&Tp(u.iconCollisionBox.collisionVertexArray,Wt.icon.placed,qn,hn,Ne,tt.hasIconTextFit?Dn.x:0,tt.hasIconTextFit?Dn.y:0),xn.verticalIconBox&&Tp(u.iconCollisionBox.collisionVertexArray,Wt.icon.placed,!qn,hn,Ne,tt.hasIconTextFit?Dn.x:0,tt.hasIconTextFit?Dn.y:0)}}}if(u.fullyClipped=et===0,u.sortFeatures(this.transform.angle),this.retainedQueryData[u.bucketInstanceId]&&(this.retainedQueryData[u.bucketInstanceId].featureSortOrder=u.featureSortOrder),u.hasTextData()&&u.text.opacityVertexBuffer&&u.text.opacityVertexBuffer.updateData(u.text.opacityVertexArray),u.hasIconData()&&u.icon.opacityVertexBuffer&&u.icon.opacityVertexBuffer.updateData(u.icon.opacityVertexArray),u.hasIconCollisionBoxData()&&u.iconCollisionBox.collisionVertexBuffer&&u.iconCollisionBox.collisionVertexBuffer.updateData(u.iconCollisionBox.collisionVertexArray),u.hasTextCollisionBoxData()&&u.textCollisionBox.collisionVertexBuffer&&u.textCollisionBox.collisionVertexBuffer.updateData(u.textCollisionBox.collisionVertexArray),u.bucketInstanceId in this.collisionCircleArrays){const Ke=this.collisionCircleArrays[u.bucketInstanceId];u.placementInvProjMatrix=Ke.invProjMatrix,u.placementViewportMatrix=Ke.viewportMatrix,u.collisionCircleArray=Ke.circles,delete this.collisionCircleArrays[u.bucketInstanceId]}}symbolFadeChange(u){return this.fadeDuration===0?1:(u-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(u){return Math.max(0,(this.transform.zoom-u)/1.5)}hasTransitions(u){return this.stale||u-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(u,p){const w=this.zoomAtLastRecencyCheck===p?1-this.zoomAdjustment(p):1;return this.zoomAtLastRecencyCheck=p,this.commitTime+this.fadeDuration*w>u}setStale(){this.stale=!0}}function Tp(b,u,p,w,E,P,F){b.emplaceBack(u?1:0,p?1:0,P||0,F||0,w,E?1:0),b.emplaceBack(u?1:0,p?1:0,P||0,F||0,w,E?1:0),b.emplaceBack(u?1:0,p?1:0,P||0,F||0,w,E?1:0),b.emplaceBack(u?1:0,p?1:0,P||0,F||0,w,E?1:0)}const sa=Math.pow(2,25),Vu=Math.pow(2,24),Mp=Math.pow(2,17),La=Math.pow(2,16),og=Math.pow(2,9),Cp=Math.pow(2,8),Dv=Math.pow(2,1);function Gu(b){if(b.opacity===0&&!b.placed)return 0;if(b.opacity===1&&b.placed)return 4294967295;const u=b.placed?1:0,p=Math.floor(127*b.opacity);return p*sa+u*Vu+p*Mp+u*La+p*og+u*Cp+p*Dv+u}const pu=0;class Sx{constructor(u){this._sortAcrossTiles=u.layout.get("symbol-z-order")!=="viewport-y"&&u.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(u,p,w,E,P){const F=this._bucketParts;for(;this._currentTileIndex<u.length;)if(p.getBucketParts(F,E,u[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,P())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,F.sort((W,$)=>W.sortKey-$.sortKey));this._currentPartIndex<F.length;){const W=F[this._currentPartIndex];if(p.placeLayerBucketPart(W,this._seenCrossTileIDs,w,W.symbolInstanceStart===0),this._currentPartIndex++,P())return!0}return!1}}class hd{constructor(u,p,w,E,P,F,W,$,J){this.placement=new du(u,P,F,W,$,J),this._currentPlacementIndex=p.length-1,this._forceFullPlacement=w,this._showCollisionBoxes=E,this._done=!1}isDone(){return this._done}continuePlacement(u,p,w,E){const P=o.q.now(),F=()=>{const W=o.q.now()-P;return!this._forceFullPlacement&&W>2};for(;this._currentPlacementIndex>=0;){const W=p[u[this._currentPlacementIndex]],$=this.placement.collisionIndex.transform.zoom;if(W.type==="symbol"&&(!W.minzoom||W.minzoom<=$)&&(!W.maxzoom||W.maxzoom>$)){const J=W,Q=J.layout.get("symbol-z-elevate"),oe=J.layout.get("symbol-sort-key").constantOr(1)!==void 0,le=J.layout.get("symbol-z-order"),ue=le==="viewport-y"||le==="auto"&&!(le!=="viewport-y"&&oe),ve=J.layout.get("text-allow-overlap")||J.layout.get("icon-allow-overlap")||J.layout.get("text-ignore-placement")||J.layout.get("icon-ignore-placement"),_e=ue&&ve,be=this._inProgressLayer=this._inProgressLayer||new Sx(J),we=o.av(W.source,W.scope);if(be.continuePlacement(Q||_e?E[we]:w[we],this.placement,this._showCollisionBoxes,W,F))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(u){return this.placement.commit(u),this.placement}}const Hu=512/o.ab/2;class Bv{constructor(u,p,w){this.tileID=u,this.bucketInstanceId=w,this.index=new o.by(p.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const E=u.canonical.x*o.ab,P=u.canonical.y*o.ab;for(let F=0;F<p.length;F++){const{key:W,crossTileID:$,tileAnchorX:J,tileAnchorY:Q}=p.get(F),oe=Math.floor((E+J)*Hu),le=Math.floor((P+Q)*Hu);this.index.add(oe,le),this.keys.push(W),this.crossTileIDs.push($)}this.index.finish()}findMatches(u,p,w){const E=this.tileID.canonical.z<p.canonical.z?1:Math.pow(2,this.tileID.canonical.z-p.canonical.z),P=Hu/Math.pow(2,p.canonical.z-this.tileID.canonical.z),F=p.canonical.x*o.ab,W=p.canonical.y*o.ab;for(let $=0;$<u.length;$++){const J=u.get($);if(J.crossTileID)continue;const{key:Q,tileAnchorX:oe,tileAnchorY:le}=J,ue=Math.floor((F+oe)*P),ve=Math.floor((W+le)*P),_e=this.index.range(ue-E,ve-E,ue+E,ve+E);for(const be of _e){const we=this.crossTileIDs[be];if(this.keys[be]===Q&&!w.has(we)){w.add(we),J.crossTileID=we;break}}}}}class Jl{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Vh{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(u){const p=Math.round((u-this.lng)/360);if(p!==0)for(const w in this.indexes){const E=this.indexes[w],P={};for(const F in E){const W=E[F];W.tileID=W.tileID.unwrapTo(W.tileID.wrap+p),P[W.tileID.key]=W}this.indexes[w]=P}this.lng=u}addBucket(u,p,w){if(this.indexes[u.overscaledZ]&&this.indexes[u.overscaledZ][u.key]){if(this.indexes[u.overscaledZ][u.key].bucketInstanceId===p.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(u.overscaledZ,this.indexes[u.overscaledZ][u.key])}for(let P=0;P<p.symbolInstances.length;P++)p.symbolInstances.get(P).crossTileID=0;this.usedCrossTileIDs[u.overscaledZ]||(this.usedCrossTileIDs[u.overscaledZ]=new Set);const E=this.usedCrossTileIDs[u.overscaledZ];for(const P in this.indexes){const F=this.indexes[P];if(Number(P)>u.overscaledZ)for(const W in F){const $=F[W];$.tileID.isChildOf(u)&&$.findMatches(p.symbolInstances,u,E)}else{const W=F[u.scaledTo(Number(P)).key];W&&W.findMatches(p.symbolInstances,u,E)}}for(let P=0;P<p.symbolInstances.length;P++){const F=p.symbolInstances.get(P);F.crossTileID||(F.crossTileID=w.generate(),E.add(F.crossTileID))}return this.indexes[u.overscaledZ]===void 0&&(this.indexes[u.overscaledZ]={}),this.indexes[u.overscaledZ][u.key]=new Bv(u,p.symbolInstances,p.bucketInstanceId),!0}removeBucketCrossTileIDs(u,p){for(const w of p.crossTileIDs)this.usedCrossTileIDs[u].delete(w)}removeStaleBuckets(u){let p=!1;for(const w in this.indexes){const E=this.indexes[w];for(const P in E)u[E[P].bucketInstanceId]||(this.removeBucketCrossTileIDs(w,E[P]),delete E[P],p=!0)}return p}}class Gh{constructor(){this.layerIndexes={},this.crossTileIDs=new Jl,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(u,p,w,E){let P=this.layerIndexes[u.fqid];P===void 0&&(P=this.layerIndexes[u.fqid]=new Vh);let F=!1;const W={};E.name!=="globe"&&P.handleWrapJump(w);for(const $ of p){const J=$.getBucket(u);J&&u.fqid===J.layerIds[0]&&(J.bucketInstanceId||(J.bucketInstanceId=++this.maxBucketInstanceId),P.addBucket($.tileID,J,this.crossTileIDs)&&(F=!0),W[J.bucketInstanceId]=!0)}return P.removeStaleBuckets(W)&&(F=!0),F}pruneUnusedLayers(u){const p={};u.forEach(w=>{p[w]=!0});for(const w in this.layerIndexes)p[w]||delete this.layerIndexes[w]}}const va=771;class Mr{constructor(u,p,w,E){this.blendFunction=u,this.blendColor=p,this.mask=w,this.blendEquation=E}}Mr.Replace=[1,0,1,0],Mr.disabled=new Mr(Mr.Replace,o.bz.transparent,[!1,!1,!1,!1]),Mr.unblended=new Mr(Mr.Replace,o.bz.transparent,[!0,!0,!0,!0]),Mr.alphaBlended=new Mr([1,va,1,va],o.bz.transparent,[!0,!0,!0,!0]),Mr.alphaBlendedNonPremultiplied=new Mr([770,va,770,va],o.bz.transparent,[!0,!0,!0,!0]),Mr.multiply=new Mr([774,0,774,0],o.bz.transparent,[!0,!0,!0,!0]);class $n{constructor(u,p,w){this.func=u,this.mask=p,this.range=w}}$n.ReadOnly=!1,$n.ReadWrite=!0,$n.disabled=new $n(519,$n.ReadOnly,[0,1]);const mu=7680;class pr{constructor(u,p,w,E,P,F){this.test=u,this.ref=p,this.mask=w,this.fail=E,this.depthFail=P,this.pass=F}}pr.disabled=new pr({func:519,mask:0},0,0,mu,mu,mu);const Ql=1029,ec=2305;class _r{constructor(u,p,w){this.enable=u,this.mode=p,this.frontFace=w}}function Ep(b,u){const p=o.bC(b,3);o.a6.mat4.fromQuat(b,u),o.bE(b,3,p)}function fd(b,u){const p=o.a6.quat.identity([]);return o.a6.quat.rotateZ(p,p,-u),o.a6.quat.rotateX(p,p,-b),p}function Da(b,u){const p=[b[0],b[1],0],w=[u[0],u[1],0];if(o.a6.vec3.length(p)>=1e-15){const F=o.a6.vec3.normalize([],p);o.a6.vec3.scale(w,F,o.a6.vec3.dot(w,F)),u[0]=w[0],u[1]=w[1]}const E=o.a6.vec3.cross([],u,b);if(o.a6.vec3.len(E)<1e-15)return null;const P=Math.atan2(-E[1],E[0]);return fd(Math.atan2(Math.sqrt(b[0]*b[0]+b[1]*b[1]),-b[2]),P)}_r.disabled=new _r(!1,Ql,ec),_r.backCCW=new _r(!0,Ql,ec),_r.backCW=new _r(!0,Ql,2304),_r.frontCW=new _r(!0,1028,2304),_r.frontCCW=new _r(!0,1028,ec);class yo{constructor(u,p){this.position=u,this.orientation=p}get position(){return this._position}set position(u){if(u){const p=u instanceof o.a5?u:new o.a5(u[0],u[1],u[2]);this._renderWorldCopies&&(p.x=o.bA(p.x,0,1)),this._position=p}else this._position=null}lookAtPoint(u,p){if(this.orientation=null,!this.position)return;const w=this.position,E=this._elevation?this._elevation.getAtPointOrZero(o.a5.fromLngLat(u)):0,P=o.a5.fromLngLat(u,E),F=[P.x-w.x,P.y-w.y,P.z-w.z];p||(p=[0,0,1]),p[2]=Math.abs(p[2]),this.orientation=Da(F,p)}setPitchBearing(u,p){this.orientation=fd(o.bB(u),o.bB(-p))}}class es{constructor(u,p){this._transform=o.a6.mat4.identity([]),this.orientation=p,this.position=u}get mercatorPosition(){const u=this.position;return new o.a5(u[0],u[1],u[2])}get position(){const u=o.bC(this._transform,3);return[u[0],u[1],u[2]]}set position(u){var p;u&&o.bE(this._transform,3,[(p=u)[0],p[1],p[2],1])}get orientation(){return this._orientation}set orientation(u){this._orientation=u||o.a6.quat.identity([]),u&&Ep(this._transform,this._orientation)}getPitchBearing(){const u=this.forward(),p=this.right();return{bearing:Math.atan2(-p[1],p[0]),pitch:Math.atan2(Math.sqrt(u[0]*u[0]+u[1]*u[1]),-u[2])}}setPitchBearing(u,p){this._orientation=fd(u,p),Ep(this._transform,this._orientation)}forward(){const u=o.bC(this._transform,2);return[-u[0],-u[1],-u[2]]}up(){const u=o.bC(this._transform,1);return[-u[0],-u[1],-u[2]]}right(){const u=o.bC(this._transform,0);return[u[0],u[1],u[2]]}getCameraToWorld(u,p){const w=new Float64Array(16);return o.a6.mat4.invert(w,this.getWorldToCamera(u,p)),w}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(u,p,w){const E=this.position;o.a6.vec3.scale(E,E,-u);const P=new Float64Array(16);return o.a6.mat4.fromScaling(P,[w,w,w]),o.a6.mat4.translate(P,P,E),P[10]*=p,P}getWorldToCamera(u,p){const w=new Float64Array(16),E=new Float64Array(4),P=this.position;return o.a6.quat.conjugate(E,this._orientation),o.a6.vec3.scale(P,P,-u),o.a6.mat4.fromQuat(w,E),o.a6.mat4.translate(w,w,P),w[1]*=-1,w[5]*=-1,w[9]*=-1,w[13]*=-1,w[8]*=p,w[9]*=p,w[10]*=p,w[11]*=p,w}getCameraToClipPerspective(u,p,w,E){const P=new Float64Array(16);return o.a6.mat4.perspective(P,u,p,w,E),P}getCameraToClipOrthographic(u,p,w,E,P,F){const W=new Float64Array(16);return o.a6.mat4.ortho(W,u,p,w,E,P,F),W}getDistanceToElevation(u,p=!1){const w=u===0?0:o.bD(u,p?o.aM(this.position[1]):this.position[1]),E=this.forward();return(w-this.position[2])/E[2]}clone(){return new es([...this.position],[...this.orientation])}}const oo={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class qa{constructor(u=0,p=0,w=0,E=0){if(isNaN(u)||u<0||isNaN(p)||p<0||isNaN(w)||w<0||isNaN(E)||E<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=u,this.bottom=p,this.left=w,this.right=E}interpolate(u,p,w){return p.top!=null&&u.top!=null&&(this.top=o.aa(u.top,p.top,w)),p.bottom!=null&&u.bottom!=null&&(this.bottom=o.aa(u.bottom,p.bottom,w)),p.left!=null&&u.left!=null&&(this.left=o.aa(u.left,p.left,w)),p.right!=null&&u.right!=null&&(this.right=o.aa(u.right,p.right,w)),this}getCenter(u,p){const w=o.ap((this.left+u-this.right)/2,0,u),E=o.ap((this.top+p-this.bottom)/2,0,p);return new o.P(w,E)}equals(u){return this.top===u.top&&this.bottom===u.bottom&&this.left===u.left&&this.right===u.right}clone(){return new qa(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Hh=(b,u,p)=>(1-p)*b+p*u,jh=b=>b*b*b*b*b;class dd{constructor(u,p,w,E,P,F,W){this.tileSize=512,this._renderWorldCopies=P===void 0||P,this._minZoom=u||0,this._maxZoom=p||22,this._minPitch=w??0,this._maxPitch=E??60,this.setProjection(F),this.setMaxBounds(W),this.width=0,this.height=0,this._center=new o.bK(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new qa,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new es,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const u=new dd(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return u._elevation=this._elevation,u._centerAltitude=this._centerAltitude,u._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,u.tileSize=this.tileSize,u.mercatorFromTransition=this.mercatorFromTransition,u.width=this.width,u.height=this.height,u.cameraElevationReference=this.cameraElevationReference,u._center=this._center,u._setZoom(this.zoom),u._seaLevelZoom=this._seaLevelZoom,u.angle=this.angle,u._fov=this._fov,u._pitch=this._pitch,u._nearZ=this._nearZ,u._farZ=this._farZ,u._averageElevation=this._averageElevation,u._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,u._unmodified=this._unmodified,u._edgeInsets=this._edgeInsets.clone(),u._camera=this._camera.clone(),u._calcMatrices(),u.freezeTileCoverage=this.freezeTileCoverage,u.frustumCorners=this.frustumCorners,u}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(u){this._elevation!==u&&(this._elevation=u,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(u,p=!1){const w=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||w)&&this._updateCameraOnTerrain(),(u||w)&&this._constrainCamera(p),this._calcMatrices()}getProjection(){return o.ar(this.projection,["name","center","parallels"])}setProjection(u){this.projectionOptions=u||{name:"mercator"};const p=this.projection?this.getProjection():void 0;this.projection=o.bL(this.projectionOptions);const w=this.getProjection(),E=!o.bh(p,w);return E&&this._calcMatrices(),this.mercatorFromTransition=!1,E}setOrthographicProjectionAtLowPitch(u){return this._orthographicProjectionAtLowPitch!==u&&(this._orthographicProjectionAtLowPitch=u,this._calcMatrices(),!0)}setMercatorFromTransition(){const u=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=o.bL({name:"mercator"});const p=u!==this.projection.name;return p&&this._calcMatrices(),p}get minZoom(){return this._minZoom}set minZoom(u){this._minZoom!==u&&(this._minZoom=u,this.zoom=Math.max(this.zoom,u))}get maxZoom(){return this._maxZoom}set maxZoom(u){this._maxZoom!==u&&(this._maxZoom=u,this.zoom=Math.min(this.zoom,u))}get minPitch(){return this._minPitch}set minPitch(u){this._minPitch!==u&&(this._minPitch=u,this.pitch=Math.max(this.pitch,u))}get maxPitch(){return this._maxPitch}set maxPitch(u){this._maxPitch!==u&&(this._maxPitch=u,this.pitch=Math.min(this.pitch,u))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(u){u===void 0?u=!0:u===null&&(u=!1),this._renderWorldCopies=u}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const u=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(u))}get cameraWorldSize(){const u=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(u))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.bD(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this.width,this.height)}get bearing(){return o.bA(this.rotation,-180,180)}set bearing(u){this.rotation=u}get rotation(){return-this.angle/Math.PI*180}set rotation(u){const p=-u*Math.PI/180;this.angle!==p&&(this._unmodified=!1,this.angle=p,this._calcMatrices(),this.rotationMatrix=o.a6.mat2.create(),o.a6.mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(u){const p=o.ap(u,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==p&&(this._unmodified=!1,this._pitch=p,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const u=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/u)}set fov(u){u=Math.max(.01,Math.min(60,u)),this._fov!==u&&(this._unmodified=!1,this._fov=o.bB(u),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(u){this._averageElevation=u,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(u){const p=Math.min(Math.max(u,this.minZoom),this.maxZoom);this._zoom!==p&&(this._unmodified=!1,this._setZoom(p),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(u){this._zoom=u,this.scale=this.zoomScale(u),this.tileZoom=Math.floor(u),this.zoomFraction=u-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(u){this._tileCoverLift!==u&&(this._tileCoverLift=u)}_updateCameraOnTerrain(){const u=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,p=this.elevation&&u===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||u===Number.NEGATIVE_INFINITY&&(!p||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const w=this._elevation;p||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&w.exaggeration()&&this._centerAltitudeValidForExaggeration!==w.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*w.exaggeration(),this._centerAltitudeValidForExaggeration=w.exaggeration()):(this._centerAltitude=u||0,this._centerAltitudeValidForExaggeration=w.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const u=this._elevation,p=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],w=this.horizonLineFromTop();let E=0,P=0;for(let F=0;F<p.length;F++){const W=new o.P(p[F][0]*this.width,w+p[F][1]*(this.height-w)),$=u.pointCoordinate(W);if(!$)continue;const J=1/Math.hypot($[0]-this._camera.position[0],$[1]-this._camera.position[1]);E+=$[3]*J,P+=J}return P===0?NaN:E/P}get center(){return this._center}set center(u){u.lat===this._center.lat&&u.lng===this._center.lng||(this._unmodified=!1,this._center=u,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const u=this._seaLevelZoom,p=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),w=this.pixelsPerMeter/this.worldSize*p,E=this._mercatorZfromZoom(u),P=this._mercatorZfromZoom(this._maxZoom),F=Math.max(E-w,P);this._setZoom(this._zoomFromMercatorZ(F))}get padding(){return this._edgeInsets.toJSON()}set padding(u){this._edgeInsets.equals(u)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,u,1),this._calcMatrices())}computeZoomRelativeTo(u){const p=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,u.toAltitude()));let w;w=u.z<this._camera.position[2]?[p.x,p.y,p.z]:[u.x,u.y,u.z];const E=o.a6.vec3.length(o.a6.vec3.sub([],this._camera.position,w));return o.ap(this._zoomFromMercatorZ(E),this._minZoom,this._maxZoom)}setFreeCameraOptions(u){if(!this.height||!u.position&&!u.orientation)return;this._updateCameraState();let p=!1;if(u.orientation&&!o.a6.quat.exactEquals(u.orientation,this._camera.orientation)&&(p=this._setCameraOrientation(u.orientation)),u.position){const w=[u.position.x,u.position.y,u.position.z];o.a6.vec3.exactEquals(w,this._camera.position)||(this._setCameraPosition(w),p=!0)}p&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const u=this._camera.position,p=new yo;return p.position=new o.a5(u[0],u[1],u[2]),p.orientation=this._camera.orientation,p._elevation=this.elevation,p._renderWorldCopies=this.renderWorldCopies,p}_setCameraOrientation(u){if(!o.a6.quat.length(u))return!1;o.a6.quat.normalize(u,u);const p=o.a6.vec3.transformQuat([],[0,0,-1],u),w=o.a6.vec3.transformQuat([],[0,-1,0],u);if(w[2]<0)return!1;const E=Da(p,w);return!!E&&(this._camera.orientation=E,!0)}_setCameraPosition(u){const p=this.zoomScale(this.minZoom)*this.tileSize,w=this.zoomScale(this.maxZoom)*this.tileSize,E=this.cameraToCenterDistance;u[2]=o.ap(u[2],E/w,E/p),this._camera.position=u}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(u){return this._edgeInsets.equals(u)}interpolatePadding(u,p,w){this._unmodified=!1,this._edgeInsets.interpolate(u,p,w),this._constrain(),this._calcMatrices()}coveringZoomLevel(u){const p=(u.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/u.tileSize));return Math.max(0,p)}getVisibleUnwrappedCoordinates(u){const p=[new o.bM(0,u)];if(this.renderWorldCopies){const w=this.pointCoordinate(new o.P(0,0)),E=this.pointCoordinate(new o.P(this.width,0)),P=this.pointCoordinate(new o.P(this.width,this.height)),F=this.pointCoordinate(new o.P(0,this.height)),W=Math.floor(Math.min(w.x,E.x,P.x,F.x)),$=Math.floor(Math.max(w.x,E.x,P.x,F.x)),J=1;for(let Q=W-J;Q<=$+J;Q++)Q!==0&&p.push(new o.bM(Q,u))}return p}isLODDisabled(u){return(!u||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(u,p,w){let E=[];const P=w!==void 0,F=!P;if(F&&this.zoom<p||P&&w[0]===0&&w[1]===0)return E;const W=new Set,$=(Q,oe,le,ue,ve)=>{const _e=o.c1(oe,Q,le,ue,ve);W.has(_e)||(E.push(new o.aA(Q,oe,le,ue,ve)),W.add(_e))};for(let Q=0;Q<u.length;Q++){const oe=u[Q];if(F&&oe.canonical.z!==p)continue;const le=oe.canonical,ue=oe.overscaledZ,ve=oe.wrap,_e=1<<le.z,be=le.x+1<_e,we=le.x>0,ke=le.y+1<_e,Ne=le.y>0,De=oe.wrap-(we?0:1),je=oe.wrap+(be?0:1),Ge=we?le.x-1:_e-1,et=be?le.x+1:0;if(P)w[0]<0?($(ue,je,le.z,et,le.y),w[1]<0&&ke&&($(ue,ve,le.z,le.x,le.y+1),$(ue,je,le.z,et,le.y+1)),w[1]>0&&Ne&&($(ue,ve,le.z,le.x,le.y-1),$(ue,je,le.z,et,le.y-1))):w[0]>0?($(ue,De,le.z,Ge,le.y),w[1]<0&&ke&&($(ue,ve,le.z,le.x,le.y+1),$(ue,De,le.z,Ge,le.y+1)),w[1]>0&&Ne&&($(ue,ve,le.z,le.x,le.y-1),$(ue,De,le.z,Ge,le.y-1))):w[1]<0&&ke?$(ue,ve,le.z,le.x,le.y+1):Ne&&$(ue,ve,le.z,le.x,le.y-1);else{const Ke=oe.visibleQuadrants;1&Ke&&($(ue,De,le.z,Ge,le.y),Ne&&($(ue,ve,le.z,le.x,le.y-1),$(ue,De,le.z,Ge,le.y-1))),2&Ke&&($(ue,je,le.z,et,le.y),Ne&&($(ue,ve,le.z,le.x,le.y-1),$(ue,je,le.z,et,le.y-1))),4&Ke&&($(ue,De,le.z,Ge,le.y),ke&&($(ue,ve,le.z,le.x,le.y+1),$(ue,De,le.z,Ge,le.y+1))),8&Ke&&($(ue,je,le.z,et,le.y),ke&&($(ue,ve,le.z,le.x,le.y+1),$(ue,je,le.z,et,le.y+1)))}}const J=[];for(const Q of E)E.some(oe=>Q.isChildOf(oe))||J.push(Q);if(E=J.filter(Q=>!u.some(oe=>!!(Q.overscaledZ<p&&oe.isChildOf(Q))||Q.equals(oe)||Q.isChildOf(oe))),F){const Q=1<<p,oe=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),le=[Q*oe.x,Q*oe.y],ue=4,ve=ue*ue;E=E.filter(_e=>{const be=_e.canonical.x+.5-le[0],we=_e.canonical.y+.5-le[1];return be*be+we*we<ve})}return E}coveringTiles(u){let p=this.coveringZoomLevel(u);const w=p,E=this.elevation&&this.elevation.exaggeration(),P=E&&!u.isTerrainDEM,F=this.projection.name==="mercator";if(u.minzoom!==void 0&&p<u.minzoom)return[];u.maxzoom!==void 0&&p>u.maxzoom&&(p=u.maxzoom);const W=this.locationCoordinate(this.center),$=this.center.lat,J=1<<p,Q=[J*W.x,J*W.y,0],oe=this.projection.name==="globe",le=!oe,ue=o.bN.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,p,le),ve=oe?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),_e=J*o.bD(1,this.center.lat),be=this._camera.position[2]/o.bD(1,this.center.lat),we=[J*ve.x,J*ve.y,be*(le?1:_e)],ke=oe||E,Ne=this.cameraToCenterDistance/u.tileSize*(u.roundZoom?1:.502),De=this.isLODDisabled(!0)?p:0;let je;if(this._elevation&&u.isTerrainDEM)je=1e4*this._elevation.exaggeration();else if(this._elevation){const bt=this._elevation.getMinMaxForVisibleTiles();je=bt?bt.max:this._centerAltitude}else je=this._centerAltitude;const Ge=u.isTerrainDEM?-je:this._elevation?this._elevation.getMinElevationBelowMSL():0,et=this.projection.isReprojectedInTileSpace?o.bO(this):1,Ke=bt=>{const Vt=new o.a5(bt.x+25e-6,bt.y,bt.z),fn=new o.a5(bt.x,bt.y+25e-6,bt.z),pn=bt.toLngLat(),qt=Vt.toLngLat(),en=fn.toLngLat(),er=this.locationCoordinate(pn),xn=this.locationCoordinate(qt),Dn=this.locationCoordinate(en),yr=Math.hypot(xn.x-er.x,xn.y-er.y),qn=Math.hypot(Dn.x-er.x,Dn.y-er.y);return Math.sqrt(yr*qn)*et/25e-6},tt=bt=>{const Wt=je,Vt=Ge;return{aabb:o.bR(this,J,0,0,0,bt,Vt,Wt,this.projection),zoom:0,x:0,y:0,minZ:Vt,maxZ:Wt,wrap:bt,fullyVisible:!1}},ct=[];let st=[];const rt=p,xt=u.reparseOverscaled?w:p,Ft=(be-this._centerAltitude)*_e,Zt=bt=>{if(!this._elevation||!bt.tileID||!F)return;const Wt=this._elevation.getMinMaxForTile(bt.tileID),Vt=bt.aabb;Wt?(Vt.min[2]=Wt.min,Vt.max[2]=Wt.max,Vt.center[2]=(Vt.min[2]+Vt.max[2])/2):(bt.shouldSplit=hn(bt),bt.shouldSplit||(Vt.min[2]=Vt.max[2]=Vt.center[2]=this._centerAltitude))},kt=(bt,Wt)=>{if(.707*Wt<bt)return 1;const Vt=Wt/bt;return Vt/(1.4144271570014144+(Math.pow(1.1,Vt-1.4144271570014144+1)-1)/(1.1-1)-1)},hn=bt=>{if(bt.zoom<De)return!0;if(bt.zoom===rt)return!1;if(bt.shouldSplit!=null)return bt.shouldSplit;const Wt=bt.aabb.distanceX(we),Vt=bt.aabb.distanceY(we);let fn=Ft,pn=1;if(oe){fn=bt.aabb.distanceZ(we);const qn=Math.pow(2,bt.zoom),ur=o.aM((bt.y+1)/qn),Ur=o.aM(bt.y/qn),Br=Math.min(Math.max($,ur),Ur),Mi=o.c5(Br)/o.c5($);if(pn=Br===$?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Mi/this._mercatorScaleRatio),this.zoom<=o.c2&&bt.zoom===rt-1&&Mi>=.9)return!0}else if(P&&(fn=bt.aabb.distanceZ(we)*_e),this.projection.isReprojectedInTileSpace&&w<=5){const qn=Math.pow(2,bt.zoom),ur=Ke(new o.a5((bt.x+.5)/qn,(bt.y+.5)/qn));pn=ur>.85?1:ur}if(!F){const qn=Math.sqrt(Wt*Wt+Vt*Vt+fn*fn);let ur=(1<<rt-bt.zoom)*Ne*pn;return ur*=kt(Math.max(fn,Ft),qn),qn<ur}let qt=Number.MAX_VALUE,en=0;const er=bt.aabb.getCorners(),xn=[];for(const qn of er){o.a6.vec3.sub(xn,qn,we),oe||(P?xn[2]*=_e:xn[2]=Ft);const ur=o.a6.vec3.dot(xn,this._camera.forward());ur<qt&&(qt=ur,en=Math.abs(xn[2]))}let Dn=(1<<rt-bt.zoom)*Ne*pn;if(Dn*=kt(Math.max(en,Ft),qt),qt<Dn)return!0;const yr=bt.aabb.closestPoint(Q);return yr[0]===Q[0]&&yr[1]===Q[1]};if(this.renderWorldCopies)for(let bt=1;bt<=3;bt++)ct.push(tt(-bt)),ct.push(tt(bt));for(ct.push(tt(0));ct.length>0;){const bt=ct.pop(),Wt=bt.x,Vt=bt.y;let fn=bt.fullyVisible;const pn=()=>this.projection.name==="globe"&&(bt.y===0||bt.y===(1<<bt.zoom)-1);if(!fn){let qt=ke?bt.aabb.intersects(ue):bt.aabb.intersectsFlat(ue);if(qt===0&&pn()){const en=new o.bP(bt.zoom,Wt,Vt);qt=o.bQ(this,J,en,!0).intersects(ue)}if(qt===0)continue;fn=qt===2}if(bt.zoom!==rt&&hn(bt))for(let qt=0;qt<4;qt++){const en=(Wt<<1)+qt%2,er=(Vt<<1)+(qt>>1),xn={aabb:F?bt.aabb.quadrant(qt):o.bR(this,J,bt.zoom+1,en,er,bt.wrap,bt.minZ,bt.maxZ,this.projection),zoom:bt.zoom+1,x:en,y:er,wrap:bt.wrap,fullyVisible:fn,tileID:void 0,shouldSplit:void 0,minZ:bt.minZ,maxZ:bt.maxZ};P&&!oe&&(xn.tileID=new o.aA(bt.zoom+1===rt?xt:bt.zoom+1,bt.wrap,bt.zoom+1,en,er),Zt(xn)),ct.push(xn)}else{const qt=bt.zoom===rt?xt:bt.zoom;if(u.minzoom&&u.minzoom>qt)continue;let en=0;if(!fn){let yr=ke?bt.aabb.intersectsPrecise(ue):bt.aabb.intersectsPreciseFlat(ue);if(yr===0&&pn()){const qn=new o.bP(bt.zoom,Wt,Vt);yr=o.bQ(this,J,qn,!0).intersectsPrecise(ue)}if(yr===0)continue;if(u.calculateQuadrantVisibility)if(ue.containsPoint(bt.aabb.center))en=15;else for(let qn=0;qn<4;qn++)bt.aabb.quadrant(qn).intersects(ue)!==0&&(en|=1<<qn)}const er=Q[0]-(.5+Wt+(bt.wrap<<bt.zoom))*(1<<p-bt.zoom),xn=Q[1]-.5-Vt,Dn=bt.tileID?bt.tileID:new o.aA(qt,bt.wrap,bt.zoom,Wt,Vt);u.calculateQuadrantVisibility&&(Dn.visibleQuadrants=en),st.push({tileID:Dn,distanceSq:er*er+xn*xn})}}if(this.fogCullDistSq){const bt=this.fogCullDistSq,Wt=this.horizonLineFromTop();st=st.filter(Vt=>{const fn=[0,0,0,1],pn=[o.ab,o.ab,0,1],qt=this.calculateFogTileMatrix(Vt.tileID.toUnwrapped());o.a6.vec4.transformMat4(fn,fn,qt),o.a6.vec4.transformMat4(pn,pn,qt);const en=o.a6.vec4.min([],fn,pn),er=o.a6.vec4.max([],fn,pn),xn=o.bS(en,er);if(xn===0)return!0;let Dn=!1;const yr=this._elevation;if(yr&&xn>bt&&Wt!==0){const qn=this.calculateProjMatrix(Vt.tileID.toUnwrapped());let ur;u.isTerrainDEM||(ur=yr.getMinMaxForTile(Vt.tileID)),ur||(ur={min:Ge,max:je});const Ur=o.c3(this.rotation),Br=[Ur[0]*o.ab,Ur[1]*o.ab,ur.max];o.a6.vec3.transformMat4(Br,Br,qn),Dn=(1-Br[1])*this.height*.5<Wt}return xn<bt||Dn})}return st.sort((bt,Wt)=>bt.distanceSq-Wt.distanceSq).map(bt=>bt.tileID)}resize(u,p){this.width=u,this.height=p,this.pixelsToGLUnits=[2/u,-2/p],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(u){return Math.pow(2,u)}scaleZoom(u){return Math.log(u)/Math.LN2}project(u){const p=o.ap(u.lat,-o.bT,o.bT),w=this.projection.project(u.lng,p);return new o.P(w.x*this.worldSize,w.y*this.worldSize)}unproject(u){return this.projection.unproject(u.x/this.worldSize,u.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/o.bD(1,this.center.lat)/this.worldSize}setLocationAtPoint(u,p){let w,E;const P=this.centerPoint;if(this.projection.name==="globe"){const W=this.worldSize;w=(p.x-P.x)/W,E=(p.y-P.y)/W}else{const W=this.pointCoordinate(p),$=this.pointCoordinate(P);w=W.x-$.x,E=W.y-$.y}const F=this.locationCoordinate(u);this.setLocation(new o.a5(F.x-w,F.y-E))}setLocation(u){this.center=this.coordinateLocation(u),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(u){return this.projection.locationPoint(this,u)}locationPoint3D(u){return this.projection.locationPoint(this,u,!0)}pointLocation(u){return this.coordinateLocation(this.pointCoordinate(u))}pointLocation3D(u){return this.coordinateLocation(this.pointCoordinate3D(u))}locationCoordinate(u,p){const w=p?o.bD(p,u.lat):void 0,E=this.projection.project(u.lng,u.lat);return new o.a5(E.x,E.y,w)}coordinateLocation(u){return this.projection.unproject(u.x,u.y)}pointRayIntersection(u,p){const w=p??this._centerAltitude,E=[u.x,u.y,0,1],P=[u.x,u.y,1,1];o.a6.vec4.transformMat4(E,E,this.pixelMatrixInverse),o.a6.vec4.transformMat4(P,P,this.pixelMatrixInverse);const F=P[3];o.a6.vec4.scale(E,E,1/E[3]),o.a6.vec4.scale(P,P,1/F);const W=E[2],$=P[2];return{p0:E,p1:P,t:W===$?0:(w-W)/($-W)}}screenPointToMercatorRay(u){const p=[u.x,u.y,0,1],w=[u.x,u.y,1,1];return o.a6.vec4.transformMat4(p,p,this.pixelMatrixInverse),o.a6.vec4.transformMat4(w,w,this.pixelMatrixInverse),o.a6.vec4.scale(p,p,1/p[3]),o.a6.vec4.scale(w,w,1/w[3]),p[2]=o.bD(p[2],this._center.lat)*this.worldSize,w[2]=o.bD(w[2],this._center.lat)*this.worldSize,o.a6.vec4.scale(p,p,1/this.worldSize),o.a6.vec4.scale(w,w,1/this.worldSize),new o.aj([p[0],p[1],p[2]],o.a6.vec3.normalize([],o.a6.vec3.sub([],w,p)))}rayIntersectionCoordinate(u){const{p0:p,p1:w,t:E}=u,P=o.bD(p[2],this._center.lat),F=o.bD(w[2],this._center.lat);return new o.a5(o.aa(p[0],w[0],E)/this.worldSize,o.aa(p[1],w[1],E)/this.worldSize,o.aa(P,F,E))}pointCoordinate(u,p=this._centerAltitude){return this.projection.pointCoordinate(this,u.x,u.y,p)}pointCoordinate3D(u){if(!this.elevation)return this.pointCoordinate(u);let p=this.projection.pointCoordinate3D(this,u.x,u.y);if(p)return new o.a5(p[0],p[1],p[2]);let w=0,E=this.horizonLineFromTop();if(u.y>E)return this.pointCoordinate(u);const P=.02*E,F=u.clone();for(let W=0;W<10&&E-w>P;W++){F.y=o.aa(w,E,.66);const $=this.projection.pointCoordinate3D(this,F.x,F.y);$?(E=F.y,p=$):w=F.y}return p?new o.a5(p[0],p[1],p[2]):this.pointCoordinate(u)}isPointAboveHorizon(u){return this.projection.isPointAboveHorizon(this,u)}isPointOnSurface(u){if(u.y<0||u.y>this.height||u.x<0||u.x>this.width)return!1;if(this.elevation||this.zoom>=o.bU)return!this.isPointAboveHorizon(u);const p=this.pointCoordinate(u);return p.y>=0&&p.y<=1}_coordinatePoint(u,p){const w=p&&this.elevation?this.elevation.getAtPointOrZero(u,this._centerAltitude):this._centerAltitude,E=[u.x*this.worldSize,u.y*this.worldSize,w+u.toAltitude(),1];return o.a6.vec4.transformMat4(E,E,this.pixelMatrix),E[3]>0?new o.P(E[0]/E[3],E[1]/E[3]):new o.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:u,left:p}=this._edgeInsets,w=this.height-this._edgeInsets.bottom,E=this.width-this._edgeInsets.right,P=this.pointLocation3D(new o.P(p,u)),F=this.pointLocation3D(new o.P(E,u)),W=this.pointLocation3D(new o.P(E,w)),$=this.pointLocation3D(new o.P(p,w));let J=Math.min(P.lng,F.lng,W.lng,$.lng),Q=Math.max(P.lng,F.lng,W.lng,$.lng),oe=Math.min(P.lat,F.lat,W.lat,$.lat),le=Math.max(P.lat,F.lat,W.lat,$.lat);const ue=Math.pow(2,-this.zoom)/16*270,ve=this.projection.name==="globe"?1:4,_e=(be,we,ke,Ne,De)=>{const je=(be+ke)/2,Ge=(we+Ne)/2,et=new o.P(je,Ge),{lng:Ke,lat:tt}=this.pointLocation3D(et),ct=Math.max(0,J-Ke,oe-tt,Ke-Q,tt-le);J=Math.min(J,Ke),Q=Math.max(Q,Ke),oe=Math.min(oe,tt),le=Math.max(le,tt),(De<ve||ct>ue)&&(_e(be,we,je,Ge,De+1),_e(je,Ge,ke,Ne,De+1))};if(_e(p,u,E,u,1),_e(E,u,E,w,1),_e(E,w,p,w,1),_e(p,w,p,u,1),this.projection.name==="globe"){const[be,we]=o.bV(this);be?(le=90,Q=180,J=-180):we&&(oe=-90,Q=180,J=-180)}return new o.as(new o.bK(J,oe),new o.bK(Q,le))}_getBoundsRectangular(u,p){const{top:w,left:E}=this._edgeInsets,P=this.height-this._edgeInsets.bottom,F=this.width-this._edgeInsets.right,W=new o.P(E,w),$=new o.P(F,w),J=new o.P(F,P),Q=new o.P(E,P);let oe=this.pointCoordinate(W,u),le=this.pointCoordinate($,u);const ue=this.pointCoordinate(J,p),ve=this.pointCoordinate(Q,p),_e=(be,we)=>(we.y-be.y)/(we.x-be.x);return oe.y>1&&le.y>=0?oe=new o.a5((1-ve.y)/_e(ve,oe)+ve.x,1):oe.y<0&&le.y<=1&&(oe=new o.a5(-ve.y/_e(ve,oe)+ve.x,0)),le.y>1&&oe.y>=0?le=new o.a5((1-ue.y)/_e(ue,le)+ue.x,1):le.y<0&&oe.y<=1&&(le=new o.a5(-ue.y/_e(ue,le)+ue.x,0)),new o.as().extend(this.coordinateLocation(oe)).extend(this.coordinateLocation(le)).extend(this.coordinateLocation(ve)).extend(this.coordinateLocation(ue))}_getBoundsRectangularTerrain(){const u=this.elevation;if(!u.visibleDemTiles.length||u.isUsingMockSource())return this._getBoundsRectangular(0,0);const p=u.visibleDemTiles.reduce((w,E)=>{if(E.dem){const P=E.dem.tree;w.min=Math.min(w.min,P.minimums[0]),w.max=Math.max(w.max,P.maximums[0])}return w},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(p.min*u.exaggeration(),p.max*u.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(u=!0){const p=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,w=this.height/2-p*(1-this._horizonShift);return u?Math.max(0,w):w}getMaxBounds(){return this.maxBounds}setMaxBounds(u){this.maxBounds=u,this.minLat=-o.bT,this.maxLat=o.bT,this.minLng=-180,this.maxLng=180,u&&(this.minLat=u.getSouth(),this.maxLat=u.getNorth(),this.minLng=u.getWest(),this.maxLng=u.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.am(this.minLng)*this.tileSize,this.worldMaxX=o.am(this.maxLng)*this.tileSize,this.worldMinY=o.at(this.maxLat)*this.tileSize,this.worldMaxY=o.at(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(u,p){return this.projection.createTileMatrix(this,p,u)}calculateDistanceTileData(u){const p=u.key,w=this._distanceTileDataCache;if(w[p])return w[p];const E=u.canonical,P=1/this.height,F=this.cameraWorldSize,W=F/this.zoomScale(E.z),$=(E.x+Math.pow(2,E.z)*u.wrap)*W,J=E.y*W,Q=this.point;Q.x*=F/this.worldSize,Q.y*=F/this.worldSize;const oe=this.angle,le=Math.sin(-oe),ue=-Math.cos(-oe);return w[p]={bearing:[le,ue],center:[(Q.x-$)*P,(Q.y-J)*P],scale:W/o.ab*P},w[p]}calculateFogTileMatrix(u){const p=u.key,w=this._fogTileMatrixCache;if(w[p])return w[p];const E=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,u);return o.a6.mat4.multiply(E,this.worldToFogMatrix,E),w[p]=new Float32Array(E),w[p]}calculateProjMatrix(u,p=!1,w=!1){const E=u.key;let P;if(P=w?this._expandedProjMatrixCache:p?this._alignedProjMatrixCache:this._projMatrixCache,P[E])return P[E];const F=this.calculatePosMatrix(u,this.worldSize);let W;return W=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:w?this.expandedFarZProjMatrix:p?this.alignedProjMatrix:this.projMatrix,o.a6.mat4.multiply(F,W,F),P[E]=new Float32Array(F),P[E]}calculatePixelsToTileUnitsMatrix(u){const p=u.tileID.key,w=this._pixelsToTileUnitsCache;if(w[p])return w[p];const E=o.bW(u,this);return w[p]=E,w[p]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const u=1/this.worldSize,p=o.a6.mat4.fromScaling([],[u,u,u]);return o.a6.mat4.multiply(p,p,this.globeMatrix),p}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const u=this._elevation;this._updateCameraState();const p=o.bD(1,this._center.lat)*this.worldSize,w=this._computeCameraPosition(p),E=this._camera.forward(),P=o.bD(1,this._center.lat);w[2]/=P,E[2]/=P,o.a6.vec3.normalize(E,E);const F=u.raycast(w,E,u.exaggeration());if(F){const W=o.a6.vec3.scaleAndAdd([],w,E,F),$=new o.a5(W[0],W[1],o.bD(W[2],o.aM(W[1]))),J=($.z+o.a6.vec3.length([$.x-w[0],$.y-w[1],$.z-w[2]*P]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(J),this._centerAltitude=$.toAltitude(),this._center=this.coordinateLocation($),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(u=!1){if(!this._elevation)return;const p=this._elevation,w=o.bD(1,this._center.lat)*this.worldSize,E=this._computeCameraPosition(w),P=p.getAtPointOrZero(new o.a5(...E)),F=this.pixelsPerMeter/this.worldSize*P,W=this._minimumHeightOverTerrain(),$=E[2]-F;if($<=W)if($<0||u){const J=this.locationCoordinate(this._center,this._centerAltitude),Q=[E[0],E[1],J.z-E[2]],oe=o.a6.vec3.length(Q);Q[2]-=(W-$)/this._pixelsPerMercatorPixel;const le=o.a6.vec3.length(Q);if(le===0)return;o.a6.vec3.scale(Q,Q,oe/le*this._pixelsPerMercatorPixel),this._camera.position=[E[0],E[1],J.z*this._pixelsPerMercatorPixel-Q[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const u=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||u){const le=this.center;return le.lat=o.ap(le.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!u)&&(le.lng=o.ap(le.lng,this.minLng,this.maxLng)),this.center=le,void(this._constraining=!1)}const p=this._unmodified,{x:w,y:E}=this.point;let P=0,F=w,W=E;const $=this.width/2,J=this.height/2,Q=this.worldMinY*this.scale,oe=this.worldMaxY*this.scale;if(E-J<Q&&(W=Q+J),E+J>oe&&(W=oe-J),oe-Q<this.height&&(P=Math.max(P,this.height/(oe-Q)),W=(oe+Q)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const le=this.worldMinX*this.scale,ue=this.worldMaxX*this.scale,ve=this.worldSize/2-(le+ue)/2;F=(w+ve+this.worldSize)%this.worldSize-ve,F-$<le&&(F=le+$),F+$>ue&&(F=ue-$),ue-le<this.width&&(P=Math.max(P,this.width/(ue-le)),F=(ue+le)/2)}F===w&&W===E||(this.center=this.unproject(new o.P(F,W))),P&&(this.zoom+=this.scaleZoom(P)),this._constrainCamera(),this._unmodified=p,this._constraining=!1}_minZoomForBounds(){let u=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(u=Math.max(u,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),u}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const u=this.centerOffset,p=this.projection.name==="globe",w=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=o.bD(1,this.center.lat)/o.bD(1,o.c4));const E=o.bX(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,E),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const P=this.projection.zAxisUnit==="meters"?w:1,F=this._camera.getWorldToCamera(this.worldSize,P);let W;const $=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if($[8]=2*-u.x/this.width,$[9]=2*u.y/this.height,this.isOrthographic){let tt=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),ct=tt*this.aspect,st=-ct,rt=-tt;ct-=u.x,st-=u.x,tt+=u.y,rt+=u.y,W=this._camera.getCameraToClipOrthographic(st,ct,rt,tt,this._nearZ,this._farZ),((xt,Ft,Zt,kt)=>{for(let hn=0;hn<16;hn++)xt[hn]=Hh(Ft[hn],Zt[hn],kt)})(W,W,$,jh(this.pitch>=15?1:this.pitch/15))}else W=$;const J=o.a6.mat4.mul([],$,F);let Q=o.a6.mat4.mul([],W,F);if(this.projection.isReprojectedInTileSpace){const tt=this.locationCoordinate(this.center),ct=o.a6.mat4.identity([]);o.a6.mat4.translate(ct,ct,[tt.x*this.worldSize,tt.y*this.worldSize,0]),o.a6.mat4.multiply(ct,ct,o.bY(this)),o.a6.mat4.translate(ct,ct,[-tt.x*this.worldSize,-tt.y*this.worldSize,0]),o.a6.mat4.multiply(Q,Q,ct),o.a6.mat4.multiply(J,J,ct),this.inverseAdjustmentMatrix=o.bZ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=o.a6.mat4.scale([],Q,[this.worldSize,this.worldSize,this.worldSize/P,1]),this.projMatrix=Q,this.invProjMatrix=o.a6.mat4.invert(new Float64Array(16),this.projMatrix),p){const tt=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);tt[8]=2*-u.x/this.width,tt[9]=2*u.y/this.height,this.expandedFarZProjMatrix=o.a6.mat4.mul([],tt,F)}else this.expandedFarZProjMatrix=this.projMatrix;const oe=o.a6.mat4.invert([],W);this.frustumCorners=o.b_.fromInvProjectionMatrix(oe,this.horizonLineFromTop(),this.height),this.cameraFrustum=o.bN.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!p);const le=new Float32Array(16);o.a6.mat4.identity(le),o.a6.mat4.scale(le,le,[1,-1,1]),o.a6.mat4.rotateX(le,le,this._pitch),o.a6.mat4.rotateZ(le,le,this.angle);const ue=o.a6.mat4.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=o.a6.mat4.clone(ue);const ve=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;ue[8]=2*-u.x/this.width,ue[9]=2*(u.y+ve)/this.height,this.skyboxMatrix=o.a6.mat4.multiply(le,ue,le);const _e=this.point,be=_e.x,we=_e.y,ke=this.width%2/2,Ne=this.height%2/2,De=Math.cos(this.angle),je=Math.sin(this.angle),Ge=be-Math.round(be)+De*ke+je*Ne,et=we-Math.round(we)+De*Ne+je*ke,Ke=new Float64Array(Q);if(o.a6.mat4.translate(Ke,Ke,[Ge>.5?Ge-1:Ge,et>.5?et-1:et,0]),this.alignedProjMatrix=Ke,Q=o.a6.mat4.create(),o.a6.mat4.scale(Q,Q,[this.width/2,-this.height/2,1]),o.a6.mat4.translate(Q,Q,[1,-1,0]),this.labelPlaneMatrix=Q,Q=o.a6.mat4.create(),o.a6.mat4.scale(Q,Q,[1,-1,1]),o.a6.mat4.translate(Q,Q,[-1,-1,0]),o.a6.mat4.scale(Q,Q,[2/this.width,2/this.height,1]),this.glCoordMatrix=Q,this.pixelMatrix=o.a6.mat4.multiply(new Float64Array(16),this.labelPlaneMatrix,J),this._calcFogMatrices(),this._distanceTileDataCache={},Q=o.a6.mat4.invert(new Float64Array(16),this.pixelMatrix),!Q)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=Q,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=o.b$(this);const tt=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o.a6.vec3.transformMat4(tt,tt,F),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=Q;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const u=this.cameraWorldSizeForFog,p=this.cameraPixelsPerMeter,w=this._camera.position,E=1/this.height/this._pixelsPerMercatorPixel,P=[u,u,p];o.a6.vec3.scale(P,P,E),o.a6.vec3.scale(w,w,-1),o.a6.vec3.multiply(w,w,P);const F=o.a6.mat4.create();o.a6.mat4.translate(F,F,w),o.a6.mat4.scale(F,F,P),this.mercatorFogMatrix=F,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(u,p,E)}_computeCameraPosition(u){const p=(u=u||this.pixelsPerMeter)/this.pixelsPerMeter,w=this._camera.forward(),E=this.point,P=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*p-u/this.worldSize*this._centerAltitude;return[E.x/this.worldSize-w[0]*P,E.y/this.worldSize-w[1]*P,u/this.worldSize*this._centerAltitude-w[2]*P]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(u){const p=this._maxCameraBoundsDistance()*Math.cos(this._pitch),w=this._camera.position[2],E=u[2];let P=1;this.projection.wrap&&(this.center=this.center.wrap()),E>0&&(P=Math.min((p-w)/E,1)),this._camera.position=o.a6.vec3.scaleAndAdd([],this._camera.position,u,P),this._updateStateFromCamera()}_updateStateFromCamera(){const u=this._camera.position,p=this._camera.forward(),{pitch:w,bearing:E}=this._camera.getPitchBearing(),P=o.bD(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,F=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.bB(this._maxPitch)),W=Math.max((u[2]-P)/Math.cos(w),F),$=this._zoomFromMercatorZ(W);o.a6.vec3.scaleAndAdd(u,u,p,W),this._pitch=o.ap(w,o.bB(this.minPitch),o.bB(this.maxPitch)),this.angle=o.bA(E,-Math.PI,Math.PI),this._setZoom(o.ap($,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.a5(u[0],u[1],u[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(u){return Math.pow(2,u)*this.tileSize}_mercatorZfromZoom(u){return this.cameraToCenterDistance/this._worldSizeFromZoom(u)}_minimumHeightOverTerrain(){const u=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(u)}_zoomFromMercatorZ(u){return this.scaleZoom(this.cameraToCenterDistance/(u*this.tileSize))}zoomFromMercatorZAdjusted(u){let p=0,w=o.bU,E=0,P=1/0;for(;w-p>1e-6&&w>p;){const F=p+.5*(w-p),W=this.tileSize*Math.pow(2,F),$=this.getCameraToCenterDistance(this.projection,F,W),J=this.scaleZoom($/(u*this.tileSize)),Q=Math.abs(F-J);Q<P&&(P=Q,E=F),F<J?p=F:w=F}return E}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(u,p){const w=Math.min(u.x,p.x),E=Math.max(u.x,p.x),P=Math.min(u.y,p.y),F=Math.max(u.y,p.y);if(P<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const W=[new o.P(w,P),new o.P(E,F),new o.P(w,F),new o.P(E,P)],$=this.renderWorldCopies?-3:0,J=this.renderWorldCopies?4:1;for(const Q of W){const oe=this.pointRayIntersection(Q);if(oe.t<0)return!0;const le=this.rayIntersectionCoordinate(oe);if(le.x<$||le.y<0||le.x>J||le.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.c0(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.P(0,0),new o.P(this.width,this.height))}zoomDeltaToMovement(u,p){const w=o.a6.vec3.length(o.a6.vec3.sub([],this._camera.position,u)),E=this._zoomFromMercatorZ(w)+p;return w-this._mercatorZfromZoom(E)}getCameraPoint(){if(this.projection.name==="globe"){const u=function([p,w,E],P){const F=[p,w,E,1];o.a6.vec4.transformMat4(F,F,P);const W=F[3]=Math.max(F[3],1e-6);return F[0]/=W,F[1]/=W,F[2]/=W,F}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.P(u[0],u[1])}{const u=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(0,u))}}getCameraToCenterDistance(u,p=this.zoom,w=this.worldSize){const E=o.bX(u,p,this.width,this.height,1024),P=u.pixelSpaceConversion(this.center.lat,w,E);let F=.5/Math.tan(.5*this._fov)*this.height*P;return this.isOrthographic&&(F=Hh(1,F,jh(this.pitch>=15?1:this.pitch/15))),F}getWorldToCameraMatrix(){const u=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&o.a6.mat4.multiply(u,u,this.globeMatrix),u}getFrustum(u){return o.bN.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u,this.projection.zAxisUnit==="meters")}}const tc=(b,u)=>{if(u>0&&b.terrain&&o.w("Cutoff is currently disabled on terrain"),u<=0||b.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const p=b.transform,w=Math.max(Math.abs(p._zoom-(b.minCutoffZoom-1)),1),E=p.isLODDisabled(!1)?o.a7(60,45,p.pitch):o.a7(30,15,p.pitch),P=p._farZ-p._nearZ,F=u*p.height,W=((1-($=E))*p.cameraToCenterDistance+$*(p._farZ+F))*w;var $;return{shouldRenderCutoff:E<1,uniformValues:{u_cutoff_params:[p._nearZ,p._farZ,(W-p._nearZ)/P,(W-F-p._nearZ)/P]}}},vs={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class Wh{constructor(u,p){this.aabb=u,this.lastCascade=p}}class yn{add(u,p){const w=this.receivers[u.key];w!==void 0?(w.aabb.min[0]=Math.min(w.aabb.min[0],p.min[0]),w.aabb.min[1]=Math.min(w.aabb.min[1],p.min[1]),w.aabb.min[2]=Math.min(w.aabb.min[2],p.min[2]),w.aabb.max[0]=Math.max(w.aabb.max[0],p.max[0]),w.aabb.max[1]=Math.max(w.aabb.max[1],p.max[1]),w.aabb.max[2]=Math.max(w.aabb.max[2],p.max[2])):this.receivers[u.key]=new Wh(p,null)}clear(){this.receivers={}}get(u){return this.receivers[u.key]}computeRequiredCascades(u,p,w){const E=o.c9.fromPoints(u.points);let P=0;for(const F in this.receivers){const W=this.receivers[F];if(!W||!E.intersectsAabb(W.aabb))continue;W.aabb.min=E.closestPoint(W.aabb.min),W.aabb.max=E.closestPoint(W.aabb.max);const $=W.aabb.getCorners();for(let J=0;J<w.length;J++){let Q=!0;for(const oe of $){const le=[oe[0]*p,oe[1]*p,oe[2]];if(o.a6.vec3.transformMat4(le,le,w[J].matrix),le[0]<-1||le[0]>1||le[1]<-1||le[1]>1){Q=!1;break}}if(W.lastCascade=J,P=Math.max(P,J),Q)break}}return P+1}}class ag{constructor(u){this.painter=u,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new yn,this._depthMode=new $n(u.context.gl.LEQUAL,$n.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,u.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),u.tp.registerParameter(vs,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),u.tp.registerParameter(vs,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),u.tp.registerParameter(vs,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),u.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const u of this._cascades)u.texture.destroy(),u.framebuffer.destroy();this._cascades=[]}updateShadowParameters(u,p){const w=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!p||!p.properties)return;const E=p.properties.get("shadow-intensity");if(!p.shadowsEnabled()||E<=0||(this._shadowLayerCount=w.style.order.reduce((ve,_e)=>{const be=w.style._mergedLayers[_e];return ve+(be.hasShadowPass()&&!be.isHidden(u.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const P=w.context,F=vs.shadowMapResolution,W=vs.shadowMapResolution;if(this._cascades.length===0||vs.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let ve=0;ve<vs.cascadeCount;++ve){const _e=w._shadowMapDebug,be=P.gl,we=P.createFramebuffer(F,W,_e,"texture"),ke=new o.T(P,{width:F,height:W,data:null},be.DEPTH_COMPONENT16);if(we.depthAttachment.set(ke.texture),_e){const Ne=new o.T(P,{width:F,height:W,data:null},be.RGBA8);we.colorAttachment.set(Ne.texture)}this._cascades.push({framebuffer:we,texture:ke,matrix:[],far:0,boundingSphereRadius:0,frustum:new o.bN,scale:0})}}this.shadowDirection=Xh(p);let $=0;if(u.elevation){const ve=u.elevation,_e=[1e4,-1e4];ve.visibleDemTiles.filter(be=>be.dem).forEach(be=>{const we=be.dem.tree;_e[0]=Math.min(_e[0],we.minimums[0]),_e[1]=Math.max(_e[1],we.maximums[0])}),_e[0]!==1e4&&($=(_e[1]-_e[0])*ve.exaggeration())}const J=1.5*u.cameraToCenterDistance,Q=3*J,oe=new Float64Array(16);for(let ve=0;ve<this._cascades.length;++ve){const _e=this._cascades[ve];let be=u.height/50,we=1;vs.cascadeCount===1?we=Q:ve===0?we=J:(be=J,we=Q);const[ke,Ne]=Rp(u,this.shadowDirection,be,we,vs.shadowMapResolution,$);_e.scale=u.scale,_e.matrix=ke,_e.boundingSphereRadius=Ne,o.a6.mat4.invert(oe,_e.matrix),_e.frustum=o.bN.fromInvProjectionMatrix(oe,1,0,!0),_e.far=we}const le=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[le].far,this._cascades[le].far],this._uniformValues.u_shadow_intensity=E,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/vs.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=vs.shadowMapResolution,this._uniformValues.u_shadowmap_0=oo.ShadowMap0,this._uniformValues.u_shadowmap_1=oo.ShadowMap0+1,this._groundShadowTiles=w.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const ue=w.transform.elevation;for(const ve of this._groundShadowTiles){let _e={min:0,max:0};if(ue){const be=ue.getMinMaxForTile(ve);be&&(_e=be)}this.addShadowReceiver(ve.toUnwrapped(),_e.min,_e.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(u){this._enabled=u}drawShadowPass(u,p){if(!this.enabled)return;const w=this.painter,E=w.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(w.transform.getFrustum(0),w.transform.worldSize,this._cascades),E.viewport.set([0,0,vs.shadowMapResolution,vs.shadowMapResolution]);for(let P=0;P<this._numCascadesToRender;++P){w.currentShadowCascade=P,E.bindFramebuffer.set(this._cascades[P].framebuffer.framebuffer),E.clear({color:o.bz.white,depth:1});for(const F of u.order){const W=u._mergedLayers[F];if(!W.hasShadowPass()||W.isHidden(w.transform.zoom))continue;const $=u.getLayerSourceCache(W),J=$?p[$.id]:void 0;(W.type==="model"||J&&J.length)&&w.renderLayer(w,$,W,J)}}w.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const u=this.painter,p=u.style,w=u.context,E=p.directionalLight,P=p.ambientLight;if(!E||!P)return;const F=[],W=tc(u,u.longestCutoffRange);W.shouldRenderCutoff&&F.push("RENDER_CUTOFF");const $=Ip(p,E,P),J=new $n(w.gl.LEQUAL,$n.ReadOnly,u.depthRangeFor3D);for(const Q of this._groundShadowTiles){const oe=Q.toUnwrapped(),le=u.isTileAffectedByFog(Q),ue=u.getOrCreateProgram("groundShadow",{defines:F,overrideFog:le});this.setupShadows(oe,ue),u.uploadCommonUniforms(w,ue,oe,null,W);const ve={u_matrix:u.transform.calculateProjMatrix(oe),u_ground_shadow_factor:$};ue.draw(u,w.gl.TRIANGLES,J,pr.disabled,Mr.multiply,_r.disabled,ve,"ground_shadow",u.tileExtentBuffer,u.quadTriangleIndexBuffer,u.tileExtentSegments,{},u.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Mr.unblended:Mr.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(u){const p=this.painter.transform,w=p.calculatePosMatrix(u,p.worldSize);return o.a6.mat4.multiply(w,this._cascades[this.painter.currentShadowCascade].matrix,w),Float32Array.from(w)}calculateShadowPassMatrixFromMatrix(u){return o.a6.mat4.multiply(u,this._cascades[this.painter.currentShadowCascade].matrix,u),Float32Array.from(u)}setupShadows(u,p,w,E=0){if(!this.enabled)return;const P=this.painter.transform,F=this.painter.context,W=F.gl,$=this._uniformValues,J=new Float64Array(16),Q=P.calculatePosMatrix(u,P.worldSize);for(let oe=0;oe<this._cascades.length;oe++)o.a6.mat4.multiply(J,this._cascades[oe].matrix,Q),$[oe===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(J),F.activeTexture.set(W.TEXTURE0+oo.ShadowMap0+oe),this._cascades[oe].texture.bind(W.NEAREST,W.CLAMP_TO_EDGE);if(this.useNormalOffset=!!w,this.useNormalOffset){const oe=o.c8(u.canonical),le=2/P.tileSize*o.ab/vs.shadowMapResolution,ue=le*this._cascades[0].boundingSphereRadius,ve=le*this._cascades[this._cascades.length-1].boundingSphereRadius,_e=(w==="vector-tile"?1:3)/Math.pow(2,E-u.canonical.z-(1-P.zoom+Math.floor(P.zoom)));$.u_shadow_normal_offset=[oe,ue*_e,ve*_e],$.u_shadow_bias=[6e-5,.0012,.012]}else $.u_shadow_bias=[36e-5,.0012,.012];p.setShadowUniformValues(F,$)}setupShadowsFromMatrix(u,p,w=!1){if(!this.enabled)return;const E=this.painter.context,P=E.gl,F=this._uniformValues,W=new Float64Array(16);for(let $=0;$<vs.cascadeCount;$++)o.a6.mat4.multiply(W,this._cascades[$].matrix,u),F[$===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(W),E.activeTexture.set(P.TEXTURE0+oo.ShadowMap0+$),this._cascades[$].texture.bind(P.NEAREST,P.CLAMP_TO_EDGE);if(this.useNormalOffset=w,w){const $=vs.normalOffset;F.u_shadow_normal_offset=[1,$,$],F.u_shadow_bias=[6e-5,.0012,.012]}else F.u_shadow_bias=[36e-5,.0012,.012];p.setShadowUniformValues(E,F)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(u,p,w,E){if(E[2]>=0)return{};const P=function($,J,Q){const oe=Q/(1<<$.canonical.z);return new o.c9([$.canonical.x*oe+$.wrap*Q,$.canonical.y*oe+$.wrap*Q,0],[($.canonical.x+1)*oe+$.wrap*Q,($.canonical.y+1)*oe+$.wrap*Q,J])}(u,p,w).getCorners(),F=p/-E[2];E[0]<0?(o.a6.vec3.add(P[0],P[0],[E[0]*F,0,0]),o.a6.vec3.add(P[3],P[3],[E[0]*F,0,0])):E[0]>0&&(o.a6.vec3.add(P[1],P[1],[E[0]*F,0,0]),o.a6.vec3.add(P[2],P[2],[E[0]*F,0,0])),E[1]<0?(o.a6.vec3.add(P[0],P[0],[0,E[1]*F,0]),o.a6.vec3.add(P[1],P[1],[0,E[1]*F,0])):E[1]>0&&(o.a6.vec3.add(P[2],P[2],[0,E[1]*F,0]),o.a6.vec3.add(P[3],P[3],[0,E[1]*F,0]));const W={};return W.vertices=P,W.planes=[Oc(P[1],P[0],P[4]),Oc(P[2],P[1],P[5]),Oc(P[3],P[2],P[6]),Oc(P[0],P[3],P[7])],W}addShadowReceiver(u,p,w){this._receivers.add(u,o.c9.fromTileIdAndHeight(u,p,w))}getMaxCascadeForTile(u){const p=this._receivers.get(u);return p&&p.lastCascade?p.lastCascade:0}}function Oc(b,u,p){const w=o.a6.vec3.sub([],p,u),E=o.a6.vec3.sub([],b,u),P=o.a6.vec3.cross([],w,E),F=o.a6.vec3.length(P);return F===0?[0,0,1,0]:(o.a6.vec3.scale(P,P,1/F),[P[0],P[1],P[2],-o.a6.vec3.dot(P,u)])}function Xh(b){const u=b.properties.get("direction"),p=o.c7(u.x,u.y,u.z);p[2]=o.ap(p[2],0,75);const w=o.ca([p[0],p[1],p[2]]);return o.a6.vec3.fromValues(w.x,w.y,w.z)}function Ip(b,u,p){const w=u.properties.get("color"),E=u.properties.get("intensity"),P=u.properties.get("direction"),F=[P.x,P.y,P.z],W=p.properties.get("color"),$=p.properties.get("intensity"),J=Math.max(o.a6.vec3.dot([0,0,1],F),0),Q=[0,0,0];o.a6.vec3.scale(Q,W.toRenderColor(b.getLut(u.scope)).toArray01Linear().slice(0,3),$);const oe=[0,0,0];return o.a6.vec3.scale(oe,w.toRenderColor(b.getLut(p.scope)).toArray01Linear().slice(0,3),J*E),o.cb([Q[0]>0?Q[0]/(Q[0]+oe[0]):0,Q[1]>0?Q[1]/(Q[1]+oe[1]):0,Q[2]>0?Q[2]/(Q[2]+oe[2]):0])}function Rp(b,u,p,w,E,P){const F=b.zoom,W=b.scale,$=b.worldSize,J=1/$,Q=b.aspect,oe=Math.sqrt(1+Q*Q)*Math.tan(.5*b.fovX),le=oe*oe,ue=w-p,ve=w+p;let _e,be;le>ue/ve?(_e=w,be=w*oe):(_e=.5*ve*(1+le),be=.5*Math.sqrt(ue*ue+2*(w*w+p*p)*le+ve*ve*le*le));const we=b.projection.pixelsPerMeter(b.center.lat,$),ke=b._camera.getCameraToWorldMercator(),Ne=[0,0,-_e*J];o.a6.vec3.transformMat4(Ne,Ne,ke);let De=be*J;const je=b._edgeInsets;if(!(je.left===0&&je.top===0&&je.right===0&&je.bottom===0||je.left===je.right&&je.top===je.bottom)){const fn=b._camera.getWorldToCamera(b.worldSize,b.projection.zAxisUnit==="meters"?we:1),pn=b._camera.getCameraToClipPerspective(b._fov,b.width/b.height,p,w);pn[8]=2*-b.centerOffset.x/b.width,pn[9]=2*b.centerOffset.y/b.height;const qt=new Float64Array(16);o.a6.mat4.mul(qt,pn,fn);const en=new Float64Array(16);o.a6.mat4.invert(en,qt);const er=o.bN.fromInvProjectionMatrix(en,$,F,!0);for(const xn of er.points){const Dn=((Ge=xn)[0]/=W,Ge[1]/=W,Ge[2]=o.bD(Ge[2],b._center.lat),Ge);De=Math.max(De,o.a6.vec3.len(o.a6.vec3.subtract([],Ne,Dn)))}}var Ge;De*=E/(E-1);const et=Math.acos(u[2]),Ke=Math.atan2(-u[0],-u[1]),tt=new es;tt.position=Ne,tt.setPitchBearing(et,Ke);const ct=tt.getWorldToCamera($,we),st=De*$,rt=Math.min(b._mercatorZfromZoom(17)*$*-2,-2*st),xt=tt.getCameraToClipOrthographic(-st,st,-st,st,rt,(st+P*we)/u[2]),Ft=new Float64Array(16);o.a6.mat4.multiply(Ft,xt,ct);const Zt=o.a6.vec3.fromValues(Math.floor(1e6*Ne[0])/1e6*$,Math.floor(1e6*Ne[1])/1e6*$,0),kt=.5*E,hn=[0,0,0];o.a6.vec3.transformMat4(hn,Zt,Ft),o.a6.vec3.scale(hn,hn,kt);const bt=[Math.floor(hn[0]),Math.floor(hn[1]),Math.floor(hn[2])],Wt=[0,0,0];o.a6.vec3.sub(Wt,hn,bt),o.a6.vec3.scale(Wt,Wt,-1/kt);const Vt=new Float64Array(16);return o.a6.mat4.identity(Vt),o.a6.mat4.translate(Vt,Vt,Wt),o.a6.mat4.multiply(Ft,Vt,Ft),[Ft,st]}class Za extends o.E{constructor(u){super(),this.requestManager=u,this.models={"":{}},this.numModelsLoading={}}loadModel(u,p){return o.aG(this.requestManager.transformRequest(p,o.R.Model).url).then(w=>{if(!w)return;const E=o.aH(w),P=new o.aI(u,void 0,void 0,E);return P.computeBoundsAndApplyParent(),P}).catch(w=>{if(w&&w.status===404)return null;this.fire(new o.t(new Error(`Could not load model ${u} from ${p}: ${w.message}`)))})}load(u,p){this.models[p]||(this.models[p]={});const w=Object.keys(u);this.numModelsLoading[p]=(this.numModelsLoading[p]||0)+w.length;const E=[];for(const P of w)E.push(this.loadModel(P,u[P]));Promise.allSettled(E).then(P=>{for(let F=0;F<P.length;F++){const{status:W,value:$}=P[F];W==="fulfilled"&&$&&(this.models[p][w[F]]={model:$,numReferences:1})}this.numModelsLoading[p]-=w.length,this.fire(new o.x("data",{dataType:"style"}))}).catch(P=>{this.fire(new o.t(new Error(`Could not load models: ${P.message}`)))})}isLoaded(){for(const u in this.numModelsLoading)if(this.numModelsLoading[u]>0)return!1;return!0}hasModel(u,p){return!!this.getModel(u,p)}getModel(u,p){return this.models[p]||(this.models[p]={}),this.models[p][u]?this.models[p][u].model:void 0}addModel(u,p,w){this.models[w]||(this.models[w]={}),this.hasModel(u,w)&&this.models[w][u].numReferences++,this.load({[u]:this.requestManager.normalizeModelURL(p)},w)}addModels(u,p){this.models[p]||(this.models[p]={});const w={};for(const E in u)this.models[p][E]={},w[E]=this.requestManager.normalizeModelURL(u[E]);this.load(w,p)}addModelsFromBucket(u,p){this.models[p]||(this.models[p]={});const w={};for(const E of u)this.hasModel(E,p)?this.models[p][E].numReferences++:w[E]=this.requestManager.normalizeModelURL(E);this.load(w,p)}removeModel(u,p){if(this.models[p]&&this.models[p][u]&&(this.models[p][u].numReferences--,this.models[p][u].numReferences===0)){const w=this.models[p][u].model;delete this.models[p][u],w.destroy()}}listModels(u){return this.models[u]||(this.models[u]={}),Object.keys(this.models[u])}upload(u,p){this.models[p]||(this.models[p]={});for(const w in this.models[p])this.models[p][w].model&&this.models[p][w].model.upload(u.context)}}const lg=new o.a0({data:new o.a1(o._.colorTheme.data)}),oa=(b,u)=>pt(b,u&&u.filter(p=>p.identifier!=="source.canvas")),Ba=o.ar(ii,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),Fc=o.ar(ii,["setCenter","setZoom","setBearing","setPitch"]),$h={version:8,layers:[],sources:{}},nc={duration:300,delay:0};class ka extends o.E{constructor(u,p={}){super(),this.map=u,this.scope=p.scope||"",this.globalId=null,this.fragments=[],this.importDepth=p.importDepth||0,this.importsCache=p.importsCache||new Map,this.resolvedImports=p.resolvedImports||new Set,this.transition=o.l({},nc),this._buildingIndex=new Sp(this),this.crossTileSymbolIndex=new Gh,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=p.styleChanges||new cn,this.dispatcher=p.dispatcher?p.dispatcher:new o.cd(o.ce(),this),p.imageManager?this.imageManager=p.imageManager:(this.imageManager=new Jt,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=p.glyphManager?p.glyphManager:new o.cf(u._requestManager,p.localFontFamily?o.cg.all:p.localIdeographFontFamily?o.cg.ideographs:o.cg.none,p.localFontFamily||p.localIdeographFontFamily),p.modelManager?this.modelManager=p.modelManager:(this.modelManager=new Za(u._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null},this._styleColorThemeForScope={},this.options=p.configOptions?p.configOptions:new Map,this._configDependentLayers=p.configDependentLayers?p.configDependentLayers:new Set,this._config=p.config,this._initialConfig=p.initialConfig,this.dispatcher.broadcast("setReferrer",o.ch());const w=this;this._rtlTextPluginCallback=ka.registerForPluginStateChange(E=>{w.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:E.pluginStatus,pluginURL:E.pluginURL},(P,F)=>{if(o.ci(P),F&&F.every(W=>W))for(const W in w._sourceCaches){const $=w._sourceCaches[W],J=$.getSource().type;J!=="vector"&&J!=="geojson"||$.reload()}})}),this.on("data",E=>{if(E.dataType!=="source"||E.sourceDataType!=="metadata")return;const P=this.getOwnSource(E.sourceId);if(P&&P.vectorLayerIds)for(const F in this._layers){const W=this._layers[F];W.source===P.id&&this._validateLayer(W)}})}load(u){return u?(typeof u=="string"?this.loadURL(u):this.loadJSON(u),this):this}_getGlobalId(u){if(!u)return null;if(typeof u=="string"){if(o.f(u))return u;const p=o.cj(u);if(!p.startsWith("http"))try{return new URL(p,location.href).toString()}catch{return p}return p}return`json://${o.ck(JSON.stringify(u))}`}_diffStyle(u,p,w){this.globalId=this._getGlobalId(u);const E=(P,F)=>{try{F(null,this.setState(P,w))}catch(W){F(W,!1)}};if(typeof u=="string"){const P=this.map._requestManager.normalizeStyleURL(u),F=this.map._requestManager.transformRequest(P,o.R.Style);o.n(F,(W,$)=>{W?this.fire(new o.t(W)):$&&E($,p)})}else typeof u=="object"&&E(u,p)}loadURL(u,p={}){this.fire(new o.x("dataloading",{dataType:"style"}));const w=typeof p.validate=="boolean"?p.validate:!o.f(u);this.globalId=this._getGlobalId(u),u=this.map._requestManager.normalizeStyleURL(u,p.accessToken),this.resolvedImports.add(u);const E=this.importsCache.get(u);if(E)return this._load(E,w);const P=this.map._requestManager.transformRequest(u,o.R.Style);this._request=o.n(P,(F,W)=>{if(this._request=null,F)this.fire(new o.t(F));else if(W)return this.importsCache.set(u,W),this._load(W,w)})}loadJSON(u,p={}){this.fire(new o.x("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(u),this._request=o.q.frame(()=>{this._request=null,this._load(u,p.validate!==!1)})}loadEmpty(){this.fire(new o.x("dataloading",{dataType:"style"})),this._load($h,!1)}_loadImports(u,p,w){if(this.importDepth>=4)return o.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const E=[];for(const P of u){const F=this._createFragmentStyle(P),W=new Promise(Q=>{F.once("style.import.load",Q),F.once("error",Q)}).then(()=>this.mergeAll());if(E.push(W),this.resolvedImports.has(P.url)){F.loadEmpty();continue}const $=P.data||this.importsCache.get(P.url);$?(F.loadJSON($,{validate:p}),this._isInternalStyle($)&&(F.globalId=null)):P.url?F.loadURL(P.url,{validate:p}):F.loadEmpty();const J={style:F,id:P.id,config:P.config};if(w){const Q=this.fragments.findIndex(({id:oe})=>oe===w);this.fragments=this.fragments.slice(0,Q).concat(J).concat(this.fragments.slice(Q))}else this.fragments.push(J)}return Promise.allSettled(E)}getImportGlobalIds(u=this,p=new Set){for(const w of u.fragments)w.style.globalId&&p.add(w.style.globalId),this.getImportGlobalIds(w.style,p);return[...p.values()]}_createFragmentStyle(u){const p=this.scope?o.av(u.id,this.scope):u.id;let w;const E=this._initialConfig&&this._initialConfig[p];(u.config||E)&&(w=o.l({},u.config,E));const P=new ka(this.map,{scope:p,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:w,configOptions:this.options,configDependentLayers:this._configDependentLayers});return P.setEventedParent(this.map,{style:P}),P}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(u){return this.isRootStyle()&&(u.fragment||!!u.schema&&u.fragment!==!1)}_load(u,p){const w=u.schema;if(this._isInternalStyle(u)){const F=o.l({},$h,{imports:[{id:"basemap",data:u,url:""}]});return void this._load(F,p)}if(this.updateConfig(this._config,w),p&&oa(this,En(u)))return;this._loaded=!0,this.stylesheet=o.cl(u);const E=()=>{for(const J in u.sources)this.addSource(J,u.sources[J],{validate:!1,isInitialLoad:!0});u.sprite?this._loadSprite(u.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(u.glyphs,this.scope);const F=Nh(this.stylesheet.layers);if(this._order=F.map(J=>J.id),this.stylesheet.light&&o.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const J=this.stylesheet.lights[0];this.light=new gt(J.properties,J.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new gt(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const J of F){const Q=o.cq(J,this.scope,this._styleColorTheme.lut,this.options);Q.configDependencies.size!==0&&this._configDependentLayers.add(Q.fqid),Q.setEventedParent(this,{layer:{id:Q.id}}),this._layers[Q.id]=Q,this._serializedLayers[Q.id]=Q.serialize();const oe=this.getOwnLayerSourceCache(Q),le=!!this.directionalLight&&this.directionalLight.shadowsEnabled();oe&&Q.canCastShadows()&&le&&(oe.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const W=this.stylesheet.terrain;W&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(W,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new o.x("data",{dataType:"style"}));const $=this.isRootStyle();u.imports?this._loadImports(u.imports,p).then(()=>{this._reloadImports(),this.fire(new o.x($?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new o.x($?"style.load":"style.import.load")))},P=this.stylesheet["color-theme"];if(this._styleColorTheme.colorTheme=P,P){const F=this._evaluateColorThemeData(P);this._loadColorTheme(F).then(()=>{E()}).catch(W=>{o.w(`Couldn't load color theme from the stylesheet: ${W}`),E()})}else this._styleColorTheme.lut=null,E()}isRootStyle(){return this.importDepth===0}mergeAll(){let u,p,w,E,P,F,W,$;const J={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(Q=>{if(Q.stylesheet){if(Q.light!=null&&(u=Q.light),Q.stylesheet.lights)for(const oe of Q.stylesheet.lights)oe.type==="ambient"&&Q.ambientLight!=null&&(p=Q.ambientLight),oe.type==="directional"&&Q.directionalLight!=null&&(w=Q.directionalLight);E=this._prioritizeTerrain(E,Q.terrain,Q.stylesheet.terrain),Q.stylesheet.fog&&Q.fog!=null&&(P=Q.fog),Q.stylesheet.camera!=null&&($=Q.stylesheet.camera),Q.stylesheet.projection!=null&&(F=Q.stylesheet.projection),Q.stylesheet.transition!=null&&(W=Q.stylesheet.transition),J[Q.scope]=Q._styleColorTheme}}),this.light=u,this.ambientLight=p,this.directionalLight=w,this.fog=P,this._styleColorThemeForScope=J,E===null?delete this.terrain:this.terrain=E,this.camera=$||{"camera-projection":"perspective"},this.projection=F||{name:"mercator"},this.transition=o.l({},nc,W),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(u){const p=w=>{for(const E of w.fragments)p(E.style);u(w)};p(this)}_prioritizeTerrain(u,p,w){const E=u&&u.drapeRenderMode===0;return w===null?p&&p.drapeRenderMode===0?p:E?u:null:p!=null&&(!u||E||p&&p.drapeRenderMode===1)?p:u}mergeTerrain(){let u;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(p=>{u=this._prioritizeTerrain(u,p.terrain,p.stylesheet.terrain)}),u===null?delete this.terrain:this.terrain=u}mergeProjection(){let u;this.forEachFragmentStyle(p=>{p.stylesheet.projection!=null&&(u=p.stylesheet.projection)}),this.projection=u||{name:"mercator"}}mergeSources(){const u={},p={},w={};this.forEachFragmentStyle(E=>{for(const P in E._sourceCaches){const F=o.av(P,E.scope);u[F]=E._sourceCaches[P]}for(const P in E._otherSourceCaches){const F=o.av(P,E.scope);p[F]=E._otherSourceCaches[P]}for(const P in E._symbolSourceCaches){const F=o.av(P,E.scope);w[F]=E._symbolSourceCaches[P]}}),this._mergedSourceCaches=u,this._mergedOtherSourceCaches=p,this._mergedSymbolSourceCaches=w}mergeLayers(){const u={},p=[],w={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(P=>{for(const F of P._order){const W=P._layers[F];if(W.type==="slot"){const $=o.cm(F);if(u[$])continue;u[$]=[]}W.slot&&u[W.slot]?u[W.slot].push(W):p.push(W)}}),this._mergedOrder=[];const E=(P=[])=>{for(const F of P)if(F.type==="slot"){const W=o.cm(F.id);u[W]&&E(u[W]),this._mergedSlots.push(W)}else{const W=o.av(F.id,F.scope);this._mergedOrder.push(W),w[W]=F,F.is3D()&&(this._has3DLayers=!0),F.type==="circle"&&(this._hasCircleLayers=!0),F.type==="symbol"&&(this._hasSymbolLayers=!0),F.type==="clip"&&(this._clipLayerPresent=!0)}};E(p),this._mergedOrder.sort((P,F)=>{const W=w[P],$=w[F];return W.hasInitialOcclusionOpacityProperties?$.is3D()?1:0:W.is3D()&&$.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=w,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(u){return this.stylesheet.camera=o.l({},this.stylesheet.camera,u),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(u){return u.data?function(p,w,E){const P=o.l({},w);for(const W of Object.keys(o._.colorTheme))P[W]===void 0&&(P[W]=o._.colorTheme[W].default);const F=new o.$(lg,p,new Map(E));return F.setTransitionOrValue(P,E),F.untransitioned().possiblyEvaluate(new o.a3(0))}(this.scope,u,this.options).get("data"):null}_loadColorTheme(u){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const p=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((w,E)=>{const P="data:image/png;base64,";if(!u||u.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void w();let F=u;F.startsWith(P)||(F=P+F);const W="mapbox-reserved-lut",$=new Image;$.src=F,$.onerror=()=>{this._styleColorTheme.lutLoading=!1,E(new Error("Failed to load image data"))},$.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==p)return void w();this._styleColorTheme.lutLoading=!1;const{width:J,height:Q,data:oe}=o.q.getImageData($);if(Q>32)return void E(new Error("The height of the image must be less than or equal to 32 pixels."));if(J!==Q*Q)return void E(new Error("The width of the image must be equal to the height squared."));this.getImage(W)&&this.removeImage(W),this.addImage(W,{data:new o.r({width:J,height:Q},oe),pixelRatio:1,sdf:!1,version:0});const le=this.imageManager.getImage(W,this.scope);le?(this._styleColorTheme.lut={image:le.data,data:u},w()):E(new Error("Missing LUT image."))}})}getLut(u){const p=this._styleColorThemeForScope[u];return p?p.lut:null}setProjection(u){u?this.stylesheet.projection=u:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(u){this._spriteRequest=function(p,w,E){let P,F,W;const $=o.q.devicePixelRatio>1?"@2x":"";let J=o.n(w.transformRequest(w.normalizeSpriteURL(p,$,".json"),o.R.SpriteJSON),(le,ue)=>{J=null,W||(W=le,P=ue,oe())}),Q=o.o(w.transformRequest(w.normalizeSpriteURL(p,$,".png"),o.R.SpriteImage),(le,ue)=>{Q=null,W||(W=le,F=ue,oe())});function oe(){if(W)E(W);else if(P&&F){const le=o.q.getImageData(F),ue={};for(const ve in P){const{width:_e,height:be,x:we,y:ke,sdf:Ne,pixelRatio:De,stretchX:je,stretchY:Ge,content:et}=P[ve],Ke=new o.r({width:_e,height:be});o.r.copy(le,Ke,{x:we,y:ke},{x:0,y:0},{width:_e,height:be},null),ue[ve]={data:Ke,pixelRatio:De,sdf:Ne,stretchX:je,stretchY:Ge,content:et}}E(null,ue)}}return{cancel(){J&&(J.cancel(),J=null),Q&&(Q.cancel(),Q=null)}}}(u,this.map._requestManager,(p,w)=>{if(this._spriteRequest=null,p)this.fire(new o.t(p));else if(w)for(const E in w)this.imageManager.addImage(E,this.scope,w[E]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.x("data",{dataType:"style"}))})}_validateLayer(u){const p=this.getOwnSource(u.source);if(!p)return;const w=u.sourceLayer;w&&(p.type==="geojson"||p.vectorLayerIds&&p.vectorLayerIds.indexOf(w)===-1)&&this.fire(new o.t(new Error(`Source layer "${w}" does not exist on source "${p.id}" as specified by style layer "${u.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const u in this._sourceCaches)if(!this._sourceCaches[u].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:u}of this.fragments)if(!u.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((u,p)=>{const w=this.fragments[p];return w&&w.style&&(u.data=w.style.serialize()),u})}_serializeSources(){const u={};for(const p in this._sourceCaches){const w=this._sourceCaches[p].getSource();u[w.id]||(u[w.id]=w.serialize())}return u}_serializeLayers(u){const p=[];for(const w of u){const E=this._layers[w];E&&E.type!=="custom"&&p.push(E.serialize())}return p}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const u in this._sourceCaches)if(this._sourceCaches[u].hasTransition())return!0;for(const u in this._layers)if(this._layers[u].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(u){return!!this.terrain&&u.isDraped(this.getLayerSourceCache(u))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(u){const p=this.getOwnLayer(u);if(p)return p;this.fire(new o.t(new Error(`The layer '${u}' does not exist in the map's style.`)))}_checkSource(u){const p=this.getOwnSource(u);if(p)return p;this.fire(new o.t(new Error(`The source '${u}' does not exist in the map's style.`)))}precompilePrograms(u,p){const w=this.map.painter;if(w)for(let E=u.minzoom||0;E<(u.maxzoom||25.5);E++){const P=u.getProgramIds();if(P)for(const F of P){const W=u.getDefaultProgramParams(F,p.zoom,this._styleColorTheme.lut);W&&(w.style=this,this.fog&&(w._fogVisible=!0,W.overrideFog=!0,w.getOrCreateProgram(F,W)),w._fogVisible=!1,W.overrideFog=!1,w.getOrCreateProgram(F,W),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(W.overrideRtt=!0,w.getOrCreateProgram(F,W)))}}}update(u){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(u),this.directionalLight&&this.directionalLight.recalculate(u);const p=this.calculateLightsBrightness();u.brightness=p||0,p!==this._brightness&&(this._brightness=p,this.dispatcher.broadcast("setBrightness",p));const w=this._changes.isDirty();let E=!1;if(this._changes.isDirty()){const F=this._changes.getLayerUpdatesByScope();for(const W in F){const{updatedIds:$,removedIds:J}=F[W];($||J)&&(this._updateWorkerLayers(W,$,J),E=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(u),this.light&&this.light.updateTransitions(u),this.ambientLight&&this.ambientLight.updateTransitions(u),this.directionalLight&&this.directionalLight.updateTransitions(u),this.fog&&this.fog.updateTransitions(u),this._changes.reset()}const P={};for(const F in this._mergedSourceCaches){const W=this._mergedSourceCaches[F];P[F]=W.used,W.used=!1,W.tileCoverLift=0}for(const F of this._mergedOrder){const W=this._mergedLayers[F];if(W.recalculate(u,this._availableImages),!W.isHidden(u.zoom)){const $=this.getLayerSourceCache(W);$&&($.used=!0,$.tileCoverLift=Math.max($.tileCoverLift,W.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(W,u)}):this.precompilePrograms(W,u))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&E&&this.mergeLayers();for(const F in P){const W=this._mergedSourceCaches[F];P[F]!==W.used&&W.getSource().fire(new o.x("data",{sourceDataType:"visibility",dataType:"source",sourceId:W.getSource().id}))}this.light&&this.light.recalculate(u),this.terrain&&this.terrain.recalculate(u),this.fog&&this.fog.recalculate(u),this.z=u.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),w&&this.fire(new o.x("data",{dataType:"style"}))}_updateTilesForChangedImages(){const u=this._changes.getUpdatedImages();if(u.length){for(const p in this._sourceCaches)this._sourceCaches[p].reloadTilesForDependencies(["icons","patterns"],u);this._changes.resetUpdatedImages()}}_updateWorkerLayers(u,p,w){const E=this.getFragmentStyle(u);E&&this.dispatcher.broadcast("updateLayers",{layers:p?E._serializeLayers(p):[],scope:u,removedIds:w||[],options:E.options})}setState(u,p){if(this._checkLoaded(),oa(this,En(u)))return!1;(u=o.cl(u)).layers=Nh(u.layers);const w=function(F,W){if(!F)return[{command:ii.setStyle,args:[W]}];let $=[];try{if(!o.bh(F.version,W.version))return[{command:ii.setStyle,args:[W]}];if(o.bh(F.center,W.center)||$.push({command:ii.setCenter,args:[W.center]}),o.bh(F.zoom,W.zoom)||$.push({command:ii.setZoom,args:[W.zoom]}),o.bh(F.bearing,W.bearing)||$.push({command:ii.setBearing,args:[W.bearing]}),o.bh(F.pitch,W.pitch)||$.push({command:ii.setPitch,args:[W.pitch]}),o.bh(F.sprite,W.sprite)||$.push({command:ii.setSprite,args:[W.sprite]}),o.bh(F.glyphs,W.glyphs)||$.push({command:ii.setGlyphs,args:[W.glyphs]}),o.bh(F.imports,W.imports)||function(ue=[],ve=[],_e){ve=ve||[];const be=(ue=ue||[]).map(zh),we=ve.map(zh),ke=ue.reduce(ld,{}),Ne=ve.reduce(ld,{}),De=be.slice();let je,Ge,et,Ke;for(je=0,Ge=0;je<be.length;je++)et=be[je],Ne.hasOwnProperty(et)?Ge++:(_e.push({command:ii.removeImport,args:[et]}),De.splice(De.indexOf(et,Ge),1));for(je=0,Ge=0;je<we.length;je++)et=we[we.length-1-je],De[De.length-1-je]!==et&&(ke.hasOwnProperty(et)?(_e.push({command:ii.removeImport,args:[et]}),De.splice(De.lastIndexOf(et,De.length-Ge),1)):Ge++,Ke=De[De.length-je],_e.push({command:ii.addImport,args:[Ne[et],Ke]}),De.splice(De.length-je,0,et));for(const tt of ve){const ct=ke[tt.id];ct&&!o.bh(ct,tt)&&_e.push({command:ii.updateImport,args:[tt.id,tt]})}}(F.imports,W.imports,$),o.bh(F.transition,W.transition)||$.push({command:ii.setTransition,args:[W.transition]}),o.bh(F.light,W.light)||$.push({command:ii.setLight,args:[W.light]}),o.bh(F.fog,W.fog)||$.push({command:ii.setFog,args:[W.fog]}),o.bh(F.projection,W.projection)||$.push({command:ii.setProjection,args:[W.projection]}),o.bh(F.lights,W.lights)||$.push({command:ii.setLights,args:[W.lights]}),o.bh(F.camera,W.camera)||$.push({command:ii.setCamera,args:[W.camera]}),!o.bh(F["color-theme"],W["color-theme"]))return[{command:ii.setStyle,args:[W]}];const J={},Q=[];(function(ue,ve,_e,be){let we;for(we in ve=ve||{},ue=ue||{})ue.hasOwnProperty(we)&&(ve.hasOwnProperty(we)||vr(we,_e,be));for(we in ve){if(!ve.hasOwnProperty(we))continue;const ke=ve[we];ue.hasOwnProperty(we)?o.bh(ue[we],ke)||(ue[we].type==="geojson"&&ke.type==="geojson"&&cr(ue,ve,we)?_e.push({command:ii.setGeoJSONSourceData,args:[we,ke.data]}):xx(we,ve,_e,be)):Ap(we,ve,_e)}})(F.sources,W.sources,Q,J);const oe=[];F.layers&&F.layers.forEach(ue=>{ue.source&&J[ue.source]?$.push({command:ii.removeLayer,args:[ue.id]}):oe.push(ue)});let le=F.terrain;le&&J[le.source]&&($.push({command:ii.setTerrain,args:[void 0]}),le=void 0),$=$.concat(Q),o.bh(le,W.terrain)||$.push({command:ii.setTerrain,args:[W.terrain]}),function(ue,ve,_e){ve=ve||[];const be=(ue=ue||[]).map(zh),we=ve.map(zh),ke=ue.reduce(ld,{}),Ne=ve.reduce(ld,{}),De=be.slice(),je=Object.create(null);let Ge,et,Ke,tt,ct,st,rt;for(Ge=0,et=0;Ge<be.length;Ge++)Ke=be[Ge],Ne.hasOwnProperty(Ke)?et++:(_e.push({command:ii.removeLayer,args:[Ke]}),De.splice(De.indexOf(Ke,et),1));for(Ge=0,et=0;Ge<we.length;Ge++)Ke=we[we.length-1-Ge],De[De.length-1-Ge]!==Ke&&(ke.hasOwnProperty(Ke)?(_e.push({command:ii.removeLayer,args:[Ke]}),De.splice(De.lastIndexOf(Ke,De.length-et),1)):et++,st=De[De.length-Ge],_e.push({command:ii.addLayer,args:[Ne[Ke],st]}),De.splice(De.length-Ge,0,Ke),je[Ke]=!0);for(Ge=0;Ge<we.length;Ge++)if(Ke=we[Ge],tt=ke[Ke],ct=Ne[Ke],!je[Ke]&&!o.bh(tt,ct))if(o.bh(tt.source,ct.source)&&o.bh(tt["source-layer"],ct["source-layer"])&&o.bh(tt.type,ct.type)){for(rt in ad(tt.layout,ct.layout,_e,Ke,null,ii.setLayoutProperty),ad(tt.paint,ct.paint,_e,Ke,null,ii.setPaintProperty),o.bh(tt.slot,ct.slot)||_e.push({command:ii.setSlot,args:[Ke,ct.slot]}),o.bh(tt.filter,ct.filter)||_e.push({command:ii.setFilter,args:[Ke,ct.filter]}),o.bh(tt.minzoom,ct.minzoom)&&o.bh(tt.maxzoom,ct.maxzoom)||_e.push({command:ii.setLayerZoomRange,args:[Ke,ct.minzoom,ct.maxzoom]}),tt)tt.hasOwnProperty(rt)&&rt!=="layout"&&rt!=="paint"&&rt!=="filter"&&rt!=="metadata"&&rt!=="minzoom"&&rt!=="maxzoom"&&rt!=="slot"&&(rt.indexOf("paint.")===0?ad(tt[rt],ct[rt],_e,Ke,rt.slice(6),ii.setPaintProperty):o.bh(tt[rt],ct[rt])||_e.push({command:ii.setLayerProperty,args:[Ke,rt,ct[rt]]}));for(rt in ct)ct.hasOwnProperty(rt)&&!tt.hasOwnProperty(rt)&&rt!=="layout"&&rt!=="paint"&&rt!=="filter"&&rt!=="metadata"&&rt!=="minzoom"&&rt!=="maxzoom"&&rt!=="slot"&&(rt.indexOf("paint.")===0?ad(tt[rt],ct[rt],_e,Ke,rt.slice(6),ii.setPaintProperty):o.bh(tt[rt],ct[rt])||_e.push({command:ii.setLayerProperty,args:[Ke,rt,ct[rt]]}))}else _e.push({command:ii.removeLayer,args:[Ke]}),st=De[De.lastIndexOf(Ke)+1],_e.push({command:ii.addLayer,args:[ct,st]})}(oe,W.layers,$)}catch(J){console.warn("Unable to compute style diff:",J),$=[{command:ii.setStyle,args:[W]}]}return $}(this.serialize(),u).filter(F=>!(F.command in Fc));if(w.length===0)return!1;const E=w.filter(F=>!(F.command in Ba));if(E.length>0)throw new Error(`Unimplemented: ${E.map(F=>F.command).join(", ")}.`);const P=[];return w.forEach(F=>{P.push(this[F.command].apply(this,F.args))}),p&&Promise.all(P).then(p),this.stylesheet=u,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(u,p){return this.getImage(u)?this.fire(new o.t(new Error("An image with this name already exists."))):(this.imageManager.addImage(u,this.scope,p),this._afterImageUpdated(u),this)}updateImage(u,p){this.imageManager.updateImage(u,this.scope,p)}getImage(u){return this.imageManager.getImage(u,this.scope)}removeImage(u){return this.getImage(u)?(this.imageManager.removeImage(u,this.scope),this._afterImageUpdated(u),this):this.fire(new o.t(new Error("No image with this name exists.")))}_afterImageUpdated(u){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(u),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new o.x("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(u,p,w={}){return this._checkLoaded(),this._validate(nt,`models.${u}`,p,null,w)||(this.modelManager.addModel(u,p,this.scope),this._changes.setDirty()),this}hasModel(u){return this.modelManager.hasModel(u,this.scope)}removeModel(u){return this.hasModel(u)?(this.modelManager.removeModel(u,this.scope),this):this.fire(new o.t(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(u,p,w={}){if(this._checkLoaded(),this.getOwnSource(u)!==void 0)throw new Error(`There is already a source with ID "${u}".`);if(!p.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(p).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(p.type)>=0&&this._validate(Ar,`sources.${u}`,p,null,w))return;this.map&&this.map._collectResourceTiming&&(p.collectResourceTiming=!0);const E=qi(u,p,this.dispatcher,this);E.scope=this.scope,E.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(E.id),source:E.serialize(),sourceId:E.id}));const P=F=>{const W=(F?"symbol:":"other:")+E.id,$=o.av(W,this.scope),J=this._sourceCaches[W]=new Xo($,E,F);(F?this._symbolSourceCaches:this._otherSourceCaches)[E.id]=J,J.onAdd(this.map)};P(!1),p.type!=="vector"&&p.type!=="geojson"||P(!0),E.onAdd&&E.onAdd(this.map),w.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(u){this._checkLoaded();const p=this.getOwnSource(u);if(!p)throw new Error("There is no source with this ID");for(const E in this._layers)if(this._layers[E].source===u)return this.fire(new o.t(new Error(`Source "${u}" cannot be removed while layer "${E}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===u)return this.fire(new o.t(new Error(`Source "${u}" cannot be removed while terrain is using it.`)));const w=this.getOwnSourceCaches(u);for(const E of w){const P=o.cm(E.id);delete this._sourceCaches[P],this._changes.discardSourceCacheUpdate(E.id),E.fire(new o.x("data",{sourceDataType:"metadata",dataType:"source",sourceId:E.getSource().id})),E.setEventedParent(null),E.clearTiles()}return delete this._otherSourceCaches[u],delete this._symbolSourceCaches[u],this.mergeSources(),p.setEventedParent(null),p.onRemove&&p.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(u,p){this._checkLoaded(),this.getOwnSource(u).setData(p),this._changes.setDirty()}getOwnSource(u){const p=this.getOwnSourceCache(u);return p&&p.getSource()}getOwnSources(){const u=[];for(const p in this._otherSourceCaches){const w=this.getOwnSourceCache(p);w&&u.push(w.getSource())}return u}areTilesLoaded(){const u=this._mergedSourceCaches;for(const p in u){const w=u[p]._tiles;for(const E in w){const P=w[E];if(P.state!=="loaded"&&P.state!=="errored")return!1}}return!0}setLights(u){if(this._checkLoaded(),!u)return delete this.ambientLight,void delete this.directionalLight;const p=this._getTransitionParameters();for(const E of u){if(this._validate(cs,"lights",E))return;switch(E.type){case"ambient":if(this.ambientLight){const P=this.ambientLight;P.set(E),P.updateTransitions(p)}else this.ambientLight=new wn(E,_n||(_n=new o.a0({color:new o.a1(o._.properties_light_ambient.color),intensity:new o.a1(o._.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const P=this.directionalLight;P.set(E),P.updateTransitions(p)}else this.directionalLight=new wn(E,zn||(zn=new o.a0({direction:new o.ad(o._.properties_light_directional.direction),color:new o.a1(o._.properties_light_directional.color),intensity:new o.a1(o._.properties_light_directional.intensity),"cast-shadows":new o.a1(o._.properties_light_directional["cast-shadows"]),"shadow-intensity":new o.a1(o._.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const w=new o.a3(this.z||0,p);this.ambientLight&&this.ambientLight.recalculate(w),this.directionalLight&&this.directionalLight.recalculate(w),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const u=this.directionalLight,p=this.ambientLight;if(!u||!p)return;const w=oe=>.2126*(oe[0]<=.03928?oe[0]/12.92:Math.pow((oe[0]+.055)/1.055,2.4))+.7152*(oe[1]<=.03928?oe[1]/12.92:Math.pow((oe[1]+.055)/1.055,2.4))+.0722*(oe[2]<=.03928?oe[2]/12.92:Math.pow((oe[2]+.055)/1.055,2.4)),E=u.properties.get("color").toRenderColor(null).toArray01(),P=u.properties.get("intensity"),F=u.properties.get("direction"),W=1-o.c7(F.x,F.y,F.z)[2]/90,$=w(E)*P*W,J=p.properties.get("color").toRenderColor(null).toArray01(),Q=p.properties.get("intensity");return($+w(J)*Q)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const u=[];return this.directionalLight&&u.push(this.directionalLight.get()),this.ambientLight&&u.push(this.ambientLight.get()),u}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(u){if(!u)return this;if(o.cn(u)){const p=o.co(u),w=this.fragments.find(({id:P})=>P===p);if(!w)throw new Error(`Style import not found: ${u}`);const E=o.cm(u);return w.style.getFragmentStyle(E)}{const p=this.fragments.find(({id:w})=>w===u);if(!p)throw new Error(`Style import not found: ${u}`);return p.style}}getConfigProperty(u,p){const w=this.getFragmentStyle(u);if(!w)return null;const E=o.av(p,w.scope),P=w.options.get(E),F=P?P.value||P.default:null;return F?F.serialize():null}setConfigProperty(u,p,w){const E=this.getFragmentStyle(u);if(!E)return;const P=E.stylesheet.schema;if(!P||!P[p])return;const F=o.M(w);if(F.result!=="success")return void oa(this,F.value);const W=F.value.expression,$=o.av(p,E.scope),J=E.options.get($);if(!J)return;let Q;const{minValue:oe,maxValue:le,stepValue:ue,type:ve,values:_e}=P[p],be=o.M(P[p].default);be.result==="success"&&(Q=be.value.expression),Q?(this.options.set($,{...J,value:W,default:Q,minValue:oe,maxValue:le,stepValue:ue,type:ve,values:_e}),this.updateConfigDependencies(p)):this.fire(new o.t(new Error(`No schema defined for the config option "${p}" in the "${u}" fragment.`)))}getConfig(u){const p=this.getFragmentStyle(u);if(!p)return null;const w=p.stylesheet.schema;if(!w)return null;const E={};for(const P in w){const F=o.av(P,p.scope),W=p.options.get(F),$=W?W.value||W.default:null;E[P]=$?$.serialize():null}return E}setConfig(u,p){const w=this.getFragmentStyle(u);w&&(w.updateConfig(p,w.stylesheet.schema),this.updateConfigDependencies())}getSchema(u){const p=this.getFragmentStyle(u);return p?p.stylesheet.schema:null}setSchema(u,p){const w=this.getFragmentStyle(u);w&&(w.stylesheet.schema=p,w.updateConfig(w._config,p),this.updateConfigDependencies())}updateConfig(u,p){if(this._config=u,u||p)if(p)for(const w in p){let E,P;const F=o.M(p[w].default);if(F.result==="success"&&(E=F.value.expression),u&&u[w]!==void 0){const le=o.M(u[w]);le.result==="success"&&(P=le.value.expression)}const{minValue:W,maxValue:$,stepValue:J,type:Q,values:oe}=p[w];if(E){const le=o.av(w,this.scope);this.options.set(le,{default:E,value:P,minValue:W,maxValue:$,stepValue:J,type:Q,values:oe})}else this.fire(new o.t(new Error(`No schema defined for config option "${w}".`)))}else this.fire(new o.t(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(u){for(const p of this._configDependentLayers){const w=this.getLayer(p);if(w){if(u&&!w.configDependencies.has(u))continue;w.possiblyEvaluateVisibility(),this._updateLayer(w)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.forEachFragmentStyle(p=>{if(p._styleColorTheme.colorTheme){const w=p._evaluateColorThemeData(p._styleColorTheme.colorTheme);(!p._styleColorTheme.lut&&w!==""||p._styleColorTheme.lut&&w!==p._styleColorTheme.lut.data)&&p.setColorTheme(p._styleColorTheme.colorTheme)}}),this._changes.setDirty()}addLayer(u,p,w={}){this._checkLoaded();const E=u.id;if(this._layers[E])return void this.fire(new o.t(new Error(`Layer with id "${E}" already exists on this map`)));let P;if(u.type==="custom"){if(oa(this,o.cp(u)))return;P=o.cq(u,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof u.source=="object"&&(this.addSource(E,u.source),u=o.cl(u),u=o.l(u,{source:E})),this._validate(Tt,`layers.${E}`,u,{arrayIndex:-1},w))return;P=o.cq(u,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(P),P.setEventedParent(this,{layer:{id:E}}),this._serializedLayers[P.id]=P.serialize()}P.configDependencies.size!==0&&this._configDependentLayers.add(P.fqid);let F=this._order.length;if(p){const Q=this._order.indexOf(p);if(Q===-1)return void this.fire(new o.t(new Error(`Layer with id "${p}" does not exist on this map.`)));P.slot===this._layers[p].slot?F=Q:o.w(`Layer with id "${p}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(F,0,E),this._layerOrderChanged=!0,this._layers[E]=P;const W=this.getOwnLayerSourceCache(P),$=!!this.directionalLight&&this.directionalLight.shadowsEnabled();W&&P.canCastShadows()&&$&&(W.castsShadows=!0);const J=this._changes.getRemovedLayer(P);if(J&&P.source&&W&&P.type!=="custom"){this._changes.discardLayerRemoval(P);const Q=o.av(P.source,P.scope);J.type!==P.type?this._changes.updateSourceCache(Q,"clear"):(this._changes.updateSourceCache(Q,"reload"),W.pause())}this._updateLayer(P),P.onAdd&&P.onAdd(this.map),P.scope=this.scope,this.mergeLayers()}moveLayer(u,p){this._checkLoaded();const w=this._checkLayer(u);if(!w||u===p)return;const E=this._order.indexOf(u);this._order.splice(E,1);let P=this._order.length;if(p){const F=this._order.indexOf(p);if(F===-1)return void this.fire(new o.t(new Error(`Layer with id "${p}" does not exist on this map.`)));w.slot===this._layers[p].slot?P=F:o.w(`Layer with id "${p}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(P,0,u),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(u){this._checkLoaded();const p=this._checkLayer(u);if(!p)return;p.setEventedParent(null);const w=this._order.indexOf(u);this._order.splice(w,1),delete this._layers[u],delete this._serializedLayers[u],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(p.fqid),this._changes.removeLayer(p);const E=this.getOwnLayerSourceCache(p);if(E&&E.castsShadows){let P=!1;for(const F in this._layers)if(this._layers[F].source===p.source&&this._layers[F].canCastShadows()){P=!0;break}E.castsShadows=P}p.onRemove&&p.onRemove(this.map),this.mergeLayers()}getOwnLayer(u){return this._layers[u]}hasLayer(u){return u in this._mergedLayers}hasLayerType(u){for(const p in this._layers)if(this._layers[p].type===u)return!0;return!1}setLayerZoomRange(u,p,w){this._checkLoaded();const E=this._checkLayer(u);E&&(E.minzoom===p&&E.maxzoom===w||(p!=null&&(E.minzoom=p),w!=null&&(E.maxzoom=w),this._updateLayer(E)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(u,p){this._checkLoaded();const w=this._checkLayer(u);w&&w.slot!==p&&(w.slot=p,this._updateLayer(w))}setFilter(u,p,w={}){this._checkLoaded();const E=this._checkLayer(u);if(E&&!o.bh(E.filter,p))return p==null?(E.filter=void 0,void this._updateLayer(E)):void(this._validate(xe,`layers.${E.id}.filter`,p,{layerType:E.type},w)||(E.filter=o.cl(p),this._updateLayer(E)))}getFilter(u){const p=this._checkLayer(u);if(p)return o.cl(p.filter)}setLayoutProperty(u,p,w,E={}){this._checkLoaded();const P=this._checkLayer(u);if(P&&!o.bh(P.getLayoutProperty(p),w)){if(w!=null&&(!E||E.validate!==!1)&&oa(P,We.call(En,{key:`layers.${u}.layout.${p}`,layerType:P.type,objectKey:p,value:w,styleSpec:o._,style:{glyphs:!0,sprite:!0}})))return;P.setLayoutProperty(p,w),P.configDependencies.size!==0&&this._configDependentLayers.add(P.fqid),this._updateLayer(P)}}getLayoutProperty(u,p){const w=this._checkLayer(u);if(w)return w.getLayoutProperty(p)}setPaintProperty(u,p,w,E={}){this._checkLoaded();const P=this._checkLayer(u);if(!P||o.bh(P.getPaintProperty(p),w)||w!=null&&(!E||E.validate!==!1)&&oa(P,Ce.call(En,{key:`layers.${u}.paint.${p}`,layerType:P.type,objectKey:p,value:w,styleSpec:o._})))return;const F=P.setPaintProperty(p,w);P.configDependencies.size!==0&&this._configDependentLayers.add(P.fqid),F&&this._updateLayer(P),this._changes.updatePaintProperties(P)}getPaintProperty(u,p){const w=this._checkLayer(u);if(w)return w.getPaintProperty(p)}setFeatureState(u,p){this._checkLoaded();const w=u.source,E=u.sourceLayer,P=this._checkSource(w);if(!P)return;const F=P.type;if(F==="geojson"&&E)return void this.fire(new o.t(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(F==="vector"&&!E)return void this.fire(new o.t(new Error("The sourceLayer parameter must be provided for vector source types.")));u.id===void 0&&this.fire(new o.t(new Error("The feature id parameter must be provided.")));const W=this.getOwnSourceCaches(w);for(const $ of W)$.setFeatureState(E,u.id,p)}removeFeatureState(u,p){this._checkLoaded();const w=u.source,E=this._checkSource(w);if(!E)return;const P=E.type,F=P==="vector"?u.sourceLayer:void 0;if(P==="vector"&&!F)return void this.fire(new o.t(new Error("The sourceLayer parameter must be provided for vector source types.")));if(p&&typeof u.id!="string"&&typeof u.id!="number")return void this.fire(new o.t(new Error("A feature id is required to remove its specific state property.")));const W=this.getOwnSourceCaches(w);for(const $ of W)$.removeFeatureState(F,u.id,p)}getFeatureState(u){this._checkLoaded();const p=u.source,w=u.sourceLayer,E=this._checkSource(p);if(E){if(E.type!=="vector"||w)return u.id===void 0&&this.fire(new o.t(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(p)[0].getFeatureState(w,u.id);this.fire(new o.t(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(u){return this.stylesheet.transition=o.l({},this.stylesheet.transition,u),this.transition=this.stylesheet.transition,this}getTransition(){return o.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();const u=this.getTerrain(),p=u&&this.terrain&&this.terrain.scope===this.scope?u:this.stylesheet.terrain;return o.cr({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:p,fog:this.stylesheet.fog,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},w=>w!==void 0)}_updateLayer(u){this._changes.updateLayer(u);const p=this.getLayerSourceCache(u),w=o.av(u.source,u.scope),E=this._changes.getUpdatedSourceCaches();u.source&&!E[w]&&p&&p.getSource().type!=="raster"&&(this._changes.updateSourceCache(w,"reload"),p.pause()),u.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(u){const p=W=>this._mergedLayers[W].is3D(),w=this.order,E={},P=[];for(let W=w.length-1;W>=0;W--){const $=w[W];if(p($)){E[$]=W;for(const J of u){const Q=J[$];if(Q)for(const oe of Q)P.push(oe)}}}P.sort((W,$)=>$.intersectionZ-W.intersectionZ);const F=[];for(let W=w.length-1;W>=0;W--){const $=w[W];if(p($))for(let J=P.length-1;J>=0;J--){const Q=P[J].feature;if(Q.layer&&E[Q.layer.id]<W)break;F.push(Q),P.pop()}else for(const J of u){const Q=J[$];if(Q)for(const oe of Q)F.push(oe.feature)}}return F}queryRenderedFeatures(u,p,w){p&&p.filter&&this._validate(xe,"queryRenderedFeatures.filter",p.filter,null,p),p.scope=this.scope,p.availableImages=this._availableImages,p.serializedLayers=this._serializedLayers;const E={};if(p&&p.layers){if(!Array.isArray(p.layers))return this.fire(new o.t(new Error("parameters.layers must be an Array."))),[];for(const J of p.layers){const Q=this._mergedLayers[J];if(!Q)return this.fire(new o.t(new Error(`The layer '${J}' does not exist in the map's style and cannot be queried for features.`))),[];E[Q.source]=!0}}const P=[],F=p.serializedLayers||{},W=p&&p.layers?p.layers.some(J=>{const Q=this.getLayer(J);return Q&&Q.is3D()}):this.has3DLayers(),$=Xn.createFromScreenPoints(u,w);for(const J in this._mergedSourceCaches){const Q=this._mergedSourceCaches[J].getSource();if(!Q||Q.scope!==p.scope)continue;const oe=this._mergedSourceCaches[J].getSource().id;p.layers&&!E[oe]||P.push(gs(this._mergedSourceCaches[J],this._mergedLayers,F,$,p,w,W,!!this.map._showQueryGeometry))}return this.placement&&P.push(function(J,Q,oe,le,ue,ve,_e){const be={},we=ve.queryRenderedSymbols(le),ke=[];for(const Ne of Object.keys(we).map(Number))ke.push(_e[Ne]);ke.sort(Ps);for(const Ne of ke){const De=Ne.featureIndex.lookupSymbolFeatures(we[Ne.bucketInstanceId],Q,Ne.bucketIndex,Ne.sourceLayerIndex,ue.filter,ue.layers,ue.availableImages,J);for(const je in De){const Ge=be[je]=be[je]||[],et=De[je];et.sort((Ke,tt)=>{const ct=Ne.featureSortOrder;if(ct){const st=ct.indexOf(Ke.featureIndex);return ct.indexOf(tt.featureIndex)-st}return tt.featureIndex-Ke.featureIndex});for(const Ke of et)Ge.push(Ke)}}for(const Ne in be)be[Ne].forEach(De=>{const je=De.feature,Ge=oe(J[Ne]);if(!Ge)return;const et=Ge.getFeatureState(je.layer["source-layer"],je.id);je.source=je.layer.source,je.layer["source-layer"]&&(je.sourceLayer=je.layer["source-layer"]),je.state=et});return be}(this._mergedLayers,F,this.getLayerSourceCache.bind(this),$.screenGeometry,p,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(P)}querySourceFeatures(u,p){p&&p.filter&&this._validate(xe,"querySourceFeatures.filter",p.filter,null,p);const w=this.getOwnSourceCaches(u);let E=[];for(const P of w)E=E.concat(Wo(P,p));return E}addSourceType(u,p,w){return ka.getSourceType(u)?w(new Error(`A source type called "${u}" already exists.`)):(ka.setSourceType(u,p),p.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:u,url:p.workerSourceURL},w):w(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(u,p,w={}){this._checkLoaded();const E=this.light.getLight();let P=!1;for(const W in u)if(!o.bh(u[W],E[W])){P=!0;break}if(!P)return;const F=this._getTransitionParameters();this.light.setLight(u,p,w),this.light.updateTransitions(F)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=o.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&o.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(u,p=1){if(this._checkLoaded(),!u)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),p===0&&delete this.terrain,u===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let w=u;const E=u.source==null;if(p===1){if(this.disableElevatedTerrain)return;if(typeof w.source=="object"){const W="terrain-dem-src";this.addSource(W,w.source),w=o.cl(w),w=o.l(w,{source:W})}const P=o.l({},w),F={};if(this.terrain&&E){P.source=this.terrain.get().source;const W=this.terrain?this.getFragmentStyle(this.terrain.scope):null;W&&(F.style=W.serialize())}if(this._validate(Rs,"terrain",P,F))return}if(!this.terrain||this.terrain.scope!==this.scope&&!E||this.terrain&&p!==this.terrain.drapeRenderMode){if(!w)return;this._createTerrain(w,p),this.fire(new o.x("data",{dataType:"style"}))}else{const P=this.terrain,F=P.get();for(const W of Object.keys(o._.terrain))!w.hasOwnProperty(W)&&o._.terrain[W].default&&(w[W]=o._.terrain[W].default);for(const W in u)if(!o.bh(u[W],F[W])){P.set(u,this.options),this.stylesheet.terrain=u;const $=this._getTransitionParameters({duration:0});P.updateTransitions($),this.fire(new o.x("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(u){const p=this.fog=new It(u,this.map.transform,this.scope,this.options);this.stylesheet.fog=p.get();const w=this._getTransitionParameters({duration:0});p.updateTransitions(w)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const u of this.map._markers)u._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(u){if(this._checkLoaded(),!u)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const p=this.fog;if(!o.bh(p.get(),u)){p.set(u,this.options),this.stylesheet.fog=p.get();const w=this._getTransitionParameters({duration:0});p.updateTransitions(w)}}else this._createFog(u);this._markersNeedUpdate=!0}setColorTheme(u){this._checkLoaded();const p=()=>{for(const E in this._layers)this._layers[E].lut=this._styleColorTheme.lut;for(const E in this._sourceCaches)this._sourceCaches[E].clearTiles()};if(this._styleColorTheme.colorTheme=u,!u)return this._styleColorTheme.lut=null,void p();const w=this._evaluateColorThemeData(u);this._loadColorTheme(w).then(()=>{this.fire(new o.x("colorthemeset")),p()}).catch(E=>{o.w(`Couldn't set color theme: ${E}`)})}_getTransitionParameters(u){return{now:o.q.now(),transition:o.l(this.transition,u)}}updateDrapeFirstLayers(){if(!this.terrain)return;const u=[],p=[];for(const w of this._mergedOrder)this.isLayerDraped(this._mergedLayers[w])?u.push(w):p.push(w);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...u),this._drapedFirstOrder.push(...p)}_createTerrain(u,p){const w=this.terrain=new zt(u,p,this.scope,this.options);p===1&&(this.stylesheet.terrain=u),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const E=this._getTransitionParameters({duration:0});w.updateTransitions(E)}_force3DLayerUpdate(){for(const u in this._layers){const p=this._layers[u];p.type==="fill-extrusion"&&this._updateLayer(p)}}_forceSymbolLayerUpdate(){for(const u in this._layers){const p=this._layers[u];p.type==="symbol"&&this._updateLayer(p)}}_validate(u,p,w,E,P={}){if(P&&P.validate===!1)return!1;const F=o.l({},this.serialize());return oa(this,u.call(En,o.l({key:p,style:F,value:w,styleSpec:o._},E)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.cs.off("pluginStateChange",this._rtlTextPluginCallback);for(const u in this._mergedLayers)this._mergedLayers[u].setEventedParent(null);for(const u in this._mergedSourceCaches)this._mergedSourceCaches[u].clearTiles(),this._mergedSourceCaches[u].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(u){const p=this.getSourceCaches(u);for(const w of p)w.clearTiles()}clearSources(){for(const u in this._mergedSourceCaches)this._mergedSourceCaches[u].clearTiles()}reloadSource(u){const p=this.getSourceCaches(u);for(const w of p)w.resume(),w.reload()}reloadSources(){for(const u of this.getSources())u.reload&&u.reload()}updateSources(u){let p;this.directionalLight&&(p=Xh(this.directionalLight));for(const w in this._mergedSourceCaches)this._mergedSourceCaches[w].update(u,void 0,void 0,p)}_generateCollisionBoxes(){for(const u in this._sourceCaches){const p=this._sourceCaches[u];p.resume(),p.reload()}}_updatePlacement(u,p,w,E,P,F,W=!1){let $=!1,J=!1;const Q={},oe={};for(const le of this._mergedOrder){const ue=this._mergedLayers[le];if(ue.type!=="symbol")continue;const ve=o.av(ue.source,ue.scope);let _e=Q[ve];if(!_e){const we=this.getLayerSourceCache(ue);if(!we)continue;const ke=we.getRenderableIds(!0).map(Ne=>we.getTileByID(Ne));oe[ve]=ke.slice(),_e=Q[ve]=ke.sort((Ne,De)=>De.tileID.overscaledZ-Ne.tileID.overscaledZ||(Ne.tileID.isLessThan(De.tileID)?-1:1))}const be=this.crossTileSymbolIndex.addLayer(ue,_e,p.center.lng,p.projection);$=$||be}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),W=W||this._layerOrderChanged||E===0,this._layerOrderChanged&&this.fire(new o.x("neworder")),(W||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.q.now(),p.zoom))&&(this.pauseablePlacement=new hd(p,this._mergedOrder,W,w,E,P,this.placement,this.fog&&p.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,Q,oe),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.q.now()),J=!0),$&&this.pauseablePlacement.placement.setStale()),J||$){this._buildingIndex.onNewFrame(p.zoom);for(let le=0;le<this._mergedOrder.length;le++){const ue=this._mergedLayers[this._mergedOrder[le]];if(ue.type!=="symbol")continue;const ve=this.isLayerClipped(ue);this.placement.updateLayerOpacities(ue,Q[o.av(ue.source,ue.scope)],le,ve?F:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.q.now())}}_releaseSymbolFadeTiles(){for(const u in this._sourceCaches)this._sourceCaches[u].releaseSymbolFadeTiles()}addImport(u,p){this._checkLoaded();const w=this.stylesheet.imports=this.stylesheet.imports||[];if(w.findIndex(({id:P})=>P===u.id)!==-1)return void this.fire(new o.t(new Error(`Import with id '${u.id}' already exists in the map's style.`)));if(!p)return w.push(u),this._loadImports([u],!0);const E=w.findIndex(({id:P})=>P===p);return E===-1&&this.fire(new o.t(new Error(`Import with id "${p}" does not exist on this map.`))),this.stylesheet.imports=w.slice(0,E).concat(u).concat(w.slice(E)),this._loadImports([u],!0,p)}updateImport(u,p){this._checkLoaded();const w=this.stylesheet.imports||[],E=this.getImportIndex(u);return E===-1?this:typeof p=="string"?(this.setImportUrl(u,p),this):(p.url&&p.url!==w[E].url&&this.setImportUrl(u,p.url),o.bh(p.config,w[E].config)||this.setImportConfig(u,p.config),o.bh(p.data,w[E].data)||this.setImportData(u,p.data),this)}moveImport(u,p){this._checkLoaded();let w=this.stylesheet.imports||[];const E=this.getImportIndex(u);if(E===-1)return this;const P=this.getImportIndex(p);if(P===-1)return this;const F=w[E],W=this.fragments[E];return w=w.filter(({id:$})=>$!==u),this.fragments=this.fragments.filter(({id:$})=>$!==u),this.stylesheet.imports=w.slice(0,P).concat(F).concat(w.slice(P)),this.fragments=this.fragments.slice(0,P).concat(W).concat(this.fragments.slice(P)),this.mergeLayers(),this}setImportUrl(u,p){this._checkLoaded();const w=this.stylesheet.imports||[],E=this.getImportIndex(u);if(E===-1)return this;w[E].url=p;const P=this.fragments[E];return P.style=this._createFragmentStyle(w[E]),P.style.on("style.import.load",()=>this.mergeAll()),P.style.loadURL(p),this}setImportData(u,p){this._checkLoaded();const w=this.getImportIndex(u),E=this.stylesheet.imports||[];return w===-1?this:p?(this.fragments[w].style.setState(p),this._reloadImports(),this):(delete E[w].data,this.setImportUrl(u,E[w].url))}setImportConfig(u,p){this._checkLoaded();const w=this.getImportIndex(u),E=this.stylesheet.imports||[];if(w===-1)return this;p?E[w].config=p:delete E[w].config;const P=this.fragments[w],F=P.style.stylesheet&&P.style.stylesheet.schema;return P.config=p,P.style.updateConfig(p,F),this.updateConfigDependencies(),this}removeImport(u){this._checkLoaded();const p=this.stylesheet.imports||[],w=this.getImportIndex(u);w!==-1&&(p.splice(w,1),this.fragments[w].style._remove(),this.fragments.splice(w,1),this._reloadImports())}getImportIndex(u){const p=(this.stylesheet.imports||[]).findIndex(w=>w.id===u);return p===-1&&this.fire(new o.t(new Error(`Import '${u}' does not exist in the map's style and cannot be updated.`))),p}getLayer(u){return this._mergedLayers[u]}getSources(){const u=[];for(const p in this._mergedOtherSourceCaches){const w=this._mergedOtherSourceCaches[p];w&&u.push(w.getSource())}return u}getSource(u,p){const w=this.getSourceCache(u,p);return w&&w.getSource()}getLayerSource(u){const p=this.getLayerSourceCache(u);return p&&p.getSource()}getSourceCache(u,p){const w=o.av(u,p);return this._mergedOtherSourceCaches[w]}getLayerSourceCache(u){const p=o.av(u.source,u.scope);return u.type==="symbol"?this._mergedSymbolSourceCaches[p]:this._mergedOtherSourceCaches[p]}getSourceCaches(u){if(u==null)return Object.values(this._mergedSourceCaches);const p=[];return this._mergedOtherSourceCaches[u]&&p.push(this._mergedOtherSourceCaches[u]),this._mergedSymbolSourceCaches[u]&&p.push(this._mergedSymbolSourceCaches[u]),p}updateSourceCaches(){const u=this._changes.getUpdatedSourceCaches();for(const p in u){const w=u[p];w==="reload"?this.reloadSource(p):w==="clear"&&this.clearSource(p)}}updateLayers(u){const p=this._changes.getUpdatedPaintProperties();for(const w of p){const E=this.getLayer(w);E&&E.updateTransitions(u)}}getImages(u,p,w){this.imageManager.getImages(p.icons,p.scope,w),this._updateTilesForChangedImages();const E=P=>{P&&P.setDependencies(p.tileID.key,p.type,p.icons)};E(this._otherSourceCaches[p.source]),E(this._symbolSourceCaches[p.source])}getGlyphs(u,p,w){this.glyphManager.getGlyphs(p.stacks,p.scope,w)}getResource(u,p,w){return o.ct(p,w)}getOwnSourceCache(u){return this._otherSourceCaches[u]}getOwnLayerSourceCache(u){return u.type==="symbol"?this._symbolSourceCaches[u.source]:this._otherSourceCaches[u.source]}getOwnSourceCaches(u){const p=[];return this._otherSourceCaches[u]&&p.push(this._otherSourceCaches[u]),this._symbolSourceCaches[u]&&p.push(this._symbolSourceCaches[u]),p}_isSourceCacheLoaded(u){const p=this.getOwnSourceCaches(u);return p.length===0?(this.fire(new o.t(new Error(`There is no source with ID '${u}'`))),!1):p.every(w=>w.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(u,p){if(!this._clipLayerPresent&&u.type!=="fill-extrusion")return!1;const w=u.type==="fill-extrusion"&&u.sourceLayer==="building";if(u.is3D()){if(w||p&&p.type==="batched-model"||u.type==="model")return!0}else if(u.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(u=>{u.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}ka.getSourceType=function(b){return Qn[b]},ka.setSourceType=function(b,u){Qn[b]=u},ka.registerForPluginStateChange=o.cc;var qh=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,cg=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Pp=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Ts="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Lp=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,ug=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,hg=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Dp=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Ya=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Zh=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Ms=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Lo=[];Vs(qh,Lo),Vs(Pp,Lo),Vs(cg,Lo);const Zs={"_prelude_fog.vertex.glsl":ug,"_prelude_terrain.vertex.glsl":Lp,"_prelude_shadow.vertex.glsl":Zh,"_prelude_fog.fragment.glsl":hg,"_prelude_shadow.fragment.glsl":Ms,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Dp,"_prelude_raster_particle.glsl":Ya},gu={};Kr("",Lp),Kr(hg,ug),Kr(Ms,Zh),Kr(Dp,""),Kr(Ya,"");const vu=Kr(cg,Pp),ju=qh;var Wu={background:Kr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Kr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Kr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float opacity_t=smoothstep((1.0-blur_positive)*antialiased_blur,blur_positive*antialiased_blur,extrude_length-1.0)-smoothstep(0.0,antialiasblur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Kr("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Kr(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Kr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Kr("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Kr("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Kr("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Kr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Kr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Kr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Kr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Kr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Kr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Kr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Kr(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Kr(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Kr(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Kr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Kr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=out_color.a;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trim_alpha,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in float a_z_offset;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#ifdef ELEVATED_ROADS
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset+0.01*step(0.01,a_z_offset),1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Kr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LINE_JOIN_NONE
float pattern_len=pattern_size/aspect;float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in float a_z_offset;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#ifdef ELEVATED_ROADS
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset+0.01*step(0.01,a_z_offset),1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef LINE_JOIN_NONE
v_width=floorwidth+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Kr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Kr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Kr("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Kr("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Kr(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Kr(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+(u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#else
z+=u_pitch_with_map ? (u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
}`),terrainRaster:Kr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Kr("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Kr(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Ts),skyboxGradient:Kr(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Ts),skyboxCapture:Kr(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Kr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Kr(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Kr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Kr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Kr(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),occlusion:Kr("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Vs(b,u){const p=b.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let w of p)if(w=w.trim(),w[0]==="#"&&w.includes("if")&&!w.includes("endif")){w=w.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const E=w.split(" ");for(const P of E)u.includes(P)||u.push(P)}}function Kr(b,u){const p=/#include\s+"([^"]+)"/g,w=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let E=u.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);E&&(E=E.map(J=>{const Q=J.split(" ");return Q[Q.length-1]}),E=[...new Set(E)]);const P={},F=[],W=[];if(b=b.replace(p,(J,Q)=>(W.push(Q),"")),(u=u.replace(p,(J,Q)=>(F.push(Q),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let $=[...Lo];Vs(b,$),Vs(u,$);for(const J of[...F,...W])Zs[J]||console.error(`Undefined include: ${J}`),gu[J]||(gu[J]=[],Vs(Zs[J],gu[J])),$=[...$,...gu[J]];return{fragmentSource:b=b.replace(w,(J,Q,oe,le,ue)=>(P[ue]=!0,Q==="define"?`
#ifndef HAS_UNIFORM_u_${ue}
in ${oe} ${le} ${ue};
#else
uniform ${oe} ${le} u_${ue};
#endif
`:Q==="initialize"?`
#ifdef HAS_UNIFORM_u_${ue}
    ${oe} ${le} ${ue} = u_${ue};
#endif
`:Q==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${ue}
    in ${oe} ${le} ${ue};
#endif
`:Q==="initialize-attribute"?"":void 0)),vertexSource:u=u.replace(w,(J,Q,oe,le,ue)=>{const ve=le==="float"?"vec2":le,_e=ue.match(/color/)?"color":ve;return Q==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${ue}
in ${oe} ${le} a_${ue};
#endif
`:P[ue]?Q==="define"?`
#ifndef HAS_UNIFORM_u_${ue}
uniform lowp float u_${ue}_t;
in ${oe} ${ve} a_${ue};
out ${oe} ${le} ${ue};
#else
uniform ${oe} ${le} u_${ue};
#endif
`:Q==="initialize"?_e==="vec4"?`
#ifndef HAS_UNIFORM_u_${ue}
    ${ue} = a_${ue};
#else
    ${oe} ${le} ${ue} = u_${ue};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ue}
    ${ue} = unpack_mix_${_e}(a_${ue}, u_${ue}_t);
#else
    ${oe} ${le} ${ue} = u_${ue};
#endif
`:Q==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${ue}
    in ${oe} ${le} a_${ue};
    out ${oe} ${le} ${ue};
#endif
`:Q==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${ue}
    ${ue} = a_${ue};
#endif
`:void 0:Q==="define"?`
#ifndef HAS_UNIFORM_u_${ue}
uniform lowp float u_${ue}_t;
in ${oe} ${ve} a_${ue};
#else
uniform ${oe} ${le} u_${ue};
#endif
`:Q==="define-instanced"?_e==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${ue}0;
in vec4 a_${ue}1;
in vec4 a_${ue}2;
in vec4 a_${ue}3;
#else
uniform ${oe} ${le} u_${ue};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${oe} ${ve} a_${ue};
#else
uniform ${oe} ${le} u_${ue};
#endif
`:Q==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${ue}
    ${oe} ${le} ${ue} = a_${ue};
#endif
`:_e==="vec4"?`
#ifndef HAS_UNIFORM_u_${ue}
    ${oe} ${le} ${ue} = a_${ue};
#else
    ${oe} ${le} ${ue} = u_${ue};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ue}
    ${oe} ${le} ${ue} = unpack_mix_${_e}(a_${ue}, u_${ue}_t);
#else
    ${oe} ${le} ${ue} = u_${ue};
#endif
`}),staticAttributes:E,usedDefines:$,vertexIncludes:F,fragmentIncludes:W}}class Xu{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(u,p,w,E,P,F,W,$){this.context=u;let J=this.boundPaintVertexBuffers.length!==E.length;for(let oe=0;!J&&oe<E.length;oe++)this.boundPaintVertexBuffers[oe]!==E[oe]&&(J=!0);let Q=this.boundDynamicVertexBuffers.length!==W.length;for(let oe=0;!Q&&oe<W.length;oe++)this.boundDynamicVertexBuffers[oe]!==W[oe]&&(Q=!0);if(!this.vao||this.boundProgram!==p||this.boundLayoutVertexBuffer!==w||J||Q||this.boundIndexBuffer!==P||this.boundVertexOffset!==F)this.freshBind(p,w,E,P,F,W,$);else{u.bindVertexArrayOES.set(this.vao);for(const oe of W)oe&&(oe.bind(),$&&oe.instanceCount&&oe.setVertexAttribDivisor(u.gl,p,$));P&&P.dynamicDraw&&P.bind()}}freshBind(u,p,w,E,P,F,W){const $=u.numAttributes,J=this.context,Q=J.gl;this.vao&&this.destroy(),this.vao=J.gl.createVertexArray(),J.bindVertexArrayOES.set(this.vao),this.boundProgram=u,this.boundLayoutVertexBuffer=p,this.boundPaintVertexBuffers=w,this.boundIndexBuffer=E,this.boundVertexOffset=P,this.boundDynamicVertexBuffers=F,p.enableAttributes(Q,u),p.bind(),p.setVertexAttribPointers(Q,u,P);for(const oe of w)oe.enableAttributes(Q,u),oe.bind(),oe.setVertexAttribPointers(Q,u,P);for(const oe of F)oe&&(oe.enableAttributes(Q,u),oe.bind(),oe.setVertexAttribPointers(Q,u,P),W&&oe.instanceCount&&oe.setVertexAttribDivisor(Q,u,W));E&&E.bind(),J.currentNumAttributes=$}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Yh(b,u){const p=Math.pow(2,u.canonical.z),w=u.canonical.y;return[new o.a5(0,w/p).toLngLat().lat,new o.a5(0,(w+1)/p).toLngLat().lat]}function Tl(b,u,p,w,E,P,F){const W=b.context,$=W.gl,J=p.hillshadeFBO;if(!J)return;b.prepareDrawTile();const Q=b.isTileAffectedByFog(u),oe=b.getOrCreateProgram("hillshade",{overrideFog:Q});W.activeTexture.set($.TEXTURE0),$.bindTexture($.TEXTURE_2D,J.colorAttachment.get());const le=((be,we,ke,Ne)=>{const De=ke.paint.get("hillshade-shadow-color"),je=ke.paint.get("hillshade-highlight-color"),Ge=ke.paint.get("hillshade-accent-color"),et=ke.paint.get("hillshade-emissive-strength");let Ke=o.bB(ke.paint.get("hillshade-illumination-direction"));if(ke.paint.get("hillshade-illumination-anchor")==="viewport")Ke-=be.transform.angle;else if(be.style&&be.style.enable3dLights()&&be.style.directionalLight){const ct=be.style.directionalLight.properties.get("direction"),st=o.c7(ct.x,ct.y,ct.z);Ke=o.bB(st[1])}const tt=!be.options.moving;return{u_matrix:Ne||be.transform.calculateProjMatrix(we.tileID.toUnwrapped(),tt),u_image:0,u_latrange:Yh(0,we.tileID),u_light:[ke.paint.get("hillshade-exaggeration"),Ke],u_shadow:De.toRenderColor(ke.lut),u_highlight:je.toRenderColor(ke.lut),u_emissive_strength:et,u_accent:Ge.toRenderColor(ke.lut)}})(b,p,w,b.terrain?u.projMatrix:null);b.uploadCommonUniforms(W,oe,u.toUnwrapped());const{tileBoundsBuffer:ue,tileBoundsIndexBuffer:ve,tileBoundsSegments:_e}=b.getTileBoundsBuffers(p);oe.draw(b,$.TRIANGLES,E,P,F,_r.disabled,le,w.id,ue,ve,_e)}function cl(b,u,p){if(!u.needsDEMTextureUpload)return;const w=b.context,E=w.gl;w.pixelStoreUnpackPremultiplyAlpha.set(!1),u.demTexture=u.demTexture||b.getTileTexture(p.stride);const P=p.getPixels();u.demTexture?u.demTexture.update(P,{premultiply:!1}):u.demTexture=new o.T(w,P,E.R32F,{premultiply:!1}),u.needsDEMTextureUpload=!1}function rc(b,u,p){const w=b.context,E=w.gl;if(!u.dem)return;const P=u.dem;if(w.activeTexture.set(E.TEXTURE1),cl(b,u,P),!u.demTexture)return;u.demTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE);const F=P.dim;w.activeTexture.set(E.TEXTURE0);let W=u.hillshadeFBO;if(!W){const le=new o.T(w,{width:F,height:F,data:null},E.RGBA8);le.bind(E.LINEAR,E.CLAMP_TO_EDGE),W=u.hillshadeFBO=w.createFramebuffer(F,F,!0,"renderbuffer"),W.colorAttachment.set(le.texture)}w.bindFramebuffer.set(W.framebuffer),w.viewport.set([0,0,F,F]);const{tileBoundsBuffer:$,tileBoundsIndexBuffer:J,tileBoundsSegments:Q}=b.getMercatorTileBoundsBuffers(),oe=[];b.linearFloatFilteringSupported()&&oe.push("TERRAIN_DEM_FLOAT_FORMAT"),b.getOrCreateProgram("hillshadePrepare",{defines:oe}).draw(b,E.TRIANGLES,$n.disabled,pr.disabled,Mr.unblended,_r.disabled,((le,ue)=>{const ve=ue.stride,_e=o.a6.mat4.create();return o.a6.mat4.ortho(_e,0,o.ab,-o.ab,0,0,1),o.a6.mat4.translate(_e,_e,[0,-o.ab,0]),{u_matrix:_e,u_image:1,u_dimension:[ve,ve],u_zoom:le.overscaledZ}})(u.tileID,P),p.id,$,J,Q),u.needsHillshadePrepare=!1}class yi{constructor(u){this.gl=u.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(u){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class pd extends yi{getDefault(){return o.bz.transparent}set(u){const p=this.current;(u.r!==p.r||u.g!==p.g||u.b!==p.b||u.a!==p.a||this.dirty)&&(this.gl.clearColor(u.r,u.g,u.b,u.a),this.current=u,this.dirty=!1)}}class kv extends yi{getDefault(){return 1}set(u){(u!==this.current||this.dirty)&&(this.gl.clearDepth(u),this.current=u,this.dirty=!1)}}class fg extends yi{getDefault(){return 0}set(u){(u!==this.current||this.dirty)&&(this.gl.clearStencil(u),this.current=u,this.dirty=!1)}}class Bp extends yi{getDefault(){return[!0,!0,!0,!0]}set(u){const p=this.current;(u[0]!==p[0]||u[1]!==p[1]||u[2]!==p[2]||u[3]!==p[3]||this.dirty)&&(this.gl.colorMask(u[0],u[1],u[2],u[3]),this.current=u,this.dirty=!1)}}class md extends yi{getDefault(){return!0}set(u){(u!==this.current||this.dirty)&&(this.gl.depthMask(u),this.current=u,this.dirty=!1)}}class Ov extends yi{getDefault(){return 255}set(u){(u!==this.current||this.dirty)&&(this.gl.stencilMask(u),this.current=u,this.dirty=!1)}}class Fv extends yi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(u){const p=this.current;(u.func!==p.func||u.ref!==p.ref||u.mask!==p.mask||this.dirty)&&(this.gl.stencilFunc(u.func,u.ref,u.mask),this.current=u,this.dirty=!1)}}class dg extends yi{getDefault(){const u=this.gl;return[u.KEEP,u.KEEP,u.KEEP]}set(u){const p=this.current;(u[0]!==p[0]||u[1]!==p[1]||u[2]!==p[2]||this.dirty)&&(this.gl.stencilOp(u[0],u[1],u[2]),this.current=u,this.dirty=!1)}}class Nc extends yi{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const p=this.gl;u?p.enable(p.STENCIL_TEST):p.disable(p.STENCIL_TEST),this.current=u,this.dirty=!1}}class Nv extends yi{getDefault(){return[0,1]}set(u){const p=this.current;(u[0]!==p[0]||u[1]!==p[1]||this.dirty)&&(this.gl.depthRange(u[0],u[1]),this.current=u,this.dirty=!1)}}class pg extends yi{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const p=this.gl;u?p.enable(p.DEPTH_TEST):p.disable(p.DEPTH_TEST),this.current=u,this.dirty=!1}}class mg extends yi{getDefault(){return this.gl.LESS}set(u){(u!==this.current||this.dirty)&&(this.gl.depthFunc(u),this.current=u,this.dirty=!1)}}class zv extends yi{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const p=this.gl;u?p.enable(p.BLEND):p.disable(p.BLEND),this.current=u,this.dirty=!1}}class Kh extends yi{getDefault(){const u=this.gl;return[u.ONE,u.ZERO,u.ONE,u.ZERO]}set(u){const p=this.current;(u[0]!==p[0]||u[1]!==p[1]||u[2]!==p[2]||u[3]!==p[3]||this.dirty)&&(this.gl.blendFuncSeparate(u[0],u[1],u[2],u[3]),this.current=u,this.dirty=!1)}}class gg extends yi{getDefault(){return o.bz.transparent}set(u){const p=this.current;(u.r!==p.r||u.g!==p.g||u.b!==p.b||u.a!==p.a||this.dirty)&&(this.gl.blendColor(u.r,u.g,u.b,u.a),this.current=u,this.dirty=!1)}}class vg extends yi{getDefault(){return this.gl.FUNC_ADD}set(u){(u!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(u,u),this.current=u,this.dirty=!1)}}class _g extends yi{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const p=this.gl;u?p.enable(p.CULL_FACE):p.disable(p.CULL_FACE),this.current=u,this.dirty=!1}}class Uv extends yi{getDefault(){return this.gl.BACK}set(u){(u!==this.current||this.dirty)&&(this.gl.cullFace(u),this.current=u,this.dirty=!1)}}class yg extends yi{getDefault(){return this.gl.CCW}set(u){(u!==this.current||this.dirty)&&(this.gl.frontFace(u),this.current=u,this.dirty=!1)}}let Ax=class extends yi{getDefault(){return null}set(b){(b!==this.current||this.dirty)&&(this.gl.useProgram(b),this.current=b,this.dirty=!1)}};class gd extends yi{getDefault(){return this.gl.TEXTURE0}set(u){(u!==this.current||this.dirty)&&(this.gl.activeTexture(u),this.current=u,this.dirty=!1)}}class kp extends yi{getDefault(){const u=this.gl;return[0,0,u.drawingBufferWidth,u.drawingBufferHeight]}set(u){const p=this.current;(u[0]!==p[0]||u[1]!==p[1]||u[2]!==p[2]||u[3]!==p[3]||this.dirty)&&(this.gl.viewport(u[0],u[1],u[2],u[3]),this.current=u,this.dirty=!1)}}class Vv extends yi{getDefault(){return null}set(u){if(u===this.current&&!this.dirty)return;const p=this.gl;p.bindFramebuffer(p.FRAMEBUFFER,u),this.current=u,this.dirty=!1}}class ul extends yi{getDefault(){return null}set(u){if(u===this.current&&!this.dirty)return;const p=this.gl;p.bindRenderbuffer(p.RENDERBUFFER,u),this.current=u,this.dirty=!1}}class Gv extends yi{getDefault(){return null}set(u){if(u===this.current&&!this.dirty)return;const p=this.gl;p.bindTexture(p.TEXTURE_2D,u),this.current=u,this.dirty=!1}}class Op extends yi{getDefault(){return null}set(u){if(u===this.current&&!this.dirty)return;const p=this.gl;p.bindBuffer(p.ARRAY_BUFFER,u),this.current=u,this.dirty=!1}}class Fp extends yi{getDefault(){return null}set(u){const p=this.gl;p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,u),this.current=u,this.dirty=!1}}class xg extends yi{getDefault(){return null}set(u){this.gl&&(u!==this.current||this.dirty)&&(this.gl.bindVertexArray(u),this.current=u,this.dirty=!1)}}class bg extends yi{getDefault(){return 4}set(u){if(u===this.current&&!this.dirty)return;const p=this.gl;p.pixelStorei(p.UNPACK_ALIGNMENT,u),this.current=u,this.dirty=!1}}class Jh extends yi{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const p=this.gl;p.pixelStorei(p.UNPACK_PREMULTIPLY_ALPHA_WEBGL,u),this.current=u,this.dirty=!1}}class Hv extends yi{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const p=this.gl;p.pixelStorei(p.UNPACK_FLIP_Y_WEBGL,u),this.current=u,this.dirty=!1}}class Np extends yi{constructor(u,p){super(u),this.context=u,this.parent=p}getDefault(){return null}}class wg extends Np{setDirty(){this.dirty=!0}set(u){if(u===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const p=this.gl;p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,u,0),this.current=u,this.dirty=!1}}class zp extends Np{attachment(){return this.gl.DEPTH_ATTACHMENT}set(u){if(u===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const p=this.gl;p.framebufferRenderbuffer(p.FRAMEBUFFER,this.attachment(),p.RENDERBUFFER,u),this.current=u,this.dirty=!1}}class Sg extends Np{attachment(){return this.gl.DEPTH_ATTACHMENT}set(u){if(u===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const p=this.gl;p.framebufferTexture2D(p.FRAMEBUFFER,this.attachment(),p.TEXTURE_2D,u,0),this.current=u,this.dirty=!1}}class vd extends zp{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const Tx=(b,u,p)=>({u_matrix:b,u_image0:0,u_skirt_height:u,u_ground_shadow_factor:p}),jv=(b,u,p,w,E,P,F,W,$,J,Q,oe,le,ue,ve,_e)=>({u_proj_matrix:Float32Array.from(b),u_globe_matrix:u,u_normalize_matrix:Float32Array.from(w),u_merc_matrix:p,u_zoom_transition:E,u_merc_center:P,u_image0:0,u_frustum_tl:F,u_frustum_tr:W,u_frustum_br:$,u_frustum_bl:J,u_globe_pos:Q,u_globe_radius:oe,u_viewport:le,u_grid_matrix:_e?Float32Array.from(_e):new Float32Array(9),u_skirt_height:ue,u_far_z_cutoff:ve});function Wv(b,u){return b!=null&&u!=null&&!(!b.hasData()||!u.hasData())&&b.demTexture!=null&&u.demTexture!=null&&b.tileID.key!==u.tileID.key}const Qh=new class{constructor(){this.operations={}}newMorphing(b,u,p,w,E){if(b in this.operations){const P=this.operations[b];P.to.tileID.key!==p.tileID.key&&(P.queued=p)}else this.operations[b]={startTime:w,phase:0,duration:E,from:u,to:p,queued:null}}getMorphValuesForProxy(b){if(!(b in this.operations))return null;const u=this.operations[b];return{from:u.from,to:u.to,phase:u.phase}}update(b){for(const u in this.operations){const p=this.operations[u];for(p.phase=(b-p.startTime)/p.duration;p.phase>=1||!this._validOp(p);)if(!this._nextOp(p,b)){delete this.operations[u];break}}}_nextOp(b,u){return!!b.queued&&(b.from=b.to,b.to=b.queued,b.queued=null,b.phase=0,b.startTime=u,!0)}_validOp(b){return b.from.hasData()&&b.to.hasData()}},Xv={0:null,1:"TERRAIN_VERTEX_MORPHING"};function ic(b,u,p){if(u===0)return 0;const w=u<1&&p===514?.25/u:1;return 6*Math.pow(1.5,22-b)*Math.max(u,1)*w}function Ag(b,u){const p=1<<b.z;return!u&&(b.x===0||b.x===p-1)||b.y===0||b.y===p-1}const _u=b=>({u_matrix:b});function $u(b,u,p,w,E){if(E>0){const P=o.q.now(),F=(P-b.timeAdded)/E,W=u?(P-u.timeAdded)/E:-1,$=p.getSource(),J=w.coveringZoomLevel({tileSize:$.tileSize,roundZoom:$.roundZoom}),Q=!u||Math.abs(u.tileID.overscaledZ-J)>Math.abs(b.tileID.overscaledZ-J),oe=Q&&b.refreshedUponExpiration?1:o.ap(Q?F:1-W,0,1);return b.refreshedUponExpiration&&F>=1&&(b.refreshedUponExpiration=!1),u?{opacity:1,mix:1-oe}:{opacity:oe,mix:0}}return{opacity:1,mix:0}}class yu extends Xo{constructor(u){const p={type:"raster-dem",maxzoom:u.transform.maxZoom},w=new o.cd(o.ce(),null),E=qi("mock-dem",p,w,u.style);super("mock-dem",E,!1),E.setEventedParent(this),this._sourceLoaded=!0}_loadTile(u,p){u.state="loaded",p(null)}}class Up extends Xo{constructor(u){const p=qi("proxy",{type:"geojson",maxzoom:u.transform.maxZoom},new o.cd(o.ce(),null),u.style);super("proxy",p,!1),p.setEventedParent(this),this.map=this.getSource().map=u,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(u,p,w){if(u.freezeTileCoverage)return;this.transform=u;const E=u.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((P,F)=>{if(P[F.key]="",!this._tiles[F.key]){const W=new Bc(F,this._source.tileSize*F.overscaleFactor(),u.tileZoom);W.state="loaded",this._tiles[F.key]=W}return P},{});for(const P in this._tiles)P in E||(this.freeFBO(P),this._tiles[P].unloadVectorData(),delete this._tiles[P])}freeFBO(u){const p=this.proxyCachedFBO[u];if(p!==void 0){const w=Object.values(p);this.renderCachePool.push(...w),delete this.proxyCachedFBO[u]}}deallocRenderCache(){this.renderCache.forEach(u=>u.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Tg extends o.aA{constructor(u,p,w){super(u.overscaledZ,u.wrap,u.canonical.z,u.canonical.x,u.canonical.y),this.proxyTileKey=p,this.projMatrix=w}}class ef extends o.cE{constructor(u,p){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},u.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),u.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),u.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=u,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[w,E,P]=function($){const J=new o.a_,Q=new o.aO,oe=131;J.reserve(17161),Q.reserve(33800);const le=o.ab/128,ue=o.ab+le/2,ve=ue+le;for(let be=-le;be<ve;be+=le)for(let we=-le;we<ve;we+=le){const ke=we<0||we>ue||be<0||be>ue?24575:0,Ne=o.ap(Math.round(we),0,o.ab),De=o.ap(Math.round(be),0,o.ab);J.emplaceBack(Ne+ke,De)}const _e=(be,we)=>{const ke=we*oe+be;Q.emplaceBack(ke+1,ke,ke+oe),Q.emplaceBack(ke+oe,ke+oe+1,ke+1)};for(let be=1;be<129;be++)for(let we=1;we<129;we++)_e(we,be);return[0,129].forEach(be=>{for(let we=0;we<130;we++)_e(we,be),_e(be,we)}),[J,Q,32768]}(),F=u.context;this.gridBuffer=F.createVertexBuffer(w,o.b0.members),this.gridIndexBuffer=F.createIndexBuffer(E),this.gridSegments=o.b1.simpleSegment(0,0,w.length,E.length),this.gridNoSkirtSegments=o.b1.simpleSegment(0,0,w.length,P),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Up(p.map),this.orthoMatrix=o.a6.mat4.create(),o.a6.mat4.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,o.ab,0,o.ab,0,1);const W=F.gl;this._overlapStencilMode=new pr({func:W.GEQUAL,mask:255},0,255,W.KEEP,W.KEEP,W.REPLACE),this._previousZoom=u.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=p,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new yu(p.map),this._pendingGroundEffectLayers=[]}set style(u){u.on("data",this._onStyleDataEvent.bind(this)),this._style=u,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(u,p,w){if(u&&u.terrain){this._style!==u&&(this.style=u,this._evaluationZoom=void 0);const E=u.terrain.properties,P=u.terrain.drapeRenderMode===0,F=u.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=o.q.now();const W=u.terrain&&u.terrain.scope,$=E.get("source"),J=P?this._mockSourceCache:u.getSourceCache($,W);if(!J)return void o.w(`Couldn't find terrain source "${$}".`);if(this.sourceCache=J,this._exaggeration=F?this.calculateExaggeration(p):E.get("exaggeration"),!p.projection.requiresDraping&&F&&this._exaggeration===0)return void this._disable();this.enabled=!0;const Q=()=>{this.sourceCache.used&&o.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const oe=this.getScaledDemTileSize();this.sourceCache.update(p,oe,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,Q(),this._initializing=!0),Q(),p.updateElevation(!0,w),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(p),this._emptyDEMTextureDirty=!0,this._previousZoom=p.zoom}else this._disable()}calculateExaggeration(u){const p=this._previousCameraAltitude,w=u.getFreeCameraOptions().position.z/u.pixelsPerMeter*u.worldSize;this._previousCameraAltitude=w;const E=p!=null?w-p:Number.MAX_VALUE;if(Math.abs(E)<2)return this._exaggeration;const P=u.zoom,F=this._style.terrain;if(!this._previousUpdateTimestamp)return F.getExaggeration(P);let W=P-this._previousZoom;const $=this._previousUpdateTimestamp;let J=P;this._evaluationZoom!=null&&(J=this._evaluationZoom,Math.abs(P-J)>.5&&(W=.5*(P-J+W)),W*E<0&&(J+=W)),this._evaluationZoom=J;const Q=F.getExaggeration(J),oe=Q===F.getExaggeration(Math.max(0,J-.1));if(oe&&Math.abs(Q-this._exaggeration)<.01)return Q;let le=Math.min(.1,.00375*(this._updateTimestamp-$));return(oe||Q<.1||Math.abs(W)<1e-4)&&(le=Math.min(.2,4*le)),o.aa(this._exaggeration,Q,le)}resetTileLookupCache(u){this._findCoveringTileCache[u]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(u){u.coord&&u.dataType==="source"?this._clearRenderCacheForTile(u.sourceCacheId,u.coord):u.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const u in this._style._mergedSourceCaches)this._style._mergedSourceCaches[u].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(u=>u.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const u=2*this.proxySourceCache.getSource().tileSize;return[u,u]}set useVertexMorphing(u){this._useVertexMorphing=u}updateTileBinding(u){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const p=this.proxySourceCache,w=this.painter.transform;this._initializing&&(this._initializing=w._centerAltitude===0&&this.getAtPointOrZero(o.a5.fromLngLat(w.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const E=this.proxyCoords=p.getIds().map($=>{const J=p.getTileByID($).tileID;return J.projMatrix=w.calculateProjMatrix(J.toUnwrapped()),J});(function($,J){const Q=J.transform.pointCoordinate(J.transform.getCameraPoint()),oe=new o.P(Q.x,Q.y);$.sort((le,ue)=>{if(ue.overscaledZ-le.overscaledZ)return ue.overscaledZ-le.overscaledZ;const ve=new o.P(le.canonical.x+(1<<le.canonical.z)*le.wrap,le.canonical.y),_e=new o.P(ue.canonical.x+(1<<ue.canonical.z)*ue.wrap,ue.canonical.y),be=oe.mult(1<<le.canonical.z);return be.x-=.5,be.y-=.5,be.distSqr(ve)-be.distSqr(_e)})})(E,this.painter);const P=this.proxyToSource||{};this.proxyToSource={},E.forEach($=>{this.proxyToSource[$.key]={}}),this.terrainTileForTile={};const F=this._style._mergedSourceCaches;for(const $ in F){const J=F[$];if(!J.used||(J!==this.sourceCache&&this.resetTileLookupCache(J.id),this._setupProxiedCoordsForOrtho(J,u[$],P),J.usedForTerrain))continue;const Q=u[$];J.getSource().reparseOverscaled&&this._assignTerrainTiles(Q)}this.proxiedCoords[p.id]=E.map($=>new Tg($,$.key,this.orthoMatrix)),this._assignTerrainTiles(E),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(P),this.renderingToTexture=!1;const W={};this._visibleDemTiles=[];for(const $ of this.proxyCoords){const J=this.terrainTileForTile[$.key];if(!J)continue;const Q=J.tileID.key;Q in W||(this._visibleDemTiles.push(J),W[Q]=Q)}}_assignTerrainTiles(u){this._initializing||u.forEach(p=>{if(this.terrainTileForTile[p.key])return;const w=this._findTileCoveringTileID(p,this.sourceCache);w&&(this.terrainTileForTile[p.key]=w)})}_prepareDEMTextures(){const u=this.painter.context,p=u.gl;for(const w in this.terrainTileForTile){const E=this.terrainTileForTile[w],P=E.dem;!P||E.demTexture&&!E.needsDEMTextureUpload||(u.activeTexture.set(p.TEXTURE1),cl(this.painter,E,P))}}_prepareDemTileUniforms(u,p,w,E){if(!p||p.demTexture==null)return!1;const P=u.tileID.canonical,F=Math.pow(2,p.tileID.canonical.z-P.z),W=E||"";return w[`u_dem_tl${W}`]=[P.x*F%1,P.y*F%1],w[`u_dem_scale${W}`]=F,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let u=0;const p=this._visibleDemTiles.reduce((w,E)=>{if(!E.dem)return w;const P=E.dem.tree.minimums[0];return P>0&&u++,w+P},0);return u?p/u:0}_updateEmptyDEMTexture(){const u=this.painter.context,p=u.gl;u.activeTexture.set(p.TEXTURE2);const w=this._getLoadedAreaMinimum(),E=new o.cF({width:1,height:1},new Float32Array([w]));this._emptyDEMTextureDirty=!1;let P=this._emptyDEMTexture;return P?P.update(E,{premultiply:!1}):P=this._emptyDEMTexture=new o.T(u,E,p.R32F,{premultiply:!1}),P}setupElevationDraw(u,p,w){const E=this.painter.context,P=E.gl,F={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};F.u_exaggeration=this.exaggeration();let W=null,$=null,J=1;if(w&&w.morphing&&this._useVertexMorphing){const ue=w.morphing.srcDemTile,ve=w.morphing.dstDemTile;J=w.morphing.phase,ue&&ve&&(this._prepareDemTileUniforms(u,ue,F,"_prev")&&($=ue),this._prepareDemTileUniforms(u,ve,F)&&(W=ve))}const Q=ue=>ue&&ue.demTexture&&this.painter.linearFloatFilteringSupported()?P.LINEAR:P.NEAREST;let oe=null;var le;if(this.enabled?$&&W?(oe=W.demTexture,E.activeTexture.set(P.TEXTURE4),$.demTexture.bind(Q($),P.CLAMP_TO_EDGE),F.u_dem_lerp=J):(W=this.terrainTileForTile[u.tileID.key],oe=this._prepareDemTileUniforms(u,W,F)?W.demTexture:this.emptyDEMTexture):oe=this.emptyDEMTexture,E.activeTexture.set(P.TEXTURE2),oe&&(F.u_dem_size=(le=oe).size[0]===1?1:le.size[0]-2,oe.bind(Q(W),P.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(w&&w.useDepthForOcclusion,p,F),w&&w.useMeterToDem&&W){const ue=(1<<W.tileID.canonical.z)*o.bD(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;F.u_meter_to_dem=ue}if(w&&w.labelPlaneMatrixInv&&(F.u_label_plane_matrix_inv=w.labelPlaneMatrixInv),p.setTerrainUniformValues(E,F),this.painter.transform.projection.name==="globe"){const ue=this.globeUniformValues(this.painter.transform,u.tileID.canonical,w&&w.useDenormalizedUpVectorScale);p.setGlobeUniformValues(E,ue)}}globeUniformValues(u,p,w){const E=u.projection;return{u_tile_tl_up:E.upVector(p,0,0),u_tile_tr_up:E.upVector(p,o.ab,0),u_tile_br_up:E.upVector(p,o.ab,o.ab),u_tile_bl_up:E.upVector(p,0,o.ab),u_tile_up_scale:w?o.cG(1):E.upVectorScale(p,u.center.lat,u.worldSize).metersToTile}}renderToBackBuffer(u){const p=this.painter,w=this.painter.context;u.length!==0&&(w.bindFramebuffer.set(null),w.viewport.set([0,0,p.width,p.height]),p.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(E,P,F,W,$){if(E.transform.projection.name==="globe")(function(J,Q,oe,le,ue){const ve=J.context,_e=ve.gl;let be,we;const ke=J.transform,Ne=o.cx(J,ve,ke),De=(xt,Ft)=>{if(we===Ft)return;const Zt=[Xv[Ft],"PROJECTION_GLOBE_VIEW"];Ne&&Zt.push("CUSTOM_ANTIALIASING");const kt=J.isTileAffectedByFog(xt);be=J.getOrCreateProgram("globeRaster",{defines:Zt,overrideFog:kt}),we=Ft},je=J.colorModeForRenderPass(),Ge=new $n(_e.LEQUAL,$n.ReadWrite,J.depthRangeFor3D);Qh.update(ue);const et=o.cy(ke),Ke=[o.am(ke.center.lng),o.at(ke.center.lat)],tt=J.globeSharedBuffers,ct=[ke.width*o.q.devicePixelRatio,ke.height*o.q.devicePixelRatio],st=Float32Array.from(ke.globeMatrix),rt={useDenormalizedUpVectorScale:!0};{const xt=J.transform,Ft=ic(xt.zoom,Q.exaggeration(),Q.sourceCache._source.tileSize);we=-1;const Zt=_e.TRIANGLES;for(const kt of le){const hn=oe.getTile(kt),bt=pr.disabled,Wt=Q.prevTerrainTileForTile[kt.key],Vt=Q.terrainTileForTile[kt.key];Wv(Wt,Vt)&&Qh.newMorphing(kt.key,Wt,Vt,ue,250),ve.activeTexture.set(_e.TEXTURE0),hn.texture&&hn.texture.bind(_e.LINEAR,_e.CLAMP_TO_EDGE);const fn=Qh.getMorphValuesForProxy(kt.key),pn=fn?1:0;fn&&o.C(rt,{morphing:{srcDemTile:fn.from,dstDemTile:fn.to,phase:o.cw(fn.phase)}});const qt=o.cz(kt.canonical),en=o.cA(qt.getCenter().lat),er=o.cB(kt.canonical,qt,en,xt.worldSize/xt._pixelsPerMercatorPixel),xn=o.b5(o.cC(kt.canonical)),Dn=jv(xt.expandedFarZProjMatrix,st,et,xn,o.a9(xt.zoom),Ke,xt.frustumCorners.TL,xt.frustumCorners.TR,xt.frustumCorners.BR,xt.frustumCorners.BL,xt.globeCenterInViewSpace,xt.globeRadius,ct,Ft,xt._farZ,er);if(De(kt,pn),be&&(Q.setupElevationDraw(hn,be,rt),J.uploadCommonUniforms(ve,be,kt.toUnwrapped()),tt)){const[yr,qn,ur]=tt.getGridBuffers(en,Ft!==0);be.draw(J,Zt,Ge,bt,je,_r.backCCW,Dn,"globe_raster",yr,qn,ur)}}}if(tt&&(J.renderDefaultNorthPole||J.renderDefaultSouthPole)){const xt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];Ne&&xt.push("CUSTOM_ANTIALIASING"),be=J.getOrCreateProgram("globeRaster",{defines:xt});for(const Ft of le){const{x:Zt,y:kt,z:hn}=Ft.canonical,bt=kt===0,Wt=kt===(1<<hn)-1,[Vt,fn,pn,qt]=tt.getPoleBuffers(hn,!1);if(qt&&(bt||Wt)){const en=oe.getTile(Ft);ve.activeTexture.set(_e.TEXTURE0),en.texture&&en.texture.bind(_e.LINEAR,_e.CLAMP_TO_EDGE);let er=o.cD(hn,Zt,ke);const xn=o.b5(o.cC(Ft.canonical)),Dn=(yr,qn)=>yr.draw(J,_e.TRIANGLES,Ge,pr.disabled,je,_r.disabled,jv(ke.expandedFarZProjMatrix,er,er,xn,0,Ke,ke.frustumCorners.TL,ke.frustumCorners.TR,ke.frustumCorners.BR,ke.frustumCorners.BL,ke.globeCenterInViewSpace,ke.globeRadius,ct,0,ke._farZ),"globe_pole_raster",qn,pn,qt);Q.setupElevationDraw(en,be,rt),J.uploadCommonUniforms(ve,be,Ft.toUnwrapped()),bt&&J.renderDefaultNorthPole&&Dn(be,Vt),Wt&&J.renderDefaultSouthPole&&(er=o.a6.mat4.scale(o.a6.mat4.create(),er,[1,-1,1]),Dn(be,fn))}}}})(E,P,F,W,$);else{const J=E.context,Q=J.gl;let oe,le;const ue=E.shadowRenderer,ve=tc(E,E.longestCutoffRange),_e=je=>{if(le===je)return;const Ge=[];Ge.push(Xv[je]),ve.shouldRenderCutoff&&Ge.push("RENDER_CUTOFF"),oe=E.getOrCreateProgram("terrainRaster",{defines:Ge}),le=je},be=E.colorModeForRenderPass(),we=new $n(Q.LEQUAL,$n.ReadWrite,E.depthRangeFor3D);Qh.update($);const ke=E.transform,Ne=ic(ke.zoom,P.exaggeration(),P.sourceCache._source.tileSize);let De=[0,0,0];if(ue){const je=E.style.directionalLight,Ge=E.style.ambientLight;je&&Ge&&(De=Ip(E.style,je,Ge))}{le=-1;const je=Q.TRIANGLES,[Ge,et]=[P.gridIndexBuffer,P.gridSegments];for(const Ke of W){const tt=F.getTile(Ke),ct=pr.disabled,st=P.prevTerrainTileForTile[Ke.key],rt=P.terrainTileForTile[Ke.key];Wv(st,rt)&&Qh.newMorphing(Ke.key,st,rt,$,250),J.activeTexture.set(Q.TEXTURE0),tt.texture&&tt.texture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE);const xt=Qh.getMorphValuesForProxy(Ke.key),Ft=xt?1:0;let Zt;xt&&(Zt={morphing:{srcDemTile:xt.from,dstDemTile:xt.to,phase:o.cw(xt.phase)}});const kt=Tx(Ke.projMatrix,Ag(Ke.canonical,ke.renderWorldCopies)?Ne/10:Ne,De);if(_e(Ft),!oe)continue;P.setupElevationDraw(tt,oe,Zt);const hn=Ke.toUnwrapped();ue&&ue.setupShadows(hn,oe),E.uploadCommonUniforms(J,oe,hn,null,ve),oe.draw(E,je,we,ct,be,_r.backCCW,kt,"terrain_raster",P.gridBuffer,Ge,et)}}}}(p,this,this.proxySourceCache,u,this._updateTimestamp),this.renderingToTexture=!0,p.gpuTimingDeferredRenderEnd(),u.splice(0,u.length))}renderBatch(u){if(this._drapedRenderBatches.length===0)return u+1;this.renderingToTexture=!0;const p=this.painter,w=this.painter.context,E=this.proxySourceCache,P=this.proxiedCoords[E.id],F=this._drapedRenderBatches.shift(),W=p.style.order,$=[];let J=0;for(const Q of P){const oe=E.getTileByID(Q.proxyTileKey),le=E.proxyCachedFBO[Q.key]?E.proxyCachedFBO[Q.key][u]:void 0,ue=le!==void 0?E.renderCache[le]:this.pool[J++],ve=le!==void 0;if(oe.texture=ue.tex,ve&&!ue.dirty){$.push(oe.tileID);continue}let _e;w.bindFramebuffer.set(ue.fb.framebuffer),this.renderedToTile=!1,ue.dirty&&(w.clear({color:o.bz.transparent,stencil:0}),ue.dirty=!1);for(let be=F.start;be<=F.end;++be){const we=p.style._mergedLayers[W[be]];if(we.isHidden(p.transform.zoom))continue;const ke=p.style.getLayerSourceCache(we),Ne=ke?this.proxyToSource[Q.key][ke.id]:[Q];if(!Ne)continue;const De=Ne;w.viewport.set([0,0,ue.fb.width,ue.fb.height]),_e!==(ke?ke.id:null)&&(this._setupStencil(ue,Ne,we,ke),_e=ke?ke.id:null),p.renderLayer(p,ke,we,De)}if(this._drapedRenderBatches.length===0)for(const be of this._pendingGroundEffectLayers){const we=p.style._mergedLayers[W[be]];if(we.isHidden(p.transform.zoom))continue;const ke=p.style.getLayerSourceCache(we),Ne=ke?this.proxyToSource[Q.key][ke.id]:[Q];if(!Ne)continue;const De=Ne;w.viewport.set([0,0,ue.fb.width,ue.fb.height]),_e!==(ke?ke.id:null)&&(this._setupStencil(ue,Ne,we,ke),_e=ke?ke.id:null),p.renderLayer(p,ke,we,De)}this.renderedToTile?(ue.dirty=!0,$.push(oe.tileID)):ve||--J,J===5&&(J=0,this.renderToBackBuffer($))}return this.renderToBackBuffer($),this.renderingToTexture=!1,w.bindFramebuffer.set(null),w.viewport.set([0,0,p.width,p.height]),F.end+1}postRender(){}isLayerOrderingCorrect(u){const p=u.order.length;let w=-1,E=p;for(let P=0;P<p;++P)this._style.isLayerDraped(u._mergedLayers[u.order[P]])?w=Math.max(w,P):E=Math.min(E,P);return E>w}getMinElevationBelowMSL(){let u=0;return this._visibleDemTiles.filter(p=>p.dem).forEach(p=>{u=Math.min(u,p.dem.tree.minimums[0])}),u===0?u:(u-30)*this._exaggeration}raycast(u,p,w){if(!this._visibleDemTiles)return null;const E=this._visibleDemTiles.filter(P=>P.dem).map(P=>{const F=P.tileID,W=1<<F.overscaledZ,{x:$,y:J}=F.canonical,Q=$/W,oe=($+1)/W,le=J/W,ue=(J+1)/W;return{minx:Q,miny:le,maxx:oe,maxy:ue,t:P.dem.tree.raycastRoot(Q,le,oe,ue,u,p,w),tile:P}});E.sort((P,F)=>(P.t!==null?P.t:Number.MAX_VALUE)-(F.t!==null?F.t:Number.MAX_VALUE));for(const P of E){if(P.t==null)return null;const F=P.tile.dem.tree.raycast(P.minx,P.miny,P.maxx,P.maxy,u,p,w);if(F!=null)return F}return null}_createFBO(){const u=this.painter.context,p=u.gl,w=this.drapeBufferSize;u.activeTexture.set(p.TEXTURE0);const E=new o.T(u,{width:w[0],height:w[1],data:null},p.RGBA8);E.bind(p.LINEAR,p.CLAMP_TO_EDGE);const P=u.createFramebuffer(w[0],w[1],!0,null);return P.colorAttachment.set(E.texture),P.depthAttachment=new vd(u,P.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=u.createRenderbuffer(u.gl.DEPTH_STENCIL,w[0],w[1]),this._stencilRef=0,P.depthAttachment.set(this._sharedDepthStencil),u.clear({stencil:0})):P.depthAttachment.set(this._sharedDepthStencil),u.extTextureFilterAnisotropic&&p.texParameterf(p.TEXTURE_2D,u.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,u.extTextureFilterAnisotropicMax),{fb:P,tex:E,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const u in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[u].hasTransition())return!0;return this._style.order.some(u=>{const p=this._style._mergedLayers[u],w=p.isHidden(this.painter.transform.zoom);return p.type==="hillshade"||p.type==="custom"?!w&&p.shouldRedrape():!w&&p.hasTransition()})}_clearLineLayersFromRenderCache(){let u=!1;for(const w of this._style.getSources())if(w instanceof Gi){u=!0;break}if(!u)return;const p={};for(let w=0;w<this._style.order.length;++w){const E=this._style._mergedLayers[this._style.order[w]],P=this._style.getLayerSourceCache(E);if(P&&!p[P.id]&&!E.isHidden(this.painter.transform.zoom)&&E.type==="line"&&E.widthExpression()instanceof o.a4){p[P.id]=!0;for(const F of this.proxyCoords){const W=this.proxyToSource[F.key][P.id];if(W)for(const $ of W)this._clearRenderCacheForTile(P.id,$)}}}}_clearRasterLayersFromRenderCache(){let u=!1;for(const w in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[w]._source instanceof ws){u=!0;break}if(!u)return;const p={};for(let w=0;w<this._style.order.length;++w){const E=this._style._mergedLayers[this._style.order[w]],P=this._style.getLayerSourceCache(E);if(!P||p[P.id]||E.isHidden(this.painter.transform.zoom)||E.type!=="raster")continue;const F=E.paint.get("raster-fade-duration");for(const W of this.proxyCoords){const $=this.proxyToSource[W.key][P.id];if($)for(const J of $){const Q=$u(P.getTile(J),P.findLoadedParent(J,0),P,this.painter.transform,F);(Q.opacity!==1||Q.mix!==0)&&this._clearRenderCacheForTile(P.id,J)}}}}_setupDrapedRenderBatches(){const u=this._style.order,p=u.length;if(p===0)return;const w=[];this._pendingGroundEffectLayers=[];let E,P=0,F=this._style._mergedLayers[u[P]];for(;!this._style.isLayerDraped(F)&&F.isHidden(this.painter.transform.zoom)&&++P<p;)F=this._style._mergedLayers[u[P]];for(;P<p;++P){const W=this._style._mergedLayers[u[P]];W.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(W)?E===void 0&&(E=P):(W.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(P),E!==void 0&&(w.push({start:E,end:P-1}),E=void 0)))}if(E!==void 0&&w.push({start:E,end:P-1}),w.length!==0){const W=w[w.length-1];this._pendingGroundEffectLayers.every($=>$>W.end)||o.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=w}_setupRenderCache(u){const p=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,p.renderCache.length>p.renderCachePool.length){const F=Object.values(p.proxyCachedFBO);p.proxyCachedFBO={};for(let W=0;W<F.length;++W){const $=Object.values(F[W]);p.renderCachePool.push(...$)}}return}this._clearRasterLayersFromRenderCache();const w=this.proxyCoords,E=this._tilesDirty;for(let F=w.length-1;F>=0;F--){const W=w[F];if(p.getTileByID(W.key),p.proxyCachedFBO[W.key]!==void 0){const $=u[W.key],J=this.proxyToSource[W.key];let Q=0;for(const oe in J){const le=J[oe],ue=$[oe];if(!ue||ue.length!==le.length||le.some((ve,_e)=>ve!==ue[_e]||E[oe]&&E[oe].hasOwnProperty(ve.key))){Q=-1;break}++Q}for(const oe in p.proxyCachedFBO[W.key])p.renderCache[p.proxyCachedFBO[W.key][oe]].dirty=Q<0||Q!==Object.values($).length}}const P=[...this._drapedRenderBatches];P.sort((F,W)=>W.end-W.start-(F.end-F.start));for(const F of P)for(const W of w){if(p.proxyCachedFBO[W.key])continue;let $=p.renderCachePool.pop();$===void 0&&p.renderCache.length<50&&($=p.renderCache.length,p.renderCache.push(this._createFBO())),$!==void 0&&(p.proxyCachedFBO[W.key]={},p.proxyCachedFBO[W.key][F.start]=$,p.renderCache[$].dirty=!0)}this._tilesDirty={}}_setupStencil(u,p,w,E){if(!E||!this._sourceTilesOverlap[E.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const P=this.painter.context,F=P.gl;if(p.length<=1)return void(this._overlapStencilType=!1);let W;if(w.isTileClipped())W=p.length,this._overlapStencilMode.test={func:F.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(p[0].overscaledZ>p[p.length-1].overscaledZ))return void(this._overlapStencilType=!1);W=1,this._overlapStencilMode.test={func:F.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+W>255&&(P.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=W,this._overlapStencilMode.ref=this._stencilRef,w.isTileClipped()&&this._renderTileClippingMasks(p,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(u){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[u.key]),this._overlapStencilMode):pr.disabled}_renderTileClippingMasks(u,p){const w=this.painter,E=this.painter.context,P=E.gl;w._tileClippingMaskIDs={},E.setColorMode(Mr.disabled),E.setDepthMode($n.disabled);const F=w.getOrCreateProgram("clippingMask");for(const W of u){const $=w._tileClippingMaskIDs[W.key]=--p;F.draw(w,P.TRIANGLES,$n.disabled,new pr({func:P.ALWAYS,mask:0},$,255,P.KEEP,P.KEEP,P.REPLACE),Mr.disabled,_r.disabled,_u(W.projMatrix),"$clipping",w.tileExtentBuffer,w.quadTriangleIndexBuffer,w.tileExtentSegments)}}pointCoordinate(u){const p=this.painter.transform;if(u.x<0||u.x>p.width||u.y<0||u.y>p.height)return null;const w=[u.x,u.y,1,1];o.a6.vec4.transformMat4(w,w,p.pixelMatrixInverse),o.a6.vec4.scale(w,w,1/w[3]),w[0]/=p.worldSize,w[1]/=p.worldSize;const E=p._camera.position,P=o.bD(1,p.center.lat),F=[E[0],E[1],E[2]/P,0],W=o.a6.vec3.subtract([],w.slice(0,3),F);o.a6.vec3.normalize(W,W);const $=this.raycast(F,W,this._exaggeration);return $!==null&&$?(o.a6.vec3.scaleAndAdd(F,F,W,$),F[3]=F[2],F[2]*=P,F):null}_setupProxiedCoordsForOrtho(u,p,w){if(u.getSource()instanceof o.aD)return this._setupProxiedCoordsForImageSource(u,p,w);this._findCoveringTileCache[u.id]=this._findCoveringTileCache[u.id]||{};const E=this.proxiedCoords[u.id]=[],P=this.proxyCoords;for(let $=0;$<P.length;$++){const J=P[$],Q=this._findTileCoveringTileID(J,u);if(Q){const oe=this._createProxiedId(J,Q,w[J.key]&&w[J.key][u.id]);E.push(oe),this.proxyToSource[J.key][u.id]=[oe]}}let F=!1;const W=new Set;for(let $=0;$<p.length;$++){const J=u.getTile(p[$]);if(!J||!J.hasData())continue;const Q=this._findTileCoveringTileID(J.tileID,this.proxySourceCache);if(Q&&Q.tileID.canonical.z!==J.tileID.canonical.z){const oe=this.proxyToSource[Q.tileID.key][u.id],le=this._createProxiedId(Q.tileID,J,w[Q.tileID.key]&&w[Q.tileID.key][u.id]);oe?oe.splice(oe.length-1,0,le):this.proxyToSource[Q.tileID.key][u.id]=[le];const ue=this.proxyToSource[Q.tileID.key][u.id];W.has(ue)||W.add(ue),E.push(le),F=!0}}if(this._sourceTilesOverlap[u.id]=F,F&&this._debugParams.sortTilesHiZFirst)for(const $ of W)$.sort((J,Q)=>Q.overscaledZ-J.overscaledZ)}_setupProxiedCoordsForImageSource(u,p,w){if(!u.getSource().loaded())return;const E=this.proxiedCoords[u.id]=[],P=this.proxyCoords,F=u.getSource(),W=F.tileID;if(!W)return;const $=new o.P(W.x,W.y)._div(1<<W.z),J=F.coordinates.map(o.a5.fromLngLat).reduce((oe,le)=>(oe.min.x=Math.min(oe.min.x,le.x-$.x),oe.min.y=Math.min(oe.min.y,le.y-$.y),oe.max.x=Math.max(oe.max.x,le.x-$.x),oe.max.y=Math.max(oe.max.y,le.y-$.y),oe),{min:new o.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),Q=(oe,le)=>{const ue=oe.wrap+oe.canonical.x/(1<<oe.canonical.z),ve=oe.canonical.y/(1<<oe.canonical.z),_e=o.ab/(1<<oe.canonical.z),be=le.wrap+le.canonical.x/(1<<le.canonical.z),we=le.canonical.y/(1<<le.canonical.z);return ue+_e<be+J.min.x||ue>be+J.max.x||ve+_e<we+J.min.y||ve>we+J.max.y};for(let oe=0;oe<P.length;oe++){const le=P[oe];for(let ue=0;ue<p.length;ue++){const ve=u.getTile(p[ue]);if(!ve||!ve.hasData()||Q(le,ve.tileID))continue;const _e=this._createProxiedId(le,ve,w[le.key]&&w[le.key][u.id]),be=this.proxyToSource[le.key][u.id];be?be.push(_e):this.proxyToSource[le.key][u.id]=[_e],E.push(_e)}}}_createProxiedId(u,p,w){let E=this.orthoMatrix;if(w){const P=w.find(F=>F.key===p.tileID.key);if(P)return P}if(p.tileID.key!==u.key){const P=u.canonical.z-p.tileID.canonical.z;let F,W,$;E=o.a6.mat4.create();const J=p.tileID.wrap-u.wrap<<u.overscaledZ;P>0?(F=o.ab>>P,W=F*((p.tileID.canonical.x<<P)-u.canonical.x+J),$=F*((p.tileID.canonical.y<<P)-u.canonical.y)):(F=o.ab<<-P,W=o.ab*(p.tileID.canonical.x-(u.canonical.x+J<<-P)),$=o.ab*(p.tileID.canonical.y-(u.canonical.y<<-P))),o.a6.mat4.ortho(E,0,F,0,F,0,1),o.a6.mat4.translate(E,E,[W,$,0])}return new Tg(p.tileID,u.key,E)}_findTileCoveringTileID(u,p){let w=p.getTile(u);if(w&&w.hasData())return w;const E=this._findCoveringTileCache[p.id],P=E[u.key];if(w=P?p.getTileByID(P):null,w&&w.hasData()||P===null)return w;let F=w?w.tileID:u,W=F.overscaledZ;const $=p.getSource().minzoom,J=[];if(!P){const oe=p.getSource().maxzoom;if(u.canonical.z>=oe){const le=u.canonical.z-oe;p.getSource().reparseOverscaled?(W=Math.max(u.canonical.z+2,p.transform.tileZoom),F=new o.aA(W,u.wrap,oe,u.canonical.x>>le,u.canonical.y>>le)):le!==0&&(W=oe,F=new o.aA(W,u.wrap,oe,u.canonical.x>>le,u.canonical.y>>le))}F.key!==u.key&&(J.push(F.key),w=p.getTile(F))}const Q=oe=>{J.forEach(le=>{E[le]=oe}),J.length=0};for(W-=1;W>=$&&(!w||!w.hasData());W--){w&&Q(w.tileID.key);const oe=F.calculateScaledKey(W);if(w=p.getTileByID(oe),w&&w.hasData())break;const le=E[oe];if(le===null)break;le===void 0?J.push(oe):w=p.getTileByID(le)}return Q(w?w.tileID.key:null),w&&w.hasData()?w:null}findDEMTileFor(u){return this.enabled?this._findTileCoveringTileID(u,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(u,p){let w=this._tilesDirty[u];w||(w=this._tilesDirty[u]={}),w[p.key]=!0}}function qo(b,u,p){const w=function(W,$,J){const Q=o.a6.vec3.dot($,W),oe=o.a6.vec3.dot(J,[.2126,.7152,.0722]),le=(ve,_e,be)=>(1-be)*ve+be*_e,ue=le(1-.3*Math.min(oe,1),1,Math.min(Q+1,1));return le(.92,1,Math.asin(o.ap($[2],-1,1))/Math.PI+.5)*ue}(b,[0,0,1],u),E=[0,0,0];o.a6.vec3.scale(E,p.slice(0,3),w);const P=[0,0,0];o.a6.vec3.scale(P,u.slice(0,3),b[2]);const F=[0,0,0];return o.a6.vec3.add(F,E,P),o.cb(F)}const tf=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Mx=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbol"];class xo{static cacheKey(u,p,w,E){let P=`${p}${E?E.cacheKey:""}`;for(const F of w)u.usedDefines.includes(F)&&(P+=`/${F}`);return P}constructor(u,p,w,E,P,F){const W=u.gl;this.program=W.createProgram(),this.configuration=E,this.name=p,this.fixedDefines=[...F];const $=E?E.getBinderAttributes():[],J=(w.staticAttributes||[]).concat($);let Q=E?E.defines():[];Q=Q.concat(F.map(be=>`#define ${be}`));const oe=`#version 300 es
`;let le=oe+Q.concat("precision mediump float;",ju,vu.fragmentSource).join(`
`);for(const be of w.fragmentIncludes)le+=`
${Zs[be]}`;le+=`
${w.fragmentSource}`;let ue=oe+Q.concat("precision highp float;",ju,vu.vertexSource).join(`
`);for(const be of w.vertexIncludes)ue+=`
${Zs[be]}`;ue+=`
${w.vertexSource}`;const ve=W.createShader(W.FRAGMENT_SHADER);if(W.isContextLost())return void(this.failedToCreate=!0);W.shaderSource(ve,le),W.compileShader(ve),W.attachShader(this.program,ve);const _e=W.createShader(W.VERTEX_SHADER);if(W.isContextLost())this.failedToCreate=!0;else{W.shaderSource(_e,ue),W.compileShader(_e),W.attachShader(this.program,_e),this.attributes={},this.numAttributes=J.length;for(let be=0;be<this.numAttributes;be++)if(J[be]){const we=J[be].startsWith("a_")?J[be]:`a_${J[be]}`;W.bindAttribLocation(this.program,be,we),this.attributes[we]=be}W.linkProgram(this.program),W.deleteShader(_e),W.deleteShader(ve),this.fixedUniforms=P(u),this.binderUniforms=E?E.getUniforms(u):[],(F.includes("TERRAIN")||p.indexOf("symbol")!==-1||p.indexOf("circle")!==-1)&&(this.terrainUniforms=(be=>({u_dem:new o.bJ(be),u_dem_prev:new o.bJ(be),u_dem_tl:new o.bG(be),u_dem_scale:new o.bI(be),u_dem_tl_prev:new o.bG(be),u_dem_scale_prev:new o.bI(be),u_dem_size:new o.bI(be),u_dem_lerp:new o.bI(be),u_exaggeration:new o.bI(be),u_depth:new o.bJ(be),u_depth_size_inv:new o.bG(be),u_depth_range_unpack:new o.bG(be),u_occluder_half_size:new o.bI(be),u_occlusion_depth_offset:new o.bI(be),u_meter_to_dem:new o.bI(be),u_label_plane_matrix_inv:new o.bF(be)}))(u)),F.includes("GLOBE")&&(this.globeUniforms=(be=>({u_tile_tl_up:new o.bH(be),u_tile_tr_up:new o.bH(be),u_tile_br_up:new o.bH(be),u_tile_bl_up:new o.bH(be),u_tile_up_scale:new o.bI(be)}))(u)),F.includes("FOG")&&(this.fogUniforms=(be=>({u_fog_matrix:new o.bF(be),u_fog_range:new o.bG(be),u_fog_color:new o.c6(be),u_fog_horizon_blend:new o.bI(be),u_fog_vertical_limit:new o.bG(be),u_fog_temporal_offset:new o.bI(be),u_frustum_tl:new o.bH(be),u_frustum_tr:new o.bH(be),u_frustum_br:new o.bH(be),u_frustum_bl:new o.bH(be),u_globe_pos:new o.bH(be),u_globe_radius:new o.bI(be),u_globe_transition:new o.bI(be),u_is_globe:new o.bJ(be),u_viewport:new o.bG(be)}))(u)),F.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(be=>({u_cutoff_params:new o.c6(be)}))(u)),F.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(be=>({u_lighting_ambient_color:new o.bH(be),u_lighting_directional_dir:new o.bH(be),u_lighting_directional_color:new o.bH(be),u_ground_radiance:new o.bH(be)}))(u)),F.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(be=>({u_light_matrix_0:new o.bF(be),u_light_matrix_1:new o.bF(be),u_fade_range:new o.bG(be),u_shadow_normal_offset:new o.bH(be),u_shadow_intensity:new o.bI(be),u_shadow_texel_size:new o.bI(be),u_shadow_map_resolution:new o.bI(be),u_shadow_direction:new o.bH(be),u_shadow_bias:new o.bH(be),u_shadowmap_0:new o.bJ(be),u_shadowmap_1:new o.bJ(be)}))(u))}}setTerrainUniformValues(u,p){if(!this.terrainUniforms)return;const w=this.terrainUniforms;if(!this.failedToCreate){u.program.set(this.program);for(const E in p)w[E]&&w[E].set(this.program,E,p[E])}}setGlobeUniformValues(u,p){if(!this.globeUniforms)return;const w=this.globeUniforms;if(!this.failedToCreate){u.program.set(this.program);for(const E in p)w[E]&&w[E].set(this.program,E,p[E])}}setFogUniformValues(u,p){if(!this.fogUniforms)return;const w=this.fogUniforms;if(!this.failedToCreate){u.program.set(this.program);for(const E in p)w[E].set(this.program,E,p[E])}}setCutoffUniformValues(u,p){if(!this.cutoffUniforms)return;const w=this.cutoffUniforms;if(!this.failedToCreate){u.program.set(this.program);for(const E in p)w[E].set(this.program,E,p[E])}}setLightsUniformValues(u,p){if(!this.lightsUniforms)return;const w=this.lightsUniforms;if(!this.failedToCreate){u.program.set(this.program);for(const E in p)w[E].set(this.program,E,p[E])}}setShadowUniformValues(u,p){if(this.failedToCreate||!this.shadowUniforms)return;const w=this.shadowUniforms;u.program.set(this.program);for(const E in p)w[E].set(this.program,E,p[E])}_drawDebugWireframe(u,p,w,E,P,F,W,$,J,Q){const oe=u.options.wireframe;if(oe.terrain===!1&&oe.layers2D===!1&&oe.layers3D===!1)return;const le=u.context;if(!(!(!oe.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!oe.layers2D||u._terrain&&u._terrain.renderingToTexture||!tf.includes(this.name))||!(!oe.layers3D||!Mx.includes(this.name))))return;const ue=le.gl,ve=u.wireframeDebugCache.getLinesFromTrianglesBuffer(u.frameCounter,P,le);if(!ve)return;const _e=[...this.fixedDefines];_e.push("DEBUG_WIREFRAME");const be=u.getOrCreateProgram(this.name,{config:this.configuration,defines:_e});le.program.set(be.program);const we=(De,je,Ge)=>{if(je[De]&&Ge[De])for(const et in je[De])Ge[De][et]&&Ge[De][et].set(Ge.program,et,je[De][et].current)};J&&J.setUniforms(be.program,le,be.binderUniforms,W,{zoom:$}),we("fixedUniforms",this,be),we("terrainUniforms",this,be),we("globeUniforms",this,be),we("fogUniforms",this,be),we("lightsUniforms",this,be),we("shadowUniforms",this,be),ve.bind(),le.setColorMode(new Mr([ue.ONE,ue.ONE_MINUS_SRC_ALPHA,ue.ZERO,ue.ONE],o.bz.transparent,[!0,!0,!0,!1])),le.setDepthMode(new $n(p.func===ue.LESS?ue.LEQUAL:p.func,$n.ReadOnly,p.range)),le.setStencilMode(pr.disabled);const ke=3*F.primitiveLength*2,Ne=3*F.primitiveOffset*2*2;Q&&Q>1?ue.drawElementsInstanced(ue.LINES,ke,ue.UNSIGNED_SHORT,Ne,Q):ue.drawElements(ue.LINES,ke,ue.UNSIGNED_SHORT,Ne),P.bind(),le.program.set(this.program),le.setDepthMode(p),le.setStencilMode(w),le.setColorMode(E)}draw(u,p,w,E,P,F,W,$,J,Q,oe,le,ue,ve,_e,be){const we=u.context,ke=we.gl;if(this.failedToCreate)return;we.program.set(this.program),we.setDepthMode(w),we.setStencilMode(E),we.setColorMode(P),we.setCullFace(F);for(const je of Object.keys(this.fixedUniforms))this.fixedUniforms[je].set(this.program,je,W[je]);ve&&ve.setUniforms(this.program,we,this.binderUniforms,le,{zoom:ue});const Ne={[ke.POINTS]:1,[ke.LINES]:2,[ke.TRIANGLES]:3,[ke.LINE_STRIP]:1}[p],De=be&&be>0?1:void 0;for(const je of oe.get()){const Ge=je.vaos||(je.vaos={});(Ge[$]||(Ge[$]=new Xu)).bind(we,this,J,ve?ve.getPaintVertexBuffers():[],Q,je.vertexOffset,_e||[],De),be&&be>1?ke.drawElementsInstanced(p,je.primitiveLength*Ne,ke.UNSIGNED_SHORT,je.primitiveOffset*Ne*2,be):Q?ke.drawElements(p,je.primitiveLength*Ne,ke.UNSIGNED_SHORT,je.primitiveOffset*Ne*2):ke.drawArrays(p,je.vertexOffset,je.vertexLength),p===ke.TRIANGLES&&Q&&this._drawDebugWireframe(u,w,E,P,Q,je,le,ue,ve,be)}}}function aa(b,u){const p=Math.pow(2,u.tileID.overscaledZ),w=u.tileSize*Math.pow(2,b.transform.tileZoom)/p,E=w*(u.tileID.canonical.x+u.tileID.wrap*p),P=w*u.tileID.canonical.y;return{u_image:0,u_texsize:u.imageAtlasTexture?u.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/o.ak(u,1,b.transform.tileZoom),u_pixel_coord_upper:[E>>16,P>>16],u_pixel_coord_lower:[65535&E,65535&P]}}const Vp=o.a6.mat4.create(),Mg=(b,u,p,w,E,P,F,W,$,J,Q,oe,le,ue,ve,_e)=>{const be=u.style.light,we=be.properties.get("position"),ke=[we.x,we.y,we.z],Ne=o.a6.mat3.create();be.properties.get("anchor")==="viewport"&&(o.a6.mat3.fromRotation(Ne,-u.transform.angle),o.a6.vec3.transformMat3(ke,ke,Ne));const De=be.properties.get("color"),je=u.transform,Ge={u_matrix:b,u_lightpos:ke,u_lightintensity:be.properties.get("intensity"),u_lightcolor:[De.r,De.g,De.b],u_vertical_gradient:+p,u_opacity:w,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Vp,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:E,u_edge_radius:P,u_width_scale:F,u_flood_light_color:le,u_vertical_scale:ue,u_flood_light_intensity:ve,u_ground_shadow_factor:_e};return je.projection.name==="globe"&&(Ge.u_tile_id=[W.canonical.x,W.canonical.y,1<<W.canonical.z],Ge.u_zoom_transition=J,Ge.u_inv_rot_matrix=oe,Ge.u_merc_center=Q,Ge.u_up_dir=je.projection.upVector(new o.bP(0,0,0),Q[0]*o.ab,Q[1]*o.ab),Ge.u_height_lift=$),Ge},$v=(b,u,p,w)=>({u_matrix:b,u_edge_radius:u,u_width_scale:p,u_vertical_scale:w}),Cg=(b,u,p,w,E,P,F,W,$,J,Q,oe,le,ue,ve)=>{const _e=Mg(b,u,p,w,E,P,F,W,J,Q,oe,le,ue,ve,1,[0,0,0]),be={u_height_factor:-Math.pow(2,W.overscaledZ)/$.tileSize/8};return o.l(_e,aa(u,$),be)},Gp=(b,u)=>({u_matrix:b,u_emissive_strength:u}),Eg=(b,u,p,w)=>o.l(Gp(b,u),aa(p,w)),qv=(b,u,p)=>({u_matrix:b,u_world:p,u_emissive_strength:u}),nf=(b,u,p,w,E)=>o.l(Eg(b,u,p,w),{u_world:E}),Cx=(b,u,p,w)=>{const E=o.ab/p.tileSize;return{u_matrix:b,u_camera_to_center_distance:u.getCameraToCenterDistance(w),u_extrude_scale:[u.pixelsToGLUnits[0]/E,u.pixelsToGLUnits[1]/E]}},Zv=(b,u,p=1)=>({u_matrix:b,u_color:u.toRenderColor(null),u_overlay:0,u_overlay_scale:p}),Hp=o.a6.mat4.create(),Ig=(b,u,p,w,E,P,F)=>{const W=b.transform,$=W.projection.name==="globe",J=$?o.cI(W.zoom,u.canonical)*W._pixelsPerMercatorPixel:o.ak(p,1,P),Q={u_matrix:u.projMatrix,u_extrude_scale:J,u_intensity:F,u_inv_rot_matrix:Hp,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if($){Q.u_inv_rot_matrix=w,Q.u_merc_center=E,Q.u_tile_id=[u.canonical.x,u.canonical.y,1<<u.canonical.z],Q.u_zoom_transition=o.a9(W.zoom);const oe=E[0]*o.ab,le=E[1]*o.ab;Q.u_up_dir=W.projection.upVector(new o.bP(0,0,0),oe,le)}return Q};function jp(b,[u,p,w,E],[P,F]){if(P===F)return[0,0,0,0];const W=255*(b-1)/(b*(F-P));return[u*W,p*W,w*W,E*W]}function _d(b,u,[p,w]){return p===w?0:.5/b+(u-p)*(b-1)/(b*(w-p))}const yd=(b,u,p,w,E,P,F,W,$,J,Q,oe,le,ue,ve,_e,be,we,ke,Ne,De)=>({u_matrix:b,u_normalize_matrix:u,u_globe_matrix:p,u_merc_matrix:w,u_grid_matrix:E,u_tl_parent:P,u_scale_parent:J,u_fade_t:Q.mix,u_opacity:Q.opacity*oe.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:oe.paint.get("raster-brightness-min"),u_brightness_high:oe.paint.get("raster-brightness-max"),u_saturation_factor:o.cJ(oe.paint.get("raster-saturation")),u_contrast_factor:o.cK(oe.paint.get("raster-contrast")),u_spin_weights:Rg(oe.paint.get("raster-hue-rotate")),u_perspective_transform:le,u_raster_elevation:ue,u_zoom_transition:F,u_merc_center:W,u_cutoff_params:$,u_colorization_mix:jp(o.cL,_e,we),u_colorization_offset:_d(o.cL,be,we),u_color_ramp:ve,u_texture_offset:[Ne/(ke+2*Ne),ke/(ke+2*Ne)],u_texture_res:[ke+2*Ne,ke+2*Ne],u_emissive_strength:De});function Rg(b){b*=Math.PI/180;const u=Math.sin(b),p=Math.cos(b);return[(2*p+1)/3,(-Math.sqrt(3)*u-p+1)/3,(Math.sqrt(3)*u-p+1)/3]}const hl=.05,Yv=(b,u,p,w,E,P,F,W,$,J,Q,oe)=>({u_matrix:b,u_normalize_matrix:u,u_globe_matrix:p,u_merc_matrix:w,u_grid_matrix:E,u_tl_parent:P,u_scale_parent:J,u_fade_t:Q.mix,u_opacity:Q.opacity,u_image0:0,u_image1:1,u_raster_elevation:oe,u_zoom_transition:F,u_merc_center:W,u_cutoff_params:$}),xd=(b,u,p,w,E,P,F,W,$,J)=>({u_particle_texture:b,u_particle_texture_side_len:u,u_tile_offset:p,u_velocity:w,u_color_ramp:P,u_velocity_res:E,u_max_speed:F,u_uv_offset:W,u_data_scale:[255*$[0],255*$[1]],u_data_offset:J,u_particle_pos_scale:1.1,u_particle_pos_offset:[hl,hl]}),Wp=(b,u,p,w,E,P,F,W,$,J)=>({u_particle_texture:b,u_particle_texture_side_len:u,u_velocity:p,u_velocity_res:w,u_max_speed:E,u_speed_factor:P,u_reset_rate:F,u_rand_seed:Math.random(),u_uv_offset:W,u_data_scale:[255*$[0],255*$[1]],u_data_offset:J,u_particle_pos_scale:1.1,u_particle_pos_offset:[hl,hl]}),Ml=o.a6.mat4.create(),Kv=(b,u,p,w,E,P,F,W,$,J,Q,oe,le,ue,ve,_e,be,we,ke,Ne,De)=>{const je=E.transform,Ge={u_is_size_zoom_constant:+(b==="constant"||b==="source"),u_is_size_feature_constant:+(b==="constant"||b==="camera"),u_size_t:u?u.uSizeT:0,u_size:u?u.uSize:0,u_camera_to_center_distance:je.getCameraToCenterDistance(ke),u_rotate_symbol:+p,u_aspect_ratio:je.width/je.height,u_fade_change:E.options.fadeDuration?E.symbolFadeChange:1,u_matrix:P,u_label_plane_matrix:F,u_coord_matrix:W,u_is_text:+J,u_elevation_from_sea:$?1:0,u_pitch_with_map:+w,u_texsize:Q,u_texsize_icon:oe,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ml,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Ml,u_up_vector:[0,-1,0],u_color_adj_mat:Ne,u_icon_transition:De||0,u_gamma_scale:w?E.transform.getCameraToCenterDistance(ke)*Math.cos(E.terrain?0:E.transform._pitch):1,u_device_pixel_ratio:o.q.devicePixelRatio,u_is_halo:+le};return ke.name==="globe"&&(Ge.u_tile_id=[ue.canonical.x,ue.canonical.y,1<<ue.canonical.z],Ge.u_zoom_transition=ve,Ge.u_inv_rot_matrix=be,Ge.u_merc_center=_e,Ge.u_camera_forward=je._camera.forward(),Ge.u_ecef_origin=o.cM(je.globeMatrix,ue.toUnwrapped()),Ge.u_tile_matrix=Float32Array.from(je.globeMatrix),Ge.u_up_vector=we),Ge},Ex=(b,u,p,w)=>({u_matrix:b,u_emissive_strength:u,u_opacity:p,u_color:w}),zc=(b,u,p,w,E,P,F,W,$)=>o.l(function(J,Q,oe,le,ue,ve){const{width:_e,height:be}=le.imageManager.getPixelSize(Q),we=Math.pow(2,ve.tileID.overscaledZ),ke=ve.tileSize*Math.pow(2,le.transform.tileZoom)/we,Ne=ke*(ve.tileID.canonical.x+ve.tileID.wrap*we),De=ke*ve.tileID.canonical.y;return{u_image:0,u_pattern_tl:oe.tl,u_pattern_br:oe.br,u_texsize:[_e,be],u_pattern_size:oe.displaySize,u_pattern_units_to_pixels:ue?[le.transform.width,-1*le.transform.height]:[1/o.ak(ve,1,le.transform.tileZoom),1/o.ak(ve,1,le.transform.tileZoom)],u_pixel_coord_upper:[Ne>>16,De>>16],u_pixel_coord_lower:[65535&Ne,65535&De]}}(0,P,F,w,W,$),{u_matrix:b,u_emissive_strength:u,u_opacity:p}),Cl=new Float32Array(o.a6.mat4.identity([])),Fn=(b,u,p,w,E,P,F,W,$,J,Q,oe,le,ue=[0,0,0],ve)=>{const _e=E.style.light,be=_e.properties.get("position"),we=[-be.x,-be.y,be.z],ke=o.a6.mat3.create();_e.properties.get("anchor")==="viewport"&&(o.a6.mat3.fromRotation(ke,-E.transform.angle),o.a6.vec3.transformMat3(we,we,ke));const Ne=Q.alphaMode==="MASK",De=_e.properties.get("color").toRenderColor(null),je=le.paint.get("model-ambient-occlusion-intensity"),Ge=le.paint.get("model-color").constantOr(o.bz.white).toRenderColor(null),et=le.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:b,u_lighting_matrix:u,u_normal_matrix:p,u_node_matrix:w||Cl,u_lightpos:we,u_lightintensity:_e.properties.get("intensity"),u_lightcolor:[De.r,De.g,De.b],u_camera_pos:ue,u_opacity:P,u_baseTextureIsAlpha:0,u_alphaMask:+Ne,u_alphaCutoff:Q.alphaCutoff,u_baseColorFactor:[F.r,F.g,F.b,F.a],u_emissiveFactor:[W[0],W[1],W[2],1],u_metallicFactor:$,u_roughnessFactor:J,u_baseColorTexture:oo.BaseColor,u_metallicRoughnessTexture:oo.MetallicRoughness,u_normalTexture:oo.Normal,u_occlusionTexture:oo.Occlusion,u_emissionTexture:oo.Emission,u_lutTexture:oo.LUT,u_color_mix:[Ge.r,Ge.g,Ge.b,et],u_aoIntensity:je,u_emissive_strength:oe,u_occlusionTextureTransform:ve||[0,0,0,0]}},sr=(b,u=Cl,p=Cl)=>({u_matrix:b,u_instance:u,u_node_matrix:p}),Xp={fillExtrusion:b=>({u_matrix:new o.bF(b),u_lightpos:new o.bH(b),u_lightintensity:new o.bI(b),u_lightcolor:new o.bH(b),u_vertical_gradient:new o.bI(b),u_opacity:new o.bI(b),u_edge_radius:new o.bI(b),u_width_scale:new o.bI(b),u_ao:new o.bG(b),u_tile_id:new o.bH(b),u_zoom_transition:new o.bI(b),u_inv_rot_matrix:new o.bF(b),u_merc_center:new o.bG(b),u_up_dir:new o.bH(b),u_height_lift:new o.bI(b),u_flood_light_color:new o.bH(b),u_vertical_scale:new o.bI(b),u_flood_light_intensity:new o.bI(b),u_ground_shadow_factor:new o.bH(b)}),fillExtrusionDepth:b=>({u_matrix:new o.bF(b),u_edge_radius:new o.bI(b),u_width_scale:new o.bI(b),u_vertical_scale:new o.bI(b)}),fillExtrusionPattern:b=>({u_matrix:new o.bF(b),u_lightpos:new o.bH(b),u_lightintensity:new o.bI(b),u_lightcolor:new o.bH(b),u_vertical_gradient:new o.bI(b),u_height_factor:new o.bI(b),u_edge_radius:new o.bI(b),u_width_scale:new o.bI(b),u_ao:new o.bG(b),u_tile_id:new o.bH(b),u_zoom_transition:new o.bI(b),u_inv_rot_matrix:new o.bF(b),u_merc_center:new o.bG(b),u_up_dir:new o.bH(b),u_height_lift:new o.bI(b),u_image:new o.bJ(b),u_texsize:new o.bG(b),u_pixel_coord_upper:new o.bG(b),u_pixel_coord_lower:new o.bG(b),u_tile_units_to_pixels:new o.bI(b),u_opacity:new o.bI(b)}),fillExtrusionGroundEffect:b=>({u_matrix:new o.bF(b),u_opacity:new o.bI(b),u_ao_pass:new o.bI(b),u_meter_to_tile:new o.bI(b),u_ao:new o.bG(b),u_flood_light_intensity:new o.bI(b),u_flood_light_color:new o.bH(b),u_attenuation:new o.bI(b),u_edge_radius:new o.bI(b),u_fb:new o.bJ(b),u_fb_size:new o.bI(b),u_dynamic_offset:new o.bI(b)}),fill:b=>({u_matrix:new o.bF(b),u_emissive_strength:new o.bI(b)}),fillPattern:b=>({u_matrix:new o.bF(b),u_emissive_strength:new o.bI(b),u_image:new o.bJ(b),u_texsize:new o.bG(b),u_pixel_coord_upper:new o.bG(b),u_pixel_coord_lower:new o.bG(b),u_tile_units_to_pixels:new o.bI(b)}),fillOutline:b=>({u_matrix:new o.bF(b),u_emissive_strength:new o.bI(b),u_world:new o.bG(b)}),fillOutlinePattern:b=>({u_matrix:new o.bF(b),u_emissive_strength:new o.bI(b),u_world:new o.bG(b),u_image:new o.bJ(b),u_texsize:new o.bG(b),u_pixel_coord_upper:new o.bG(b),u_pixel_coord_lower:new o.bG(b),u_tile_units_to_pixels:new o.bI(b)}),circle:o.cN,collisionBox:b=>({u_matrix:new o.bF(b),u_camera_to_center_distance:new o.bI(b),u_extrude_scale:new o.bG(b)}),collisionCircle:b=>({u_matrix:new o.bF(b),u_inv_matrix:new o.bF(b),u_camera_to_center_distance:new o.bI(b),u_viewport_size:new o.bG(b)}),debug:b=>({u_color:new o.cu(b),u_matrix:new o.bF(b),u_overlay:new o.bJ(b),u_overlay_scale:new o.bI(b)}),clippingMask:b=>({u_matrix:new o.bF(b)}),heatmap:b=>({u_extrude_scale:new o.bI(b),u_intensity:new o.bI(b),u_matrix:new o.bF(b),u_inv_rot_matrix:new o.bF(b),u_merc_center:new o.bG(b),u_tile_id:new o.bH(b),u_zoom_transition:new o.bI(b),u_up_dir:new o.bH(b)}),heatmapTexture:b=>({u_image:new o.bJ(b),u_color_ramp:new o.bJ(b),u_opacity:new o.bI(b)}),hillshade:b=>({u_matrix:new o.bF(b),u_image:new o.bJ(b),u_latrange:new o.bG(b),u_light:new o.bG(b),u_shadow:new o.cu(b),u_highlight:new o.cu(b),u_emissive_strength:new o.bI(b),u_accent:new o.cu(b)}),hillshadePrepare:b=>({u_matrix:new o.bF(b),u_image:new o.bJ(b),u_dimension:new o.bG(b),u_zoom:new o.bI(b)}),line:o.cO,linePattern:o.cP,raster:b=>({u_matrix:new o.bF(b),u_normalize_matrix:new o.bF(b),u_globe_matrix:new o.bF(b),u_merc_matrix:new o.bF(b),u_grid_matrix:new o.cv(b),u_tl_parent:new o.bG(b),u_scale_parent:new o.bI(b),u_fade_t:new o.bI(b),u_opacity:new o.bI(b),u_image0:new o.bJ(b),u_image1:new o.bJ(b),u_brightness_low:new o.bI(b),u_brightness_high:new o.bI(b),u_saturation_factor:new o.bI(b),u_contrast_factor:new o.bI(b),u_spin_weights:new o.bH(b),u_perspective_transform:new o.bG(b),u_raster_elevation:new o.bI(b),u_zoom_transition:new o.bI(b),u_merc_center:new o.bG(b),u_cutoff_params:new o.c6(b),u_colorization_mix:new o.c6(b),u_colorization_offset:new o.bI(b),u_color_ramp:new o.bJ(b),u_texture_offset:new o.bG(b),u_texture_res:new o.bG(b),u_emissive_strength:new o.bI(b)}),rasterParticle:b=>({u_matrix:new o.bF(b),u_normalize_matrix:new o.bF(b),u_globe_matrix:new o.bF(b),u_merc_matrix:new o.bF(b),u_grid_matrix:new o.cv(b),u_tl_parent:new o.bG(b),u_scale_parent:new o.bI(b),u_fade_t:new o.bI(b),u_opacity:new o.bI(b),u_image0:new o.bJ(b),u_image1:new o.bJ(b),u_raster_elevation:new o.bI(b),u_zoom_transition:new o.bI(b),u_merc_center:new o.bG(b),u_cutoff_params:new o.c6(b)}),rasterParticleTexture:b=>({u_texture:new o.bJ(b),u_opacity:new o.bI(b)}),rasterParticleDraw:b=>({u_particle_texture:new o.bJ(b),u_particle_texture_side_len:new o.bI(b),u_tile_offset:new o.bG(b),u_velocity:new o.bJ(b),u_color_ramp:new o.bJ(b),u_velocity_res:new o.bG(b),u_max_speed:new o.bI(b),u_uv_offset:new o.bG(b),u_data_scale:new o.bG(b),u_data_offset:new o.bI(b),u_particle_pos_scale:new o.bI(b),u_particle_pos_offset:new o.bG(b)}),rasterParticleUpdate:b=>({u_particle_texture:new o.bJ(b),u_particle_texture_side_len:new o.bI(b),u_velocity:new o.bJ(b),u_velocity_res:new o.bG(b),u_max_speed:new o.bI(b),u_speed_factor:new o.bI(b),u_reset_rate:new o.bI(b),u_rand_seed:new o.bI(b),u_uv_offset:new o.bG(b),u_data_scale:new o.bG(b),u_data_offset:new o.bI(b),u_particle_pos_scale:new o.bI(b),u_particle_pos_offset:new o.bG(b)}),symbol:b=>({u_is_size_zoom_constant:new o.bJ(b),u_is_size_feature_constant:new o.bJ(b),u_size_t:new o.bI(b),u_size:new o.bI(b),u_camera_to_center_distance:new o.bI(b),u_rotate_symbol:new o.bJ(b),u_aspect_ratio:new o.bI(b),u_fade_change:new o.bI(b),u_matrix:new o.bF(b),u_label_plane_matrix:new o.bF(b),u_coord_matrix:new o.bF(b),u_is_text:new o.bJ(b),u_elevation_from_sea:new o.bJ(b),u_pitch_with_map:new o.bJ(b),u_texsize:new o.bG(b),u_texsize_icon:new o.bG(b),u_texture:new o.bJ(b),u_texture_icon:new o.bJ(b),u_gamma_scale:new o.bI(b),u_device_pixel_ratio:new o.bI(b),u_tile_id:new o.bH(b),u_zoom_transition:new o.bI(b),u_inv_rot_matrix:new o.bF(b),u_merc_center:new o.bG(b),u_camera_forward:new o.bH(b),u_tile_matrix:new o.bF(b),u_up_vector:new o.bH(b),u_ecef_origin:new o.bH(b),u_is_halo:new o.bJ(b),u_icon_transition:new o.bI(b),u_color_adj_mat:new o.bF(b)}),background:b=>({u_matrix:new o.bF(b),u_emissive_strength:new o.bI(b),u_opacity:new o.bI(b),u_color:new o.cu(b)}),backgroundPattern:b=>({u_matrix:new o.bF(b),u_emissive_strength:new o.bI(b),u_opacity:new o.bI(b),u_image:new o.bJ(b),u_pattern_tl:new o.bG(b),u_pattern_br:new o.bG(b),u_texsize:new o.bG(b),u_pattern_size:new o.bG(b),u_pixel_coord_upper:new o.bG(b),u_pixel_coord_lower:new o.bG(b),u_pattern_units_to_pixels:new o.bG(b)}),terrainRaster:b=>({u_matrix:new o.bF(b),u_image0:new o.bJ(b),u_skirt_height:new o.bI(b),u_ground_shadow_factor:new o.bH(b)}),skybox:b=>({u_matrix:new o.bF(b),u_sun_direction:new o.bH(b),u_cubemap:new o.bJ(b),u_opacity:new o.bI(b),u_temporal_offset:new o.bI(b)}),skyboxGradient:b=>({u_matrix:new o.bF(b),u_color_ramp:new o.bJ(b),u_center_direction:new o.bH(b),u_radius:new o.bI(b),u_opacity:new o.bI(b),u_temporal_offset:new o.bI(b)}),skyboxCapture:b=>({u_matrix_3f:new o.cv(b),u_sun_direction:new o.bH(b),u_sun_intensity:new o.bI(b),u_color_tint_r:new o.c6(b),u_color_tint_m:new o.c6(b),u_luminance:new o.bI(b)}),globeRaster:b=>({u_proj_matrix:new o.bF(b),u_globe_matrix:new o.bF(b),u_normalize_matrix:new o.bF(b),u_merc_matrix:new o.bF(b),u_zoom_transition:new o.bI(b),u_merc_center:new o.bG(b),u_image0:new o.bJ(b),u_grid_matrix:new o.cv(b),u_skirt_height:new o.bI(b),u_far_z_cutoff:new o.bI(b),u_frustum_tl:new o.bH(b),u_frustum_tr:new o.bH(b),u_frustum_br:new o.bH(b),u_frustum_bl:new o.bH(b),u_globe_pos:new o.bH(b),u_globe_radius:new o.bI(b),u_viewport:new o.bG(b)}),globeAtmosphere:b=>({u_frustum_tl:new o.bH(b),u_frustum_tr:new o.bH(b),u_frustum_br:new o.bH(b),u_frustum_bl:new o.bH(b),u_horizon:new o.bI(b),u_transition:new o.bI(b),u_fadeout_range:new o.bI(b),u_color:new o.c6(b),u_high_color:new o.c6(b),u_space_color:new o.c6(b),u_temporal_offset:new o.bI(b),u_horizon_angle:new o.bI(b)}),model:b=>({u_matrix:new o.bF(b),u_lighting_matrix:new o.bF(b),u_normal_matrix:new o.bF(b),u_node_matrix:new o.bF(b),u_lightpos:new o.bH(b),u_lightintensity:new o.bI(b),u_lightcolor:new o.bH(b),u_camera_pos:new o.bH(b),u_opacity:new o.bI(b),u_baseColorFactor:new o.c6(b),u_emissiveFactor:new o.c6(b),u_metallicFactor:new o.bI(b),u_roughnessFactor:new o.bI(b),u_baseTextureIsAlpha:new o.bJ(b),u_alphaMask:new o.bJ(b),u_alphaCutoff:new o.bI(b),u_baseColorTexture:new o.bJ(b),u_metallicRoughnessTexture:new o.bJ(b),u_normalTexture:new o.bJ(b),u_occlusionTexture:new o.bJ(b),u_emissionTexture:new o.bJ(b),u_lutTexture:new o.bJ(b),u_color_mix:new o.c6(b),u_aoIntensity:new o.bI(b),u_emissive_strength:new o.bI(b),u_occlusionTextureTransform:new o.c6(b)}),modelDepth:b=>({u_matrix:new o.bF(b),u_instance:new o.bF(b),u_node_matrix:new o.bF(b)}),groundShadow:b=>({u_matrix:new o.bF(b),u_ground_shadow_factor:new o.bH(b)}),stars:b=>({u_matrix:new o.bF(b),u_up:new o.bH(b),u_right:new o.bH(b),u_intensity_multiplier:new o.bI(b)}),occlusion:b=>({u_matrix:new o.bF(b),u_anchorPos:new o.bH(b),u_screenSizePx:new o.bG(b),u_occluderSizePx:new o.bG(b),u_color:new o.c6(b)})};class _a{constructor(u,p,w,E){this.id=_a.uniqueIdxCounter,_a.uniqueIdxCounter++,this.context=u;const P=u.gl;this.buffer=P.createBuffer(),this.dynamicDraw=!!w,this.context.unbindVAO(),u.bindElementBuffer.set(this.buffer),P.bufferData(P.ELEMENT_ARRAY_BUFFER,p.arrayBuffer,this.dynamicDraw?P.DYNAMIC_DRAW:P.STATIC_DRAW),this.dynamicDraw||E||p.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(u){this.id=_a.uniqueIdxCounter,_a.uniqueIdxCounter++;const p=this.context.gl;this.context.unbindVAO(),this.bind(),p.bufferSubData(p.ELEMENT_ARRAY_BUFFER,0,u.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}_a.uniqueIdxCounter=0;const qu={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Yn{constructor(u,p,w,E,P,F){this.length=p.length,this.attributes=w,this.itemSize=p.bytesPerElement,this.dynamicDraw=E,this.instanceCount=F,this.context=u;const W=u.gl;this.buffer=W.createBuffer(),u.bindVertexBuffer.set(this.buffer),W.bufferData(W.ARRAY_BUFFER,p.arrayBuffer,this.dynamicDraw?W.DYNAMIC_DRAW:W.STATIC_DRAW),this.dynamicDraw||P||p.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(u){const p=this.context.gl;this.bind(),p.bufferSubData(p.ARRAY_BUFFER,0,u.arrayBuffer)}enableAttributes(u,p){for(let w=0;w<this.attributes.length;w++){const E=p.attributes[this.attributes[w].name];E!==void 0&&u.enableVertexAttribArray(E)}}setVertexAttribPointers(u,p,w){for(let E=0;E<this.attributes.length;E++){const P=this.attributes[E],F=p.attributes[P.name];F!==void 0&&u.vertexAttribPointer(F,P.components,u[qu[P.type]],!1,this.itemSize,P.offset+this.itemSize*(w||0))}}setVertexAttribDivisor(u,p,w){for(let E=0;E<this.attributes.length;E++){const P=p.attributes[this.attributes[E].name];P!==void 0&&this.instanceCount&&this.instanceCount>0&&u.vertexAttribDivisor(P,w)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Uc{constructor(u,p,w,E,P){this.context=u,this.width=p,this.height=w;const F=this.framebuffer=u.gl.createFramebuffer();E&&(this.colorAttachment=new wg(u,F)),P&&(this.depthAttachmentType=P,this.depthAttachment=P==="renderbuffer"?new zp(u,F):new Sg(u,F))}destroy(){const u=this.context.gl;if(this.colorAttachment){const p=this.colorAttachment.get();p&&u.deleteTexture(p)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const p=this.depthAttachment.get();p&&u.deleteRenderbuffer(p)}else{const p=this.depthAttachment.get();p&&u.deleteTexture(p)}u.deleteFramebuffer(this.framebuffer)}}class $p{constructor(u,p){this.gl=u,this.clearColor=new pd(this),this.clearDepth=new kv(this),this.clearStencil=new fg(this),this.colorMask=new Bp(this),this.depthMask=new md(this),this.stencilMask=new Ov(this),this.stencilFunc=new Fv(this),this.stencilOp=new dg(this),this.stencilTest=new Nc(this),this.depthRange=new Nv(this),this.depthTest=new pg(this),this.depthFunc=new mg(this),this.blend=new zv(this),this.blendFunc=new Kh(this),this.blendColor=new gg(this),this.blendEquation=new vg(this),this.cullFace=new _g(this),this.cullFaceSide=new Uv(this),this.frontFace=new yg(this),this.program=new Ax(this),this.activeTexture=new gd(this),this.viewport=new kp(this),this.bindFramebuffer=new Vv(this),this.bindRenderbuffer=new ul(this),this.bindTexture=new Gv(this),this.bindVertexBuffer=new Op(this),this.bindElementBuffer=new Fp(this),this.bindVertexArrayOES=new xg(this),this.pixelStoreUnpack=new bg(this),this.pixelStoreUnpackPremultiplyAlpha=new Jh(this),this.pixelStoreUnpackFlipY=new Hv(this),this.options=p?{...p}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=u.getExtension("EXT_texture_filter_anisotropic")||u.getExtension("MOZ_EXT_texture_filter_anisotropic")||u.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=u.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=u.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=u.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=u.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=u.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=u.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=u.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=u.getParameter(u.MAX_TEXTURE_SIZE),this.maxPointSize=u.getParameter(u.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(u,p,w){return new _a(this,u,p,w)}createVertexBuffer(u,p,w,E,P){return new Yn(this,u,p,w,E,P)}createRenderbuffer(u,p,w){const E=this.gl,P=E.createRenderbuffer();return this.bindRenderbuffer.set(P),E.renderbufferStorage(E.RENDERBUFFER,u,p,w),this.bindRenderbuffer.set(null),P}createFramebuffer(u,p,w,E){return new Uc(this,u,p,w,E)}clear({color:u,depth:p,stencil:w,colorMask:E}){const P=this.gl;let F=0;u&&(F|=P.COLOR_BUFFER_BIT,this.clearColor.set(u),this.colorMask.set(E||[!0,!0,!0,!0])),p!==void 0&&(F|=P.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(p),this.depthMask.set(!0)),w!==void 0&&(F|=P.STENCIL_BUFFER_BIT,this.clearStencil.set(w),this.stencilMask.set(255)),P.clear(F)}setCullFace(u){u.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(u.mode),this.frontFace.set(u.frontFace))}setDepthMode(u){u.func!==this.gl.ALWAYS||u.mask?(this.depthTest.set(!0),this.depthFunc.set(u.func),this.depthMask.set(u.mask),this.depthRange.set(u.range)):this.depthTest.set(!1)}setStencilMode(u){u.test.func!==this.gl.ALWAYS||u.mask?(this.stencilTest.set(!0),this.stencilMask.set(u.mask),this.stencilOp.set([u.fail,u.depthFail,u.pass]),this.stencilFunc.set({func:u.test.func,ref:u.ref,mask:u.test.mask})):this.stencilTest.set(!1)}setColorMode(u){o.bh(u.blendFunction,Mr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(u.blendFunction),this.blendColor.set(u.blendColor),u.blendEquation?this.blendEquation.set(u.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(u.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let bd;function qp(b,u,p,w,E,P,F){const W=b.context,$=W.gl,J=b.transform,Q=b.getOrCreateProgram("collisionBox"),oe=[];let le=0,ue=0;for(let De=0;De<w.length;De++){const je=w[De],Ge=u.getTile(je),et=Ge.getBucket(p);if(!et)continue;const Ke=Uh(je,et,J);let tt=Ke;E[0]===0&&E[1]===0||(tt=b.translatePosMatrix(Ke,Ge,E,P));const ct=F?et.textCollisionBox:et.iconCollisionBox,st=et.collisionCircleArray;if(st.length>0){const rt=o.a6.mat4.create(),xt=tt;o.a6.mat4.mul(rt,et.placementInvProjMatrix,J.glCoordMatrix),o.a6.mat4.mul(rt,rt,et.placementViewportMatrix),oe.push({circleArray:st,circleOffset:ue,transform:xt,invTransform:rt,projection:et.getProjection()}),le+=st.length/4,ue=le}ct&&(b.terrain&&b.terrain.setupElevationDraw(Ge,Q),Q.draw(b,$.LINES,$n.disabled,pr.disabled,b.colorModeForRenderPass(),_r.disabled,Cx(tt,J,Ge,et.getProjection()),p.id,ct.layoutVertexBuffer,ct.indexBuffer,ct.segments,null,J.zoom,null,[ct.collisionVertexBuffer,ct.collisionVertexBufferExt]))}if(!F||!oe.length)return;const ve=b.getOrCreateProgram("collisionCircle"),_e=new o.cQ;_e.resize(4*le),_e._trim();let be=0;for(const De of oe)for(let je=0;je<De.circleArray.length/4;je++){const Ge=4*je,et=De.circleArray[Ge+0],Ke=De.circleArray[Ge+1],tt=De.circleArray[Ge+2],ct=De.circleArray[Ge+3];_e.emplace(be++,et,Ke,tt,ct,0),_e.emplace(be++,et,Ke,tt,ct,1),_e.emplace(be++,et,Ke,tt,ct,2),_e.emplace(be++,et,Ke,tt,ct,3)}(!bd||bd.length<2*le)&&(bd=function(De){const je=2*De,Ge=new o.aO;Ge.resize(je),Ge._trim();for(let et=0;et<je;et++){const Ke=6*et;Ge.uint16[Ke+0]=4*et+0,Ge.uint16[Ke+1]=4*et+1,Ge.uint16[Ke+2]=4*et+2,Ge.uint16[Ke+3]=4*et+2,Ge.uint16[Ke+4]=4*et+3,Ge.uint16[Ke+5]=4*et+0}return Ge}(le));const we=W.createIndexBuffer(bd,!0),ke=W.createVertexBuffer(_e,o.cR.members,!0);for(const De of oe){const je={u_matrix:De.transform,u_inv_matrix:De.invTransform,u_camera_to_center_distance:(Ne=J).getCameraToCenterDistance(De.projection),u_viewport_size:[Ne.width,Ne.height]};ve.draw(b,$.TRIANGLES,$n.disabled,pr.disabled,b.colorModeForRenderPass(),_r.disabled,je,p.id,ke,we,o.b1.simpleSegment(0,2*De.circleOffset,De.circleArray.length,De.circleArray.length/2),null,J.zoom)}var Ne;ke.destroy(),we.destroy()}const wd=o.a6.mat4.create();function Pg(b){const u=b._camera.getWorldToCamera(b.worldSize,1),p=o.a6.mat4.multiply([],u,b.globeMatrix);o.a6.mat4.invert(p,p);const w=[0,0,0],E=[0,1,0,0];return o.a6.vec4.transformMat4(E,E,p),w[0]=E[0],w[1]=E[1],w[2]=E[2],o.a6.vec3.normalize(w,w),w}function Ix({width:b,height:u,anchor:p,textOffset:w,textScale:E},P){const{horizontalAlign:F,verticalAlign:W}=o.bx(p),$=-(F-.5)*b,J=-(W-.5)*u,Q=o.bw(p,w);return new o.P(($/E+Q[0])*P,(J/E+Q[1])*P)}function Rx(b,u,p,w,E,P,F,W,$,J,Q){const oe=b.text.placedSymbolArray,le=b.text.dynamicLayoutVertexArray,ue=b.icon.dynamicLayoutVertexArray,ve={},_e=b.getProjection(),be=kc(W,_e,P),we=P.elevation,ke=_e.upVectorScale(W.canonical,P.center.lat,P.worldSize).metersToTile;le.clear();for(let Ne=0;Ne<oe.length;Ne++){const De=oe.get(Ne),{tileAnchorX:je,tileAnchorY:Ge,numGlyphs:et}=De,Ke=De.hidden||!De.crossTileID||b.allowVerticalPlacement&&!De.placedOrientation?null:w[De.crossTileID];if(Ke){let tt=0,ct=0,st=0;if(we){const Vt=we?we.getAtTileOffset(W,je,Ge):0,[fn,pn,qt]=_e.upVector(W.canonical,je,Ge);tt=Vt*fn*ke,ct=Vt*pn*ke,st=Vt*qt*ke}let[rt,xt,Ft,Zt]=ma(De.projectedAnchorX+tt,De.projectedAnchorY+ct,De.projectedAnchorZ+st,p?be:F);const kt=ni(P.getCameraToCenterDistance(_e),Zt);let hn=E.evaluateSizeForFeature(b.textSizeData,J,De)*kt/o.bq;p&&(hn*=b.tilePixelRatio/$);const bt=Ix(Ke,hn);p?({x:rt,y:xt,z:Ft}=_e.projectTilePoint(je+bt.x,Ge+bt.y,W.canonical),[rt,xt,Ft]=ma(rt+tt,xt+ct,Ft+st,F)):(u&&bt._rotate(-P.angle),rt+=bt.x,xt+=bt.y,Ft=0);const Wt=b.allowVerticalPlacement&&De.placedOrientation===o.bk.vertical?Math.PI/2:0;for(let Vt=0;Vt<et;Vt++)o.bn(le,rt,xt,Ft,Wt);Q&&De.associatedIconIndex>=0&&(ve[De.associatedIconIndex]={x:rt,y:xt,z:Ft,angle:Wt})}else al(et,le)}if(Q){ue.clear();const Ne=b.icon.placedSymbolArray;for(let De=0;De<Ne.length;De++){const je=Ne.get(De),{numGlyphs:Ge}=je,et=ve[De];if(je.hidden||!et)al(Ge,ue);else{const{x:Ke,y:tt,z:ct,angle:st}=et;for(let rt=0;rt<Ge;rt++)o.bn(ue,Ke,tt,ct,st)}}b.icon.dynamicLayoutVertexBuffer.updateData(ue)}b.text.dynamicLayoutVertexBuffer.updateData(le)}function Sd(b,u,p,w,E,P,F={}){const W=p.paint.get("icon-translate"),$=p.paint.get("text-translate"),J=p.paint.get("icon-translate-anchor"),Q=p.paint.get("text-translate-anchor"),oe=p.layout.get("icon-rotation-alignment"),le=p.layout.get("text-rotation-alignment"),ue=p.layout.get("icon-pitch-alignment"),ve=p.layout.get("text-pitch-alignment"),_e=p.layout.get("icon-keep-upright"),be=p.layout.get("text-keep-upright"),we=p.paint.get("icon-color-saturation"),ke=p.paint.get("icon-color-contrast"),Ne=p.paint.get("icon-color-brightness-min"),De=p.paint.get("icon-color-brightness-max"),je=p.paint.get("symbol-elevation-reference")==="sea",Ge=p.paint.get("text-occlusion-opacity").constantOr(0),et=b.context,Ke=et.gl,tt=b.transform,ct=oe==="map",st=le==="map",rt=ue==="map",xt=ve==="map",Ft=p.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Zt=!1;const kt=b.depthModeForSublayer(0,$n.ReadOnly),hn=[o.am(tt.center.lng),o.at(tt.center.lat)],bt=p.layout.get("text-variable-anchor"),Wt=tt.projection.name==="globe",Vt=[],fn=[0,-1,0];for(const pn of w){const qt=u.getTile(pn),en=qt.getBucket(p);if(!en||en.projection.name==="mercator"&&Wt||en.fullyClipped)continue;const er=en.projection.name==="globe",xn=er?o.a9(tt.zoom):0,Dn=kc(pn,en.getProjection(),tt),yr=tt.calculatePixelsToTileUnitsMatrix(qt),qn=bt&&en.hasTextData(),ur=en.hasIconTextFit()&&qn&&en.hasIconData(),Ur=en.getProjection().createInversionMatrix(tt,pn.canonical),Br=Pi=>{tt.depthOcclusionForSymbolsAndCircles&&(p.hasInitialOcclusionOpacityProperties||b.terrain)&&(Pi.push("DEPTH_D24"),Pi.push("DEPTH_OCCLUSION"))},Mi=()=>{const Pi=ct&&p.layout.get("symbol-placement")!=="point",kr=[];Br(kr);const di=Pi||ur,Si=p.paint.get("icon-image-cross-fade").constantOr(0);b.terrainRenderModeElevated()&&rt&&kr.push("PITCH_WITH_MAP_TERRAIN"),er&&(kr.push("PROJECTION_GLOBE_VIEW"),di&&kr.push("PROJECTED_POS_ON_VIEWPORT")),Si>0&&kr.push("ICON_TRANSITION"),en.icon.zOffsetVertexBuffer&&kr.push("Z_OFFSET"),we===0&&ke===0&&Ne===0&&De===1||kr.push("COLOR_ADJUSTMENT"),en.sdfIcons&&kr.push("RENDER_SDF");const Fs=en.icon.programConfigurations.get(p.id),Qs=b.getOrCreateProgram("symbol",{config:Fs,defines:kr}),si=qt.imageAtlasTexture?qt.imageAtlasTexture.size:[0,0],Oo=en.iconSizeData,Yo=o.bj(Oo,tt.zoom),Fo=rt||tt.pitch!==0,Zi=ei(Dn,qt.tileID.canonical,rt,ct,tt,en.getProjection(),yr),dl=zs(Dn,qt.tileID.canonical,rt,ct,tt,en.getProjection(),yr),pl=b.translatePosMatrix(dl,qt,W,J,!0),Wc=b.translatePosMatrix(Dn,qt,W,J),fc=di?wd:Zi,Rl=ct&&!rt&&!Pi;let Xc=fn;!Wt&&!tt.mercatorFromTransition||ct||(Xc=Pg(tt));const pf=er?Xc:fn,Bd=p.getColorAdjustmentMatrix(we,ke,Ne,De),th=Kv(Oo.kind,Yo,Rl,rt,b,Wc,fc,pl,je,!1,si,[0,0],!0,pn,xn,hn,Ur,pf,en.getProjection(),Bd,Si),jg=qt.imageAtlasTexture?qt.imageAtlasTexture:null,Wg=p.layout.get("icon-size").constantOr(0)!==1||en.iconsNeedLinear,Fx=en.sdfIcons||b.options.rotating||b.options.zooming||Wg||Fo?Ke.LINEAR:Ke.NEAREST,Xg=en.sdfIcons&&p.paint.get("icon-halo-width").constantOr(1)!==0,Yi=b.terrain&&rt&&Pi?o.a6.mat4.invert(o.a6.mat4.create(),Zi):wd;if(Pi&&en.icon){const nm=tt.elevation,n3=nm?nm.getAtTileOffsetFunc(pn,tt.center.lat,tt.worldSize,en.getProjection()):null,hM=Zr(Dn,qt.tileID.canonical,rt,ct,tt,en.getProjection(),yr);Xa(en,Dn,b,!1,hM,dl,rt,_e,n3,pn)}return{program:Qs,buffers:en.icon,uniformValues:th,atlasTexture:jg,atlasTextureIcon:null,atlasInterpolation:Fx,atlasInterpolationIcon:null,isSDF:en.sdfIcons,hasHalo:Xg,tile:qt,labelPlaneMatrixInv:Yi}},Ni=()=>{const Pi=st&&p.layout.get("symbol-placement")!=="point",kr=[],di=Pi||bt||ur;b.terrainRenderModeElevated()&&xt&&kr.push("PITCH_WITH_MAP_TERRAIN"),er&&(kr.push("PROJECTION_GLOBE_VIEW"),di&&kr.push("PROJECTED_POS_ON_VIEWPORT")),en.text.zOffsetVertexBuffer&&kr.push("Z_OFFSET"),en.iconsInText&&kr.push("RENDER_TEXT_AND_SYMBOL"),kr.push("RENDER_SDF"),Br(kr);const Si=en.text.programConfigurations.get(p.id),Fs=b.getOrCreateProgram("symbol",{config:Si,defines:kr});let Qs,si=[0,0],Oo=null;const Yo=en.textSizeData;en.iconsInText&&(si=qt.imageAtlasTexture?qt.imageAtlasTexture.size:[0,0],Oo=qt.imageAtlasTexture?qt.imageAtlasTexture:null,Qs=xt||tt.pitch!==0||b.options.rotating||b.options.zooming||Yo.kind==="composite"||Yo.kind==="camera"?Ke.LINEAR:Ke.NEAREST);const Fo=qt.glyphAtlasTexture?qt.glyphAtlasTexture.size:[0,0],Zi=o.bj(Yo,tt.zoom),dl=ei(Dn,qt.tileID.canonical,xt,st,tt,en.getProjection(),yr),pl=zs(Dn,qt.tileID.canonical,xt,st,tt,en.getProjection(),yr),Wc=b.translatePosMatrix(pl,qt,$,Q,!0),fc=b.translatePosMatrix(Dn,qt,$,Q),Rl=di?wd:dl,Xc=st&&!xt&&!Pi;let pf=fn;!Wt&&!tt.mercatorFromTransition||st||(pf=Pg(tt));const Bd=Kv(Yo.kind,Zi,Xc,xt,b,fc,Rl,Wc,je,!0,Fo,si,!0,pn,xn,hn,Ur,er?pf:fn,en.getProjection(),Ge),th=qt.glyphAtlasTexture?qt.glyphAtlasTexture:null,jg=Ke.LINEAR,Wg=p.paint.get("text-halo-width").constantOr(1)!==0,Fx=b.terrain&&xt&&Pi?o.a6.mat4.invert(o.a6.mat4.create(),dl):wd;if(Pi&&en.text){const Xg=tt.elevation,Yi=Xg?Xg.getAtTileOffsetFunc(pn,tt.center.lat,tt.worldSize,en.getProjection()):null,nm=Zr(Dn,qt.tileID.canonical,xt,st,tt,en.getProjection(),yr);Xa(en,Dn,b,!0,nm,pl,xt,be,Yi,pn)}return{program:Fs,buffers:en.text,uniformValues:Bd,atlasTexture:th,atlasTextureIcon:Oo,atlasInterpolation:jg,atlasInterpolationIcon:Qs,isSDF:!0,hasHalo:Wg,tile:qt,labelPlaneMatrixInv:Fx}},ns=en.icon.segments.get().length,jc=en.text.segments.get().length,Js=ns&&!F.onlyText?Mi():null,Yr=jc&&!F.onlyIcons?Ni():null,Oi=p.paint.get("icon-opacity").constantOr(1),bs=p.paint.get("text-opacity").constantOr(1);if(Ft&&en.canOverlap){Zt=!0;const Pi=Oi&&!F.onlyText?en.icon.segments.get():[],kr=bs&&!F.onlyIcons?en.text.segments.get():[];for(const di of Pi)Vt.push({segments:new o.b1([di]),sortKey:di.sortKey,state:Js});for(const di of kr)Vt.push({segments:new o.b1([di]),sortKey:di.sortKey,state:Yr})}else F.onlyText||Vt.push({segments:Oi?en.icon.segments:new o.b1([]),sortKey:0,state:Js}),F.onlyIcons||Vt.push({segments:bs?en.text.segments:new o.b1([]),sortKey:0,state:Yr})}Zt&&Vt.sort((pn,qt)=>pn.sortKey-qt.sortKey);for(const pn of Vt){const qt=pn.state;if(qt)if(b.terrain?b.terrain.setupElevationDraw(qt.tile,qt.program,{useDepthForOcclusion:tt.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:qt.labelPlaneMatrixInv}):b.setupDepthForOcclusion(tt.depthOcclusionForSymbolsAndCircles,qt.program),et.activeTexture.set(Ke.TEXTURE0),qt.atlasTexture&&qt.atlasTexture.bind(qt.atlasInterpolation,Ke.CLAMP_TO_EDGE,!0),qt.atlasTextureIcon&&(et.activeTexture.set(Ke.TEXTURE1),qt.atlasTextureIcon&&qt.atlasTextureIcon.bind(qt.atlasInterpolationIcon,Ke.CLAMP_TO_EDGE,!0)),b.uploadCommonLightUniforms(b.context,qt.program),qt.hasHalo){const en=qt.uniformValues;en.u_is_halo=1,rf(qt.buffers,pn.segments,p,b,qt.program,kt,E,P,en,2),en.u_is_halo=0}else{if(qt.isSDF){const en=qt.uniformValues;qt.hasHalo&&(en.u_is_halo=1,rf(qt.buffers,pn.segments,p,b,qt.program,kt,E,P,en,1)),en.u_is_halo=0}rf(qt.buffers,pn.segments,p,b,qt.program,kt,E,P,qt.uniformValues,1)}}}function rf(b,u,p,w,E,P,F,W,$,J){const Q=[b.dynamicLayoutVertexBuffer,b.opacityVertexBuffer,b.iconTransitioningVertexBuffer,b.globeExtVertexBuffer,b.zOffsetVertexBuffer];E.draw(w,w.context.gl.TRIANGLES,P,F,W,_r.disabled,$,p.id,b.layoutVertexBuffer,b.indexBuffer,u,p.paint,w.transform.zoom,b.programConfigurations.get(p.id),Q,J)}function Ad(b,u,p,w,E,P,F){const W=b.context.gl,$=p.paint.get("fill-pattern"),J=p.is3D(),Q=J?b.stencilModeFor3D():pr.disabled,oe=$&&$.constantOr(1);let le,ue,ve,_e,be;F?(ue=oe&&!p.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",le=W.LINES):(ue=oe?"fillPattern":"fill",le=W.TRIANGLES);for(const we of w){const ke=u.getTile(we);if(oe&&!ke.patternsLoaded())continue;const Ne=ke.getBucket(p);if(!Ne)continue;b.prepareDrawTile();const De=Ne.programConfigurations.get(p.id),je=b.isTileAffectedByFog(we),Ge=b.getOrCreateProgram(ue,{config:De,overrideFog:je});oe&&(b.context.activeTexture.set(W.TEXTURE0),ke.imageAtlasTexture&&ke.imageAtlasTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE),De.updatePaintBuffers());const et=$.constantOr(null);if(et&&ke.imageAtlas){const ct=ke.imageAtlas.patternPositions[et.toString()];ct&&De.setConstantPatternPositions(ct)}const Ke=b.translatePosMatrix(we.projMatrix,ke,p.paint.get("fill-translate"),p.paint.get("fill-translate-anchor")),tt=p.paint.get("fill-emissive-strength");if(F){_e=Ne.indexBuffer2,be=Ne.segments2;const ct=b.terrain&&b.terrain.renderingToTexture?b.terrain.drapeBufferSize:[W.drawingBufferWidth,W.drawingBufferHeight];ve=ue==="fillOutlinePattern"&&oe?nf(Ke,tt,b,ke,ct):qv(Ke,tt,ct)}else _e=Ne.indexBuffer,be=Ne.segments,ve=oe?Eg(Ke,tt,b,ke):Gp(Ke,tt);b.uploadCommonUniforms(b.context,Ge,we.toUnwrapped()),Ge.draw(b,le,E,J?Q:b.stencilModeForClipping(we),P,_r.disabled,ve,p.id,Ne.layoutVertexBuffer,_e,be,p.paint,b.transform.zoom,De,void 0)}}function sf(b,u,p,w,E,P,F,W){p.resetLayerRenderingStats(b);const $=b.context,J=$.gl,Q=b.transform,oe=p.paint.get("fill-extrusion-pattern"),le=oe.constantOr(1),ue=p.paint.get("fill-extrusion-opacity"),ve=b.style.enable3dLights(),_e=p.paint.get(ve&&!le?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),be=[p.paint.get("fill-extrusion-ambient-occlusion-intensity"),_e],we=p.layout.get("fill-extrusion-edge-radius"),ke=we>0&&!p.paint.get("fill-extrusion-rounded-roof"),Ne=ke?0:we,De=Q.projection.name==="globe"?o.c_():0,je=Q.projection.name==="globe",Ge=je?o.a9(Q.zoom):0,et=[o.am(Q.center.lng),o.at(Q.center.lat)],Ke=p.paint.get("fill-extrusion-flood-light-color").toRenderColor(p.lut).toArray01().slice(0,3),tt=p.paint.get("fill-extrusion-flood-light-intensity"),ct=p.paint.get("fill-extrusion-vertical-scale"),st=p.paint.get("fill-extrusion-line-width").constantOr(1)!==0,rt=tc(b,p.paint.get("fill-extrusion-cutoff-fade-range")),xt=[];let Ft;je&&xt.push("PROJECTION_GLOBE_VIEW"),be[0]>0&&xt.push("FAUX_AO"),ke&&xt.push("ZERO_ROOF_RADIUS"),W&&xt.push("HAS_CENTROID"),tt>0&&xt.push("FLOOD_LIGHT"),rt.shouldRenderCutoff&&xt.push("RENDER_CUTOFF"),st&&xt.push("RENDER_WALL_MODE");const Zt=b.renderPass==="shadow",kt=b.shadowRenderer,hn=Zt&&!!kt;b.shadowRenderer&&(b.shadowRenderer.useNormalOffset=!0);let bt=[0,0,0];if(kt){const fn=b.style.directionalLight,pn=b.style.ambientLight;fn&&pn&&(bt=Ip(b.style,fn,pn)),Ft=xt.concat(["SHADOWS_SINGLE_CASCADE"])}const Wt=hn?"fillExtrusionDepth":le?"fillExtrusionPattern":"fillExtrusion",Vt=p.getLayerRenderingStats();for(const fn of w){const pn=u.getTile(fn),qt=pn.getBucket(p);if(!qt||qt.projection.name!==Q.projection.name)continue;let en=!1;kt&&(en=kt.getMaxCascadeForTile(fn.toUnwrapped())===0);const er=b.isTileAffectedByFog(fn),xn=qt.programConfigurations.get(p.id),Dn=b.getOrCreateProgram(Wt,{config:xn,defines:en?Ft:xt,overrideFog:er});if(b.terrain&&b.terrain.setupElevationDraw(pn,Dn,{useMeterToDem:!0}),!qt.centroidVertexBuffer){const Ni=Dn.attributes.a_centroid_pos;Ni!==void 0&&J.vertexAttrib2f(Ni,0,0)}!Zt&&kt&&kt.setupShadows(pn.tileID.toUnwrapped(),Dn,"vector-tile",pn.tileID.overscaledZ),le&&(b.context.activeTexture.set(J.TEXTURE0),pn.imageAtlasTexture&&pn.imageAtlasTexture.bind(J.LINEAR,J.CLAMP_TO_EDGE),xn.updatePaintBuffers());const yr=oe.constantOr(null);if(yr&&pn.imageAtlas){const Ni=pn.imageAtlas.patternPositions[yr.toString()];Ni&&xn.setConstantPatternPositions(Ni)}const qn=p.paint.get("fill-extrusion-vertical-gradient"),ur=1/qt.tileToMeter;let Ur;if(Zt&&kt){if(Dg(pn.tileID,qt,b))continue;const Ni=kt.calculateShadowPassMatrixFromTile(pn.tileID.toUnwrapped());Ur=$v(Ni,Ne,ur,ct)}else{const Ni=b.translatePosMatrix(fn.expandedProjMatrix,pn,p.paint.get("fill-extrusion-translate"),p.paint.get("fill-extrusion-translate-anchor")),ns=Q.projection.createInversionMatrix(Q,fn.canonical);Ur=le?Cg(Ni,b,qn,ue,be,Ne,ur,fn,pn,De,Ge,et,ns,Ke,ct):Mg(Ni,b,qn,ue,be,Ne,ur,fn,De,Ge,et,ns,Ke,ct,tt,bt)}b.uploadCommonUniforms($,Dn,fn.toUnwrapped(),null,rt);let Br=qt.segments;if(Q.projection.name==="mercator"&&!Zt&&(Br=qt.getVisibleSegments(pn.tileID,b.terrain,b.transform.getFrustum(0)),!Br.get().length))continue;if(Vt)if(Zt)for(const Ni of Br.get())Vt.numRenderedVerticesInShadowPass+=Ni.primitiveLength;else for(const Ni of Br.get())Vt.numRenderedVerticesInTransparentPass+=Ni.primitiveLength;const Mi=[];(b.terrain||W)&&Mi.push(qt.centroidVertexBuffer),je&&Mi.push(qt.layoutVertexExtBuffer),st&&Mi.push(qt.wallVertexBuffer),Dn.draw(b,$.gl.TRIANGLES,E,P,F,_r.backCCW,Ur,p.id,qt.layoutVertexBuffer,qt.indexBuffer,Br,p.paint,b.transform.zoom,xn,Mi)}b.shadowRenderer&&(b.shadowRenderer.useNormalOffset=!1)}function ao(b,u,p,w,E,P,F,W,$,J,Q,oe,le,ue,ve,_e,be,we,ke){const Ne=b.context,De=Ne.gl,je=b.transform,Ge=b.transform.zoom,et=[],Ke=tc(b,p.paint.get("fill-extrusion-cutoff-fade-range"));J==="clear"?(et.push("CLEAR_SUBPASS"),ke&&(et.push("CLEAR_FROM_TEXTURE"),Ne.activeTexture.set(De.TEXTURE0),ke.bind(De.LINEAR,De.CLAMP_TO_EDGE))):J==="sdf"&&et.push("SDF_SUBPASS"),be&&et.push("HAS_CENTROID"),Ke.shouldRenderCutoff&&et.push("RENDER_CUTOFF");const tt=p.layout.get("fill-extrusion-edge-radius"),ct=(st,rt,xt,Ft,Zt)=>{const kt=rt.programConfigurations.get(p.id),hn=b.isTileAffectedByFog(st),bt=b.getOrCreateProgram("fillExtrusionGroundEffect",{config:kt,defines:et,overrideFog:hn}),Wt=((fn,pn,qt,en,er,xn,Dn,yr,qn,ur,Ur)=>({u_matrix:pn,u_opacity:qt,u_ao_pass:en?1:0,u_meter_to_tile:er,u_ao:xn,u_flood_light_intensity:Dn,u_flood_light_color:yr,u_attenuation:qn,u_edge_radius:ur,u_fb:0,u_fb_size:Ur,u_dynamic_offset:1}))(0,Ft,Q,$,Zt,[oe,le*Zt],ue,ve,_e,Ge>=17?0:tt*Zt,ke?ke.size[0]:0),Vt=[];be&&Vt.push(rt.hiddenByLandmarkVertexBuffer),b.uploadCommonUniforms(Ne,bt,st.toUnwrapped(),null,Ke),bt.draw(b,Ne.gl.TRIANGLES,E,P,F,W,Wt,p.id,rt.vertexBuffer,rt.indexBuffer,xt,p.paint,Ge,kt,Vt)};for(const st of w){const rt=u.getTile(st),xt=rt.getBucket(p);if(!xt||xt.projection.name!==je.projection.name||!xt.groundEffect||xt.groundEffect&&!xt.groundEffect.hasData())continue;const Ft=xt.groundEffect,Zt=1/xt.tileToMeter;{const kt=b.translatePosMatrix(st.projMatrix,rt,p.paint.get("fill-extrusion-translate"),p.paint.get("fill-extrusion-translate-anchor")),hn=Ft.getDefaultSegment();ct(st,Ft,hn,kt,Zt)}if(we)for(let kt=0;kt<4;kt++){const hn=o.c$[kt](st),bt=u.getTile(hn);if(!bt)continue;const Wt=bt.getBucket(p);if(!Wt||Wt.projection.name!==je.projection.name||!Wt.groundEffect||Wt.groundEffect&&!Wt.groundEffect.hasData())continue;const Vt=Wt.groundEffect;let fn,pn;kt===0?(fn=[-o.ab,0,0],pn=1):kt===1?(fn=[o.ab,0,0],pn=0):kt===2?(fn=[0,-o.ab,0],pn=3):(fn=[0,o.ab,0],pn=2);const qt=Vt.regionSegments[pn];if(!qt)continue;const en=new Float32Array(16);o.a6.mat4.translate(en,st.projMatrix,fn),ct(st,Vt,qt,b.translatePosMatrix(en,rt,p.paint.get("fill-extrusion-translate"),p.paint.get("fill-extrusion-translate-anchor")),Zt)}}}function sc(b,u,p,w,E,P,F){w.centroidVertexArray.length===0&&w.createCentroidsBuffer();const W=P?P.findDEMTileFor(p):null;if(!(W&&W.dem||F))return;const $=we=>new o.P(Math.ceil((we+o.d2)*o.d3),0),J=we=>{const ke=u.getSource().minzoom,Ne=je=>{const Ge=u.getTileByID(je);if(Ge&&Ge.hasData())return Ge.getBucket(E)},De=[0,-1,1];for(const je of De){if(we.overscaledZ+je<ke)continue;const Ge=Ne(we.calculateScaledKey(we.overscaledZ+je));if(Ge)return Ge}},Q=[0,0,0],oe=(we,ke)=>(Q[0]=Math.min(we.min.y,ke.min.y),Q[1]=Math.max(we.max.y,ke.max.y),Q[2]=o.ab-ke.min.x>we.max.x?ke.min.x-o.ab:we.max.x,Q),le=(we,ke)=>(Q[0]=Math.min(we.min.x,ke.min.x),Q[1]=Math.max(we.max.x,ke.max.x),Q[2]=o.ab-ke.min.y>we.max.y?ke.min.y-o.ab:we.max.y,Q),ue=[(we,ke)=>oe(we,ke),(we,ke)=>oe(ke,we),(we,ke)=>le(we,ke),(we,ke)=>le(ke,we)],ve=(we,ke,Ne,De,je,Ge,et)=>{if(!P)return 0;const Ke=[[Ge?Ne:we,Ge?we:Ne,0],[Ge?Ne:ke,Ge?ke:Ne,0]],tt=et<0?o.ab+et:et,ct=[Ge?tt:(we+ke)/2,Ge?(we+ke)/2:tt,0];return Ne===0&&et<0||Ne!==0&&et>0?P.getForTilePoints(je,[ct],!0,De):Ke.push(ct),P.getForTilePoints(p,Ke,!0,W),Math.max(Ke[0][2],Ke[1][2],ct[2])/P.exaggeration()};for(let we=0;we<4;we++){const ke=w.borderFeatureIndices[we];if(ke.length===0)continue;const Ne=o.c$[we](p),De=J(Ne);if(!(De&&De instanceof o.d0)||w.borderDoneWithNeighborZ[we]===De.canonical.z)continue;De.centroidVertexArray.length===0&&De.createCentroidsBuffer();const je=P?P.findDEMTileFor(Ne):null;if(!(je&&je.dem||F))continue;const Ge=(we<2?1:5)-we,et=De.borderDoneWithNeighborZ[Ge]!==w.canonical.z,Ke=De.borderFeatureIndices[Ge];let tt=0;if(w.canonical.z!==De.canonical.z){for(const ct of ke)w.showCentroid(w.featuresOnBorder[ct]);if(et)for(const ct of Ke)De.showCentroid(De.featuresOnBorder[ct]);w.borderDoneWithNeighborZ[we]=De.canonical.z,De.borderDoneWithNeighborZ[Ge]=w.canonical.z}for(const ct of ke){const st=w.featuresOnBorder[ct],rt=w.centroidData[st.centroidDataIndex],xt=st.borders[we];let Ft;for(;tt<Ke.length;){Ft=De.featuresOnBorder[Ke[tt]];const Zt=Ft.borders[Ge];if(Zt[1]>xt[0]+3||Zt[0]>xt[0]-3)break;De.showCentroid(Ft),tt++}if(Ft&&tt<Ke.length){const Zt=tt;let kt=0;for(;!(Ft.borders[Ge][0]>xt[1]-3)&&(kt++,++tt!==Ke.length);)Ft=De.featuresOnBorder[Ke[tt]];Ft=De.featuresOnBorder[Ke[Zt]];let hn=!1;if(kt>=1){const Vt=Ft.borders[Ge];Math.abs(xt[0]-Vt[0])<3&&Math.abs(xt[1]-Vt[1])<3&&(kt=1,hn=!0,tt=Zt+1)}else if(kt===0){w.showCentroid(st);continue}const bt=De.centroidData[Ft.centroidDataIndex];F&&hn&&(((_e=rt).flags|(be=bt).flags)&o.d1?(_e.flags|=o.d1,be.flags|=o.d1):(_e.flags&=~o.d1,be.flags&=~o.d1));const Wt=st.intersectsCount()>1||Ft.intersectsCount()>1;if(kt>1)tt=Zt,rt.centroidXY=bt.centroidXY=new o.P(0,0);else if(je&&je.dem&&!Wt){const Vt=ue[we](rt,bt),fn=we%2?o.ab-1:0,pn=ve(Vt[0],Math.min(o.ab-1,Vt[1]),fn,je,Ne,we<2,Vt[2]);rt.centroidXY=bt.centroidXY=$(pn)}else Wt?rt.centroidXY=bt.centroidXY=new o.P(0,0):(rt.centroidXY=w.encodeBorderCentroid(st),bt.centroidXY=De.encodeBorderCentroid(Ft));w.writeCentroidToBuffer(rt),De.writeCentroidToBuffer(bt)}else w.showCentroid(st)}w.borderDoneWithNeighborZ[we]=De.canonical.z,De.borderDoneWithNeighborZ[Ge]=w.canonical.z}var _e,be;(w.needsCentroidUpdate||!w.centroidVertexBuffer&&w.centroidVertexArray.length!==0)&&w.uploadCentroid(b)}const Px=[1,0,0],Jv=[0,1,0],Lg=[0,0,1];function Dg(b,u,p){const w=p.transform,E=p.shadowRenderer;if(!E)return!0;const P=b.toUnwrapped(),F=w.tileSize*E._cascades[p.currentShadowCascade].scale;let W=u.maxHeight;if(w.elevation){const _e=w.elevation.getMinMaxForTile(b);_e&&(W+=_e.max)}const $=[...E.shadowDirection];$[2]=-$[2];const J=E.computeSimplifiedTileShadowVolume(P,W,F,$);if(!J)return!1;const Q=[Px,Jv,Lg,$,[$[0],0,$[2]],[0,$[1],$[2]]],oe=w.projection.name==="globe",le=w.scaleZoom(F),ue=o.bN.fromInvProjectionMatrix(w.invProjMatrix,w.worldSize,le,!oe),ve=E.getCurrentCascadeFrustum();return ue.intersectsPrecise(J.vertices,J.planes,Q)===0||ve.intersectsPrecise(J.vertices,J.planes,Q)===0}function Bg(b){return[b[0]*o.d4,b[1]*o.d4,b[2]*o.d4,0]}function Oa(b,u,p,w,E,P,F,W,$){const J=w.getSource(),Q=p.globeSharedBuffers;if(!Q)return;let oe,le,ue;if(u&&(oe=w.getTile(u)),J instanceof o.aD?(le=J.texture,ue=o.cD(0,0,p.transform)):oe&&u&&(le=oe.texture,ue=o.cD(u.canonical.z,u.canonical.x,p.transform)),!le||!ue)return;b||(ue=o.a6.mat4.scale(o.a6.mat4.create(),ue,[1,-1,1]));const ve=p.context,_e=ve.gl,be=E.paint.get("raster-resampling")==="nearest"?_e.NEAREST:_e.LINEAR,we=p.colorModeForDrapableLayerRenderPass(P),ke=F.defines;ke.push("GLOBE_POLES");const Ne=new $n(_e.LEQUAL,$n.ReadWrite,p.depthRangeFor3D),De=Float32Array.from(p.transform.expandedFarZProjMatrix),je=Float32Array.from(o.b5(o.cC(new o.bP(0,0,0))));p.terrain&&p.terrain.prepareDrawTile(),ve.activeTexture.set(_e.TEXTURE0),le.bind(be,_e.CLAMP_TO_EDGE),ve.activeTexture.set(_e.TEXTURE1),le.bind(be,_e.CLAMP_TO_EDGE),le.useMipmap&&ve.extTextureFilterAnisotropic&&p.transform.pitch>20&&_e.texParameterf(_e.TEXTURE_2D,ve.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,ve.extTextureFilterAnisotropicMax);const[Ge,et,Ke,tt]=u?Q.getPoleBuffers(u.canonical.z,!1):Q.getPoleBuffers(0,!0),ct=E.paint.get("raster-elevation");let st;b?(st=Ge,p.renderDefaultNorthPole=ct!==0):(st=et,p.renderDefaultSouthPole=ct!==0);const rt=Bg(F.mix),xt=((Zt,kt,hn,bt,Wt,Vt,fn,pn,qt,en,er,xn,Dn)=>yd(Zt,kt,hn,new Float32Array(16),new Float32Array(9),[0,0],bt,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Vt,[0,0],pn,2,en,er,xn,1,0,Dn))(De,je,ue,o.a9(p.transform.zoom),0,E,0,ct,0,rt,F.offset,F.range,P),Ft=p.getOrCreateProgram("raster",{defines:ke});p.uploadCommonUniforms(ve,Ft,null),Ft.draw(p,_e.TRIANGLES,Ne,$,we,W,xt,E.id,st,Ke,tt)}function hs(b){const u=b._nearZ,p=b.projection.farthestPixelDistance(b),w=p-u,E=.2*b.height,P=u+E;return[u,p,(P-E-u)/w,(P-u)/w]}function of(b,u,p,w){if(b)return u instanceof Er&&b instanceof rg?u.getTextureDescriptor(b,p,!0):{texture:b.texture,mix:Bg(w.mix),offset:w.offset,buffer:0,tileSize:1}}var Td=o.d5([{name:"a_index",type:"Int16",components:1}]);class Zp{constructor(u,p,w,E){const P={width:w[0],height:w[1],data:null},F=u.gl;this.targetColorTexture=new o.T(u,P,F.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new o.T(u,P,F.RGBA8,{useMipmap:!1}),this.context=u,this.updateParticleTexture(p,E),this.lastInvalidatedAt=0}updateParticleTexture(u,p){if(this.particleTextureDimension===p.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const w=this.context.gl,E=p.width*p.height;this.particleTexture0=new o.T(this.context,p,w.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new o.T(this.context,p,w.RGBA8,{premultiply:!1,useMipmap:!1});const P=new o.d6;P.reserve(E);for(let F=0;F<E;F++)P.emplaceBack(F);this.particleIndexBuffer=this.context.createVertexBuffer(P,Td.members,!0),this.particleSegment=o.b1.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=p.width}update(u){return!(this.lastInvalidatedAt<u&&(this.lastInvalidatedAt=o.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Yp(b,u,p){if(!b)return null;const w=u.getTextureDescriptor(b,p,!0);if(!w)return null;let{texture:E,mix:P,offset:F,tileSize:W,buffer:$,format:J}=w;if(!E||!J)return null;let Q=!1;return J==="uint32"&&(Q=!0,P[3]=0,P=jp(o.d7,P,[0,p.paint.get("raster-particle-max-speed")]),F=_d(o.d7,F,[0,p.paint.get("raster-particle-max-speed")])),{texture:E,textureOffset:[$/(W+2*$),W/(W+2*$)],tileSize:W,scalarData:Q,scale:P,offset:F,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[J]]}}function Md(b){const u=b._nearZ,p=b.projection.farthestPixelDistance(b),w=p-u,E=.2*b.height,P=u+E;return[u,p,(P-E-u)/w,(P-u)/w]}const Qv=new o.bz(1,0,0,1),Zu=new o.bz(0,1,0,1),Yu=new o.bz(0,0,1,1),gn=new o.bz(1,0,1,1),Kn=new o.bz(0,1,1,1);function oc(b,u,p,w,E,P,F){const W=b.context,$=b.transform,J=W.gl,Q=$.projection.name==="globe",oe=Q?["PROJECTION_GLOBE_VIEW"]:[];let le=o.a6.mat4.clone(p.projMatrix);if(Q&&o.a9($.zoom)>0){const rt=o.b4(p.canonical,$),xt=o.d8(rt);le=o.a6.mat4.multiply(new Float32Array(16),$.globeMatrix,xt),o.a6.mat4.multiply(le,$.projMatrix,le)}const ue=o.a6.mat4.create();ue[12]+=2*E/(o.q.devicePixelRatio*$.width),ue[13]+=2*P/(o.q.devicePixelRatio*$.height),o.a6.mat4.multiply(le,ue,le);const ve=b.getOrCreateProgram("debug",{defines:oe}),_e=u.getTileByID(p.key);b.terrain&&b.terrain.setupElevationDraw(_e,ve);const be=$n.disabled,we=pr.disabled,ke=b.colorModeForRenderPass(),Ne="$debug";W.activeTexture.set(J.TEXTURE0),b.emptyTexture.bind(J.LINEAR,J.CLAMP_TO_EDGE),Q?_e._makeGlobeTileDebugBuffers(b.context,$):_e._makeDebugTileBoundsBuffers(b.context,$.projection);const De=_e._tileDebugBuffer||b.debugBuffer,je=_e._tileDebugIndexBuffer||b.debugIndexBuffer,Ge=_e._tileDebugSegments||b.debugSegments;if(ve.draw(b,J.LINE_STRIP,be,we,ke,_r.disabled,Zv(le,w),Ne,De,je,Ge,null,null,null,[_e._globeTileDebugBorderBuffer]),F){const rt=_e.latestRawTileData,xt=Math.floor((rt&&rt.byteLength||0)/1024);let Ft=p.canonical.toString();p.overscaledZ!==p.canonical.z&&(Ft+=` => ${p.overscaledZ}`),Ft+=` ${_e.state}`,Ft+=` ${xt}kb`,function(Zt,kt){Zt.initDebugOverlayCanvas();const hn=Zt.debugOverlayCanvas,bt=Zt.context.gl,Wt=Zt.debugOverlayCanvas.getContext("2d");Wt.clearRect(0,0,hn.width,hn.height),Wt.shadowColor="white",Wt.shadowBlur=2,Wt.lineWidth=1.5,Wt.strokeStyle="white",Wt.textBaseline="top",Wt.font="bold 36px Open Sans, sans-serif",Wt.fillText(kt,5,5),Wt.strokeText(kt,5,5),Zt.debugOverlayTexture.update(hn),Zt.debugOverlayTexture.bind(bt.LINEAR,bt.CLAMP_TO_EDGE)}(b,Ft)}const et=u.getTile(p).tileSize,Ke=512/Math.min(et,512)*(p.overscaledZ/$.zoom)*.5,tt=_e._tileDebugTextBuffer||b.debugBuffer,ct=_e._tileDebugTextIndexBuffer||b.quadTriangleIndexBuffer,st=_e._tileDebugTextSegments||b.debugSegments;ve.draw(b,J.TRIANGLES,be,we,Mr.alphaBlended,_r.disabled,Zv(le,o.bz.transparent,Ke),Ne,tt,ct,st,null,null,null,[_e._globeTileDebugTextBuffer])}function Hi(b,u,p,w){Ds(b,0,u+p/2,b.transform.width,p,w)}function At(b,u,p,w){Ds(b,u-p/2,0,p,b.transform.height,w)}function Ds(b,u,p,w,E,P){const F=b.context,W=F.gl;W.enable(W.SCISSOR_TEST),W.scissor(u*o.q.devicePixelRatio,p*o.q.devicePixelRatio,w*o.q.devicePixelRatio,E*o.q.devicePixelRatio),F.clear({color:P}),W.disable(W.SCISSOR_TEST)}const fi=o.d5([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Ys}=fi;function ts(b,u,p,w){b.emplaceBack(u,p,w)}class Do{constructor(u){this.vertexArray=new o.d9,this.indices=new o.aO,ts(this.vertexArray,-1,-1,1),ts(this.vertexArray,1,-1,1),ts(this.vertexArray,-1,1,1),ts(this.vertexArray,1,1,1),ts(this.vertexArray,-1,-1,-1),ts(this.vertexArray,1,-1,-1),ts(this.vertexArray,-1,1,-1),ts(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=u.createVertexBuffer(this.vertexArray,Ys),this.indexBuffer=u.createIndexBuffer(this.indices),this.segment=o.b1.simpleSegment(0,0,36,12)}}function Bo(b,u,p,w,E,P){const F=b.context.gl,W=u.paint.get("sky-atmosphere-color"),$=u.paint.get("sky-atmosphere-halo-color"),J=u.paint.get("sky-atmosphere-sun-intensity"),Q=((oe,le,ue,ve,_e)=>({u_matrix_3f:oe,u_sun_direction:le,u_sun_intensity:ue,u_color_tint_r:[ve.r,ve.g,ve.b,ve.a],u_color_tint_m:[_e.r,_e.g,_e.b,_e.a],u_luminance:5e-5}))(o.a6.mat3.fromMat4(o.a6.mat3.create(),w),E,J,W,$);F.framebufferTexture2D(F.FRAMEBUFFER,F.COLOR_ATTACHMENT0,F.TEXTURE_CUBE_MAP_POSITIVE_X+P,u.skyboxTexture,0),p.draw(b,F.TRIANGLES,$n.disabled,pr.disabled,Mr.unblended,_r.frontCW,Q,"skyboxCapture",u.skyboxGeometry.vertexBuffer,u.skyboxGeometry.indexBuffer,u.skyboxGeometry.segment)}const ac=o.d5([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class ko{constructor(u){const p=new o.da;p.emplaceBack(-1,1,1,0,0),p.emplaceBack(1,1,1,1,0),p.emplaceBack(1,-1,1,1,1),p.emplaceBack(-1,-1,1,0,1);const w=new o.aO;w.emplaceBack(0,1,2),w.emplaceBack(2,3,0),this.vertexBuffer=u.createVertexBuffer(p,ac.members),this.indexBuffer=u.createIndexBuffer(w),this.segments=o.b1.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Kp=o.d5([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class af{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class lf{constructor(u){this.colorModeAlphaBlendedWriteRGB=new Mr([1,va,1,va],o.bz.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Mr([1,0,1,0],o.bz.transparent,[!1,!1,!1,!0]),this.params=new af,this.updateNeeded=!0,u.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),u.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),u.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),u.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(u){const p=u.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new ko(p);const w=this.params.sizeRange,E=this.params.intensityRange,P=function(Q){const oe=o.dd(30),le=[];for(let ue=0;ue<Q;++ue){const ve=2*Math.PI*oe(),_e=Math.acos(1-2*oe())-.5*Math.PI;le.push(o.a6.vec3.fromValues(Math.cos(_e)*Math.cos(ve),Math.cos(_e)*Math.sin(ve),Math.sin(_e)))}return le}(this.params.starsCount),F=o.dd(300),W=new o.db,$=new o.aO;let J=0;for(let Q=0;Q<P.length;++Q){const oe=o.a6.vec3.scale([],P[Q],200),le=Math.max(0,1+.01*w*(1*F()-.5)),ue=Math.max(0,1+.01*E*(1*F()-.5));W.emplaceBack(oe[0],oe[1],oe[2],-1,-1,le,ue),W.emplaceBack(oe[0],oe[1],oe[2],1,-1,le,ue),W.emplaceBack(oe[0],oe[1],oe[2],1,1,le,ue),W.emplaceBack(oe[0],oe[1],oe[2],-1,1,le,ue),$.emplaceBack(J+0,J+1,J+2),$.emplaceBack(J+0,J+2,J+3),J+=4}this.starsVx=p.createVertexBuffer(W,Kp.members),this.starsIdx=p.createIndexBuffer($),this.starsSegments=o.b1.simpleSegment(0,0,W.length,$.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(u,p){const w=u.context,E=w.gl,P=u.transform,F=new $n(E.LEQUAL,$n.ReadOnly,[0,1]),W=o.a9(P.zoom),$=u.style.getLut(p.scope),J=p.properties.get("color").toRenderColor($).toArray01(),Q=p.properties.get("high-color").toRenderColor($).toArray01(),oe=p.properties.get("space-color").toRenderColor($).toArray01PremultipliedAlpha(),le=5e-4,ue=o.dc(p.properties.get("horizon-blend"),0,1,le,.25),ve=o.cx(u,w,P)&&ue===le?P.worldSize/(2*Math.PI*1.025)-1:P.globeRadius,_e=u.frameCounter/1e3%1,be=o.a6.vec3.length(P.globeCenterInViewSpace),we=Math.sqrt(Math.pow(be,2)-Math.pow(ve,2)),ke=Math.acos(we/be),Ne=De=>{const je=P.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];De&&je.push("ALPHA_PASS");const Ge=u.getOrCreateProgram("globeAtmosphere",{defines:je}),et=((tt,ct,st,rt,xt,Ft,Zt,kt,hn,bt,Wt,Vt)=>({u_frustum_tl:tt,u_frustum_tr:ct,u_frustum_br:st,u_frustum_bl:rt,u_horizon:xt,u_transition:Ft,u_fadeout_range:Zt,u_color:kt,u_high_color:hn,u_space_color:bt,u_temporal_offset:Wt,u_horizon_angle:Vt}))(P.frustumCorners.TL,P.frustumCorners.TR,P.frustumCorners.BR,P.frustumCorners.BL,P.frustumCorners.horizon,W,ue,J,Q,oe,_e,ke);u.uploadCommonUniforms(w,Ge);const Ke=this.atmosphereBuffer;Ke&&Ge.draw(u,E.TRIANGLES,F,pr.disabled,De?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,_r.backCW,et,De?"atmosphere_glow_alpha":"atmosphere_glow",Ke.vertexBuffer,Ke.indexBuffer,Ke.segments)};Ne(!1),Ne(!0)}drawStars(u,p){const w=o.ap(p.properties.get("star-intensity"),0,1);if(w===0)return;const E=u.context,P=E.gl,F=u.transform,W=u.getOrCreateProgram("stars"),$=o.a6.quat.identity([]);o.a6.quat.rotateX($,$,-F._pitch),o.a6.quat.rotateZ($,$,-F.angle),o.a6.quat.rotateX($,$,o.bB(F._center.lat)),o.a6.quat.rotateY($,$,-o.bB(F._center.lng));const J=o.a6.mat4.fromQuat(new Float32Array(16),$),Q=o.a6.mat4.multiply([],F.starsProjMatrix,J),oe=o.a6.mat3.fromMat4([],J),le=o.a6.mat3.invert([],oe),ue=[0,1,0];o.a6.vec3.transformMat3(ue,ue,le),o.a6.vec3.scale(ue,ue,this.params.sizeMultiplier);const ve=[1,0,0];o.a6.vec3.transformMat3(ve,ve,le),o.a6.vec3.scale(ve,ve,this.params.sizeMultiplier);const _e=(be=ue,we=ve,ke=w,{u_matrix:Float32Array.from(Q),u_up:be,u_right:we,u_intensity_multiplier:ke});var be,we,ke;u.uploadCommonUniforms(E,W),this.starsVx&&this.starsIdx&&W.draw(u,P.TRIANGLES,$n.disabled,pr.disabled,this.colorModeAlphaBlendedWriteRGB,_r.disabled,_e,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Cd(b,u){const p=[...b],w=u.cameraWorldSizeForFog/u.worldSize,E=o.a6.mat4.identity([]);return o.a6.mat4.scale(E,E,[w,w,1]),o.a6.mat4.multiply(p,E,p),o.a6.mat4.multiply(p,u.worldToFogMatrix,p),p}function Ku(b,u,p,w,E){const P=p.material,F=w.context,{baseColorTexture:W,metallicRoughnessTexture:$}=P.pbrMetallicRoughness,{normalTexture:J,occlusionTexture:Q,emissionTexture:oe}=P;function le(ue,ve,_e){if(ue&&(b.push(ve),F.activeTexture.set(F.gl.TEXTURE0+_e),ue.gfxTexture)){const{minFilter:be,magFilter:we,wrapS:ke,wrapT:Ne}=ue.sampler;ue.gfxTexture.bindExtraParam(be,we,ke,Ne)}}le(W,"HAS_TEXTURE_u_baseColorTexture",oo.BaseColor),le($,"HAS_TEXTURE_u_metallicRoughnessTexture",oo.MetallicRoughness),le(J,"HAS_TEXTURE_u_normalTexture",oo.Normal),le(Q,"HAS_TEXTURE_u_occlusionTexture",oo.Occlusion),le(oe,"HAS_TEXTURE_u_emissionTexture",oo.Emission),E&&(E.texture||(E.texture=new o.df(w.context,E.image,[E.image.height,E.image.height,E.image.height],F.gl.RGBA8)),F.activeTexture.set(F.gl.TEXTURE0+oo.LUT),E.texture&&E.texture.bind(F.gl.LINEAR,F.gl.CLAMP_TO_EDGE),b.push("APPLY_LUT_ON_GPU")),p.texcoordBuffer&&(b.push("HAS_ATTRIBUTE_a_uv_2f"),u.push(p.texcoordBuffer)),p.colorBuffer&&(b.push(p.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),u.push(p.colorBuffer)),p.normalBuffer&&(b.push("HAS_ATTRIBUTE_a_normal_3f"),u.push(p.normalBuffer)),p.pbrBuffer&&(b.push("HAS_ATTRIBUTE_a_pbr"),b.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),u.push(p.pbrBuffer)),P.alphaMode!=="OPAQUE"&&P.alphaMode!=="MASK"||b.push("UNPREMULT_TEXTURE_IN_SHADER"),P.defined||b.push("DIFFUSE_SHADED"),b.push("USE_STANDARD_DERIVATIVES")}function Zo(b,u,p,w,E,P){const F=p.paint.get("model-opacity"),W=u.context,$=new $n(u.context.gl.LEQUAL,$n.ReadWrite,u.depthRangeFor3D),J=u.transform,Q=b.mesh,oe=Q.material,le=oe.pbrMetallicRoughness,ue=u.style.fog;let ve;ve=u.transform.projection.zAxisUnit==="pixels"?[...b.nodeModelMatrix]:o.a6.mat4.multiply([],w.zScaleMatrix,b.nodeModelMatrix),o.a6.mat4.multiply(ve,w.negCameraPosMatrix,ve);const _e=o.a6.mat4.invert([],ve);o.a6.mat4.transpose(_e,_e);const be=p.paint.get("model-emissive-strength").constantOr(0),we=Fn(new Float32Array(b.worldViewProjection),new Float32Array(ve),new Float32Array(_e),null,u,F,le.baseColorFactor.toRenderColor(null),oe.emissiveFactor,le.metallicFactor,le.roughnessFactor,oe,be,p),ke={defines:[]},Ne=[];Ku(ke.defines,Ne,Q,u,p.lut);const De=u.shadowRenderer;De&&(De.useNormalOffset=!1);let je=null;if(ue){const Ke=Cd(b.nodeModelMatrix,u.transform);if(je=new Float32Array(Ke),J.projection.name!=="globe"){const tt=Q.aabb.min,ct=Q.aabb.max,[st,rt]=ue.getOpacityForBounds(Ke,tt[0],tt[1],ct[0],ct[1]);ke.overrideFog=st>=Mn||rt>=Mn}}const Ge=tc(u,p.paint.get("model-cutoff-fade-range"));Ge.shouldRenderCutoff&&ke.defines.push("RENDER_CUTOFF");const et=u.getOrCreateProgram("model",ke);u.uploadCommonUniforms(W,et,null,je,Ge),u.renderPass!=="shadow"&&De&&De.setupShadowsFromMatrix(b.nodeModelMatrix,et),et.draw(u,W.gl.TRIANGLES,$,E,P,Q.material.doubleSided?_r.disabled:_r.backCCW,we,p.id,Q.vertexBuffer,Q.indexBuffer,Q.segments,p.paint,u.transform.zoom,void 0,Ne)}function cf(b,u,p,w,E,P,F){let W;W=b.projection.name==="globe"?o.dg(p,b):[...p],o.a6.mat4.multiply(W,W,u.matrix);const $=o.a6.mat4.multiply([],w,W);if(u.meshes)for(const J of u.meshes){if(J.material.alphaMode!=="BLEND"){F.push({mesh:J,depth:0,modelIndex:E,worldViewProjection:$,nodeModelMatrix:W});continue}const Q=o.a6.vec3.transformMat4([],J.centroid,$);Q[2]>0&&P.push({mesh:J,depth:Q[2],modelIndex:E,worldViewProjection:$,nodeModelMatrix:W})}if(u.children)for(const J of u.children)cf(b,J,p,w,E,P,F)}function Ju(b,u,p,w){const E=p.shadowRenderer;if(!E)return;const P=E.getShadowPassDepthMode(),F=E.getShadowPassColorMode(),W=E.calculateShadowPassMatrixFromMatrix(u),$=sr(W);p.getOrCreateProgram("modelDepth",{defines:p._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(p,p.context.gl.TRIANGLES,P,pr.disabled,F,_r.backCCW,$,w.id,b.vertexBuffer,b.indexBuffer,b.segments,w.paint,p.transform.zoom,void 0,void 0)}function uf(b,u,p){const w=u.updateZoomBasedPaintProperties(),E=function(P,F,W){let $,J,Q,oe=P.terrain?P.terrain.exaggeration():0;if(P.terrain&&oe>0){const le=P.terrain,ue=le.findDEMTileFor(W);ue&&ue.dem?$=o.di.create(le,W,ue):oe=0}if(oe===0&&(F.terrainElevationMin=0,F.terrainElevationMax=0),oe===F.validForExaggeration&&(oe===0||$&&$._demTile&&$._demTile.tileID===F.validForDEMTile.id&&$._dem._timestamp===F.validForDEMTile.timestamp))return!1;for(const le in F.instancesPerModel){const ue=F.instancesPerModel[le];for(let ve=0;ve<ue.instancedDataArray.length;++ve){const _e=($?oe*$.getElevationAt(0|ue.instancedDataArray.float32[16*ve],0|ue.instancedDataArray.float32[16*ve+1],!0,!0):0)+ue.instancesEvaluatedElevation[ve];ue.instancedDataArray.float32[16*ve+6]=_e,J=J?Math.min(F.terrainElevationMin,_e):_e,Q=Q?Math.max(F.terrainElevationMax,_e):_e}}return F.terrainElevationMin=J||0,F.terrainElevationMax=Q||0,F.validForExaggeration=oe,F.validForDEMTile=$&&$._demTile?{id:$._demTile.tileID,timestamp:$._dem._timestamp}:{id:void 0,timestamp:0},!0}(b,u,p);(w||E)&&(u.uploaded=!1,u.upload(b.context))}const Ka={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new o.c9([0,0,0],[o.ab,o.ab,0])};function e_(b,u){const p=1<<b.canonical.z,w=u.getFreeCameraOptions().position,E=u.elevation,P=b.canonical.x/p,F=(b.canonical.x+1)/p,W=b.canonical.y/p,$=(b.canonical.y+1)/p;let J=u._centerAltitude;if(E){const ue=E.getMinMaxForTile(b);ue&&ue.max>J&&(J=ue.max)}const Q=o.ap(w.x,P,F)-w.x,oe=o.ap(w.y,W,$)-w.y,le=o.bD(J,u.center.lat)-w.z;return u._zoomFromMercatorZ(Math.sqrt(Q*Q+oe*oe+le*le))}function Gs(b,u,p,w,E,P,F){const W=b.context,$=b.renderPass==="shadow",J=b.shadowRenderer,Q=$&&J?J.getShadowPassDepthMode():new $n(W.gl.LEQUAL,$n.ReadWrite,b.depthRangeFor3D),oe=b.isTileAffectedByFog(P);if(p.meshes)for(const le of p.meshes){const ue=["MODEL_POSITION_ON_GPU"],ve=[];let _e,be,we;w.instancedDataArray.length>20&&ue.push("INSTANCED_ARRAYS");const ke=tc(b,u.paint.get("model-cutoff-fade-range"));if(ke.shouldRenderCutoff&&ue.push("RENDER_CUTOFF"),$&&J)_e=b.getOrCreateProgram("modelDepth",{defines:ue}),be=sr(F.shadowTileMatrix,F.shadowTileMatrix,Float32Array.from(p.matrix)),we=J.getShadowPassColorMode();else{Ku(ue,ve,le,b,u.lut),_e=b.getOrCreateProgram("model",{defines:ue,overrideFog:oe});const De=le.material,je=De.pbrMetallicRoughness,Ge=u.paint.get("model-opacity"),et=u.paint.get("model-emissive-strength").constantOr(0);be=Fn(P.expandedProjMatrix,Float32Array.from(p.matrix),new Float32Array(16),null,b,Ge,je.baseColorFactor.toRenderColor(null),De.emissiveFactor,je.metallicFactor,je.roughnessFactor,De,et,u,E),J&&(F.shadowUniformsInitialized?_e.setShadowUniformValues(W,J.getShadowUniformValues()):(J.setupShadows(P.toUnwrapped(),_e,"model-tile",P.overscaledZ),F.shadowUniformsInitialized=!0)),we=ke.shouldRenderCutoff||Ge<1||De.alphaMode!=="OPAQUE"?Mr.alphaBlended:Mr.unblended}b.uploadCommonUniforms(W,_e,P.toUnwrapped(),null,ke);const Ne=le.material.doubleSided?_r.disabled:_r.backCCW;if(w.instancedDataArray.length>20)ve.push(w.instancedDataBuffer),_e.draw(b,W.gl.TRIANGLES,Q,pr.disabled,we,Ne,be,u.id,le.vertexBuffer,le.indexBuffer,le.segments,u.paint,b.transform.zoom,void 0,ve,w.instancedDataArray.length);else{const De=$?"u_instance":"u_normal_matrix";for(let je=0;je<w.instancedDataArray.length;++je)be[De]=new Float32Array(w.instancedDataArray.arrayBuffer,64*je,16),_e.draw(b,W.gl.TRIANGLES,Q,pr.disabled,we,Ne,be,u.id,le.vertexBuffer,le.indexBuffer,le.segments,u.paint,b.transform.zoom,void 0,ve)}}if(p.children)for(const le of p.children)Gs(b,u,le,w,E,P,F)}const kg=[1,-1,1];function El(b,u,p,w){if(!p.modelManager)return!0;const E=p.modelManager;if(!p.shadowRenderer)return!0;const P=p.shadowRenderer,F=u.aabb;let W=!0,$=b.maxHeight;if($===0){let Q=0;for(const oe in b.instancesPerModel){const le=E.getModel(oe,w);le?Q=Math.max(Q,Math.max(Math.max(le.aabb.max[0],le.aabb.max[1]),le.aabb.max[2])):W=!1}$=b.maxScale*Q*1.41+b.maxVerticalOffset,W&&(b.maxHeight=$)}F.max[2]=$,F.min[2]+=b.terrainElevationMin,F.max[2]+=b.terrainElevationMax,o.a6.vec3.transformMat4(F.min,F.min,u.tileMatrix),o.a6.vec3.transformMat4(F.max,F.max,u.tileMatrix);const J=F.intersects(P.getCurrentCascadeFrustum());return p.currentShadowCascade===0&&(b.isInsideFirstShadowMapFrustum=J===2),J===0}function ki(b,u){const p=b.uniformValues.u_cutoff_params[0],w=b.uniformValues.u_cutoff_params[1],E=b.uniformValues.u_cutoff_params[2],P=b.uniformValues.u_cutoff_params[3];return w===p||P===E?1:o.ap(((u-p)/(w-p)-E)/(P-E),0,1)}function Qr(b,u,p,w){if(u.pitch<20)return 1;const E=u.getWorldToCameraMatrix();o.a6.mat4.multiply(E,E,b);const P=o.a6.vec4.fromValues(p.min[0],p.min[1],p.min[2],1);let F=o.a6.vec4.transformMat4(o.a6.vec4.create(),P,E),W=F,$=F;P[1]=p.max[1],F=o.a6.vec4.transformMat4(o.a6.vec4.create(),P,E),W=F[1]<W[1]?F:W,$=F[1]>$[1]?F:$,P[0]=p.max[0],F=o.a6.vec4.transformMat4(o.a6.vec4.create(),P,E),W=F[1]<W[1]?F:W,$=F[1]>$[1]?F:$,P[1]=p.min[1],F=o.a6.vec4.transformMat4(o.a6.vec4.create(),P,E),W=F[1]<W[1]?F:W,$=F[1]>$[1]?F:$;const J=o.ap(w[0],0,1),Q=100*u.pixelsPerMeter*o.ap(w[1],0,1),oe=o.ap(w[2],0,1),le=o.a6.vec4.lerp(o.a6.vec4.create(),W,$,J),ue=Math.tan(.5*u.fovX),ve=-le[2]*ue;if(Q===0)return le[1]<-Math.abs(ve)?oe:1;const _e=(-Math.abs(ve)-le[1])/Q,be=(ke,Ne,De)=>(1-De)*ke+De*Ne,we=o.ap(be(1,oe,_e),oe,1);return be(1,we,o.ap((u.pitch-20)/20,0,1))}class Og{}class lc{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(u,p,w){{const oe=this._storage.get(p.id);if(oe)return oe.lastUsedFrameIdx=u,oe.buf}const E=w.gl,P=E.getBufferParameter(E.ELEMENT_ARRAY_BUFFER,E.BUFFER_SIZE),F=new ArrayBuffer(P),W=new Int16Array(F);E.getBufferSubData(E.ELEMENT_ARRAY_BUFFER,0,new Int16Array(F));const $=new o.dk;for(let oe=0;oe<P/2;oe+=3){const le=W[oe],ue=W[oe+1],ve=W[oe+2];$.emplaceBack(le,ue),$.emplaceBack(ue,ve),$.emplaceBack(ve,le)}const J=w.bindVertexArrayOES.current,Q=new Og;return Q.buf=new _a(w,$),Q.lastUsedFrameIdx=u,this._storage.set(p.id,Q),w.bindVertexArrayOES.set(J),Q.buf}update(u){for(const[p,w]of this._storage)u-w.lastUsedFrameIdx>30&&(w.buf.destroy(),this._storage.delete(p))}destroy(){for(const[u,p]of this._storage)p.buf.destroy(),this._storage.delete(u)}}class hf{constructor(u){this.occluderSize=30,this.depthOffset=-1e-4,u.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),u.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Ks={symbol:function(b,u,p,w,E){if(b.renderPass!=="translucent")return;const P=pr.disabled,F=b.colorModeForRenderPass();p.layout.get("text-variable-anchor")&&function(J,Q,oe,le,ue,ve,_e){const be=Q.transform,we=ue==="map",ke=ve==="map";for(const Ne of J){const De=le.getTile(Ne),je=De.getBucket(oe);if(!je||!je.text||!je.text.segments.get().length)continue;const Ge=o.bj(je.textSizeData,be.zoom),et=kc(Ne,je.getProjection(),be),Ke=be.calculatePixelsToTileUnitsMatrix(De),tt=ei(et,De.tileID.canonical,ke,we,be,je.getProjection(),Ke),ct=je.hasIconTextFit()&&je.hasIconData();if(Ge){const st=Math.pow(2,be.zoom-De.tileID.overscaledZ);Rx(je,we,ke,_e,o.cS,be,tt,Ne,st,Ge,ct)}}}(w,b,p,u,p.layout.get("text-rotation-alignment"),p.layout.get("text-pitch-alignment"),E);const W=p.paint.get("icon-opacity").constantOr(1)!==0,$=p.paint.get("text-opacity").constantOr(1)!==0;p.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(W||$)?Sd(b,u,p,w,P,F):(W&&Sd(b,u,p,w,P,F,{onlyIcons:!0}),$&&Sd(b,u,p,w,P,F,{onlyText:!0})),u.map.showCollisionBoxes&&(qp(b,u,p,w,p.paint.get("text-translate"),p.paint.get("text-translate-anchor"),!0),qp(b,u,p,w,p.paint.get("icon-translate"),p.paint.get("icon-translate-anchor"),!1))},circle:function(b,u,p,w){if(b.renderPass!=="translucent")return;const E=p.paint.get("circle-opacity"),P=p.paint.get("circle-stroke-width"),F=p.paint.get("circle-stroke-opacity"),W=p.layout.get("circle-sort-key").constantOr(1)!==void 0,$=p.paint.get("circle-emissive-strength");if(E.constantOr(1)===0&&(P.constantOr(1)===0||F.constantOr(1)===0))return;const J=b.context,Q=J.gl,oe=b.transform,le=b.depthModeForSublayer(0,$n.ReadOnly),ue=pr.disabled,ve=b.colorModeForDrapableLayerRenderPass($),_e=oe.projection.name==="globe",be=[o.am(oe.center.lng),o.at(oe.center.lat)],we=[];for(let Ne=0;Ne<w.length;Ne++){const De=w[Ne],je=u.getTile(De),Ge=je.getBucket(p);if(!Ge||Ge.projection.name!==oe.projection.name)continue;const et=Ge.programConfigurations.get(p.id),Ke=o.cT(p),tt=b.isTileAffectedByFog(De);_e&&Ke.push("PROJECTION_GLOBE_VIEW"),Ke.push("DEPTH_D24"),b.terrain&&oe.depthOcclusionForSymbolsAndCircles&&Ke.push("DEPTH_OCCLUSION");const ct=b.getOrCreateProgram("circle",{config:et,defines:Ke,overrideFog:tt}),st=Ge.layoutVertexBuffer,rt=Ge.globeExtVertexBuffer,xt=Ge.indexBuffer,Ft=oe.projection.createInversionMatrix(oe,De.canonical),Zt={programConfiguration:et,program:ct,layoutVertexBuffer:st,globeExtVertexBuffer:rt,indexBuffer:xt,uniformValues:o.cU(b,De,je,Ft,be,p),tile:je};if(W){const kt=Ge.segments.get();for(const hn of kt)we.push({segments:new o.b1([hn]),sortKey:hn.sortKey,state:Zt})}else we.push({segments:Ge.segments,sortKey:0,state:Zt})}W&&we.sort((Ne,De)=>Ne.sortKey-De.sortKey);const ke={useDepthForOcclusion:oe.depthOcclusionForSymbolsAndCircles};for(const Ne of we){const{programConfiguration:De,program:je,layoutVertexBuffer:Ge,globeExtVertexBuffer:et,indexBuffer:Ke,uniformValues:tt,tile:ct}=Ne.state,st=Ne.segments;b.terrain&&b.terrain.setupElevationDraw(ct,je,ke),b.uploadCommonUniforms(J,je,ct.tileID.toUnwrapped()),je.draw(b,Q.TRIANGLES,le,ue,ve,_r.disabled,tt,p.id,Ge,Ke,st,p.paint,oe.zoom,De,[et])}},heatmap:function(b,u,p,w){if(p.paint.get("heatmap-opacity")!==0)if(b.renderPass==="offscreen"){const E=b.context,P=E.gl,F=pr.disabled,W=new Mr([P.ONE,P.ONE,P.ONE,P.ONE],o.bz.transparent,[!0,!0,!0,!0]);(function(ue,ve,_e,be){const we=ue.gl,ke=ve.width*be,Ne=ve.height*be;ue.activeTexture.set(we.TEXTURE1),ue.viewport.set([0,0,ke,Ne]);let De=_e.heatmapFbo;if(!De||De&&(De.width!==ke||De.height!==Ne)){De&&De.destroy();const je=we.createTexture();we.bindTexture(we.TEXTURE_2D,je),we.texParameteri(we.TEXTURE_2D,we.TEXTURE_WRAP_S,we.CLAMP_TO_EDGE),we.texParameteri(we.TEXTURE_2D,we.TEXTURE_WRAP_T,we.CLAMP_TO_EDGE),we.texParameteri(we.TEXTURE_2D,we.TEXTURE_MIN_FILTER,we.LINEAR),we.texParameteri(we.TEXTURE_2D,we.TEXTURE_MAG_FILTER,we.LINEAR),De=_e.heatmapFbo=ue.createFramebuffer(ke,Ne,!0,null),function(Ge,et,Ke,tt,ct,st){const rt=Ge.gl;rt.texImage2D(rt.TEXTURE_2D,0,Ge.extRenderToTextureHalfFloat?rt.RGBA16F:rt.RGBA,ct,st,0,rt.RGBA,Ge.extRenderToTextureHalfFloat?rt.HALF_FLOAT:rt.UNSIGNED_BYTE,null),tt.colorAttachment.set(Ke)}(ue,0,je,De,ke,Ne)}else we.bindTexture(we.TEXTURE_2D,De.colorAttachment.get()),ue.bindFramebuffer.set(De.framebuffer)})(E,b,p,b.transform.projection.name==="globe"?.5:.25),E.clear({color:o.bz.transparent});const $=b.transform,J=$.projection.name==="globe",Q=J?["PROJECTION_GLOBE_VIEW"]:[],oe=J?_r.frontCCW:_r.disabled,le=[o.am($.center.lng),o.at($.center.lat)];for(let ue=0;ue<w.length;ue++){const ve=w[ue];if(u.hasRenderableParent(ve))continue;const _e=u.getTile(ve),be=_e.getBucket(p);if(!be||be.projection.name!==$.projection.name)continue;const we=b.isTileAffectedByFog(ve),ke=be.programConfigurations.get(p.id),Ne=b.getOrCreateProgram("heatmap",{config:ke,defines:Q,overrideFog:we}),{zoom:De}=b.transform;b.terrain&&b.terrain.setupElevationDraw(_e,Ne),b.uploadCommonUniforms(E,Ne,ve.toUnwrapped());const je=$.projection.createInversionMatrix($,ve.canonical);Ne.draw(b,P.TRIANGLES,$n.disabled,F,W,oe,Ig(b,ve,_e,je,le,De,p.paint.get("heatmap-intensity")),p.id,be.layoutVertexBuffer,be.indexBuffer,be.segments,p.paint,b.transform.zoom,ke,J?[be.globeExtVertexBuffer]:null)}E.viewport.set([0,0,b.width,b.height])}else b.renderPass==="translucent"&&(b.context.setColorMode(b.colorModeForRenderPass()),function(E,P){const F=E.context,W=F.gl,$=P.heatmapFbo;if(!$)return;F.activeTexture.set(W.TEXTURE0),W.bindTexture(W.TEXTURE_2D,$.colorAttachment.get()),F.activeTexture.set(W.TEXTURE1);let J=P.colorRampTexture;J||(J=P.colorRampTexture=new o.T(F,P.colorRamp,W.RGBA8)),J.bind(W.LINEAR,W.CLAMP_TO_EDGE),E.getOrCreateProgram("heatmapTexture").draw(E,W.TRIANGLES,$n.disabled,pr.disabled,E.colorModeForRenderPass(),_r.disabled,((Q,oe,le,ue)=>({u_image:0,u_color_ramp:1,u_opacity:oe.paint.get("heatmap-opacity")}))(0,P),P.id,E.viewportBuffer,E.quadTriangleIndexBuffer,E.viewportSegments,P.paint,E.transform.zoom)}(b,p))},line:function(b,u,p,w){if(b.renderPass!=="translucent")return;const E=p.paint.get("line-opacity"),P=p.paint.get("line-width");if(E.constantOr(1)===0||P.constantOr(1)===0)return;const F=p.paint.get("line-emissive-strength"),W=p.paint.get("line-occlusion-opacity"),$=b.context,J=$.gl,Q=p.layout.get("line-z-offset"),oe=!Q.isConstant()||!!Q.constantOr(0),le=oe?new $n(b.depthOcclusion?J.GREATER:J.LEQUAL,$n.ReadOnly,b.depthRangeFor3D):b.depthModeForSublayer(0,$n.ReadOnly),ue=b.colorModeForDrapableLayerRenderPass(F),ve=b.terrain&&b.terrain.renderingToTexture,_e=ve?1:o.q.devicePixelRatio,be=p.paint.get("line-dasharray"),we=be.constantOr(1),ke=p.layout.get("line-cap"),Ne=be.constantOr(null),De=ke.constantOr(null),je=p.paint.get("line-pattern"),Ge=je.constantOr(1),et=je.constantOr(null),Ke=p.paint.get("line-opacity").constantOr(1);let tt=!Ge&&Ke!==1||b.depthOcclusion&&W>0&&W<1;const ct=p.paint.get("line-gradient"),st=Ge?"linePattern":"line",rt=o.cV(p);let xt;if(ve&&b.terrain&&b.terrain.clipOrMaskOverlapStencilType()&&(tt=!1),W!==0&&b.depthOcclusion){const Zt=p.paint._values["line-opacity"];Zt&&Zt.value&&Zt.value.kind==="constant"?xt=Zt.value:o.w(`Occlusion opacity for layer ${p.id} is supported only when line-opacity isn't data-driven.`)}if(oe&&(b.forceTerrainMode=!0),!oe&&W!==0&&b.terrain&&!ve)return void o.w(`Occlusion opacity for layer ${p.id} is supported on terrain only if the layer has non-zero line-z-offset.`);const Ft=tt&&oe?b.stencilModeFor3D():pr.disabled;for(const Zt of w){const kt=u.getTile(Zt);if(Ge&&!kt.patternsLoaded())continue;const hn=kt.getBucket(p);if(!hn)continue;b.prepareDrawTile();const bt=hn.programConfigurations.get(p.id),Wt=b.isTileAffectedByFog(Zt),Vt=b.getOrCreateProgram(st,{config:bt,defines:oe?[...rt,"ELEVATED"]:rt,overrideFog:Wt});if(et&&kt.imageAtlas){const xn=kt.imageAtlas.patternPositions[et.toString()];xn&&bt.setConstantPatternPositions(xn)}if(!Ge&&Ne&&De&&kt.lineAtlas){const xn=kt.lineAtlas.getDash(Ne,De);xn&&bt.setConstantPatternPositions(xn)}let[fn,pn]=p.paint.get("line-trim-offset");(De==="round"||De==="square")&&fn!==pn&&(fn===0&&(fn-=1),pn===1&&(pn+=1));const qt=ve?Zt.projMatrix:null,en=Ge?o.cW(b,kt,p,qt,_e,[fn,pn]):o.cX(b,kt,p,qt,hn.lineClipsArray.length,_e,[fn,pn]);if(ct){const xn=hn.gradients[p.id];let Dn=xn.texture;if(p.gradientVersion!==xn.version){let yr=256;if(p.stepInterpolant){const qn=u.getSource().maxzoom,ur=Zt.canonical.z===qn?Math.ceil(1<<b.transform.maxZoom-Zt.canonical.z):1;yr=o.ap(o.cY(hn.maxLineLength/o.ab*1024*ur),256,$.maxTextureSize)}xn.gradient=o.cZ({expression:p.gradientExpression(),evaluationKey:"lineProgress",resolution:yr,image:xn.gradient||void 0,clips:hn.lineClipsArray}),xn.texture?xn.texture.update(xn.gradient):xn.texture=new o.T($,xn.gradient,J.RGBA8),xn.version=p.gradientVersion,Dn=xn.texture}$.activeTexture.set(J.TEXTURE1),Dn.bind(p.stepInterpolant?J.NEAREST:J.LINEAR,J.CLAMP_TO_EDGE)}we&&($.activeTexture.set(J.TEXTURE0),kt.lineAtlasTexture&&kt.lineAtlasTexture.bind(J.LINEAR,J.REPEAT),bt.updatePaintBuffers()),Ge&&($.activeTexture.set(J.TEXTURE0),kt.imageAtlasTexture&&kt.imageAtlasTexture.bind(J.LINEAR,J.CLAMP_TO_EDGE),bt.updatePaintBuffers()),oe&&b.terrain.setupElevationDraw(kt,Vt),b.uploadCommonUniforms($,Vt,Zt.toUnwrapped());const er=xn=>{xt!=null&&(xt.value=Ke*W),Vt.draw(b,J.TRIANGLES,le,xn,ue,_r.disabled,en,p.id,hn.layoutVertexBuffer,hn.indexBuffer,hn.segments,p.paint,b.transform.zoom,bt,[hn.layoutVertexBuffer2,hn.patternVertexBuffer,hn.zOffsetVertexBuffer]),xt!=null&&(xt.value=Ke)};if(tt&&!oe){const xn=b.stencilModeForClipping(Zt).ref;xn===0&&ve&&$.clear({stencil:0});const Dn={func:J.EQUAL,mask:255};en.u_alpha_discard_threshold=.8,er(new pr(Dn,xn,255,J.KEEP,J.KEEP,J.INVERT)),en.u_alpha_discard_threshold=0,er(new pr(Dn,xn,255,J.KEEP,J.KEEP,J.KEEP))}else tt&&oe&&(en.u_alpha_discard_threshold=.001),er(oe?Ft:b.stencilModeForClipping(Zt))}tt&&(b.resetStencilClippingMasks(),ve&&$.clear({stencil:0})),W===0||b.depthOcclusion||ve||b.layersWithOcclusionOpacity.push(b.currentLayer),oe&&(b.forceTerrainMode=!1)},fill:function(b,u,p,w){const E=p.paint.get("fill-color"),P=p.paint.get("fill-opacity"),F=p.is3D(),W=new $n(b.context.gl.LEQUAL,$n.ReadWrite,b.depthRangeFor3D);if(P.constantOr(1)===0)return;const $=p.paint.get("fill-emissive-strength"),J=b.colorModeForDrapableLayerRenderPass($),Q=p.paint.get("fill-pattern"),oe=b.opaquePassEnabledForLayer()&&!Q.constantOr(1)&&E.constantOr(o.bz.transparent).a===1&&P.constantOr(0)===1?"opaque":"translucent";if(b.renderPass===oe){const le=F?W:b.depthModeForSublayer(1,b.renderPass==="opaque"?$n.ReadWrite:$n.ReadOnly);Ad(b,u,p,w,le,J,!1)}if(!F&&b.renderPass==="translucent"&&p.paint.get("fill-antialias")){const le=F?W:b.depthModeForSublayer(p.getPaintProperty("fill-outline-color")?2:0,$n.ReadOnly);Ad(b,u,p,w,le,J,!0)}},"fill-extrusion":function(b,u,p,w){const E=p.paint.get("fill-extrusion-opacity"),P=b.context,F=P.gl,W=b.terrain,$=W&&W.renderingToTexture;if(E===0)return;const J=b.conflationActive&&b.style.isLayerClipped(p,u.getSource()),Q=b.style.order.indexOf(p.fqid);if(J&&function(oe,le,ue,ve,_e){for(const be of ve){const we=le.getTile(be).getBucket(ue);we&&(we.updateReplacement(be,oe.replacementSource,_e),we.uploadCentroid(oe.context))}}(b,u,p,w,Q),W||J)for(const oe of w){const le=u.getTile(oe).getBucket(p);le&&sc(b.context,u,oe,le,p,W,J)}if(b.renderPass==="shadow"&&b.shadowRenderer){const oe=b.shadowRenderer;if(W&&E<.65&&p._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof o.a4)return;const le=oe.getShadowPassDepthMode(),ue=oe.getShadowPassColorMode();sf(b,u,p,w,le,pr.disabled,ue,J)}else if(b.renderPass==="translucent"){const oe=!p.paint.get("fill-extrusion-pattern").constantOr(1),le=p.paint.get("fill-extrusion-color").constantOr(o.bz.white);if(!$&&le.a!==0){const ue=new $n(b.context.gl.LEQUAL,$n.ReadWrite,b.depthRangeFor3D);E===1&&oe?sf(b,u,p,w,ue,pr.disabled,Mr.unblended,J):(sf(b,u,p,w,ue,pr.disabled,Mr.disabled,J),sf(b,u,p,w,ue,b.stencilModeFor3D(),b.colorModeForRenderPass(),J),b.resetStencilClippingMasks())}if(b.style.enable3dLights()&&oe&&(!W&&b.transform.projection.name!=="globe"||$)){const ue=p.paint.get("fill-extrusion-opacity"),ve=p.paint.get("fill-extrusion-ambient-occlusion-intensity"),_e=p.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),be=p.paint.get("fill-extrusion-flood-light-intensity"),we=p.paint.get("fill-extrusion-flood-light-color").toRenderColor(p.lut).toArray01().slice(0,3),ke=ve>0&&_e>0,Ne=be>0,De=(Ge,et,Ke)=>(1-Ke)*Ge+Ke*et,je=Ge=>{const et=b.depthModeForSublayer(1,$n.ReadOnly,F.LEQUAL,!0),Ke=p.paint.get(Ge?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),tt=De(.1,3,Ke),ct=b._showOverdrawInspector;if(!ct){const st=new pr({func:F.ALWAYS,mask:255},255,255,F.KEEP,F.KEEP,F.REPLACE),rt=new Mr([F.ONE,F.ONE,F.ONE,F.ONE],o.bz.transparent,[!1,!1,!1,!0],F.MIN);ao(b,u,p,w,et,st,rt,_r.disabled,Ge,"sdf",ue,ve,_e,be,we,tt,J,!1)}{const st=ct?pr.disabled:new pr({func:F.EQUAL,mask:255},255,255,F.KEEP,F.DECR,F.DECR),rt=ct?b.colorModeForRenderPass():new Mr([F.ONE_MINUS_DST_ALPHA,F.DST_ALPHA,F.ONE,F.ONE],o.bz.transparent,[!0,!0,!0,!0]);ao(b,u,p,w,et,st,rt,_r.disabled,Ge,"color",ue,ve,_e,be,we,tt,J,!1)}};if($){const Ge=(et,Ke,tt)=>{const ct=b.depthModeForSublayer(1,$n.ReadOnly,F.LEQUAL,!1),st=p.paint.get(et?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),rt=De(.1,3,st);{const xt=new Mr([F.ONE,F.ONE,F.ONE,F.ONE],o.bz.transparent,[!1,!1,!1,!0]);ao(b,u,p,w,ct,pr.disabled,xt,_r.disabled,et,"clear",ue,ve,_e,be,we,rt,J,Ke)}{const xt=new pr({func:F.ALWAYS,mask:255},255,255,F.KEEP,F.KEEP,F.REPLACE),Ft=new Mr([F.ONE,F.ONE,F.ONE,F.ONE],o.bz.transparent,[!1,!1,!1,!0],F.MIN);ao(b,u,p,w,ct,xt,Ft,_r.disabled,et,"sdf",ue,ve,_e,be,we,rt,J,Ke)}{const xt=et?F.ZERO:F.ONE_MINUS_DST_ALPHA,Ft=new pr({func:F.EQUAL,mask:255},255,255,F.KEEP,F.DECR,F.DECR),Zt=new Mr([xt,F.DST_ALPHA,F.ONE_MINUS_DST_ALPHA,F.ZERO],o.bz.transparent,[!0,!0,!0,!0]);ao(b,u,p,w,ct,Ft,Zt,_r.disabled,et,"color",ue,ve,_e,be,we,rt,J,Ke)}{const xt=new Mr([F.ONE,F.ONE,F.ONE,et?F.ZERO:F.ONE],o.bz.transparent,[!1,!1,!1,!0],et?F.FUNC_ADD:F.MAX);ao(b,u,p,w,ct,pr.disabled,xt,_r.disabled,et,"clear",ue,ve,_e,be,we,rt,J,Ke,tt)}};if(ke||Ne){let et;if(b.prepareDrawTile(),W){const Ke=W.drapeBufferSize[0],tt=W.drapeBufferSize[1];et=W.framebufferCopyTexture,et&&(!et||et.size[0]===Ke&&et.size[1]===tt)||(et&&et.destroy(),et=W.framebufferCopyTexture=new o.T(P,new o.r({width:Ke,height:tt}),F.RGBA8)),et.bind(F.LINEAR,F.CLAMP_TO_EDGE),F.copyTexImage2D(F.TEXTURE_2D,0,F.RGBA,0,0,Ke,tt,0)}ke&&Ge(!0,!1,et),Ne&&Ge(!1,!0,et)}}else ke&&je(!0),Ne&&je(!1),(ke||Ne)&&b.resetStencilClippingMasks()}}},hillshade:function(b,u,p,w){if(b.renderPass!=="offscreen"&&b.renderPass!=="translucent"||b.style.disableElevatedTerrain)return;const E=b.context,P=b.terrain&&b.terrain.renderingToTexture,[F,W]=b.renderPass!=="translucent"||P?[{},w]:b.stencilConfigForOverlap(w);for(const $ of W){const J=u.getTile($);if(J.needsHillshadePrepare&&b.renderPass==="offscreen")rc(b,J,p);else if(b.renderPass==="translucent"){const Q=b.depthModeForSublayer(0,$n.ReadOnly),oe=p.paint.get("hillshade-emissive-strength"),le=b.colorModeForDrapableLayerRenderPass(oe),ue=P&&b.terrain?b.terrain.stencilModeForRTTOverlap($):F[$.overscaledZ];Tl(b,$,J,p,Q,ue,le)}}E.viewport.set([0,0,b.width,b.height]),b.resetStencilClippingMasks()},raster:function(b,u,p,w,E,P){if(b.renderPass!=="translucent"||p.paint.get("raster-opacity")===0)return;const F=b.transform.projection.name==="globe",W=p.paint.get("raster-elevation")!==0,$=W&&F;if(b.renderElevatedRasterBackface&&!$)return;const J=b.context,Q=J.gl,oe=u.getSource(),le=function(Ge,et,Ke,tt){const ct=et.paint.get("raster-color"),st=Ge.type==="raster-array",rt=[],xt=et.paint.get("raster-resampling"),Ft=et.paint.get("raster-color-mix");let Zt=et.paint.get("raster-color-range");const kt=[Ft[0],Ft[1],Ft[2],0],hn=Ft[3];let bt=xt==="nearest"?tt.NEAREST:tt.LINEAR;if(st&&(rt.push("RASTER_ARRAY"),ct||rt.push("RASTER_COLOR"),xt==="linear"&&rt.push("RASTER_ARRAY_LINEAR"),bt=tt.NEAREST,!Zt&&Ge.rasterLayers)){const Wt=Ge.rasterLayers.find(({id:Vt})=>Vt===et.sourceLayer);Wt&&Wt.fields&&Wt.fields.range&&(Zt=Wt.fields.range)}if(Zt=Zt||[0,1],ct){rt.push("RASTER_COLOR"),Ke.activeTexture.set(tt.TEXTURE2),et.updateColorRamp(Zt);let Wt=et.colorRampTexture;Wt||(Wt=et.colorRampTexture=new o.T(Ke,et.colorRamp,tt.RGBA8)),Wt.bind(tt.LINEAR,tt.CLAMP_TO_EDGE)}return{mix:kt,range:Zt,offset:hn,defines:rt,resampling:bt}}(oe,p,J,Q);if(oe instanceof o.aD&&!w.length&&!F)return;const ue=p.paint.get("raster-emissive-strength"),ve=b.colorModeForDrapableLayerRenderPass(ue),_e=b.terrain&&b.terrain.renderingToTexture,be=!b.options.moving,we=p.paint.get("raster-resampling")==="nearest"?Q.NEAREST:Q.LINEAR;if(oe instanceof o.aD&&!w.length&&(oe.onNorthPole||oe.onSouthPole)){const Ge=W?b.stencilModeFor3D():pr.disabled;return void Oa(!!oe.onNorthPole,null,b,u,p,ue,le,_r.disabled,Ge)}if(!w.length)return;const[ke,Ne]=oe instanceof o.aD||_e?[{},w]:b.stencilConfigForOverlap(w),De=Ne[Ne.length-1].overscaledZ;$&&le.defines.push("PROJECTION_GLOBE_VIEW"),W&&le.defines.push("RENDER_CUTOFF");const je=(Ge,et,Ke)=>{for(const tt of Ge){const ct=tt.toUnwrapped(),st=u.getTile(tt);if(_e&&(!st||!st.hasData()))continue;J.activeTexture.set(Q.TEXTURE0);const rt=of(st,oe,p,le);if(!rt||!rt.texture)continue;const{texture:xt,mix:Ft,offset:Zt,tileSize:kt,buffer:hn}=rt;let bt,Wt;_e?(bt=$n.disabled,Wt=tt.projMatrix):W?(bt=new $n(Q.LEQUAL,$n.ReadWrite,b.depthRangeFor3D),Wt=F?Float32Array.from(b.transform.expandedFarZProjMatrix):b.transform.calculateProjMatrix(ct,be)):(bt=b.depthModeForSublayer(tt.overscaledZ-De,p.paint.get("raster-opacity")===1?$n.ReadWrite:$n.ReadOnly,Q.LESS),Wt=b.transform.calculateProjMatrix(ct,be));const Vt=b.terrain&&_e?b.terrain.stencilModeForRTTOverlap(tt):ke[tt.overscaledZ],fn=P?0:p.paint.get("raster-fade-duration");st.registerFadeDuration(fn);const pn=u.findLoadedParent(tt,0),qt=$u(st,pn,u,b.transform,fn);let en,er;b.terrain&&b.terrain.prepareDrawTile(),J.activeTexture.set(Q.TEXTURE0),xt.bind(we,Q.CLAMP_TO_EDGE),J.activeTexture.set(Q.TEXTURE1),pn?(pn.texture&&pn.texture.bind(we,Q.CLAMP_TO_EDGE),en=Math.pow(2,pn.tileID.overscaledZ-st.tileID.overscaledZ),er=[st.tileID.canonical.x*en%1,st.tileID.canonical.y*en%1]):xt.bind(we,Q.CLAMP_TO_EDGE),xt.useMipmap&&J.extTextureFilterAnisotropic&&b.transform.pitch>20&&Q.texParameterf(Q.TEXTURE_2D,J.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,J.extTextureFilterAnisotropicMax);const xn=b.transform;let Dn;const yr=W?hs(xn):[0,0,0,0];let qn,ur,Ur,Br,Mi,Ni=0;if($&&oe instanceof o.aD&&oe.coordinates.length>3)qn=Float32Array.from(o.b5(o.cC(new o.bP(0,0,0)))),ur=Float32Array.from(xn.globeMatrix),Ur=Float32Array.from(o.cy(xn)),Br=[o.am(xn.center.lng),o.at(xn.center.lat)],Dn=oe.elevatedGlobePerspectiveTransform,Mi=oe.elevatedGlobeGridMatrix||new Float32Array(9);else if($){const Yr=o.cz(tt.canonical);Ni=o.cA(Yr.getCenter().lat),qn=Float32Array.from(o.b5(o.cC(tt.canonical))),ur=Float32Array.from(xn.globeMatrix),Ur=Float32Array.from(o.cy(xn)),Br=[o.am(xn.center.lng),o.at(xn.center.lat)],Dn=[0,0],Mi=Float32Array.from(o.cB(tt.canonical,Yr,Ni,xn.worldSize/xn._pixelsPerMercatorPixel))}else Dn=oe instanceof o.aD?oe.perspectiveTransform:[0,0],qn=new Float32Array(16),ur=new Float32Array(9),Ur=new Float32Array(16),Br=[0,0],Mi=new Float32Array(9);const ns=yd(Wt,qn,ur,Ur,Mi,er||[0,0],o.a9(b.transform.zoom),Br,yr,en||1,qt,p,Dn,W?p.paint.get("raster-elevation"):0,2,Ft,Zt,le.range,kt,hn,ue),jc=b.isTileAffectedByFog(tt),Js=b.getOrCreateProgram("raster",{defines:le.defines,overrideFog:jc});if(b.uploadCommonUniforms(J,Js,ct),oe instanceof o.aD){const Yr=oe.elevatedGlobeVertexBuffer,Oi=oe.elevatedGlobeIndexBuffer;if(_e||!F)oe.boundsBuffer&&oe.boundsSegments&&Js.draw(b,Q.TRIANGLES,bt,pr.disabled,ve,_r.disabled,ns,p.id,oe.boundsBuffer,b.quadTriangleIndexBuffer,oe.boundsSegments);else if(Yr&&Oi){const bs=xn.zoom<=o.c2?oe.elevatedGlobeSegments:oe.getSegmentsForLongitude(xn.center.lng);bs&&Js.draw(b,Q.TRIANGLES,bt,pr.disabled,ve,et,ns,p.id,Yr,Oi,bs)}}else if($){bt=new $n(Q.LEQUAL,$n.ReadOnly,b.depthRangeFor3D);const Yr=b.globeSharedBuffers;if(Yr){const[Oi,bs,Pi]=Yr.getGridBuffers(Ni,!1);Js.draw(b,Q.TRIANGLES,bt,Ke||Vt,b.colorModeForRenderPass(),et,ns,p.id,Oi,bs,Pi)}}else{const{tileBoundsBuffer:Yr,tileBoundsIndexBuffer:Oi,tileBoundsSegments:bs}=b.getTileBoundsBuffers(st);Js.draw(b,Q.TRIANGLES,bt,Vt,ve,_r.disabled,ns,p.id,Yr,Oi,bs)}}if(!(oe instanceof o.aD)&&$)for(const tt of Ge){const ct=tt.canonical.y===(1<<tt.canonical.z)-1;tt.canonical.y===0&&Oa(!0,tt,b,u,p,ue,le,et,Ke||pr.disabled),ct&&Oa(!1,tt,b,u,p,ue,le,et===_r.frontCW?_r.backCW:_r.frontCW,Ke||pr.disabled)}};$?je(Ne,b.renderElevatedRasterBackface?_r.backCW:_r.frontCW,b.stencilModeFor3D()):je(Ne,_r.disabled,void 0),b.resetStencilClippingMasks()},"raster-particle":function(b,u,p,w,E,P){b.renderPass==="offscreen"&&function(F,W,$,J){if(!J.length)return;const Q=F.context,oe=Q.gl,le=W.getSource();if(!(le instanceof Er))return;const ue=Math.ceil(Math.sqrt($.paint.get("raster-particle-count")));let ve=$.particlePositionRGBAImage;if(!ve||ve.width!==ue){const Ne=function(De){const je=De*De,Ge=new Uint8Array(4*je),et=function(tt){return tt|=0,tt=Math.imul(2747636419^tt,2654435769),tt=Math.imul(tt^tt>>>16,2654435769),((tt=Math.imul(tt^tt>>>16,2654435769))>>>0)/4294967296},Ke=1/1.1;for(let tt=0;tt<je;tt++){const ct=Ke*(et(2*tt+0)+hl),st=Ke*(et(2*tt+1)+hl),rt=255*ct%1,xt=255*st%1,Ft=rt,Zt=st-xt/255,kt=xt;Ge[4*tt+0]=255*(ct-rt/255),Ge[4*tt+1]=255*Ft,Ge[4*tt+2]=255*Zt,Ge[4*tt+3]=255*kt}return Ge}(ue);ve=$.particlePositionRGBAImage=new o.r({width:ue,height:ue},Ne)}let _e=$.particleFramebuffer;_e?_e.width!==ue&&(_e.destroy(),_e=$.particleFramebuffer=Q.createFramebuffer(ue,ue,!0,null)):_e=$.particleFramebuffer=Q.createFramebuffer(ue,ue,!0,null);const be=[];for(const Ne of J){const De=W.getTile(Ne);if(!(De instanceof rg))continue;const je=Yp(De,le,$);if(!je)continue;const Ge=[De.tileSize,De.tileSize];let et=$.tileFramebuffer;et||(et=$.tileFramebuffer=Q.createFramebuffer(Ge[0],Ge[1],!0,null));let Ke=De.rasterParticleState;Ke||(Ke=De.rasterParticleState=new Zp(Q,Ne,Ge,ve));const tt=Ke.update($.lastInvalidatedAt);Ke.particleTextureDimension!==ue&&Ke.updateParticleTexture(Ne,ve);const ct=Ke.targetColorTexture;Ke.targetColorTexture=Ke.backgroundColorTexture,Ke.backgroundColorTexture=ct;const st=Ke.particleTexture0;Ke.particleTexture0=Ke.particleTexture1,Ke.particleTexture1=st,be.push([Ne,je,Ke,tt])}if(be.length===0)return;const we=o.q.now(),ke=$.previousDrawTimestamp?.001*(we-$.previousDrawTimestamp):.0167;if($.previousDrawTimestamp=we,$.hasColorMap()){Q.activeTexture.set(oe.TEXTURE0+2);let Ne=$.colorRampTexture;Ne||(Ne=$.colorRampTexture=new o.T(Q,$.colorRamp,oe.RGBA8)),Ne.bind(oe.LINEAR,oe.CLAMP_TO_EDGE)}Q.bindFramebuffer.set($.tileFramebuffer.framebuffer),function(Ne,De,je){const Ge=Ne.context,et=Ge.gl,Ke=De.tileFramebuffer;Ge.activeTexture.set(et.TEXTURE0);const tt={u_texture:0,u_opacity:1.05*(st=De.paint.get("raster-particle-fade-opacity-factor"))/(st+.05)},ct=Ne.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var st;for(const rt of je){const[,,xt,Ft]=rt;Ke.colorAttachment.set(xt.targetColorTexture.texture),Ge.viewport.set([0,0,Ke.width,Ke.height]),Ge.clear({color:o.bz.transparent}),Ft&&(xt.backgroundColorTexture.bind(et.NEAREST,et.CLAMP_TO_EDGE),ct.draw(Ne,et.TRIANGLES,$n.disabled,pr.disabled,Mr.alphaBlended,_r.disabled,tt,De.id,Ne.viewportBuffer,Ne.quadTriangleIndexBuffer,Ne.viewportSegments))}}(F,$,be),function(Ne,De,je,Ge){const et=Ne.context,Ke=et.gl,tt=je.tileFramebuffer,ct=Ne.transform.projection.name==="globe",st=je.paint.get("raster-particle-max-speed");for(const rt of Ge){const[xt,Ft,Zt]=rt;et.activeTexture.set(Ke.TEXTURE0+0),Ft.texture.bind(Ke.LINEAR,Ke.CLAMP_TO_EDGE),tt.colorAttachment.set(Zt.targetColorTexture.texture);const kt=Ne.getOrCreateProgram("rasterParticleDraw",{defines:Ft.defines,overrideFog:!1});et.activeTexture.set(Ke.TEXTURE0+1);const hn=Ft.scalarData?[]:[0,1,2,3].map(Vt=>o.c$[Vt](xt));hn.push(xt);const bt=xt.canonical.x,Wt=xt.canonical.y;for(const Vt of hn){const fn=De.getTile(ct?Vt.wrapped():Vt);if(!fn)continue;const pn=fn.rasterParticleState;if(!pn)continue;const qt=Vt.canonical.x+(1<<Vt.canonical.z)*(Vt.wrap-xt.wrap),en=Vt.canonical.y;pn.particleTexture0.bind(Ke.NEAREST,Ke.CLAMP_TO_EDGE);const er=xd(1,pn.particleTexture0.size[0],[qt-bt,en-Wt],0,Ft.texture.size,2,st,Ft.textureOffset,Ft.scale,Ft.offset);kt.draw(Ne,Ke.POINTS,$n.disabled,pr.disabled,Mr.alphaBlended,_r.disabled,er,je.id,pn.particleIndexBuffer,void 0,pn.particleSegment)}}}(F,W,$,be),Q.bindFramebuffer.set($.particleFramebuffer.framebuffer),function(Ne,De,je,Ge){const et=Ne.context,Ke=et.gl,tt=De.paint.get("raster-particle-max-speed"),ct=Ge*De.paint.get("raster-particle-speed-factor")*.15,st=function(xt){return Math.pow(xt,6)}(.01+1*De.paint.get("raster-particle-reset-rate-factor")),rt=De.particleFramebuffer;et.viewport.set([0,0,rt.width,rt.height]);for(const xt of je){const[,Ft,Zt]=xt;et.activeTexture.set(Ke.TEXTURE0+0),Ft.texture.bind(Ke.LINEAR,Ke.CLAMP_TO_EDGE),et.activeTexture.set(Ke.TEXTURE0+1);const kt=Zt.particleTexture0;kt.bind(Ke.NEAREST,Ke.CLAMP_TO_EDGE);const hn=Wp(1,kt.size[0],0,Ft.texture.size,tt,ct,st,Ft.textureOffset,Ft.scale,Ft.offset);rt.colorAttachment.set(Zt.particleTexture1.texture),et.clear({color:o.bz.transparent}),Ne.getOrCreateProgram("rasterParticleUpdate",{defines:Ft.defines}).draw(Ne,Ke.TRIANGLES,$n.disabled,pr.disabled,Mr.unblended,_r.disabled,hn,De.id,Ne.viewportBuffer,Ne.quadTriangleIndexBuffer,Ne.viewportSegments)}}(F,$,be,ke)}(b,u,p,w),b.renderPass==="translucent"&&(function(F,W,$,J,Q){const oe=F.context,le=oe.gl,ue=W.getSource().tileSize,ve=5*(1-o.a7(o.bU,o.bU+1,F.transform.zoom))*ue+$.paint.get("raster-particle-elevation"),_e=!F.options.moving,be=F.transform.projection.name==="globe";if(!J.length)return;const[we,ke]=F.stencilConfigForOverlap(J),Ne=[];be&&Ne.push("PROJECTION_GLOBE_VIEW");const De=F.stencilModeFor3D();for(const je of ke){const Ge=je.toUnwrapped(),et=W.getTile(je);if(!et.rasterParticleState)continue;const Ke=et.rasterParticleState,tt=100;et.registerFadeDuration(tt);const ct=W.findLoadedParent(je,0),st=$u(et,ct,W,F.transform,tt);let rt,xt;F.terrain&&F.terrain.prepareDrawTile(),oe.activeTexture.set(le.TEXTURE0),Ke.targetColorTexture.bind(le.LINEAR,le.CLAMP_TO_EDGE),oe.activeTexture.set(le.TEXTURE1),ct&&ct.rasterParticleState?(ct.rasterParticleState.targetColorTexture.bind(le.LINEAR,le.CLAMP_TO_EDGE),rt=Math.pow(2,ct.tileID.overscaledZ-et.tileID.overscaledZ),xt=[et.tileID.canonical.x*rt%1,et.tileID.canonical.y*rt%1]):Ke.targetColorTexture.bind(le.LINEAR,le.CLAMP_TO_EDGE);const Ft=be?Float32Array.from(F.transform.expandedFarZProjMatrix):F.transform.calculateProjMatrix(Ge,_e),Zt=F.transform,kt=Md(Zt),hn=o.cz(je.canonical),bt=o.cA(hn.getCenter().lat);let Wt,Vt,fn,pn,qt;be?(Wt=Float32Array.from(o.b5(o.cC(je.canonical))),Vt=Float32Array.from(Zt.globeMatrix),fn=Float32Array.from(o.cy(Zt)),pn=[o.am(Zt.center.lng),o.at(Zt.center.lat)],qt=Float32Array.from(o.cB(je.canonical,hn,bt,Zt.worldSize/Zt._pixelsPerMercatorPixel))):(Wt=new Float32Array(16),Vt=new Float32Array(9),fn=new Float32Array(16),pn=[0,0],qt=new Float32Array(9));const en=Yv(Ft,Wt,Vt,fn,qt,xt||[0,0],o.a9(F.transform.zoom),pn,kt,rt||1,st,ve),er=F.isTileAffectedByFog(je),xn=F.getOrCreateProgram("rasterParticle",{defines:Ne,overrideFog:er});if(F.uploadCommonUniforms(oe,xn,Ge),be){const Dn=new $n(le.LEQUAL,$n.ReadOnly,F.depthRangeFor3D),yr=0,qn=F.globeSharedBuffers;if(qn){const[ur,Ur,Br]=qn.getGridBuffers(bt,yr!==0);xn.draw(F,le.TRIANGLES,Dn,De,Mr.alphaBlended,F.renderElevatedRasterBackface?_r.frontCCW:_r.backCCW,en,$.id,ur,Ur,Br)}}else{const Dn=F.depthModeForSublayer(0,$n.ReadOnly),yr=we[je.overscaledZ],{tileBoundsBuffer:qn,tileBoundsIndexBuffer:ur,tileBoundsSegments:Ur}=F.getTileBoundsBuffers(et);xn.draw(F,le.TRIANGLES,Dn,yr,Mr.alphaBlended,_r.disabled,en,$.id,qn,ur,Ur)}}F.resetStencilClippingMasks()}(b,u,p,w),b.style.map.triggerRepaint())},background:function(b,u,p,w){const E=p.paint.get("background-color"),P=p.paint.get("background-opacity"),F=p.paint.get("background-emissive-strength"),W=p.paint.get("background-pitch-alignment")==="viewport";if(P===0)return;const $=b.context,J=$.gl,Q=b.transform,oe=Q.tileSize,le=p.paint.get("background-pattern");let ue;if(le!==void 0&&(le===null||(ue=b.imageManager.getPattern(le.toString(),p.scope,b.style.getLut(p.scope)),!ue)))return;const ve=!le&&E.a===1&&P===1&&b.opaquePassEnabledForLayer()?"opaque":"translucent";if(b.renderPass!==ve)return;const _e=pr.disabled,be=b.depthModeForSublayer(0,ve==="opaque"?$n.ReadWrite:$n.ReadOnly),we=b.colorModeForDrapableLayerRenderPass(F),ke=le?"backgroundPattern":"background";let Ne,De=w;if(De||(Ne=b.getBackgroundTiles(),De=Object.values(Ne).map(je=>je.tileID)),le&&($.activeTexture.set(J.TEXTURE0),b.imageManager.bind(b.context,p.scope)),W){const je=b.getOrCreateProgram(ke,{overrideFog:!1,overrideRtt:!0}),Ge=new Float32Array(o.a6.mat4.identity([])),et=new o.aA(0,0,0,0,0),Ke=le?zc(Ge,F,P,b,0,p.scope,ue,W,{tileID:et,tileSize:oe}):Ex(Ge,F,P,E.toRenderColor(p.lut));je.draw(b,J.TRIANGLES,be,_e,we,_r.disabled,Ke,p.id,b.viewportBuffer,b.quadTriangleIndexBuffer,b.viewportSegments)}else for(const je of De){const Ge=b.isTileAffectedByFog(je),et=b.getOrCreateProgram(ke,{overrideFog:Ge}),Ke=je.toUnwrapped(),tt=w?je.projMatrix:b.transform.calculateProjMatrix(Ke);b.prepareDrawTile();const ct=u?u.getTile(je):Ne?Ne[je.key]:new Bc(je,oe,Q.zoom,b),st=le?zc(tt,F,P,b,0,p.scope,ue,W,{tileID:je,tileSize:oe}):Ex(tt,F,P,E.toRenderColor(p.lut));b.uploadCommonUniforms($,et,Ke);const{tileBoundsBuffer:rt,tileBoundsIndexBuffer:xt,tileBoundsSegments:Ft}=b.getTileBoundsBuffers(ct);et.draw(b,J.TRIANGLES,be,_e,we,_r.disabled,st,p.id,rt,xt,Ft)}},sky:function(b,u,p){const w=b._atmosphere?o.a9(b.transform.zoom):1,E=p.paint.get("sky-opacity")*w;if(E===0)return;const P=b.context,F=p.paint.get("sky-type"),W=new $n(P.gl.LEQUAL,$n.ReadOnly,[0,1]),$=b.frameCounter/1e3%1;F==="atmosphere"?b.renderPass==="offscreen"?p.needsSkyboxCapture(b)&&(function(J,Q,oe,le){const ue=J.context,ve=ue.gl;let _e=Q.skyboxFbo;if(!_e){_e=Q.skyboxFbo=ue.createFramebuffer(32,32,!0,null),Q.skyboxGeometry=new Do(ue),Q.skyboxTexture=ue.gl.createTexture(),ve.bindTexture(ve.TEXTURE_CUBE_MAP,Q.skyboxTexture),ve.texParameteri(ve.TEXTURE_CUBE_MAP,ve.TEXTURE_WRAP_S,ve.CLAMP_TO_EDGE),ve.texParameteri(ve.TEXTURE_CUBE_MAP,ve.TEXTURE_WRAP_T,ve.CLAMP_TO_EDGE),ve.texParameteri(ve.TEXTURE_CUBE_MAP,ve.TEXTURE_MIN_FILTER,ve.LINEAR),ve.texParameteri(ve.TEXTURE_CUBE_MAP,ve.TEXTURE_MAG_FILTER,ve.LINEAR);for(let Ne=0;Ne<6;++Ne)ve.texImage2D(ve.TEXTURE_CUBE_MAP_POSITIVE_X+Ne,0,ve.RGBA,32,32,0,ve.RGBA,ve.UNSIGNED_BYTE,null)}ue.bindFramebuffer.set(_e.framebuffer),ue.viewport.set([0,0,32,32]);const be=Q.getCenter(J,!0),we=J.getOrCreateProgram("skyboxCapture"),ke=new Float64Array(16);o.a6.mat4.identity(ke),o.a6.mat4.rotateY(ke,ke,.5*-Math.PI),Bo(J,Q,we,ke,be,0),o.a6.mat4.identity(ke),o.a6.mat4.rotateY(ke,ke,.5*Math.PI),Bo(J,Q,we,ke,be,1),o.a6.mat4.identity(ke),o.a6.mat4.rotateX(ke,ke,.5*-Math.PI),Bo(J,Q,we,ke,be,2),o.a6.mat4.identity(ke),o.a6.mat4.rotateX(ke,ke,.5*Math.PI),Bo(J,Q,we,ke,be,3),o.a6.mat4.identity(ke),Bo(J,Q,we,ke,be,4),o.a6.mat4.identity(ke),o.a6.mat4.rotateY(ke,ke,Math.PI),Bo(J,Q,we,ke,be,5),ue.viewport.set([0,0,J.width,J.height])}(b,p),p.markSkyboxValid(b)):b.renderPass==="sky"&&function(J,Q,oe,le,ue){const ve=J.context,_e=ve.gl,be=J.transform,we=J.getOrCreateProgram("skybox");ve.activeTexture.set(_e.TEXTURE0),_e.bindTexture(_e.TEXTURE_CUBE_MAP,Q.skyboxTexture);const ke=((Ne,De,je,Ge,et)=>({u_matrix:Ne,u_sun_direction:De,u_cubemap:0,u_opacity:Ge,u_temporal_offset:et}))(be.skyboxMatrix,Q.getCenter(J,!1),0,le,ue);J.uploadCommonUniforms(ve,we),we.draw(J,_e.TRIANGLES,oe,pr.disabled,J.colorModeForRenderPass(),_r.backCW,ke,"skybox",Q.skyboxGeometry.vertexBuffer,Q.skyboxGeometry.indexBuffer,Q.skyboxGeometry.segment)}(b,p,W,E,$):F==="gradient"&&b.renderPass==="sky"&&function(J,Q,oe,le,ue){const ve=J.context,_e=ve.gl,be=J.transform,we=J.getOrCreateProgram("skyboxGradient");Q.skyboxGeometry||(Q.skyboxGeometry=new Do(ve)),ve.activeTexture.set(_e.TEXTURE0);let ke=Q.colorRampTexture;ke||(ke=Q.colorRampTexture=new o.T(ve,Q.colorRamp,_e.RGBA8)),ke.bind(_e.LINEAR,_e.CLAMP_TO_EDGE);const Ne=((De,je,Ge,et,Ke)=>({u_matrix:De,u_color_ramp:0,u_center_direction:je,u_radius:o.bB(Ge),u_opacity:et,u_temporal_offset:Ke}))(be.skyboxMatrix,Q.getCenter(J,!1),Q.paint.get("sky-gradient-radius"),le,ue);J.uploadCommonUniforms(ve,we),we.draw(J,_e.TRIANGLES,oe,pr.disabled,J.colorModeForRenderPass(),_r.backCW,Ne,"skyboxGradient",Q.skyboxGeometry.vertexBuffer,Q.skyboxGeometry.indexBuffer,Q.skyboxGeometry.segment)}(b,p,W,E,$)},debug:function(b,u,p,w,E,P){for(let F=0;F<p.length;F++)if(E){const J=new o.bz(w.r*.8,w.g*.8,w.b*.8,1);oc(b,u,p[F],w,-1,-1,P),oc(b,u,p[F],w,-1,1,P),oc(b,u,p[F],w,1,1,P),oc(b,u,p[F],w,1,-1,P),oc(b,u,p[F],J,0,0,P)}else oc(b,u,p[F],w,0,0,P)},custom:function(b,u,p,w){const E=b.context,P=p.implementation;if(!b.transform.projection.unsupportedLayers||!b.transform.projection.unsupportedLayers.includes("custom")||b.terrain&&(b.terrain.renderingToTexture||b.renderPass==="offscreen")&&p.isDraped(u)){if(b.renderPass==="offscreen"){const F=P.prerender;if(F){if(b.setCustomLayerDefaults(),E.setColorMode(b.colorModeForRenderPass()),b.transform.projection.name==="globe"){const W=b.transform.pointMerc;F.call(P,E.gl,b.transform.customLayerMatrix(),b.transform.getProjection(),b.transform.globeToMercatorMatrix(),o.a9(b.transform.zoom),[W.x,W.y],b.transform.pixelsPerMeterRatio)}else F.call(P,E.gl,b.transform.customLayerMatrix());E.setDirty(),b.setBaseState()}}else if(b.renderPass==="translucent"){if(b.terrain&&b.terrain.renderingToTexture){const W=P.renderToTile;if(W){const $=w[0].canonical,J=new o.a5($.x+w[0].wrap*(1<<$.z),$.y,$.z);E.setDepthMode($n.disabled),E.setStencilMode(pr.disabled),E.setColorMode(b.colorModeForRenderPass()),b.setCustomLayerDefaults(),W.call(P,E.gl,J),E.setDirty(),b.setBaseState()}return}b.setCustomLayerDefaults(),E.setColorMode(b.colorModeForRenderPass()),E.setStencilMode(pr.disabled);const F=P.renderingMode==="3d"?new $n(b.context.gl.LEQUAL,$n.ReadWrite,b.depthRangeFor3D):b.depthModeForSublayer(0,$n.ReadOnly);if(E.setDepthMode(F),b.transform.projection.name==="globe"){const W=b.transform.pointMerc;P.render(E.gl,b.transform.customLayerMatrix(),b.transform.getProjection(),b.transform.globeToMercatorMatrix(),o.a9(b.transform.zoom),[W.x,W.y],b.transform.pixelsPerMeterRatio)}else P.render(E.gl,b.transform.customLayerMatrix());E.setDirty(),b.setBaseState(),E.bindFramebuffer.set(null)}}else o.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(b,u,p,w){if(b.renderPass==="opaque")return;const E=p.paint.get("model-opacity");if(E===0)return;const P=p.paint.get("model-cast-shadows");if(b.renderPass==="shadow"&&(!P||b.terrain&&E<.65&&p._transitionablePaint._values["model-opacity"].value.expression instanceof o.a4))return;const F=b.shadowRenderer,W=p.paint.get("model-receive-shadows");F&&(F.useNormalOffset=!0,W||(F.enabled=!1));const $=()=>{F&&(F.useNormalOffset=!0,W||(F.enabled=!0))},J=u.getSource();if(b.renderPass==="light-beam"&&J.type!=="batched-model")return;if(J.type==="vector"||J.type==="geojson")return function(we,ke,Ne,De,je){const Ge=we.transform;if(Ge.projection.name!=="mercator")return void o.w(`Drawing 3D models for ${Ge.projection.name} projection is not yet implemented`);const et=Ge.getFreeCameraOptions().position;if(!we.modelManager)return;const Ke=we.modelManager;Ne.modelManager=Ke;const tt=we.shadowRenderer;if(!Ne._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const ct=Ne._unevaluatedLayout._values["model-id"],st={...Ne.layout.get("model-id").parameters},rt=we.style.order.indexOf(Ne.fqid);for(const xt of De){const Ft=ke.getTile(xt).getBucket(Ne);if(!Ft||Ft.projection.name!==Ge.projection.name)continue;const Zt=Ft.getModelUris();Zt&&!Ft.modelsRequested&&(Ke.addModelsFromBucket(Zt,je),Ft.modelsRequested=!0);const kt=e_(xt,Ge);st.zoom=kt;const hn=ct.possiblyEvaluate(st);if(uf(we,Ft,xt),Ka.shadowUniformsInitialized=!1,Ka.useSingleShadowCascade=!!tt&&tt.getMaxCascadeForTile(xt.toUnwrapped())===0,we.renderPass==="shadow"&&tt){if(we.currentShadowCascade===1&&Ft.isInsideFirstShadowMapFrustum)continue;const Vt=Ge.calculatePosMatrix(xt.toUnwrapped(),Ge.worldSize);if(Ka.tileMatrix.set(Vt),Ka.shadowTileMatrix=Float32Array.from(tt.calculateShadowPassMatrixFromMatrix(Vt)),Ka.aabb.min.fill(0),Ka.aabb.max[0]=Ka.aabb.max[1]=o.ab,Ka.aabb.max[2]=0,El(Ft,Ka,we,Ne.scope))continue}const bt=1<<xt.canonical.z,Wt=[((et.x-xt.wrap)*bt-xt.canonical.x)*o.ab,(et.y*bt-xt.canonical.y)*o.ab,et.z*bt*o.ab];we.conflationActive&&Object.keys(Ft.instancesPerModel).length>0&&we.style.isLayerClipped(Ne,ke.getSource())&&Ft.updateReplacement(xt,we.replacementSource,rt,je)&&(Ft.uploaded=!1,Ft.upload(we.context));for(let Vt in Ft.instancesPerModel){const fn=Ft.instancesPerModel[Vt];fn.features.length>0&&(Vt=hn.evaluate(fn.features[0].feature,{}));const pn=Ke.getModel(Vt,je);if(pn&&pn.uploaded)for(const qt of pn.nodes)Gs(we,Ne,qt,fn,Wt,xt,Ka)}}}(b,u,p,w,J.type==="vector"?p.scope:""),void $();if(!J.loaded())return;if(J.type==="batched-model")return function(we,ke,Ne,De){Ne.resetLayerRenderingStats(we);const je=we.context,Ge=we.transform,et=we.style.fog,Ke=we.shadowRenderer;if(Ge.projection.name!=="mercator")return void o.w(`Drawing 3D landmark models for ${Ge.projection.name} projection is not yet implemented`);const tt=we.transform.getFreeCameraOptions().position,ct=o.a6.vec3.scale([],[tt.x,tt.y,tt.z],we.transform.worldSize),st=o.a6.vec3.negate([],ct),rt=o.a6.mat4.identity([]),xt=o.de(Ge.center.lat,Ge.zoom),Ft=o.a6.mat4.fromScaling([],[1,1,1/xt]);o.a6.mat4.translate(rt,rt,st);const Zt=Ne.paint.get("model-opacity"),kt=new $n(je.gl.LEQUAL,$n.ReadWrite,we.depthRangeFor3D),hn=new $n(je.gl.LEQUAL,$n.ReadOnly,we.depthRangeFor3D),bt=new o.c9([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Wt=we.renderPass==="shadow",Vt=Wt&&Ke?Ke.getCurrentCascadeFrustum():Ge.getFrustum(Ge.scaleZoom(Ge.worldSize)),fn=Ne.paint.get("model-front-cutoff"),pn=fn[2]<1,qt=tc(we,Ne.paint.get("model-cutoff-fade-range")),en=Ne.getLayerRenderingStats();(function(er,xn,Dn,yr){const qn=er.terrain?er.terrain.exaggeration():0,ur=er.transform.zoom;for(const Ur of yr){const Br=xn.getTile(Ur).getBucket(Dn);Br&&(er.conflationActive&&Br.updateReplacement(Ur,er.replacementSource),Br.evaluateScale(er,Dn),er.terrain&&qn>0&&Br.elevationUpdate(er.terrain,qn,Ur,Dn.source),Br.needsReEvaluation(er,ur,Dn)&&Br.evaluate(Dn))}})(we,ke,Ne,De),function(){let er,xn,Dn;pn?(er=De.length-1,xn=-1,Dn=-1):(er=0,xn=De.length,Dn=1);const yr=new Float64Array(16),qn=o.a6.vec3.create(),ur=new o.P(0,0);for(let Ur=er;Ur!==xn;Ur+=Dn){const Br=De[Ur],Mi=ke.getTile(Br).getBucket(Ne);if(!Mi||!Mi.uploaded)continue;let Ni=!1;Ke&&(Ni=Ke.getMaxCascadeForTile(Br.toUnwrapped())===0);const ns=Ge.calculatePosMatrix(Br.toUnwrapped(),Ge.worldSize),jc=Mi.modelTraits;!Wt&&pn&&(o.a6.mat4.invert(yr,ns),o.a6.vec3.transformMat4(qn,ct,yr),ur.x=qn[0],ur.y=qn[1]);const Js=[];for(const Yr of Mi.getNodesInfo()){if(Yr.hiddenByReplacement||!Yr.node.meshes)continue;const Oi=Yr.node;let bs=0;we.terrain&&Oi.elevation&&(bs=Oi.elevation*we.terrain.exaggeration());const Pi=(()=>{const Zi=Yr.aabb;return bt.min=[...Zi.min],bt.max=[...Zi.max],bt.min[2]+=bs,bt.max[2]+=bs,o.a6.vec3.transformMat4(bt.min,bt.min,ns),o.a6.vec3.transformMat4(bt.max,bt.max,ns),bt})(),kr=Yr.evaluatedScale;if(kr[0]<=1&&kr[1]<=1&&kr[2]<=1&&Pi.intersects(Vt)===0)continue;if(!Wt&&pn){const Zi=.16666666666666666;Yr.cameraCollisionOpacity=ct[0]>Pi.min[0]&&ct[0]<Pi.max[0]&&ct[1]>Pi.min[1]&&ct[1]<Pi.max[1]&&ct[2]*xt<Pi.max[2]&&Oi.footprint&&o.bu(ur,Oi.footprint)?Math.max(Yr.cameraCollisionOpacity-Zi,0):Math.min(1,Yr.cameraCollisionOpacity+Zi)}const di=[...ns],Si=Oi.anchor?Oi.anchor[0]:0,Fs=Oi.anchor?Oi.anchor[1]:0;o.a6.mat4.translate(di,di,[Si*(kr[0]-1),Fs*(kr[1]-1),bs]),o.a6.vec3.exactEquals(kr,o.dh)||o.a6.mat4.scale(di,di,kr);const Qs=o.a6.mat4.multiply([],di,Oi.matrix),si=o.a6.mat4.multiply([],Ge.expandedFarZProjMatrix,Qs),Oo=o.a6.mat4.multiply([],Ge.expandedFarZProjMatrix,di),Yo=o.a6.vec4.transformMat4([],[Si,Fs,bs,1],si)[2];Oi.hidden=!1;let Fo=Zt;Wt||(pn&&(Fo*=Yr.cameraCollisionOpacity,Fo*=Qr(di,Ge,Yr.aabb,fn)),Fo*=ki(qt,Yo)),Fo!==0?Js.push({nodeInfo:Yr,depth:Yo,opacity:Fo,wvpForNode:si,wvpForTile:Oo,nodeModelMatrix:Qs,tileModelMatrix:di}):Oi.hidden=!0}Wt||Js.sort((Yr,Oi)=>!pn||Yr.opacity===1&&Oi.opacity===1?Yr.depth<Oi.depth?-1:1:Yr.opacity===1?-1:Oi.opacity===1?1:Yr.depth>Oi.depth?-1:1);for(const Yr of Js){const Oi=Yr.nodeInfo,bs=Oi.node;let Pi=o.a6.mat4.multiply([],Ft,Yr.tileModelMatrix);o.a6.mat4.multiply(Pi,rt,Pi);const kr=o.a6.mat4.invert([],Pi);o.a6.mat4.transpose(kr,kr),o.a6.mat4.scale(kr,kr,kg),Pi=o.a6.mat4.multiply(Pi,Pi,bs.matrix);const di=we.renderPass==="light-beam",Si=jc&o.dj.HasMapboxMeshFeatures,Fs=Si?0:Oi.evaluatedRMEA[0][2];for(let Qs=0;Qs<bs.meshes.length;++Qs){const si=bs.meshes[Qs],Oo=Qs===bs.lightMeshIndex;let Yo=Yr.wvpForNode;if(Oo){if(!di&&!we.terrain&&we.shadowRenderer){we.currentLayer<we.firstLightBeamLayer&&(we.firstLightBeamLayer=we.currentLayer);continue}Yo=Yr.wvpForTile}else if(di)continue;const Fo={defines:[]},Zi=[];if(Ku(Fo.defines,Zi,si,we,Ne.lut),Si||Fo.defines.push("DIFFUSE_SHADED"),Ni&&Fo.defines.push("SHADOWS_SINGLE_CASCADE"),en&&(Wt?en.numRenderedVerticesInShadowPass+=si.vertexArray.length:en.numRenderedVerticesInTransparentPass+=si.vertexArray.length),Wt){Ju(si,Yr.nodeModelMatrix,we,Ne);continue}let dl=null;if(et){const pf=Cd(Yr.nodeModelMatrix,we.transform);if(dl=new Float32Array(pf),Ge.projection.name!=="globe"){const Bd=si.aabb.min,th=si.aabb.max,[jg,Wg]=et.getOpacityForBounds(pf,Bd[0],Bd[1],th[0],th[1]);Fo.overrideFog=jg>=Mn||Wg>=Mn}}const pl=si.material;let Wc;pl.occlusionTexture&&pl.occlusionTexture.offsetScale&&(Wc=pl.occlusionTexture.offsetScale,Fo.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!Wt&&Ke&&(Ke.useNormalOffset=!!si.normalBuffer);const fc=we.getOrCreateProgram("model",Fo);!Wt&&Ke&&Ke.setupShadowsFromMatrix(Yr.tileModelMatrix,fc,Ke.useNormalOffset),we.uploadCommonUniforms(je,fc,null,dl);const Rl=pl.pbrMetallicRoughness;Rl.metallicFactor=.9,Rl.roughnessFactor=.5;const Xc=Fn(new Float32Array(Yo),new Float32Array(Pi),new Float32Array(kr),new Float32Array(bs.matrix),we,Yr.opacity,Rl.baseColorFactor.toRenderColor(null),pl.emissiveFactor,Rl.metallicFactor,Rl.roughnessFactor,pl,Fs,Ne,[0,0,0],Wc);!Oo&&(Oi.hasTranslucentParts||Yr.opacity<1)&&fc.draw(we,je.gl.TRIANGLES,kt,pr.disabled,Mr.disabled,_r.backCCW,Xc,Ne.id,si.vertexBuffer,si.indexBuffer,si.segments,Ne.paint,we.transform.zoom,void 0,Zi),fc.draw(we,je.gl.TRIANGLES,Oo?hn:kt,pr.disabled,Oo||Yr.opacity<1||Oi.hasTranslucentParts?Mr.alphaBlended:Mr.unblended,_r.backCCW,Xc,Ne.id,si.vertexBuffer,si.indexBuffer,si.segments,Ne.paint,we.transform.zoom,void 0,Zi)}}}}()}(b,u,p,w),void $();if(J.type!=="model")return;const Q=J.getModels(),oe=[],le=b.transform.getFreeCameraOptions().position,ue=o.a6.vec3.scale([],[le.x,le.y,le.z],b.transform.worldSize);o.a6.vec3.negate(ue,ue);const ve=[],_e=[];let be=0;for(const we of Q){const ke=p.paint.get("model-rotation").constantOr(null),Ne=p.paint.get("model-scale").constantOr(null),De=p.paint.get("model-translation").constantOr(null);we.computeModelMatrix(b,ke,Ne,De,!0,!0,!1);const je=o.a6.mat4.identity([]),Ge=o.de(we.position.lat,b.transform.zoom),et=o.a6.mat4.fromScaling([],[1,1,1/Ge]);o.a6.mat4.translate(je,je,ue),oe.push({zScaleMatrix:et,negCameraPosMatrix:je});for(const Ke of we.nodes)cf(b.transform,Ke,we.matrix,b.transform.expandedFarZProjMatrix,be,ve,_e);be++}if(ve.sort((we,ke)=>ke.depth-we.depth),b.renderPass!=="shadow"){if(E===1)for(const we of _e)Zo(we,b,p,oe[we.modelIndex],pr.disabled,b.colorModeForRenderPass());else{for(const we of _e)Zo(we,b,p,oe[we.modelIndex],pr.disabled,Mr.disabled);for(const we of _e)Zo(we,b,p,oe[we.modelIndex],b.stencilModeFor3D(),b.colorModeForRenderPass());b.resetStencilClippingMasks()}for(const we of ve)Zo(we,b,p,oe[we.modelIndex],pr.disabled,b.colorModeForRenderPass());$()}else{for(const we of _e)Ju(we.mesh,we.nodeModelMatrix,b,p);for(const we of ve)Ju(we.mesh,we.nodeModelMatrix,b,p);$()}}},cc={model:function(b,u,p){const w=u.getSource();if(!w.loaded())return;if(w.type==="vector"||w.type==="geojson")return void(p.modelManager&&p.modelManager.upload(p,w.type==="vector"?b.scope:""));if(w.type==="batched-model"||w.type!=="model")return;const E=w.getModels();for(const P of E)P.upload(p.context)},raster:function(b,u,p){const w=u.getSource();if(!(w instanceof Er&&w.loaded()))return;const E=b.sourceLayer||w.rasterLayerIds&&w.rasterLayerIds[0];if(!E)return;const P=b.paint.get("raster-array-band")||w.getInitialBand(E);if(P==null)return;const F=u.getIds().map(W=>u.getTileByID(W));for(const W of F)W.updateNeeded(E,P)&&w.prepareTile(W,E,P)},"raster-particle":function(b,u,p){const w=u.getSource();if(!(w instanceof Er&&w.loaded()))return;const E=b.sourceLayer||w.rasterLayerIds&&w.rasterLayerIds[0];if(!E)return;const P=b.paint.get("raster-particle-array-band")||w.getInitialBand(E);if(P==null)return;const F=u.getIds().map(W=>u.getTileByID(W));for(const W of F)W.updateNeeded(E,P)&&w.prepareTile(W,E,P)}};class Ja{constructor(u,p,w,E){this.context=new $p(u,p),this.transform=w,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=E,this._timeStamp=o.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const P=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const W of P)this._debugParams.enabledLayers[W]=!0;E.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),E.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),E.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),E.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),E.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const W of P)E.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],W);this.occlusionParams=new hf(E),this.setup(),this.numSublayers=Xo.maxUnderzooming+Xo.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new o.dl,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new ag(this),this._wireframeDebugCache=new lc,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const F=new o.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new o.T(this.context,F,u.RGBA8),this._clippingActiveLastFrame=!1}updateTerrain(u,p){const w=!!u&&!!u.terrain&&this.transform.projection.supportsTerrain;if(!(w||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new ef(this,u));const E=this._terrain;this.transform.elevation=w?E:null,E.update(u,this.transform,p),this.transform.elevation&&!E.enabled&&(this.transform.elevation=null)}_updateFog(u){const p=u.fog;if(!p||this.transform.projection.name==="globe"||p.getOpacity(this.transform.pitch)<1||p.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[w,E]=p.getFovAdjustedRange(this.transform._fov);if(w>E)return void(this.transform.fogCullDistSq=null);const P=w+.78*(E-w);this.transform.fogCullDistSq=P*P}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(u){u&&!this._terrain&&(this._terrain=new ef(this,this.style)),this._forceTerrainMode=u}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(u,p){if(this.width=u*o.q.devicePixelRatio,this.height=p*o.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const w of this.style.order)this.style._mergedLayers[w].resize()}setup(){const u=this.context,p=new o.a_;p.emplaceBack(0,0),p.emplaceBack(o.ab,0),p.emplaceBack(0,o.ab),p.emplaceBack(o.ab,o.ab),this.tileExtentBuffer=u.createVertexBuffer(p,o.b0.members),this.tileExtentSegments=o.b1.simpleSegment(0,0,4,2);const w=new o.a_;w.emplaceBack(0,0),w.emplaceBack(o.ab,0),w.emplaceBack(0,o.ab),w.emplaceBack(o.ab,o.ab),this.debugBuffer=u.createVertexBuffer(w,o.b0.members),this.debugSegments=o.b1.simpleSegment(0,0,4,5);const E=new o.a_;E.emplaceBack(-1,-1),E.emplaceBack(1,-1),E.emplaceBack(-1,1),E.emplaceBack(1,1),this.viewportBuffer=u.createVertexBuffer(E,o.b0.members),this.viewportSegments=o.b1.simpleSegment(0,0,4,2);const P=new o.aN;P.emplaceBack(0,0,0,0),P.emplaceBack(o.ab,0,o.ab,0),P.emplaceBack(0,o.ab,0,o.ab),P.emplaceBack(o.ab,o.ab,o.ab,o.ab),this.mercatorBoundsBuffer=u.createVertexBuffer(P,o.b3.members),this.mercatorBoundsSegments=o.b1.simpleSegment(0,0,4,2);const F=new o.aO;F.emplaceBack(0,1,2),F.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=u.createIndexBuffer(F);const W=new o.a$;for(const J of[0,1,3,2,0])W.emplaceBack(J);this.debugIndexBuffer=u.createIndexBuffer(W),this.emptyTexture=new o.T(u,new o.r({width:1,height:1},Uint8Array.of(0,0,0,0)),u.gl.RGBA8),this.identityMat=o.a6.mat4.create();const $=this.context.gl;this.stencilClearMode=new pr({func:$.ALWAYS,mask:0},0,255,$.ZERO,$.ZERO,$.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(u){return u._makeTileBoundsBuffers(this.context,this.transform.projection),u._tileBoundsBuffer?{tileBoundsBuffer:u._tileBoundsBuffer,tileBoundsIndexBuffer:u._tileBoundsIndexBuffer,tileBoundsSegments:u._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const u=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,u.TRIANGLES,$n.disabled,this.stencilClearMode,Mr.disabled,_r.disabled,_u(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(u,p,w){if(!p||this.currentStencilSource===p.id||!u.isTileClipped()||!w||w.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let W=!1;for(const $ of w)if(this._tileClippingMaskIDs[$.key]===void 0){W=!0;break}if(!W)return}this.currentStencilSource=p.id;const E=this.context,P=E.gl;this.nextStencilID+w.length>256&&this.clearStencil(),E.setColorMode(Mr.disabled),E.setDepthMode($n.disabled);const F=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const W of w){const $=p.getTile(W),J=this._tileClippingMaskIDs[W.key]=this.nextStencilID++,{tileBoundsBuffer:Q,tileBoundsIndexBuffer:oe,tileBoundsSegments:le}=this.getTileBoundsBuffers($);F.draw(this,P.TRIANGLES,$n.disabled,new pr({func:P.ALWAYS,mask:0},J,255,P.KEEP,P.KEEP,P.REPLACE),Mr.disabled,_r.disabled,_u(W.projMatrix),"$clipping",Q,oe,le)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const u=this.nextStencilID++,p=this.context.gl;return new pr({func:p.NOTEQUAL,mask:255},u,255,p.KEEP,p.KEEP,p.REPLACE)}stencilModeForClipping(u){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(u);const p=this.context.gl;return new pr({func:p.EQUAL,mask:255},this._tileClippingMaskIDs[u.key],0,p.KEEP,p.KEEP,p.REPLACE)}stencilConfigForOverlap(u){const p=this.context.gl,w=u.sort((F,W)=>W.overscaledZ-F.overscaledZ),E=w[w.length-1].overscaledZ,P=w[0].overscaledZ-E+1;if(P>1){this.currentStencilSource=void 0,this.nextStencilID+P>256&&this.clearStencil();const F={};for(let W=0;W<P;W++)F[W+E]=new pr({func:p.GEQUAL,mask:255},W+this.nextStencilID,255,p.KEEP,p.KEEP,p.REPLACE);return this.nextStencilID+=P,[F,w]}return[{[E]:pr.disabled},w]}colorModeForRenderPass(){const u=this.context.gl;return this._showOverdrawInspector?new Mr([u.CONSTANT_COLOR,u.ONE,u.CONSTANT_COLOR,u.ONE],new o.bz(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Mr.unblended:Mr.alphaBlended}colorModeForDrapableLayerRenderPass(u){const p=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Mr([p.ONE,p.ONE_MINUS_SRC_ALPHA,p.CONSTANT_ALPHA,p.ONE_MINUS_SRC_ALPHA],new o.bz(0,0,0,u===void 0?0:u),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(u,p,w,E=!1){if(this.depthOcclusion)return new $n(this.context.gl.GREATER,$n.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!E)return $n.disabled;const P=1-((1+this.currentLayer)*this.numSublayers+u)*this.depthEpsilon;return new $n(w||this.context.gl.LEQUAL,p,[P,P])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const u=this.context.gl,p=Math.ceil(this.width),w=Math.ceil(this.height),E=this.context.bindFramebuffer.get(),P=u.getParameter(u.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===p&&this.depthFBO.height===w||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),p!==0&&w!==0&&(this.depthFBO=new Uc(this.context,p,w,!1,"texture"),this.depthTexture=new o.T(this.context,{width:p,height:w,data:null},u.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(E),u.bindTexture(u.TEXTURE_2D,P),this.depthFBO&&(u.bindFramebuffer(u.READ_FRAMEBUFFER,null),u.bindFramebuffer(u.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),u.blitFramebuffer(0,0,p,w,0,0,p,w,u.DEPTH_BUFFER_BIT,u.NEAREST),u.bindFramebuffer(u.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((u,p)=>u+p/this._fpsHistory.length,0))}render(u,p){const w=o.q.now();this._dt=w-this._timeStamp,this._timeStamp=w,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=u.map.repaint,this.style=u,this.options=p;const E=this.style._mergedLayers,P=this.style.order.filter(st=>{const rt=E[st];return!(rt.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[rt.type]});let F=!1,W=!1;for(const st of P){const rt=E[st];rt.type==="circle"&&(F=!0),rt.type==="symbol"&&(rt.hasInitialOcclusionOpacityProperties?W=!0:F=!0)}const $=P.map(st=>E[st]),J=this.style._mergedSourceCaches;this.imageManager=u.imageManager,this.modelManager=u.modelManager,this.symbolFadeChange=u.placement.symbolFadeChange(o.q.now()),this.imageManager.beginFrame();let Q=0,oe=!1;for(const st in J){const rt=J[st];rt.used&&(rt.prepare(this.context),rt.getSource().usedInConflation&&++Q)}let le=!1;for(const st of $)st.isHidden(this.transform.zoom)||(st.type==="clip"&&(le=!0),this.prepareLayer(st));const ue={},ve={},_e={},be={},we={};for(const st in J){const rt=J[st];ue[st]=rt.getVisibleCoordinates(),ve[st]=ue[st].slice().reverse(),_e[st]=rt.getVisibleCoordinates(!0).reverse(),be[st]=rt.getShadowCasterCoordinates(),we[st]=rt.sortCoordinatesByDistance(ue[st])}const ke=st=>{const rt=this.style.getLayerSourceCache(st);return rt&&rt.used?rt.getSource():null};if(Q||le||this._clippingActiveLastFrame){const st=[],rt=[];let xt=0;for(const Ft of $)this.isSourceForClippingOrConflation(Ft,ke(Ft))&&(st.push(Ft),rt.push(xt)),xt++;if(st&&(le||st.length>1)||this._clippingActiveLastFrame){le=!1;const Ft=[];for(let Zt=0;Zt<st.length;Zt++){const kt=st[Zt],hn=rt[Zt],bt=this.style.getLayerSourceCache(kt);if(!bt||!bt.used||!bt.getSource().usedInConflation&&kt.type!=="clip")continue;let Wt=o.dn,Vt=o.bs.None;const fn=[];let pn=!0;if(kt.type==="clip"){Wt=hn;for(const qt of kt.layout.get("clip-layer-types"))Vt|=qt==="model"?o.bs.Model:qt==="symbol"?o.bs.Symbol:o.bs.FillExtrusion;for(const qt of kt.layout.get("clip-layer-scope"))fn.push(qt);kt.isHidden(this.transform.zoom)?pn=!1:le=!0}pn&&Ft.push({layer:kt.fqid,cache:bt,order:Wt,clipMask:Vt,clipScope:fn})}this.replacementSource.setSources(Ft),oe=!0}}this._clippingActiveLastFrame=le,oe||this.replacementSource.clear(),this.conflationActive=oe,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let st=0;st<$.length;st++){const rt=$[st],xt=rt.cutoffRange();if(this.longestCutoffRange=Math.max(xt,this.longestCutoffRange),xt>0){const Ft=ke(rt);Ft&&(this.minCutoffZoom=Math.max(Ft.minzoom,this.minCutoffZoom)),rt.minzoom&&(this.minCutoffZoom=Math.max(rt.minzoom,this.minCutoffZoom))}rt.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=st),this._lastOcclusionLayer=st)}const Ne=this.style&&this.style.fog;Ne?(this._fogVisible=Ne.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Ne.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(_e),this.opaquePassCutoff=0);const De=this._shadowRenderer;if(De){De.updateShadowParameters(this.transform,this.style.directionalLight);for(const st in J)for(const rt of ue[st]){let xt={min:0,max:0};this.terrain&&(xt=this.terrain.getMinMaxForTile(rt)||xt),De.addShadowReceiver(rt.toUnwrapped(),xt.min,xt.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.dm(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new lf(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!$e.has(this.context.gl))return;this.renderPass="offscreen";for(const st of $){const rt=u.getLayerSourceCache(st);if(!st.hasOffscreenPass()||st.isHidden(this.transform.zoom))continue;const xt=rt?ve[rt.id]:void 0;(st.type==="custom"||st.type==="raster"||st.type==="raster-particle"||st.isSky()||xt&&xt.length)&&this.renderLayer(this,rt,st,xt)}this.depthRangeFor3D=[0,1-($.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,be)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const je=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Ge=(()=>{if(p.showOverdrawInspector)return o.bz.black;const st=this.style.fog;if(st&&this.transform.projection.supportsFog){const rt=this.style.getLut(st.scope);if(!je){const xt=st.properties.get("color").toRenderColor(rt).toArray01();return new o.bz(...xt)}if(je){const xt=st.properties.get("space-color").toRenderColor(rt).toArray01();return new o.bz(...xt)}}return o.bz.transparent})();if(this.context.clear({color:Ge,depth:1}),this.clearStencil(),this._showOverdrawInspector=p.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&je&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=P.length-1;this.currentLayer>=0;this.currentLayer--){const st=$[this.currentLayer],rt=u.getLayerSourceCache(st);if(st.isSky())continue;const xt=rt?(st.is3D()?we:ve)[rt.id]:void 0;this._renderTileClippingMasks(st,rt,xt),this.renderLayer(this,rt,st,xt)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&je&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||o.a9(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<P.length;this.currentLayer++){const st=$[this.currentLayer],rt=u.getLayerSourceCache(st);st.isSky()&&this.renderLayer(this,rt,st,rt?ve[rt.id]:void 0)}function et(st,rt){let xt;return rt&&(xt=(st.type==="symbol"?_e:st.is3D()?we:ve)[rt.id]),xt}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<P.length;){const st=$[this.currentLayer];if(st.type==="raster"||st.type==="raster-particle"){const rt=u.getLayerSourceCache(st);this.renderLayer(this,rt,st,et(st,rt))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Ke=0;De&&(Ke=De.getShadowCastingLayerCount());let tt=!1,ct=-1;for(let st=0;st<P.length;++st){const rt=$[st];rt.isHidden(this.transform.zoom)||rt.is3D()&&(ct=st)}for(W&&ct===-1&&(F=!0);this.currentLayer<P.length;){const st=$[this.currentLayer],rt=u.getLayerSourceCache(st);if(st.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(st)){if(st.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(F&&!tt&&this.terrain&&!this.transform.isOrthographic&&(tt=!0,this.blitDepth()),W&&ct!==-1&&this.currentLayer===ct+1&&!this.transform.isOrthographic&&this.blitDepth(),st.is3D()||this.terrain||this._renderTileClippingMasks(st,rt,rt?ue[rt.id]:void 0),this.renderLayer(this,rt,st,et(st,rt)),!this.terrain&&De&&Ke>0&&st.hasShadowPass()&&--Ke==0&&(De.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const xt=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=xt;this.currentLayer++){const Ft=$[this.currentLayer];if(!Ft.hasLightBeamPass())continue;const Zt=u.getLayerSourceCache(Ft);this.renderLayer(this,Zt,Ft,Zt?ve[Zt.id]:void 0)}this.currentLayer=xt,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const xt=this.currentLayer;this.depthOcclusion=!0;for(const Ft of this.layersWithOcclusionOpacity){this.currentLayer=Ft;const Zt=$[this.currentLayer],kt=u.getLayerSourceCache(Zt),hn=kt?ve[kt.id]:void 0;Zt.is3D()||this.terrain||this._renderTileClippingMasks(Zt,kt,kt?ue[kt.id]:void 0),this.renderLayer(this,kt,Zt,hn)}this.depthOcclusion=!1,this.currentLayer=xt,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let st=null;$.forEach(rt=>{const xt=u.getLayerSourceCache(rt);xt&&!rt.isHidden(this.transform.zoom)&&xt.getVisibleCoordinates().length&&(!st||st.getSource().maxzoom<xt.getSource().maxzoom)&&(st=xt)}),st&&this.options.showTileBoundaries&&Ks.debug(this,st,st.getVisibleCoordinates(),o.bz.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Ks.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new o.bz(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(st){const rt=st.transform.padding;Hi(st,st.transform.height-(rt.top||0),3,Qv),Hi(st,rt.bottom||0,3,Zu),At(st,rt.left||0,3,Yu),At(st,st.transform.width-(rt.right||0),3,gn);const xt=st.transform.centerPoint;(function(Ft,Zt,kt,hn){Ds(Ft,Zt-1,kt-10,2,20,hn),Ds(Ft,Zt-10,kt-1,20,2,hn)})(st,xt.x,st.transform.height-xt.y,Kn)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),oe||(this.conflationActive=!1)}prepareLayer(u){this.gpuTimingStart(u);const{unsupportedLayers:p}=this.transform.projection,w=!p||!p.includes(u.type);if(cc[u.type]&&(w||this.terrain&&u.type==="custom")){const E=this.style.getLayerSourceCache(u);cc[u.type](u,E,this)}this.gpuTimingEnd()}renderLayer(u,p,w,E){w.isHidden(this.transform.zoom)||(w.type==="background"||w.type==="sky"||w.type==="custom"||w.type==="model"||w.type==="raster"||w.type==="raster-particle"||E&&E.length)&&(this.id=w.id,this.gpuTimingStart(w),u.transform.projection.unsupportedLayers&&u.transform.projection.unsupportedLayers.includes(w.type)&&(!u.terrain||w.type!=="custom")||w.type==="clip"||Ks[w.type](u,p,w,E,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(u){if(!this.options.gpuTiming)return;const p=this.context.extTimerQuery,w=this.context.gl;let E=this.gpuTimers[u.id];E||(E=this.gpuTimers[u.id]={calls:0,cpuTime:0,query:w.createQuery()}),E.calls++,w.beginQuery(p.TIME_ELAPSED_EXT,E.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const u=this.context.extTimerQuery,p=this.context.gl,w=p.createQuery();this.deferredRenderGpuTimeQueries.push(w),p.beginQuery(u.TIME_ELAPSED_EXT,w)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const u=this.gpuTimers;return this.gpuTimers={},u}collectDeferredRenderGpuQueries(){const u=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],u}queryGpuTimers(u){const p={};for(const w in u){const E=u[w],P=this.context.extTimerQuery,F=P.getQueryParameter(E.query,this.context.gl.QUERY_RESULT)/1e6;P.deleteQueryEXT(E.query),p[w]=F}return p}queryGpuTimeDeferredRender(u){if(!this.options.gpuTimingDeferredRender)return 0;const p=this.context.extTimerQuery,w=this.context.gl;let E=0;for(const P of u)E+=p.getQueryParameter(P,w.QUERY_RESULT)/1e6,p.deleteQueryEXT(P);return E}translatePosMatrix(u,p,w,E,P){if(!w[0]&&!w[1])return u;const F=P?E==="map"?this.transform.angle:0:E==="viewport"?-this.transform.angle:0;if(F){const J=Math.sin(F),Q=Math.cos(F);w=[w[0]*Q-w[1]*J,w[0]*J+w[1]*Q]}const W=[P?w[0]:o.ak(p,w[0],this.transform.zoom),P?w[1]:o.ak(p,w[1],this.transform.zoom),0],$=new Float32Array(16);return o.a6.mat4.translate($,u,W),$}saveTileTexture(u){const p=u.size[0],w=this._tileTextures[p];w?w.push(u):this._tileTextures[p]=[u]}getTileTexture(u){const p=this._tileTextures[u];return p&&p.length>0?p.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(u,p,w){const E=w===void 0?this.terrain&&this.terrain.renderingToTexture:w,P=[];return this.style&&this.style.enable3dLights()&&(u==="globeRaster"||u==="terrainRaster"?(P.push("LIGHTING_3D_MODE"),P.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):E||P.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||P.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?P.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):P.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(P.push("TERRAIN"),this.linearFloatFilteringSupported()&&P.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&P.push("GLOBE"),!this._fogVisible||E||p!==void 0&&!p||P.push("FOG","FOG_DITHERING"),E&&P.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&P.push("OVERDRAW_INSPECTOR"),P}getOrCreateProgram(u,p){this.cache=this.cache||{};const w=p&&p.defines||[],E=p&&p.config,P=this.currentGlobalDefines(u,p&&p.overrideFog,p&&p.overrideRtt).concat(w),F=xo.cacheKey(Wu[u],u,P,E);return this.cache[F]||(this.cache[F]=new xo(this.context,u,Wu[u],E,Xp[u],P)),this.cache[F]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const u=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(u.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(u,p){if(this.style.enable3dLights()){const w=this.style.directionalLight,E=this.style.ambientLight;if(w&&E){const P=((F,W,$)=>{const J=F.properties.get("direction"),Q=F.properties.get("color").toRenderColor($.getLut(F.scope)).toArray01(),oe=F.properties.get("intensity"),le=W.properties.get("color").toRenderColor($.getLut(W.scope)).toArray01(),ue=W.properties.get("intensity"),ve=[J.x,J.y,J.z],_e=o.cH(le,ue),be=o.cH(Q,oe);return{u_lighting_ambient_color:_e,u_lighting_directional_dir:ve,u_lighting_directional_color:be,u_ground_radiance:qo(ve,be,_e)}})(w,E,this.style);p.setLightsUniformValues(u,P)}}}uploadCommonUniforms(u,p,w,E,P){if(this.uploadCommonLightUniforms(u,p),this.terrain&&this.terrain.renderingToTexture)return;const F=this.style.fog;if(F){const W=F.getOpacity(this.transform.pitch),$=((J,Q,oe,le,ue,ve,_e,be,we,ke,Ne,De)=>{const je=J.transform,Ge=Q.properties.get("color").toRenderColor(J.style.getLut(Q.scope)).toArray01();Ge[3]=le;const et=J.frameCounter/1e3%1,[Ke,tt]=Q.properties.get("vertical-range");return{u_fog_matrix:oe?je.calculateFogTileMatrix(oe):De||J.identityMat,u_fog_range:Q.getFovAdjustedRange(je._fov),u_fog_color:Ge,u_fog_horizon_blend:Q.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Ke,tt),tt],u_fog_temporal_offset:et,u_frustum_tl:ue,u_frustum_tr:ve,u_frustum_br:_e,u_frustum_bl:be,u_globe_pos:we,u_globe_radius:ke,u_viewport:Ne,u_globe_transition:o.a9(je.zoom),u_is_globe:+(je.projection.name==="globe")}})(this,F,w,W,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.q.devicePixelRatio,this.transform.height*o.q.devicePixelRatio],E);p.setFogUniformValues(u,$)}P&&p.setCutoffUniformValues(u,P.uniformValues)}setTileLoadedFlag(u){this.tileLoaded=u}saveCanvasCopy(){const u=this.canvasCopy();u&&(this.frameCopies.push(u),this.tileLoaded=!1)}canvasCopy(){const u=this.context.gl,p=u.createTexture();return u.bindTexture(u.TEXTURE_2D,p),u.copyTexImage2D(u.TEXTURE_2D,0,u.RGBA,0,0,u.drawingBufferWidth,u.drawingBufferHeight,0),p}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const u=this.style&&this.style.fog;return!!u&&u.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const u=this._backgroundTiles,p=this._backgroundTiles={},w=this.transform.coveringTiles({tileSize:512});for(const E of w)p[E.key]=u[E.key]||new Bc(E,512,this.transform.tileZoom,this);return p}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(u,p){return!(!u.is3D()||u.type!=="clip"&&(u.minzoom&&u.minzoom>this.transform.zoom||(this.style._clipLayerPresent||u.sourceLayer!=="building")&&(!p||p.type!=="batched-model")))}isTileAffectedByFog(u){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let p=this._cachedTileFogOpacities[u.key];return p||(this._cachedTileFogOpacities[u.key]=p=this.style.fog.getOpacityForTile(u)),p[0]>=Mn||p[1]>=Mn}setupDepthForOcclusion(u,p,w){const E=this.context,P=E.gl,F=!!w;var W;w||(w={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),E.activeTexture.set(P.TEXTURE3),u&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(P.NEAREST,P.CLAMP_TO_EDGE),w.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],w.u_depth_range_unpack=[2/((W=this.depthRangeFor3D)[1]-W[0]),-1-2*W[0]/(W[1]-W[0])],w.u_occluder_half_size=.5*this.occlusionParams.occluderSize,w.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(P.NEAREST,P.CLAMP_TO_EDGE),E.activeTexture.set(P.TEXTURE0),F||p.setTerrainUniformValues(E,w)}}function Il(b,u){let p=!1,w=null;const E=()=>{w=null,p&&(b(),w=setTimeout(E,u),p=!1)};return()=>(p=!0,w||E(),w)}class lo{constructor(u){this._hashName=u&&encodeURIComponent(u),o.aJ(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Il(this._updateHashUnthrottled.bind(this),300)}addTo(u){return this._map=u,window.addEventListener("hashchange",this._onHashChange,!1),u.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const u=this._map;if(!u)return"";const p=Vc(u);if(this._hashName){const w=this._hashName;let E=!1;const P=location.hash.slice(1).split("&").map(F=>{const W=F.split("=")[0];return W===w?(E=!0,`${W}=${p}`):F}).filter(F=>F);return E||P.push(`${w}=${p}`),`#${P.join("&")}`}return`#${p}`}_getCurrentHash(){const u=location.hash.replace("#","");if(this._hashName){let p;return u.split("&").map(w=>w.split("=")).forEach(w=>{w[0]===this._hashName&&(p=w)}),(p&&p[1]||"").split("/")}return u.split("/")}_onHashChange(){const u=this._map;if(!u)return!1;const p=this._getCurrentHash();if(p.length>=3&&!p.some(w=>isNaN(w))){const w=u.dragRotate.isEnabled()&&u.touchZoomRotate.isEnabled()?+(p[3]||0):u.getBearing();return u.jumpTo({center:[+p[2],+p[1]],zoom:+p[0],bearing:w,pitch:+(p[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Vc(b,u){const p=b.getCenter(),w=Math.round(100*b.getZoom())/100,E=Math.ceil((w*Math.LN2+Math.log(512/360/.5))/Math.LN10),P=Math.pow(10,E),F=Math.round(p.lng*P)/P,W=Math.round(p.lat*P)/P,$=b.getBearing(),J=b.getPitch();let Q=u?`/${F}/${W}/${w}`:`${w}/${W}/${F}`;return($||J)&&(Q+="/"+Math.round(10*$)/10),J&&(Q+=`/${Math.round(J)}`),Q}const xu={linearity:.3,easing:o.dp(0,0,.3,1)},Ed=o.l({deceleration:2500,maxSpeed:1400},xu),t_=o.l({deceleration:20,maxSpeed:1400},xu),Gc=o.l({deceleration:1e3,maxSpeed:360},xu),Fg=o.l({deceleration:1e3,maxSpeed:90},xu);class bu{constructor(u){this._map=u,this.clear()}clear(){this._inertiaBuffer=[]}record(u){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.q.now(),settings:u})}_drainInertiaBuffer(){const u=this._inertiaBuffer,p=o.q.now();for(;u.length>0&&p-u[0].time>160;)u.shift()}_onMoveEnd(u){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const p={zoom:0,bearing:0,pitch:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:P}of this._inertiaBuffer)p.zoom+=P.zoomDelta||0,p.bearing+=P.bearingDelta||0,p.pitch+=P.pitchDelta||0,P.panDelta&&p.pan._add(P.panDelta),P.around&&(p.around=P.around),P.pinchAround&&(p.pinchAround=P.pinchAround);const w=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,E={};if(p.pan.mag()){const P=fl(p.pan.mag(),w,o.l({},Ed,u||{}));E.offset=p.pan.mult(P.amount/p.pan.mag()),E.center=this._map.transform.center,Qu(E,P)}if(p.zoom){const P=fl(p.zoom,w,t_);E.zoom=this._map.transform.zoom+P.amount,Qu(E,P)}if(p.bearing){const P=fl(p.bearing,w,Gc);E.bearing=this._map.transform.bearing+o.ap(P.amount,-179,179),Qu(E,P)}if(p.pitch){const P=fl(p.pitch,w,Fg);E.pitch=this._map.transform.pitch+P.amount,Qu(E,P)}if(E.zoom||E.bearing){const P=p.pinchAround===void 0?p.around:p.pinchAround;E.around=P?this._map.unproject(P):this._map.getCenter()}return this.clear(),E.noMoveStart=!0,E}}function Qu(b,u){(!b.duration||b.duration<u.duration)&&(b.duration=u.duration,b.easing=u.easing)}function fl(b,u,p){const{maxSpeed:w,linearity:E,deceleration:P}=p,F=o.ap(b*E/(u/1e3),-w,w),W=Math.abs(F)/(P*E);return{easing:p.easing,duration:1e3*W,amount:F*(W/2)}}class ya extends o.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(u,p,w,E={}){const P=se(p.getCanvasContainer(),w),F=p.unproject(P);super(u,o.l({point:P,lngLat:F,originalEvent:w},E)),this._defaultPrevented=!1,this.target=p}}class ff extends o.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(u,p,w){const E=u==="touchend"?w.changedTouches:w.touches,P=ae(p.getCanvasContainer(),E),F=P.map($=>p.unproject($)),W=P.reduce(($,J,Q,oe)=>$.add(J.div(oe.length)),new o.P(0,0));super(u,{points:P,point:W,lngLats:F,lngLat:p.unproject(W),originalEvent:w}),this._defaultPrevented=!1}}class bo extends o.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(u,p){super("wheel",{originalEvent:p}),this._defaultPrevented=!1}}class Id{constructor(u,p){this._map=u,this._clickTolerance=p.clickTolerance}reset(){this._mousedownPos=void 0}wheel(u){return this._firePreventable(new bo(this._map,u))}mousedown(u,p){return this._mousedownPos=p,this._firePreventable(new ya(u.type,this._map,u))}mouseup(u){this._map.fire(new ya(u.type,this._map,u))}preclick(u){const p=o.l({},u);p.type="preclick",this._map.fire(new ya(p.type,this._map,p))}click(u,p){this._mousedownPos&&this._mousedownPos.dist(p)>=this._clickTolerance||(this.preclick(u),this._map.fire(new ya(u.type,this._map,u)))}dblclick(u){return this._firePreventable(new ya(u.type,this._map,u))}mouseover(u){this._map.fire(new ya(u.type,this._map,u))}mouseout(u){this._map.fire(new ya(u.type,this._map,u))}touchstart(u){return this._firePreventable(new ff(u.type,this._map,u))}touchmove(u){this._map.fire(new ff(u.type,this._map,u))}touchend(u){this._map.fire(new ff(u.type,this._map,u))}touchcancel(u){this._map.fire(new ff(u.type,this._map,u))}_firePreventable(u){if(this._map.fire(u),u.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class n_{constructor(u){this._map=u}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(u){this._map.fire(new ya(u.type,this._map,u))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ya("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(u){this._delayContextMenu?this._contextMenuEvent=u:this._map.fire(new ya(u.type,this._map,u)),this._map.listens("contextmenu")&&u.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Rd{constructor(u,p){this._map=u,this._el=u.getCanvasContainer(),this._container=u.getContainer(),this._clickTolerance=p.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(u,p){this.isEnabled()&&u.shiftKey&&u.button===0&&(q(),this._startPos=this._lastPos=p,this._active=!0)}mousemoveWindow(u,p){if(!this._active)return;const w=p,E=this._startPos,P=this._lastPos;if(!E||!P||P.equals(w)||!this._box&&w.dist(E)<this._clickTolerance)return;this._lastPos=w,this._box||(this._box=C("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",u));const F=Math.min(E.x,w.x),W=Math.max(E.x,w.x),$=Math.min(E.y,w.y),J=Math.max(E.y,w.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${F}px,${$}px)`,this._box.style.width=W-F+"px",this._box.style.height=J-$+"px")})}mouseupWindow(u,p){if(!this._active)return;const w=this._startPos,E=p;if(w&&u.button===0){if(this.reset(),ie(),w.x!==E.x||w.y!==E.y)return this._map.fire(new o.x("boxzoomend",{originalEvent:u})),{cameraAnimation:P=>P.fitScreenCoordinates(w,E,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",u)}}keydown(u){this._active&&u.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",u))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Z(),delete this._startPos,delete this._lastPos}_fireEvent(u,p){return this._map.fire(new o.x(u,{originalEvent:p}))}}function Hc(b,u){const p={};for(let w=0;w<b.length;w++)p[b[w].identifier]=u[w];return p}class Ng{constructor(u){this.reset(),this.numTouches=u.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(u,p,w){(this.centroid||w.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=u.timeStamp),w.length===this.numTouches&&(this.centroid=function(E){const P=new o.P(0,0);for(const F of E)P._add(F);return P.div(E.length)}(p),this.touches=Hc(w,p)))}touchmove(u,p,w){if(this.aborted||!this.centroid)return;const E=Hc(w,p);for(const P in this.touches){const F=E[P];(!F||F.dist(this.touches[P])>30)&&(this.aborted=!0)}}touchend(u,p,w){if((!this.centroid||u.timeStamp-this.startTime>500)&&(this.aborted=!0),w.length===0){const E=!this.aborted&&this.centroid;if(this.reset(),E)return E}}}class uc{constructor(u){this.singleTap=new Ng(u),this.numTaps=u.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(u,p,w){this.singleTap.touchstart(u,p,w)}touchmove(u,p,w){this.singleTap.touchmove(u,p,w)}touchend(u,p,w){const E=this.singleTap.touchend(u,p,w);if(E){const P=u.timeStamp-this.lastTime<500,F=!this.lastTap||this.lastTap.dist(E)<30;if(P&&F||this.reset(),this.count++,this.lastTime=u.timeStamp,this.lastTap=E,this.count===this.numTaps)return this.reset(),E}}}class r_{constructor(){this._zoomIn=new uc({numTouches:1,numTaps:2}),this._zoomOut=new uc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(u,p,w){this._zoomIn.touchstart(u,p,w),this._zoomOut.touchstart(u,p,w)}touchmove(u,p,w){this._zoomIn.touchmove(u,p,w),this._zoomOut.touchmove(u,p,w)}touchend(u,p,w){const E=this._zoomIn.touchend(u,p,w),P=this._zoomOut.touchend(u,p,w);return E?(this._active=!0,u.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:F=>F.easeTo({duration:300,zoom:F.getZoom()+1,around:F.unproject(E)},{originalEvent:u})}):P?(this._active=!0,u.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:F=>F.easeTo({duration:300,zoom:F.getZoom()-1,around:F.unproject(P)},{originalEvent:u})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const hc={0:1,2:2};class Pd{constructor(u){this.reset(),this._clickTolerance=u.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(u,p){return!1}_move(u,p){return{}}mousedown(u,p){if(this._lastPoint)return;const w=fe(u);this._correctButton(u,w)&&(this._lastPoint=p,this._eventButton=w)}mousemoveWindow(u,p){const w=this._lastPoint;if(w){if(u.preventDefault(),this._eventButton!=null&&function(E,P){const F=hc[P];return E.buttons===void 0||(E.buttons&F)!==F}(u,this._eventButton))this.reset();else if(this._moved||!(p.dist(w)<this._clickTolerance))return this._moved=!0,this._lastPoint=p,this._move(w,p)}}mouseupWindow(u){this._lastPoint&&fe(u)===this._eventButton&&(this._moved&&ie(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class la extends Pd{mousedown(u,p){super.mousedown(u,p),this._lastPoint&&(this._active=!0)}_correctButton(u,p){return p===0&&!u.ctrlKey}_move(u,p){return{around:p,panDelta:p.sub(u)}}}class zg extends Pd{_correctButton(u,p){return p===0&&u.ctrlKey||p===2}_move(u,p){const w=.8*(p.x-u.x);if(w)return this._active=!0,{bearingDelta:w}}contextmenu(u){u.preventDefault()}}class Jp extends Pd{_correctButton(u,p){return p===0&&u.ctrlKey||p===2}_move(u,p){const w=-.5*(p.y-u.y);if(w)return this._active=!0,{pitchDelta:w}}contextmenu(u){u.preventDefault()}}class Lx{constructor(u,p){this._map=u,this._el=u.getCanvasContainer(),this._minTouches=1,this._clickTolerance=p.clickTolerance||1,this.reset(),o.aJ(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}touchstart(u,p,w){return this._calculateTransform(u,p,w)}touchmove(u,p,w){if(this._active&&!(w.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(w.length===1&&!o.dq())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return u.cancelable&&u.preventDefault(),this._calculateTransform(u,p,w)}}touchend(u,p,w){this._calculateTransform(u,p,w),this._active&&w.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(u,p,w){w.length>0&&(this._active=!0);const E=Hc(w,p),P=new o.P(0,0),F=new o.P(0,0);let W=0;for(const J in E){const Q=E[J],oe=this._touches[J];oe&&(P._add(Q),F._add(Q.sub(oe)),W++,E[J]=Q)}if(this._touches=E,W<this._minTouches||!F.mag())return;const $=F.div(W);return this._sum._add($),this._sum.mag()<this._clickTolerance?void 0:{around:P.div(W),panDelta:$}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=C("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Ug{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(u){}_move(u,p,w){return{}}touchstart(u,p,w){this._firstTwoTouches||w.length<2||(this._firstTwoTouches=[w[0].identifier,w[1].identifier],this._start([p[0],p[1]]))}touchmove(u,p,w){const E=this._firstTwoTouches;if(!E)return;u.preventDefault();const[P,F]=E,W=Ld(w,p,P),$=Ld(w,p,F);if(!W||!$)return;const J=this._aroundCenter?null:W.add($).div(2);return this._move([W,$],J,u)}touchend(u,p,w){if(!this._firstTwoTouches)return;const[E,P]=this._firstTwoTouches,F=Ld(w,p,E),W=Ld(w,p,P);F&&W||(this._active&&ie(),this.reset())}touchcancel(){this.reset()}enable(u){this._enabled=!0,this._aroundCenter=!!u&&u.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ld(b,u,p){for(let w=0;w<b.length;w++)if(b[w].identifier===p)return u[w]}function Vg(b,u){return Math.log(b/u)/Math.LN2}class Dx extends Ug{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(u){this._startDistance=this._distance=u[0].dist(u[1])}_move(u,p){const w=this._distance;if(this._distance=u[0].dist(u[1]),this._active||!(Math.abs(Vg(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Vg(this._distance,w),pinchAround:p}}}function Qa(b,u){return 180*b.angleWith(u)/Math.PI}class Gg extends Ug{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(u){this._startVector=this._vector=u[0].sub(u[1]),this._minDiameter=u[0].dist(u[1])}_move(u,p){const w=this._vector;if(this._vector=u[0].sub(u[1]),w&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Qa(this._vector,w),pinchAround:p}}_isBelowThreshold(u){this._minDiameter=Math.min(this._minDiameter,u.mag());const p=25/(Math.PI*this._minDiameter)*360,w=this._startVector;if(!w)return!1;const E=Qa(u,w);return Math.abs(E)<p}}function Hg(b){return Math.abs(b.y)>Math.abs(b.x)}class wu extends Ug{constructor(u){super(),this._map=u}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(u){this._lastPoints=u,Hg(u[0].sub(u[1]))&&(this._valid=!1)}_move(u,p,w){const E=this._lastPoints;if(!E)return;const P=u[0].sub(E[0]),F=u[1].sub(E[1]);return this._map._cooperativeGestures&&!o.dq()&&w.touches.length<3||(this._valid=this.gestureBeginsVertically(P,F,w.timeStamp),!this._valid)?void 0:(this._lastPoints=u,this._active=!0,{pitchDelta:(P.y+F.y)/2*-.5})}gestureBeginsVertically(u,p,w){if(this._valid!==void 0)return this._valid;const E=u.mag()>=2,P=p.mag()>=2;if(!E&&!P)return;if(!E||!P)return this._firstMove==null&&(this._firstMove=w),w-this._firstMove<100&&void 0;const F=u.y>0==p.y>0;return Hg(u)&&Hg(p)&&F}}const Qp={panStep:100,bearingStep:15,pitchStep:10};class eh{constructor(){const u=Qp;this._panStep=u.panStep,this._bearingStep=u.bearingStep,this._pitchStep=u.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(u){if(u.altKey||u.ctrlKey||u.metaKey)return;let p=0,w=0,E=0,P=0,F=0;switch(u.keyCode){case 61:case 107:case 171:case 187:p=1;break;case 189:case 109:case 173:p=-1;break;case 37:u.shiftKey?w=-1:(u.preventDefault(),P=-1);break;case 39:u.shiftKey?w=1:(u.preventDefault(),P=1);break;case 38:u.shiftKey?E=1:(u.preventDefault(),F=-1);break;case 40:u.shiftKey?E=-1:(u.preventDefault(),F=1);break;default:return}return this._rotationDisabled&&(w=0,E=0),{cameraAnimation:W=>{const $=W.getZoom();W.easeTo({duration:300,easeId:"keyboardHandler",easing:em,zoom:p?Math.round($)+p*(u.shiftKey?2:1):$,bearing:W.getBearing()+w*this._bearingStep,pitch:W.getPitch()+E*this._pitchStep,offset:[-P*this._panStep,-F*this._panStep],center:W.getCenter()},{originalEvent:u})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function em(b){return b*(2-b)}const tm=4.000244140625,i_=1/450;class Iw{constructor(u,p){this._map=u,this._el=u.getCanvasContainer(),this._handler=p,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=i_,o.aJ(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(u){this._defaultZoomRate=u}setWheelZoomRate(u){this._wheelZoomRate=u}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(u){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!u&&u.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(u){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(u.ctrlKey||u.metaKey||this.isZooming()||o.dq()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let p=u.deltaMode===WheelEvent.DOM_DELTA_LINE?40*u.deltaY:u.deltaY;const w=o.q.now(),E=w-(this._lastWheelEventTime||0);this._lastWheelEventTime=w,p!==0&&p%tm==0?this._type="wheel":p!==0&&Math.abs(p)<4?this._type="trackpad":E>400?(this._type=null,this._lastValue=p,this._timeout=window.setTimeout(this._onTimeout,40,u)):this._type||(this._type=Math.abs(E*p)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,p+=this._lastValue)),u.shiftKey&&p&&(p/=4),this._type&&(this._lastWheelEvent=u,this._delta-=p,this._active||this._start(u)),u.preventDefault()}_onTimeout(u){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(u)}_start(u){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const p=se(this._el,u);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:p,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const u=this._map.transform;this._type==="wheel"&&u.projection.wrap&&(u._center.lng>=180||u._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const p=()=>u._terrainEnabled()&&this._aroundCoord?u.computeZoomRelativeTo(this._aroundCoord):u.zoom;if(this._delta!==0){const J=this._type==="wheel"&&Math.abs(this._delta)>tm?this._wheelZoomRate:this._defaultZoomRate;let Q=2/(1+Math.exp(-Math.abs(this._delta*J)));this._delta<0&&Q!==0&&(Q=1/Q);const oe=p(),le=Math.pow(2,oe),ue=typeof this._targetZoom=="number"?u.zoomScale(this._targetZoom):le;this._targetZoom=Math.min(u.maxZoom,Math.max(u.minZoom,u.scaleZoom(ue*Q))),this._type==="wheel"&&(this._startZoom=oe,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const w=typeof this._targetZoom=="number"?this._targetZoom:p(),E=this._startZoom,P=this._easing;let F,W=!1;if(this._type==="wheel"&&E&&P){const J=Math.min((o.q.now()-this._lastWheelEventTime)/200,1),Q=P(J);F=o.aa(E,w,Q),J<1?this._frameId||(this._frameId=!0):W=!0}else F=w,W=!0;this._active=!0,W&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let $=F-p();return $*this._lastDelta<0&&($=0),{noInertia:!0,needsRenderFrame:!W,zoomDelta:$,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(u){let p=o.dr;if(this._prevEase){const w=this._prevEase,E=(o.q.now()-w.start)/w.duration,P=w.easing(E+.01)-w.easing(E),F=.27/Math.sqrt(P*P+1e-4)*.01,W=Math.sqrt(.0729-F*F);p=o.dp(F,W,.25,1)}return this._prevEase={start:o.q.now(),duration:u,easing:p},p}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=C("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class xs{constructor(u,p){this._clickZoom=u,this._tapZoom=p}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class s_{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(u,p){return u.preventDefault(),{cameraAnimation:w=>{w.easeTo({duration:300,zoom:w.getZoom()+(u.shiftKey?-1:1),around:w.unproject(p)},{originalEvent:u})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Bx{constructor(){this._tap=new uc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(u,p,w){this._swipePoint||(this._tapTime&&u.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?w.length>0&&(this._swipePoint=p[0],this._swipeTouch=w[0].identifier):this._tap.touchstart(u,p,w))}touchmove(u,p,w){if(this._tapTime){if(this._swipePoint){if(w[0].identifier!==this._swipeTouch)return;const E=p[0],P=E.y-this._swipePoint.y;return this._swipePoint=E,u.preventDefault(),this._active=!0,{zoomDelta:P/128}}}else this._tap.touchmove(u,p,w)}touchend(u,p,w){this._tapTime?this._swipePoint&&w.length===0&&this.reset():this._tap.touchend(u,p,w)&&(this._tapTime=u.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class kx{constructor(u,p,w){this._el=u,this._mousePan=p,this._touchPan=w}enable(u){this._inertiaOptions=u||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class df{constructor(u,p,w){this._pitchWithRotate=u.pitchWithRotate,this._mouseRotate=p,this._mousePitch=w}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ox{constructor(u,p,w,E){this._el=u,this._touchZoom=p,this._touchRotate=w,this._tapDragZoom=E,this._rotationDisabled=!1,this._enabled=!0}enable(u){this._touchZoom.enable(u),this._rotationDisabled||this._touchRotate.enable(u),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Dd=b=>b.zoom||b.drag||b.pitch||b.rotate;class L extends o.x{}class O{constructor(){this.constants=[1,1,.01],this.radius=0}setup(u,p){const w=o.a6.vec3.sub([],p,u);this.radius=o.a6.vec3.length(w[2]<0?o.a6.vec3.div([],w,this.constants):[w[0],w[1],0])}projectRay(u){o.a6.vec3.div(u,u,this.constants),o.a6.vec3.normalize(u,u),o.a6.vec3.mul(u,u,this.constants);const p=o.a6.vec3.scale([],u,this.radius);if(p[2]>0){const w=o.a6.vec3.scale([],[0,0,1],o.a6.vec3.dot(p,[0,0,1])),E=o.a6.vec3.scale([],o.a6.vec3.normalize([],[p[0],p[1],0]),this.radius),P=o.a6.vec3.add([],p,o.a6.vec3.scale([],o.a6.vec3.sub([],o.a6.vec3.add([],E,w),p),2));p[0]=P[0],p[1]=P[1]}return p}}function Y(b){return b.panDelta&&b.panDelta.mag()||b.zoomDelta||b.bearingDelta||b.pitchDelta}class re{constructor(u,p){this._map=u,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new bu(u),this._bearingSnap=p.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new O,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(p),o.aJ(["handleEvent","handleWindowEvent"],this);const w=this._el;this._listeners=[[w,"touchstart",{passive:!0}],[w,"touchmove",{passive:!1}],[w,"touchend",void 0],[w,"touchcancel",void 0],[w,"mousedown",void 0],[w,"mousemove",void 0],[w,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[w,"mouseover",void 0],[w,"mouseout",void 0],[w,"dblclick",void 0],[w,"click",void 0],[w,"keydown",{capture:!1}],[w,"keyup",void 0],[w,"wheel",{passive:!1}],[w,"contextmenu",void 0],[window,"blur",void 0]];for(const[E,P,F]of this._listeners){const W=E===document?this.handleWindowEvent:this.handleEvent;E.addEventListener(P,W,F)}}destroy(){for(const[u,p,w]of this._listeners){const E=u===document?this.handleWindowEvent:this.handleEvent;u.removeEventListener(p,E,w)}}_addDefaultHandlers(u){const p=this._map,w=p.getCanvasContainer();this._add("mapEvent",new Id(p,u));const E=p.boxZoom=new Rd(p,u);this._add("boxZoom",E);const P=new r_,F=new s_;p.doubleClickZoom=new xs(F,P),this._add("tapZoom",P),this._add("clickZoom",F);const W=new Bx;this._add("tapDragZoom",W);const $=p.touchPitch=new wu(p);this._add("touchPitch",$);const J=new zg(u),Q=new Jp(u);p.dragRotate=new df(u,J,Q),this._add("mouseRotate",J,["mousePitch"]),this._add("mousePitch",Q,["mouseRotate"]);const oe=new la(u),le=new Lx(p,u);p.dragPan=new kx(w,oe,le),this._add("mousePan",oe),this._add("touchPan",le,["touchZoom","touchRotate"]);const ue=new Gg,ve=new Dx;p.touchZoomRotate=new Ox(w,ve,ue,W),this._add("touchRotate",ue,["touchPan","touchZoom"]),this._add("touchZoom",ve,["touchPan","touchRotate"]),this._add("blockableMapEvent",new n_(p));const _e=p.scrollZoom=new Iw(p,this);this._add("scrollZoom",_e,["mousePan"]);const be=p.keyboard=new eh;this._add("keyboard",be);for(const we of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])u.interactive&&u[we]&&p[we].enable(u[we])}_add(u,p,w){this._handlers.push({handlerName:u,handler:p,allowed:w}),this._handlersById[u]=p}stop(u){if(!this._updatingCamera){for(const{handler:p}of this._handlers)p.reset();this._inertia.clear(),this._fireEvents({},{},u),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:u}of this._handlers)if(u.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Dd(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(u,p,w){for(const E in u)if(E!==w&&(!p||p.indexOf(E)<0))return!0;return!1}handleWindowEvent(u){this.handleEvent(u,`${u.type}Window`)}_getMapTouches(u){const p=[];for(const w of u)this._el.contains(w.target)&&p.push(w);return p}handleEvent(u,p){this._updatingCamera=!0;const w=u.type==="renderFrame",E=w?void 0:u,P={needsRenderFrame:!1},F={},W={},$=u.touches?this._getMapTouches(u.touches):void 0,J=$?ae(this._el,$):w?void 0:se(this._el,u);for(const{handlerName:le,handler:ue,allowed:ve}of this._handlers){if(!ue.isEnabled())continue;let _e;this._blockedByActive(W,ve,le)?ue.reset():ue[p||u.type]&&(_e=ue[p||u.type](u,J,$),this.mergeHandlerResult(P,F,_e,le,E),_e&&_e.needsRenderFrame&&this._triggerRenderFrame()),(_e||ue.isActive())&&(W[le]=ue)}const Q={};for(const le in this._previousActiveHandlers)W[le]||(Q[le]=E);this._previousActiveHandlers=W,(Object.keys(Q).length||Y(P))&&(this._changes.push([P,F,Q]),this._triggerRenderFrame()),(Object.keys(W).length||Y(P))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:oe}=P;oe&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],oe(this._map))}mergeHandlerResult(u,p,w,E,P){if(!w)return;o.l(u,w);const F={handlerName:E,originalEvent:w.originalEvent||P};w.zoomDelta!==void 0&&(p.zoom=F),w.panDelta!==void 0&&(p.drag=F),w.pitchDelta!==void 0&&(p.pitch=F),w.bearingDelta!==void 0&&(p.rotate=F)}_applyChanges(){const u={},p={},w={};for(const[E,P,F]of this._changes)E.panDelta&&(u.panDelta=(u.panDelta||new o.P(0,0))._add(E.panDelta)),E.zoomDelta&&(u.zoomDelta=(u.zoomDelta||0)+E.zoomDelta),E.bearingDelta&&(u.bearingDelta=(u.bearingDelta||0)+E.bearingDelta),E.pitchDelta&&(u.pitchDelta=(u.pitchDelta||0)+E.pitchDelta),E.around!==void 0&&(u.around=E.around),E.aroundCoord!==void 0&&(u.aroundCoord=E.aroundCoord),E.pinchAround!==void 0&&(u.pinchAround=E.pinchAround),E.noInertia&&(u.noInertia=E.noInertia),o.l(p,P),o.l(w,F);this._updateMapTransform(u,p,w),this._changes=[]}_updateMapTransform(u,p,w){const E=this._map,P=E.transform,F=ke=>[ke.x,ke.y,ke.z];if((ke=>{const Ne=this._eventsInProgress.drag;return Ne&&!this._handlersById[Ne.handlerName].isActive()})()&&!Y(u)){const ke=P.zoom;P.cameraElevationReference="sea",this._originalZoom!=null&&P._orthographicProjectionAtLowPitch&&P.projection.name!=="globe"&&P.pitch===0?(P.cameraElevationReference="ground",P.zoom=this._originalZoom):(P.recenterOnTerrain(),P.cameraElevationReference="ground"),ke!==P.zoom&&this._map._update(!0)}if(P._isCameraConstrained&&E._stop(!0),!Y(u))return void this._fireEvents(p,w,!0);let{panDelta:W,zoomDelta:$,bearingDelta:J,pitchDelta:Q,around:oe,aroundCoord:le,pinchAround:ue}=u;P._isCameraConstrained&&($>0&&($=0),P._isCameraConstrained=!1),ue!==void 0&&(oe=ue),($||(ke=>p[ke]&&!this._eventsInProgress[ke])("drag"))&&oe&&(this._dragOrigin=F(P.pointCoordinate3D(oe)),this._originalZoom=P.zoom,this._trackingEllipsoid.setup(P._camera.position,this._dragOrigin)),P.cameraElevationReference="sea",E._stop(!0),oe=oe||E.transform.centerPoint,J&&(P.bearing+=J),Q&&(P.pitch+=Q),P._updateCameraState();const ve=[0,0,0];if(W)if(P.projection.name==="mercator"){const ke=this._trackingEllipsoid.projectRay(P.screenPointToMercatorRay(oe).dir),Ne=this._trackingEllipsoid.projectRay(P.screenPointToMercatorRay(oe.sub(W)).dir);ve[0]=Ne[0]-ke[0],ve[1]=Ne[1]-ke[1]}else{const ke=P.pointCoordinate(oe);if(P.projection.name==="globe"){W=W.rotate(-P.angle);const Ne=P._pixelsPerMercatorPixel/P.worldSize;ve[0]=-W.x*o.ds(o.aM(ke.y))*Ne,ve[1]=-W.y*o.ds(P.center.lat)*Ne}else{const Ne=P.pointCoordinate(oe.sub(W));ke&&Ne&&(ve[0]=Ne.x-ke.x,ve[1]=Ne.y-ke.y)}}const _e=P.zoom,be=[0,0,0];if($){const ke=F(le||P.pointCoordinate3D(oe)),Ne={dir:o.a6.vec3.normalize([],o.a6.vec3.sub([],ke,P._camera.position))};if(Ne.dir[2]<0){const De=P.zoomDeltaToMovement(ke,$);o.a6.vec3.scale(be,Ne.dir,De)}}const we=o.a6.vec3.add(ve,ve,be);P._translateCameraConstrained(we),$&&Math.abs(P.zoom-_e)>1e-4&&P.recenterOnTerrain(),P.cameraElevationReference="ground",this._map._update(),u.noInertia||this._inertia.record(u),this._fireEvents(p,w,!0)}_fireEvents(u,p,w){const E=Dd(this._eventsInProgress),P=Dd(u),F={};for(const Q in u){const{originalEvent:oe}=u[Q];this._eventsInProgress[Q]||(F[`${Q}start`]=oe),this._eventsInProgress[Q]=u[Q]}!E&&P&&this._fireEvent("movestart",P.originalEvent);for(const Q in F)this._fireEvent(Q,F[Q]);P&&this._fireEvent("move",P.originalEvent);for(const Q in u){const{originalEvent:oe}=u[Q];this._fireEvent(Q,oe)}const W={};let $;for(const Q in this._eventsInProgress){const{handlerName:oe,originalEvent:le}=this._eventsInProgress[Q];this._handlersById[oe].isActive()||(delete this._eventsInProgress[Q],$=p[oe]||le,W[`${Q}end`]=$)}for(const Q in W)this._fireEvent(Q,W[Q]);const J=Dd(this._eventsInProgress);if(w&&(E||P)&&!J){this._updatingCamera=!0;const Q=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),oe=le=>le!==0&&-this._bearingSnap<le&&le<this._bearingSnap;Q?(oe(Q.bearing||this._map.getBearing())&&(Q.bearing=0),this._map.easeTo(Q,{originalEvent:$})):(this._map.fire(new o.x("moveend",{originalEvent:$})),oe(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(u,p){this._map.fire(new o.x(u,p?{originalEvent:p}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(u=>{this._frameId=void 0,this.handleEvent(new L("renderFrame",{timeStamp:u})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const pe="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Te extends o.E{constructor(u,p){super(),this._moving=!1,this._zooming=!1,this.transform=u,this._bearingSnap=p.bearingSnap,this._respectPrefersReducedMotion=p.respectPrefersReducedMotion!==!1,o.aJ(["_renderFrameCallback"],this)}getCenter(){return new o.bK(this.transform.center.lng,this.transform.center.lat)}setCenter(u,p){return this.jumpTo({center:u},p)}panBy(u,p,w){return u=o.P.convert(u).mult(-1),this.panTo(this.transform.center,o.l({offset:u},p),w)}panTo(u,p,w){return this.easeTo(o.l({center:u},p),w)}getZoom(){return this.transform.zoom}setZoom(u,p){return this.jumpTo({zoom:u},p),this}zoomTo(u,p,w){return this.easeTo(o.l({zoom:u},p),w)}zoomIn(u,p){return this.zoomTo(this.getZoom()+1,u,p),this}zoomOut(u,p){return this.zoomTo(this.getZoom()-1,u,p),this}getBearing(){return this.transform.bearing}setBearing(u,p){return this.jumpTo({bearing:u},p),this}getPadding(){return this.transform.padding}setPadding(u,p){return this.jumpTo({padding:u},p),this}rotateTo(u,p,w){return this.easeTo(o.l({bearing:u},p),w)}resetNorth(u,p){return this.rotateTo(0,o.l({duration:1e3},u),p),this}resetNorthPitch(u,p){return this.easeTo(o.l({bearing:0,pitch:0,duration:1e3},u),p),this}snapToNorth(u,p){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(u,p):this}getPitch(){return this.transform.pitch}setPitch(u,p){return this.jumpTo({pitch:u},p),this}cameraForBounds(u,p){u=o.as.convert(u);const w=p&&p.bearing||0,E=p&&p.pitch||0,P=u.getNorthWest(),F=u.getSouthEast();return this._cameraForBounds(this.transform,P,F,w,E,p)}_extendPadding(u){const p={top:0,right:0,bottom:0,left:0};return u==null?o.l({},p,this.transform.padding):typeof u=="number"?{top:u,bottom:u,right:u,left:u}:o.l({},p,u)}_extendCameraOptions(u){return(u=o.l({offset:[0,0],maxZoom:this.transform.maxZoom},u)).padding=this._extendPadding(u.padding),u}_minimumAABBFrustumDistance(u,p){const w=p.max[0]-p.min[0],E=p.max[1]-p.min[1];return w/E>u.aspect?w/(2*Math.tan(.5*u.fovX)*u.aspect):E/(2*Math.tan(.5*u.fovY)*u.aspect)}_cameraForBoundsOnGlobe(u,p,w,E,P,F){const W=u.clone(),$=this._extendCameraOptions(F);W.bearing=E,W.pitch=P;const J=o.bK.convert(p),Q=o.bK.convert(w),oe=.5*(J.lat+Q.lat),le=.5*(J.lng+Q.lng),ue=o.dt(oe,le),ve=o.a6.vec3.normalize([],ue),_e=o.a6.vec3.normalize([],o.a6.vec3.cross([],ve,[0,1,0])),be=o.a6.vec3.cross([],_e,ve),we=[_e[0],_e[1],_e[2],0,be[0],be[1],be[2],0,ve[0],ve[1],ve[2],0,0,0,0,1],ke=[ue,o.dt(J.lat,J.lng),o.dt(Q.lat,J.lng),o.dt(Q.lat,Q.lng),o.dt(J.lat,Q.lng),o.dt(oe,J.lng),o.dt(oe,Q.lng),o.dt(J.lat,le),o.dt(Q.lat,le)];let Ne=o.c9.fromPoints(ke.map(Vt=>[o.a6.vec3.dot(_e,Vt),o.a6.vec3.dot(be,Vt),o.a6.vec3.dot(ve,Vt)]));const De=o.a6.vec3.transformMat4([],Ne.center,we);o.a6.vec3.squaredLength(De)===0&&o.a6.vec3.set(De,0,0,1),o.a6.vec3.normalize(De,De),o.a6.vec3.scale(De,De,o.aq),W.center=o.du(De);const je=W.getWorldToCameraMatrix(),Ge=o.a6.mat4.invert(new Float64Array(16),je);Ne=o.c9.applyTransform(Ne,o.a6.mat4.multiply([],je,we));const et=this._extendAABB(Ne,W,$,E);if(!et)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");Ne=et,o.a6.vec3.transformMat4(De,De,je);const Ke=.5*(Ne.max[2]-Ne.min[2]),tt=this._minimumAABBFrustumDistance(W,Ne),ct=o.a6.vec3.scale([],[0,0,1],Ke),st=o.a6.vec3.add(ct,De,ct),rt=tt+(W.pitch===0?0:o.a6.vec3.distance(De,st)),xt=W.globeCenterInViewSpace,Ft=o.a6.vec3.sub([],De,[xt[0],xt[1],xt[2]]);o.a6.vec3.normalize(Ft,Ft),o.a6.vec3.scale(Ft,Ft,rt);const Zt=o.a6.vec3.add([],De,Ft);o.a6.vec3.transformMat4(Zt,Zt,Ge);const kt=o.dw/o.aq,hn=o.a6.vec3.length(Zt),bt=o.bD(Math.max(hn*kt-o.dw,Number.EPSILON),0),Wt=Math.min(W.zoomFromMercatorZAdjusted(bt),$.maxZoom);return Wt>.5*(o.c2+o.bU)?(W.setProjection({name:"mercator"}),W.zoom=Wt,this._cameraForBounds(W,p,w,E,P,F)):{center:W.center,zoom:Wt,bearing:E,pitch:P}}_extendAABB(u,p,w,E){const P=.5*((w.padding.left||0)+(w.padding.right||0)),F=.5*((w.padding.top||0)+(w.padding.bottom||0)),W=F,$=P,J=P,Q=F,oe=p.width-($+J),le=p.height-(W+Q),ue=o.a6.vec3.sub([],u.max,u.min),ve=Math.min(oe/ue[0],le/ue[1]),_e=Math.min(p.scaleZoom(p.scale*ve),w.maxZoom);if(isNaN(_e))return null;const be=p.scale/p.zoomScale(_e),we=new o.c9([u.min[0]-$*be,u.min[1]-Q*be,u.min[2]],[u.max[0]+J*be,u.max[1]+W*be,u.max[2]]),ke=(typeof w.offset.x=="number"&&typeof w.offset.y=="number"?new o.P(w.offset.x,w.offset.y):o.P.convert(w.offset)).rotate(-o.bB(E));return we.center[0]-=ke.x*be,we.center[1]+=ke.y*be,we}queryTerrainElevation(u,p){const w=this.transform.elevation;return w?(p=o.l({},{exaggerated:!0},p),w.getAtPoint(o.a5.fromLngLat(u),null,p.exaggerated)):null}_cameraForBounds(u,p,w,E,P,F){if(u.projection.name==="globe")return this._cameraForBoundsOnGlobe(u,p,w,E,P,F);const W=u.clone(),$=this._extendCameraOptions(F);W.bearing=E,W.pitch=P;const J=o.bK.convert(p),Q=o.bK.convert(w),oe=new o.bK(J.lng,Q.lat),le=new o.bK(Q.lng,J.lat),ue=W.project(J),ve=W.project(Q),_e=this.queryTerrainElevation(J),be=this.queryTerrainElevation(Q),we=this.queryTerrainElevation(oe),ke=this.queryTerrainElevation(le),Ne=[[ue.x,ue.y,Math.min(_e||0,be||0,we||0,ke||0)],[ve.x,ve.y,Math.max(_e||0,be||0,we||0,ke||0)]];let De=o.c9.fromPoints(Ne);const je=W.getWorldToCameraMatrix(),Ge=o.a6.mat4.invert(new Float64Array(16),je);De=o.c9.applyTransform(De,je);const et=this._extendAABB(De,W,$,E);if(!et)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");De=et;const Ke=.5*o.a6.vec3.sub([],De.max,De.min)[2],tt=this._minimumAABBFrustumDistance(W,De),ct=[0,0,1,0];o.a6.vec4.transformMat4(ct,ct,je),o.a6.vec4.normalize(ct,ct);const st=o.a6.vec3.scale([],ct,tt+Ke),rt=o.a6.vec3.add([],De.center,st);o.a6.vec3.transformMat4(De.center,De.center,Ge),o.a6.vec3.transformMat4(rt,rt,Ge);const xt=W.unproject(new o.P(De.center[0],De.center[1])),Ft=o.dv(W.projection,xt),Zt=Math.pow(2,Ft),kt=Math.min(W._zoomFromMercatorZ(rt[2]*W.pixelsPerMeter*Zt/W.worldSize),$.maxZoom);return W.mercatorFromTransition&&kt<.5*(o.c2+o.bU)?(W.setProjection({name:"globe"}),W.zoom=kt,this._cameraForBounds(W,p,w,E,P,F)):{center:xt,zoom:kt,bearing:E,pitch:P}}fitBounds(u,p,w){const E=this.cameraForBounds(u,p);return this._fitInternal(E,p,w)}fitScreenCoordinates(u,p,w,E,P){const F=o.P.convert(u),W=o.P.convert(p),$=new o.P(Math.min(F.x,W.x),Math.min(F.y,W.y)),J=new o.P(Math.max(F.x,W.x),Math.max(F.y,W.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(F,W))return this;const Q=this.transform.pointLocation3D($),oe=this.transform.pointLocation3D(J),le=this.transform.pointLocation3D(new o.P($.x,J.y)),ue=this.transform.pointLocation3D(new o.P(J.x,$.y)),ve=[Math.min(Q.lng,oe.lng,le.lng,ue.lng),Math.min(Q.lat,oe.lat,le.lat,ue.lat)],_e=[Math.max(Q.lng,oe.lng,le.lng,ue.lng),Math.max(Q.lat,oe.lat,le.lat,ue.lat)],be=E&&E.pitch?E.pitch:this.getPitch(),we=this._cameraForBounds(this.transform,ve,_e,w,be,E);return this._fitInternal(we,E,P)}_fitInternal(u,p,w){return u?(p=o.l(u,p)).linear?this.easeTo(p,w):this.flyTo(p,w):this}jumpTo(u,p){this.stop();const w=u.preloadOnly?this.transform.clone():this.transform;let E=!1,P=!1,F=!1;"zoom"in u&&w.zoom!==+u.zoom&&(E=!0,w.zoom=+u.zoom),u.center!==void 0&&(w.center=o.bK.convert(u.center)),"bearing"in u&&w.bearing!==+u.bearing&&(P=!0,w.bearing=+u.bearing),"pitch"in u&&w.pitch!==+u.pitch&&(F=!0,w.pitch=+u.pitch);const W=typeof u.padding=="number"?this._extendPadding(u.padding):u.padding;if(u.padding!=null&&!w.isPaddingEqual(W))if(u.retainPadding===!1){const $=w.clone();$.padding=W,w.setLocationAtPoint(w.center,$.centerPoint)}else w.padding=W;return u.preloadOnly?(this._preloadTiles(w),this):(this.fire(new o.x("movestart",p)).fire(new o.x("move",p)),E&&this.fire(new o.x("zoomstart",p)).fire(new o.x("zoom",p)).fire(new o.x("zoomend",p)),P&&this.fire(new o.x("rotatestart",p)).fire(new o.x("rotate",p)).fire(new o.x("rotateend",p)),F&&this.fire(new o.x("pitchstart",p)).fire(new o.x("pitch",p)).fire(new o.x("pitchend",p)),this.fire(new o.x("moveend",p)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.w(pe),this.transform.getFreeCameraOptions()}setFreeCameraOptions(u,p){const w=this.transform;if(!w.projection.supportsFreeCamera)return o.w(pe),this;this.stop();const E=w.zoom,P=w.pitch,F=w.bearing;w.setFreeCameraOptions(u);const W=E!==w.zoom,$=P!==w.pitch,J=F!==w.bearing;return this.fire(new o.x("movestart",p)).fire(new o.x("move",p)),W&&this.fire(new o.x("zoomstart",p)).fire(new o.x("zoom",p)).fire(new o.x("zoomend",p)),J&&this.fire(new o.x("rotatestart",p)).fire(new o.x("rotate",p)).fire(new o.x("rotateend",p)),$&&this.fire(new o.x("pitchstart",p)).fire(new o.x("pitch",p)).fire(new o.x("pitchend",p)),this.fire(new o.x("moveend",p)),this}easeTo(u,p){this._stop(!1,u.easeId),((u=o.l({offset:[0,0],duration:500,easing:o.dr},u)).animate===!1||this._prefersReducedMotion(u))&&(u.duration=0);const w=this.transform,E=this.getZoom(),P=this.getBearing(),F=this.getPitch(),W=this.getPadding(),$="zoom"in u?+u.zoom:E,J="bearing"in u?this._normalizeBearing(u.bearing,P):P,Q="pitch"in u?+u.pitch:F,oe=this._extendPadding(u.padding),le=o.P.convert(u.offset);let ue,ve,_e;if(w.projection.name==="globe"){const ct=o.a5.fromLngLat(w.center),st=le.rotate(-w.angle);ct.x+=st.x/w.worldSize,ct.y+=st.y/w.worldSize;const rt=ct.toLngLat(),xt=o.bK.convert(u.center||rt);this._normalizeCenter(xt),ue=w.centerPoint.add(st),ve=new o.P(ct.x,ct.y).mult(w.worldSize),_e=new o.P(o.am(xt.lng),o.at(xt.lat)).mult(w.worldSize).sub(ve)}else{ue=w.centerPoint.add(le);const ct=w.pointLocation(ue),st=o.bK.convert(u.center||ct);this._normalizeCenter(st),ve=w.project(ct),_e=w.project(st).sub(ve)}const be=w.zoomScale($-E);let we,ke;u.around&&(we=o.bK.convert(u.around),ke=w.locationPoint(we));const Ne=this._zooming||$!==E,De=this._rotating||P!==J,je=this._pitching||Q!==F,Ge=!w.isPaddingEqual(oe),et=u.retainPadding===!1?w.clone():w,Ke=ct=>st=>{if(Ne&&(ct.zoom=o.aa(E,$,st)),De&&(ct.bearing=o.aa(P,J,st)),je&&(ct.pitch=o.aa(F,Q,st)),Ge&&(et.interpolatePadding(W,oe,st),ue=et.centerPoint.add(le)),we)ct.setLocationAtPoint(we,ke);else{const rt=ct.zoomScale(ct.zoom-E),xt=$>E?Math.min(2,be):Math.max(.5,be),Ft=Math.pow(xt,1-st),Zt=ct.unproject(ve.add(_e.mult(st*Ft)).mult(rt));ct.setLocationAtPoint(ct.renderWorldCopies?Zt.wrap():Zt,ue)}return u.preloadOnly||this._fireMoveEvents(p),ct};if(u.preloadOnly){const ct=this._emulate(Ke,u.duration,w);return this._preloadTiles(ct),this}const tt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Ne,this._rotating=De,this._pitching=je,this._padding=Ge,this._easeId=u.easeId,this._prepareEase(p,u.noMoveStart,tt),this._ease(Ke(w),ct=>{w.cameraElevationReference==="sea"&&w.recenterOnTerrain(),this._afterEase(p,ct)},u),this}_prepareEase(u,p,w={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),p||w.moving||this.fire(new o.x("movestart",u)),this._zooming&&!w.zooming&&this.fire(new o.x("zoomstart",u)),this._rotating&&!w.rotating&&this.fire(new o.x("rotatestart",u)),this._pitching&&!w.pitching&&this.fire(new o.x("pitchstart",u))}_fireMoveEvents(u){this.fire(new o.x("move",u)),this._zooming&&this.fire(new o.x("zoom",u)),this._rotating&&this.fire(new o.x("rotate",u)),this._pitching&&this.fire(new o.x("pitch",u))}_afterEase(u,p){if(this._easeId&&p&&this._easeId===p)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const w=this._zooming,E=this._rotating,P=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,w&&this.fire(new o.x("zoomend",u)),E&&this.fire(new o.x("rotateend",u)),P&&this.fire(new o.x("pitchend",u)),this.fire(new o.x("moveend",u))}flyTo(u,p){if(this._prefersReducedMotion(u)){const Vt=o.ar(u,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Vt,p)}this.stop(),u=o.l({offset:[0,0],speed:1.2,curve:1.42,easing:o.dr},u);const w=this.transform,E=this.getZoom(),P=this.getBearing(),F=this.getPitch(),W=this.getPadding(),$="zoom"in u?o.ap(+u.zoom,w.minZoom,w.maxZoom):E,J="bearing"in u?this._normalizeBearing(u.bearing,P):P,Q="pitch"in u?+u.pitch:F,oe=this._extendPadding(u.padding),le=w.zoomScale($-E),ue=o.P.convert(u.offset);let ve=w.centerPoint.add(ue);const _e=w.pointLocation(ve),be=o.bK.convert(u.center||_e);this._normalizeCenter(be);const we=w.project(_e),ke=w.project(be).sub(we);let Ne=u.curve;const De=Math.max(w.width,w.height),je=De/le,Ge=ke.mag();if("minZoom"in u){const Vt=o.ap(Math.min(u.minZoom,E,$),w.minZoom,w.maxZoom),fn=De/w.zoomScale(Vt-E);Ne=Math.sqrt(fn/Ge*2)}const et=Ne*Ne;function Ke(Vt){const fn=(je*je-De*De+(Vt?-1:1)*et*et*Ge*Ge)/(2*(Vt?je:De)*et*Ge);return Math.log(Math.sqrt(fn*fn+1)-fn)}function tt(Vt){return(Math.exp(Vt)-Math.exp(-Vt))/2}function ct(Vt){return(Math.exp(Vt)+Math.exp(-Vt))/2}const st=Ke(0);let rt=function(Vt){return ct(st)/ct(st+Ne*Vt)},xt=function(Vt){return De*((ct(st)*(tt(fn=st+Ne*Vt)/ct(fn))-tt(st))/et)/Ge;var fn},Ft=(Ke(1)-st)/Ne;if(Math.abs(Ge)<1e-6||!isFinite(Ft)){if(Math.abs(De-je)<1e-6)return this.easeTo(u,p);const Vt=je<De?-1:1;Ft=Math.abs(Math.log(je/De))/Ne,xt=function(){return 0},rt=function(fn){return Math.exp(Vt*Ne*fn)}}u.duration="duration"in u?+u.duration:1e3*Ft/("screenSpeed"in u?+u.screenSpeed/Ne:+u.speed),u.maxDuration&&u.duration>u.maxDuration&&(u.duration=0);const Zt=P!==J,kt=Q!==F,hn=!w.isPaddingEqual(oe),bt=u.retainPadding===!1?w.clone():w,Wt=Vt=>fn=>{const pn=fn*Ft,qt=1/rt(pn);Vt.zoom=fn===1?$:E+Vt.scaleZoom(qt),Zt&&(Vt.bearing=o.aa(P,J,fn)),kt&&(Vt.pitch=o.aa(F,Q,fn)),hn&&(bt.interpolatePadding(W,oe,fn),ve=bt.centerPoint.add(ue));const en=fn===1?be:Vt.unproject(we.add(ke.mult(xt(pn))).mult(qt));return Vt.setLocationAtPoint(Vt.renderWorldCopies?en.wrap():en,ve),Vt._updateCameraOnTerrain(),u.preloadOnly||this._fireMoveEvents(p),Vt};if(u.preloadOnly){const Vt=this._emulate(Wt,u.duration,w);return this._preloadTiles(Vt),this}return this._zooming=!0,this._rotating=Zt,this._pitching=kt,this._padding=hn,this._prepareEase(p,!1),this._ease(Wt(w),()=>this._afterEase(p),u),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(u){}_cancelRenderFrame(u){}_stop(u,p){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const w=this._onEaseEnd;this._onEaseEnd=void 0,w.call(this,p)}if(!u){const w=this.handlers;w&&w.stop(!1)}return this}_ease(u,p,w){w.animate===!1||w.duration===0?(u(1),p()):(this._easeStart=o.q.now(),this._easeOptions=w,this._onEaseFrame=u,this._onEaseEnd=p,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const u=Math.min((o.q.now()-this._easeStart)/this._easeOptions.duration,1),p=this._onEaseFrame;p&&p(this._easeOptions.easing(u)),u<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(u,p){u=o.bA(u,-180,180);const w=Math.abs(u-p);return Math.abs(u-360-p)<w&&(u-=360),Math.abs(u+360-p)<w&&(u+=360),u}_normalizeCenter(u){const p=this.transform;if(p.maxBounds||p.projection.name!=="globe"&&!p.renderWorldCopies)return;const w=u.lng-p.center.lng;u.lng+=w>180?-360:w<-180?360:0}_prefersReducedMotion(u){return this._respectPrefersReducedMotion&&o.q.prefersReducedMotion&&!(u&&u.essential)}_emulate(u,p,w){const E=Math.ceil(15*p/1e3),P=[],F=u(w.clone());for(let W=0;W<=E;W++){const $=F(W/E);P.push($.clone())}return P}_preloadTiles(u,p){}}class ft{constructor(u={}){this.options=u,o.aJ(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(u){const p=this.options&&this.options.compact,w=u._getUIString("AttributionControl.ToggleAttribution");this._map=u,this._container=C("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=C("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",w);const E=C("span","mapboxgl-ctrl-icon",this._compactButton);return E.setAttribute("aria-hidden","true"),E.setAttribute("title",w),this._innerContainer=C("div","mapboxgl-ctrl-attrib-inner",this._container),p&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),p===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let u=this._editLink;u||(u=this._editLink=this._container.querySelector(".mapbox-improve-map"));const p=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.e.ACCESS_TOKEN}];if(u){const w=p.reduce((E,P,F)=>(P.value&&(E+=`${P.key}=${P.value}${F<p.length-1?"&":""}`),E),"?");u.href=`${o.e.FEEDBACK_URL}/${w}#${Vc(this._map,!0)}`,u.rel="noopener nofollow"}}_updateData(u){!u||u.sourceDataType!=="metadata"&&u.sourceDataType!=="visibility"&&u.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let u=[];if(this._map.style.stylesheet){const E=this._map.style.stylesheet;this.styleOwner=E.owner,this.styleId=E.id}const p=this._map.style._mergedSourceCaches;for(const E in p){const P=p[E];if(P.used){const F=P.getSource();F.attribution&&u.indexOf(F.attribution)<0&&u.push(F.attribution)}}u.sort((E,P)=>E.length-P.length),u=u.filter((E,P)=>{for(let F=P+1;F<u.length;F++)if(u[F].indexOf(E)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?u=[...this.options.customAttribution,...u]:u.unshift(this.options.customAttribution));const w=u.join(" | ");w!==this._attribHTML&&(this._attribHTML=w,u.length?(this._innerContainer.innerHTML=w,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Ot{constructor(){o.aJ(["_updateLogo","_updateCompact"],this)}onAdd(u){this._map=u,this._container=C("div","mapboxgl-ctrl");const p=C("a","mapboxgl-ctrl-logo");return p.target="_blank",p.rel="noopener nofollow",p.href="https://www.mapbox.com/",p.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),p.setAttribute("rel","noopener nofollow"),this._container.appendChild(p),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(u){u&&u.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const u=this._map.style._sourceCaches;if(Object.entries(u).length===0)return!0;for(const p in u){const w=u[p].getSource();if(w.hasOwnProperty("mapbox_logo")&&!w.mapbox_logo)return!1}return!0}_updateCompact(){const u=this._container.children;if(u.length){const p=u[0];this._map.getCanvasContainer().offsetWidth<250?p.classList.add("mapboxgl-compact"):p.classList.remove("mapboxgl-compact")}}}class vn{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(u){const p=++this._id;return this._queue.push({callback:u,id:p,cancelled:!1}),p}remove(u){const p=this._currentlyRunning,w=p?this._queue.concat(p):this._queue;for(const E of w)if(E.id===u)return void(E.cancelled=!0)}run(u=0){const p=this._currentlyRunning=this._queue;this._queue=[];for(const w of p)if(!w.cancelled&&(w.callback(u),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Wn{constructor(u){this.jumpTo(u)}getValue(u){if(u<=this._startTime)return this._start;if(u>=this._endTime)return this._end;const p=o.cw((u-this._startTime)/(this._endTime-this._startTime));return this._start*(1-p)+this._end*p}isEasing(u){return u>=this._startTime&&u<=this._endTime}jumpTo(u){this._startTime=-1/0,this._endTime=-1/0,this._start=u,this._end=u}easeTo(u,p,w){this._start=this.getValue(p),this._end=u,this._startTime=p,this._endTime=p+w}}const br={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class oi{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class zr{constructor(u){this.map=u,this.interactionsByType=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this)}add(u,p){if(this.typeById.has(u))throw new Error(`Interaction id "${u}" already exists.`);const{type:w,filter:E}=p;if(E){const F=o.M(E,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(F.result==="error")throw new Error(F.value.map(W=>`${W.key}: ${W.message}`).join(", "));this.filters.set(u,F.value)}const P=this.interactionsByType.get(w)||new Map;P.size===0&&(this.map.on(w,this.handleType),this.interactionsByType.set(w,P)),P.set(u,p),this.typeById.set(u,w)}remove(u){const p=this.typeById.get(u);if(!p)return;this.typeById.delete(u),this.filters.delete(u);const w=this.interactionsByType.get(p);w&&(w.delete(u),w.size===0&&this.map.off(p,this.handleType))}handleType(u){const p=u.features||this.map.queryRenderedFeatures(u.point);if(!p)return;const w=this.interactionsByType.get(u.type),E={zoom:0};for(const[P,F]of w){const W=this.filters.get(P),{handler:$,layers:J}=F;for(const Q of p)if((!J||J.includes(Q.layer.id))&&(!W||W.evaluate(E,Q))&&$({id:P,feature:Q,interaction:F})!==!1)break}}}const fs={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0},Ir={showCompass:!0,showZoom:!0,visualizePitch:!1};class co{constructor(u,p,w=!1){this._clickTolerance=10,this.element=p,this.mouseRotate=new zg({clickTolerance:u.dragRotate._mouseRotate._clickTolerance}),this.map=u,w&&(this.mousePitch=new Jp({clickTolerance:u.dragRotate._mousePitch._clickTolerance})),o.aJ(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),p.addEventListener("mousedown",this.mousedown),p.addEventListener("touchstart",this.touchstart,{passive:!1}),p.addEventListener("touchmove",this.touchmove),p.addEventListener("touchend",this.touchend),p.addEventListener("touchcancel",this.reset)}down(u,p){this.mouseRotate.mousedown(u,p),this.mousePitch&&this.mousePitch.mousedown(u,p),q()}move(u,p){const w=this.map,E=this.mouseRotate.mousemoveWindow(u,p),P=E&&E.bearingDelta;if(P&&w.setBearing(w.getBearing()+P),this.mousePitch){const F=this.mousePitch.mousemoveWindow(u,p),W=F&&F.pitchDelta;W&&w.setPitch(w.getPitch()+W)}}off(){const u=this.element;u.removeEventListener("mousedown",this.mousedown),u.removeEventListener("touchstart",this.touchstart,{passive:!1}),u.removeEventListener("touchmove",this.touchmove),u.removeEventListener("touchend",this.touchend),u.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Z(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(u){this.down(o.l({},u,{ctrlKey:!0,preventDefault:()=>u.preventDefault()}),se(this.element,u)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(u){this.move(u,se(this.element,u))}mouseup(u){this.mouseRotate.mouseupWindow(u),this.mousePitch&&this.mousePitch.mouseupWindow(u),this.offTemp()}touchstart(u){u.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ae(this.element,u.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>u.preventDefault()},this._startPos))}touchmove(u){u.targetTouches.length!==1?this.reset():(this._lastPos=ae(this.element,u.targetTouches)[0],this.move({preventDefault:()=>u.preventDefault()},this._lastPos))}touchend(u){u.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function uo(b,u,p){if(b=new o.bK(b.lng,b.lat),u){const w=new o.bK(b.lng-360,b.lat),E=new o.bK(b.lng+360,b.lat),P=360*Math.ceil(Math.abs(b.lng-p.center.lng)/360),F=p.locationPoint(b).distSqr(u),W=u.x<0||u.y<0||u.x>p.width||u.y>p.height;p.locationPoint(w).distSqr(u)<F&&(W||Math.abs(w.lng-p.center.lng)<P)?b=w:p.locationPoint(E).distSqr(u)<F&&(W||Math.abs(E.lng-p.center.lng)<P)&&(b=E)}for(;Math.abs(b.lng-p.center.lng)>180;){const w=p.locationPoint(b);if(w.x>=0&&w.y>=0&&w.x<=p.width&&w.y<=p.height)break;b.lng>p.center.lng?b.lng-=360:b.lng+=360}return b}const Xt={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Nt extends o.E{constructor(u,p){if(super(),(u instanceof HTMLElement||p)&&(u=o.l({element:u},p)),o.aJ(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=u&&u.anchor||"center",this._color=u&&u.color||"#3FB1CE",this._scale=u&&u.scale||1,this._draggable=u&&u.draggable||!1,this._clickTolerance=u&&u.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=u&&u.rotation||0,this._rotationAlignment=u&&u.rotationAlignment||"auto",this._pitchAlignment=u&&u.pitchAlignment&&u.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=u&&u.occludedOpacity||.2,u&&u.element)this._element=u.element,this._offset=o.P.convert(u&&u.offset||[0,0]);else{this._defaultMarker=!0,this._element=C("div");const P=41,F=27,W=M("svg",{display:"block",height:P*this._scale+"px",width:F*this._scale+"px",viewBox:`0 0 ${F} ${P}`},this._element),$=M("radialGradient",{id:"shadowGradient"},M("defs",{},W));M("stop",{offset:"10%","stop-opacity":.4},$),M("stop",{offset:"100%","stop-opacity":.05},$),M("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},W),M("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},W),M("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},W),M("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},W),this._offset=o.P.convert(u&&u.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",P=>{P.preventDefault()}),this._element.addEventListener("mousedown",P=>{P.preventDefault()});const w=this._element.classList;for(const P in Xt)w.remove(`mapboxgl-marker-anchor-${P}`);w.add(`mapboxgl-marker-anchor-${this._anchor}`);const E=u&&u.className?u.className.trim().split(/\s+/):[];w.add(...E),this._popup=null}addTo(u){return u===this._map||(this.remove(),this._map=u,u.getCanvasContainer().appendChild(this._element),u.on("move",this._updateMoving),u.on("moveend",this._update),u.on("remove",this._clearFadeTimer),u._addMarker(this),this.setDraggable(this._draggable),this._update(),u.on("click",this._onMapClick)),this}remove(){const u=this._map;return u&&(u.off("click",this._onMapClick),u.off("move",this._updateMoving),u.off("moveend",this._update),u.off("mousedown",this._addDragHandler),u.off("touchstart",this._addDragHandler),u.off("mouseup",this._onUp),u.off("touchend",this._onUp),u.off("mousemove",this._onMove),u.off("touchmove",this._onMove),u.off("remove",this._clearFadeTimer),u._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(u){return this._lngLat=o.bK.convert(u),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(u){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),u){if(!("offset"in u.options)){const E=Math.sqrt(Math.pow(13.5,2)/2);u.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[E,-1*(38.1-13.5+E)],"bottom-right":[-E,-1*(38.1-13.5+E)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=u,u._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(u){const p=u.code,w=u.charCode||u.keyCode;p!=="Space"&&p!=="Enter"&&w!==32&&w!==13||this.togglePopup()}_onMapClick(u){const p=u.originalEvent.target,w=this._element;this._popup&&(p===w||w.contains(p))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const u=this._popup;return u?(u.isOpen()?(u.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(u.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const u=this._map,p=this._pos;if(!u||!p)return!1;const w=u.unproject(p),E=u.getFreeCameraOptions();if(!E.position)return!1;const P=E.position.toLngLat();return P.distanceTo(w)<.9*P.distanceTo(this._lngLat)}_evaluateOpacity(){const u=this._map;if(!u)return;const p=this._pos;if(!p||p.x<0||p.x>u.transform.width||p.y<0||p.y>u.transform.height)return void this._clearFadeTimer();const w=u.unproject(p);let E;u._showingGlobe()&&o.dz(u.transform,this._lngLat)?E=0:(E=1-u._queryFogOpacity(w),u.transform._terrainEnabled()&&u.getTerrain()&&this._behindTerrain()&&(E*=this._occludedOpacity)),this._element.style.opacity=`${E}`,this._element.style.pointerEvents=E>0?"auto":"none",this._popup&&this._popup._setOpacity(E),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const u=this._pos;if(!u||!this._map)return;const p=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${u.x}px,${u.y}px)
            ${Xt[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${p.x}px,${p.y}px)
        `}_calculateXYTransform(){const u=this._pos,p=this._map,w=this.getPitchAlignment();if(!p||!u||w!=="map")return"";if(!p._showingGlobe()){const $=p.getPitch();return $?`rotateX(${$}deg)`:""}const E=o.c0(o.dA(p.transform,this._lngLat)),P=u.sub(o.dB(p.transform)),F=Math.abs(P.x)+Math.abs(P.y);if(F===0)return"";const W=E/F;return`rotateX(${-P.y*W}deg) rotateY(${P.x*W}deg)`}_calculateZTransform(){const u=this._pos,p=this._map;if(!p||!u)return"";let w=0;const E=this.getRotationAlignment();if(E==="map")if(p._showingGlobe()){const P=p.project(new o.bK(this._lngLat.lng,this._lngLat.lat+.001)),F=p.project(new o.bK(this._lngLat.lng,this._lngLat.lat-.001)).sub(P);w=o.c0(Math.atan2(F.y,F.x))-90}else w=-p.getBearing();else if(E==="horizon"){const P=o.a7(4,6,p.getZoom()),F=o.dB(p.transform);F.y+=P*p.transform.height;const W=u.sub(F),$=o.c0(Math.atan2(W.y,W.x));w=($>90?$-270:$+90)*(1-P)}return w+=this._rotation,w?`rotateZ(${w}deg)`:""}_update(u){cancelAnimationFrame(this._updateFrameId);const p=this._map;p&&(p.transform.renderWorldCopies&&(this._lngLat=uo(this._lngLat,this._pos,p.transform)),this._pos=p.project(this._lngLat),u===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),p._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(p._showingGlobe()||p.getTerrain()||p.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(u){return this._offset=o.P.convert(u),this._update(),this}addClassName(u){return this._element.classList.add(u),this}removeClassName(u){return this._element.classList.remove(u),this}toggleClassName(u){return this._element.classList.toggle(u)}_onMove(u){const p=this._map;if(!p)return;const w=this._pointerdownPos,E=this._positionDelta;if(w&&E){if(!this._isDragging){const P=this._clickTolerance||p._clickTolerance;if(u.point.dist(w)<P)return;this._isDragging=!0}this._pos=u.point.sub(E),this._lngLat=p.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.x("dragstart"))),this.fire(new o.x("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const u=this._map;u&&(u.off("mousemove",this._onMove),u.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.x("dragend")),this._state="inactive"}_addDragHandler(u){const p=this._map,w=this._pos;p&&w&&this._element.contains(u.originalEvent.target)&&(u.preventDefault(),this._positionDelta=u.point.sub(w),this._pointerdownPos=u.point,this._state="pending",p.on("mousemove",this._onMove),p.on("touchmove",this._onMove),p.once("mouseup",this._onUp),p.once("touchend",this._onUp))}setDraggable(u){this._draggable=!!u;const p=this._map;return p&&(u?(p.on("mousedown",this._addDragHandler),p.on("touchstart",this._addDragHandler)):(p.off("mousedown",this._addDragHandler),p.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(u){return this._rotation=u||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(u){return this._rotationAlignment=u||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(u){return this._pitchAlignment=u||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(u){return this._occludedOpacity=u||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const on={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},rr={maxWidth:100,unit:"metric"},Rr={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},mi={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},ai=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Fi(b=new o.P(0,0),u="bottom"){if(typeof b=="number"){const p=Math.round(Math.sqrt(.5*Math.pow(b,2)));switch(u){case"top":return new o.P(0,b);case"top-left":return new o.P(p,p);case"top-right":return new o.P(-p,p);case"bottom":return new o.P(0,-b);case"bottom-left":return new o.P(p,-p);case"bottom-right":return new o.P(-p,-p);case"left":return new o.P(b,0);case"right":return new o.P(-b,0)}return new o.P(0,0)}return b instanceof o.P||Array.isArray(b)?o.P.convert(b):o.P.convert(b[u]||[0,0])}return{version:h,supported:I.supported,setRTLTextPlugin:o.dC,getRTLTextPluginStatus:o.dD,Map:class extends Te{constructor(b){m.mark(d.create);const u=b;if((b=o.l({},fs,b)).minZoom!=null&&b.maxZoom!=null&&b.minZoom>b.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(b.minPitch!=null&&b.maxPitch!=null&&b.minPitch>b.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(b.minPitch!=null&&b.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(b.maxPitch!=null&&b.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(b.antialias&&o.dx(window)&&(b.antialias=!1,o.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new dd(b.minZoom,b.maxZoom,b.minPitch,b.maxPitch,b.renderWorldCopies),b),this._repaint=!!b.repaint,this._interactive=b.interactive,this._minTileCacheSize=b.minTileCacheSize,this._maxTileCacheSize=b.maxTileCacheSize,this._failIfMajorPerformanceCaveat=b.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=b.preserveDrawingBuffer,this._antialias=b.antialias,this._trackResize=b.trackResize,this._bearingSnap=b.bearingSnap,this._refreshExpiredTiles=b.refreshExpiredTiles,this._fadeDuration=b.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=b.crossSourceCollisions,this._collectResourceTiming=b.collectResourceTiming,this._language=this._parseLanguage(b.language),this._worldview=b.worldview,this._renderTaskQueue=new vn,this._domRenderTaskQueue=new vn,this._controls=[],this._markers=[],this._popups=[],this._mapId=o.aP(),this._locale=o.l({},br,b.locale),this._clickTolerance=b.clickTolerance,this._cooperativeGestures=b.cooperativeGestures,this._performanceMetricsCollection=b.performanceMetricsCollection,this._tessellationStep=b.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=b.precompilePrograms,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Wn(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._requestManager=new qe(b.transformRequest,b.accessToken,b.testMode),this._silenceAuthErrors=!!b.testMode,this._contextCreateOptions=b.contextCreateOptions?{...b.contextCreateOptions}:{},typeof b.container=="string"){const p=document.getElementById(b.container);if(!p)throw new Error(`Container '${b.container.toString()}' not found.`);this._container=p}else{if(!(b.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=b.container}if(this._container.childNodes.length>0&&o.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),b.maxBounds&&this.setMaxBounds(b.maxBounds),o.aJ(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new oi),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new re(this,b),this._localFontFamily=b.localFontFamily,this._localIdeographFontFamily=b.localIdeographFontFamily,(b.style||!b.testMode)&&this.setStyle(b.style||o.e.DEFAULT_STYLE,{config:b.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),b.projection&&this.setProjection(b.projection),b.hash&&(this._hash=new lo(typeof b.hash=="string"&&b.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){u.center==null&&u.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:b.center,zoom:b.zoom,bearing:b.bearing,pitch:b.pitch});const p=b.bounds;p&&(this.resize(),this.fitBounds(p,o.l({},b.fitBoundsOptions,{duration:0})))}this.resize(),b.attributionControl&&this.addControl(new ft({customAttribution:b.customAttribution})),this._logoControl=new Ot,this.addControl(this._logoControl,b.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",p=>{this._update(p.dataType==="style"),this.fire(new o.x(`${p.dataType}data`,p))}),this.on("dataloading",p=>{this.fire(new o.x(`${p.dataType}dataloading`,p))}),this._interactions=new zr(this)}_getMapId(){return this._mapId}addControl(b,u){if(u===void 0&&(u=b.getDefaultPosition?b.getDefaultPosition():"top-right"),!b||!b.onAdd)return this.fire(new o.t(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const p=b.onAdd(this);this._controls.push(b);const w=this._controlPositions[u];return u.indexOf("bottom")!==-1?w.insertBefore(p,w.firstChild):w.appendChild(p),this}removeControl(b){if(!b||!b.onRemove)return this.fire(new o.t(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const u=this._controls.indexOf(b);return u>-1&&this._controls.splice(u,1),b.onRemove(this),this}hasControl(b){return this._controls.indexOf(b)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(b){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const u=!this._moving;return u&&this.fire(new o.x("movestart",b)).fire(new o.x("move",b)),this.fire(new o.x("resize",b)),u&&this.fire(new o.x("moveend",b)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(b){return this.transform.setMaxBounds(o.as.convert(b)),this._update()}setMinZoom(b){if((b=b??-2)>=-2&&b<=this.transform.maxZoom)return this.transform.minZoom=b,this._update(),this.getZoom()<b?this.setZoom(b):this.fire(new o.x("zoomstart")).fire(new o.x("zoom")).fire(new o.x("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(b){if((b=b??22)>=this.transform.minZoom)return this.transform.maxZoom=b,this._update(),this.getZoom()>b?this.setZoom(b):this.fire(new o.x("zoomstart")).fire(new o.x("zoom")).fire(new o.x("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(b){if((b=b??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(b>=0&&b<=this.transform.maxPitch)return this.transform.minPitch=b,this._update(),this.getPitch()<b?this.setPitch(b):this.fire(new o.x("pitchstart")).fire(new o.x("pitch")).fire(new o.x("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(b){if((b=b??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(b>=this.transform.minPitch)return this.transform.maxPitch=b,this._update(),this.getPitch()>b?this.setPitch(b):this.fire(new o.x("pitchstart")).fire(new o.x("pitch")).fire(new o.x("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(b){return this.transform.renderWorldCopies=b,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(b){return b==="auto"?navigator.language:Array.isArray(b)?b.length===0?void 0:b.map(u=>u==="auto"?navigator.language:u):b}setLanguage(b){const u=this._parseLanguage(b);if(!this.style||u===this._language)return this;this._language=u,this.style.reloadSources();for(const p of this._controls)p._setLanguage&&p._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(b){return this.style&&b!==this._worldview?(this._worldview=b,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(b){return this._lazyInitEmptyStyle(),b?typeof b=="string"&&(b={name:b}):b=null,this._useExplicitProjection=!!b,this._prioritizeAndUpdateProjection(b,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const b=this.transform,u=b.projection.name;let p;u==="globe"&&b.zoom>=o.bU?(b.setMercatorFromTransition(),p=!0):u==="mercator"&&b.zoom<o.bU&&(b.setProjection({name:"globe"}),p=!0),p&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(b,u){return this._updateProjection(b||u||{name:"mercator"})}_updateProjection(b){let u;return u=b.name==="globe"&&this.transform.zoom>=o.bU?this.transform.setMercatorFromTransition():this.transform.setProjection(b),this.style.applyProjectionUpdate(),u&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(b){return this.transform.locationPoint3D(o.bK.convert(b))}unproject(b){return this.transform.pointLocation3D(o.P.convert(b))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(b,u,p){if(b==="mouseenter"||b==="mouseover"){let w=!1;const E=F=>{const W=u.filter(J=>this.getLayer(J)),$=W.length?this.queryRenderedFeatures(F.point,{layers:W}):[];$.length?w||(w=!0,p.call(this,new ya(b,this,F.originalEvent,{features:$}))):w=!1},P=()=>{w=!1};return{layers:new Set(u),listener:p,delegates:{mousemove:E,mouseout:P}}}if(b==="mouseleave"||b==="mouseout"){let w=!1;const E=F=>{const W=u.filter($=>this.getLayer($));(W.length?this.queryRenderedFeatures(F.point,{layers:W}):[]).length?w=!0:w&&(w=!1,p.call(this,new ya(b,this,F.originalEvent)))},P=F=>{w&&(w=!1,p.call(this,new ya(b,this,F.originalEvent)))};return{layers:new Set(u),listener:p,delegates:{mousemove:E,mouseout:P}}}{const w=E=>{const P=u.filter(W=>this.getLayer(W)),F=P.length?this.queryRenderedFeatures(E.point,{layers:P}):[];F.length&&(E.features=F,p.call(this,E),delete E.features)};return{layers:new Set(u),listener:p,delegates:{[b]:w}}}}on(b,u,p){if(typeof u=="function"||p===void 0)return super.on(b,u);if(Array.isArray(u)||(u=[u]),u){for(const E of u)if(!this._isValidId(E))return this}const w=this._createDelegatedListener(b,u,p);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[b]=this._delegatedListeners[b]||[],this._delegatedListeners[b].push(w);for(const E in w.delegates)this.on(E,w.delegates[E]);return this}once(b,u,p){if(typeof u=="function"||p===void 0)return super.once(b,u);if(Array.isArray(u)||(u=[u]),u){for(const E of u)if(!this._isValidId(E))return this}const w=this._createDelegatedListener(b,u,p);for(const E in w.delegates)this.once(E,w.delegates[E]);return this}off(b,u,p){if(typeof u=="function"||p===void 0)return super.off(b,u);const w=new Set(Array.isArray(u)?u:[u]);for(const F of w)if(!this._isValidId(F))return this;const E=(F,W)=>{if(F.size!==W.size)return!1;for(const $ of F)if(!W.has($))return!1;return!0},P=this._delegatedListeners?this._delegatedListeners[b]:void 0;return P&&(F=>{for(let W=0;W<F.length;W++){const $=F[W];if($.listener===p&&E($.layers,w)){for(const J in $.delegates)this.off(J,$.delegates[J]);return F.splice(W,1),this}}})(P),this}queryRenderedFeatures(b,u){if(!this.style)return[];if(u!==void 0||b===void 0||b instanceof o.P||Array.isArray(b)||(u=b,b=void 0),b=b||[[0,0],[this.transform.width,this.transform.height]],(u=u||{}).layers&&Array.isArray(u.layers)){for(const p of u.layers)if(!this._isValidId(p))return[]}return this.style.queryRenderedFeatures(b,u,this.transform)}querySourceFeatures(b,u){return this._isValidId(b)?this.style.querySourceFeatures(b,u):[]}isPointOnSurface(b){const{name:u}=this.transform.projection;return u!=="globe"&&u!=="mercator"&&o.w(`${u} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(o.P.convert(b))}addInteraction(b,u){return this._interactions.add(b,u),this}removeInteraction(b){return this._interactions.remove(b),this}setStyle(b,u){return u=o.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},u),this.style&&b&&u.diff!==!1&&u.localFontFamily===this._localFontFamily&&u.localIdeographFontFamily===this._localIdeographFontFamily&&!u.config?(this.style._diffStyle(b,(p,w)=>{p?(o.w(`Unable to perform style diff: ${String(p.message||p.error||p)}. Rebuilding the style from scratch.`),this._updateStyle(b,u)):w&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=u.localIdeographFontFamily,this._localFontFamily=u.localFontFamily,this._updateStyle(b,u))}_getUIString(b){const u=this._locale[b];if(u==null)throw new Error(`Missing UI string '${b}'`);return u}_updateStyle(b,u){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),b){const p=o.l({},u);u&&u.config&&(p.initialConfig=u.config,delete p.config),this.style=new ka(this,p).load(b),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ka(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.w("There is no style added to the map."),!1)}_isValidId(b){return b==null?(this.fire(new o.t(new Error("IDs can't be empty."))),!1):!o.cn(b)||(this.fire(new o.t(new Error(`IDs can't contain special symbols: "${b}".`))),!1)}addSource(b,u){return this._isValidId(b)?(this._lazyInitEmptyStyle(),this.style.addSource(b,u),this._update(!0)):this}isSourceLoaded(b){return!!this._isValidId(b)&&!!this.style&&this.style._isSourceCacheLoaded(b)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(b,u,p){this._lazyInitEmptyStyle(),this.style.addSourceType(b,u,p)}removeSource(b){return this._isValidId(b)?(this.style.removeSource(b),this._updateTerrain(),this._update(!0)):this}getSource(b){return this._isValidId(b)?this.style.getOwnSource(b):null}addImage(b,u,{pixelRatio:p=1,sdf:w=!1,stretchX:E,stretchY:P,content:F}={}){if(this._lazyInitEmptyStyle(),u instanceof HTMLImageElement||ImageBitmap&&u instanceof ImageBitmap){const{width:W,height:$,data:J}=o.q.getImageData(u);this.style.addImage(b,{data:new o.r({width:W,height:$},J),pixelRatio:p,stretchX:E,stretchY:P,content:F,sdf:w,version:0})}else if(u.width===void 0||u.height===void 0)this.fire(new o.t(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:W,height:$}=u,J=u;this.style.addImage(b,{data:new o.r({width:W,height:$},new Uint8Array(J.data)),pixelRatio:p,stretchX:E,stretchY:P,content:F,sdf:w,version:0,userImage:J}),J.onAdd&&J.onAdd(this,b)}}updateImage(b,u){this._lazyInitEmptyStyle();const p=this.style.getImage(b);if(!p)return void this.fire(new o.t(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const w=u instanceof HTMLImageElement||ImageBitmap&&u instanceof ImageBitmap?o.q.getImageData(u):u,{width:E,height:P,data:F}=w;if(E===void 0||P===void 0)return void this.fire(new o.t(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(E!==p.data.width||P!==p.data.height)return void this.fire(new o.t(new Error(`The width and height of the updated image (${E}, ${P})
                must be that same as the previous version of the image
                (${p.data.width}, ${p.data.height})`)));const W=!(u instanceof HTMLImageElement||ImageBitmap&&u instanceof ImageBitmap);p.data.replace(F,W),this.style.updateImage(b,p)}hasImage(b){return b?!!this.style&&!!this.style.getImage(b):(this.fire(new o.t(new Error("Missing required image id"))),!1)}removeImage(b){this.style.removeImage(b)}loadImage(b,u){o.o(this._requestManager.transformRequest(b,o.R.Image),(p,w)=>{u(p,w instanceof HTMLImageElement?o.q.getImageData(w):w)})}listImages(){return this.style.listImages()}addModel(b,u){this._lazyInitEmptyStyle(),this.style.addModel(b,u)}hasModel(b){return b?this.style.hasModel(b):(this.fire(new o.t(new Error("Missing required model id"))),!1)}removeModel(b){this.style.removeModel(b)}listModels(){return this.style.listModels()}addLayer(b,u){return this._isValidId(b.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(b,u),this._update(!0)):this}getSlot(b){const u=this.getLayer(b);return u&&u.slot||null}setSlot(b,u){return this.style.setSlot(b,u),this.style.mergeLayers(),this._update(!0)}addImport(b,u){return this.style.addImport(b,u),this}updateImport(b,u){return typeof u!="string"&&u.id!==b?(this.removeImport(b),this.addImport(u)):(this.style.updateImport(b,u),this._update(!0))}removeImport(b){return this.style.removeImport(b),this}moveImport(b,u){return this.style.moveImport(b,u),this._update(!0)}moveLayer(b,u){return this._isValidId(b)?(this.style.moveLayer(b,u),this._update(!0)):this}removeLayer(b){return this._isValidId(b)?(this.style.removeLayer(b),this._update(!0)):this}getLayer(b){if(!this._isValidId(b))return null;const u=this.style.getOwnLayer(b);return u?u.type==="custom"?u.implementation:u.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(b,u,p){return this._isValidId(b)?(this.style.setLayerZoomRange(b,u,p),this._update(!0)):this}setFilter(b,u,p={}){return this._isValidId(b)?(this.style.setFilter(b,u,p),this._update(!0)):this}getFilter(b){return this._isValidId(b)?this.style.getFilter(b):null}setPaintProperty(b,u,p,w={}){return this._isValidId(b)?(this.style.setPaintProperty(b,u,p,w),this._update(!0)):this}getPaintProperty(b,u){return this._isValidId(b)?this.style.getPaintProperty(b,u):null}setLayoutProperty(b,u,p,w={}){return this._isValidId(b)?(this.style.setLayoutProperty(b,u,p,w),this._update(!0)):this}getLayoutProperty(b,u){return this._isValidId(b)?this.style.getLayoutProperty(b,u):null}getSchema(b){return this.style.getSchema(b)}setSchema(b,u){return this.style.setSchema(b,u),this._update(!0)}getConfig(b){return this.style.getConfig(b)}setConfig(b,u){return this.style.setConfig(b,u),this._update(!0)}getConfigProperty(b,u){return this.style.getConfigProperty(b,u)}setConfigProperty(b,u,p){return this.style.setConfigProperty(b,u,p),this._update(!0)}setLights(b){if(this._lazyInitEmptyStyle(),b&&b.length===1&&b[0].type==="flat"){const u=b[0];u.properties?this.style.setFlatLight(u.properties,u.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(b),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const b=this.style.getLights()||[];return b.length===0&&b.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),b}setLight(b,u={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:b}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(b){return this._lazyInitEmptyStyle(),!b&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(b),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(b){return this._lazyInitEmptyStyle(),this.style.setFog(b),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setColorTheme(b){return this._lazyInitEmptyStyle(),this.style.setColorTheme(b),this._update(!0)}setCamera(b){return this.style.setCamera(b),this._triggerCameraUpdate(b)}_triggerCameraUpdate(b){return this._update(this.transform.setOrthographicProjectionAtLowPitch(b["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(b){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.bK.convert(b),this.transform):0}setFeatureState(b,u){return this._isValidId(b.source)?(this.style.setFeatureState(b,u),this._update()):this}removeFeatureState(b,u){return this._isValidId(b.source)?(this.style.removeFeatureState(b,u),this._update()):this}getFeatureState(b){return this._isValidId(b.source)?this.style.getFeatureState(b):null}_updateContainerDimensions(){if(!this._container)return;const b=this._container.getBoundingClientRect().width||400,u=this._container.getBoundingClientRect().height||300;let p,w,E,P=this._container;for(;P&&(!w||!E);){const F=window.getComputedStyle(P).transform;F&&F!=="none"&&(p=F.match(/matrix.*\((.+)\)/)[1].split(", "),p[0]&&p[0]!=="0"&&p[0]!=="1"&&(w=p[0]),p[3]&&p[3]!=="0"&&p[3]!=="1"&&(E=p[3])),P=P.parentElement}this._containerWidth=w?Math.abs(b/w):b,this._containerHeight=E?Math.abs(u/E):u}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const b=this._container;b.classList.add("mapboxgl-map"),(this._missingCSSCanary=C("div","mapboxgl-canary",b)).style.visibility="hidden",this._detectMissingCSS();const u=this._canvasContainer=C("div","mapboxgl-canvas-container",b);this._canvas=C("canvas","mapboxgl-canvas",u),this._interactive&&(u.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const p=this._controlContainer=C("div","mapboxgl-control-container",b),w=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(E=>{w[E]=C("div",`mapboxgl-ctrl-${E}`,p)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(b,u){const p=o.q.devicePixelRatio||1;this._canvas.width=p*Math.ceil(b),this._canvas.height=p*Math.ceil(u),this._canvas.style.width=`${b}px`,this._canvas.style.height=`${u}px`}_addMarker(b){this._markers.push(b)}_removeMarker(b){const u=this._markers.indexOf(b);u!==-1&&this._markers.splice(u,1)}_addPopup(b){this._popups.push(b)}_removePopup(b){const u=this._popups.indexOf(b);u!==-1&&this._popups.splice(u,1)}_setupPainter(){const b=o.l({},I.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),u=this._canvas.getContext("webgl2",b);u?(mn(u,!0),this.painter=new Ja(u,this._contextCreateOptions,this.transform,this._tp),this.on("data",p=>{p.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),o.m.testSupport(u)):this.fire(new o.t(new Error("Failed to initialize WebGL")))}_contextLost(b){b.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.x("webglcontextlost",{originalEvent:b}))}_contextRestored(b){this._setupPainter(),this.resize(),this._update(),this.fire(new o.x("webglcontextrestored",{originalEvent:b}))}_onMapScroll(b){if(b.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(b){return this.style?(this._styleDirty=this._styleDirty||b,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(b){return this._update(),this._renderTaskQueue.add(b)}_cancelRenderFrame(b){this._renderTaskQueue.remove(b)}_requestDomTask(b){!this.loaded()||this.loaded()&&!this.isMoving()?b():this._domRenderTaskQueue.add(b)}_render(b){let u;this.fire(new o.x("renderstart")),++this._frameId;const p=this.painter.context.extTimerQuery,w=o.q.now(),E=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(u=E.createQuery(),E.beginQuery(p.TIME_ELAPSED_EXT,u)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(b),this._domRenderTaskQueue.run(b),this._removed)return;this._updateProjectionTransition();const P=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const J=this.transform.zoom,Q=this.transform.pitch,oe=o.q.now(),le=new o.a3(J,{now:oe,fadeDuration:P,pitch:Q,transition:this.style.transition});this.style.update(le)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let F=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),F=this._updateAverageElevation(w),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):F=this._updateAverageElevation(w);const W=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,P,this._crossSourceCollisions,this.painter.replacementSource);if(W&&(this._placementDirty=W.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:P,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.x("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,m.mark(d.load),this.fire(new o.x("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),u){const J=o.q.now()-w;E.endQuery(p.TIME_ELAPSED_EXT),setTimeout(()=>{const Q=E.getQueryParameter(u,E.QUERY_RESULT)/1e6;E.deleteQuery(u),this.fire(new o.x("gpu-timing-frame",{cpuTime:J,gpuTime:Q}))},50)}if(this.listens("gpu-timing-layer")){const J=this.painter.collectGpuTimers();setTimeout(()=>{const Q=this.painter.queryGpuTimers(J);this.fire(new o.x("gpu-timing-layer",{layerTimes:Q}))},50)}if(this.listens("gpu-timing-deferred-render")){const J=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const Q=this.painter.queryGpuTimeDeferredRender(J);this.fire(new o.x("gpu-timing-deferred-render",{gpuTime:Q}))},50)}const $=this._sourcesDirty||this._styleDirty||this._placementDirty||F;if($||this._repaint)this.triggerRepaint();else{const J=this.idle();if(J&&(F=this._updateAverageElevation(w,!0)),F)this.triggerRepaint();else if(this._triggerFrame(!1),J&&(this.fire(new o.x("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const Q=this._calculateSpeedIndex();this.fire(new o.x("speedindexcompleted",{speedIndex:Q})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||$||(this._fullyLoaded=!0,m.mark(d.fullLoad),this._performanceMetricsCollection&&Bn(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(b){for(const u of this._markers)b&&!this.getRenderWorldCopies()&&(u._lngLat=u._lngLat.wrap()),u._update();for(const u of this._popups)!b||this.getRenderWorldCopies()||u._trackPointer||(u._lngLat=u._lngLat.wrap()),u._update()}_updateAverageElevation(b,u=!1){const p=E=>(this.transform.averageElevation=E,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&p(0);const w=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(w||(u||b-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(b)){const E=this.transform.averageElevation;let P=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(P)?P=0:this._averageElevationLastSampledAt=b;const F=Math.abs(E-P);if(F>1){if(this._isInitialLoad||w)return this._averageElevation.jumpTo(P),p(P);this._averageElevation.easeTo(P,b,300)}else if(F>1e-4)return this._averageElevation.jumpTo(P),p(P)}return!!this._averageElevation.isEasing(b)&&p(this._averageElevation.getValue(b))}_authenticate(){Pe(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,b=>{if(b&&(b.message===Re||b.status===401)){const u=this.painter.context.gl;mn(u,!1),this._logoControl instanceof Ot&&this._logoControl._updateLogo(),u&&u.clear(u.DEPTH_BUFFER_BIT|u.COLOR_BUFFER_BIT|u.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.t(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Ht(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&rn(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const b=this._isDragging();this.painter.updateTerrain(this.style,b)}_calculateSpeedIndex(){const b=this.painter.canvasCopy(),u=this.painter.getCanvasCopiesAndTimestamps();u.timeStamps.push(performance.now());const p=this.painter.context.gl,w=p.createFramebuffer();function E(P){p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,P,0);const F=new Uint8Array(p.drawingBufferWidth*p.drawingBufferHeight*4);return p.readPixels(0,0,p.drawingBufferWidth,p.drawingBufferHeight,p.RGBA,p.UNSIGNED_BYTE,F),F}return p.bindFramebuffer(p.FRAMEBUFFER,w),this._canvasPixelComparison(E(b),u.canvasCopies.map(E),u.timeStamps)}_canvasPixelComparison(b,u,p){let w=p[1]-p[0];const E=b.length/4;for(let P=0;P<u.length;P++){const F=u[P];let W=0;for(let $=0;$<F.length;$+=4)F[$]===b[$]&&F[$+1]===b[$+1]&&F[$+2]===b[$+2]&&F[$+3]===b[$+3]&&(W+=1);w+=(p[P+2]-p[P+1])*(1-W/E)}return w}remove(){this._hash&&this._hash.remove();for(const u of this._controls)u.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const b=this.painter.context.gl.getExtension("WEBGL_lose_context");b&&b.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),$e.delete(this.painter.context.gl),Tn.remove(),at.remove(),this._removed=!0,this.fire(new o.x("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(b){this._renderNextFrame=this._renderNextFrame||b,this.style&&!this._frame&&(this._frame=o.q.frame(u=>{const p=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,p&&this._render(u)}))}_preloadTiles(b){const u=this.style?this.style.getSourceCaches():[];return o.bf(u,(p,w)=>p._preloadTiles(b,w),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(b){this._trackResize&&this.resize({originalEvent:b})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(b){this._showTileBoundaries!==b&&(this._showTileBoundaries=b,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(b){this._showParseStatus!==b&&(this._showParseStatus=b,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(b){this._showTerrainWireframe!==b&&(this._showTerrainWireframe=b,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(b){this._showLayers2DWireframe!==b&&(this._showLayers2DWireframe=b,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(b){this._showLayers3DWireframe!==b&&(this._showLayers3DWireframe=b,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(b){this._speedIndexTiming!==b&&(this._speedIndexTiming=b,this._update())}get showPadding(){return!!this._showPadding}set showPadding(b){this._showPadding!==b&&(this._showPadding=b,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(b){this._showCollisionBoxes!==b&&(this._showCollisionBoxes=b,this._tp.refreshUI(),b?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(b){this._showOverdrawInspector!==b&&(this._showOverdrawInspector=b,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(b){this._repaint!==b&&(this._repaint=b,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(b){this._vertices=b,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(b){this._showTileAABBs!==b&&(this._showTileAABBs=b,this._tp.refreshUI(),b&&this._update())}_setCacheLimits(b,u){o.dy(b,u)}get version(){return h}},NavigationControl:class{constructor(b={}){this.options=o.l({},Ir,b),this._container=C("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",u=>u.preventDefault()),this.options.showZoom&&(o.aJ(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",u=>{this._map&&this._map.zoomIn({},{originalEvent:u})}),C("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",u=>{this._map&&this._map.zoomOut({},{originalEvent:u})}),C("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.aJ(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",u=>{const p=this._map;p&&(this.options.visualizePitch?p.resetNorthPitch({},{originalEvent:u}):p.resetNorth({},{originalEvent:u}))}),this._compassIcon=C("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const b=this._map;if(!b)return;const u=b.getZoom(),p=u===b.getMaxZoom(),w=u===b.getMinZoom();this._zoomInButton.disabled=p,this._zoomOutButton.disabled=w,this._zoomInButton.setAttribute("aria-disabled",p.toString()),this._zoomOutButton.setAttribute("aria-disabled",w.toString())}_rotateCompassArrow(){const b=this._map;if(!b)return;const u=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(b.transform.pitch*(Math.PI/180)),.5)}) rotateX(${b.transform.pitch}deg) rotateZ(${b.transform.angle*(180/Math.PI)}deg)`:`rotate(${b.transform.angle*(180/Math.PI)}deg)`;b._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=u)})}onAdd(b){return this._map=b,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),b.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&b.on("pitch",this._rotateCompassArrow),b.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new co(b,this._compass,this.options.visualizePitch)),this._container}onRemove(){const b=this._map;b&&(this._container.remove(),this.options.showZoom&&b.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&b.off("pitch",this._rotateCompassArrow),b.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(b,u){const p=C("button",b,this._container);return p.type="button",p.addEventListener("click",u),p}_setButtonTitle(b,u){if(!this._map)return;const p=this._map._getUIString(`NavigationControl.${u}`);b.setAttribute("aria-label",p),b.firstElementChild&&b.firstElementChild.setAttribute("title",p)}},GeolocateControl:class extends o.E{constructor(b={}){super();const u=navigator.geolocation;this.options=o.l({geolocation:u},on,b),o.aJ(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Il(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(b){return this._map=b,this._container=C("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(b){const u=(p=!!this.options.geolocation)=>{this._supportsGeolocation=p,b(p)};this._supportsGeolocation!==void 0?b(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(p=>u(p.state!=="denied")).catch(()=>u()):u()}_isOutOfMapMaxBounds(b){const u=this._map.getMaxBounds(),p=b.coords;return!!u&&(p.longitude<u.getWest()||p.longitude>u.getEast()||p.latitude<u.getSouth()||p.latitude>u.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(b){if(this._map){if(this._isOutOfMapMaxBounds(b))return this._setErrorState(),this.fire(new o.x("outofmaxbounds",b)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=b,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(b),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(b),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.x("geolocate",b)),this._finish()}}_updateCamera(b){const u=new o.bK(b.coords.longitude,b.coords.latitude),p=b.coords.accuracy,w=this._map.getBearing(),E=o.l({bearing:w},this.options.fitBoundsOptions);this._map.fitBounds(u.toBounds(p),E,{geolocateSource:!0})}_updateMarker(b){if(b){const u=new o.bK(b.coords.longitude,b.coords.latitude);this._accuracyCircleMarker.setLngLat(u).addTo(this._map),this._userLocationDotMarker.setLngLat(u).addTo(this._map),this._accuracy=b.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const b=this._map.transform,u=o.bD(1,b._center.lat)*b.worldSize,p=Math.ceil(2*this._accuracy*u);this._circleElement.style.width=`${p}px`,this._circleElement.style.height=`${p}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(b){if(this._map){if(this.options.trackUserLocation)if(b.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const u=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",u),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",u),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(b.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.x("error",b)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(b){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",u=>u.preventDefault()),this._geolocateButton=C("button","mapboxgl-ctrl-geolocate",this._container),C("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",b===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const u=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",u),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",u)}else{const u=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",u),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",u)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=C("div","mapboxgl-user-location"),this._dotElement.appendChild(C("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(C("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Nt({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=C("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Nt({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",u=>{u.geolocateSource||this._watchState!=="ACTIVE_LOCK"||u.originalEvent&&u.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.x("trackuserlocationend")))})}}_onDeviceOrientation(b){this._userLocationDotMarker&&(b.webkitCompassHeading?this._heading=b.webkitCompassHeading:b.absolute===!0&&(this._heading=-1*b.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.x("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.x("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.x("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let b;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(b={maximumAge:6e5,timeout:0},this._noTimeout=!0):(b=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,b),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const b=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(u=>{u==="granted"&&b()}).catch(console.error):b()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:ft,ScaleControl:class{constructor(b={}){this.options=o.l({},rr,b),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),o.aJ(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const b=this.options.maxWidth||100,u=this._map,p=u._containerHeight/2,w=u._containerWidth/2-b/2,E=u.unproject([w,p]),P=u.unproject([w+b,p]),F=E.distanceTo(P);if(this.options.unit==="imperial"){const W=3.2808*F;W>5280?this._setScale(b,W/5280,"mile"):this._setScale(b,W,"foot")}else this.options.unit==="nautical"?this._setScale(b,F/1852,"nautical-mile"):F>=1e3?this._setScale(b,F/1e3,"kilometer"):this._setScale(b,F,"meter")}_setScale(b,u,p){this._map._requestDomTask(()=>{const w=function(P){const F=Math.pow(10,`${Math.floor(P)}`.length-1);let W=P/F;return W=W>=10?10:W>=5?5:W>=3?3:W>=2?2:W>=1?1:function($){const J=Math.pow(10,Math.ceil(-Math.log($)/Math.LN10));return Math.round($*J)/J}(W),F*W}(u),E=w/u;this._container.innerHTML=this._isNumberFormatSupported&&p!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:p}).format(w):`${w}&nbsp;${Rr[p]}`,this._container.style.width=b*E+"px"})}onAdd(b){return this._map=b,this._language=b.getLanguage(),this._container=C("div","mapboxgl-ctrl mapboxgl-ctrl-scale",b.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(b){this._language=b,this._update()}setUnit(b){this.options.unit=b,this._update()}},FullscreenControl:class{constructor(b={}){this._fullscreen=!1,b&&b.container&&(b.container instanceof HTMLElement?this._container=b.container:o.w("Full screen control 'container' must be a DOM element.")),o.aJ(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(b){return this._map=b,this._container||(this._container=this._map.getContainer()),this._controlContainer=C("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const b=this._fullscreenButton=C("button","mapboxgl-ctrl-fullscreen",this._controlContainer);C("span","mapboxgl-ctrl-icon",b).setAttribute("aria-hidden","true"),b.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const b=this._getTitle();this._fullscreenButton.setAttribute("aria-label",b),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",b)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends o.E{constructor(b){super(),this.options=o.l(Object.create(mi),b),o.aJ(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(b&&b.className?b.className.trim().split(/\s+/):[])}addTo(b){return this._map&&this.remove(),this._map=b,this.options.closeOnClick&&b.on("preclick",this._onClose),this.options.closeOnMove&&b.on("move",this._onClose),b.on("remove",this.remove),this._update(),b._addPopup(this),this._focusFirstElement(),this._trackPointer?(b.on("mousemove",this._onMouseEvent),b.on("mouseup",this._onMouseEvent),b._canvasContainer.classList.add("mapboxgl-track-pointer")):b.on("move",this._update),this.fire(new o.x("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const b=this._map;return b&&(b.off("move",this._update),b.off("move",this._onClose),b.off("preclick",this._onClose),b.off("click",this._onClose),b.off("remove",this.remove),b.off("mousemove",this._onMouseEvent),b.off("mouseup",this._onMouseEvent),b.off("drag",this._onMouseEvent),b._canvasContainer&&b._canvasContainer.classList.remove("mapboxgl-track-pointer"),b._removePopup(this),this._map=void 0),this.fire(new o.x("close")),this}getLngLat(){return this._lngLat}setLngLat(b){this._lngLat=o.bK.convert(b),this._pos=null,this._trackPointer=!1,this._update();const u=this._map;return u&&(u.on("move",this._update),u.off("mousemove",this._onMouseEvent),u._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const b=this._map;return b&&(b.off("move",this._update),b.on("mousemove",this._onMouseEvent),b.on("drag",this._onMouseEvent),b._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(b){return this.setDOMContent(document.createTextNode(b))}setHTML(b){const u=document.createDocumentFragment(),p=document.createElement("body");let w;for(p.innerHTML=b;w=p.firstChild,w;)u.appendChild(w);return this.setDOMContent(u)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(b){return this.options.maxWidth=b,this._update(),this}setDOMContent(b){let u=this._content;if(u)for(;u.hasChildNodes();)u.firstChild&&u.removeChild(u.firstChild);else u=this._content=C("div","mapboxgl-popup-content",this._container||void 0);if(u.appendChild(b),this.options.closeButton){const p=this._closeButton=C("button","mapboxgl-popup-close-button",u);p.type="button",p.setAttribute("aria-label","Close popup"),p.setAttribute("aria-hidden","true"),p.innerHTML="&#215;",p.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(b){return this._classList.add(b),this._updateClassList(),this}removeClassName(b){return this._classList.delete(b),this._updateClassList(),this}setOffset(b){return this.options.offset=b,this._update(),this}toggleClassName(b){let u;return this._classList.delete(b)?u=!1:(this._classList.add(b),u=!0),this._updateClassList(),u}_onMouseEvent(b){this._update(b.point)}_getAnchor(b){if(this.options.anchor)return this.options.anchor;const u=this._map,p=this._container,w=this._pos;if(!u||!p||!w)return"bottom";const E=p.offsetWidth,P=p.offsetHeight,F=w.x<E/2,W=w.x>u.transform.width-E/2;if(w.y+b<P)return F?"top-left":W?"top-right":"top";if(w.y>u.transform.height-P){if(F)return"bottom-left";if(W)return"bottom-right"}return F?"left":W?"right":"bottom"}_updateClassList(){const b=this._container;if(!b)return;const u=[...this._classList];u.push("mapboxgl-popup"),this._anchor&&u.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&u.push("mapboxgl-popup-track-pointer"),b.className=u.join(" ")}_update(b){const u=this._map,p=this._content;if(!u||!this._lngLat&&!this._trackPointer||!p)return;let w=this._container;if(w||(w=this._container=C("div","mapboxgl-popup",u.getContainer()),this._tip=C("div","mapboxgl-popup-tip",w),w.appendChild(p)),this.options.maxWidth&&w.style.maxWidth!==this.options.maxWidth&&(w.style.maxWidth=this.options.maxWidth),u.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=uo(this._lngLat,this._pos,u.transform)),!this._trackPointer||b){const E=this._pos=this._trackPointer&&b instanceof o.P?b:u.project(this._lngLat),P=Fi(this.options.offset),F=this._anchor=this._getAnchor(P.y),W=Fi(this.options.offset,F),$=E.add(W).round();u._requestDomTask(()=>{this._container&&F&&(this._container.style.transform=`${Xt[F]} translate(${$.x}px,${$.y}px)`)})}if(!this._marker&&u._showingGlobe()){const E=o.dz(u.transform,this._lngLat)?0:1;this._setOpacity(E)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const b=this._container.querySelector(ai);b&&b.focus()}_onClose(){this.remove()}_setOpacity(b){this._container&&(this._container.style.opacity=`${b}`),this._content&&(this._content.style.pointerEvents=b?"auto":"none")}},Marker:Nt,Style:ka,LngLat:o.bK,LngLatBounds:o.as,Point:o.P,MercatorCoordinate:o.a5,FreeCameraOptions:yo,Evented:o.E,config:o.e,prewarm:o.dE,clearPrewarmedResources:o.dF,get accessToken(){return o.e.ACCESS_TOKEN},set accessToken(b){o.e.ACCESS_TOKEN=b},get baseApiUrl(){return o.e.API_URL},set baseApiUrl(b){o.e.API_URL=b},get workerCount(){return o.dG.workerCount},set workerCount(b){o.dG.workerCount=b},get maxParallelImageRequests(){return o.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(b){o.e.MAX_PARALLEL_IMAGE_REQUESTS=b},clearStorage(b){o.dH(b)},get workerUrl(){return o.dI.workerUrl},set workerUrl(b){o.dI.workerUrl=b},get workerClass(){return o.dI.workerClass},set workerClass(b){o.dI.workerClass=b},get workerParams(){return o.dI.workerParams},set workerParams(b){o.dI.workerParams=b},get dracoUrl(){return o.dJ()},set dracoUrl(b){o.dK(b)},get meshoptUrl(){return o.dL()},set meshoptUrl(b){o.dM(b)},setNow:o.q.setNow,restoreNow:o.q.restoreNow}});var l=s;return l})})(Ile);var u6e=Ile.exports;const R0=rL(u6e),h6e=()=>{const n=Ae.useRef(null),e=Ae.useRef(null),t={lng:-74.5,lat:40,zoom:9,bearing:0,pitch:0},[r,i]=Ae.useState(t),s=()=>{e.current.flyTo({center:[t.lng,t.lat],zoom:t.zoom,bearing:t.bearing,pitch:t.pitch})};return Ae.useEffect(()=>(R0.accessToken="pk.eyJ1IjoibGlua2xpbmsiLCJhIjoiY2t5azNveG05MnRwdTJ4bzhxM2JmNGg3aCJ9.giuzL5T9qkSSl9EWMUK9dg",e.current=new R0.Map({container:n.current,center:[r.lng,r.lat],zoom:r.zoom,bearing:r.bearing,pitch:r.pitch}),e.current&&e.current.on("move",()=>{const a=e.current.getCenter();i({...r,lng:a.lng,lat:a.lat})}),e.current&&e.current.on("zoom",()=>{const a=e.current.getZoom();i({...r,zoom:a})}),e.current&&e.current.on("rotate",()=>{const a=e.current.getBearing();i({...r,bearing:a})}),e.current&&e.current.on("pitch",()=>{const a=e.current.getPitch();i({...r,pitch:a})}),()=>{e.current.remove()}),[]),me.jsxs("div",{children:[me.jsxs("div",{className:"absolute bottom-0 left-0 m-1 p-1 rounded-md bg-black-500 text-white z-10",children:["Longitude: ",r.lng.toFixed(4)," | Latitude: ",r.lat.toFixed(4)," | Zoom: ",r.zoom.toFixed(2)," | Bearing: ",r.bearing.toFixed(2)," | Pitch: ",r.pitch.toFixed(2),me.jsx("button",{className:"ml-6 bg-slate-500 rounded-md",onClick:s,children:"RESET"})]}),me.jsx("div",{className:"w-screen h-screen z-0",ref:n})]})};(function(){if(typeof window!="object")return;if("IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype){"isIntersecting"in window.IntersectionObserverEntry.prototype||Object.defineProperty(window.IntersectionObserverEntry.prototype,"isIntersecting",{get:function(){return this.intersectionRatio>0}});return}function n(k){try{return k.defaultView&&k.defaultView.frameElement||null}catch{return null}}var e=function(k){for(var j=k,q=n(j);q;)j=q.ownerDocument,q=n(j);return j}(window.document),t=[],r=null,i=null;function s(k){this.time=k.time,this.target=k.target,this.rootBounds=T(k.rootBounds),this.boundingClientRect=T(k.boundingClientRect),this.intersectionRect=T(k.intersectionRect||y()),this.isIntersecting=!!k.intersectionRect;var j=this.boundingClientRect,q=j.width*j.height,Z=this.intersectionRect,te=Z.width*Z.height;q?this.intersectionRatio=Number((te/q).toFixed(4)):this.intersectionRatio=this.isIntersecting?1:0}function a(k,j){var q=j||{};if(typeof k!="function")throw new Error("callback must be a function");if(q.root&&q.root.nodeType!=1&&q.root.nodeType!=9)throw new Error("root must be a Document or Element");this._checkForIntersections=o(this._checkForIntersections.bind(this),this.THROTTLE_TIMEOUT),this._callback=k,this._observationTargets=[],this._queuedEntries=[],this._rootMarginValues=this._parseRootMargin(q.rootMargin),this.thresholds=this._initThresholds(q.threshold),this.root=q.root||null,this.rootMargin=this._rootMarginValues.map(function(Z){return Z.value+Z.unit}).join(" "),this._monitoringDocuments=[],this._monitoringUnsubscribes=[]}a.prototype.THROTTLE_TIMEOUT=100,a.prototype.POLL_INTERVAL=null,a.prototype.USE_MUTATION_OBSERVER=!0,a._setupCrossOriginUpdater=function(){return r||(r=function(k,j){!k||!j?i=y():i=I(k,j),t.forEach(function(q){q._checkForIntersections()})}),r},a._resetCrossOriginUpdater=function(){r=null,i=null},a.prototype.observe=function(k){var j=this._observationTargets.some(function(q){return q.element==k});if(!j){if(!(k&&k.nodeType==1))throw new Error("target must be an Element");this._registerInstance(),this._observationTargets.push({element:k,entry:null}),this._monitorIntersections(k.ownerDocument),this._checkForIntersections()}},a.prototype.unobserve=function(k){this._observationTargets=this._observationTargets.filter(function(j){return j.element!=k}),this._unmonitorIntersections(k.ownerDocument),this._observationTargets.length==0&&this._unregisterInstance()},a.prototype.disconnect=function(){this._observationTargets=[],this._unmonitorAllIntersections(),this._unregisterInstance()},a.prototype.takeRecords=function(){var k=this._queuedEntries.slice();return this._queuedEntries=[],k},a.prototype._initThresholds=function(k){var j=k||[0];return Array.isArray(j)||(j=[j]),j.sort().filter(function(q,Z,te){if(typeof q!="number"||isNaN(q)||q<0||q>1)throw new Error("threshold must be a number between 0 and 1 inclusively");return q!==te[Z-1]})},a.prototype._parseRootMargin=function(k){var j=k||"0px",q=j.split(/\s+/).map(function(Z){var te=/^(-?\d*\.?\d+)(px|%)$/.exec(Z);if(!te)throw new Error("rootMargin must be specified in pixels or percent");return{value:parseFloat(te[1]),unit:te[2]}});return q[1]=q[1]||q[0],q[2]=q[2]||q[0],q[3]=q[3]||q[1],q},a.prototype._monitorIntersections=function(k){var j=k.defaultView;if(j&&this._monitoringDocuments.indexOf(k)==-1){var q=this._checkForIntersections,Z=null,te=null;this.POLL_INTERVAL?Z=j.setInterval(q,this.POLL_INTERVAL):(h(j,"resize",q,!0),h(k,"scroll",q,!0),this.USE_MUTATION_OBSERVER&&"MutationObserver"in j&&(te=new j.MutationObserver(q),te.observe(k,{attributes:!0,childList:!0,characterData:!0,subtree:!0}))),this._monitoringDocuments.push(k),this._monitoringUnsubscribes.push(function(){var ae=k.defaultView;ae&&(Z&&ae.clearInterval(Z),d(ae,"resize",q,!0)),d(k,"scroll",q,!0),te&&te.disconnect()});var ie=this.root&&(this.root.ownerDocument||this.root)||e;if(k!=ie){var se=n(k);se&&this._monitorIntersections(se.ownerDocument)}}},a.prototype._unmonitorIntersections=function(k){var j=this._monitoringDocuments.indexOf(k);if(j!=-1){var q=this.root&&(this.root.ownerDocument||this.root)||e,Z=this._observationTargets.some(function(se){var ae=se.element.ownerDocument;if(ae==k)return!0;for(;ae&&ae!=q;){var fe=n(ae);if(ae=fe&&fe.ownerDocument,ae==k)return!0}return!1});if(!Z){var te=this._monitoringUnsubscribes[j];if(this._monitoringDocuments.splice(j,1),this._monitoringUnsubscribes.splice(j,1),te(),k!=q){var ie=n(k);ie&&this._unmonitorIntersections(ie.ownerDocument)}}}},a.prototype._unmonitorAllIntersections=function(){var k=this._monitoringUnsubscribes.slice(0);this._monitoringDocuments.length=0,this._monitoringUnsubscribes.length=0;for(var j=0;j<k.length;j++)k[j]()},a.prototype._checkForIntersections=function(){if(!(!this.root&&r&&!i)){var k=this._rootIsInDom(),j=k?this._getRootRect():y();this._observationTargets.forEach(function(q){var Z=q.element,te=_(Z),ie=this._rootContainsTarget(Z),se=q.entry,ae=k&&ie&&this._computeTargetAndRootIntersection(Z,te,j),fe=null;this._rootContainsTarget(Z)?(!r||this.root)&&(fe=j):fe=y();var Se=q.entry=new s({time:l(),target:Z,boundingClientRect:te,rootBounds:fe,intersectionRect:ae});se?k&&ie?this._hasCrossedThreshold(se,Se)&&this._queuedEntries.push(Se):se&&se.isIntersecting&&this._queuedEntries.push(Se):this._queuedEntries.push(Se)},this),this._queuedEntries.length&&this._callback(this.takeRecords(),this)}},a.prototype._computeTargetAndRootIntersection=function(k,j,q){if(window.getComputedStyle(k).display!="none"){for(var Z=j,te=M(k),ie=!1;!ie&&te;){var se=null,ae=te.nodeType==1?window.getComputedStyle(te):{};if(ae.display=="none")return null;if(te==this.root||te.nodeType==9)if(ie=!0,te==this.root||te==e)r&&!this.root?!i||i.width==0&&i.height==0?(te=null,se=null,Z=null):se=i:se=q;else{var fe=M(te),Se=fe&&_(fe),Ee=fe&&this._computeTargetAndRootIntersection(fe,Se,q);Se&&Ee?(te=fe,se=I(Se,Ee)):(te=null,Z=null)}else{var Re=te.ownerDocument;te!=Re.body&&te!=Re.documentElement&&ae.overflow!="visible"&&(se=_(te))}if(se&&(Z=m(se,Z)),!Z)break;te=te&&M(te)}return Z}},a.prototype._getRootRect=function(){var k;if(this.root&&!B(this.root))k=_(this.root);else{var j=B(this.root)?this.root:e,q=j.documentElement,Z=j.body;k={top:0,left:0,right:q.clientWidth||Z.clientWidth,width:q.clientWidth||Z.clientWidth,bottom:q.clientHeight||Z.clientHeight,height:q.clientHeight||Z.clientHeight}}return this._expandRectByRootMargin(k)},a.prototype._expandRectByRootMargin=function(k){var j=this._rootMarginValues.map(function(Z,te){return Z.unit=="px"?Z.value:Z.value*(te%2?k.width:k.height)/100}),q={top:k.top-j[0],right:k.right+j[1],bottom:k.bottom+j[2],left:k.left-j[3]};return q.width=q.right-q.left,q.height=q.bottom-q.top,q},a.prototype._hasCrossedThreshold=function(k,j){var q=k&&k.isIntersecting?k.intersectionRatio||0:-1,Z=j.isIntersecting?j.intersectionRatio||0:-1;if(q!==Z)for(var te=0;te<this.thresholds.length;te++){var ie=this.thresholds[te];if(ie==q||ie==Z||ie<q!=ie<Z)return!0}},a.prototype._rootIsInDom=function(){return!this.root||C(e,this.root)},a.prototype._rootContainsTarget=function(k){var j=this.root&&(this.root.ownerDocument||this.root)||e;return C(j,k)&&(!this.root||j==k.ownerDocument)},a.prototype._registerInstance=function(){t.indexOf(this)<0&&t.push(this)},a.prototype._unregisterInstance=function(){var k=t.indexOf(this);k!=-1&&t.splice(k,1)};function l(){return window.performance&&performance.now&&performance.now()}function o(k,j){var q=null;return function(){q||(q=setTimeout(function(){k(),q=null},j))}}function h(k,j,q,Z){typeof k.addEventListener=="function"?k.addEventListener(j,q,Z):typeof k.attachEvent=="function"&&k.attachEvent("on"+j,q)}function d(k,j,q,Z){typeof k.removeEventListener=="function"?k.removeEventListener(j,q,Z):typeof k.detachEvent=="function"&&k.detachEvent("on"+j,q)}function m(k,j){var q=Math.max(k.top,j.top),Z=Math.min(k.bottom,j.bottom),te=Math.max(k.left,j.left),ie=Math.min(k.right,j.right),se=ie-te,ae=Z-q;return se>=0&&ae>=0&&{top:q,bottom:Z,left:te,right:ie,width:se,height:ae}||null}function _(k){var j;try{j=k.getBoundingClientRect()}catch{}return j?(j.width&&j.height||(j={top:j.top,right:j.right,bottom:j.bottom,left:j.left,width:j.right-j.left,height:j.bottom-j.top}),j):y()}function y(){return{top:0,bottom:0,left:0,right:0,width:0,height:0}}function T(k){return!k||"x"in k?k:{top:k.top,y:k.top,bottom:k.bottom,left:k.left,x:k.left,right:k.right,width:k.width,height:k.height}}function I(k,j){var q=j.top-k.top,Z=j.left-k.left;return{top:q,left:Z,height:j.height,width:j.width,bottom:q+j.height,right:Z+j.width}}function C(k,j){for(var q=j;q;){if(q==k)return!0;q=M(q)}return!1}function M(k){var j=k.parentNode;return k.nodeType==9&&k!=e?n(k):(j&&j.assignedSlot&&(j=j.assignedSlot.parentNode),j&&j.nodeType==11&&j.host?j.host:j)}function B(k){return k&&k.nodeType===9}window.IntersectionObserver=a,window.IntersectionObserverEntry=s})();function f6e(n,e=document){return typeof n=="string"?Array.from(e.querySelectorAll(n)):n instanceof Element?[n]:n instanceof NodeList?Array.from(n):n instanceof Array?n:[]}function d6e(n){const e=document.createElement("div");e.className=`scrollama__debug-step ${n}`,e.style.position="fixed",e.style.left="0",e.style.width="100%",e.style.zIndex="9999",e.style.borderTop="2px solid black",e.style.borderBottom="2px solid black";const t=document.createElement("p");return t.style.position="absolute",t.style.left="0",t.style.height="1px",t.style.width="100%",t.style.borderTop="1px dashed black",e.appendChild(t),document.body.appendChild(e),e}function p6e({id:n,step:e,marginTop:t}){const{index:r,height:i}=e,s=`scrollama__debug-step--${n}-${r}`;let a=document.querySelector(`.${s}`);a||(a=d6e(s)),a.style.top=`${t*-1}px`,a.style.height=`${i}px`,a.querySelector("p").style.top=`${i/2}px`}function m6e(){const n="abcdefghijklmnopqrstuvwxyz",e=Date.now(),t=[];for(let r=0;r<6;r+=1){const i=n[Math.floor(Math.random()*n.length)];t.push(i)}return`${t.join("")}${e}`}function uI(n){console.error(`scrollama error: ${n}`)}function iS(n){return+n.getAttribute("data-scrollama-index")}function g6e(n,e){const t=Math.ceil(n/e),r=[],i=1/t;for(let s=0;s<t+1;s+=1)r.push(s*i);return r}function Fk(n){if(typeof n=="string"&&n.indexOf("px")>0){const e=+n.replace("px","");return isNaN(e)?(err("offset value must be in 'px' format. Fallback to 0.5."),{format:"percent",value:.5}):{format:"pixels",value:e}}else if(typeof n=="number"||!isNaN(+n))return n>1&&err("offset value is greater than 1. Fallback to 1."),n<0&&err("offset value is lower than 0. Fallback to 0."),{format:"percent",value:Math.min(Math.max(0,n),1)};return null}function v6e(n){n.forEach(e=>e.node.setAttribute("data-scrollama-index",e.index))}function _6e(n){const{top:e}=n.getBoundingClientRect(),t=window.pageYOffset,r=document.body.clientTop||0;return e+t-r}let q1,ZI,_m;function Ple(n){const e=n?n.scrollTop:window.pageYOffset;q1!==e&&(q1=e,q1>ZI?_m="down":q1<ZI&&(_m="up"),ZI=q1)}function y6e(n){q1=0,ZI=0,document.addEventListener("scroll",()=>Ple(n))}function x6e(){let n={},e=m6e(),t=[],r,i,s,a=0,l=!1,o=!1,h=!1,d=!1,m=[];function _(){n={stepEnter:()=>{},stepExit:()=>{},stepProgress:()=>{}},m=[]}function y(Re){Re&&!l&&Se(),!Re&&l&&q(),l=Re}function T(Re,qe){const Le=iS(Re),dt=t[Le];qe!==void 0&&(dt.progress=qe);const ye={element:Re,index:Le,progress:qe,direction:_m};dt.state==="enter"&&n.stepProgress(ye)}function I(Re,qe=!0){const Le=iS(Re),dt=t[Le],ye={element:Re,index:Le,direction:_m};dt.direction=_m,dt.state="enter",m[Le]||n.stepEnter(ye),d&&(m[Le]=!0)}function C(Re,qe=!0){const Le=iS(Re),dt=t[Le];if(!dt.state)return!1;const ye={element:Re,index:Le,direction:_m};o&&(_m==="down"&&dt.progress<1?T(Re,1):_m==="up"&&dt.progress>0&&T(Re,0)),dt.direction=_m,dt.state="exit",n.stepExit(ye)}function M([Re]){const qe=iS(Re.target),Le=t[qe],dt=Re.target.offsetHeight;dt!==Le.height&&(Le.height=dt,j(Le),ie(Le),Z(Le))}function B([Re]){Ple(i);const{isIntersecting:qe,target:Le}=Re;qe?I(Le):C(Le)}function k([Re]){const qe=iS(Re.target),Le=t[qe],{isIntersecting:dt,intersectionRatio:ye,target:Xe}=Re;dt&&Le.state==="enter"&&T(Xe,ye)}function j({observers:Re}){Object.keys(Re).map(qe=>{Re[qe].disconnect()})}function q(){t.forEach(j)}function Z(Re){const qe=new ResizeObserver(M);qe.observe(Re.node),Re.observers.resize=qe}function te(){t.forEach(Z)}function ie(Re){const qe=window.innerHeight,Le=Re.offset||r,dt=Le.format==="pixels"?1:qe,ye=Le.value*dt,Xe=Re.height/2-ye,He=Re.height/2-(qe-ye),at={rootMargin:`${Xe}px 0px ${He}px 0px`,threshold:.5,root:s},Ht=new IntersectionObserver(B,at);Ht.observe(Re.node),Re.observers.step=Ht,h&&p6e({id:e,step:Re,marginTop:Xe,marginBottom:He})}function se(){t.forEach(ie)}function ae(Re){const qe=window.innerHeight,Le=Re.offset||r,dt=Le.format==="pixels"?1:qe,ye=Le.value*dt,Xe=-ye+Re.height,He=ye-qe,_t=`${Xe}px 0px ${He}px 0px`,wt=g6e(Re.height,a),Gt={rootMargin:_t,threshold:wt},at=new IntersectionObserver(k,Gt);at.observe(Re.node),Re.observers.progress=at}function fe(){t.forEach(ae)}function Se(){q(),te(),se(),o&&fe()}const Ee={};return Ee.setup=({step:Re,parent:qe,offset:Le=.5,threshold:dt=4,progress:ye=!1,once:Xe=!1,debug:He=!1,container:_t=void 0,root:wt=null})=>(y6e(_t),t=f6e(Re,qe).map((Gt,at)=>({index:at,direction:void 0,height:Gt.offsetHeight,node:Gt,observers:{},offset:Fk(Gt.dataset.offset),top:_6e(Gt),progress:0,state:void 0})),t.length?(o=ye,d=Xe,h=He,a=Math.max(1,+dt),r=Fk(Le),i=_t,s=wt,_(),v6e(t),y(!0),Ee):(uI("no step elements"),Ee)),Ee.enable=()=>(y(!0),Ee),Ee.disable=()=>(y(!1),Ee),Ee.destroy=()=>(y(!1),_(),Ee),Ee.resize=()=>(Se(),Ee),Ee.offset=Re=>Re==null?r.value:(r=Fk(Re),Se(),Ee),Ee.onStepEnter=Re=>(typeof Re=="function"?n.stepEnter=Re:uI("onStepEnter requires a function"),Ee),Ee.onStepExit=Re=>(typeof Re=="function"?n.stepExit=Re:uI("onStepExit requires a function"),Ee),Ee.onStepProgress=Re=>(typeof Re=="function"?n.stepProgress=Re:uI("onStepProgress requires a function"),Ee),Ee}const Lle=""+new URL("first period-Cjp1RjP4.jpeg",import.meta.url).href,$N=""+new URL("hui-Ao1uY3rr.jpeg",import.meta.url).href,Dle=""+new URL("naipiao-BUdMlmen.jpg",import.meta.url).href,I8=""+new URL("qindiao-CKTdrbCg.png",import.meta.url).href,Ble=""+new URL("quanqiu-DnDfEiIO.jpeg",import.meta.url).href,kle=""+new URL("quanqiuhua-CFNf60Po.jpeg",import.meta.url).href,R8=""+new URL("sanjuqingan-Bkq-CSnX.png",import.meta.url).href,P8=""+new URL("sanyuan-BxeIias_.png",import.meta.url).href,L8=""+new URL("sanyuanshangshi-DbcI-flH.jpeg",import.meta.url).href,D8=""+new URL("shangshi-CZtwHG4A.jpeg",import.meta.url).href,Ole=""+new URL("stage2-D7wGlXfP.png",import.meta.url).href,Fle=""+new URL("Thankyou-DonPtijT.jpeg",import.meta.url).href,Nle=""+new URL("zhiliang-CZ_P7IVS.jpeg",import.meta.url).href,b6e="pk.eyJ1IjoibGlua2xpbmsiLCJhIjoiY2t5azNveG05MnRwdTJ4bzhxM2JmNGg3aCJ9.giuzL5T9qkSSl9EWMUK9dg",qN=["mapbox://styles/linklink/cm2v9ot6s00fu01pwfs3q147j","mapbox://styles/linklink/cm2fmcw0200bb01ph6edf69ne","mapbox://styles/linklink/cl097w45i001o15mueqt9chmp"],Nl={style:qN[0],showMarkers:!1,markerColor:"#3FB1CE",inset:!0,theme:"dark",use3dTerrain:!1,title:"中 国 乳 业 百 年 路",byline:`自有文字以来，中国古籍中屡有关于乳的记载。至唐朝时，食用乳制品已比较普遍。虽然我国饲养奶畜、食用乳和乳制品的历史很悠久，但作为商品的奶业也不过一百多年的历史。

在这短短一百年里，中国乳业实现了从无到有，从有到强的伟大跨越。看得见的是乳业的腾飞，看不见的是国家政府、一代代民族企业家和广大人民的努力与坚持。

接下来，让我们将一起回到上世纪初的中国，跟随着时间的步伐，回顾这段中国乳业发展的奋斗史。`,footer:'Source: source citations, etc. <br> Created using <a href="https://github.com/mapbox/storytelling" target="_blank">Mapbox Storytelling</a> template.',chapters:[{id:"first-period",alignment:"fully",hidden:!1,title:"上世纪初至七十年代",description:'"雄关漫道真如铁，而今迈步从头越。"',image:Lle,location:{center:[122.418398,34.759483],zoom:4.5,pitch:0,bearing:0},mapType:0,mapAnimation:"flyTo",rotateAnimation:!1,callback:"",onChapterEnter:[],onChapterExit:[]},{id:"qindiao",alignment:"right",hidden:!1,title:"百好乳业：擒雕牌炼乳",image:I8,description:"&nbsp;&nbsp;&nbsp;&nbsp;百好乳业创建于1926年的浙江瑞安，是中国乳品工业的旗帜。<br/>&nbsp;&nbsp;&nbsp;&nbsp;在二十年代的中国市场上，国产炼乳加工业还是个空白，而英帝国纳司尔英瑞公司生产的飞鹰牌炼乳却随处可见。在兴办国货、创立实业的“五四”爱国精神鼓舞下，实业家吴百亨先生独资创办了中国第一家炼乳厂——百好乳品厂，与之相抗衡。</br>&nbsp;&nbsp;&nbsp;&nbsp;他是中国公认的乳品工业之父，打破了外商垄断我国炼乳市场的局面。</br>&nbsp;&nbsp;&nbsp;&nbsp;英瑞公司大为光火，欲用卑劣的手法破坏“白日擒雕”炼乳的声誉，接着又提出用10万收买“白日擒雕”商标权。而吴百亨先生回应：“我办百好厂，是为兴办国货，‘白日擒雕’商标权我绝不出卖。”，捍卫了国货商标的尊严，大长了中国人民的志气。",location:{center:[120.922941,27.893666],zoom:10,pitch:0,bearing:0},mapType:1,mapAnimation:"flyTo",rotateAnimation:!1,callback:"",onChapterEnter:[],onChapterExit:[]},{id:"sanyuan",alignment:"left",hidden:!1,title:"三元乳业",image:P8,description:"&nbsp;&nbsp;&nbsp;&nbsp;新中国成立之初，百废待兴，乳业起步维艰。北京市委、市政府把乳业列入经济发展计划，努力增加牛奶供应。<br/>&nbsp;&nbsp;&nbsp;&nbsp;1949年5月，老红军樊士成从革命老区西柏坡带着三头奶牛来到北京，这就是北京奶业的开端。<br/>&nbsp;&nbsp;&nbsp;&nbsp;1956年3月1日，国营北京市牛奶站正式成立。这就是北京三元食品股份有限公司的前身。",location:{center:[116.489303,39.923409],zoom:10,pitch:8.01,bearing:0},mapType:1,mapAnimation:"flyTo",rotateAnimation:!1,callback:"",onChapterEnter:[],onChapterExit:[]},{id:"first_conclusion",alignment:"fully",hidden:!1,title:"",image:Dle,description:"&nbsp;&nbsp;&nbsp;&nbsp;当时的牛奶是当之无愧的“奢侈品”。建国后，大城市里牛奶供给新生婴儿等特殊人群都不够，而对于广大农村地区来说，牛奶是非常遥远的存在。<br/>&nbsp;&nbsp;&nbsp;&nbsp;1958年毛主席和周总理嘱咐“要抓好牛奶生产，增加奶品供应，解决百姓特别是孩子的吃奶问题”。奶牛饲养纳入国家计划管理，我国奶业开始恢复生产。<br/>&nbsp;&nbsp;&nbsp;&nbsp;-------下拉后可以点击气泡查看详情------",location:{center:[116.418398,34.759483],zoom:4.5,pitch:8.01,bearing:0},mapType:0,mapAnimation:"flyTo",rotateAnimation:!1,callback:"",onChapterEnter:[],onChapterExit:[]},{id:"first_map",alignment:"right",hidden:!0,location:{center:[114.418398,34.759483],zoom:4.5,pitch:8.01,bearing:0},mapType:0,mapAnimation:"flyTo",rotateAnimation:!1,callback:"",onChapterEnter:[],onChapterExit:[]},{id:"second-stage",alignment:"fully",hidden:!1,image:Ole,description:"&nbsp;&nbsp;&nbsp;&nbsp;1949年-1978年，中国奶业恢复发展，改造、扩建和新建加工企业。至1978年，年产奶量达到97万吨，处于中低速爬坡期。<br/>&nbsp;&nbsp;&nbsp;&nbsp;改革开放带来了国内奶类消费市场迅速扩大，同时也刺激了奶类生产，从按需分配、计划时代逐渐走上了市场经济的时代。那些凭票买奶、奶牛进城、无消毒的牛奶悄然退出了生活的舞台，随之而来的是种目繁多、琳琅满目的牛奶，以及日渐扩大的市场。<br/>&nbsp;&nbsp;&nbsp;&nbsp;1978年改革开放启动了“国营、集体、个体”一起发展的先河，我国奶业步入跨越式发展阶段。<br/>&nbsp;&nbsp;&nbsp;&nbsp;在此期间，以本地厂家为主的“小而散”的市场格局逐步难以适应发展，开始打造全国性地乳业品牌。",location:{center:[113.586506,34.751115],zoom:4,pitch:0,bearing:0},mapType:2,mapAnimation:"flyTo",rotateAnimation:!1,callback:"",onChapterEnter:[],onChapterExit:[]},{id:"zhengce",alignment:"right",title:"政策支持",hidden:!1,image:Nle,description:"&nbsp;&nbsp;&nbsp;&nbsp;1984年7月，由国家经济委员会公告发布，首次将乳制品工业作为主要行业发展方向和重点，列入《1991年至2000年全国食品工业发展纲要》。",location:{center:[116.70918,40.142585],zoom:7,pitch:0,bearing:0},mapType:2,mapAnimation:"flyTo",rotateAnimation:!1,callback:"",onChapterEnter:[],onChapterExit:[]},{id:"yilishangshi",alignment:"left",title:"伊利上市",hidden:!1,image:D8,description:"&nbsp;&nbsp;&nbsp;&nbsp;1996年3月12日,伊利股份在上交所挂牌上市，成为中国乳业行业首家A股上市公司，牛奶不再是“奢侈品”，走进了千家万户。",location:{center:[111.74918,40.842585],zoom:10,pitch:0,bearing:0},mapType:2,mapAnimation:"flyTo",rotateAnimation:!1,callback:"",onChapterEnter:[],onChapterExit:[]},{id:"chengli",alignment:"fully",title:"市场转型下的酝酿",hidden:!1,image:$N,description:"&nbsp;&nbsp;&nbsp;&nbsp;1990年至1995年，国内消费品市场开始从卖方市场逐步向买方市场转换的过程中，与当时感性和冲动的消费行为相对应，这一时期的中国企业对营销的理解是非理性的，而且显得盲目躁动和急于事功，也导致乳品行业混乱的无序发展。<br/>&nbsp;&nbsp;&nbsp;&nbsp;1990年5月，在全国大中城市重点垦区奶业经济技术发展研讨会上，正式成立了“全国大中城市乳业协会”（即“中国乳业协会”前身）。<br/>&nbsp;&nbsp;&nbsp;&nbsp;1992年1月，中国乳协第一次代表大会暨首届年会在北京召开。<br/>&nbsp;&nbsp;&nbsp;&nbsp;-------下拉后可以点击气泡查看详情------",location:{center:[113.586506,34.751115],zoom:4,pitch:0,bearing:0},mapType:2,mapAnimation:"flyTo",rotateAnimation:!1,callback:"",onChapterEnter:[],onChapterExit:[]},{id:"second-map",alignment:"left",title:"",hidden:!0,image:$N,location:{center:[113.586506,34.751115],zoom:4,pitch:0,bearing:0},mapType:2,mapAnimation:"flyTo",rotateAnimation:!1,callback:"",onChapterEnter:[],onChapterExit:[]},{id:"third-stage",alignment:"fully",title:"21世纪后",hidden:!1,image:Ble,description:"&nbsp;&nbsp;&nbsp;&nbsp;在新世纪中，中国乳业蓬勃发展，也遇到了许多新的挑战。三聚氰胺事件使中国乳业吸取了教训，完成了从追求效益到追求质量、坚持人民至上的商业理念转型。中国乳业也在走向全球化，不仅是商品销往国外，更有与众多机构的合作、给处于危境中的国家提供帮助。<br/>&nbsp;&nbsp;&nbsp;&nbsp;世界正在看见中国乳业的力量。",location:{center:[113.586506,34.751115],zoom:4,pitch:0,bearing:0},mapType:3,mapAnimation:"flyTo",rotateAnimation:!1,callback:"",onChapterEnter:[],onChapterExit:[]},{id:"sanyuan2",alignment:"right",title:"三元食品领军",hidden:!1,image:L8,description:"&nbsp;&nbsp;&nbsp;&nbsp;1984年，三元生产出国内的第一杯工业化酸奶；<br/>&nbsp;&nbsp;&nbsp;&nbsp;1985年生产出第一块工业化奶酪，改变我国奶酪依靠进口的历史；<br/>&nbsp;&nbsp;&nbsp;&nbsp;1997年生产第一包早餐奶，乳业市场进入细分时代；<br/>&nbsp;&nbsp;&nbsp;&nbsp;1997年整合优质奶业资源和麦当劳50%权益后，北京三元食品有限公司成立，作为北京控股有限公司成员在香港上市，标志着三元食品进入了现代乳业发展新阶段。",location:{center:[116.74918,40.842585],zoom:7,pitch:0,bearing:0},mapType:3,mapAnimation:"flyTo",rotateAnimation:!1,callback:"",onChapterEnter:[],onChapterExit:[]},{id:"sanju",alignment:"left",title:"三聚氰胺事件",hidden:!1,image:R8,description:"&nbsp;&nbsp;&nbsp;&nbsp;2008年，三聚氰胺事件重创中国乳业，消费者对国产奶粉的信任崩塌。这次食品安全事故导致多名食用三鹿集团生产的婴幼儿奶粉的婴儿被发现患有肾结石。<br/>&nbsp;&nbsp;&nbsp;&nbsp;事件引起各国的高度关注和对乳制品安全的担忧。中国国家质检总局公布对国内的乳制品厂家生产的婴幼儿奶粉的三聚氰胺检验报告后，事件迅速恶化，包括伊利、蒙牛、光明、圣元及雅士利在内的多个厂家的奶粉都检出三聚氰胺。该事件亦重创中国制造商品信誉，多个国家禁止了中国乳制品进口。",location:{center:[114.586506,38.151115],zoom:7,pitch:0,bearing:0},mapType:3,mapAnimation:"flyTo",rotateAnimation:!1,callback:"",onChapterEnter:[],onChapterExit:[]},{id:"international",alignment:"fully",title:"中国乳业拥抱全球化",hidden:!1,image:kle,description:"<br/>&nbsp;&nbsp;&nbsp;&nbsp;-------下拉后可以鼠标放在迁徙线上查看详情------",location:{center:[113.586506,34.751115],zoom:4,pitch:0,bearing:0},mapType:3,mapAnimation:"flyTo",rotateAnimation:!1,callback:"",onChapterEnter:[],onChapterExit:[]},{id:"third-map",alignment:"fully",hidden:!0,location:{center:[114.586506,38.151115],zoom:3,pitch:0,bearing:0},mapType:4,mapAnimation:"flyTo",rotateAnimation:!1,callback:"",onChapterEnter:[],onChapterExit:[]},{id:"Thankyou",alignment:"fully",title:"感谢观看！",hidden:!1,image:Fle,description:"&nbsp;&nbsp;&nbsp;&nbsp;百年乳业，代代传承；再创辉煌，还看今朝。<br/>&nbsp;&nbsp;&nbsp;&nbsp;时光机就到这里了，请移步其它板块继续浏览今天的中国乳业发展故事。",location:{center:[113.586506,34.751115],zoom:4,pitch:0,bearing:0},mapType:0,mapAnimation:"flyTo",rotateAnimation:!1,callback:"",onChapterEnter:[],onChapterExit:[]}]},zle=""+new URL("bashi-j4Q9hrvQ.png",import.meta.url).href,Ule=""+new URL("bifengtang-yZIlcoLv.jpeg",import.meta.url).href,Vle=""+new URL("guangming-Ch0sfKFV.png",import.meta.url).href,B8=""+new URL("guangze-COXCU3fq.png",import.meta.url).href,Gle=""+new URL("hongxing-TMciPCkF.png",import.meta.url).href,Hle=""+new URL("sanyuan2-ek_zenH7.jpeg",import.meta.url).href,jle=""+new URL("song-DXjP89Jt.png",import.meta.url).href,Wle=""+new URL("wandashan-CrxNEfy8.png",import.meta.url).href,Xle=""+new URL("weigang-CEFEuaeN.png",import.meta.url).href,$le=""+new URL("wushilan-CQSBRYUS.jpeg",import.meta.url).href,qle=""+new URL("xiaoxiniu-CJwZNYCM.jpeg",import.meta.url).href,Zle=""+new URL("xiyuchun-BftcuwaV.png",import.meta.url).href,Yle=""+new URL("yili-xXFaKPoe.jpeg",import.meta.url).href,Kle=""+new URL("youzhiyou-DEWmaBTZ.jpeg",import.meta.url).href;var w6e={type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Point",coordinates:[120.722941,27.793666]},properties:{title:"百好乳业：擒雕牌炼乳",description:"&nbsp;&nbsp;&nbsp;&nbsp;创建于1926年的浙江瑞安。<br/>&nbsp;&nbsp;&nbsp;&nbsp;是中国乳品工业的旗帜，打破了外商垄断我国炼乳市场的局面。",image:I8,imageHeight:170,imageWidth:220}},{type:"Feature",geometry:{type:"Point",coordinates:[116.489303,39.923409]},properties:{title:"三元乳业",description:"&nbsp;&nbsp;&nbsp;&nbsp;新中国成立之初，百废待兴，乳业起步维艰。北京市委、市政府把乳业列入经济发展计划，努力增加牛奶供应。<br/>&nbsp;&nbsp;&nbsp;&nbsp;1949年5月，老红军樊士成从革命老区西柏坡带着三头奶牛来到北京，这就是北京奶业的开端。<br/>&nbsp;&nbsp;&nbsp;&nbsp;1956年3月1日，国营北京市牛奶站正式成立。这就是北京三元食品股份有限公司的前身。",image:P8,imageHeight:130,imageWidth:220}},{type:"Feature",geometry:{type:"Point",coordinates:[121.419303,30.923409]},properties:{title:"光明乳业：光明牌全脂奶粉",description:"&nbsp;&nbsp;&nbsp;&nbsp;创建于1952年的上海。<br/>&nbsp;&nbsp;&nbsp;&nbsp;诞生于十里洋场的光明，最初为了宣传改装了一辆汽车。车头贴着“光明问世”四个大字和火炬形商标，车上的几名工人用大喇叭向路人宣传：“国营工厂是人民的工厂，请食用自己工厂的产品。”<br/>&nbsp;&nbsp;&nbsp;&nbsp;汽车缓缓开过上海的繁华路段，一举成名。",image:Vle,imageHeight:200,imageWidth:220}},{type:"Feature",geometry:{type:"Point",coordinates:[129.589303,44.603409]},properties:{title:"红星乳业：红星奶粉",description:"&nbsp;&nbsp;&nbsp;&nbsp;创建于1952年的牡丹江。<br/>&nbsp;&nbsp;&nbsp;&nbsp;上世纪50-80年代就开始出口国外，被誉为中国乳品业的摇篮。",image:Gle,imageHeight:100,imageWidth:220}},{type:"Feature",geometry:{type:"Point",coordinates:[118.847752,32.046235]},properties:{title:"卫岗牧场",description:"&nbsp;&nbsp;&nbsp;&nbsp;1928年，国民政府在南京东郊卫岗建立了国民革命军遗族学校，由宋氏姐妹负责管理。宋氏姐妹深受孙中山先生“博爱民生”的思想影响，用行动扮演着“妈妈”的角色，把那些战争下的遗孤都当作自己的孩子。<br/>&nbsp;&nbsp;&nbsp;&nbsp;与此同时，为了给他们营造一个更好的成长与生活环境，宋氏姐妹从国外引入75头荷斯坦奶牛,以此形成了卫岗乳业的前身。<br/>&nbsp;&nbsp;&nbsp;&nbsp;作为彼时全国第一家也是唯一一家由国民政府创办的奶牛场，宋氏姐妹对卫岗牧场的创建始终亲力亲为，她们采取了许多西方的先进理念并用于牧场管理。",image:jle,imageHeight:130,imageWidth:220}},{type:"Feature",geometry:{type:"Point",coordinates:[87.419303,43.923409]},properties:{title:"西域春乳业",description:"&nbsp;&nbsp;&nbsp;&nbsp;创建于1955年的乌鲁木齐。<br/>&nbsp;&nbsp;&nbsp;&nbsp;初期主要是发展畜牧业，以解决首府各族人民的饮奶需要。<br/>&nbsp;&nbsp;&nbsp;&nbsp;在乌鲁木齐人记忆中，西域春牛奶几乎伴随了几代人的成长。从60年代初开始,西域春牛奶就出现在千家万户的餐桌上。",image:Zle,imageHeight:100,imageWidth:220}},{type:"Feature",geometry:{type:"Point",coordinates:[126.686109,45.738561]},properties:{title:"完达山乳业",description:"&nbsp;&nbsp;&nbsp;&nbsp;创建于1958年的完达山。<br/>&nbsp;&nbsp;&nbsp;&nbsp;当时时任农垦部部长的王震将军率10万转业官兵开发建设北大荒。根据开国领袖毛泽东“让娃娃们长高一寸”的美好愿望，1963年，在周恩来总理的帮助下从北京、上海调运了750头奶牛，在完达山脚下建立了八五一一农场奶牛养殖示范基地。",image:Wle,imageHeight:100,imageWidth:220}},{type:"Feature",geometry:{type:"Point",coordinates:[110.9736,41.1272]},properties:{title:"伊利乳业",description:"&nbsp;&nbsp;&nbsp;&nbsp;创建于1956年的呼和浩特。<br/>&nbsp;&nbsp;&nbsp;&nbsp;当时成立的名称叫做呼和浩特回民区养牛合作小组，这就是伊利乳业集团的前身。",image:Yle,imageHeight:100,imageWidth:220}},{type:"Feature",geometry:{type:"Point",coordinates:[116.308198,39.869373]},properties:{title:"巴氏低温消毒奶",description:"&nbsp;&nbsp;&nbsp;&nbsp;1952年,李贻赞研制出巴氏低温消毒奶。<br/>&nbsp;&nbsp;&nbsp;&nbsp;这结束了北京没有消毒牛奶的历史。这种消毒方法现仍在“三元”牛奶的加工程序中使用。",image:zle,imageHeight:100,imageWidth:220}},{type:"Feature",geometry:{type:"Point",coordinates:[117.318198,39.259373]},properties:{title:"质量标准制订",description:"&nbsp;&nbsp;&nbsp;&nbsp;1958年8月，轻工业部食品工业局颁布《乳、乳制品质量标准及检验方法》。<br/>&nbsp;&nbsp;&nbsp;&nbsp;该标准是最早的国家级部颁标准。",image:B8,imageHeight:100,imageWidth:220}}]},S6e={type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Point",coordinates:[111.74918,40.842585]},properties:{title:"伊利股份上市",description:"&nbsp;&nbsp;&nbsp;&nbsp;1996年3月12日,伊利股份在上交所挂牌上市，成为中国乳业行业首家A股上市公司。<br/>&nbsp;&nbsp;&nbsp;&nbsp;牛奶不再是“奢侈品”，走进了千家万户。",image:D8,imageHeight:120,imageWidth:220}},{type:"Feature",geometry:{type:"Point",coordinates:[118.847752,32.046235]},properties:{title:"卫岗乳业",description:"&nbsp;&nbsp;&nbsp;&nbsp;在1949年至1983年期间，卫岗先后经历了部队接管、政府有关部门托管、公私合营、国营等社会主义改造，逐步由一个作坊式的企业发展成为集奶牛生产、乳品加工、市场销售为一体的牛奶专营企业。",image:Xle,imageHeight:100,imageWidth:220}},{type:"Feature",geometry:{type:"Point",coordinates:[121.586506,38.151115]},properties:{title:"广泽乳业",description:"&nbsp;&nbsp;&nbsp;&nbsp;广泽乳业成立于2001年，恒牛乳业是它的前身。",image:B8,imageHeight:170,imageWidth:220}},{type:"Feature",geometry:{type:"Point",coordinates:[116.70918,40.142585]},properties:{title:"三元乳业",description:"&nbsp;&nbsp;&nbsp;&nbsp;1997年整合优质奶业资源和麦当劳50%权益后北京三元食品有限公司成立，作为北京控股有限公司成员在香港上市，标志着三元食品进入了现代奶业发展新阶段；2001年改制成为北京三元食品股份有限公司；2003年在上海证券交易所挂牌上市。",image:Hle,imageHeight:100,imageWidth:220}},{type:"Feature",geometry:{type:"Point",coordinates:[114.70918,30.142585]},properties:{title:"避风塘奶茶",description:"&nbsp;&nbsp;&nbsp;&nbsp;1998年6月4日，上海避风塘茶楼有限公司在上海江宁路99号以“避风塘”为字号，开出第一家上海避风塘茶楼江宁店。<br/>&nbsp;&nbsp;&nbsp;&nbsp;这是大陆地区现代第一家连锁的奶茶店，自此，乳制品中的奶茶产品赛道正式诞生了。",image:Ule,imageHeight:100,imageWidth:220}},{type:"Feature",geometry:{type:"Point",coordinates:[110.586506,31.151115]},properties:{title:"友芝友乳业",description:"&nbsp;&nbsp;&nbsp;&nbsp;友芝友乳业成立于1998年。",image:Kle,imageHeight:200,imageWidth:200}},{type:"Feature",geometry:{type:"Point",coordinates:[123.586506,23.151115]},properties:{title:"50岚奶茶",description:"&nbsp;&nbsp;&nbsp;&nbsp;50岚，自1994年始于台南德兴路路边的一个小摊子。",image:$le,imageHeight:200,imageWidth:180}},{type:"Feature",geometry:{type:"Point",coordinates:[101.586506,36.751115]},properties:{title:"小西牛",description:"&nbsp;&nbsp;&nbsp;&nbsp;青海小西牛生物乳业股份有限公司成立于2002年。",image:qle,imageHeight:200,imageWidth:200}}]},A6e={type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Point",coordinates:[114.586506,38.151115]},properties:{title:"三聚氰胺事件",description:"&nbsp;&nbsp;&nbsp;&nbsp;2008年，三聚氰胺事件重创中国乳业，消费者对国产奶粉的信任崩塌。这次食品安全事故导致多名食用三鹿集团生产的婴幼儿奶粉的婴儿被发现患有肾结石。<br/>&nbsp;&nbsp;&nbsp;&nbsp;事件引起各国的高度关注和对乳制品安全的担忧。中国国家质检总局公布对国内的乳制品厂家生产的婴幼儿奶粉的三聚氰胺检验报告后，事件迅速恶化，包括伊利、蒙牛、光明、圣元及雅士利在内的多个厂家的奶粉都检出三聚氰胺。该事件亦重创中国制造商品信誉，多个国家禁止了中国乳制品进口。",image:R8,imageHeight:170,imageWidth:220}},{type:"Feature",geometry:{type:"Point",coordinates:[116.74918,40.842585]},properties:{title:"三元食品",description:"&nbsp;&nbsp;&nbsp;&nbsp;1984年，三元生产出国内的第一杯工业化酸奶；<br/>&nbsp;&nbsp;&nbsp;&nbsp;1985年生产出第一块工业化奶酪，改变我国奶酪依靠进口的历史；<br/>&nbsp;&nbsp;&nbsp;&nbsp;1997年生产第一包早餐奶，乳业市场进入细分时代；<br/>&nbsp;&nbsp;&nbsp;&nbsp;1997年整合优质奶业资源和麦当劳50%权益后，北京三元食品有限公司成立，作为北京控股有限公司成员在香港上市，标志着三元食品进入了现代乳业发展新阶段。",image:L8,imageHeight:120,imageWidth:220}}]},T6e={type:"FeatureCollection",features:[]};const M6e=[null,w6e,S6e,A6e,T6e],C6e=()=>{const n=Ae.useRef(null);let e=Ae.useRef(null);const t=Ae.useRef(null),r=Ae.useRef(null),i=Ae.useRef(null);let s=!0,a=[],l=0;const o={fill:["fill-opacity"],line:["line-opacity"],circle:["circle-opacity","circle-stroke-opacity"],symbol:["icon-opacity","text-opacity"],raster:["raster-opacity"],"fill-extrusion":["fill-extrusion-opacity"],heatmap:["heatmap-opacity"]},h={left:"lefty",center:"centered",right:"righty",full:"fully"},d=C=>{let M=n.current.getLayer(C).type;return o[M]},m=C=>{d(C.layer).forEach(B=>{let k={};if(C.duration){let j=B+"-transition";k={duration:C.duration},n.current.setPaintProperty(C.layer,j,k)}n.current.setPaintProperty(C.layer,B,C.opacity,k)})},_=C=>{const B=C.indexOf("?")!==-1?"&pluginName=scrollytellingV2":"?pluginName=scrollytellingV2";return{url:C+B}},y=C=>{e.current.addSource("boundsSource",{type:"geojson",data:C}),e.current.addLayer({id:"boundsLayer",type:"fill",source:"boundsSource",layout:{},paint:{"fill-color":"#fff","fill-opacity":.2}}),e.current.addLayer({id:"outlineLayer",type:"line",source:"boundsSource",layout:{},paint:{"line-color":"#000","line-width":1}})},T=C=>{e.current.getSource("boundsSource").setData(C)},I=()=>{let C=n.current.getBounds(),M={type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[C._sw.lng,C._sw.lat],[C._ne.lng,C._sw.lat],[C._ne.lng,C._ne.lat],[C._sw.lng,C._ne.lat],[C._sw.lng,C._sw.lat]]]}}]};s?(y(M),s=!1):T(M)};return Ae.useEffect(()=>{R0.accessToken=b6e,n.current=new R0.Map({container:r.current,style:qN[l],center:Nl.chapters[0].location.center,zoom:Nl.chapters[0].location.zoom,bearing:Nl.chapters[0].location.bearing,pitch:Nl.chapters[0].location.pitch,interactive:!1,transformRequest:_,projection:Nl.projection});const C=new R0.NavigationControl({showCompass:!0,showZoom:!0});n.current.addControl(C,"top-left"),e.current=new R0.Map({container:t.current,style:"mapbox://styles/mapbox/dark-v10",center:Nl.chapters[0].location.center,zoom:3,hash:!1,interactive:!1,attributionControl:!1});let M=x6e();n.current.on("load",()=>{n.current.on("move",I),n.current.dragPan.enable(),n.current.keyboard.enable(),M.setup({step:".step",offset:.5}).onStepEnter(B=>{const k=Nl.chapters.find(j=>j.id===B.element.id);if(B.element.classList.add("active"),n.current[k.mapAnimation||"flyTo"](k.location),k.mapType!==l&&(l=k.mapType,l!==0)){if(n.current.setStyle(qN[l]),a!==null)for(let j=a.length-1;j>=0;j--)a[j].remove();for(let j of M6e[l].features){let q=document.createElement("div");q.className="marker",q.style.backgroundImage="url("+j.properties.image+")",q.style.height="50px",q.style.width="50px",a.push(new R0.Marker(q).setLngLat(j.geometry.coordinates).setPopup(new R0.Popup({closeButton:!1,offset:25}).setHTML(`<h3>${j.properties.title}</h3><img src=${j.properties.image} height=${j.properties.imageHeight} width=${j.properties.imageWidth}><p>${j.properties.description}</p>`)).addTo(n.current))}}k.location.zoom<5?e.current.flyTo({center:k.location.center,zoom:0}):e.current.flyTo({center:k.location.center,zoom:3}),k.onChapterEnter.length>0&&k.onChapterEnter.forEach(m),k.callback&&window[k.callback](),k.rotateAnimation&&n.current.once("moveend",()=>{const j=n.current.getBearing();n.current.rotateTo(j+180,{duration:3e4,easing:function(q){return q}})})}).onStepExit(B=>{let k=Nl.chapters.find(j=>j.id===B.element.id);B.element.classList.remove("active"),k.onChapterExit.length>0&&k.onChapterExit.forEach(m)})})},[]),me.jsxs("div",{className:"w-screen h-screen",children:[me.jsx("div",{className:"w-full h-full fixed",ref:r}),me.jsx("div",{className:"top-20 right-4 h-40 w-60 fixed pointer-events-none transition-opacity ease-in-out",ref:t}),me.jsxs("div",{className:"box-content",ref:i,children:[me.jsxs("div",{className:`z-5 top-20 full-bar relative ${Nl.theme}`,children:[me.jsxs("h1",{className:"m-0 p-4 text-center leading-8",children:[" ",Nl.title," "]}),Nl.subtitle&&me.jsx("h2",{className:"m-0 p-4 text-center",children:Nl.subtitle}),me.jsx("p",{className:"m-0 p-4 text-center leading-8",children:Nl.byline})]}),me.jsx("div",{className:"z-5 w-full relative",children:Nl.chapters.map((C,M)=>me.jsxs("div",{id:C.id,className:`p-4 dark step card ${M===0?"active":""} ${C.hidden?"hidden":""} ${h[C.alignment]||"centered"}`,children:[C.title&&me.jsx("h2",{children:C.title}),C.image&&me.jsx("img",{src:C.image,alt:C.title}),C.description&&me.jsx("p",{children:C.description})]},M))}),me.jsx("p",{className:`w-full min-h-5 py-2 text-center text-sm ${Nl.theme}`,children:Nl.footer})]})]})},E6e=()=>me.jsxs("div",{className:"absolute top-20 w-full",children:[me.jsx("h1",{className:"font-bold text-3xl text-center",children:"HTML+CSS  可视化"}),me.jsx("h2",{className:"font-bold text-xl pl-3",children:"柱状图"}),me.jsxs("div",{className:"barGraph",children:[me.jsx("div",{}),me.jsx("div",{}),me.jsx("div",{}),me.jsx("div",{}),me.jsx("div",{})]}),me.jsx("h2",{className:"font-bold text-xl pl-3",children:"饼图"}),me.jsxs("div",{className:"pieGraph",children:[me.jsx("div",{}),me.jsx("div",{}),me.jsx("div",{}),me.jsx("div",{}),me.jsx("div",{})]})]}),I6e="China",R6e=[{name:"上海",children:[{name:"上海市",children:[{name:"黄浦区"},{name:"徐汇区"},{name:"长宁区"},{name:"静安区"},{name:"普陀区"},{name:"闸北区"},{name:"虹口区"},{name:"杨浦区"},{name:"闵行区"},{name:"宝山区"},{name:"嘉定区"},{name:"浦东新区"},{name:"金山区"},{name:"松江区"},{name:"青浦区"},{name:"奉贤区"}]},{name:"上海郊县",children:[{name:"崇明区"}]}]},{name:"北京",children:[{name:"北京市",children:[{name:"东城区"},{name:"西城区"},{name:"朝阳区"},{name:"丰台区"},{name:"石景山区"},{name:"海淀区"},{name:"门头沟区"},{name:"房山区"},{name:"通州区"},{name:"顺义区"},{name:"昌平区"},{name:"大兴区"},{name:"怀柔区"},{name:"平谷区"}]},{name:"北京郊县",children:[{name:"密云区"},{name:"延庆区"}]}]}],P6e={name:I6e,children:R6e};function L6e(n){var e=0,t=n.children,r=t&&t.length;if(!r)e=1;else for(;--r>=0;)e+=t[r].value;n.value=e}function D6e(){return this.eachAfter(L6e)}function B6e(n,e){let t=-1;for(const r of this)n.call(e,r,++t,this);return this}function k6e(n,e){for(var t=this,r=[t],i,s,a=-1;t=r.pop();)if(n.call(e,t,++a,this),i=t.children)for(s=i.length-1;s>=0;--s)r.push(i[s]);return this}function O6e(n,e){for(var t=this,r=[t],i=[],s,a,l,o=-1;t=r.pop();)if(i.push(t),s=t.children)for(a=0,l=s.length;a<l;++a)r.push(s[a]);for(;t=i.pop();)n.call(e,t,++o,this);return this}function F6e(n,e){let t=-1;for(const r of this)if(n.call(e,r,++t,this))return r}function N6e(n){return this.eachAfter(function(e){for(var t=+n(e.data)||0,r=e.children,i=r&&r.length;--i>=0;)t+=r[i].value;e.value=t})}function z6e(n){return this.eachBefore(function(e){e.children&&e.children.sort(n)})}function U6e(n){for(var e=this,t=V6e(e,n),r=[e];e!==t;)e=e.parent,r.push(e);for(var i=r.length;n!==t;)r.splice(i,0,n),n=n.parent;return r}function V6e(n,e){if(n===e)return n;var t=n.ancestors(),r=e.ancestors(),i=null;for(n=t.pop(),e=r.pop();n===e;)i=n,n=t.pop(),e=r.pop();return i}function G6e(){for(var n=this,e=[n];n=n.parent;)e.push(n);return e}function H6e(){return Array.from(this)}function j6e(){var n=[];return this.eachBefore(function(e){e.children||n.push(e)}),n}function W6e(){var n=this,e=[];return n.each(function(t){t!==n&&e.push({source:t.parent,target:t})}),e}function*X6e(){var n=this,e,t=[n],r,i,s;do for(e=t.reverse(),t=[];n=e.pop();)if(yield n,r=n.children)for(i=0,s=r.length;i<s;++i)t.push(r[i]);while(t.length)}function k8(n,e){n instanceof Map?(n=[void 0,n],e===void 0&&(e=Z6e)):e===void 0&&(e=q6e);for(var t=new $P(n),r,i=[t],s,a,l,o;r=i.pop();)if((a=e(r.data))&&(o=(a=Array.from(a)).length))for(r.children=a,l=o-1;l>=0;--l)i.push(s=a[l]=new $P(a[l])),s.parent=r,s.depth=r.depth+1;return t.eachBefore(K6e)}function $6e(){return k8(this).eachBefore(Y6e)}function q6e(n){return n.children}function Z6e(n){return Array.isArray(n)?n[1]:null}function Y6e(n){n.data.value!==void 0&&(n.value=n.data.value),n.data=n.data.data}function K6e(n){var e=0;do n.height=e;while((n=n.parent)&&n.height<++e)}function $P(n){this.data=n,this.depth=this.height=0,this.parent=null}$P.prototype=k8.prototype={constructor:$P,count:D6e,each:B6e,eachAfter:O6e,eachBefore:k6e,find:F6e,sum:N6e,sort:z6e,path:U6e,ancestors:G6e,descendants:H6e,leaves:j6e,links:W6e,copy:$6e,[Symbol.iterator]:X6e};function J6e(n){return n==null?null:Q6e(n)}function Q6e(n){if(typeof n!="function")throw new Error;return n}function oK(){return 0}function eUe(n){return function(){return n}}const tUe=1664525,nUe=1013904223,aK=4294967296;function rUe(){let n=1;return()=>(n=(tUe*n+nUe)%aK)/aK}function iUe(n){return typeof n=="object"&&"length"in n?n:Array.from(n)}function sUe(n,e){let t=n.length,r,i;for(;t;)i=e()*t--|0,r=n[t],n[t]=n[i],n[i]=r;return n}function oUe(n,e){for(var t=0,r=(n=sUe(Array.from(n),e)).length,i=[],s,a;t<r;)s=n[t],a&&Jle(a,s)?++t:(a=lUe(i=aUe(i,s)),t=0);return a}function aUe(n,e){var t,r;if(Nk(e,n))return[e];for(t=0;t<n.length;++t)if(hI(e,n[t])&&Nk(SS(n[t],e),n))return[n[t],e];for(t=0;t<n.length-1;++t)for(r=t+1;r<n.length;++r)if(hI(SS(n[t],n[r]),e)&&hI(SS(n[t],e),n[r])&&hI(SS(n[r],e),n[t])&&Nk(Qle(n[t],n[r],e),n))return[n[t],n[r],e];throw new Error}function hI(n,e){var t=n.r-e.r,r=e.x-n.x,i=e.y-n.y;return t<0||t*t<r*r+i*i}function Jle(n,e){var t=n.r-e.r+Math.max(n.r,e.r,1)*1e-9,r=e.x-n.x,i=e.y-n.y;return t>0&&t*t>r*r+i*i}function Nk(n,e){for(var t=0;t<e.length;++t)if(!Jle(n,e[t]))return!1;return!0}function lUe(n){switch(n.length){case 1:return cUe(n[0]);case 2:return SS(n[0],n[1]);case 3:return Qle(n[0],n[1],n[2])}}function cUe(n){return{x:n.x,y:n.y,r:n.r}}function SS(n,e){var t=n.x,r=n.y,i=n.r,s=e.x,a=e.y,l=e.r,o=s-t,h=a-r,d=l-i,m=Math.sqrt(o*o+h*h);return{x:(t+s+o/m*d)/2,y:(r+a+h/m*d)/2,r:(m+i+l)/2}}function Qle(n,e,t){var r=n.x,i=n.y,s=n.r,a=e.x,l=e.y,o=e.r,h=t.x,d=t.y,m=t.r,_=r-a,y=r-h,T=i-l,I=i-d,C=o-s,M=m-s,B=r*r+i*i-s*s,k=B-a*a-l*l+o*o,j=B-h*h-d*d+m*m,q=y*T-_*I,Z=(T*j-I*k)/(q*2)-r,te=(I*C-T*M)/q,ie=(y*k-_*j)/(q*2)-i,se=(_*M-y*C)/q,ae=te*te+se*se-1,fe=2*(s+Z*te+ie*se),Se=Z*Z+ie*ie-s*s,Ee=-(Math.abs(ae)>1e-6?(fe+Math.sqrt(fe*fe-4*ae*Se))/(2*ae):Se/fe);return{x:r+Z+te*Ee,y:i+ie+se*Ee,r:Ee}}function lK(n,e,t){var r=n.x-e.x,i,s,a=n.y-e.y,l,o,h=r*r+a*a;h?(s=e.r+t.r,s*=s,o=n.r+t.r,o*=o,s>o?(i=(h+o-s)/(2*h),l=Math.sqrt(Math.max(0,o/h-i*i)),t.x=n.x-i*r-l*a,t.y=n.y-i*a+l*r):(i=(h+s-o)/(2*h),l=Math.sqrt(Math.max(0,s/h-i*i)),t.x=e.x+i*r-l*a,t.y=e.y+i*a+l*r)):(t.x=e.x+t.r,t.y=e.y)}function cK(n,e){var t=n.r+e.r-1e-6,r=e.x-n.x,i=e.y-n.y;return t>0&&t*t>r*r+i*i}function uK(n){var e=n._,t=n.next._,r=e.r+t.r,i=(e.x*t.r+t.x*e.r)/r,s=(e.y*t.r+t.y*e.r)/r;return i*i+s*s}function fI(n){this._=n,this.next=null,this.previous=null}function uUe(n,e){if(!(s=(n=iUe(n)).length))return 0;var t,r,i,s,a,l,o,h,d,m,_;if(t=n[0],t.x=0,t.y=0,!(s>1))return t.r;if(r=n[1],t.x=-r.r,r.x=t.r,r.y=0,!(s>2))return t.r+r.r;lK(r,t,i=n[2]),t=new fI(t),r=new fI(r),i=new fI(i),t.next=i.previous=r,r.next=t.previous=i,i.next=r.previous=t;e:for(o=3;o<s;++o){lK(t._,r._,i=n[o]),i=new fI(i),h=r.next,d=t.previous,m=r._.r,_=t._.r;do if(m<=_){if(cK(h._,i._)){r=h,t.next=r,r.previous=t,--o;continue e}m+=h._.r,h=h.next}else{if(cK(d._,i._)){t=d,t.next=r,r.previous=t,--o;continue e}_+=d._.r,d=d.previous}while(h!==d.next);for(i.previous=t,i.next=r,t.next=r.previous=r=i,a=uK(t);(i=i.next)!==r;)(l=uK(i))<a&&(t=i,a=l);r=t.next}for(t=[r._],i=r;(i=i.next)!==r;)t.push(i._);for(i=oUe(t,e),o=0;o<s;++o)t=n[o],t.x-=i.x,t.y-=i.y;return i.r}function hUe(n){return Math.sqrt(n.value)}function fUe(){var n=null,e=1,t=1,r=oK;function i(s){const a=rUe();return s.x=e/2,s.y=t/2,n?s.eachBefore(hK(n)).eachAfter(zk(r,.5,a)).eachBefore(fK(1)):s.eachBefore(hK(hUe)).eachAfter(zk(oK,1,a)).eachAfter(zk(r,s.r/Math.min(e,t),a)).eachBefore(fK(Math.min(e,t)/(2*s.r))),s}return i.radius=function(s){return arguments.length?(n=J6e(s),i):n},i.size=function(s){return arguments.length?(e=+s[0],t=+s[1],i):[e,t]},i.padding=function(s){return arguments.length?(r=typeof s=="function"?s:eUe(+s),i):r},i}function hK(n){return function(e){e.children||(e.r=Math.max(0,+n(e)||0))}}function zk(n,e,t){return function(r){if(i=r.children){var i,s,a=i.length,l=n(r)*e||0,o;if(l)for(s=0;s<a;++s)i[s].r+=l;if(o=uUe(i,t),l)for(s=0;s<a;++s)i[s].r-=l;r.r=o+l}}}function fK(n){return function(e){var t=e.parent;e.r*=n,t&&(e.x=t.x+n*e.x,e.y=t.y+n*e.y)}}function AS(n,e,t){this.k=n,this.x=e,this.y=t}AS.prototype={constructor:AS,scale:function(n){return n===1?this:new AS(this.k*n,this.x,this.y)},translate:function(n,e){return n===0&e===0?this:new AS(this.k,this.x+this.k*n,this.y+this.k*e)},apply:function(n){return[n[0]*this.k+this.x,n[1]*this.k+this.y]},applyX:function(n){return n*this.k+this.x},applyY:function(n){return n*this.k+this.y},invert:function(n){return[(n[0]-this.x)/this.k,(n[1]-this.y)/this.k]},invertX:function(n){return(n-this.x)/this.k},invertY:function(n){return(n-this.y)/this.k},rescaleX:function(n){return n.copy().domain(n.range().map(this.invertX,this).map(n.invert,n))},rescaleY:function(n){return n.copy().domain(n.range().map(this.invertY,this).map(n.invert,n))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};AS.prototype;const dUe=()=>{const n=Ae.useRef(null),e=Ae.useRef(null);return Ae.useEffect(()=>{const t=n.current.getContext("2d");t.save();const r=[n.current.width,n.current.height],i=[100,100];t.fillStyle="red",t.translate(-.5*i[0],-.5*i[1]),t.beginPath(),t.rect(.5*r[0],.5*r[1],i[0],i[1]),t.fill(),t.restore();const s=e.current.getContext("2d"),a=[e.current.width,e.current.height],l=k8(P6e).sum(_=>1).sort((_,y)=>y.value-_.value);console.log(l);const h=fUe().size(a).padding(3)(l),d=2*Math.PI,m=(_,y,{fillStyle:T="rgba(0,0,0,0.2)",textColor:I="white"}={})=>{const C=y.children;if(_.fillStyle=T,_.beginPath(),_.arc(y.x,y.y,y.r,0,d),_.fill(),C)for(const M of C)m(_,M);else{const M=y.data.name;_.fillStyle=I,_.font="1rem Aerial",_.textAlign="center",_.fillText(M,y.x,y.y)}};console.log(h.children),m(s,h)},[]),me.jsxs("div",{className:"absolute top-20 w-full",children:[me.jsx("h1",{className:"font-bold text-3xl text-center",children:"canvas 绘图"}),me.jsx("h2",{className:"font-bold text-xl pl-3",children:"填充正方形"}),me.jsx("canvas",{ref:n,width:512,height:512,className:"ml-3 border-2 border-black-500 border-solid"}),me.jsx("h2",{className:"font-bold text-xl pl-3",children:"层次关系图(hierarchy)"}),me.jsx("canvas",{ref:e,width:1024,height:1024,className:"ml-3 border-2 border-black-500 border-solid"})]})},pUe=()=>{const n=Ae.useRef(null),e=Ae.useRef(null);let t;const r=`
    attribute vec2 position;
    void main() {
      gl_Position = vec4(position, 1.0, 1.0);
    }
  `,i=`
    precision mediump float;
    void main() {
      gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);
    }
  `,s=`
    attribute vec2 position;
    varying vec3 color;
    void main() {
      color = vec3(0.5 + position, 0.0);
      gl_Position = vec4(position, 1.0, 1.0);
    }
  `,a=`
    precision mediump float;
    varying vec3 color;
    void main() {
      gl_FragColor = vec4(color, 1.0);
    }
  `;let l;const o=(_,y,T)=>{t=_.getContext("webgl");const I=t.createShader(t.VERTEX_SHADER);t.shaderSource(I,y),t.compileShader(I),t.getShaderParameter(I,t.COMPILE_STATUS)||console.error("Vertex shader compilation failed:",t.getShaderInfoLog(I));const C=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(C,T),t.compileShader(C),t.getShaderParameter(C,t.COMPILE_STATUS)||console.error("Fragment shader compilation failed:",t.getShaderInfoLog(C)),l=t.createProgram(),t.attachShader(l,I),t.attachShader(l,C),t.linkProgram(l),t.getProgramParameter(l,t.LINK_STATUS)||console.error("Program linking failed:",t.getProgramInfoLog(l)),t.useProgram(l)},h=new Float32Array([-1,-1,0,1,1,-1]),d=()=>{const _=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,_),t.bufferData(t.ARRAY_BUFFER,h,t.STATIC_DRAW);const y=t.getAttribLocation(l,"position");t.vertexAttribPointer(y,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(y)},m=()=>{t.clear(t.COLOR_BUFFER_BIT),t.drawArrays(t.TRIANGLES,0,h.length/2)};return Ae.useEffect(()=>{o(n.current,r,i),d(),m(),o(e.current,s,a),d(),m()},[]),me.jsxs("div",{className:"absolute top-20 w-full flex",children:[me.jsx("canvas",{ref:n,width:512,height:512,className:"ml-3 border-2 border-black-500 border-solid"}),me.jsx("canvas",{ref:e,width:512,height:512,className:"ml-3 border-2 border-black-500 border-solid"})]})},mUe=()=>{const n={width:0,height:0,border:"80px solid",margin:2,"border-color":"transparent transparent red"},e={width:0,height:0,border:"80px solid",margin:2,"border-color":"green yellow red black"},t={width:0,height:0,border:"80px solid",margin:2,"border-color":"transparent transparent red","border-left":0},r={width:"160px",height:"`60px",background:"linear-gradient(45deg, red, red 50%, transparent 50%)"},i={width:"160px",height:"120px",position:"relative",overflow:"hidden"},s={content:"",position:"absolute",left:0,top:0,right:0,bottom:0,background:"red",transformOrigin:"left bottom",transform:"rotate(45deg)"},a={position:"relative",width:0,height:0,"border-width":"0 80px 80px","border-style":"solid","border-color":"transparent transparent red"},l={content:"",position:"absolute",top:"1px",left:"-76px","border-width":"0 76px 76px","border-style":"solid","border-color":"transparent transparent yellow"},o={width:"160px",height:"120px",border:"0px solid transparent",borderTop:"60px solid red",borderLeft:"40px solid transparent"};return me.jsxs("div",{className:"absolute top-20 w-full",children:[me.jsx("h2",{className:"font-bold text-xl pl-3",children:"三角形(border; linear-gradient; rotate; 子绝父相+border) "}),me.jsxs("div",{className:"flex",children:[me.jsx("div",{style:n}),me.jsx("div",{style:e}),me.jsx("div",{style:t}),me.jsx("div",{style:r}),me.jsx("div",{style:i,children:me.jsx("div",{style:s})}),me.jsx("div",{style:a,children:me.jsx("div",{style:l})})]}),me.jsx("h2",{className:"font-bold text-xl pl-3",children:"平行四边形(skew)"}),me.jsxs("div",{className:"flex",children:[me.jsx("div",{className:"ml-10 w-40 h-20 bg-black -skew-x-12"}),me.jsx("div",{className:"ml-10 w-40 h-20 bg-black -skew-y-12"})]}),me.jsx("h2",{className:"font-bold text-xl pl-3",children:"直角梯形(border; "}),me.jsx("div",{className:"flex",children:me.jsx("div",{style:o})})]})},gUe=()=>{const n={position:"absolute","box-sizing":"border-box",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:"600px",height:"600px",border:"black 1px solid",display:"flex","align-items":"flex-start","flex-wrap":"wrap","align-content":"flex-start",gap:"0"},e={"box-sizing":"border-box",height:"100px",flex:"0 0 25%",border:"red 1px solid",margin:"0"};return me.jsxs("div",{style:n,children:[me.jsx("div",{style:e,children:"111"}),me.jsx("div",{style:e,children:"111"}),me.jsx("div",{style:e,children:"111"}),me.jsx("div",{style:e,children:"111"}),me.jsx("div",{style:e,children:"111"}),me.jsx("div",{style:e,children:"111"}),me.jsx("div",{style:e,children:"111"}),me.jsx("div",{style:e,children:"111"}),me.jsx("div",{style:e,children:"111"}),me.jsx("div",{style:e,children:"111"})]})},vUe=()=>{const n={position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:"500px",height:"500px",color:"white","background-color":"black",display:"flex","justify-content":"center","align-items":"flex-start"},e={width:"50px",height:"50px",border:"red 1px solid","margin-right":"10px"},t={height:"100%","overflow-wrap":"anywhere"};return me.jsxs("div",{style:n,children:[me.jsx("img",{src:kne,alt:"",style:e}),me.jsx("p",{style:t,children:"ttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttt"})]})},_Ue=()=>{const n={border:"purple 1px solid",flex:1},e={"box-sizing":"border-box",width:"100vw",height:"100vh",display:"flex","flex-direction":"column",border:"yellow 4px solid"},t={border:"red 1px solid",flex:"80%",display:"flex",width:"100%",height:"100%"},r={border:"blue 1px solid",flex:1},i={flex:"0 0 12em"};return me.jsxs("div",{style:e,children:[me.jsx("header",{style:n,children:"header"}),me.jsxs("div",{style:t,children:[me.jsx("div",{style:{...r,...i},children:"1"}),me.jsx("div",{style:r,children:"2"}),me.jsx("div",{style:{...r,...i},children:"3"})]}),me.jsx("footer",{style:n,children:"footer"})]})};function yUe({title:n,titleId:e,...t},r){return Ae.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":e},t),n?Ae.createElement("title",{id:e},n):null,Ae.createElement("path",{d:"M2 3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3Z"}),Ae.createElement("path",{fillRule:"evenodd",d:"M13 6H3v6a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V6ZM5.72 7.47a.75.75 0 0 1 1.06 0L8 8.69l1.22-1.22a.75.75 0 1 1 1.06 1.06L9.06 9.75l1.22 1.22a.75.75 0 1 1-1.06 1.06L8 10.81l-1.22 1.22a.75.75 0 0 1-1.06-1.06l1.22-1.22-1.22-1.22a.75.75 0 0 1 0-1.06Z",clipRule:"evenodd"}))}const xUe=Ae.forwardRef(yUe);function bUe({title:n,titleId:e,...t},r){return Ae.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":e},t),n?Ae.createElement("title",{id:e},n):null,Ae.createElement("path",{fillRule:"evenodd",d:"M4.22 6.22a.75.75 0 0 1 1.06 0L8 8.94l2.72-2.72a.75.75 0 1 1 1.06 1.06l-3.25 3.25a.75.75 0 0 1-1.06 0L4.22 7.28a.75.75 0 0 1 0-1.06Z",clipRule:"evenodd"}))}const wUe=Ae.forwardRef(bUe);function SUe({title:n,titleId:e,...t},r){return Ae.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":e},t),n?Ae.createElement("title",{id:e},n):null,Ae.createElement("path",{fillRule:"evenodd",d:"M11.013 2.513a1.75 1.75 0 0 1 2.475 2.474L6.226 12.25a2.751 2.751 0 0 1-.892.596l-2.047.848a.75.75 0 0 1-.98-.98l.848-2.047a2.75 2.75 0 0 1 .596-.892l7.262-7.261Z",clipRule:"evenodd"}))}const AUe=Ae.forwardRef(SUe);function TUe({title:n,titleId:e,...t},r){return Ae.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":e},t),n?Ae.createElement("title",{id:e},n):null,Ae.createElement("path",{d:"M5 6.5A1.5 1.5 0 0 1 6.5 5h6A1.5 1.5 0 0 1 14 6.5v6a1.5 1.5 0 0 1-1.5 1.5h-6A1.5 1.5 0 0 1 5 12.5v-6Z"}),Ae.createElement("path",{d:"M3.5 2A1.5 1.5 0 0 0 2 3.5v6A1.5 1.5 0 0 0 3.5 11V6.5a3 3 0 0 1 3-3H11A1.5 1.5 0 0 0 9.5 2h-6Z"}))}const MUe=Ae.forwardRef(TUe);function CUe({title:n,titleId:e,...t},r){return Ae.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":e},t),n?Ae.createElement("title",{id:e},n):null,Ae.createElement("path",{fillRule:"evenodd",d:"M5 3.25V4H2.75a.75.75 0 0 0 0 1.5h.3l.815 8.15A1.5 1.5 0 0 0 5.357 15h5.285a1.5 1.5 0 0 0 1.493-1.35l.815-8.15h.3a.75.75 0 0 0 0-1.5H11v-.75A2.25 2.25 0 0 0 8.75 1h-1.5A2.25 2.25 0 0 0 5 3.25Zm2.25-.75a.75.75 0 0 0-.75.75V4h3v-.75a.75.75 0 0 0-.75-.75h-1.5ZM6.05 6a.75.75 0 0 1 .787.713l.275 5.5a.75.75 0 0 1-1.498.075l-.275-5.5A.75.75 0 0 1 6.05 6Zm3.9 0a.75.75 0 0 1 .712.787l-.275 5.5a.75.75 0 0 1-1.498-.075l.275-5.5a.75.75 0 0 1 .786-.711Z",clipRule:"evenodd"}))}const dK=Ae.forwardRef(CUe);/*!
 * Compressor.js v1.2.1
 * https://fengyuanchen.github.io/compressorjs
 *
 * Copyright 2018-present Chen Fengyuan
 * Released under the MIT license
 *
 * Date: 2023-02-28T14:09:41.732Z
 */function pK(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function dI(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?pK(Object(t),!0).forEach(function(r){RUe(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):pK(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function EUe(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function mK(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,ece(r.key),r)}}function IUe(n,e,t){return e&&mK(n.prototype,e),t&&mK(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n}function RUe(n,e,t){return e=ece(e),e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function qP(){return qP=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},qP.apply(this,arguments)}function PUe(n,e){if(typeof n!="object"||n===null)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function ece(n){var e=PUe(n,"string");return typeof e=="symbol"?e:String(e)}var tce={exports:{}};(function(n){typeof window>"u"||function(e){var t=e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype,r=e.Blob&&function(){try{return!!new Blob}catch{return!1}}(),i=r&&e.Uint8Array&&function(){try{return new Blob([new Uint8Array(100)]).size===100}catch{return!1}}(),s=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder,a=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,l=(r||s)&&e.atob&&e.ArrayBuffer&&e.Uint8Array&&function(o){var h,d,m,_,y,T,I,C,M;if(h=o.match(a),!h)throw new Error("invalid data URI");for(d=h[2]?h[1]:"text/plain"+(h[3]||";charset=US-ASCII"),m=!!h[4],_=o.slice(h[0].length),m?y=atob(_):y=decodeURIComponent(_),T=new ArrayBuffer(y.length),I=new Uint8Array(T),C=0;C<y.length;C+=1)I[C]=y.charCodeAt(C);return r?new Blob([i?I:T],{type:d}):(M=new s,M.append(T),M.getBlob(d))};e.HTMLCanvasElement&&!t.toBlob&&(t.mozGetAsFile?t.toBlob=function(o,h,d){var m=this;setTimeout(function(){d&&t.toDataURL&&l?o(l(m.toDataURL(h,d))):o(m.mozGetAsFile("blob",h))})}:t.toDataURL&&l&&(t.msToBlob?t.toBlob=function(o,h,d){var m=this;setTimeout(function(){(h&&h!=="image/png"||d)&&t.toDataURL&&l?o(l(m.toDataURL(h,d))):o(m.msToBlob(h))})}:t.toBlob=function(o,h,d){var m=this;setTimeout(function(){o(l(m.toDataURL(h,d)))})})),n.exports?n.exports=l:e.dataURLtoBlob=l}(window)})(tce);var gK=tce.exports,LUe=function(e){return typeof Blob>"u"?!1:e instanceof Blob||Object.prototype.toString.call(e)==="[object Blob]"},vK={strict:!0,checkOrientation:!0,retainExif:!1,maxWidth:1/0,maxHeight:1/0,minWidth:0,minHeight:0,width:void 0,height:void 0,resize:"none",quality:.8,mimeType:"auto",convertTypes:["image/png"],convertSize:5e6,beforeDraw:null,drew:null,success:null,error:null},DUe=typeof window<"u"&&typeof window.document<"u",yv=DUe?window:{},ZP=function(e){return e>0&&e<1/0},BUe=Array.prototype.slice;function O8(n){return Array.from?Array.from(n):BUe.call(n)}var kUe=/^image\/.+$/;function ZN(n){return kUe.test(n)}function OUe(n){var e=ZN(n)?n.substr(6):"";return e==="jpeg"&&(e="jpg"),".".concat(e)}var nce=String.fromCharCode;function FUe(n,e,t){var r="",i;for(t+=e,i=e;i<t;i+=1)r+=nce(n.getUint8(i));return r}var NUe=yv.btoa;function _K(n,e){for(var t=[],r=8192,i=new Uint8Array(n);i.length>0;)t.push(nce.apply(null,O8(i.subarray(0,r)))),i=i.subarray(r);return"data:".concat(e,";base64,").concat(NUe(t.join("")))}function zUe(n){var e=new DataView(n),t;try{var r,i,s;if(e.getUint8(0)===255&&e.getUint8(1)===216)for(var a=e.byteLength,l=2;l+1<a;){if(e.getUint8(l)===255&&e.getUint8(l+1)===225){i=l;break}l+=1}if(i){var o=i+4,h=i+10;if(FUe(e,o,4)==="Exif"){var d=e.getUint16(h);if(r=d===18761,(r||d===19789)&&e.getUint16(h+2,r)===42){var m=e.getUint32(h+4,r);m>=8&&(s=h+m)}}}if(s){var _=e.getUint16(s,r),y,T;for(T=0;T<_;T+=1)if(y=s+T*12+2,e.getUint16(y,r)===274){y+=8,t=e.getUint16(y,r),e.setUint16(y,1,r);break}}}catch{t=1}return t}function UUe(n){var e=0,t=1,r=1;switch(n){case 2:t=-1;break;case 3:e=-180;break;case 4:r=-1;break;case 5:e=90,r=-1;break;case 6:e=90;break;case 7:e=90,t=-1;break;case 8:e=-90;break}return{rotate:e,scaleX:t,scaleY:r}}var VUe=/\.\d*(?:0|9){12}\d*$/;function yK(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e11;return VUe.test(n)?Math.round(n*e)/e:n}function sS(n){var e=n.aspectRatio,t=n.height,r=n.width,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"none",s=ZP(r),a=ZP(t);if(s&&a){var l=t*e;(i==="contain"||i==="none")&&l>r||i==="cover"&&l<r?t=r/e:r=t*e}else s?t=r/e:a&&(r=t*e);return{width:r,height:t}}function GUe(n){for(var e=O8(new Uint8Array(n)),t=e.length,r=[],i=0;i+3<t;){var s=e[i],a=e[i+1];if(s===255&&a===218)break;if(s===255&&a===216)i+=2;else{var l=e[i+2]*256+e[i+3],o=i+l+2,h=e.slice(i,o);r.push(h),i=o}}return r.reduce(function(d,m){return m[0]===255&&m[1]===225?d.concat(m):d},[])}function HUe(n,e){var t=O8(new Uint8Array(n));if(t[2]!==255||t[3]!==224)return n;var r=t[4]*256+t[5],i=[255,216].concat(e,t.slice(4+r));return new Uint8Array(i)}var jUe=yv.ArrayBuffer,Uk=yv.FileReader,J_=yv.URL||yv.webkitURL,WUe=/\.\w+$/,XUe=yv.Compressor,$Ue=function(){function n(e,t){EUe(this,n),this.file=e,this.exif=[],this.image=new Image,this.options=dI(dI({},vK),t),this.aborted=!1,this.result=null,this.init()}return IUe(n,[{key:"init",value:function(){var t=this,r=this.file,i=this.options;if(!LUe(r)){this.fail(new Error("The first argument must be a File or Blob object."));return}var s=r.type;if(!ZN(s)){this.fail(new Error("The first argument must be an image File or Blob object."));return}if(!J_||!Uk){this.fail(new Error("The current browser does not support image compression."));return}jUe||(i.checkOrientation=!1,i.retainExif=!1);var a=s==="image/jpeg",l=a&&i.checkOrientation,o=a&&i.retainExif;if(J_&&!l&&!o)this.load({url:J_.createObjectURL(r)});else{var h=new Uk;this.reader=h,h.onload=function(d){var m=d.target,_=m.result,y={},T=1;l&&(T=zUe(_),T>1&&qP(y,UUe(T))),o&&(t.exif=GUe(_)),l||o?!J_||T>1?y.url=_K(_,s):y.url=J_.createObjectURL(r):y.url=_,t.load(y)},h.onabort=function(){t.fail(new Error("Aborted to read the image with FileReader."))},h.onerror=function(){t.fail(new Error("Failed to read the image with FileReader."))},h.onloadend=function(){t.reader=null},l||o?h.readAsArrayBuffer(r):h.readAsDataURL(r)}}},{key:"load",value:function(t){var r=this,i=this.file,s=this.image;s.onload=function(){r.draw(dI(dI({},t),{},{naturalWidth:s.naturalWidth,naturalHeight:s.naturalHeight}))},s.onabort=function(){r.fail(new Error("Aborted to load the image."))},s.onerror=function(){r.fail(new Error("Failed to load the image."))},yv.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(yv.navigator.userAgent)&&(s.crossOrigin="anonymous"),s.alt=i.name,s.src=t.url}},{key:"draw",value:function(t){var r=this,i=t.naturalWidth,s=t.naturalHeight,a=t.rotate,l=a===void 0?0:a,o=t.scaleX,h=o===void 0?1:o,d=t.scaleY,m=d===void 0?1:d,_=this.file,y=this.image,T=this.options,I=document.createElement("canvas"),C=I.getContext("2d"),M=Math.abs(l)%180===90,B=(T.resize==="contain"||T.resize==="cover")&&ZP(T.width)&&ZP(T.height),k=Math.max(T.maxWidth,0)||1/0,j=Math.max(T.maxHeight,0)||1/0,q=Math.max(T.minWidth,0)||0,Z=Math.max(T.minHeight,0)||0,te=i/s,ie=T.width,se=T.height;if(M){var ae=[j,k];k=ae[0],j=ae[1];var fe=[Z,q];q=fe[0],Z=fe[1];var Se=[se,ie];ie=Se[0],se=Se[1]}B&&(te=ie/se);var Ee=sS({aspectRatio:te,width:k,height:j},"contain");k=Ee.width,j=Ee.height;var Re=sS({aspectRatio:te,width:q,height:Z},"cover");if(q=Re.width,Z=Re.height,B){var qe=sS({aspectRatio:te,width:ie,height:se},T.resize);ie=qe.width,se=qe.height}else{var Le=sS({aspectRatio:te,width:ie,height:se}),dt=Le.width;ie=dt===void 0?i:dt;var ye=Le.height;se=ye===void 0?s:ye}ie=Math.floor(yK(Math.min(Math.max(ie,q),k))),se=Math.floor(yK(Math.min(Math.max(se,Z),j)));var Xe=-ie/2,He=-se/2,_t=ie,wt=se,Gt=[];if(B){var at=0,Ht=0,Qt=i,rn=s,jn=sS({aspectRatio:te,width:i,height:s},{contain:"cover",cover:"contain"}[T.resize]);Qt=jn.width,rn=jn.height,at=(i-Qt)/2,Ht=(s-rn)/2,Gt.push(at,Ht,Qt,rn)}if(Gt.push(Xe,He,_t,wt),M){var Bn=[se,ie];ie=Bn[0],se=Bn[1]}I.width=ie,I.height=se,ZN(T.mimeType)||(T.mimeType=_.type);var Tn="transparent";_.size>T.convertSize&&T.convertTypes.indexOf(T.mimeType)>=0&&(T.mimeType="image/jpeg");var Pe=T.mimeType==="image/jpeg";if(Pe&&(Tn="#fff"),C.fillStyle=Tn,C.fillRect(0,0,ie,se),T.beforeDraw&&T.beforeDraw.call(this,C,I),!this.aborted&&(C.save(),C.translate(ie/2,se/2),C.rotate(l*Math.PI/180),C.scale(h,m),C.drawImage.apply(C,[y].concat(Gt)),C.restore(),T.drew&&T.drew.call(this,C,I),!this.aborted)){var $e=function(cn){if(!r.aborted){var St=function(sn){return r.done({naturalWidth:i,naturalHeight:s,result:sn})};if(cn&&Pe&&T.retainExif&&r.exif&&r.exif.length>0){var Jt=function(sn){return St(gK(_K(HUe(sn,r.exif),T.mimeType)))};if(cn.arrayBuffer)cn.arrayBuffer().then(Jt).catch(function(){r.fail(new Error("Failed to read the compressed image with Blob.arrayBuffer()."))});else{var kn=new Uk;r.reader=kn,kn.onload=function(Vn){var sn=Vn.target;Jt(sn.result)},kn.onabort=function(){r.fail(new Error("Aborted to read the compressed image with FileReader."))},kn.onerror=function(){r.fail(new Error("Failed to read the compressed image with FileReader."))},kn.onloadend=function(){r.reader=null},kn.readAsArrayBuffer(cn)}}else St(cn)}};I.toBlob?I.toBlob($e,T.mimeType,T.quality):$e(gK(I.toDataURL(T.mimeType,T.quality)))}}},{key:"done",value:function(t){var r=t.naturalWidth,i=t.naturalHeight,s=t.result,a=this.file,l=this.image,o=this.options;if(J_&&l.src.indexOf("blob:")===0&&J_.revokeObjectURL(l.src),s)if(o.strict&&!o.retainExif&&s.size>a.size&&o.mimeType===a.type&&!(o.width>r||o.height>i||o.minWidth>r||o.minHeight>i||o.maxWidth<r||o.maxHeight<i))s=a;else{var h=new Date;s.lastModified=h.getTime(),s.lastModifiedDate=h,s.name=a.name,s.name&&s.type!==a.type&&(s.name=s.name.replace(WUe,OUe(s.type)))}else s=a;this.result=s,o.success&&o.success.call(this,s)}},{key:"fail",value:function(t){var r=this.options;if(r.error)r.error.call(this,t);else throw t}},{key:"abort",value:function(){this.aborted||(this.aborted=!0,this.reader?this.reader.abort():this.image.complete?this.fail(new Error("The compression process has been aborted.")):(this.image.onload=null,this.image.onabort()))}}],[{key:"noConflict",value:function(){return window.Compressor=XUe,n}},{key:"setDefaults",value:function(t){qP(vK,t)}}]),n}();const qUe=""+new URL("biaozhun-C5OcRpNC.png",import.meta.url).href,ZUe=""+new URL("target-DS1CVM5s.svg",import.meta.url).href,Q_=[zle,qUe,Ule,Lle,Vle,B8,Gle,$N,Dle,I8,Ble,kle,R8,P8,Hle,ZUe,Fle,Wle,Xle,$le,qle,Zle,Yle,Kle,Nle,L8,D8,jle,Ole],YUe=()=>{const[n,e]=Ae.useState(0),t=Array.from({length:Q_.length}).map(()=>Ae.useRef(null)),r=Ae.useRef(null);return Ae.useEffect(()=>{if(n===1){const i=new IntersectionObserver(s=>{s.forEach(a=>{if(a.isIntersecting){let l=a.target;l.src=l.dataset.src,i.unobserve(l)}})});t.forEach(s=>{s.current&&i.observe(s.current)})}if(n===2&&Q_.forEach((i,s)=>{fetch(i).then(a=>a.blob()).then(a=>{new $Ue(a,{quality:.6,maxWidth:600,maxHeight:800,success(l){let o=URL.createObjectURL(l);t[s].current.src=o},error(l){console.log("error in compressor:",l)}})}).catch(a=>console.log("error in fetch:",a))}),n===3){const i=new IntersectionObserver(s=>{s[0].isIntersecting&&(Q_.forEach((a,l)=>{l>10&&(t[l].current.src=a)}),i.unobserve(r.current))});r.current&&i.observe(r.current)}},[n]),me.jsxs("div",{className:"absolute flex w-screen top-20 flex-col items-center",children:[me.jsxs("header",{className:"flex w-full items-center justify-between border-b-2 border-b-black shadow-xl",children:[me.jsx("div",{className:"ml-8 font-sans font-bold text-lg",children:"图片懒加载"}),me.jsx("div",{className:"mr-8 text-right",children:me.jsxs(Ele,{children:[me.jsxs(C8,{className:"inline-flex items-center gap-2 rounded-md bg-gray-800 py-1.5 px-3 text-sm/6 font-semibold text-white shadow-inner shadow-white/10 focus:outline-none data-[hover]:bg-gray-700 data-[open]:bg-gray-700 data-[focus]:outline-1 data-[focus]:outline-white",children:["不同方案",me.jsx(wUe,{className:"size-4 fill-white/60"})]}),me.jsxs(E8,{transition:!0,anchor:"bottom end",className:"w-52 origin-top-right rounded-xl border border-gray-800 bg-gray-700 p-1 text-sm/6 text-white transition duration-100 ease-out [--anchor-gap:var(--spacing-1)] focus:outline-none",children:[me.jsx(Ff,{children:me.jsxs("button",{className:"group flex w-full items-center gap-2 rounded-lg py-1.5 px-3 data-[focus]:bg-black/10 justify-end",onClick:()=>e(0),children:['loading="lazy"',me.jsx(AUe,{className:"size-4 fill-white/30"})]})}),me.jsx(Ff,{children:me.jsxs("button",{className:"group flex w-full items-center gap-2 rounded-lg py-1.5 px-3 data-[focus]:bg-black/10 justify-end",onClick:()=>e(1),children:["IntersectionObserver",me.jsx(MUe,{className:"size-4 fill-white/30"})]})}),me.jsx(Ff,{children:me.jsxs("button",{className:"group flex w-full items-center gap-2 rounded-lg py-1.5 px-3 data-[focus]:bg-black/10 justify-end",onClick:()=>e(2),children:["图片压缩",me.jsx(xUe,{className:"size-4 fill-white/30"})]})}),me.jsx(Ff,{children:me.jsxs("button",{className:"group flex w-full items-center gap-2 rounded-lg py-1.5 px-3 data-[focus]:bg-black/10 justify-end",onClick:()=>e(3),children:["无限滚动",me.jsx(dK,{className:"size-4 fill-white/30"})]})}),me.jsx(Ff,{children:me.jsxs("button",{className:"group flex w-full items-center gap-2 rounded-lg py-1.5 px-3 data-[focus]:bg-black/10 justify-end",onClick:()=>e(4),children:["其他",me.jsx(dK,{className:"size-4 fill-white/30"})]})})]})]})})]}),me.jsx("div",{children:n===0&&Q_.map((i,s)=>me.jsx("img",{src:i,alt:"",className:"w-full p-2",loading:"lazy"},s))}),n===1&&me.jsxs("div",{children:[me.jsxs("p",{children:[" ","在vue里可以使用@vueuse/core里的{useIntersectionObserver}，实习中使用过这个实现dom进入视口触发对应动画。"," "]}),me.jsx("p",{children:`useIntersectionObserver(refContent, ([{ isIntersecting }]) => {
    isVisible.value = isIntersecting; });`}),me.jsx("p",{children:"其中refContent指向了对应的dom，isIntersecting会监听查看是否ref的dom进入了视口，同步修改isVisible的boolean值"}),me.jsx("a",{href:"https://ruanyifeng.com/blog/2016/11/intersectionobserver_api.html",children:"补充教程链接"}),Q_.map((i,s)=>me.jsx("img",{ref:t[s],"data-src":i,alt:s,className:"w-full p-2"},s))]}),n===2&&me.jsxs("div",{children:[me.jsx("p",{children:"使用图片压缩工具，或者在服务端进行图片压缩"}),me.jsx("p",{children:"实习中使用过compressorjs实现用户上传图片中进行图片压缩，压缩后传给后端存储；"}),Q_.map((i,s)=>me.jsx("img",{ref:t[s],alt:s,className:"w-full p-2"},s))]}),n===3&&me.jsxs("div",{children:[me.jsx("p",{children:"分页加载/无限滚动：滚动到页面底部的时候，再加载更多图片；下方是实现的无限滚动"}),Q_.map((i,s)=>me.jsxs("div",{children:[s<10&&me.jsx("img",{src:i,alt:s,className:"w-full p-2"},s),s===10&&me.jsx("p",{ref:r,children:"-------------加载更多-------------------"}),s>10&&me.jsx("img",{ref:t[s],alt:s,className:"w-full  p-2"},s)]}))]}),n===4&&me.jsxs("div",{children:[me.jsx("div",{children:"* 使用CDN（内容分发网络），把图片缓存在里客户端较近的服务器上；"}),me.jsx("div",{children:"* 使用缩略图，当用户点击的时候再加载全图；"}),me.jsx("div",{children:"* 虚拟滚动，类似于懒加载，可以使用ElementUI等UI库来实现；"})]})]})},KUe=()=>me.jsxs("div",{className:"absolute top-20 m-4 w-1/2 h-1/2 border-4 border-solid border-cyan-500",children:[me.jsx("div",{className:"w-80 h-20 border-2 border-solid border-yellow-500",children:me.jsx("p",{className:"whitespace-nowrap overflow-hidden text-ellipsis",children:"mmliugeojdgasedrfdghhohjorehorgjm;ldhl;d;goiprnb'dfgd               egeeeeeeeeeeeeeeeeee         eeeeeeeeeeeddddddggga    aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"})}),me.jsx("br",{}),me.jsx("div",{className:"w-80 h-20 border-2 border-solid border-yellow-500",children:me.jsx("p",{className:"whitespace-normal overflow-hidden break-all",children:"mmliugeojdgasedrfdghhohjorehorgjm;ldhl;d;goiprnb'dfgdegeeeeeeeeeeeeeeeeeeeeeeeeeeeeeddddddgggaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"})}),me.jsx("br",{}),me.jsx("div",{className:"w-80 h-20 border-2 border-solid border-yellow-500",children:me.jsx("p",{className:"overflow-hidden break-all text-ellipsis line-clamp-3",children:"mmliugeojdgasedrfdghhohjorehorgjm;ldhl;d;goiprnb'dfgdegeeeeeeeeeeeeeeeeeeeeeeeeeeeeeddddddgggaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"})})]}),JUe=()=>me.jsxs("div",{className:"absolute top-20 m-4 w-1/2",children:[me.jsx("p",{children:"实现input+button里，input自适应"}),me.jsx("br",{}),me.jsxs("div",{className:"flex",children:[me.jsx("input",{className:"border-2 flex-grow",type:"text"}),me.jsx("button",{className:"ml-2",children:"Search"})]})]}),QUe=()=>me.jsx("div",{className:"absolute left-1/4 top-1/4 w-1/3 h-1/3",children:me.jsx("div",{className:"split-line",children:"SplitLine"})}),e8e=()=>{const n={width:"200px",height:"200px",margin:"10px",border:"1px solid #000"};return me.jsxs("div",{className:"absolute top-20 p-4 w-full h-full flex flex-wrap content-start",children:[me.jsxs("div",{style:n,children:[me.jsx("p",{children:"方案1(父有宽高,子无)：flex + m-auto"}),me.jsx("div",{className:"flex w-24 h-24 border-4 border-solid border-red-500",children:me.jsx("div",{className:"m-auto",children:"box1"})})]}),me.jsxs("div",{style:n,children:[me.jsx("p",{children:"方案2(父有宽高,子无)：grid + place-items-center"}),me.jsx("div",{className:"grid place-items-center w-24 h-24 border-4 border-solid border-red-500",children:me.jsx("div",{children:"box2"})})]}),me.jsxs("div",{style:n,children:[me.jsx("p",{children:"方案3(父有宽高,子无)：table-cell + align-middle"}),me.jsx("div",{className:"table-cell text-center align-middle w-24 h-24 border-4 border-solid border-red-500",children:me.jsx("div",{children:"box3"})})]}),me.jsxs("div",{style:n,children:[me.jsx("p",{children:"方案4(父有宽高,子无)：子绝父相 + transform"}),me.jsx("div",{className:"relative w-24 h-24 border-4 border-solid border-red-500",children:me.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2",children:"box4"})})]}),me.jsxs("div",{style:n,children:[me.jsx("p",{children:"方案5(父有宽高,子无)：万金油"}),me.jsx("div",{className:"flex justify-center items-center w-24 h-24 border-4 border-solid border-red-500",children:me.jsx("div",{children:"box5"})})]}),me.jsxs("div",{style:n,children:[me.jsx("p",{children:"方案5-1(父无宽高,子无)：万金油"}),me.jsx("div",{className:"flex justify-center items-center border-4 border-solid border-red-500",children:me.jsx("div",{children:"box5"})})]}),me.jsxs("div",{style:n,children:[me.jsx("p",{children:"方案6(父、子有宽高)：flex + m-auto"}),me.jsx("div",{className:"flex w-24 h-24 border-4 border-solid border-red-500",children:me.jsx("div",{className:"w-12 h-12 border-2 border-solid border-green-500 m-auto",children:"box1"})})]}),me.jsxs("div",{style:n,children:[me.jsx("p",{children:"方案7(父、子有宽高)：grid + place-items-center"}),me.jsx("div",{className:"grid place-items-center w-24 h-24 border-4 border-solid border-red-500",children:me.jsx("div",{className:"w-12 h-12 border-2 border-solid border-green-500",children:"box2"})})]}),me.jsxs("div",{style:n,children:[me.jsx("p",{children:"方案8(父、子有宽高)：table-cell + align-middle"}),me.jsx("div",{className:"table-cell text-center align-middle w-24 h-24 border-4 border-solid border-red-500",children:me.jsx("div",{className:"w-12 h-12 border-2 border-solid border-green-500",children:"box3"})})]}),me.jsxs("div",{style:n,children:[me.jsx("p",{children:"方案9(父、子有宽高)：子绝父相 + transform"}),me.jsx("div",{className:"relative w-24 h-24 border-4 border-solid border-red-500",children:me.jsx("div",{className:"absolute w-12 h-12 top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 border-2 border-solid border-green-500",children:"box4"})})]}),me.jsxs("div",{style:n,children:[me.jsx("p",{children:"方案10：万金油(父、子有宽高)"}),me.jsx("div",{className:"flex justify-center items-center w-24 h-24 border-4 border-solid border-red-500",children:me.jsx("div",{className:"w-12 h-12 border-2 border-solid border-green-500",children:"box5"})})]}),me.jsxs("div",{style:n,children:[me.jsx("p",{children:"方案11(父、子有宽高),子top-1/2 left-1/2 -ml-一半宽 -mt-一半高"}),me.jsx("div",{className:"relative w-24 h-24 border-4 border-solid border-red-500",children:me.jsx("div",{className:"absolute w-12 h-12 top-1/2 left-1/2 -ml-6 -mt-6 border-2 border-solid border-green-500",children:"box1"})})]})]})},t8e=()=>{const n={width:"200px",height:"200px",margin:"10px",border:"1px solid #000"},e={"font-size":"10px"},t={transform:"scale(0.83)"};return me.jsxs("div",{className:"absolute top-20 m-4 w-screen h-full flex",children:[me.jsxs("div",{style:n,children:[me.jsx("p",{children:"方案1：直接设置, 我看也行"}),me.jsx("div",{style:e,children:"box1"})]}),me.jsxs("div",{style:n,children:[me.jsx("p",{children:"方案2：text-xs + scale(0.83),是10/12"}),me.jsx("div",{className:"text-xs",style:t,children:"box2"})]}),me.jsx("div",{style:n,children:me.jsx("p",{children:"方案3：设置全局html的font-size为100px，然后当前元素设置font-size为1rem即可"})})]})},n8e=()=>{const n={display:"flex",height:"100px"},e={flex:"0 0 100px",backgroundColor:"red"},t={flexGrow:1,backgroundColor:"yellow"},r={display:"table",width:"100%"},i={display:"table-cell",width:"100px",height:"100px",backgroundColor:"red"},s={display:"table-cell",backgroundColor:"yellow"},a={display:"grid",gridTemplateColumns:"100px auto",gridTemplateRows:"100px"},l={backgroundColor:"red"},o={backgroundColor:"yellow"},h={width:"100%",overflow:"hidden"},d={display:"inline-block",width:"100px",height:"100px",backgroundColor:"red"},m={display:"inline-block",width:"calc(100% - 100px)",height:"100px",backgroundColor:"yellow"},_={width:"100%",overflow:"hidden"},y={display:"inline-block",position:"absolute",left:0,right:0,width:"100px",height:"100px",backgroundColor:"red"},T={display:"inline-block",marginLeft:"100px",width:"calc(100% - 100px)",height:"100px",backgroundColor:"yellow"};return me.jsxs("div",{className:"absolute w-screen top-20 ",children:[me.jsxs("div",{children:[me.jsx("div",{className:"ml-8 font-sans font-bold text-lg",children:"father: flex; right: flex-grow = 1"}),me.jsxs("div",{style:n,children:[me.jsx("div",{style:e,children:"left"}),me.jsx("div",{style:t,children:"right"})]})]}),me.jsxs("div",{children:[me.jsx("div",{className:"ml-8 font-sans font-bold text-lg",children:"father: grid, grid-template-rows, grid-template-cols;"}),me.jsxs("div",{style:a,children:[me.jsx("div",{style:l,children:"left"}),me.jsx("div",{style:o,children:"right"})]})]}),me.jsxs("div",{children:[me.jsx("div",{className:"ml-8 font-sans font-bold text-lg",children:"father: table,需要设置宽度; left/right: table-cell"}),me.jsxs("div",{style:r,children:[me.jsx("div",{style:i,children:"left"}),me.jsx("div",{style:s,children:"right"})]})]}),me.jsxs("div",{children:[me.jsx("div",{className:"ml-8 font-sans font-bold text-lg",children:"right: 利用calc求width"}),me.jsxs("div",{style:h,children:[me.jsx("div",{style:d,children:"left"}),me.jsx("div",{style:m,children:"right"})]})]}),me.jsxs("div",{children:[me.jsx("div",{className:"ml-8 font-sans font-bold text-lg",children:"left是absolute,right的margin-left为left的宽"}),me.jsxs("div",{style:_,children:[me.jsx("div",{style:y,children:"left"}),me.jsx("div",{style:T,children:"right"})]})]})]})},r8e=()=>{const n={height:"1px",background:"black",transform:"scaleY(0.5)",transformOrigin:"50% 100%"},e={height:"1px",background:"black",boxShadow:"0 0 0.5px  black"};return Ae.useEffect(()=>{document.addEventListener("contextmenu",t=>{t.preventDefault()}),document.addEventListener("selectstart",t=>{t.preventDefault()}),document.addEventListener("copy",t=>{t.preventDefault()}),document.addEventListener("cut",t=>{t.preventDefault()})},[]),me.jsxs("div",{className:"absolute w-screen top-20 ",children:[me.jsxs("div",{children:[me.jsx("div",{className:"ml-8 font-sans font-bold text-lg",children:"transform: scaleY(0.5)"}),me.jsx("div",{style:n})]}),me.jsxs("div",{children:[me.jsx("div",{className:"ml-8 font-sans font-bold text-lg",children:"box-shadow"}),me.jsx("div",{style:e})]}),me.jsx("div",{children:me.jsx("div",{className:"ml-8 font-sans font-bold text-lg",children:"设置了禁止：右键菜单、文本选择、复制、粘贴"})})]})},i8e=[{imageUrl:T2e,name:"CSS",type:"Frontend"},{imageUrl:M2e,name:"Express",type:"Backend"},{imageUrl:C2e,name:"Git",type:"Version Control"},{imageUrl:E2e,name:"GitHub",type:"Version Control"},{imageUrl:I2e,name:"HTML",type:"Frontend"},{imageUrl:R2e,name:"JavaScript",type:"Frontend"},{imageUrl:P2e,name:"MongoDB",type:"Database"},{imageUrl:L2e,name:"Motion",type:"Animation"},{imageUrl:D2e,name:"Material-UI",type:"Frontend"},{imageUrl:B2e,name:"Next.js",type:"Frontend"},{imageUrl:k2e,name:"Node.js",type:"Backend"},{imageUrl:O2e,name:"React",type:"Frontend"},{imageUrl:F2e,name:"Redux",type:"State Management"},{imageUrl:N2e,name:"Sass",type:"Frontend"},{imageUrl:z2e,name:"Tailwind CSS",type:"Frontend"},{imageUrl:U2e,name:"TypeScript",type:"Frontend"}],s8e=[{title:"测绘内业工程师-实习生",company_name:"江苏苏海信息科技有限公司",icon:zW,iconBg:"#fbc3bc",date:"2021.07-2021.08",points:["工作：参与了“江宁一张图”的本地数据库更新工作和部分省市三调工作底图整理，完成数据整理、汇编、入库、交付沟通等工作。此外，协助经理进行日常工作维护，如数据维护、报销管理、图纸整理。","收获：接触了传统测绘方向的基础数据处理和加工工作，认识到数据和数据安全的重要性。"]},{title:"研发工程师-实习生",company_name:"视网么AR",icon:Z2e,iconBg:"#accbe1",date:"2023.07 -2023.08",points:["背景：该公司主要业务在元宇宙、AR 方面，涵盖科教、文旅、零售等方面，并自研了AR 内容编辑器。","培训协助：协助完成对南京师范大学出版社人员的视网么平台使用培训，包括现场拍照、记录和答疑。","项目参与：独立完成了大国重器项目、看镜南京项目中的两个重要场景，参与了Windows 端的盾构机项目。实现了AR 内容的制作和打包，基于手机APP 端、Windows 大屏端完成了AR 内容的呈现、用户和AR 内容的交互。","收获：学习了unity 使用、模型调整和打包、c# 和Lua 脚本构建等内容，了解并对AR 及元宇宙赛道产生兴趣。"]},{title:"Web Developer",company_name:"邻里邻外",icon:q2e,iconBg:"#b7e4c7",date:"2024.06-2024.08",points:["Developing and maintaining web applications using React.js and other related technologies.","Collaborating with cross-functional teams including designers, product managers, and other developers to create high-quality products.","Implementing responsive design and ensuring cross-browser compatibility.","Participating in code reviews and providing constructive feedback to other developers."]},{title:"实验室科研人员",company_name:"数字人文与超媒体GIS实验室",icon:zW,iconBg:"#fbc3bc",date:"2023.09至今",points:["地图学助教","实验室财务管理","会议参与","科研项目"]}],o8e=[{iconUrl:G2e,theme:"btn-back-red",name:"徐霞客的旅行世界",description:`徐霞客的旅行世界：已发表软件著作权(2021.10 -2021.12)
项目背景：为了更清晰、直观地展现徐霞客游历各地的足迹，为人们分析研究徐霞客及其著作提供便利。
动态地图探索：利用了KeplerKepler.gl 制作在线电子地图页面用于嵌入系统，采用热力图、三维柱状图、OD 流和时间轴实现时空动态可视化；
网页制作和整合：基于HTML 、CSS 、BootStrap 搭建框架，使用supermap iclient for leaflet 构建地图和数据，借助SuperMapSuperMap.iserver 的数据服务、SQL 属性表查询和交通网络分析APIAPI，完成了POI 信息查询界面和出行路径规划界面`,link:"https://github.com/youxt-njnu/XuXiaKe"},{iconUrl:H2e,theme:"btn-back-pink",name:"土壤图斑识别与属性预测系统",description:`土壤图斑识别与属性预测系统：C#与GIS二次开发结课作业(2021.10 -2021.12) 
基于dotspatial 进行C# .net 开发，搭建了三层架构实现了项目整合，并完成几乎所有基础GIS 功能和相关性分析及可视化模块。此外，协助完成了需求分析 概要设计,详细设计,功能实现, 技术文档撰写，锻炼了系统思维和沟通协作能力。`,link:"https://github.com/youxt-njnu/ProjectSnapshot/blob/master/c%23%E4%B8%8EGIS%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91-%E5%9C%9F%E5%A3%A4%E5%9B%BE%E6%96%91%E8%AF%86%E5%88%AB%E4%B8%8E%E5%B1%9E%E6%80%A7%E9%A2%84%E6%B5%8B%E7%B3%BB%E7%BB%9F.pdf"},{iconUrl:W2e,theme:"btn-back-green",name:"图说中国乳业发展",description:`图说中国乳业发展：地图设计与电子地图学结课作业(2022.04-2022.06) 
项目背景：以乳业发展全况分析可视化为目标，实现对中国乳业发展全方位、多维度、多形式的表达和分析。数据查找及整理：通过多渠道获取乳业工厂点数据、品牌发展情况数据和地方奶业供需数据，进行预处理、时间轴梳理和坐标空间化；
时空分析和可视化：使用交互流图、热点图、热力图、折线图、 3D柱状图等形式，结合空间冷热点分析，从时空角度，对乳业发展情况进行分析和可视化；
网页制作与整合：使用Mapbox 为地图JS 库，基于JS, 结合Bootstrap 、Echarts 等进行网页开发，实现交互式效果。通过“故事地图”“工厂分布”“品牌发展”“供需分析”四个模块的设计和整合，得到最终实验成果，完成整个网页框架的开发。`,link:"https://github.com/youxt-njnu/Milk"},{iconUrl:kne,theme:"btn-back-blue",name:"清史GIS系统",description:`清史GIS 系统：WebGIS 服务结课作业(2022.10 -2022.12)
采用Axure 进行原型设计，在QGIS 平台中完成数据处理，基于postgresql 数据库进行数据存储，利用geoserver进行数据发布，并学习Jquery 、Ajax 、httphttp-server 完成前后端交互和跨域数据访问，最后基于openlayer 、Mapbox 进行地图渲染，使用echarts 进行图表可视化。`,link:"https://github.com/youxt-njnu/hgisworkHD"},{iconUrl:j2e,theme:"btn-back-yellow",name:"Flappy Bird",description:`Xlua重写Flappy Bird的原始c#游戏逻辑(2023.08-2023.09)
Flappy Bird is a mobile game developed by Vietnamese video game artist and programmer Dong Nguyen. The game is a side-scroller where the player controls a bird, attempting to fly between columns of green pipes without hitting them.`,link:"https://github.com/youxt-njnu/flappy_bird_xlua"},{iconUrl:V2e,theme:"btn-back-black",name:"南京安全区AR故事地图",description:`漫漫长夜中的人性之光：南京安全区AR故事地图(2023.12-2024.06)
 通过文献数字化、GIS及AR、游戏引擎等技术，从“时空数据库构建及信息梳理—数字制图与地图设计——AR故事地图交互”三个层面进行南京安全区历史记忆的时空构建，研制AR故事地图，导引社会公众重启约翰·拉贝等国际友人的救助历程，重温这段黑暗历史中闪耀的人性之光`,link:"https://mp.weixin.qq.com/s?__biz=MzU4MTc2MDAyNg==&mid=2247484289&idx=1&sn=ca9ab0ac73791c6a453b5d0364130248&chksm=fc6d6a49da4532c55ff74676bd34092d37bd742f1ee040c1740ca72043ab6e9050428ac70ce1&scene=126&sessionid=1724225266#rd"}],_s="/about_portfolio/arts/",rce=[{name:"postprocessLut",img:"https://s2.loli.net/2024/10/17/HrfLEsU4zydXaAt.png",path:_s+"bird",component:oke,type:"测试1",info:"自己写的react-three-fiber组件"},{name:"地球",img:"https://s2.loli.net/2024/10/17/yexj6A8cqVvMKDN.png",path:_s+"sky",component:iSe,type:"贴图",info:"地球自转和月球公转"},{name:"狐狸",img:"https://s2.loli.net/2024/08/05/hBc1om3X5euCRkt.png",path:_s+"fox",component:rke,type:"动画",info:"含动画的狐狸模型"},{name:"大屏",img:"https://dragonir.github.io/3d/static/media/earthDigital.8c221282f247bb724b85.png",path:_s+"earth-digital",component:QBe,type:"综合",info:"3D地球，shader、飞线、动画..."},{name:"数字地球星空",img:"https://s2.loli.net/2024/10/05/Ypj16zckvyd78Do.png",path:_s+"earth-moving",component:vke,type:"几何模型",info:"geometry，贴图，构建场景及动画"},{name:"光影人物",img:"https://s2.loli.net/2024/10/05/WiUuGJ3CbnagLc6.png",path:_s+"light-model",component:eOe,type:"模型和光影",info:"光影、人物、页面切换和鼠标特效"},{name:"降落城市",img:"https://s2.loli.net/2024/11/18/16FgOsBTyM8NntV.png",path:_s+"descent-3d",component:nOe,type:"ShaderToy",info:"基于ShaderToy实现的3D降落城市"},{name:"旋转盒子",img:"https://s2.loli.net/2024/11/29/53zmKr7wkDXvEOV.png",path:_s+"box-rotate",component:rOe,type:"rotate",info:"几何体的旋转和动画"},{name:"多媒体探索",img:"https://s2.loli.net/2024/11/29/xOVH39vBsNUohSE.png",path:_s+"multimedia",component:aOe,type:"multimedia",info:"第一人称视角，添加文字、图片、语音"},{name:"多媒体交互",img:"https://s2.loli.net/2024/11/29/oHnINiSMd9mua7z.png",path:_s+"multimedia2",component:mOe,type:"multimedia",info:"gltf加载draco压缩模型，视频贴图和用户交互"},{name:"粒子球",img:"https://s2.loli.net/2024/11/29/D48EJRLzi5kofpw.png",path:_s+"particle",component:Xze,type:"particle",info:"不同粒子效果展示"},{name:"宇航员迷失",img:"https://s2.loli.net/2024/11/29/36QACaqtnJ5FHyX.png",path:_s+"astronaut-particle",component:Zze,type:"particle",info:"模型、粒子、动画"},{name:"后处理方块",img:"https://s2.loli.net/2024/11/29/MUL51g9qBvkbtiO.png",path:_s+"postprocess-box",component:e6e,type:"",info:""},{name:"RickMorty",img:"https://s2.loli.net/2024/11/29/Sfsr5BiyhOXI7mc.png",path:_s+"rick-morty",component:o6e,type:"",info:""},{name:"ShaderPattern",img:"https://s2.loli.net/2024/11/29/19j8O2X3ofJuT7F.png",path:_s+"shader-pattern",component:c6e,type:"",info:""}],ice=[{name:"简单入门",img:"https://s2.loli.net/2024/10/17/OsrIyLWMmZ6Ezpk.png",path:_s+"mapbox-simple",component:h6e,type:"简单入门",info:"地图呈现、拖动等交互"},{name:"乳业发展叙事",img:"https://s2.loli.net/2024/11/08/tDnLboVM1TEu47K.png",path:_s+"milk-story",component:C6e,type:"地图叙事",info:"对中国乳业发展进行时空叙事"}],sce=[{name:"html+css 柱状图饼图",img:"https://s2.loli.net/2024/11/16/KmZYDPr6bvtiW5V.png",path:_s+"bar-pie",component:E6e,type:"html+css",info:"柱状图和饼图"},{name:"CanvasDemo",img:"https://s2.loli.net/2024/11/26/A7GhwiavVftz2P3.png",path:_s+"canvas-demo",component:dUe,type:"canvas",info:"使用canvas进行绘图"},{name:"WebglUseage",img:"",path:_s+"webgl-useage",component:pUe,type:"webgl",info:"使用webgl进行绘图的代码流"}],oce=[{name:"圣杯布局",img:"https://s2.loli.net/2024/11/06/ozbCSmLM4FHTfXn.png",path:_s+"holy-grail",component:_Ue,type:"flex布局",info:"圣杯布局"},{name:"悬挂布局",img:"https://s2.loli.net/2024/11/06/PnIGVfoybwmxq1e.png",path:_s+"hanging",component:vUe,type:"flex布局",info:"图片和文字的悬挂布局"},{name:"流式布局",img:"https://s2.loli.net/2024/11/06/ZWJEAH8I9XdKyzl.png",path:_s+"float",component:gUe,type:"flex布局",info:"flex wrap和flex content使用"},{name:"分割线",img:"https://s2.loli.net/2024/11/08/KTBDMSPIRjyZtxr.png",path:_s+"split-line",component:QUe,type:"伪元素",info:"利用::before, ::after"},{name:"图片加载优化",img:"https://s2.loli.net/2024/11/16/kpwcFnbIV64gJlo.png",path:_s+"img-load",component:YUe,type:"场景",info:"多图片加载性能优化方案"},{name:"水平垂直居中",img:"https://s2.loli.net/2024/11/16/chJoFXtiAQOIZ24.png",path:_s+"vertical-center",component:e8e,type:"css",info:"多种方式实现水平垂直居中"},{name:"10px字体",img:"https://s2.loli.net/2024/11/16/6UAxNLktFWEp19D.png",path:_s+"px10",component:t8e,type:"css",info:"10px大小的字体"},{name:"多行文本溢出",img:"https://s2.loli.net/2024/11/16/STwlbGxRraoVyvt.png",path:_s+"multi-line",component:KUe,type:"css",info:"多行文本溢出"},{name:"自适应搜索框",img:"https://s2.loli.net/2024/11/16/TGhwNUIS4juCtAP.png",path:_s+"search-btn",component:JUe,type:"css",info:"自适应搜索框"},{name:"两栏布局",img:"https://s2.loli.net/2024/11/27/jt7IVgvzb5Scuk8.png",path:_s+"two-band",component:n8e,type:"css",info:"两栏布局"},{name:"0.5px线",img:"https://s2.loli.net/2024/11/27/m5CWc6qbVNaH9GJ.png",path:_s+"line05",component:r8e,type:"css",info:"0.5px线+禁止右键菜单等"},{name:"多边形绘制",img:"https://s2.loli.net/2024/11/16/m8LDxkrKYtHVG94.png",path:_s+"draw-poly",component:mUe,type:"css",info:"CSS画三角形和平行四边形"}];var YD={},ace={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/(function(n){(function(){var e={}.hasOwnProperty;function t(){for(var s="",a=0;a<arguments.length;a++){var l=arguments[a];l&&(s=i(s,r(l)))}return s}function r(s){if(typeof s=="string"||typeof s=="number")return s;if(typeof s!="object")return"";if(Array.isArray(s))return t.apply(null,s);if(s.toString!==Object.prototype.toString&&!s.toString.toString().includes("[native code]"))return s.toString();var a="";for(var l in s)e.call(s,l)&&s[l]&&(a=i(a,l));return a}function i(s,a){return a?s?s+" "+a:s+a:s}n.exports?(t.default=t,n.exports=t):window.classNames=t})()})(ace);var lce=ace.exports;YD.__esModule=!0;YD.default=void 0;var a8e=F8(Ae),S0=F8(Bne),l8e=F8(lce);function F8(n){return n&&n.__esModule?n:{default:n}}const cce=({animate:n=!0,className:e="",layout:t="2-columns",lineColor:r="#FFF",children:i})=>(typeof window=="object"&&document.documentElement.style.setProperty("--line-color",r),a8e.default.createElement("div",{className:(0,l8e.default)(e,"vertical-timeline",{"vertical-timeline--animate":n,"vertical-timeline--two-columns":t==="2-columns","vertical-timeline--one-column-left":t==="1-column"||t==="1-column-left","vertical-timeline--one-column-right":t==="1-column-right"})},i));cce.propTypes={children:S0.default.oneOfType([S0.default.arrayOf(S0.default.node),S0.default.node]).isRequired,className:S0.default.string,animate:S0.default.bool,layout:S0.default.oneOf(["1-column-left","1-column","2-columns","1-column-right"]),lineColor:S0.default.string};var c8e=cce;YD.default=c8e;var KD={};function YN(){return YN=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},YN.apply(this,arguments)}function u8e(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,KN(n,e)}function KN(n,e){return KN=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},KN(n,e)}function h8e(n,e){if(n==null)return{};var t={},r=Object.keys(n),i,s;for(s=0;s<r.length;s++)i=r[s],!(e.indexOf(i)>=0)&&(t[i]=n[i]);return t}var JN=new Map,pI=new WeakMap,xK=0,uce=void 0;function f8e(n){uce=n}function d8e(n){return n?(pI.has(n)||(xK+=1,pI.set(n,xK.toString())),pI.get(n)):"0"}function p8e(n){return Object.keys(n).sort().filter(function(e){return n[e]!==void 0}).map(function(e){return e+"_"+(e==="root"?d8e(n.root):n[e])}).toString()}function m8e(n){var e=p8e(n),t=JN.get(e);if(!t){var r=new Map,i,s=new IntersectionObserver(function(a){a.forEach(function(l){var o,h=l.isIntersecting&&i.some(function(d){return l.intersectionRatio>=d});n.trackVisibility&&typeof l.isVisible>"u"&&(l.isVisible=h),(o=r.get(l.target))==null||o.forEach(function(d){d(h,l)})})},n);i=s.thresholds||(Array.isArray(n.threshold)?n.threshold:[n.threshold||0]),t={id:e,observer:s,elements:r},JN.set(e,t)}return t}function N8(n,e,t,r){if(t===void 0&&(t={}),r===void 0&&(r=uce),typeof window.IntersectionObserver>"u"&&r!==void 0){var i=n.getBoundingClientRect();return e(r,{isIntersecting:r,target:n,intersectionRatio:typeof t.threshold=="number"?t.threshold:0,time:0,boundingClientRect:i,intersectionRect:i,rootBounds:i}),function(){}}var s=m8e(t),a=s.id,l=s.observer,o=s.elements,h=o.get(n)||[];return o.has(n)||o.set(n,h),h.push(e),l.observe(n),function(){h.splice(h.indexOf(e),1),h.length===0&&(o.delete(n),l.unobserve(n)),o.size===0&&(l.disconnect(),JN.delete(a))}}var g8e=["children","as","triggerOnce","threshold","root","rootMargin","onChange","skip","trackVisibility","delay","initialInView","fallbackInView"];function bK(n){return typeof n.children!="function"}var YP=function(n){u8e(e,n);function e(r){var i;return i=n.call(this,r)||this,i.node=null,i._unobserveCb=null,i.handleNode=function(s){i.node&&(i.unobserve(),!s&&!i.props.triggerOnce&&!i.props.skip&&i.setState({inView:!!i.props.initialInView,entry:void 0})),i.node=s||null,i.observeNode()},i.handleChange=function(s,a){s&&i.props.triggerOnce&&i.unobserve(),bK(i.props)||i.setState({inView:s,entry:a}),i.props.onChange&&i.props.onChange(s,a)},i.state={inView:!!r.initialInView,entry:void 0},i}var t=e.prototype;return t.componentDidUpdate=function(i){(i.rootMargin!==this.props.rootMargin||i.root!==this.props.root||i.threshold!==this.props.threshold||i.skip!==this.props.skip||i.trackVisibility!==this.props.trackVisibility||i.delay!==this.props.delay)&&(this.unobserve(),this.observeNode())},t.componentWillUnmount=function(){this.unobserve(),this.node=null},t.observeNode=function(){if(!(!this.node||this.props.skip)){var i=this.props,s=i.threshold,a=i.root,l=i.rootMargin,o=i.trackVisibility,h=i.delay,d=i.fallbackInView;this._unobserveCb=N8(this.node,this.handleChange,{threshold:s,root:a,rootMargin:l,trackVisibility:o,delay:h},d)}},t.unobserve=function(){this._unobserveCb&&(this._unobserveCb(),this._unobserveCb=null)},t.render=function(){if(!bK(this.props)){var i=this.state,s=i.inView,a=i.entry;return this.props.children({inView:s,entry:a,ref:this.handleNode})}var l=this.props,o=l.children,h=l.as,d=h8e(l,g8e);return Ae.createElement(h||"div",YN({ref:this.handleNode},d),o)},e}(Ae.Component);YP.displayName="InView";YP.defaultProps={threshold:0,triggerOnce:!1,initialInView:!1};function v8e(n){var e=n===void 0?{}:n,t=e.threshold,r=e.delay,i=e.trackVisibility,s=e.rootMargin,a=e.root,l=e.triggerOnce,o=e.skip,h=e.initialInView,d=e.fallbackInView,m=Ae.useRef(),_=Ae.useState({inView:!!h}),y=_[0],T=_[1],I=Ae.useCallback(function(M){m.current!==void 0&&(m.current(),m.current=void 0),!o&&M&&(m.current=N8(M,function(B,k){T({inView:B,entry:k}),k.isIntersecting&&l&&m.current&&(m.current(),m.current=void 0)},{root:a,rootMargin:s,threshold:t,trackVisibility:i,delay:r},d))},[Array.isArray(t)?t.toString():t,a,s,l,o,i,d,r]);Ae.useEffect(function(){!m.current&&y.entry&&!l&&!o&&T({inView:!!h})});var C=[I,y.inView,y.entry];return C.ref=C[0],C.inView=C[1],C.entry=C[2],C}const _8e=Object.freeze(Object.defineProperty({__proto__:null,InView:YP,default:YP,defaultFallbackInView:f8e,observe:N8,useInView:v8e},Symbol.toStringTag,{value:"Module"})),y8e=gfe(_8e);KD.__esModule=!0;KD.default=void 0;var A0=z8(Ae),So=z8(Bne),mI=z8(lce),x8e=y8e;function z8(n){return n&&n.__esModule?n:{default:n}}const hce=({children:n="",className:e="",contentArrowStyle:t=null,contentStyle:r=null,date:i="",dateClassName:s="",icon:a=null,iconClassName:l="",iconOnClick:o=null,onTimelineElementClick:h=null,iconStyle:d=null,id:m="",position:_="",style:y=null,textClassName:T="",intersectionObserverProps:I={rootMargin:"0px 0px -40px 0px",triggerOnce:!0},visible:C=!1})=>A0.default.createElement(x8e.InView,I,({inView:M,ref:B})=>A0.default.createElement("div",{ref:B,id:m,className:(0,mI.default)(e,"vertical-timeline-element",{"vertical-timeline-element--left":_==="left","vertical-timeline-element--right":_==="right","vertical-timeline-element--no-children":n===""}),style:y},A0.default.createElement(A0.default.Fragment,null,A0.default.createElement("span",{style:d,onClick:o,className:(0,mI.default)(l,"vertical-timeline-element-icon",{"bounce-in":M||C,"is-hidden":!(M||C)})},a),A0.default.createElement("div",{style:r,onClick:h,className:(0,mI.default)(T,"vertical-timeline-element-content",{"bounce-in":M||C,"is-hidden":!(M||C)})},A0.default.createElement("div",{style:t,className:"vertical-timeline-element-content-arrow"}),n,A0.default.createElement("span",{className:(0,mI.default)(s,"vertical-timeline-element-date")},i)))));hce.propTypes={children:So.default.oneOfType([So.default.arrayOf(So.default.node),So.default.node]),className:So.default.string,contentArrowStyle:So.default.shape({}),contentStyle:So.default.shape({}),date:So.default.node,dateClassName:So.default.string,icon:So.default.element,iconClassName:So.default.string,iconStyle:So.default.shape({}),iconOnClick:So.default.func,onTimelineElementClick:So.default.func,id:So.default.string,position:So.default.string,style:So.default.shape({}),textClassName:So.default.string,visible:So.default.bool,intersectionObserverProps:So.default.shape({root:So.default.object,rootMargin:So.default.string,threshold:So.default.number,triggerOnce:So.default.bool})};var b8e=hce;KD.default=b8e;var wK={VerticalTimeline:YD.default,VerticalTimelineElement:KD.default};const U8=()=>me.jsxs("section",{className:"cta",children:[me.jsxs("p",{className:"cta-text",children:["Have a project in mind? ",me.jsx("br",{className:"sm:block hidden"}),"Let's build something together! "]}),me.jsx(N0,{to:"/about_portfolio/contact",className:"btn",children:"Contact"})]}),w8e=()=>me.jsxs("section",{className:"max-container",children:[me.jsxs("h1",{className:"head-text",children:["Hello, I'm ",me.jsx("span",{className:"blue-gradient_text font-semibold drop-shadow",children:" Shealin"})]}),me.jsxs("div",{className:"mt-2 flex flex-col gap-3 text-slate-500",children:[me.jsx("p",{children:"电话/微信：+86-15651736857"}),me.jsx("p",{children:"邮箱：you_yxt@163.com"}),me.jsx("p",{children:"政治面貌：共产党员"}),me.jsx("p",{children:"资格证书：计算机二级（首考优秀）；GIS软件操作能力水平证书（初级）"}),me.jsx("p",{children:"英语水平：大学英语四级（首考619分）；大学英语六级（首考567分）"}),me.jsx("p",{children:"研究方向：城市地理、交通规划和分析、故事地图、AR地图、地理可视化"}),me.jsx("p",{children:"个人关键词"}),me.jsx("p",{children:"GIS开发：ArcGIS/QGIS，Geoserver，PostgreSQL&PostGIS"}),me.jsx("p",{children:"前端3D：html&css&js, nodejs, react; BootStrap, ECharts; ThreeJS, Cesium, WebGL"}),me.jsx("p",{children:"AR：Vuforia、U3D、Mapbox SDK for Unity、Lua"}),me.jsx("p",{children:"希望未来能说出：I have a background in GIS, Augmented Reality and front end, so … is like the perfect place for me."})]}),me.jsx("div",{className:"py-8 flex flex-col",children:me.jsx("h3",{className:"subhead-text",children:"教育背景"})}),me.jsxs("div",{className:"mt-2 flex flex-col gap-3 text-slate-500",children:[me.jsx("h4",{className:"text-slate-800",children:"理学学士，地理科学学院，南京师范大学，GPA:4.22/5，2019.09~2023.07"}),me.jsx("p",{children:"专业背景：地理学大类，分流至地理信息科学专业，主修GIScience理论类和开发类课程"}),me.jsx("p",{children:"优势科目：空间数据结构(99)、空间数据库原理(96)、C++与GIS内核开发(98)、C#与GIS二次开发(97)、GIS前沿与进展(95)"}),me.jsx("p",{children:"获奖情况：国家励志奖学金3次、南京师范大学优秀毕业生、南京师范大学优秀学生奖学金8次、南京师范大学三好学生3次、南京师范大学优秀共青团员2次、2021年美国大学生数学建模大赛H奖、2021年蓝桥杯大赛江苏省赛区C/C++ 组三等奖"}),me.jsx("h4",{className:"text-slate-800",children:"研究生在读，地理与海洋科学学院，南京大学，2023.09至今"}),me.jsx("p",{children:"专业背景：地图学与地理信息系统，偏人文历史关怀"}),me.jsx("p",{children:"获奖情况：南京大学学业奖学金一等、2024年“星湖杯”全国地图设计大赛一等奖、2024年第12届未来设计师·全国高校数字艺术设计大赛省级一等奖（国家级在评选中）"})]}),me.jsx("div",{className:"py-8 flex flex-col",children:me.jsx("h3",{className:"subhead-text",children:"科研成果"})}),me.jsxs("div",{className:"mt-2 flex flex-col gap-3 text-slate-500",children:[me.jsx("h4",{className:"text-slate-800",children:"论文"}),me.jsx("p",{children:"You, X., Chen, G.*, & Duan, J. (Forthcoming). Exploring Traffic Planning Networks across Multiple Scales Based on Urban Morphology: A Case Study of Nanjing, China. Journal of Urban Planning and Development. https://doi.org/10.1061/JUPDDM/UPENG-5086."}),me.jsx("p",{children:"Duan, J., Zhao, Z., Xu, Y., You, X., Yang, F., & Chen, G.* (2024). Spatial distribution characteristics and driving factors of Little Giant enterprises in China’s megacity clusters based on random forest and MGWR. Land, 13(7), 1105. https://doi.org/10.3390/land13071105."}),me.jsx("p",{children:"Deng, Z., You, X., Shi, Z., Gao, H., Hu, X., Yu, Z., & Yuan, L.* (2022). Identification of urban functional zones based on the spatial specificity of online car-hailing traffic cycle. ISPRS International Journal of Geo-Information, 11(8), 435. https://doi.org/10.3390/ijgi11080435."}),me.jsx("h4",{className:"text-slate-800",children:"专利软著"}),me.jsx("p",{children:"Chen, G., Xu, Y., Duan, J., You, X., Zhao, Z., & Yang, F. (2024). A method for constructing knowledge graphs in the biopharmaceutical industry. China Patent No. 202410712065.2. Authorized, pending issuance."}),me.jsx("p",{children:"软件著作权：《徐霞客的旅行世界网页开发》，共同开发，负责信息查询、路线规划及内容整合"})]}),me.jsx("div",{className:"py-8 flex flex-col",children:me.jsx("h3",{className:"subhead-text",children:"科研项目"})}),me.jsxs("div",{className:"mt-2 flex flex-col gap-3 text-slate-500",children:[me.jsxs("p",{children:["国家自然科学基金：2023至今，参与导师基金项目，包括城市形态学分析和 AR 地图设计。",me.jsx("br",{}),"1. 定量分析南京交通网络从20世纪80年代到2020年代使用城市形态学的演变，显示了从十字形到圆形的道路模式的转变和城市中心的南扩。",me.jsx("br",{}),"2. 对南京安全区的历史和地理背景进行了全面研究，最终设计并制作了一份 AR 故事地图。",me.jsx("br",{}),"3. 建立一个基于空间叙事、人机交互和地图对象的 AR 故事地图的叙事和互动框架。通过南京安全区的实例分析，验证了该方法的有效性。"]}),me.jsxs("p",{children:["学校“英才培养计划”：2020-2023，主题为“发展时空动态轨迹多模态特征解析方法，揭示城市交通流的动态变化模式与规律”,参与并推动了时频域数据处理和交通流分析",me.jsx("br",{}),"1. 对清理后的轨迹数据进行了一系列处理步骤，包括基于网格的划分、度量聚类和可视化，从而完成了数据处理工作。",me.jsx("br",{}),"2. 应用经验模态分解将网约车交通流分解为固有模态函数，并利用平均比例法计算各模态函数的贡献，从而揭示不同地点交通流的周期特性。"]}),me.jsx("p",{children:"学校大学生创新创业项目：2021-2022，研究内容为“城市交通流多模态时空特征解析方法”，参与"}),me.jsx("p",{children:"学院大学生创新创业项目：2019-2020年，研究内容为“基于AHP-熵值法的镇江市生态宜居城市评价及发展建议”，参与，主要负责方法体系的构建和求解部分"})]}),me.jsxs("div",{className:"py-8 flex flex-col",children:[me.jsx("h3",{className:"subhead-text",children:"专业技能"}),me.jsx("div",{className:"mt-16 flex flex-wrap gap-12",children:i8e.map(n=>me.jsxs("div",{className:"block-container w-20 h-20",children:[me.jsx("div",{className:"btn-back rounded-xl"}),me.jsx("div",{className:"btn-front rounded-xl flex justify-center items-center",children:me.jsx("img",{src:n.imageUrl,alt:n.name,className:"w-1/2 h-1/2 object-contain"})})]}))})]}),me.jsxs("div",{className:"py-16",children:[me.jsx("h3",{className:"subhead-text",children:"实习工作经历"}),me.jsx("div",{className:"mt-2 flex flex-col gap-3 text-slate-500 "}),me.jsx("div",{className:"mt-12 flex",children:me.jsx(wK.VerticalTimeline,{children:s8e.map(n=>me.jsxs(wK.VerticalTimelineElement,{date:n.date,icon:me.jsx("div",{className:"flex justify-center items-center w-full h-full",children:me.jsx("img",{src:n.icon,alt:n.company_name,className:"w-[60%] h-[60%] object-contain"})}),iconStyle:{background:n.iconBg},contentStyle:{borderBottom:"8px",borderStyle:"solid",borderBottomColor:n.iconBg,boxShadow:"none"},children:[me.jsxs("div",{children:[me.jsx("h3",{className:"text-black text-xl font-poppins font-semibold",children:n.title}),me.jsx("p",{className:"text-black-500 font-medium font-base",style:{margin:0},children:n.company_name})]}),me.jsx("ul",{className:"my-5 list-disc ml-5 space-y-2",children:n.points.map((e,t)=>me.jsx("li",{className:"text-black-500/50 font-normal pl-1 text-sm",children:e},`experience-point-${t}`))})]},n.company_name))})})]}),me.jsx("hr",{className:"border-slate-200"}),me.jsx(U8,{})]}),gI=n=>me.jsxs("div",{className:"group relative",children:[me.jsx("div",{className:"relative h-80 w-full overflow-hidden rounded-lg bg-white sm:aspect-h-1 sm:aspect-w-2 lg:aspect-h-1 lg:aspect-w-1 group-hover:opacity-75 sm:h-64",children:me.jsx("img",{src:n.img,alt:n.name,className:"h-full w-full object-cover object-center"})}),me.jsx("h3",{className:"mt-1 text-sm text-slate-500",children:me.jsxs("div",{children:[me.jsx("span",{className:"absolute inset-0"}),n.type]})}),me.jsx("p",{className:"mb-3 text-base font-semibold text-slate-900",children:n.info})]}),S8e=()=>me.jsxs("section",{className:"max-container",children:[me.jsxs("h1",{className:"head-text",children:[" ",me.jsx("span",{className:"blue-gradient_text font-semibold drop-shadow",children:"ThreeJS"})," Works "]}),me.jsx("div",{className:"py-10",children:me.jsx("div",{className:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8",children:me.jsx("div",{className:"mt-6 space-y-12 lg:grid lg:grid-cols-3 lg:gap-x-6 lg:space-y-0",children:rce.map((n,e)=>me.jsx(N0,{to:n.path,children:me.jsx(gI,{...n})},e))})})}),me.jsx("hr",{className:"border-slate-200"}),me.jsxs("h1",{className:"head-text mt-6",children:[" ",me.jsx("span",{className:"blue-gradient_text font-semibold drop-shadow",children:"Mapbox GL JS"})," Works "]}),me.jsx("div",{className:"py-10",children:me.jsx("div",{className:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8",children:me.jsx("div",{className:"mt-3 space-y-12 lg:grid lg:grid-cols-3 lg:gap-x-6 lg:space-y-0",children:ice.map((n,e)=>me.jsx(N0,{to:n.path,children:me.jsx(gI,{...n})},e))})})}),me.jsx("hr",{className:"border-slate-200"}),me.jsxs("h1",{className:"head-text mt-6",children:[" ",me.jsx("span",{className:"blue-gradient_text font-semibold drop-shadow",children:" 2D"})," Visualization "]}),me.jsx("div",{className:"py-10",children:me.jsx("div",{className:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8",children:me.jsx("div",{className:"mt-3 space-y-12 lg:grid lg:grid-cols-3 lg:gap-x-6 lg:space-y-0",children:sce.map((n,e)=>me.jsx(N0,{to:n.path,children:me.jsx(gI,{...n})},e))})})}),me.jsx("hr",{className:"border-slate-200"}),me.jsxs("h1",{className:"head-text mt-6",children:[" ",me.jsx("span",{className:"blue-gradient_text font-semibold drop-shadow",children:"场景"})," 题 "]}),me.jsx("div",{className:"py-10",children:me.jsx("div",{className:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8",children:me.jsx("div",{className:"mt-3 space-y-12 lg:grid lg:grid-cols-3 lg:gap-x-6 lg:space-y-0",children:oce.map((n,e)=>me.jsx(N0,{to:n.path,children:me.jsx(gI,{...n})},e))})})}),me.jsx("hr",{className:"border-slate-200"}),me.jsx(U8,{})]}),dT={_origin:"https://api.emailjs.com"},A8e=(n,e="https://api.emailjs.com")=>{dT._userID=n,dT._origin=e},fce=(n,e,t)=>{if(!n)throw"The public key is required. Visit https://dashboard.emailjs.com/admin/account";if(!e)throw"The service ID is required. Visit https://dashboard.emailjs.com/admin";if(!t)throw"The template ID is required. Visit https://dashboard.emailjs.com/admin/templates";return!0};class SK{constructor(e){this.status=e?e.status:0,this.text=e?e.responseText:"Network Error"}}const dce=(n,e,t={})=>new Promise((r,i)=>{const s=new XMLHttpRequest;s.addEventListener("load",({target:a})=>{const l=new SK(a);l.status===200||l.text==="OK"?r(l):i(l)}),s.addEventListener("error",({target:a})=>{i(new SK(a))}),s.open("POST",dT._origin+n,!0),Object.keys(t).forEach(a=>{s.setRequestHeader(a,t[a])}),s.send(e)}),T8e=(n,e,t,r)=>{const i=r||dT._userID;return fce(i,n,e),dce("/api/v1.0/email/send",JSON.stringify({lib_version:"3.11.0",user_id:i,service_id:n,template_id:e,template_params:t}),{"Content-type":"application/json"})},M8e=n=>{let e;if(typeof n=="string"?e=document.querySelector(n):e=n,!e||e.nodeName!=="FORM")throw"The 3rd parameter is expected to be the HTML form element or the style selector of form";return e},C8e=(n,e,t,r)=>{const i=r||dT._userID,s=M8e(t);fce(i,n,e);const a=new FormData(s);return a.append("lib_version","3.11.0"),a.append("service_id",n),a.append("template_id",e),a.append("user_id",i),dce("/api/v1.0/email/send-form",a)},E8e={init:A8e,send:T8e,sendForm:C8e},I8e=({type:n,text:e})=>me.jsx("div",{className:"absolute top-10 left-0 right-0 flex justify-center items-center",children:me.jsxs("div",{className:`${n==="danger"?"bg-red-800":"bg-blue-800"} p-2 text-indigo-100 leading-none lg:rounded-full flex lg:inline-flex items-center`,role:"alert",children:[me.jsx("p",{className:`${n==="danger"?"bg-red-500":"bg-blue-500"} flex rounded-full uppercase px-2 py-1 font-semibold mr-3 text-xs`,children:n==="danger"?"Failed":"Success"}),me.jsxs("p",{className:"mr-2 text-left",children:[" ",e," "]})]})}),R8e=()=>{const[n,e]=Ae.useState({show:!1,text:"",type:"danger"});return{alert:n,showAlert:({text:i,type:s="danger"})=>e({show:!0,text:i,type:s}),hideAlert:()=>e({show:!1,text:"",type:"danger"})}},P8e=()=>{const n=Ae.useRef(null),[e,t]=Ae.useState({name:"",email:"",message:""}),[r,i]=Ae.useState(!1),[s,a]=Ae.useState("idle"),{alert:l,showAlert:o,hideAlert:h}=R8e(),d=T=>{t({...e,[T.target.name]:T.target.value})},m=()=>{a("walk")},_=()=>{a("idle")},y=T=>{T.preventDefault(),i(!0),a("hit"),E8e.send("service_5bezaam","template_dafnzfi",{from_name:e.name,to_name:"Shealin",from_email:e.email,to_email:"yikeyouIl@gmail.com",message:e.message},"JpbkxBEdlS8faxCrq").then(()=>{i(!1),o({show:!0,text:"Your message has been sent successfully!",type:"success"}),setTimeout(()=>{h(),a("idle"),t({name:"",email:"",message:""})},[3e3])}).catch(I=>{i(!1),a("idle"),console.log(I),o({show:!0,text:"I didn't receive your message",type:"danger"})})};return me.jsxs("section",{className:"relative flex lg:flex-row flex-col max-container h-[100vh]",children:[l.show&&me.jsx(I8e,{...l}),me.jsxs("div",{className:"flex-1 min-w-[50%] flex flex-col",children:[me.jsx("h1",{className:"head-text",children:"Get in Touch"}),me.jsxs("form",{action:"",className:"w-full flex flex-col gap-7 mt-14",ref:n,onSubmit:y,children:[me.jsxs("label",{className:"text-black-500 font-semibold",children:["Name",me.jsx("input",{type:"text",name:"name",className:"input",placeholder:"John",required:!0,value:e.name,onChange:d,onFocus:m,onBlur:_})]}),me.jsxs("label",{className:"text-black-500 font-semibold",children:["Email",me.jsx("input",{type:"email",name:"email",className:"input",placeholder:"John@gmail.com",required:!0,value:e.email,onChange:d,onFocus:m,onBlur:_})]}),me.jsxs("label",{className:"text-black-500 font-semibold",children:["Your Message",me.jsx("textarea",{name:"message",rows:"4",className:"textarea",placeholder:"Let me know how I can help you!",required:!0,value:e.message,onChange:d,onFocus:m,onBlur:_})]}),me.jsx("button",{type:"submit",className:"btn",disabled:r,onFocus:m,onBlur:_,children:r?"Sending...":"Submit"})]})]}),me.jsx("div",{className:"lg:w-1/2 w-full lg:h-auto md:h-[550px] h-[350px]",children:me.jsxs(nD,{camera:{position:[0,0,5],fov:75,near:.1,far:1e3},children:[me.jsx("ambientLight",{intensity:.5}),me.jsx("directionalLight",{intensity:2.5,position:[0,0,1]}),me.jsx(Ae.Suspense,{fallback:me.jsx(H6,{}),children:me.jsx(Nae,{currentAnimation:s,position:[.5,.35,0],rotation:[12.6,-.5,0],scale:[.5,.5,.5]})})]})})]})},L8e=""+new URL("sakura-Dh6hhofb.mp3",import.meta.url).href,Vk=({text:n,link:e,btnText:t})=>me.jsxs("div",{className:"info-box",children:[me.jsx("p",{className:"whitespace-pre-wrap font-medium sm:text-xl text-center",children:n}),me.jsxs(N0,{to:e,className:"neo-brutalism-white neo-btn",children:[t,me.jsx("img",{src:One,className:"w-4 h-4 object-contain"})]})]}),D8e={1:me.jsxs("h1",{className:"sm:text-xl sm:leading-snug text-center neo-brutalism-blue py-4 px-8 text-white mx-5",children:["Hi, I am ",me.jsx("span",{className:"font-semibold",children:"Shealin"})," 👏",me.jsx("br",{}),"来自中国南京的研究生(现阶段...)"]}),2:me.jsx(Vk,{text:"有很多的求学求职经历，也在不断修炼自己...",link:"/about_portfolio/about",btnText:"Learn more"}),3:me.jsx(Vk,{text:"自己写过有意思的项目，也曾与多个团队携手共进...",link:"/about_portfolio/projects",btnText:"Visit projects"}),4:me.jsx(Vk,{text:"想要交流、合作或者寻求一个开发者?",link:"/about_portfolio/contact",btnText:"Let's talk"})},B8e=({currentStage:n})=>D8e[n]||null;var k8e=Object.defineProperty,O8e=(n,e)=>{for(var t in e)k8e(n,t,{get:e[t],enumerable:!0})},sw={};O8e(sw,{assign:()=>V8e,colors:()=>iv,createStringInterpolator:()=>$8,skipAnimation:()=>xce,to:()=>yce,willAdvance:()=>q8});var V8=uM(),ls=n=>cM(n,V8),G8=uM();ls.write=n=>cM(n,G8);var JD=uM();ls.onStart=n=>cM(n,JD);var H8=uM();ls.onFrame=n=>cM(n,H8);var j8=uM();ls.onFinish=n=>cM(n,j8);var Fb=[];ls.setTimeout=(n,e)=>{const t=ls.now()+e,r=()=>{const s=Fb.findIndex(a=>a.cancel==r);~s&&Fb.splice(s,1),j0-=~s?1:0},i={time:t,handler:n,cancel:r};return Fb.splice(pce(t),0,i),j0+=1,mce(),i};var pce=n=>~(~Fb.findIndex(e=>e.time>n)||~Fb.length);ls.cancel=n=>{JD.delete(n),H8.delete(n),j8.delete(n),V8.delete(n),G8.delete(n)};ls.sync=n=>{QN=!0,ls.batchedUpdates(n),QN=!1};ls.throttle=n=>{let e;function t(){try{n(...e)}finally{e=null}}function r(...i){e=i,ls.onStart(t)}return r.handler=n,r.cancel=()=>{JD.delete(t),e=null},r};var W8=typeof window<"u"?window.requestAnimationFrame:()=>{};ls.use=n=>W8=n;ls.now=typeof performance<"u"?()=>performance.now():Date.now;ls.batchedUpdates=n=>n();ls.catch=console.error;ls.frameLoop="always";ls.advance=()=>{ls.frameLoop!=="demand"?console.warn("Cannot call the manual advancement of rafz whilst frameLoop is not set as demand"):vce()};var H0=-1,j0=0,QN=!1;function cM(n,e){QN?(e.delete(n),n(0)):(e.add(n),mce())}function mce(){H0<0&&(H0=0,ls.frameLoop!=="demand"&&W8(gce))}function F8e(){H0=-1}function gce(){~H0&&(W8(gce),ls.batchedUpdates(vce))}function vce(){const n=H0;H0=ls.now();const e=pce(H0);if(e&&(_ce(Fb.splice(0,e),t=>t.handler()),j0-=e),!j0){F8e();return}JD.flush(),V8.flush(n?Math.min(64,H0-n):16.667),H8.flush(),G8.flush(),j8.flush()}function uM(){let n=new Set,e=n;return{add(t){j0+=e==n&&!n.has(t)?1:0,n.add(t)},delete(t){return j0-=e==n&&n.has(t)?1:0,n.delete(t)},flush(t){e.size&&(n=new Set,j0-=e.size,_ce(e,r=>r(t)&&n.add(r)),j0+=n.size,e=n)}}}function _ce(n,e){n.forEach(t=>{try{e(t)}catch(r){ls.catch(r)}})}function N8e(){}var z8e=(n,e,t)=>Object.defineProperty(n,e,{value:t,writable:!0,configurable:!0}),ra={arr:Array.isArray,obj:n=>!!n&&n.constructor.name==="Object",fun:n=>typeof n=="function",str:n=>typeof n=="string",num:n=>typeof n=="number",und:n=>n===void 0};function U8e(n,e){if(ra.arr(n)){if(!ra.arr(e)||n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}return n===e}var km=(n,e)=>n.forEach(e);function ez(n,e,t){if(ra.arr(n)){for(let r=0;r<n.length;r++)e.call(t,n[r],`${r}`);return}for(const r in n)n.hasOwnProperty(r)&&e.call(t,n[r],r)}var vI=n=>ra.und(n)?[]:ra.arr(n)?n:[n],X8=()=>typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),$8,yce,iv=null,xce=!1,q8=N8e,V8e=n=>{n.to&&(yce=n.to),n.now&&(ls.now=n.now),n.colors!==void 0&&(iv=n.colors),n.skipAnimation!=null&&(xce=n.skipAnimation),n.createStringInterpolator&&($8=n.createStringInterpolator),n.requestAnimationFrame&&ls.use(n.requestAnimationFrame),n.batchedUpdates&&(ls.batchedUpdates=n.batchedUpdates),n.willAdvance&&(q8=n.willAdvance),n.frameLoop&&(ls.frameLoop=n.frameLoop)},cA=new Set,xh=[],Gk=[],KP=0,Z8={get idle(){return!cA.size&&!xh.length},start(n){KP>n.priority?(cA.add(n),ls.onStart(G8e)):(bce(n),ls(tz))},advance:tz,sort(n){if(KP)ls.onFrame(()=>Z8.sort(n));else{const e=xh.indexOf(n);~e&&(xh.splice(e,1),wce(n))}},clear(){xh=[],cA.clear()}};function G8e(){cA.forEach(bce),cA.clear(),ls(tz)}function bce(n){xh.includes(n)||wce(n)}function wce(n){xh.splice(H8e(xh,e=>e.priority>n.priority),0,n)}function tz(n){const e=Gk;for(let t=0;t<xh.length;t++){const r=xh[t];KP=r.priority,r.idle||(q8(r),r.advance(n),r.idle||e.push(r))}return KP=0,Gk=xh,Gk.length=0,xh=e,xh.length>0}function H8e(n,e){const t=n.findIndex(e);return t<0?n.length:t}var j8e={transparent:0,aliceblue:4042850303,antiquewhite:4209760255,aqua:16777215,aquamarine:2147472639,azure:4043309055,beige:4126530815,bisque:4293182719,black:255,blanchedalmond:4293643775,blue:65535,blueviolet:2318131967,brown:2771004159,burlywood:3736635391,burntsienna:3934150143,cadetblue:1604231423,chartreuse:2147418367,chocolate:3530104575,coral:4286533887,cornflowerblue:1687547391,cornsilk:4294499583,crimson:3692313855,cyan:16777215,darkblue:35839,darkcyan:9145343,darkgoldenrod:3095792639,darkgray:2846468607,darkgreen:6553855,darkgrey:2846468607,darkkhaki:3182914559,darkmagenta:2332068863,darkolivegreen:1433087999,darkorange:4287365375,darkorchid:2570243327,darkred:2332033279,darksalmon:3918953215,darkseagreen:2411499519,darkslateblue:1211993087,darkslategray:793726975,darkslategrey:793726975,darkturquoise:13554175,darkviolet:2483082239,deeppink:4279538687,deepskyblue:12582911,dimgray:1768516095,dimgrey:1768516095,dodgerblue:512819199,firebrick:2988581631,floralwhite:4294635775,forestgreen:579543807,fuchsia:4278255615,gainsboro:3705462015,ghostwhite:4177068031,gold:4292280575,goldenrod:3668254975,gray:2155905279,green:8388863,greenyellow:2919182335,grey:2155905279,honeydew:4043305215,hotpink:4285117695,indianred:3445382399,indigo:1258324735,ivory:4294963455,khaki:4041641215,lavender:3873897215,lavenderblush:4293981695,lawngreen:2096890111,lemonchiffon:4294626815,lightblue:2916673279,lightcoral:4034953471,lightcyan:3774873599,lightgoldenrodyellow:4210742015,lightgray:3553874943,lightgreen:2431553791,lightgrey:3553874943,lightpink:4290167295,lightsalmon:4288707327,lightseagreen:548580095,lightskyblue:2278488831,lightslategray:2005441023,lightslategrey:2005441023,lightsteelblue:2965692159,lightyellow:4294959359,lime:16711935,limegreen:852308735,linen:4210091775,magenta:4278255615,maroon:2147483903,mediumaquamarine:1724754687,mediumblue:52735,mediumorchid:3126187007,mediumpurple:2473647103,mediumseagreen:1018393087,mediumslateblue:2070474495,mediumspringgreen:16423679,mediumturquoise:1221709055,mediumvioletred:3340076543,midnightblue:421097727,mintcream:4127193855,mistyrose:4293190143,moccasin:4293178879,navajowhite:4292783615,navy:33023,oldlace:4260751103,olive:2155872511,olivedrab:1804477439,orange:4289003775,orangered:4282712319,orchid:3664828159,palegoldenrod:4008225535,palegreen:2566625535,paleturquoise:2951671551,palevioletred:3681588223,papayawhip:4293907967,peachpuff:4292524543,peru:3448061951,pink:4290825215,plum:3718307327,powderblue:2967529215,purple:2147516671,rebeccapurple:1714657791,red:4278190335,rosybrown:3163525119,royalblue:1097458175,saddlebrown:2336560127,salmon:4202722047,sandybrown:4104413439,seagreen:780883967,seashell:4294307583,sienna:2689740287,silver:3233857791,skyblue:2278484991,slateblue:1784335871,slategray:1887473919,slategrey:1887473919,snow:4294638335,springgreen:16744447,steelblue:1182971135,tan:3535047935,teal:8421631,thistle:3636451583,tomato:4284696575,turquoise:1088475391,violet:4001558271,wheat:4125012991,white:4294967295,whitesmoke:4126537215,yellow:4294902015,yellowgreen:2597139199},Uf="[-+]?\\d*\\.?\\d+",JP=Uf+"%";function QD(...n){return"\\(\\s*("+n.join(")\\s*,\\s*(")+")\\s*\\)"}var W8e=new RegExp("rgb"+QD(Uf,Uf,Uf)),X8e=new RegExp("rgba"+QD(Uf,Uf,Uf,Uf)),$8e=new RegExp("hsl"+QD(Uf,JP,JP)),q8e=new RegExp("hsla"+QD(Uf,JP,JP,Uf)),Z8e=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,Y8e=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,K8e=/^#([0-9a-fA-F]{6})$/,J8e=/^#([0-9a-fA-F]{8})$/;function Q8e(n){let e;return typeof n=="number"?n>>>0===n&&n>=0&&n<=4294967295?n:null:(e=K8e.exec(n))?parseInt(e[1]+"ff",16)>>>0:iv&&iv[n]!==void 0?iv[n]:(e=W8e.exec(n))?(z1(e[1])<<24|z1(e[2])<<16|z1(e[3])<<8|255)>>>0:(e=X8e.exec(n))?(z1(e[1])<<24|z1(e[2])<<16|z1(e[3])<<8|MK(e[4]))>>>0:(e=Z8e.exec(n))?parseInt(e[1]+e[1]+e[2]+e[2]+e[3]+e[3]+"ff",16)>>>0:(e=J8e.exec(n))?parseInt(e[1],16)>>>0:(e=Y8e.exec(n))?parseInt(e[1]+e[1]+e[2]+e[2]+e[3]+e[3]+e[4]+e[4],16)>>>0:(e=$8e.exec(n))?(AK(TK(e[1]),_I(e[2]),_I(e[3]))|255)>>>0:(e=q8e.exec(n))?(AK(TK(e[1]),_I(e[2]),_I(e[3]))|MK(e[4]))>>>0:null}function Hk(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*(2/3-t)*6:n}function AK(n,e,t){const r=t<.5?t*(1+e):t+e-t*e,i=2*t-r,s=Hk(i,r,n+1/3),a=Hk(i,r,n),l=Hk(i,r,n-1/3);return Math.round(s*255)<<24|Math.round(a*255)<<16|Math.round(l*255)<<8}function z1(n){const e=parseInt(n,10);return e<0?0:e>255?255:e}function TK(n){return(parseFloat(n)%360+360)%360/360}function MK(n){const e=parseFloat(n);return e<0?0:e>1?255:Math.round(e*255)}function _I(n){const e=parseFloat(n);return e<0?0:e>100?1:e/100}function CK(n){let e=Q8e(n);if(e===null)return n;e=e||0;const t=(e&4278190080)>>>24,r=(e&16711680)>>>16,i=(e&65280)>>>8,s=(e&255)/255;return`rgba(${t}, ${r}, ${i}, ${s})`}var pT=(n,e,t)=>{if(ra.fun(n))return n;if(ra.arr(n))return pT({range:n,output:e,extrapolate:t});if(ra.str(n.output[0]))return $8(n);const r=n,i=r.output,s=r.range||[0,1],a=r.extrapolateLeft||r.extrapolate||"extend",l=r.extrapolateRight||r.extrapolate||"extend",o=r.easing||(h=>h);return h=>{const d=t9e(h,s);return e9e(h,s[d],s[d+1],i[d],i[d+1],o,a,l,r.map)}};function e9e(n,e,t,r,i,s,a,l,o){let h=o?o(n):n;if(h<e){if(a==="identity")return h;a==="clamp"&&(h=e)}if(h>t){if(l==="identity")return h;l==="clamp"&&(h=t)}return r===i?r:e===t?n<=e?r:i:(e===-1/0?h=-h:t===1/0?h=h-e:h=(h-e)/(t-e),h=s(h),r===-1/0?h=-h:i===1/0?h=h+r:h=h*(i-r)+r,h)}function t9e(n,e){for(var t=1;t<e.length-1&&!(e[t]>=n);++t);return t-1}var mT=Symbol.for("FluidValue.get"),gT=Symbol.for("FluidValue.observers"),QP=n=>!!(n&&n[mT]),eL=n=>n&&n[mT]?n[mT]():n;function n9e(n,e){n.eventObserved?n.eventObserved(e):n(e)}function nz(n,e){const t=n[gT];t&&t.forEach(r=>{n9e(r,e)})}var r9e=class{constructor(n){if(!n&&!(n=this.get))throw Error("Unknown getter");i9e(this,n)}},i9e=(n,e)=>Ace(n,mT,e);function Sce(n,e){if(n[mT]){let t=n[gT];t||Ace(n,gT,t=new Set),t.has(e)||(t.add(e),n.observerAdded&&n.observerAdded(t.size,e))}return e}function rz(n,e){const t=n[gT];if(t&&t.has(e)){const r=t.size-1;r?t.delete(e):n[gT]=null,n.observerRemoved&&n.observerRemoved(r,e)}}var Ace=(n,e,t)=>Object.defineProperty(n,e,{value:t,writable:!0,configurable:!0}),YI=/[+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,s9e=/(#(?:[0-9a-f]{2}){2,4}|(#[0-9a-f]{3})|(rgb|hsl)a?\((-?\d+%?[,\s]+){2,3}\s*[\d\.]+%?\))/gi,EK=new RegExp(`(${YI.source})(%|[a-z]+)`,"i"),o9e=/rgba\(([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+)\)/gi,e3=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/,Tce=n=>{const[e,t]=a9e(n);if(!e||X8())return n;const r=window.getComputedStyle(document.documentElement).getPropertyValue(e);if(r)return r.trim();if(t&&t.startsWith("--")){const i=window.getComputedStyle(document.documentElement).getPropertyValue(t);return i||n}else{if(t&&e3.test(t))return Tce(t);if(t)return t}return n},a9e=n=>{const e=e3.exec(n);if(!e)return[,];const[,t,r]=e;return[t,r]},jk,l9e=(n,e,t,r,i)=>`rgba(${Math.round(e)}, ${Math.round(t)}, ${Math.round(r)}, ${i})`,Mce=n=>{jk||(jk=iv?new RegExp(`(${Object.keys(iv).join("|")})(?!\\w)`,"g"):/^\b$/);const e=n.output.map(s=>eL(s).replace(e3,Tce).replace(s9e,CK).replace(jk,CK)),t=e.map(s=>s.match(YI).map(Number)),i=t[0].map((s,a)=>t.map(l=>{if(!(a in l))throw Error('The arity of each "output" value must be equal');return l[a]})).map(s=>pT({...n,output:s}));return s=>{var o;const a=!EK.test(e[0])&&((o=e.find(h=>EK.test(h)))==null?void 0:o.replace(YI,""));let l=0;return e[0].replace(YI,()=>`${i[l++](s)}${a||""}`).replace(o9e,l9e)}},Cce="react-spring: ",Ece=n=>{const e=n;let t=!1;if(typeof e!="function")throw new TypeError(`${Cce}once requires a function parameter`);return(...r)=>{t||(e(...r),t=!0)}},c9e=Ece(console.warn);function u9e(){c9e(`${Cce}The "interpolate" function is deprecated in v9 (use "to" instead)`)}Ece(console.warn);function Ice(n){return ra.str(n)&&(n[0]=="#"||/\d/.test(n)||!X8()&&e3.test(n)||n in(iv||{}))}var Rce=X8()?Ae.useEffect:Ae.useLayoutEffect,h9e=()=>{const n=Ae.useRef(!1);return Rce(()=>(n.current=!0,()=>{n.current=!1}),[]),n};function f9e(){const n=Ae.useState()[1],e=h9e();return()=>{e.current&&n(Math.random())}}function d9e(n,e){const[t]=Ae.useState(()=>({inputs:e,result:n()})),r=Ae.useRef(),i=r.current;let s=i;return s?e&&s.inputs&&p9e(e,s.inputs)||(s={inputs:e,result:n()}):s=t,Ae.useEffect(()=>{r.current=s,i==t&&(t.inputs=t.result=void 0)},[s]),s.result}function p9e(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}var m9e=n=>Ae.useEffect(n,g9e),g9e=[],vT=Symbol.for("Animated:node"),v9e=n=>!!n&&n[vT]===n,Y8=n=>n&&n[vT],Pce=(n,e)=>z8e(n,vT,e),K8=n=>n&&n[vT]&&n[vT].getPayload(),Lce=class{constructor(){Pce(this,this)}getPayload(){return this.payload||[]}},t3=class extends Lce{constructor(n){super(),this._value=n,this.done=!0,this.durationProgress=0,ra.num(this._value)&&(this.lastPosition=this._value)}static create(n){return new t3(n)}getPayload(){return[this]}getValue(){return this._value}setValue(n,e){return ra.num(n)&&(this.lastPosition=n,e&&(n=Math.round(n/e)*e,this.done&&(this.lastPosition=n))),this._value===n?!1:(this._value=n,!0)}reset(){const{done:n}=this;this.done=!1,ra.num(this._value)&&(this.elapsedTime=0,this.durationProgress=0,this.lastPosition=this._value,n&&(this.lastVelocity=null),this.v0=null)}},J8=class extends t3{constructor(n){super(0),this._string=null,this._toString=pT({output:[n,n]})}static create(n){return new J8(n)}getValue(){const n=this._string;return n??(this._string=this._toString(this._value))}setValue(n){if(ra.str(n)){if(n==this._string)return!1;this._string=n,this._value=1}else if(super.setValue(n))this._string=null;else return!1;return!0}reset(n){n&&(this._toString=pT({output:[this.getValue(),n]})),this._value=0,super.reset()}},tL={dependencies:null},Q8=class extends Lce{constructor(n){super(),this.source=n,this.setValue(n)}getValue(n){const e={};return ez(this.source,(t,r)=>{v9e(t)?e[r]=t.getValue(n):QP(t)?e[r]=eL(t):n||(e[r]=t)}),e}setValue(n){this.source=n,this.payload=this._makePayload(n)}reset(){this.payload&&km(this.payload,n=>n.reset())}_makePayload(n){if(n){const e=new Set;return ez(n,this._addToPayload,e),Array.from(e)}}_addToPayload(n){tL.dependencies&&QP(n)&&tL.dependencies.add(n);const e=K8(n);e&&km(e,t=>this.add(t))}},Dce=class extends Q8{constructor(n){super(n)}static create(n){return new Dce(n)}getValue(){return this.source.map(n=>n.getValue())}setValue(n){const e=this.getPayload();return n.length==e.length?e.map((t,r)=>t.setValue(n[r])).some(Boolean):(super.setValue(n.map(_9e)),!0)}};function _9e(n){return(Ice(n)?J8:t3).create(n)}function y9e(n){const e=Y8(n);return e?e.constructor:ra.arr(n)?Dce:Ice(n)?J8:t3}var IK=(n,e)=>{const t=!ra.fun(n)||n.prototype&&n.prototype.isReactComponent;return Ae.forwardRef((r,i)=>{const s=Ae.useRef(null),a=t&&Ae.useCallback(T=>{s.current=w9e(i,T)},[i]),[l,o]=b9e(r,e),h=f9e(),d=()=>{const T=s.current;if(t&&!T)return;(T?e.applyAnimatedValues(T,l.getValue(!0)):!1)===!1&&h()},m=new x9e(d,o),_=Ae.useRef();Rce(()=>(_.current=m,km(o,T=>Sce(T,m)),()=>{_.current&&(km(_.current.deps,T=>rz(T,_.current)),ls.cancel(_.current.update))})),Ae.useEffect(d,[]),m9e(()=>()=>{const T=_.current;km(T.deps,I=>rz(I,T))});const y=e.getComponentProps(l.getValue());return Ae.createElement(n,{...y,ref:a})})},x9e=class{constructor(n,e){this.update=n,this.deps=e}eventObserved(n){n.type=="change"&&ls.write(this.update)}};function b9e(n,e){const t=new Set;return tL.dependencies=t,n.style&&(n={...n,style:e.createAnimatedStyle(n.style)}),n=new Q8(n),tL.dependencies=null,[n,t]}function w9e(n,e){return n&&(ra.fun(n)?n(e):n.current=e),e}var RK=Symbol.for("AnimatedComponent"),S9e=(n,{applyAnimatedValues:e=()=>!1,createAnimatedStyle:t=i=>new Q8(i),getComponentProps:r=i=>i}={})=>{const i={applyAnimatedValues:e,createAnimatedStyle:t,getComponentProps:r},s=a=>{const l=PK(a)||"Anonymous";return ra.str(a)?a=s[a]||(s[a]=IK(a,i)):a=a[RK]||(a[RK]=IK(a,i)),a.displayName=`Animated(${l})`,a};return ez(n,(a,l)=>{ra.arr(n)&&(l=PK(a)),s[l]=s(a)}),{animated:s}},PK=n=>ra.str(n)?n:n&&ra.str(n.displayName)?n.displayName:ra.fun(n)&&n.name||null,LK=n=>n instanceof Bce,A9e=1,Bce=class extends r9e{constructor(){super(...arguments),this.id=A9e++,this._priority=0}get priority(){return this._priority}set priority(n){this._priority!=n&&(this._priority=n,this._onPriorityChange(n))}get(){const n=Y8(this);return n&&n.getValue()}to(...n){return sw.to(this,n)}interpolate(...n){return u9e(),sw.to(this,n)}toJSON(){return this.get()}observerAdded(n){n==1&&this._attach()}observerRemoved(n){n==0&&this._detach()}_attach(){}_detach(){}_onChange(n,e=!1){nz(this,{type:"change",parent:this,value:n,idle:e})}_onPriorityChange(n){this.idle||Z8.sort(this),nz(this,{type:"priority",parent:this,priority:n})}},e9=({children:n,...e})=>{const t=Ae.useContext(nL),r=e.pause||!!t.pause,i=e.immediate||!!t.immediate;e=d9e(()=>({pause:r,immediate:i}),[r,i]);const{Provider:s}=nL;return Ae.createElement(s,{value:e},n)},nL=T9e(e9,{});e9.Provider=nL.Provider;e9.Consumer=nL.Consumer;function T9e(n,e){return Object.assign(n,Ae.createContext(e)),n.Provider._context=n,n.Consumer._context=n,n}var M9e=class extends Bce{constructor(n,e){super(),this.source=n,this.idle=!0,this._active=new Set,this.calc=pT(...e);const t=this._get(),r=y9e(t);Pce(this,r.create(t))}advance(n){const e=this._get(),t=this.get();U8e(e,t)||(Y8(this).setValue(e),this._onChange(e,this.idle)),!this.idle&&DK(this._active)&&Wk(this)}_get(){const n=ra.arr(this.source)?this.source.map(eL):vI(eL(this.source));return this.calc(...n)}_start(){this.idle&&!DK(this._active)&&(this.idle=!1,km(K8(this),n=>{n.done=!1}),sw.skipAnimation?(ls.batchedUpdates(()=>this.advance()),Wk(this)):Z8.start(this))}_attach(){let n=1;km(vI(this.source),e=>{QP(e)&&Sce(e,this),LK(e)&&(e.idle||this._active.add(e),n=Math.max(n,e.priority+1))}),this.priority=n,this._start()}_detach(){km(vI(this.source),n=>{QP(n)&&rz(n,this)}),this._active.clear(),Wk(this)}eventObserved(n){n.type=="change"?n.idle?this.advance():(this._active.add(n.parent),this._start()):n.type=="idle"?this._active.delete(n.parent):n.type=="priority"&&(this.priority=vI(this.source).reduce((e,t)=>Math.max(e,(LK(t)?t.priority:0)+1),0))}};function C9e(n){return n.idle!==!1}function DK(n){return!n.size||Array.from(n).every(C9e)}function Wk(n){n.idle||(n.idle=!0,km(K8(n),e=>{e.done=!0}),nz(n,{type:"idle",parent:n}))}sw.assign({createStringInterpolator:Mce,to:(n,e)=>new M9e(n,e)});var E9e=["primitive"].concat(Object.keys(ene).filter(n=>/^[A-Z]/.test(n)).map(n=>n[0].toLowerCase()+n.slice(1)));sw.assign({createStringInterpolator:Mce,colors:j8e,frameLoop:"demand"});rwe(()=>{ls.advance()});var I9e=S9e(E9e,{applyAnimatedValues:oy}),R9e=I9e.animated;const P9e=""+new URL("island-BN767CUw.glb",import.meta.url).href,L9e=({isRotating:n,setIsRotating:e,setCurrentStage:t,...r})=>{const i=Ae.useRef(),{gl:s,viewport:a}=yne(),{nodes:l,materials:o}=eg(P9e),h=Ae.useRef(0),d=Ae.useRef(0),m=.95,_=M=>{M.stopPropagation(),M.preventDefault(),e(!0);const B=M.touches?M.touches[0].clientX:M.clientX;h.current=B},y=M=>{M.stopPropagation(),M.preventDefault(),e(!1)},T=M=>{if(M.stopPropagation(),M.preventDefault(),n){const B=M.touches?M.touches[0].clientX:M.clientX,k=(B-h.current)/a.width;i.current.rotation.y+=k*.01*Math.PI,h.current=B,d.current=k*.01*Math.PI}},I=M=>{M.key==="ArrowLeft"?(n||e(!0),i.current.rotation.y+=.01*Math.PI,d.current=.0125):M.key==="ArrowRight"&&(n||e(!0),i.current.rotation.y-=.01*Math.PI,d.current=-.0125)},C=M=>{(M.key==="ArrowLeft"||M.key==="ArrowRight")&&e(!1)};return jT(()=>{if(!n)d.current*=m,Math.abs(d.current)<.001&&(d.current=0),i.current.rotation.y+=d.current;else{const B=(i.current.rotation.y%(2*Math.PI)+2*Math.PI)%(2*Math.PI);switch(!0){case(B>=5.45&&B<=5.85):t(4);break;case(B>=.85&&B<=1.3):t(3);break;case(B>=2.4&&B<=2.6):t(2);break;case(B>=4.25&&B<=4.75):t(1);break;default:t(null)}}}),Ae.useEffect(()=>{const M=s.domElement;return M.addEventListener("pointerdown",_),M.addEventListener("pointerup",y),M.addEventListener("pointermove",T),document.addEventListener("keydown",I),document.addEventListener("keyup",C),()=>{M.removeEventListener("pointerdown",_),M.removeEventListener("pointerup",y),M.removeEventListener("pointermove",T),document.removeEventListener("keydown",I),document.removeEventListener("keyup",C)}},[s,_,y,T]),me.jsxs(R9e.group,{ref:i,...r,children:[me.jsx("mesh",{geometry:l.polySurface944_tree_body_0.geometry,material:o.PaletteMaterial001}),me.jsx("mesh",{geometry:l.polySurface945_tree1_0.geometry,material:o.PaletteMaterial001}),me.jsx("mesh",{geometry:l.polySurface946_tree2_0.geometry,material:o.PaletteMaterial001}),me.jsx("mesh",{geometry:l.polySurface947_tree1_0.geometry,material:o.PaletteMaterial001}),me.jsx("mesh",{geometry:l.polySurface948_tree_body_0.geometry,material:o.PaletteMaterial001}),me.jsx("mesh",{geometry:l.polySurface949_tree_body_0.geometry,material:o.PaletteMaterial001}),me.jsx("mesh",{geometry:l.pCube11_rocks1_0.geometry,material:o.PaletteMaterial001})]})},D9e=""+new URL("plane-Dk3bBBjR.glb",import.meta.url).href,B9e=({isRotating:n,...e})=>{const t=Ae.useRef(),{scene:r,animations:i}=eg(D9e),{actions:s}=G6(i,t);return Ae.useEffect(()=>{n?s["Take 001"].play():s["Take 001"].stop()},[s,n]),me.jsx("mesh",{...e,ref:t,children:me.jsx("primitive",{object:r})})},k9e=""+new URL("sky-B0A1kvoP.glb",import.meta.url).href,O9e=({isRotating:n})=>{const e=eg(k9e),t=Ae.useRef();return jT((r,i)=>{n&&(t.current.rotation.y+=.15*i)}),me.jsx("mesh",{ref:t,children:me.jsx("primitive",{object:e.scene})})},F9e=()=>{const n=Ae.useRef(new Audio(L8e));n.current.volume=.4,n.current.loop=!0;const[e,t]=Ae.useState(!1),[r,i]=Ae.useState(1),[s,a]=Ae.useState(!1);Ae.useEffect(()=>(s&&n.current.play(),()=>{n.current.pause()}),[s]);const l=()=>{let T=null,I=[0,7.5,-43],C=[.1,4.7,0];return window.innerWidth<768?T=[.2,.2,.2]:T=[.4,.4,.4],[T,I,C]},[o,h,d]=l(),m=()=>{let T,I;return window.innerWidth<768?(T=[1.5,1.5,1.5],I=[2,0,-1]):(T=[3,3,3],I=[8,0,-4]),[T,I]},[_,y]=m();return me.jsxs("section",{className:"w-full h-screen relative",children:[me.jsxs("div",{className:"absolute top-28 left-0 right-0 z-10 flex items-center justify-center",children:[r&&me.jsx(B8e,{currentStage:r})," "]}),me.jsx(nD,{className:`w-full h-screen bg-transparent ${e?"cursor-grabbing":"cursor-grab"} `,camera:{near:.1,far:1e3},children:me.jsxs(Ae.Suspense,{fallback:me.jsx(H6,{}),children:[me.jsx("directionalLight",{position:[1,1,1],intensity:2}),me.jsx("ambientLight",{intensity:.5}),me.jsx("hemisphereLight",{skyColor:"#b1e1ff",groundColor:"#000000",intensity:1}),me.jsx(tke,{}),me.jsx(B9e,{scale:_,position:y,isRotating:e,rotation:[10,0,10]}),me.jsx(O9e,{isRotating:e}),me.jsx(L9e,{position:h,scale:o,rotation:d,isRotating:e,setIsRotating:t,setCurrentStage:i}),me.jsx(ske,{rotation:[.1,90,0],position:[0,-10,-80],scale:[.6,.6,.6]})]})}),me.jsx("div",{className:"absolute bottom-2 left-2",children:me.jsx("img",{src:s?X2e:$2e,alt:"sound",className:"w-10 h-10 cursor-pointer object-contain",onClick:()=>a(!s)})})]})},N9e=()=>me.jsxs("section",{className:"max-container",children:[me.jsxs("h1",{className:"head-text",children:["My ",me.jsx("span",{className:"blue-gradient_text font-semibold drop-shadow",children:" Projects"})]}),me.jsx("div",{className:"mt-5 flex flex-col gap-3 text-slate-500",children:me.jsx("p",{children:"I've embarked on numerous projects throughout the years, but these are the ones I hold closest to my heart. Mayn of them are open-source, so if you come across something that piques your interest, feel free to explore the codebase and contribute your ideas for further enhancements. You collaboration is highly valued! "})}),me.jsx("div",{className:"flex flex-wrap my-20 gap-16",children:o8e.map(n=>me.jsxs("div",{className:"lg:w=[400px] w-full",children:[me.jsxs("div",{className:"block-container w-12 h-12",children:[me.jsx("div",{className:`btn-back rounded-xl ${n.theme}`}),me.jsx("div",{className:"btn-front rounded-xl flex justify-center items-center",children:me.jsx("img",{src:n.iconUrl,alt:"Project Icon",className:"w-1/2 h-1/2 object-contain"})})]}),me.jsxs("div",{className:"mt-5 flex flex-col",children:[me.jsx("h4",{className:"text-2xl font-poppins font-semibold",children:n.name}),me.jsx("p",{className:"whitespace-pre-wrap mt-2 text-slate-500",children:n.description}),me.jsxs("div",{className:"mt-5 flex items-center gap-2 font-poppins",children:[me.jsx(N0,{to:n.link,target:"_blank",rel:"noopener noreferrer",className:"font-semibold text-blue-600",children:"Live Link"}),me.jsx("img",{src:One,alt:"arrow",className:"w-4 h-4 object-contain"})]})]})]},n.name))}),me.jsx("hr",{className:"border-slate-200"}),me.jsx(U8,{})]}),z9e=()=>me.jsx("main",{className:"bg-slate-300/20 h-full",children:me.jsxs(kme,{children:[me.jsx(A2e,{}),me.jsx(Ae.Suspense,{fallback:me.jsx(H6,{}),children:me.jsxs(Eme,{children:[me.jsx(Wd,{path:"/about_portfolio/",element:me.jsx(F9e,{})}),me.jsx(Wd,{path:"/about_portfolio/about",element:me.jsx(w8e,{})}),me.jsx(Wd,{path:"/about_portfolio/projects",element:me.jsx(N9e,{})}),me.jsx(Wd,{path:"/about_portfolio/arts",element:me.jsx(S8e,{})}),rce.map((n,e)=>me.jsx(Wd,{path:n.path,element:me.jsx(n.component,{})},e)),ice.map((n,e)=>me.jsx(Wd,{path:n.path,element:me.jsx(n.component,{})},e)),sce.map((n,e)=>me.jsx(Wd,{path:n.path,element:me.jsx(n.component,{})},e)),oce.map((n,e)=>me.jsx(Wd,{path:n.path,element:me.jsx(n.component,{})},e)),me.jsx(Wd,{path:"/about_portfolio/contact",element:me.jsx(P8e,{})})]})})]})});Xk.createRoot(document.getElementById("root")).render(me.jsx(z9e,{}));
